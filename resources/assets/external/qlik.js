/*!
* Copyright(C) 2015
* Qlik International AB
* All Rights Reserved
*/
define("js/configloader",{load:function(name,defaultRequire,onload){defaultRequire(["assets/general/require-config"],function(require){(require=require||defaultRequire)([name],function(value){onload(value)})})}}),define("apis/qlik-impl",["qvangular","translator","core.models/app","client.models/rpc-session","core.utils/deferred","apis/qglobal","apis/qapp","apis/qnavigation","apis/qsession","client.utils/state","general.utils/touch-configuration-util","general.models/library/extension-list","util","autogenerated/qix/engine-enums","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections","core.utils/augment","general.services/content-api/content-api","angular-route","angular-animate","angular-sanitize"],function(qvangular,translator,App,RPCSession,Deferred,QGlobal,QApp,QNavigation,QSession,State,touchConfigUtil,ExtensionList,Util,enums){function initClient(){clientInitialized||inClient||(clientInitialized=!0,touchConfigUtil.configureTouchSupport(),langSelected||translator.setup())}function setOnError(onError,onWarning){errorCallback=onError,QApp.setErrorCallback(onError),inClient||QSession.setupSocketErrorHandling(onError,onWarning)}function setLanguage(lang){langSelected=!0,translator.setup(lang)}function currApp(obj){var app=obj&&obj.backendApi?obj.backendApi.model.session.currentApp:App.current;return currWrapper||(currWrapper=new QApp(app)),currWrapper.model===app?currWrapper:new QApp(app)}function makeConfig(conf){return conf=conf||{},{host:conf.host||Util.hostname,port:conf.port?conf.port.toString():Util.port,isSecure:conf.isSecure||Util.isSecure,reloadURI:Util.reloadURI,prefix:conf.prefix||Util.basePath,openWithoutData:conf.openWithoutData,identity:conf.identity}}function openApp(appId,config){initClient();var cfg=makeConfig(config),cacheId=App.makeCacheId(appId,cfg);return appCache[cacheId]?appCache[cacheId]:(qvangular.$apply(qvangular.$rootScope,function(){var app=App.getSync(appId,cfg,!0);if(app){app.session.Close.observers.forEach(function(obs){app.session.Close.unbind(obs)}),app.waitForOpen.promise.then(function(){errorCallback&&app.session.Close.bind(function(){errorCallback({code:Errors.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})})},function(err){errorCallback&&(errorCallback(err.error),err.isHandled=!0)});var qapp=new QApp(app);qapp.close=function(){return delete appCache[cacheId],app.close()},appCache[cacheId]=qapp}}),appCache[cacheId])}function getGlobal(config){return new QGlobal(makeConfig(config))}function table(ext,path){var app=currApp(ext);return app.table(ext,path)}var errorCallback,currWrapper,navigationApi,appCache={},clientInitialized=!1,langSelected=!1,inClient=!1,Errors=enums.NxLocalizedErrorCode;window.location.pathname.indexOf("/sense/app/")>-1?inClient=!0:(State.setState(State.States.analysis),State.setView(State.Views.sheet)),navigationApi=new QNavigation(inClient);var exports={openApp:openApp,currApp:currApp,getGlobal:getGlobal,setOnError:setOnError,setLanguage:setLanguage,table:table,getAppList:function(callback,param){qvangular.$apply(qvangular.$rootScope,function(){var session=RPCSession.get("?transient=",makeConfig(param));session.open(),App.getList(session).then(function(list){callback(list),session.close()})})},resize:function(id){id?pubsub.publish("/ui/object/resize."+id):pubsub.publish("/resize/end")},getExtensionList:function(callback){var dfd=new Deferred;return ExtensionList.getList().then(function(reply){callback&&callback(reply),dfd.resolve(reply)}),dfd.promise},callRepository:function(path,method,body){return qvangular.getService("$contentApi").request({method:method||"GET",url:path,data:body})},navigation:navigationApi};return define("qlik",exports),require.s.contexts.sense&&(require.s.contexts._.defined.angular=require.s.contexts.sense.defined.angular),exports}),define("js/qlik",["js/configloader!apis/qlik-impl"],function(m){return m}),define("core.utils/notification",[],function(){"use strict";var Notification,NotificationMixin,INSTANTIATING=!1;return Notification=function(receiver,name){if(INSTANTIATING!==!0)throw new Error("This class can't be instantiated directly.");this.observers=[],this.receiver=receiver,Object.defineProperty(this,"name",{get:function(){return name}})},Notification.prototype.bind=function(observer){if("function"!=typeof observer)throw new Error("Observer must be a function.");if(observer===Notification.prototype.emit)throw new Error("Observer cannot be proxied this way. Use a wrapper function.");this.observers.push(observer)},Notification.prototype.once=function(observer){function f(){self.unbind(f),observer.apply(self.receiver,arguments)}var self=this;f.onceObserver=observer,self.bind(f)},Notification.prototype.unbind=function(observer){var index;index=this.observers.reduce(function(foundIndex,o,currIndex){return-1!==foundIndex?foundIndex:o===observer||o.onceObserver===observer?currIndex:-1},-1),-1!==index&&this.observers.splice(index,1)},Notification.prototype.emit=function(){var receiver=this.receiver,args=Array.prototype.slice.call(arguments),observers=this.observers.slice();observers.forEach(function(observer){observer.apply(receiver,args)})},Notification.prototype.release=function(){var receiver=this.receiver;delete receiver[this.name],Object.keys(NotificationMixin.prototype).forEach(function(key){delete receiver[key]}),this.receiver=null,this.observers=null},Notification.create=function(receiver,name){if(!receiver)throw new Error("Not a valid receiver.");if("string"!=typeof name)throw new Error("Nofification name not optional.");if(!/^([A-Z][a-z]+)+$/.test(name))throw new Error("The notification name must be PascalCased.");if(name in receiver)throw new Error("A property named '"+name+"' is already present on the receiver.");return INSTANTIATING=!0,receiver[name]=new Notification(receiver,name),INSTANTIATING=!1,receiver[name]},Notification.mixin=function(receiver){if(!receiver)throw new Error("Not a valid receiver.");Object.keys(NotificationMixin.prototype).forEach(function(property){if(property in receiver)throw new Error("A property named '"+property+"' is already present on the receiver.");receiver[property]=NotificationMixin.prototype[property]})},Notification.release=function(mixinedObject){Object.keys(mixinedObject).forEach(function(key){var prop=mixinedObject[key];prop instanceof Notification&&prop.release()})},NotificationMixin={prototype:{notification:function(name){return Notification.create(this,name)}}},Notification}),/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener,this._isOnce=isOnce,this.context=listenerContext,this._signal=signal,this._priority=priority||0}function validateListener(listener,fnName){if("function"!=typeof listener)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}function Signal(){this._bindings=[],this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}SignalBinding.prototype={active:!0,params:null,execute:function(paramsArr){var handlerReturn,params;return this.active&&this._listener&&(params=this.params?this.params.concat(paramsArr):paramsArr,handlerReturn=this._listener.apply(this.context,params),this._isOnce&&this.detach()),handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},Signal.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(listener,isOnce,listenerContext,priority){var binding,prevIndex=this._indexOfListener(listener,listenerContext);if(-1!==prevIndex){if(binding=this._bindings[prevIndex],binding.isOnce()!==isOnce)throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(isOnce?"Once":"")+"() the same listener without removing the relationship first.")}else binding=new SignalBinding(this,listener,isOnce,listenerContext,priority),this._addBinding(binding);return this.memorize&&this._prevParams&&binding.execute(this._prevParams),binding},_addBinding:function(binding){var n=this._bindings.length;do--n;while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){for(var cur,n=this._bindings.length;n--;)if(cur=this._bindings[n],cur._listener===listener&&cur.context===context)return n;return-1},has:function(listener,context){return-1!==this._indexOfListener(listener,context)},add:function(listener,listenerContext,priority){return validateListener(listener,"add"),this._registerListener(listener,!1,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){return validateListener(listener,"addOnce"),this._registerListener(listener,!0,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),listener},removeAll:function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(params){if(this.active){var bindings,paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=paramsArr),n){bindings=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal,"function"==typeof define&&define.amd?define("signals",[],function(){return signals}):"undefined"!=typeof module&&module.exports?module.exports=signals:global.signals=signals}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var factory=function(signals){function arrayIndexOf(arr,val){if(arr.indexOf)return arr.indexOf(val);for(var n=arr.length;n--;)if(arr[n]===val)return n;return-1}function arrayRemove(arr,item){var i=arrayIndexOf(arr,item);-1!==i&&arr.splice(i,1)}function isKind(val,kind){return"[object "+kind+"]"===Object.prototype.toString.call(val)}function isRegExp(val){return isKind(val,"RegExp")}function isArray(val){return isKind(val,"Array")}function isFunction(val){return"function"==typeof val}function typecastValue(val){var r;return r=null===val||"null"===val?null:"true"===val?!0:"false"===val?!1:val===UNDEF||"undefined"===val?UNDEF:""===val||isNaN(val)?val:parseFloat(val)}function typecastArrayValues(values){for(var n=values.length,result=[];n--;)result[n]=typecastValue(values[n]);return result}function decodeQueryString(str,shouldTypecast){for(var item,val,queryArr=(str||"").replace("?","").split("&"),n=queryArr.length,obj={};n--;)item=queryArr[n].split("="),val=shouldTypecast?typecastValue(item[1]):item[1],obj[item[0]]="string"==typeof val?decodeURIComponent(val):val;return obj}function Crossroads(){this.bypassed=new signals.Signal,this.routed=new signals.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function Route(pattern,callback,priority,router){var isRegexPattern=isRegExp(pattern),patternLexer=router.patternLexer;this._router=router,this._pattern=pattern,this._paramsIds=isRegexPattern?null:patternLexer.getParamIds(pattern),this._optionalParamsIds=isRegexPattern?null:patternLexer.getOptionalParamsIds(pattern),this._matchRegexp=isRegexPattern?pattern:patternLexer.compilePattern(pattern,router.ignoreCase),this.matched=new signals.Signal,this.switched=new signals.Signal,callback&&this.matched.add(callback),this._priority=priority||0}var crossroads,_hasOptionalGroupBug,UNDEF;return _hasOptionalGroupBug=""===/t(.+)?/.exec("t")[1],Crossroads.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new Crossroads},addRoute:function(pattern,callback,priority){var route=new Route(pattern,callback,priority,this);return this._sortedInsert(route),route},removeRoute:function(route){arrayRemove(this._routes,route),route._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(request,defaultArgs){if(request=request||"",defaultArgs=defaultArgs||[],this.ignoreState||request!==this._prevMatchedRequest&&request!==this._prevBypassedRequest){var cur,routes=this._getMatchedRoutes(request),i=0,n=routes.length;if(n)for(this._prevMatchedRequest=request,this._notifyPrevRoutes(routes,request),this._prevRoutes=routes;n>i;)cur=routes[i],cur.route.matched.dispatch.apply(cur.route.matched,defaultArgs.concat(cur.params)),cur.isFirst=!i,this.routed.dispatch.apply(this.routed,defaultArgs.concat([request,cur])),i+=1;else this._prevBypassedRequest=request,this.bypassed.dispatch.apply(this.bypassed,defaultArgs.concat([request]));this._pipeParse(request,defaultArgs)}},_notifyPrevRoutes:function(matchedRoutes,request){for(var prev,i=0;prev=this._prevRoutes[i++];)prev.route.switched&&this._didSwitch(prev.route,matchedRoutes)&&prev.route.switched.dispatch(request)},_didSwitch:function(route,matchedRoutes){for(var matched,i=0;matched=matchedRoutes[i++];)if(matched.route===route)return!1;return!0},_pipeParse:function(request,defaultArgs){for(var route,i=0;route=this._piped[i++];)route.parse(request,defaultArgs)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(route){var routes=this._routes,n=routes.length;do--n;while(routes[n]&&route._priority<=routes[n]._priority);routes.splice(n+1,0,route)},_getMatchedRoutes:function(request){for(var route,res=[],routes=this._routes,n=routes.length;(route=routes[--n])&&((!res.length||this.greedy||route.greedy)&&route.match(request)&&res.push({route:route,params:route._getParamsArray(request)}),this.greedyEnabled||!res.length););return res},pipe:function(otherRouter){this._piped.push(otherRouter)},unpipe:function(otherRouter){arrayRemove(this._piped,otherRouter)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},crossroads=new Crossroads,crossroads.VERSION="0.12.0",crossroads.NORM_AS_ARRAY=function(req,vals){return[vals.vals_]},crossroads.NORM_AS_OBJECT=function(req,vals){return[vals]},Route.prototype={greedy:!1,rules:void 0,match:function(request){return request=request||"",this._matchRegexp.test(request)&&this._validateParams(request)},_validateParams:function(request){var key,rules=this.rules,values=this._getParamsObject(request);for(key in rules)if("normalize_"!==key&&rules.hasOwnProperty(key)&&!this._isValidParam(request,key,values))return!1;return!0},_isValidParam:function(request,prop,values){var validationRule=this.rules[prop],val=values[prop],isValid=!1,isQuery=0===prop.indexOf("?");return null==val&&this._optionalParamsIds&&-1!==arrayIndexOf(this._optionalParamsIds,prop)?isValid=!0:isRegExp(validationRule)?(isQuery&&(val=values[prop+"_"]),isValid=validationRule.test(val)):isArray(validationRule)?(isQuery&&(val=values[prop+"_"]),isValid=this._isValidArrayRule(validationRule,val)):isFunction(validationRule)&&(isValid=validationRule(val,request,values)),isValid},_isValidArrayRule:function(arr,val){if(!this._router.ignoreCase)return-1!==arrayIndexOf(arr,val);"string"==typeof val&&(val=val.toLowerCase());for(var item,compareVal,n=arr.length;n--;)if(item=arr[n],compareVal="string"==typeof item?item.toLowerCase():item,compareVal===val)return!0;return!1},_getParamsObject:function(request){for(var param,val,shouldTypecast=this._router.shouldTypecast,values=this._router.patternLexer.getParamValues(request,this._matchRegexp,shouldTypecast),o={},n=values.length;n--;)val=values[n],this._paramsIds&&(param=this._paramsIds[n],0===param.indexOf("?")&&val&&(o[param+"_"]=val,val=decodeQueryString(val,shouldTypecast),values[n]=val),_hasOptionalGroupBug&&""===val&&-1!==arrayIndexOf(this._optionalParamsIds,param)&&(val=void 0,values[n]=val),o[param]=val),o[n]=val;return o.request_=shouldTypecast?typecastValue(request):request,o.vals_=values,o},_getParamsArray:function(request){var params,norm=this.rules?this.rules.normalize_:null;return norm=norm||this._router.normalizeFn,params=norm&&isFunction(norm)?norm(request,this._getParamsObject(request)):this._getParamsObject(request).vals_},interpolate:function(replacements){var str=this._router.patternLexer.interpolate(this._pattern,replacements);if(!this._validateParams(str))throw new Error("Generated string doesn't validate against `Route.rules`.");return str},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},Crossroads.prototype.patternLexer=function(){function precompileTokens(){var key,cur;for(key in TOKENS)TOKENS.hasOwnProperty(key)&&(cur=TOKENS[key],cur.id="__CR_"+key+"__",cur.save="save"in cur?cur.save.replace("{{id}}",cur.id):cur.id,cur.rRestore=new RegExp(cur.id,"g"))}function captureVals(regex,pattern){var match,vals=[];for(regex.lastIndex=0;match=regex.exec(pattern);)vals.push(match[1]);return vals}function getParamIds(pattern){return captureVals(PARAMS_REGEXP,pattern)}function getOptionalParamsIds(pattern){return captureVals(TOKENS.OP.rgx,pattern)}function compilePattern(pattern,ignoreCase){return pattern=pattern||"",pattern&&(_slashMode===LOOSE_SLASH?pattern=pattern.replace(LOOSE_SLASHES_REGEXP,""):_slashMode===LEGACY_SLASH&&(pattern=pattern.replace(LEGACY_SLASHES_REGEXP,"")),pattern=replaceTokens(pattern,"rgx","save"),pattern=pattern.replace(ESCAPE_CHARS_REGEXP,"\\$&"),pattern=replaceTokens(pattern,"rRestore","res"),_slashMode===LOOSE_SLASH&&(pattern="\\/?"+pattern)),_slashMode!==STRICT_SLASH&&(pattern+="\\/?"),new RegExp("^"+pattern+"$",ignoreCase?"i":"")}function replaceTokens(pattern,regexpName,replaceName){var cur,key;for(key in TOKENS)TOKENS.hasOwnProperty(key)&&(cur=TOKENS[key],pattern=pattern.replace(cur[regexpName],cur[replaceName]));return pattern}function getParamValues(request,regexp,shouldTypecast){var vals=regexp.exec(request);return vals&&(vals.shift(),shouldTypecast&&(vals=typecastArrayValues(vals))),vals}function interpolate(pattern,replacements){if("string"!=typeof pattern)throw new Error("Route pattern should be a string.");var replaceFn=function(match,prop){var val;if(prop="?"===prop.substr(0,1)?prop.substr(1):prop,null!=replacements[prop]){if("object"==typeof replacements[prop]){var queryParts=[];for(var key in replacements[prop])queryParts.push(encodeURI(key+"="+replacements[prop][key]));val="?"+queryParts.join("&")}else val=String(replacements[prop]);if(-1===match.indexOf("*")&&-1!==val.indexOf("/"))throw new Error('Invalid value "'+val+'" for segment "'+match+'".')}else{if(-1!==match.indexOf("{"))throw new Error("The segment "+match+" is required.");val=""}return val};return TOKENS.OS.trail||(TOKENS.OS.trail=new RegExp("(?:"+TOKENS.OS.id+")+$")),pattern.replace(TOKENS.OS.rgx,TOKENS.OS.save).replace(PARAMS_REGEXP,replaceFn).replace(TOKENS.OS.trail,"").replace(TOKENS.OS.rRestore,"/")}var ESCAPE_CHARS_REGEXP=/[\\.+*?\^$\[\](){}\/'#]/g,LOOSE_SLASHES_REGEXP=/^\/|\/$/g,LEGACY_SLASHES_REGEXP=/\/$/g,PARAMS_REGEXP=/(?:\{|:)([^}:]+)(?:\}|:)/g,TOKENS={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},LOOSE_SLASH=1,STRICT_SLASH=2,LEGACY_SLASH=3,_slashMode=LOOSE_SLASH;return precompileTokens(),{strict:function(){_slashMode=STRICT_SLASH},loose:function(){_slashMode=LOOSE_SLASH},legacy:function(){_slashMode=LEGACY_SLASH},getParamIds:getParamIds,getOptionalParamsIds:getOptionalParamsIds,getParamValues:getParamValues,compilePattern:compilePattern,interpolate:interpolate}}(),crossroads};"function"==typeof define&&define.amd?define("crossroads",["signals"],factory):"undefined"!=typeof module&&module.exports?module.exports=factory(require("signals")):window.crossroads=factory(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(crossroads,util){"use strict";function recompile(){registeredRoutes.forEach(function(route){route.dispose()}),addedRoutes.forEach(function(route){RouteController.addRoute(route)})}function bind(){window.addEventListener("popstate",function(){var newApp=util.getParameterByName("app");return app&&app!==newApp?void(location.href=location.href):void RouteController.parse()},!1)}if(location.pathname.match(/hub$/i))return void(location.href=location.href+"/");location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var RouteController={},app=util.getParameterByName("app"),lang=util.getParameterByName("language"),theme=util.getParameterByName("theme"),debug=util.getParameterByName("debug"),noData=util.getParameterByName("noData"),_defaultPartialPrefix=[],_defaultPartialSuffix=[],addedRoutes=[],registeredRoutes=[];return app&&_defaultPartialPrefix.push("app",app),lang&&_defaultPartialSuffix.push("language",lang),theme&&_defaultPartialSuffix.push("theme",theme),debug&&_defaultPartialSuffix.push("debug",debug),noData&&_defaultPartialSuffix.push("noData",!0),RouteController.isSuffixInUse=function(key){for(var i=0;i<_defaultPartialSuffix.length;i++)if(_defaultPartialSuffix[i]===key)return!0;return!1},RouteController.removePartialSuffix=function(key){for(var found=!1,i=0;i<_defaultPartialSuffix.length;i++)if(_defaultPartialSuffix[i]===key){_defaultPartialSuffix.splice(i,2),found=!0;break}if(found){var url=location.href,keyValuePattern=new RegExp("/"+key+"/[^/]+","i");recompile(),keyValuePattern.test(url)&&(url=url.replace(keyValuePattern,""),RouteController.setUrl(url))}return found},RouteController.parse=function(url){crossroads.parse(url||location.pathname)},RouteController.addRoute=function(route){var self=this,pattern=route.pattern;addedRoutes.push(route),route.isPartial&&("/"===pattern&&(pattern=""),pattern=self.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",pattern));var registeredRoute=crossroads.addRoute(pattern,function(){self.lastRoute&&self.lastRoute!==route&&self.lastRoute.DeRoute.emit(),self.lastRoute=route,route.Route.emit.apply(route.Route,arguments)});registeredRoutes.push(registeredRoute)},RouteController.setUrl=function(url,replaceHistory,noParse){replaceHistory=!0;var replaceURL=location.href.toLowerCase().indexOf("?x-")>-1;replaceURL&&(url=url.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==url.indexOf(util.baseURI)?location.href=url:url!==location.href&&(history[replaceHistory?"replaceState":"pushState"](null,null,url),noParse||RouteController.parse())},RouteController.start=function(){this.setUrl(location.href),bind(this),RouteController.parse()},RouteController.buildUrl=function(){var url,args=Array.apply(null,arguments),headRoute="",slug="";if(args[0]===!0?(headRoute=args[1],args=args.slice(2)):args.unshift.apply(args,_defaultPartialPrefix),_defaultPartialSuffix.length&&args.push.apply(args,_defaultPartialSuffix),args=args.map(function(part){return encodeURIComponent(part).replace(/'/g,"%27")}),headRoute){var replaceRoute=new RegExp("([^/])/"+util.project+"/","i");slug=util.baseURI.replace(replaceRoute,"$1/"+headRoute+"/")}else slug=util.baseURI;return url=slug+args.join("/").replace(/[\/]+/g,"/")},RouteController}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller"],function(Notification,RouteController){"use strict";var currentView,currentState,currentModel,currentSlide,previousState,previousView,State={};return State.States={analysis:0,edit:1,snapshot:2,play:3,editstory:4,editwidget:5},State.Views={overview:0,sheet:1,story:2,object:3,masterObject:4,widgetEditor:5,dataSpace:6},Notification.mixin(State),State.notification("StateChanged"),State.notification("SheetChanged"),State.notification("StoryChanged"),State.setState=function(state){state!==currentState&&(previousState=currentState,currentState=state,State.StateChanged.emit(currentView,currentState,previousView,previousState),currentView===State.Views.sheet||currentView===State.Views.object||currentView===State.Views.masterObject?RouteController.setUrl(RouteController.buildUrl("sheet",currentModel.layout.qInfo.qId,"state",Object.keys(State.States)[state])):currentView===State.Views.story&&RouteController.setUrl(RouteController.buildUrl("story",currentModel.layout.qInfo.qId,"state",Object.keys(State.States)[state],"slide",currentSlide)))},State.setView=function(view){view!==currentView&&(previousView=currentView,currentView=view,view===State.Views.overview&&(currentModel=null),State.StateChanged.emit(currentView,currentState,previousView,previousState))},State.setSheet=function(sheet,state){var changedState=!1;sheet!==currentModel&&(currentModel=sheet,previousView=currentView,currentView=State.Views.sheet,State.SheetChanged.emit(sheet),changedState=!0),State.States[state]!==currentState&&(previousState=currentState,currentState=State.States[state]||State.States.analysis,changedState=!0),changedState&&State.StateChanged.emit(currentView,currentState,previousView,previousState)},State.setStory=function(story,state,slideId){var changedState=!1;story!==currentModel&&(currentModel=story,previousView=currentView,currentView=State.Views.story,State.StoryChanged.emit(story),changedState=!0),currentSlide=slideId,State.States[state]!==currentState&&(previousState=currentState,currentState=State.States[state]||State.States.editstory,changedState=!0),changedState&&State.StateChanged.emit(currentView,currentState,previousView,previousState)},State.isInAnalysisMode=function(){return currentState===State.States.analysis},State.isInEditMode=function(){return currentState===State.States.edit},State.isInSnapshotMode=function(){return currentState===State.States.snapshot},State.inStoryPlayState=function(){return State.inStorytelling()&&currentState===State.States.play},State.inStorytelling=function(){return currentView===State.Views.story},State.inAppOverView=function(){return currentView===State.Views.overview},State.inDataSpace=function(){return currentView===State.Views.dataSpace},State.inSheetView=function(){return currentView===State.Views.sheet},State.inObjectView=function(){return currentView===State.Views.object},State.inMasterObjectView=function(){return currentView===State.Views.masterObject},State.isInWidgetEditMode=function(){return currentState===State.States.editwidget},State.getModel=function(){return State.model},Object.defineProperties(State,{state:{get:function(){return currentState}},view:{get:function(){return currentView}},model:{get:function(){return currentModel},set:function(model){currentModel=model}}}),State}),define("assets/qvangular/qvangular-config",[],function(){var autoBootstrap="false"!==(document.documentElement.getAttribute("qva-bootstrap")||document.body.getAttribute("qva-bootstrap"));return{internalOptimizations:autoBootstrap,autoBootstrap:autoBootstrap}}),define("qlikui/qui",["angular"],function(angular){"use strict";function component(name,configuration,module){if(module=module||window.qvangularGlobal||mod,!name)throw new Error("Name is undefined.");if(!configuration.template)throw new Error("Template is undefined.");var directiveOptions={restrict:"E",replace:!0,transclude:null!=configuration.transclude?configuration.transclude:!0,template:configuration.template,requires:configuration.requires,scope:null!=configuration.scope?configuration.scope:"=",controller:configuration.controller||function(){},link:configuration.link||function(){}};return module.directive(name,function(){return directiveOptions}),directiveOptions}var mod=angular.module("qlik-ui",[]),configuration={treatAsDesktop:function(){return!("ontouchstart"in window)},quiToggleSwitchLink:function(){}},exports={component:component,directive:mod.directive,configure:function(config){configuration=angular.extend(configuration,config)},getConfigOption:function(name){return configuration[name]}};return exports}),define("text!assets/qvangular/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\r\n	<div class="app-info-click-area"\r\n		 qva-activate="quiModel.onButton()"\r\n		 q-title-translation="{{quiModel.tooltip()}}"\r\n		 ng-class="{\'has-app-details\': quiModel.hasAppDetails()}">\r\n		<span class="app-read-only" ng-if="quiModel.readOnly"><i data-icon="padlock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\r\n\r\n		<h1 class="app-title">{{quiModel.appTitle}}</h1>\r\n\r\n		<h1 class="app-info-icon" data-icon="info" ng-if="quiModel.hasAppDetails()"></h1>\r\n	</div>\r\n</section>'}),define("text!assets/qvangular/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\r\n		tid="{{quiModel.tid}}"\r\n		qva-activate="onButton($event)"\r\n		qva-outside-ignore-for="{{quiModel.name}}"\r\n		q-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\r\n		ng-disabled="quiModel.isDisabled()"\r\n		ng-hide="quiModel.isHidden()"\r\n		ng-class="{\'qui-button\': !quiModel.qlikuiSmallIconButton, \'qui-smalliconbutton\': quiModel.qlikuiSmallIconButton,\'qui-active\': quiModel.pressed, \'noIcon\': !quiModel.icon, \'{{quiModel.hasStrongActiveColor}}\': true, \'iconToTheRight\': quiModel.iconToTheRight, \'dyn-text\': quiModel.dynamicText, \'{{quiModel.specialStateClass}}\': quiModel.isInSpecialState }">\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()" class="item-title">{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}</span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\r\n</button>'}),define("assets/qvangular/qui-toolbar/qui-toolbar",["jquery","qlikui/qui","text!./qui-app-info.ng.html","text!./qui-toolbar-button.ng.html"],function($,qui,appInfoTemplate,buttonTemplate){qui.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),qui.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),qui.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),qui.component("quiToolbarButtonGroup",{template:"<div class='qui-buttongroup' ng-transclude />"}),qui.component("quiToolbarAppInfo",{template:appInfoTemplate,scope:{quiModel:"="}}),qui.component("quiToolbarButton",{template:buttonTemplate,scope:{quiModel:"="},controller:["$scope","$timeout",function($scope){$scope.onButton=function($event){$.support.touch&&$event.target.focus(),$scope.quiModel.isToggleButton&&($scope.quiModel.pressed=!$scope.quiModel.pressed),$scope.quiModel.onButtonClicked($scope.quiModel,$event)}}]})}),define("assets/qvangular/qvangular-qui",["touche","qlikui/qui","assets/qvangular/qui-toolbar/qui-toolbar"],function(Touche,qui){var config={quiToggleSwitchLink:function(scope,element){Touche.utils.touch&&(scope.touch=!0,Touche(element.find("label")[0]).swipe({options:{preventDefault:!0},end:function(e,data){scope.readOnly||(("right"===data.swipe.direction&&scope.value||"left"===data.swipe.direction&&!scope.value)&&(scope.value=!scope.value,scope.$apply()),Touche.preventGestures(this.gestureHandler))}}).tap({end:function(){scope.readOnly||(scope.value=!scope.value,scope.$apply(),Touche.preventGestures(this.gestureHandler))}}))}};qui.configure(config)}),define("assets/qvangular/qvangular-core",["jquery","assets/qvangular/qvangular-config","assets/qvangular/qvangular-qui","angular-animate","angular-sanitize","angular","angular-vs-repeat"],function($,settings){function registerApi(name,fn){exports.isBootstrapped?exports[name]=fn:(exportFunctions.push({name:name,fn:fn}),exports[name]=function(){var args=Array.prototype.slice.call(arguments);bootstrapCallbacks.push({fn:fn,args:args})})}function $applyify(fn){return function(){var args=Array.prototype.slice.apply(arguments);exports.$rootScope.$$phase?fn.apply(this,args):exports.$rootScope.$apply(function(){fn.apply(this,args)})}}var injector,rootScope,compile,_$controller,_$provide,_$compileProvider,_$filterProvider,_$timeout,_$q,angular=window.angular,exports={},exportFunctions=[],bootstrapCallbacks=[];if(exports.bootstrap=function(_$injector,_$rootScope,_$compile,__$controller,__$timeout,__$q){rootScope=_$rootScope,compile=_$compile,_$controller=__$controller,_$timeout=__$timeout,_$q=__$q,injector=_$injector,exports.$injector=injector,exports.$rootScope=rootScope,exports.isBootstrapped=!0,exportFunctions.forEach(function(fn){exports[fn.name]=fn.fn}),bootstrapCallbacks.forEach(function(cb){cb.fn.apply(cb.fn,cb.args)}),bootstrapCallbacks.length=exportFunctions.length=0},exports.module=angular.module("qlik-angular",["ngAnimate","ngSanitize","vs-repeat","qlik-ui"],["$provide","$injector","$compileProvider","$filterProvider","$animateProvider",function($provide,$injector,$compileProvider,$filterProvider,$animateProvider){_$provide=$provide,_$compileProvider=$compileProvider,_$filterProvider=$filterProvider,settings.internalOptimizations&&($animateProvider.classNameFilter(/\bqv-animate\b/i),$provide.value("$anchorScroll",function(){}))}]).run(["$injector","$rootScope","$compile","$controller","$timeout","$q",exports.bootstrap]),registerApi("directive",function(name,constructor){_$compileProvider.directive(name,constructor)}),registerApi("filter",function(name,constructor){_$filterProvider.register(name,constructor)}),registerApi("service",function(name,constructor){return _$provide.service(name,constructor),injector.get(name)}),registerApi("provider",function(name,constructor){return _$provide.provider(name,constructor)}),registerApi("injectComponent",function(element,component,input){var controller;if(!component)throw"Trying to show undefined component.";if("function"==typeof component)return component.apply({},[element,input]);if(Array.isArray(component)){var locals={$element:element,input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key]);return injector.invoke(component,{},locals)}if(component.controller){var scope=$(element).scope();return scope||(scope=rootScope),exports.$apply(scope,function(){var childScope=scope.$new();childScope.extractComponent=function(){childScope.$$destroyed||(childScope.$destroy(),element.off(".qvangularcoreshowcomponent"),element.html(""))},childScope.destroyComponent=childScope.extractComponent;var locals={$scope:childScope,$element:element,$transclude:void 0,input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key],childScope[key]=input[key]);element.html(component.template);var linkFn=compile(element.contents());component.controller&&(controller=_$controller(component.controller,locals),element.contents().data("$ngControllerController",controller)),linkFn(childScope),element.on("remove.qvangularcoreshowcomponent",function(){childScope.$$destroyed||childScope.$destroy()})}),controller}}),registerApi("componentDirective",function(name,scopeDef,defaultComponentImpl){var completeScopeDef={};for(var prop in scopeDef)scopeDef.hasOwnProperty(prop)&&(completeScopeDef[prop]=scopeDef[prop]);completeScopeDef[name]="=",completeScopeDef.input="=",completeScopeDef.component="=",exports.directive(name,["$http","$templateCache","$compile","$controller",function($http,$templateCache,$compile,$controller){return{restrict:"EA",replace:!0,terminal:!0,scope:completeScopeDef,link:function(outerScope,element,attrs){var childScope,changeCounter=0;outerScope.$watch("component",function(component){var thisChangeId=++changeCounter;if(component||(component=defaultComponentImpl),component&&component.template){if(thisChangeId!==changeCounter)return;childScope&&childScope.$destroy(),childScope=outerScope.$new(),element.html(component.template);var link=$compile(element.contents()),locals={$scope:childScope,$element:element,$attrs:attrs};if(outerScope.input&&component.scope&&angular.forEach(component.scope,function(definition,inputProp){var childScopeProp;childScopeProp="string"==typeof definition&&"="===definition.charAt(0)&&definition.length>1?definition.substring(1):inputProp,childScope[childScopeProp]=outerScope.input[inputProp];var lastValue=childScope[childScopeProp];childScope.$watch(function(){var valueInInput=outerScope.input[inputProp];return valueInInput!==childScope[childScopeProp]&&(valueInInput!==lastValue?lastValue=childScope[childScopeProp]=valueInInput:outerScope.input[inputProp]=lastValue=childScope[childScopeProp]),valueInInput})}),outerScope.input){for(var key in outerScope.input)outerScope.input.hasOwnProperty(key)&&(locals[key]=outerScope.input[key]);locals.input=outerScope.input}if(component.controller){var controller=$controller(component.controller,locals);element.contents().data("$ngControllerController",controller)}link(childScope)}else childScope&&(childScope.$destroy(),childScope=null),element.html("")})}}}])}),bootstrapCallbacks.push({name:"componentDirective",fn:function(){exports.componentType=exports.componentDirective,exports.componentDirective("qvaInclude",{ngModel:"="})}}),settings.autoBootstrap){var externalModules=Object.keys(window.qvangularNgModules||[]),modulesToLoad=(window.angular.mock?["ngMock","qlik-angular"]:["qlik-angular"]).concat(externalModules);angular.bootstrap(document,modulesToLoad)}return exports.$apply=function($scope,callback){return exports.isBootstrapped?void(callback?$scope.$root.$$phase?callback&&callback():$scope.$apply(callback):(callback=$scope,"function"==typeof callback?exports.$rootScope.$$phase?callback():exports.$rootScope.$apply(callback):callback&&callback.$apply&&(exports.$rootScope.$$phase||$scope.$apply()))):callback&&callback()||null},exports.defer=function(){return _$q.defer()},exports.when=function(value,callback,errback){return _$q.when(value,callback,errback)},exports.promise=function(result){return _$timeout(function(){return result})},exports.getService=function(name){return injector.get(name)},$.fn.showComponent=function(component,input){return"string"==typeof component?exports.injectComponent(this,{template:component,controller:input||function(){}},{}):exports.injectComponent(this,component,input)},exports.$applyify=$applyify,window.qvangularGlobal=exports,exports}),define("core.utils/deferred",["assets/qvangular/qvangular-core"],function(qvangular){var Deferred;return Deferred=function(){var d=qvangular.getService("$q").defer();return d},Deferred.resolve=function(value){var d=qvangular.getService("$q").defer();return d.resolve(value),d.promise},Deferred.reject=function(){return qvangular.getService("$q").reject.apply(null,arguments)},Deferred.all=function(){return qvangular.getService("$q").all.apply(null,arguments)},Deferred.when=function(){return qvangular.getService("$q").when.apply(null,arguments)},Deferred}),define("core.utils/class",[],function(){"use strict";var fnTest=/xyz/.test(function(){})?/\b_super\b/:/.*/,Class=function(){};return Class.extend=function extend(className,proto){var _super=this.prototype;"string"!=typeof className&&(proto=className,className="Class");var prototype=Object.create(this.prototype);for(var name in proto)prototype[name]="function"==typeof proto[name]&&"function"==typeof _super[name]&&fnTest.test(proto[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,proto[name]):proto[name];if(!/^[_a-z][_a-z\d]*$/i.test(className))throw new Error("Invalid subclass name. Alphanumericals only.");var ctor=new Function("return (function "+className+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return ctor.prototype=prototype,ctor.prototype.constructor=ctor,ctor.extend=extend,ctor},Class}),define("objects.views/charts/events/event-launcher",["core.utils/class"],function(Class){"use strict";return Class.extend({init:function(){this._listeners={}},listen:function(type,func,scope){return"function"!=typeof func?this:(this._listeners[type]||(this._listeners[type]=[]),this._listeners[type].push({callback:func,scope:scope}),this)},stopListen:function(type,func,scope){var i,listeners=this._listeners[type];if(listeners)for(i=listeners.length-1;i>=0;i-=1)func?(scope&&scope===listeners[i].scope&&listeners[i].callback===func||!scope&&listeners[i].callback===func)&&listeners.splice(i,1):listeners.splice(i,1);return this},fire:function(event,args){var listeners,i,type=event;if("string"!=typeof type&&(type=event.getType()),listeners=this._listeners[type])for(i=listeners.length-1;i>=0;--i)"string"==typeof event?listeners[i].callback.apply(listeners[i].scope?listeners[i].scope:this,args||[]):listeners[i].callback.apply(listeners[i].scope?listeners[i].scope:this,[event]);return this},hasListener:function(event){var type=event;return"string"!=typeof type&&(type=event.getType()),this._listeners&&this._listeners[type]&&this._listeners[type].length}})}),define("objects.utils/animation-frame",[],function(){var sT=function(callback){
return window.setTimeout(callback,1e3/60)},cT=function(id){return window.clearTimeout(id)},request=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||sT,cancel=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||cT;return{request:request===sT?sT:request.bind(window),cancel:cancel===cT?cT:cancel.bind(window)}}),define("objects.views/charts/invalidatable",["core.utils/deferred","./events/event-launcher","objects.utils/animation-frame"],function(Deferred,EventDispatcher,aF){"use strict";function validate(types,dfd){var ret;this._validating=!0,this._invalidatedProperties&&(!types||types&&types.contains("properties"))&&(ret=validateProperties.call(this),ret&&"function"==typeof ret.then&&this._pendingDfds.push(ret)),this._invalidatedDisplay&&(!types||types&&types.contains("display"))&&(ret=validateDisplay.call(this),ret&&"function"==typeof ret.then&&this._pendingDfds.push(ret)),this._validating=!1,this._invalidated=this._invalidatedDisplay||this._invalidatedProperties,this._invalidated||(this._pendingDfds.length?(Deferred.all(this._pendingDfds).then(function(){dfd.__qvState=1,dfd.resolve()}),this._pendingDfds=[]):(dfd.__qvState=1,dfd.resolve()))}function validateDisplay(){var ret=this._updateDisplay();return this._invalidatedDisplay=!1,this.__invalidators.display=[],ret}function validateProperties(){var ret=this._updateProperties();return this._invalidatedProperties=!1,this.__invalidators.properties=[],ret}function invalidate(){if(!this._invalidated&&!this._validating&&!this._released){var dfd,self=this;this._invalidated=!0,dfd=Deferred(),dfd.__qvState=0,dfd.__id=++this._dfdCount,this.dfd=dfd,this._timer=aF.request(function(){self._validate(null,dfd)})}return this.dfd?this.dfd.promise:void 0}return EventDispatcher.extend("Invalidatable",{init:function(){this._super(),this.__invalidators={size:[],display:[],properties:[]},this._pendingDfds=[],this._dfdCount=0},invalidate:function(){return this._released?Deferred.reject():invalidate.call(this)},invalidateProperties:function(s){return this._released?Deferred.reject():(this._invalidatedProperties||(this._invalidatedProperties=!0,invalidate.call(this)),this.__invalidators.properties.push(s),this.dfd.promise)},invalidateDisplay:function(s){return this._released?Deferred.reject():(this._invalidatedDisplay||(this._invalidatedDisplay=!0,invalidate.call(this)),this.__invalidators.display.push(s),this.dfd.promise)},validateNow:function(){return this._invalidated=!0,this.updateNow(),this},updateNow:function(types){if(this._invalidated&&!this._validating){var display=types&&types.contains("display")===this._invalidatedDisplay,properties=types&&types.contains("properties")===this._invalidatedProperties;(!types||display&&properties)&&(aF.cancel(this._timer),this._timer=null),this._validate(types,this.dfd)}return this},_update:function(){return this},_updateDisplay:function(){},_updateProperties:function(){},cancel:function(){aF.cancel(this._timer),this._invalidatedProperties=!1,this.__invalidators.properties=[],this._invalidatedDisplay=!1,this.__invalidators.display=[],this._invalidated=!1,this.dfd&&(this.dfd.__qvState=2,this.dfd.reject())},release:function(){this._released=!0,this.cancel(),this.dfd=null},_validate:function(types,dfd){validate.call(this,types,dfd)}})}),define("objects.views/charts/utils/transition-helper",["jquery","core.utils/class","core.utils/deferred"],function($,Class,Deferred){"use strict";function startAnimation(oldValues,currentValues,newValues,dfd){cancelAnimation.apply(this,[oldValues,currentValues]);var key,timer,startAt,t,s,equal=!0,invalidStart=!1,self=this;equal=TransitionHelper.checkEqual(oldValues,newValues);for(key in newValues)void 0===oldValues[key]&&(invalidStart=!0);return equal?(self._endCallback&&self._endCallback.call(self._scope),void dfd.resolve()):invalidStart?($.extend(currentValues,newValues),$.extend(oldValues,newValues),self._endCallback&&self._endCallback.call(self._scope),void dfd.resolve()):(timer=this._transitionTime,startAt=Date.now(),this._inAnimation=!0,this._initiateAnimation=!1,this._transitionProgress=0,$.extend(currentValues,interpolate(oldValues,currentValues,newValues,0)),void(this._animationCallback=setInterval(function(){if(t=(Date.now()-startAt)/timer,t>1)clearInterval(self._animationCallback),$.extend(currentValues,interpolate(oldValues,currentValues,newValues,1)),self._updateCallback&&self._updateCallback.call(self._scope),self._inAnimation=!1,self._lastFrame=!0,self._transitionProgress=1;else{switch(self._transitionCurve){case"linear":s=t;break;case"easeout":s=Math.sin(Math.PI*t/2);break;case"easein":s=1-Math.cos(Math.PI*t/2);break;default:s=(1+Math.cos(Math.PI*(1+t)))/2}self._transitionProgress=s,$.extend(currentValues,interpolate(oldValues,currentValues,newValues,s)),self._updateCallback&&self._updateCallback.call(self._scope)}t>1&&(currentValues=$.extend({},newValues),self._endCallback.call(self._scope),dfd.resolve())},15)))}function interpolate(from,at,to,t){var recursiveInterpolateArray=function(item,i){$.extend(item,interpolate(item,to[key][i],t))},recursiveInterpolate=function(iFrom,iAt,iTo){iAt[key]=interpolate(iFrom[key],iAt[key],iTo[key],t)};if(0>=t)return from;if(t>=1)return to;for(var key in from)from||!to?!from||to?(from[key]instanceof Array?from[key].forEach(recursiveInterpolateArray):isNaN(from[key])&&from[key]instanceof Object&&recursiveInterpolate(from,at,to),from[key]&&!to[key]&&(at[key]=to[key]),null===from[key]||null===to[key]||isNaN(from[key])||isNaN(to[key])||(at[key]=from[key]*(1-t)+to[key]*t)):void 0!==from.opacity&&(at.opacity=1-t):(void 0!==to.opacity&&(at.opacity=t),at=$.extend(at,to));return at}function cancelAnimation(ov,cv){$.extend(ov,cv),clearInterval(this._animationCallback),this._inAnimation=!1,this._lastFrame=!1}function checkAnimation(oldValues,currentValues,newValues,dfd){this._inAnimation||this._initiateAnimation&&this._transitionEnabled?startAnimation.call(this,oldValues,currentValues,newValues,dfd):dfd.resolve()}var TransitionHelper;return TransitionHelper=Class.extend("TransitionHelper",{namespace:".transitionhelper",init:function(updateCallback,endCallback,transitionTime,scope){this._updateCallback=updateCallback,this._endCallback=endCallback,this._transitionTime=transitionTime?transitionTime:500,this._scope=scope,this._inAnimation=!1,this._transitionProgress=0,this._lastFrame=!1,this._animationCallback=function(){return null},this._initiateAnimation=!0,this._transitionEnabled=!0,this._transitionDelay=0,this._transitionCurve=""},transition:function(oldValues,currentValues,newValues,endcall,updatecall,sc){var self=this,dfd=Deferred();return this._oldValues=oldValues,this._currentValues=currentValues,this._newValues=newValues,this._updateCallback=updatecall,this._endCallback=endcall,this._scope=sc,cancelAnimation.apply(this,[oldValues,currentValues]),this._initiateAnimation=!0,this._inAnimation||this._lastFrame?dfd.resolve():this._transitionDelay>0?this._trantisionTimeout=setTimeout(function(){checkAnimation.apply(self,[oldValues,currentValues,newValues,dfd])},this._transitionDelay):checkAnimation.apply(this,[oldValues,currentValues,newValues,dfd]),dfd.promise},clear:function(){clearInterval(this._animationCallback),clearTimeout(this._trantisionTimeout),this._inAnimation=!1,this._lastFrame=!0,this._transitionProgress=1},setTransitionTime:function(t){this._transitionTime=t},setDelay:function(d){this._transitionDelay=d},setTransitionCurve:function(curve){this._transitionCurve=curve}}),TransitionHelper.checkEqual=function(oldValues,newValues){var key;for(key in newValues){if(!(key in oldValues))return!1;if(typeof newValues[key]!=typeof oldValues[key])return!1;if(Array.isArray(newValues[key])){if(!TransitionHelper.checkEqual(oldValues[key],newValues[key]))return!1}else if(!(newValues[key]===oldValues[key]||void 0===oldValues[key]||"number"==typeof newValues[key]&&"number"==typeof oldValues[key]&&isNaN(newValues[key])&&isNaN(oldValues[key])))return!1}return!0},TransitionHelper}),define("objects.utils/shapes/geometry-math",[],function(){"use strict";var GeometryMath,epsilon=1e-12;return GeometryMath={checkPointsCoincident:function(p1,p2){return p1.x===p2.x&&p1.y===p2.y?!0:!1},checkPointOnLineSegment2:function(p,p1,p2){var dx,dy,t1,t2;return dx=p2.x-p1.x,dy=p2.y-p1.y,0===dx?0===dy?GeometryMath.checkPointsCoincident(p,p1):p.x!==p1.x?!1:(t1=(p.y-p1.y)/dy,t1>=0&&1>=t1?!0:!1):0===dy?p.y!==p1.y?!1:(t1=(p.x-p1.x)/dx,t1>=0&&1>=t1?!0:!1):(t1=(p.x-p1.x)/dx,t2=(p.y-p1.y)/dy,t1>=0&&1>=t1&&Math.abs(t1-t2)<epsilon?!0:!1)},checkPointOnLineSegment:function(p,line){return GeometryMath.checkPointOnLineSegment2(p,line[0],line[1])},checkLineSegmentIntersectingLineSegment2:function(p1,p2,p3,p4){var dx1,dy1,dx2,dy2,dx3,dy3,ua_t,ub_t,u_b,ua,ub,t1,t2;if(dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=p4.x-p3.x,dy2=p4.y-p3.y,dx3=p1.x-p3.x,dy3=p1.y-p3.y,u_b=dy2*dx1-dx2*dy1,ua_t=dx2*dy3-dy2*dx3,ub_t=dx1*dy3-dy1*dx3,0===u_b){if(0===ua_t&&0===ub_t){if(0===dx1){if(0===dy1)return GeometryMath.checkPointOnLineSegment2(p1,p3,p4);t1=(p3.y-p1.y)/dy1,t2=(p4.y-p1.y)/dy1}else t1=(p3.x-p1.x)/dx1,t2=(p4.x-p1.x)/dx1;return 0>t1&&0>t2||t1>1&&t2>1?!1:!0}return!1}return ua=ua_t/u_b,ub=ub_t/u_b,ua>=0&&1>=ua&&ub>=0&&1>=ub?!0:!1},checkLineSegmentIntersectingLineSegment:function(line1,line2){return GeometryMath.checkLineSegmentIntersectingLineSegment2(line1[0],line1[1],line2[0],line2[1])},checkPointInsideRectDefinedByMaxMin:function(p,rect){return p.x>rect.minX&&p.x<rect.maxX&&p.y>rect.minY&&p.y<rect.maxY},checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin:function(p,rect){return p.x>=rect.minX&&p.x<=rect.maxX&&p.y>=rect.minY&&p.y<=rect.maxY},checkLineSegmentIntersectingRectDefinedByMaxMin:function(line,rect){return GeometryMath.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(line[0],rect)||GeometryMath.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(line[0],rect)?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.minY},{x:rect.minX,y:rect.maxY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.maxX,y:rect.minY},{x:rect.maxX,y:rect.maxY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.minY},{x:rect.maxX,y:rect.minY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.maxY},{x:rect.maxX,y:rect.maxY}])?!0:!1},checkPolylineIntersectingRectDefinedByMaxMin:function(polyline,rect){var p1,p2,i,minX,maxX,minY,maxY,numPoints=polyline?polyline.length:0;if(0===numPoints)return!1;if(p2=polyline[0],p2.x>rect.maxX)return!1;if(p2.x>=rect.minX&&p2.y>=rect.minY&&p2.y<=rect.maxY)return!0;for(p1=p2,i=1;numPoints>i;i++){if(p2=polyline[i],p2.x>=rect.minX&&p2.x<=rect.maxX&&p2.y>=rect.minY&&p2.y<=rect.maxY)return!0;if(minX=Math.min(p1.x,p2.x),minX>rect.maxX)return!1;if(maxX=Math.max(p1.x,p2.x),maxX<rect.minX)p1=p2;else if(minY=Math.min(p1.y,p2.y),minY>rect.maxY)p1=p2;else if(maxY=Math.max(p1.y,p2.y),maxY<rect.minY)p1=p2;else{if(GeometryMath.checkLineSegmentIntersectingRectDefinedByMaxMin([p1,p2],rect))return!0;p1=p2}}return!1},checkPolylinesIntersectingRectDefinedByMaxMin:function(polylines,rect){var i,numPolylines=polylines?polylines.length:0;for(i=0;numPolylines>i;i++)if(GeometryMath.checkPolylineIntersectingRectDefinedByMaxMin(polylines[i],rect))return!0;return!1},calculateBounds:function(shapes){var shape,rect,i,rectMaxX,rectMaxY,xMin=Number.MAX_VALUE,xMax=-Number.MAX_VALUE,yMin=Number.MAX_VALUE,yMax=-Number.MAX_VALUE,len=shapes?shapes.length:0;if(0===len)return null;for(i=0;len>i;i++)shape=shapes[i],rect=shape?shape.calculateBounds():void 0,rect&&rect.x!==1/0&&(rectMaxX=rect.getRight(),rectMaxY=rect.getBottom(),rectMaxX>xMax&&(xMax=rectMaxX),rect.x<xMin&&(xMin=rect.x),rectMaxY>yMax&&(yMax=rectMaxY),rect.y<yMin&&(yMin=rect.y));return{x:xMin,y:yMin,width:xMax-xMin,height:yMax-yMin}}}}),define("objects.utils/shapes/line",["./geometry-math"],function(GeometryMath){"use strict";function Line(x1,y1,x2,y2){0===arguments.length?this.set(0,0,0,0):2===arguments.length?this.set(x1.x,x1.y,y1.x,y1.y):this.set(x1,y1,x2,y2)}return Line.prototype={toString:function(){return this.x1+" "+this.y1+" "+this.x2+" "+this.y2},clone:function(){return new Line(this.x1,this.y1,this.x2,this.y2)},set:function(x1,y1,x2,y2){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2},intersectsLine:function(line){return GeometryMath.checkLineSegmentIntersectingLineSegment(this.getPoints(),line.getPoints())},intersectsRect:function(rect){return this.intersectsLine(new Line(rect.x,rect.y,rect.x+rect.width,rect.y))||this.intersectsLine(new Line(rect.x+rect.width,rect.y,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y+rect.height,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y,rect.x,rect.y+rect.height))},getPoints:function(){var points=[];return points.push({x:this.x1,y:this.y1}),points.push({x:this.x2,y:this.y2}),points}},Line}),define("objects.utils/shapes/rect",["./line"],function(Line){"use strict";function Rect(x,y,width,height){0===arguments.length?this.set(0,0,0,0):this.set(x,y,width,height)}return Rect.prototype={toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},clone:function(){return new Rect(this.x,this.y,this.width,this.height)},set:function(x,y,width,height){width>=0?(this.x=x,this.width=width):(this.x=x+width,this.width=-width),height>=0?(this.y=y,this.height=height):(this.y=y+height,this.height=-height)},setLTRB:function(l,t,r,b){r>=l?(this.x=l,this.width=r-l):(this.x=r,this.width=l-r),b>=t?(this.y=t,this.height=b-t):(this.y=b,this.height=t-b)},equal:function(rect){return rect&&this.x===rect.x&&this.y===rect.y&&this.width===rect.width&&this.height===rect.height},combineWith:function(rect){var x,y,w,h,r=Math.max(rect.getRight(),this.getRight()),b=Math.max(rect.getBottom(),this.getBottom());return x=Math.min(rect.x,this.x),y=Math.min(rect.y,this.y),w=Math.max(0,r-x),h=Math.max(0,b-y),new Rect(x,y,w,h)},intersectsWith:function(rect){return rect&&this.x<=rect.getRight()&&rect.x<=this.getRight()&&this.y<=rect.getBottom()&&rect.y<=this.getBottom()?!0:!1},intersectsRect:function(rect){return this.intersectsWith(rect)},intersection:function(rect,strict){var x,y,r,b;return this.intersectsWith(rect)?(x=Math.max(this.x,rect.x),y=Math.max(this.y,rect.y),r=Math.min(this.getRight(),rect.getRight()),b=Math.min(this.getBottom(),rect.getBottom()),new Rect(x,y,r-x,b-y)):strict?null:new Rect(this.x,this.y,this.width,this.height)},union:function(rect){var x,y,r,b;return x=Math.min(this.x,rect.x),y=Math.min(this.y,rect.y),r=Math.max(this.getRight(),rect.getRight()),b=Math.max(this.getBottom(),rect.getBottom()),new Rect(x,y,r-x,b-y)},pointInside:function(x,y){return x>=this.x&&x<=this.getRight()&&y>=this.y&&y<=this.getBottom()},rectInside:function(rect){var i,points=rect.getPoints();for(i=0;4>i;i++)if(!this.pointInside(points[i].x,points[i].y))return!1;return!0},intersectsLine:function(line){var r=this.getRight(),b=this.getBottom();return this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2)?!0:line.intersectsLine(new Line(this.x,this.y,r,this.y))||line.intersectsLine(new Line(r,this.y,r,b))||line.intersectsLine(new Line(r,b,this.x,b))||line.intersectsLine(new Line(this.x,b,this.x,this.y))?!0:!1},getPoints:function(){var points=[];return points.push({x:this.x,y:this.y}),points.push({x:this.getRight(),y:this.y}),points.push({x:this.getRight(),y:this.getBottom()}),points.push({x:this.x,y:this.getBottom()}),points},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterPoint:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},getBoundingRect:function(){return this},scale:function(s){var d=s-1,dw=d*this.width/2,dh=d*this.height/2;this.x-=dw,this.y-=dh,this.width*=s,this.height*=s},hasNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)}},Rect}),define("objects.views/charts/utils/node",["core.utils/class"],function(Class){var Node;return Node=Class.extend("Node",{init:function(){this._parent=null,this._children=[],this._ancestors=null,this.data={}},detach:function(){return this._parent&&this._parent.removeChild(this),this},each:function(fn,scope){if("function"!=typeof fn||!this._children||!this._children.length)return this;var i,num=this._children.length;for(i=0;num>i;i++)fn.call(scope,this._children[i],i),this._children[i].isBranch&&this._children[i].each(fn,scope);return this}}),Object.defineProperties(Node.prototype,{parent:{get:function(){return this._parent}},isBranch:{get:function(){return this._children&&this._children.length}},children:{get:function(){return this._children}},siblings:{get:function(){if(!this._parent)return[];var c=this._parent._children.slice();return c.splice(c.indexOf(this),1),c}},ancestors:{get:function(){if(!this._ancestors){var p=this._parent;this._ancestors=p?[p].concat(p.ancestors):[]}return this._ancestors}},descendants:{get:function(){var i,len,c,r=[];for(i=0,len=this._children.length;len>i;i++)c=this._children[i],r.push(c),c._children.length&&(r=r.concat(c.descendants));return r}},leaves:{get:function(){var c,i,r=[],len=this._children.length;for(i=0;len>i;i++)c=this._children[i],c._children&&c._children.length?r=r.concat(c.leaves):r.push(c);return r}}}),Node}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(Class){var Matrix;return Matrix=Class.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){var mt=new Matrix;return mt.multiply(this._elements)},set:function(arr){return this._elements=arr,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(value){var i,j;for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)this._elements[i][j]+=value;return this},translate:function(x,y){return this.multiply([[1,0,x],[0,1,y],[0,0,1]]),this},rotate:function(radianAngle){var cos=Math.cos(-radianAngle),sin=Math.sin(-radianAngle);return this.multiply([[cos,sin,0],[-sin,cos,0],[0,0,1]]),this},skew:function(xAngle,yAngle){var tanX=Math.tan(xAngle),tanY=Math.tan(yAngle);return this.multiply([[1,tanX,0],[tanY,1,0],[0,0,1]]),this},multiply:function(value){var i,j,m,k;if(value instanceof Matrix&&(value=value._elements),Array.isArray(value)){for(m=[[0,0,0],[0,0,0],[0,0,0]],i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)for(k=0;3>k;k++)m[i][j]+=this._elements[i][k]*value[k][j];this._elements=m}else for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)this._elements[i][j]*=value;return this},scale:function(x,y){return(arguments.length<2||"undefined"==typeof y)&&(y=x),this.multiply([[x,0,0],[0,y,0],[0,0,1]]),this},determinant:function(){var a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],i=this._elements[2][2],p=0;return p=a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h},invert:function(){var dt=this.determinant(),a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],k=this._elements[2][2];return this._elements=[[e*k-f*h,c*h-b*k,b*f-c*e],[f*g-d*k,a*k-c*g,c*d-a*f],[d*h-e*g,g*b-a*h,a*e-b*d]],this.multiply(1/dt),this},transpose:function(){var m=Object.create(this._elements);return this._elements=[[m[0][0],m[1][0],m[2][0]],[m[0][1],m[1][1],m[2][1]],[m[0][2],m[1][2],m[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(p){var i,j,vec=[p.x,p.y,1],e=this._elements,m=[0,0,0];for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)m[i]+=vec[j]*e[i][j];return{x:m[0],y:m[1]}},transformPoints:function(array){var vec,i,j,k,m,e=this._elements,ret=[];for(k=0;k<array.length;k++){for(vec=[array[k].x,array[k].y,1],m=[0,0,0],i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)m[i]+=vec[j]*e[i][j];ret.push({x:m[0],y:m[1]})}return ret},toString:function(){var s="";return this._elements.forEach(function(row,i,arr){s+=row.join("	")+(i<arr.length?"\n":"")}),s}}),Object.defineProperties(Matrix.prototype,{elements:{get:function(){var m=this._elements;return[[m[0][0],m[0][1],m[0][2]],[m[1][0],m[1][1],m[1][2]],[m[2][0],m[2][1],m[2][2]]]}}}),Matrix}),define("general.utils/property-resolver",[],function(){function isHierarchical(definition){return"object"==typeof definition.items&&"array"!==definition.type&&("items"===definition.type||"items"===definition.component||"expandable-items"===definition.component||"accordion"===definition.component||!definition.type&&!definition.component)}function setValue(data,reference,value){var i,steps=reference.split("."),dataContainer=data,dataName=steps[steps.length-1];for(i=0;i<steps.length-1;++i)"undefined"==typeof dataContainer[steps[i]]&&(dataContainer[steps[i]]=isNaN(steps[i+1])?{}:[]),dataContainer=dataContainer[steps[i]];"undefined"!=typeof value?dataContainer[dataName]=value:delete dataContainer[dataName]}function getValue(data,reference,defaultValue){var i,steps=reference.split("."),dataContainer=data;for(i=0;i<steps.length;++i){if("undefined"==typeof dataContainer[steps[i]])return defaultValue;dataContainer=dataContainer[steps[i]]}return dataContainer}function getTypeValue(type,value,defaultValue){if("string"!=typeof value)return value;switch(type){case"integer":value=parseInt(value,10),isNaN(value)&&(value=defaultValue);break;case"number":value=parseFloat(value),isNaN(value)&&(value=defaultValue);break;case"boolean":value="true"===value}return value}function getDefaultValue(type,definition){if("function"==typeof definition.defaultValue)return definition.defaultValue();if("undefined"!=typeof definition.defaultValue)return definition.defaultValue;if(Array.isArray(definition.options))return definition.options[0].value;switch(type){case"array":return[];case"string":return"";case"integer":return 0;case"number":return 0;case"boolean":return!1;default:return null}}function getDefaults(rootDefinition){function findDefaults(definition){var keys,item,i;if(!definition.schemaIgnore)if(isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;i++)item=definition.items[keys[i]],item&&findDefaults(item);else definition.ref&&!definition.schemaIgnore&&setValue(defaults,definition.ref,getDefaultValue(definition.type,definition))}var defaults={};return"array"===rootDefinition.type&&rootDefinition.items?(defaults={},findDefaults({type:"items",items:rootDefinition.items})):findDefaults(rootDefinition),defaults}var resolveFunctions={};return resolveFunctions.invertedBoolean={get:function(getFn){return!getFn("boolean")},set:function(value,setFn){setFn("boolean",!value)}},resolveFunctions.booleanToSortInteger={get:function(getFn){return!!getFn("integer")},set:function(value,setFn,definition){var intValue;value?(intValue=definition.defaultSort?definition.defaultSort:1,setFn("integer",intValue)):setFn("integer",0)}},resolveFunctions.enumToSortInteger={get:function(getFn){switch(getFn("integer")){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(value,setFn){switch(value){case"descending":setFn("integer",-1);break;case"ascending":setFn("integer",1);break;default:setFn("integer",void 0)}}},{getValue:getValue,setValue:setValue,getTypeValue:getTypeValue,getDefaultValue:getDefaultValue,getDefaults:getDefaults,resolveFunctions:resolveFunctions,isHierarchical:isHierarchical}}),define("objects.views/charts/utils/node-selector",["general.utils/property-resolver"],function(propResolver){"use strict";var sel={className:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/},filters={className:function(c,objects){return objects.filter(function(o){var className=o.constructor.name;if(className){var classNameFromDashed=c.replace(/(\-[a-z])/g,function($1){return $1[1].toUpperCase()});return classNameFromDashed=classNameFromDashed[0].toUpperCase()+classNameFromDashed.slice(1),className===c||className===classNameFromDashed}})},attr:function(attr,operator,value,objects){return objects.filter(function(o){var v=propResolver.getValue(o,attr);if(!operator)return"undefined"!=typeof v;if("undefined"==typeof v)return!1;switch(operator){case"=":return value===String(v);case"!=":return value!==String(v)}return!1})}},selector={find:function(selector,object){var groups,descendants,result=[],groupResults=[];return object.isBranch&&(groups=this._tokenize(selector),descendants=object.descendants,groups.forEach(function(tokens){var filtered=descendants.slice(),levels=[],hasRemainder=!1;tokens.reverse().forEach(function(type){return" "===type.type?(levels.push(filtered),filtered=descendants.slice(),void(hasRemainder=!1)):(filtered=this._filter(type,filtered),void(hasRemainder=!0))},this),hasRemainder&&levels.push(filtered);var selected=levels[0].filter(function(node){var i,idx,ancestor=node.parent;for(i=1;i<levels.length;i++){for(;ancestor&&(idx=levels[i].indexOf(ancestor))<0;)ancestor=ancestor.parent;if(0>idx)return!1}return!0});groupResults.push(selected)},this),groupResults.forEach(function(nodes){nodes.forEach(function(node){result.indexOf(node)<0&&result.push(node)})})),result||[]},_filter:function(type,objects){if(!objects||!objects.length||!type||"function"!=typeof filters[type.type])return[];switch(type.type){case"className":return filters[type.type](type.value,objects);case"attr":return filters[type.type](type.attribute,type.operator,type.attributeValue,objects)}return[]},_tokenize:function(s){var sub,info,match,validSelector,groups=[];return s.split(/\s*,\s*/).forEach(function(group){for(group=group.trim(),sub=[];group;){validSelector=!1,match=group.match(/^\s*([>+~]|\s)\s*/),match&&(validSelector=!0,sub.push({type:" ",value:match[0]}),group=group.slice(match[0].length));for(var type in sel)match=group.match(sel[type]),match&&(validSelector=!0,group=group.slice(match[0].length),info={type:type,value:match[0]},"attr"===type&&(match=match[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),info.attribute=match[1],info.operator=match[2],info.attributeValue=match[3]),sub.push(info));if(sub&&sub.length&&groups.indexOf(sub)<0&&groups.push(sub),!validSelector)break}}),groups}};return selector}),define("objects.views/charts/shapes/display-object",["objects.views/charts/utils/node","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(Node,Matrix,GeometricalRect,nodeSelector){"use strict";function initMatrix(){this.matrix=new Matrix,this.scale=t.scale,this.rotate=t.rotate,this.translate=t.translate,this._dirtyBounds=!0}var DisplayObject,t={translate:function(x,y){return this.matrix.translate(x,y),this._dirtyBounds=!0,this.invalidate(),this},rotate:function(radians){return this.matrix.rotate(radians),this._dirtyBounds=!0,this.invalidate(),this},scale:function(x,y){return this.matrix.scale(x,y),this._dirtyBounds=!0,this.invalidate(),this}};return DisplayObject=Node.extend("DisplayObject",{init:function(){this._super(),this._dirtyBounds=!0,this._bounds=new GeometricalRect(NaN,NaN,NaN,NaN),this._vmBounds=new GeometricalRect(NaN,NaN,NaN,NaN),this._visualBounds=new GeometricalRect(NaN,NaN,NaN,NaN),this._stage=null,this.rData={inherited:{}},this._modelView=null,this._inverseModelView=null,this._inheritedProps={}},find:function(selector){return nodeSelector.find(selector,this)},translate:function(x,y){return 0===x&&0===y?this:(initMatrix.call(this),t.translate.call(this,x,y))},rotate:function(radians){return isNaN(radians)||0===radians?this:(initMatrix.call(this),t.rotate.call(this,radians))},scale:function(x,y){return 1===x?this:(initMatrix.call(this),t.scale.call(this,x,y))},clearTransform:function(){return this.matrix&&(this.matrix.identity(),this._dirtyBounds=!0,this.invalidate()),this},invalidate:function(){var s=this._stage||this.stage;return s&&s.invalidateObject(this),this._inheritedProps={},this},attr:function(a){return"undefined"!=typeof this[a]?this[a]:"undefined"!=typeof this.rData.inherited[a]?this.rData.inherited[a]:void 0},attrs:function(attributes){for(var a in attributes)"undefined"==typeof attributes[a]?delete this[a]:this[a]=attributes[a];return this},getBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._vmBounds},getVisualBounds:function(){return this._dirtyBounds&&this._calculateBounds(),this._visualBounds},getVisualExpansion:function(){var strokeWidth,stroke=this.attr("stroke");return stroke?(strokeWidth=this.attr("strokeWidth"),strokeWidth?strokeWidth/2:0):0},pointInside:function(x,y){if(this.visible===!1)return!1;var p,ivmm=this.getInverseModelView();return ivmm&&this._transformedIncomingPoint!==!0?(p=ivmm.transformPoint({x:x,y:y}),this.containsPoint(p.x,p.y)):this.containsPoint(x,y)},intersectsLine:function(line){if(this.visible===!1)return!1;var ret,p1,p2,imv=this.getInverseModelView();return imv&&this._transformedIncomingPoint!==!0?(p1=imv.transformPoint({x:line.x1,y:line.y1}),p2=imv.transformPoint({x:line.x2,y:line.y2}),line=line.clone(),line.set(p1.x,p1.y,p2.x,p2.y),this._transformedIncomingPoint=!0,ret=this.intersectsLocalLine(line),delete this._transformedIncomingPoint,ret):this.intersectsLocalLine(line)},intersectsRect:function(rect){if(this.visible===!1)return!1;var tr,ret,imv=this.getInverseModelView();return imv&&this._transformedIncomingPoint!==!0?(this._transformedIncomingPoint=!0,tr=this._getTransformedBoundsOfRect(imv,rect),ret=this.intersectsLocalRect(tr),delete this._transformedIncomingPoint,ret):this.intersectsLocalRect(rect)},getPoints:function(){if(this.visible===!1)return[];var points,i,num,mv=this.getModelView();if(mv){for(points=this.getLocalPoints(),i=0,num=points?points.length:0;num>i;i++)points[i]=mv.transformPoint(points[i]);return points}return this.getLocalPoints()},getLocalPoints:function(){return[]},intersectsLocalLine:function(){return!1},intersectsLocalRect:function(rect){var i,p="function"==typeof rect.getPoints?rect.getPoints():[{x:rect.x,y:rect.y},{x:rect.x+rect.width,y:rect.y},{x:rect.x+rect.width,y:rect.y+rect.height},{x:rect.x,y:rect.y+rect.height}],num=p.length;for(i=0;num>i;i++)if(this.containsPoint(p[i].x,p[i].y))return!0;for(p=this.getLocalPoints(),num=p.length,i=0;num>i;i++)if(p[i].x>=rect.x&&p[i].x<=rect.x+rect.width&&p[i].y>=rect.y&&p[i].y<=rect.y+rect.height)return!0;return!1},containsPoint:function(){return!1},getLocalBoundingRect:function(){return this._bounds},invalidateBounds:function(){return this._dirtyBounds=!0,this},clearModelView:function(){this._modelView=null,this._inverseModelView=null,this._isModelViewCalculated=!1,this._dirtyBounds=!0},getModelView:function(){return this._modelView||this._isModelViewCalculated||this._calculateModelView(),this._modelView},getInverseModelView:function(){return this._inverseModelView||this._isModelViewCalculated||this._calculateModelView(),this._inverseModelView},destroy:function(){this._stage=null},_calculateBounds:function(){var t,b=this._bounds,o=this.getLocalBoundingRect(),mv=this.getModelView(),s=this.getVisualExpansion();o?(b.set(o.x,o.y,o.width,o.height),mv?(t=this._getTransformedBoundsOfRect(mv,b),this._vmBounds.set(t.x,t.y,t.width,t.height),t=this._getTransformedBoundsOfRect(mv,{x:b.x-s,y:b.y-s,width:b.width+2*s,height:b.height+2*s}),this._visualBounds.set(t.x,t.y,t.width,t.height)):(this._vmBounds.set(o.x,o.y,o.width,o.height),this._visualBounds.set(o.x-s,o.y-s,o.width+2*s,o.height+2*s))):(b.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),
this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1},_getTransformedBoundsOfRect:function(matrix,r){var points,px,py,minX,minY,maxX,maxY;return points=matrix.transformPoints([{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}]),px=points.map(function(p){return p.x}),py=points.map(function(p){return p.y}),minX=Math.min.apply(null,px),maxX=Math.max.apply(null,px),minY=Math.min.apply(null,py),maxY=Math.max.apply(null,py),new GeometricalRect(minX,minY,maxX-minX,maxY-minY)},_calculateModelView:function(){for(var n=this;n&&!n.rData.vmTransform;)n=n._parent;return this._isModelViewCalculated=!0,n?(n._modelView||(n._modelView=new Matrix,n._inverseModelView=new Matrix),n.rData.dirtyVMTransform&&(n._modelView.set(n.rData.vmTransform),n._inverseModelView.set(n.rData.vmTransform).invert(),delete n.rData.dirtyVMTransform),this._modelView=n._modelView,this._inverseModelView=n._inverseModelView,!0):!1}}),Object.defineProperties(DisplayObject.prototype,{stage:{get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}}}),DisplayObject}),define("objects.utils/shapes/circle",["./rect"],function(Rect){"use strict";function Circle(cx,cy,r){0===arguments.length?this.set(0,0,0):this.set(cx,cy,r)}return Circle.prototype={toString:function(){return this.cx+" "+this.cy+" "+this.r},clone:function(){return new Circle(this.cx,this.cy,this.r)},set:function(cx,cy,r){this.cx=cx,this.cy=cy,this.r=r,this.radius=r},setPosition:function(cx,cy){this.cx=cx,this.cy=cy},setRadius:function(r){this.radius=r},combineWith:function(){},intersectsWith:function(rect){return rect.pointInside(this.cx,this.cy)},intersectsRect:function(rect){return rect.pointInside(this.cx,this.cy)},intersectsLine:function(line){if(this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2))return!0;var LAB,Dx,Dy,t1,t2,Ex,Ey,LEC;if(LAB=Math.sqrt(Math.pow(line.x2-line.x1,2)+Math.pow(line.y2-line.y1,2)),Dx=(line.x2-line.x1)/LAB,Dy=(line.y2-line.y1)/LAB,t1=Dx*(this.cx-line.x1)+Dy*(this.cy-line.y1),t2=Dx*(this.cx-line.x2)+Dy*(this.cy-line.y2),t1>=0&&1>=t2){if(Ex=t1*Dx+line.x1,Ey=t1*Dy+line.y1,LEC=Math.sqrt(Math.pow(Ex-this.cx,2)+Math.pow(Ey-this.cy,2)),LEC<=this.r)return!0}else if(t2>=0&&1>=t2&&(Ex=t2*Dx+line.x2,Ey=t2*Dy+line.y2,LEC=Math.sqrt(Math.pow(Ex-this.cx,2)+Math.pow(Ey-this.cy,2)),LEC<=this.r))return!0;return!1},pointInside:function(x,y){var distance=Math.sqrt(Math.pow(this.cx-x,2)+Math.pow(this.cy-y,2));return distance<=this.r},getPoints:function(){return[{x:this.cx,y:this.cy}]},getBoundingRect:function(){return new Rect(this.cx-this.r,this.cy-this.r,2*this.r,2*this.r)}},Circle}),define("objects.views/charts/utils/vector",["core.utils/class"],function(Class){var Vector;return Vector=Class.extend({init:function(x,y){this.x=x||0,this.y=y||0},clone:function(){return new Vector(this.x,this.y)},add:function(v){this.x+=v.x,this.y+=v.y},dot:function(v){return this.x*v.x+this.y*v.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),Vector.add=function(v1,v2){return v1.clone().add(v2)},Vector}),define("objects.utils/shapes/arc",["./line","./circle","./rect","objects.views/charts/utils/vector"],function(Line,Circle,Rect,Vector){"use strict";function Arc(cx,cy,innerRadius,radius,start,end,radianOffset){this.cx=cx,this.cy=cy,this.innerRadius=innerRadius,this.radius=radius,this.radianOffset=(0>radianOffset?radianOffset+2*Math.PI:radianOffset)%(2*Math.PI),this.start=start,this.start-=this.start>Math.PI?2*Math.PI:0,this.end=end,this.end-=this.end>Math.PI?2*Math.PI:0,this.arcCenter=(start+end)/2%(2*Math.PI),this.x1=cx+radius*Math.cos(this.start+this.radianOffset),this.y1=cy+radius*Math.sin(this.start+this.radianOffset),this.x2=cx+radius*Math.cos(this.end+this.radianOffset),this.y2=cy+radius*Math.sin(this.end+this.radianOffset),this.x3=cx+innerRadius*Math.cos(this.start+this.radianOffset),this.y3=cy+innerRadius*Math.sin(this.start+this.radianOffset),this.x4=cx+innerRadius*Math.cos(this.end+this.radianOffset),this.y4=cy+innerRadius*Math.sin(this.end+this.radianOffset)}var quartiles=["top","left","bottom","right"],rotLeft={top:"left",left:"bottom",bottom:"right",right:"top"},rotRight={top:"right",left:"top",bottom:"left",right:"bottom"};return Arc.prototype={getDistance:function(x1,y1,x2,y2){var x=Math.abs(x1-x2),y=Math.abs(y1-y2),r=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));return r},getAngle:function(x1,y1,x2,y2){var x=x1-x2,y=y1-y2,theta=Math.atan2(y,x)-this.radianOffset;return theta=0>theta?theta+2*Math.PI:theta,theta=theta>Math.PI?theta-2*Math.PI:theta},pointInside:function(x,y){var angle=this.getAngle(x,y,this.cx,this.cy),pointRadius=this.getDistance(x,y,this.cx,this.cy),start=this.start,end=this.end;return pointRadius>this.radius||pointRadius<this.innerRadius?!1:angle>=start&&end>=angle?!0:start>end&&(end>=angle||angle>=start)?!0:!1},getDirection:function(center){center+=Math.PI/4,0>center&&(center+=2*Math.PI),center%=2*Math.PI;var q=3;return center>=1.5*Math.PI?q=0:center>=Math.PI?q=1:center>=Math.PI/2&&(q=2),quartiles[q]},getSecondaryDirection:function(center){var firstDir=this.getDirection(center);return center+=Math.PI/4,center%(Math.PI/2)>Math.PI/4?rotRight[firstDir]:rotLeft[firstDir]},getPoints:function(){var points=[];return points.push({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},{x:this.x3,y:this.y3},{x:this.x4,y:this.y4}),points},getBoundingRect:function(){var x=Math.min(Math.min(this.x1,this.x2),Math.min(this.x3,this.x4)),y=Math.min(Math.min(this.y1,this.y2),Math.min(this.y3,this.y4)),w=Math.max(Math.max(this.x1,this.x2),Math.max(this.x3,this.x4))-x,h=Math.max(Math.max(this.y1,this.y2),Math.max(this.y3,this.y4))-y;return new Rect(x,y,w,h)},getRelevantPosition:function(){var x=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),y=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset);return{pos:{x:x,y:y},direction:[this.getDirection(this.arcCenter+this.radianOffset),this.getSecondaryDirection(this.arcCenter+this.radianOffset)]}},intersectsWith:function(rect){return this.intersectsLine(new Line(rect.x,rect.y,rect.x+rect.width,rect.y))||this.intersectsLine(new Line(rect.x+rect.width,rect.y,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y+rect.height,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y,rect.x,rect.y+rect.height))},intersectsLine:function(line){if(this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2))return!0;if(line.intersectsLine(new Line(this.x1,this.y1,this.x4,this.y4))||line.intersectsLine(new Line(this.x3,this.y3,this.x2,this.y2)))return!0;var innerCircle=new Circle(this.cx,this.cy,this.innerRadius);if(this.innerRadius>0&&innerCircle.pointInside(line.x1,line.y1)&&innerCircle.pointInside(line.x2,line.y2))return!1;var i,t1,t2,angle,d=new Vector(line.x2-line.x1,line.y2-line.y1),f=new Vector(line.x1-this.cx,line.y2-this.cy),a=d.dot(d),b=2*f.dot(d),c=f.dot(f)-this.radius*this.radius,discr=b*b-4*a*c,intersectionPoints=[];if(0>discr)return!1;if(discr=Math.sqrt(discr),t1=(-b-discr)/(2*a),t2=(-b+discr)/(2*a),t1>=0&&1>=t1&&intersectionPoints.push({x:line.x1+t1*d.x,y:line.y1+t1*d.y}),t2>=0&&1>=t2&&intersectionPoints.push({x:line.x1+t2*d.x,y:line.y1+t2*d.y}),!intersectionPoints.length)return!1;for(i=0;i<intersectionPoints.length;i++){if(angle=this.getAngle(intersectionPoints[i].x,intersectionPoints[i].y,this.cx,this.cy),angle>=this.start&&angle<=this.end)return!0;if(this.start>this.end&&(angle<=this.end||angle>=this.start))return!0}return!1}},Arc}),define("objects.views/charts/shapes/arc",["objects.views/charts/shapes/display-object","objects.utils/shapes/arc"],function(DisplayObject,GeometricalArc){"use strict";var Arc,halfPi=Math.PI/2,threeQuartsCircle=3*Math.PI/2,twoPi=2*Math.PI;return Arc=DisplayObject.extend("Arc",{init:function(cx,cy,innerRadius,radius,start,end,radianOffset){this._super(),GeometricalArc.apply(this,[cx,cy,innerRadius,radius,start,end,radianOffset])},containsPoint:GeometricalArc.prototype.pointInside,intersectsLocalLine:GeometricalArc.prototype.intersectsLine,getLocalPoints:GeometricalArc.prototype.getPoints,intersectsLocalRect:function(rect){return GeometricalArc.prototype.intersectsWith.call(this,rect)},getLocalBoundingRect:function(){var x,y,extremePointsX=[this.x1,this.x2,this.x3,this.x4],extremePointsY=[this.y1,this.y2,this.y3,this.y4],s=(this.start+this.radianOffset)%twoPi,e=s+this.end-this.start;return(twoPi>s&&e>twoPi||0>s&&e>0)&&extremePointsX.push(this.cx+this.radius),halfPi>s&&e>halfPi&&extremePointsY.push(this.cy+this.radius),s<Math.PI&&e>Math.PI&&extremePointsX.push(this.cx-this.radius),(threeQuartsCircle>s&&e>threeQuartsCircle||-halfPi>s&&e>-halfPi)&&extremePointsY.push(this.cy-this.radius),x=Math.min.apply(null,extremePointsX),y=Math.min.apply(null,extremePointsY),{x:x,y:y,width:Math.max.apply(null,extremePointsX)-x,height:Math.max.apply(null,extremePointsY)-y}},getRelevantPosition:function(){var mv=this.getModelView(),x=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),y=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset),p={x:x,y:y};return mv&&(p=mv.transformPoint(p)),{pos:{x:p.x,y:p.y},direction:[this.getDirection(this.arcCenter+this.radianOffset),this.getSecondaryDirection(this.arcCenter+this.radianOffset)]}},set:function(){GeometricalArc.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(GeometricalArc.prototype).forEach(function(key){!Arc.prototype.hasOwnProperty(key)&&["pointInside","intersectsLine","getBoundingRect","getPoints","getRelevantPosition","intersectsRect"].indexOf(key)<0&&(Arc.prototype[key]=GeometricalArc.prototype[key])}),Arc}),define("objects.utils/layout",[],function(){"use strict";function getLayoutMode(width,height){var i;for(i=0;layoutModeCnt>i;++i)if(width>=layoutModeSizes[i][0]&&height>=layoutModeSizes[i][1])return layoutModeSizes[i][2];return LayoutMode.SPARK}function getVerticalLayoutMode(height){var i;for(i=0;layoutModeCnt>i;++i)if(height>=verticalLayoutModeSizes[i][0])return verticalLayoutModeSizes[i][1];return LayoutMode.SPARK}function getHorizontalLayoutMode(width){var i;for(i=0;layoutModeCnt>i;++i)if(width>=horizontalLayoutModeSizes[i][0])return horizontalLayoutModeSizes[i][1];return LayoutMode.SPARK}function getLayoutModeKey(layoutMode){var str=Object.keys(LayoutMode).filter(function(key){return LayoutMode[key]===layoutMode})[0];return str&&str.toLowerCase()||""}var LayoutMode={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},layoutModeSizes=[[550,450,LayoutMode.FULL],[400,220,LayoutMode.MEDIUM],[300,150,LayoutMode.SMALL],[150,75,LayoutMode.XSMALL],[0,0,LayoutMode.SPARK]],verticalLayoutModeSizes=[[450,LayoutMode.FULL],[220,LayoutMode.MEDIUM],[150,LayoutMode.SMALL],[75,LayoutMode.XSMALL],[0,LayoutMode.SPARK]],horizontalLayoutModeSizes=[[550,LayoutMode.FULL],[400,LayoutMode.MEDIUM],[300,LayoutMode.SMALL],[150,LayoutMode.XSMALL],[0,LayoutMode.SPARK]],layoutModeCnt=layoutModeSizes.length;return{LayoutMode:LayoutMode,getLayoutMode:getLayoutMode,getLayoutModeKey:getLayoutModeKey,getHorizontalLayoutMode:getHorizontalLayoutMode,getVerticalLayoutMode:getVerticalLayoutMode}}),define("objects.views/charts/components/chart-component",["../invalidatable","objects.views/charts/utils/transition-helper","objects.utils/shapes/rect","objects.views/charts/shapes/arc","objects.utils/layout","core.utils/deferred","jquery"],function(Invalidatable,TransitionHelper,Rect,Arc,layoutMode,Deferred,$){"use strict";function updateDimensions(layoutMode){if(this._$renderAreaWrap){this.containerRect=new Rect(this.rect.x*this.layoutToContainerRatios.x||1,this.rect.y*this.layoutToContainerRatios.y||1,this.rect.width*this.layoutToContainerRatios.x||1,this.rect.height*this.layoutToContainerRatios.y||1),this.container.style.left=this.containerRect.x+"px",this.container.style.top=this.containerRect.y+"px",this.container.style.width=this.containerRect.width+"px",this.container.style.height=this.containerRect.height+"px";var value=this.isVisible(layoutMode)&&0!==this.rect.width&&0!==this.rect.height?"block":"none";this.container.style.display!==value&&(this.container.style.display=value)}}function checkEqual(oldValues,newValues){return TransitionHelper.checkEqual(oldValues,newValues)}function toSnake(s){return s?(s=s.replace(/[A-Z]/g,function(letter){return"-"+letter.toLowerCase()}),s.replace(/^\-/,"")):""}var ChartComponent;return ChartComponent=Invalidatable.extend("ChartComponent",{init:function(parentContainer,options,testId){this._super(),this.testId=testId,this.options=$.extend(!0,{},{dock:"center",show:!0,relevantSize:0,showFlag:this.ShowFlags.SPARK,components:{}},options),this.rect=new Rect,this._transitionHelper=new TransitionHelper,this._transitionHelper.setTransitionCurve("easein"),this._oldProperties={},this._currentProperties={},this._transitionProperties={},this._useTransition=!1,this.outerRect=new Rect,this.containerRect=new Rect,this.layoutToContainerRatios={x:1,y:1},this.renderers={},this.dock=this.options.dock,this.show=this.options.show,this.isMini=this.options.isMini,this.relevantSize=this.options.relevantSize,this.showFlag=this.options.showFlag,this.layoutOrder=this.options.order||1,this.reductionOrder=this.options.reductionOrder,this.parentContainer=parentContainer,this.components=this.options.components,this.selectionIdentifier=this.options.label,this._selectionIndices=[0],this.chartFormatter=null,this.measureFormatters=[],this._globalAlpha=1,this._hasValidData=!1,this._createRenderArea();try{var tcl=options&&options.tcl?options.tcl:toSnake(this.constructor.name);tcl&&this._$renderAreaWrap[0].setAttribute("tcl",tcl)}catch(e){}this.chartScale=1,this._edgeBleed={top:0,bottom:0,left:0,right:0}},ShowFlags:{SPARK:1,XSMALL:2,SMALL:4,MEDIUM:8,FULL:16},setData:function(data){return this._data=data,this.invalidateProperties("ChartComponent.setData")},getTransformedShape:function(shape){var s,scaleX=this.layoutToContainerRatios.x||1,scaleY=this.layoutToContainerRatios.y||1;if(shape instanceof Rect)s=new Rect(shape.x*scaleX,shape.y*scaleY,shape.width*scaleX,shape.height*scaleY);else if(shape instanceof Arc){var mv=shape.getModelView(),center={x:shape.cx*scaleX,y:shape.cy*scaleY};mv&&(center=mv.transformPoint(center)),s=new Arc(center.x,center.y,Math.min(scaleX,scaleY)*shape.innerRadius,Math.min(scaleX,scaleY)*shape.radius,shape.start,shape.end,shape.radianOffset)}return s},getTransformedPoint:function(x,y){return{x:x*this.layoutToContainerRatios.x||1,y:y*this.layoutToContainerRatios.y||1}},getOriginalPoint:function(x,y){return{x:x/this.layoutToContainerRatios.x||1,y:y/this.layoutToContainerRatios.y||1}},setLayoutMode:function(l){if(this._layoutMode!==l){this._layoutMode=l;var m=/\s*qv-layout-\S+\s*/g,className=this._layoutMode?" qv-layout-"+layoutMode.getLayoutModeKey(l):"";this.container.className.match(m)?this.container.className=this.container.className.replace(/\s*qv-layout-\S+\s*/g,className):this.container.className+=className,this.invalidateDisplay("ChartComponent.setLayoutMode")}},getLayoutMode:function(){return this._layoutMode},setVerticalLayoutMode:function(l){this._verticalLayoutMode=l},setHorizontalLayoutMode:function(l){this._horizontalLayoutMode=l},setSelectableShapes:function(s){this._selectableShapes=s},getSelectableShapes:function(){return this._selectableShapes||[]},getSelectedCacheItems:function(){var i,num=this._selectableShapes?this._selectableShapes.length:0,selected=[];for(i=0;num>i;i++)this._selectableShapes[i].selected&&selected.push(this._selectableShapes[i]);return selected},getRect:function(){return this.rect},setRect:function(x,y,w,h){this.rect.set(x,y,w,h)},setUseTransition:function(b){this._useTransition=b},getTransitionHelper:function(){return this._transitionHelper},setOuterRect:function(x,y,w,h){this.outerRect.set(x,y,w,h)},setLayoutToContainerRatios:function(x,y){this.layoutToContainerRatios={x:x,y:y}},setContainerRect:function(x,y,w,h){this.containerRect.set(x,y,w,h)},setSelectionIndices:function(v){if(!(v&&v instanceof Array))throw"invalid input, selectionsIndices has to be an Array";this._selectionIndices=v},getSelectionIndices:function(){return this._selectionIndices},setDock:function(dock){switch(dock){case"left":case"top":case"right":case"bottom":case"center":break;default:throw dock+" invalid parameter"}this.options.dock=dock,this.dock=dock},getOppositeDock:function(){var dock=this.options.dock;switch(dock){case"left":return"right";case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"center":return"center";default:throw dock+" invalid parameter"}},isHorizontal:function(){var dock=this.options.dock;switch(dock){case"top":case"bottom":return!0;default:return!1}},isVertical:function(){var dock=this.options.dock;switch(dock){case"left":case"right":return!0;default:return!1}},showComponent:function(){if(this.show=this.options.show,this.renderers)for(var r in this.renderers)this.renderers[r].show()},hideComponent:function(){if(this.show=!1,this.renderers)for(var r in this.renderers)this.renderers[r].hide()},getFormatter:function(){return this._formatter||this.measureFormatters[0]||{format:function(v){return v.toString()}}},isVisible:function(layoutMode){void 0===layoutMode&&(layoutMode=this._layoutMode);var flag=this.showFlag,mode=layoutMode;return"object"==typeof flag&&("whenVertical"in flag&&(flag=this.isVertical()?flag.whenVertical:flag.whenHorizontal),"vertical"in flag)?this.show&&!!(flag.vertical&this._verticalLayoutMode)&&!!(flag.horizontal&this._horizontalLayoutMode):this.show&&!!(flag&mode)},setHasValidData:function(b){this._hasValidData=b},hasValidData:function(){return this._hasValidData},calculateRelevantSize:function(){this.relevantSize=this.options.relevantSize},reduceLayoutRect:function(layoutRect){switch(this.dock){case"top":layoutRect.y+=this.relevantSize,layoutRect.height-=this.relevantSize;break;case"bottom":layoutRect.height-=this.relevantSize;break;case"left":layoutRect.x+=this.relevantSize,layoutRect.width-=this.relevantSize;break;case"right":layoutRect.width-=this.relevantSize}},insertAdjacentTo:function(layoutRect,reduceLayoutRect){switch(this.dock){case"top":this.rect.x=layoutRect.x,this.rect.y=layoutRect.y-this.relevantSize,this.rect.width=layoutRect.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,reduceLayoutRect&&(layoutRect.y-=this.relevantSize,layoutRect.height+=this.relevantSize);break;case"bottom":this.rect.x=layoutRect.x,this.rect.y=layoutRect.getBottom(),this.rect.width=layoutRect.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,reduceLayoutRect&&(layoutRect.height+=this.relevantSize);break;case"left":this.rect.x=layoutRect.x-this.relevantSize,this.rect.y=layoutRect.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=layoutRect.height,reduceLayoutRect&&(layoutRect.x-=this.relevantSize,layoutRect.width+=this.relevantSize);break;case"right":this.rect.x=layoutRect.getRight(),this.rect.y=layoutRect.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=layoutRect.height,reduceLayoutRect&&(layoutRect.width+=this.relevantSize);break;case"center":this.rect.x=layoutRect.x,this.rect.y=layoutRect.y,this.rect.width=layoutRect.width,this.rect.height=layoutRect.height}},_updateProperties:function(){return this._transition()},_updateDisplay:function(){return this.hasValidData()?this.isVisible(this._layoutMode)&&this.rect.width>0&&this.rect.height>0?this.paint(this._layoutMode,this._data):Deferred.resolve():this.clear()},updateSize:function(){updateDimensions.call(this,this._layoutMode);for(var r in this.renderers)this.renderers[r].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[r].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},_transition:function(){this._useTransition?checkEqual(this._currentProperties,this._transitionProperties)?this._onAnimatitonEnd():(this._inTransition=!0,this._transitionHelper.transition(this._oldProperties,this._currentProperties,this._transitionProperties,this._onAnimatitonEnd,this._updateDisplay,this)):($.extend(this._currentProperties,this._transitionProperties),$.extend(this._oldProperties,this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd"))},paint:function(){},setGlobalOpacity:function(x,skipInvalidation){this._globalAlpha=x,skipInvalidation||this.invalidateDisplay("ChartComponent.setGlobalOpacity")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=$(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container))},_onAnimatitonEnd:function(){this._inTransition=!1,this._oldProperties=$.extend(!0,{},this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd")},release:function(){if(this._super(),this.renderers)for(var r in this.renderers)this.renderers[r].release()},clear:function(){var dfds=[];if(this.renderers)for(var r in this.renderers)dfds.push(this.renderers[r].clear());return Deferred.all(dfds)},on:function(){},off:function(){}})}),define("objects.utils/shapes/polygon",["objects.utils/shapes/rect","objects.utils/shapes/line"],function(Rect,Line){"use strict";function calculateBoundsFromPoints(points){var p,i,xMin=Number.MAX_VALUE,xMax=-Number.MAX_VALUE,yMin=Number.MAX_VALUE,yMax=-Number.MAX_VALUE,numPoints=points?points.length:0;if(!numPoints)return null;for(i=0;numPoints>i;i++)p=points[i],xMax=p.x>xMax?p.x:xMax,xMin=p.x<xMin?p.x:xMin,yMax=p.y>yMax?p.y:yMax,yMin=p.y<yMin?p.y:yMin;return new Rect(xMin,yMin,xMax-xMin,yMax-yMin)}function calculatePolygonFeatures(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._closedPolygon?this._numLines=this._numPoints-1:this._numLines=this._numPoints,this._pointsChanged=!0}function Polygon(points){0===arguments.length?this.set([]):this.set(points),this._pointsChanged=!0}return Polygon.prototype={clone:function(){var points=this.points.map(function(point){return point.clone()});return new Polygon(points)},set:function(points){this.points=points,calculatePolygonFeatures.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(point){this.points.push(point),calculatePolygonFeatures.call(this)},pointInside:function(x,y){if(this.calculateBounds(),!this._bounds)return!1;if(x<this._bounds.x||x>this._bounds.x+this._bounds.width||y<this._bounds.y||y>this._bounds.y+this._bounds.height)return!1;var inside,l,j,i,tx;for(inside=!1,i=-1,l=this.points.length,j=l-1;++i<l;j=i){if(this.points[i].x===x&&this.points[i].y===y)return!0;if(this.points[i].y===this.points[j].y&&this.points[i].y===y&&(x-this.points[i].x)*(x-this.points[j].x)<=0)return!0;if(this.points[i].y<y&&y<=this.points[j].y||this.points[j].y<y&&y<=this.points[i].y){if(tx=(this.points[j].x-this.points[i].x)*(y-this.points[i].y)/(this.points[j].y-this.points[i].y)+this.points[i].x,x===tx)return!0;tx>x&&(inside=!inside)}}return inside},intersectsLine:function(line){if(!line)return!1;if(this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2))return!0;var i,num;if(0===this._numPoints)return!1;if(1===this._numPoints)return line.intersectsLine(new Line(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y))?!0:!1;for(num=this._numPoints-1,i=0;num>i;i++)if(line.intersectsLine(new Line(this.points[i].x,this.points[i].y,this.points[i+1].x,this.points[i+1].y)))return!0;return!this._closedPolygon&&line.intersectsLine(new Line(this.points[num].x,this.points[num].y,this.points[0].x,this.points[0].y))?!0:!1},intersectsLines:function(lines){var i,numLines=lines?lines.length:0;for(i=0;numLines>i;i++)if(this.intersectsLine(lines[i]))return!0;return!1},intersectsRect:function(rect){if(!rect)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(rect.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(rect))return!1;var x1,x2,y1,y2,lines;return x1=rect.x,x2=rect.getRight(),y1=rect.y,y2=rect.getBottom(),this.pointInside(x1,y1)||this.pointInside(x2,y1)||this.pointInside(x2,y2)||this.pointInside(x1,y2)?!0:(lines=[new Line(x1,y1,x2,y1),new Line(x1,y2,x2,y2),new Line(x1,y1,x1,y2),new Line(x2,y1,x2,y2)],this.intersectsLines(lines))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=calculateBoundsFromPoints(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var i,s="",num1=this._numPoints-1;for(i=0;num1>i;i++)s+=this.points[i].toString()+",";return s+=this.points[num1].toString()}},Polygon}),define("objects.views/charts/shapes/polygon",["objects.views/charts/shapes/display-object","objects.utils/shapes/polygon","objects.utils/shapes/line"],function(DisplayObject,GeometricalPolygon){"use strict";var Polygon;return Polygon=DisplayObject.extend("Polygon",{init:function(points){this._super(),points?this.set(points):this._polygons=[]},getLocalBoundingRect:function(){var bounds;return this._polygons&&this._polygons.length?(bounds=this._polygons.reduce(function(prev,polygon){return prev.combineWith(polygon.getBoundingRect())},this._polygons[0].getBoundingRect()),{x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height}):void 0},getLocalPoints:function(){return this._polygons&&this._polygons[0]?this._polygons[0].points:[]},set:function(points){var polys=points&&points[0]&&Array.isArray(points[0])?points:[points];this._polygons=polys.map(function(points){return new GeometricalPolygon(points)}),this.invalidateBounds()},intersectsLocalLine:function(line){return this._polygons.some(function(p){return p.intersectsLine(line)})},intersectsLocalRect:function(rect){return this._polygons.some(function(p){return GeometricalPolygon.prototype.intersectsRect.call(p,rect)})},containsPoint:function(x,y){return this._polygons.some(function(p){return p.pointInside(x,y)})}})}),define("objects.views/charts/utils/tree-node",["objects.views/charts/utils/node"],function(Node){"use strict";var TreeNode,indx;return TreeNode=Node.extend("TreeNode",{addChild:function(c){if(!(c&&c instanceof Node))throw new TypeError("Expecting a Node as argument, but got "+c);if(c===this)throw"Can not add itself as child!";if(c._children&&c._children.length&&this.ancestors.indexOf(c)>=0)throw"Can not add an ancestor as child!";return c._parent&&c._parent!==this&&c._parent.removeChild(c),indx=this._children.indexOf(c),indx>=0&&this._children.splice(indx,1),this._children.push(c),c._parent=this,c._ancestors=null,this},addChildren:function(children){var i,num=children?children.length:0;for(i=0;num>i;i++)this.addChild(children[i]);return this},removeChild:function(c){return indx=this._children.indexOf(c),indx>=0&&(this._children.splice(indx,1),c._parent=null,c._ancestors=null),this},removeChildren:function(children){var i,num;if(!this._children)return this;if(children)for(num=children.length,i=0;num>i;i++)this.removeChild(children[i]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}})}),define("objects.views/charts/shapes/container",["objects.views/charts/shapes/display-object","objects.views/charts/utils/tree-node"],function(DisplayObject,TreeNode){"use strict";var Container,UNDEF;return Container=DisplayObject.extend("Container",{init:function(){this._super()},addChild:function(c){TreeNode.prototype.addChild.call(this,c),this.doInvalidate&&c.invalidate()},addChildren:TreeNode.prototype.addChildren,removeChild:function(c){this.doInvalidate&&c.invalidate(),c._stage=null;var i,desc=c.descendants,num=desc?desc.length:0;for(i=0;num>i;i++)desc[i]._stage=null;return TreeNode.prototype.removeChild.call(this,c),this},removeChildren:function(children){var i,j,num,desc,numDesc;if(!this._children)return this;if(children)for(num=children.length,i=0;num>i;i++)this.removeChild(children[i]);else{for(num=this._children.length,i=0;num>i;i++)for(this._children[i]._parent=null,this._children[i]._ancestors=null,this._children[i]._stage=null,desc=this._children[i].descendants,numDesc=desc?desc.length:0,j=0;numDesc>j;j++)desc[j]._stage=null;this._children.length=0}return this},containsPoint:function(x,y){if(this._children&&this._children.length)for(var i=0,len=this._children.length;len>i;i++)if(this._children[i].containsPoint(x,y))return!0;return!1},intersectsLocalRect:function(r){if(this._children&&this._children.length)for(var i=0,len=this._children.length;len>i;i++)if(this._children[i].intersectsLocalRect(r))return!0;return!1},intersectsLocalLine:function(line){if(this._children&&this._children.length)for(var i=0,len=this._children.length;len>i;i++)if(this._children[i].intersectsLocalLine(line))return!0;return!1},getLocalPoints:function(){var p=[];if(this._children&&this._children.length)for(var i=0,len=this._children.length;len>i;i++)p=p.concat(this._children[i].getLocalPoints());return p},getLocalBoundingRect:function(){var minX,minY,maxX,maxY,b,i,len,initiated=!1;if(this._children&&this._children.length){for(i=0,len=this._children.length;len>i;i++)b=this._children[i].getVisualBounds(),b&&!isNaN(b.width+b.height+b.x+b.y)&&(initiated?(minX=Math.min(minX,b.x),maxX=Math.max(maxX,b.x+b.width),minY=Math.min(minY,b.y),maxY=Math.max(maxY,b.y+b.height)):(minX=b.x,maxX=b.x+b.width,minY=b.y,maxY=b.y+b.height,initiated=!0));return initiated?{x:minX,y:minY,width:maxX-minX,height:maxY-minY}:UNDEF}return UNDEF},_calculateBounds:function(){var b=this._bounds,o=this.getLocalBoundingRect(),s=0;o?(b.set(o.x,o.y,o.width,o.height),this._vmBounds.set(o.x,o.y,o.width,o.height),this._visualBounds.set(o.x-s,o.y-s,o.width+2*s,o.height+2*s)):(b.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1}})}),define("objects.views/charts/renderers/stage",["objects.views/charts/shapes/container","objects.utils/shapes/rect","core.utils/notification"],function(Container,Rect,Notification){var Stage;return Stage=Container.extend("Stage",{init:function(){this._super(),this._stage=this,this._dimensions=new Rect(0,0,0,0),Notification.create(this,"Invalid")},invalidateObject:function(displayObject){return this.Invalid.emit(displayObject),this},destroy:function(){this._super(),Notification.release(this)}})}),define("objects.views/charts/renderers/renderer",["core.utils/class","objects.views/charts/renderers/stage","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(Class,Stage,Rect,nodeSelector){"use strict";var Renderer;return Renderer=Class.extend("Renderer",{init:function(){this._stage=new Stage,this._stageBinding=function(obj){this.invalidateObject(obj)}.bind(this),this._stage.Invalid.bind(this._stageBinding),this.scaling={x:1,y:1},this._size=new Rect,this._extendedSize=new Rect},find:function(s){return nodeSelector.find(s,this._stage)},setDimensions:function(x,y,w,h){this._size.set(x,y,w,h)},setDimensionsToContainerRatio:function(x,y){this.scaling={x:x,y:y}},release:function(){this._stage&&this._stage.Invalid&&this._stage.Invalid.unbind(this._stageBinding),this._stage.destroy(),this._stageBinding=null},render:function(){},clear:function(){},invalidateObject:function(){}}),Object.defineProperties(Renderer.prototype,{stage:{get:function(){return this._stage}}}),Renderer}),define("objects.views/charts/shapes/rect",["objects.views/charts/shapes/display-object","objects.utils/shapes/rect"],function(DisplayObject,GeometricalRect){"use strict";var Rect;return Rect=DisplayObject.extend("Rect",{init:function(x,y,w,h,r){this._super(),this._radius=r||0,GeometricalRect.apply(this,[x,y,w,h])},containsPoint:GeometricalRect.prototype.pointInside,intersectsLocalLine:GeometricalRect.prototype.intersectsLine,
intersectsLocalRect:GeometricalRect.prototype.intersectsRect,getLocalBoundingRect:GeometricalRect.prototype.getBoundingRect,getLocalPoints:GeometricalRect.prototype.getPoints,set:function(x,y,w,h,r){GeometricalRect.prototype.set.apply(this,[x,y,w,h]),r>=0&&(this._radius=r),this.invalidateBounds()}}),Object.keys(GeometricalRect.prototype).forEach(function(key){!Rect.prototype.hasOwnProperty(key)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(key)<0&&(Rect.prototype[key]=GeometricalRect.prototype[key])}),Rect}),define("objects.views/charts/renderers/canvas/rect",["objects.views/charts/shapes/rect"],function(Rect){"use strict";return{displayObject:Rect,render:function(g,fill,stroke){if(this._radius){var x=this.x,y=this.y,w=this.width,h=this.height,r=Math.min(this._radius,w/2,h/2),right=x+w,bottom=y+h;g.beginPath(),g.moveTo(x+r,y),g.quadraticCurveTo(x,y,x,y+r),g.lineTo(x,bottom-r),g.quadraticCurveTo(x,bottom,x+r,bottom),g.lineTo(right-r,bottom),g.quadraticCurveTo(right,bottom,right,bottom-r),g.lineTo(right,y+r),g.quadraticCurveTo(right,y,right-r,y),g.lineTo(x+r,y),g.closePath(),fill&&g.fill(),stroke&&g.stroke()}else fill&&g.fillRect(this.x,this.y,this.width,this.height),stroke&&g.strokeRect(this.x,this.y,this.width,this.height)}}}),define("objects.views/charts/shapes/circle",["objects.views/charts/shapes/display-object","objects.utils/shapes/circle"],function(DisplayObject,GeometricalCircle){"use strict";var Circle;return Circle=DisplayObject.extend("Circle",{init:function(x,y,r){this._super(),GeometricalCircle.apply(this,[x,y,r])},containsPoint:GeometricalCircle.prototype.pointInside,intersectsLocalLine:GeometricalCircle.prototype.intersectsLine,intersectsLocalRect:GeometricalCircle.prototype.intersectsRect,getLocalPoints:GeometricalCircle.prototype.getPoints,getLocalBoundingRect:function(){return{x:this.cx-this.r,y:this.cy-this.r,width:2*this.r,height:2*this.r}},set:function(){GeometricalCircle.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(GeometricalCircle.prototype).forEach(function(key){!Circle.prototype.hasOwnProperty(key)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(key)<0&&(Circle.prototype[key]=GeometricalCircle.prototype[key])}),Circle}),define("objects.views/charts/renderers/canvas/circle",["objects.views/charts/shapes/circle"],function(Circle){"use strict";return{displayObject:Circle,render:function(g,fill,stroke){g.beginPath(),g.moveTo(this.cx+this.r,this.cy),g.arc(this.cx,this.cy,this.r,0,2*Math.PI,!1),fill&&g.fill(),stroke&&g.stroke()}}}),define("objects.views/charts/shapes/line",["objects.views/charts/shapes/display-object","objects.utils/shapes/line"],function(DisplayObject,GeometricalLine){"use strict";var Line;return Line=DisplayObject.extend("Line",{init:function(x1,y1,x2,y2){this._super(),GeometricalLine.apply(this,[x1,y1,x2,y2])},containsPoint:function(){return!1},intersectsLocalLine:GeometricalLine.prototype.intersectsLine,intersectsLocalRect:GeometricalLine.prototype.intersectsRect,getLocalPoints:GeometricalLine.prototype.getPoints,getLocalBoundingRect:function(){var left=Math.min(this.x1,this.x2),right=Math.max(this.x1,this.x2),top=Math.min(this.y1,this.y2),bottom=Math.max(this.y1,this.y2);return{x:left,y:top,width:right-left,height:bottom-top}},set:function(){GeometricalLine.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(GeometricalLine.prototype).forEach(function(key){!GeometricalLine.prototype.hasOwnProperty(key)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(key)<0&&(Line.prototype[key]=GeometricalLine.prototype[key])}),Line}),define("objects.views/charts/renderers/canvas/line",["objects.views/charts/shapes/line"],function(Line){"use strict";return{displayObject:Line,render:function(g,fill,stroke){stroke&&(g.beginPath(),g.moveTo(this.x1,this.y1),g.lineTo(this.x2,this.y2),g.stroke())}}}),define("objects.views/charts/renderers/canvas/polygon",["objects.views/charts/shapes/polygon"],function(Polygon){"use strict";return{displayObject:Polygon,render:function(g,fill,stroke){var points,num,p,i,n,start;for(g.beginPath(),n=0;n<this._polygons.length;n++){if(points=this._polygons[n].points,num=points?points.length:0,p=points[0],!p)return;for(start=p,g.moveTo(p.x,p.y),i=1;num>i;i+=1)p=points[i],g.lineTo(p.x,p.y);this.close===!1||!stroke||start.x===p.x&&start.y===p.y||g.lineTo(start.x,start.y)}this.close!==!1&&g.closePath(),fill&&g.fill(),stroke&&g.stroke()}}}),define("objects.views/charts/renderers/canvas/arc",["objects.views/charts/shapes/arc"],function(Arc){"use strict";return{displayObject:Arc,render:function(g,fill,stroke){g.beginPath(),0===this.innerRadius?(g.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),g.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy)):this.end-this.start===2*Math.PI?(g.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),g.moveTo(this.cx+this.innerRadius*Math.cos(this.radianOffset+this.start),this.cy+this.innerRadius*Math.sin(this.radianOffset+this.start)),g.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0)):(g.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),g.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy),g.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0),g.lineTo(this.radius*Math.cos(this.start+this.radianOffset)+this.cx,this.radius*Math.sin(this.start+this.radianOffset)+this.cy)),fill&&g.fill(),stroke&&(g.closePath(),g.stroke())}}}),define("objects.views/charts/shapes/text-helper",[],function(){function lineWrap(text,width,font,maxNumLines){var n,r,testLine,testWidth,remainder,textLine,textLines=text?text.split(/\n+|\r+|\r\n/):[],lines=[],words=text?text.split(/\s+/):[],line=textLines[0];if("number"!=typeof width||0>=width)return[text];if("number"==typeof maxNumLines&&textLines.length>=maxNumLines)return textLines.slice(0,maxNumLines);for(font&&(dummyContext.font=font),r=0;r<textLines.length;r++){for(textLine=textLines[r]||"",words=textLine.split(/\s+/),line=words[0],remainder="",n=1;n<words.length;n++)if(testLine=line+" "+words[n],testWidth=dummyContext.measureText(testLine).width,testWidth>width&&("number"!=typeof maxNumLines||maxNumLines>lines.length)?(lines.push(line),line=words[n]):line=testLine,"number"==typeof maxNumLines&&lines.length>=maxNumLines){remainder=words.slice(n+1).join(" ");break}"number"!=typeof maxNumLines||lines.length<maxNumLines?lines.push(line):lines[Math.max(0,lines.length-1)]=(lines[Math.max(0,lines.length-1)]||"")+" "+line+" "+remainder}return lines}function wordWrap(lines,width,font,maxNumLines){if(!lines||!lines.length)return[];font&&(dummyContext.font=font);var exploded,remainder,line,i,result=[],cLines=lines.slice();if(cLines.filter(function(s){return!!s}),"number"!=typeof width||0>width)return lines.slice();for(i=0;i<cLines.length;i++)line=cLines[i],remainder=null,line&&(line.length<=1||dummyContext.measureText(line).width<=width?result.push(line):(exploded=splitWord(line,width,void 0,maxNumLines-result.length),exploded.length<=1?result.push(exploded[0]):(remainder=exploded.pop(),result=result.concat(exploded),cLines[i+1]?cLines[i+1]=remainder+cLines[i+1]:cLines.push(remainder))));return result.forEach(function(s,i,arr){arr[i]=s?s.trim():s}),result.length>maxNumLines?(result=result.splice(0,maxNumLines),result[result.length-1]=truncate(result[result.length-1],width).text):(line=result[result.length-1],line&&line.length>1&&dummyContext.measureText(line).width>width&&(result[result.length-1]=truncate(line,width).text)),result}function truncate(text,width,font){var i,temp,tempEllipsis,rest,s=text,minCharWidth=dummyContext.measureText("i").width,maxNumLetters=Math.ceil(width/minCharWidth);if(font&&(dummyContext.font=font),text&&width){if(dummyContext.measureText(s).width>width){for(i=Math.min(maxNumLetters,s.length);i>0;i--)if(temp=s.substring(0,i-1),tempEllipsis=temp.trim()+ellipsis,dummyContext.measureText(tempEllipsis).width<=width){rest=s.substring(i-1),s=tempEllipsis;break}i||(rest=s,s=ellipsis)}}else rest=void 0;return{text:s,rest:rest}}function isNumber(v){return"number"==typeof v&&isFinite(v)}function explodeWord(text,width,maxNumLines,charWidth){var i,left=text,right="",result=[];if(isNumber(maxNumLines)&&1>=maxNumLines)return[text];var maxNumChars=Math.ceil(width/charWidth),num=Math.min(text.length,maxNumChars);for(i=num;i>0&&(left=text.substring(0,i),right=text.substring(i),!(dummyContext.measureText(left).width<=width));i--);return i||left||(left=text.substring(0,1),right=text.substring(1)),result.push(left),right?(dummyContext.measureText(right).width>width?(right=explodeWord(right,width,maxNumLines-1,charWidth),result=result.concat(right)):result.push(right),result):result}function splitWord(text,width,font,maxNumLines){return text&&width?(font&&(dummyContext.font=font),explodeWord(text,width,maxNumLines,Math.max(1,dummyContext.measureText("i").width))):[]}function wrapText(text,maxWidth,font,maxNumLines){var lines;return isNaN(maxWidth)?[text]:(lines=maxNumLines>1?lineWrap(text,maxWidth,font,maxNumLines):[text],lines=wordWrap(lines,maxWidth,font,maxNumLines))}var dummyContext=document.createElement("canvas").getContext("2d"),ellipsis="…";return{lineWrap:lineWrap,wordWrap:wordWrap,splitWord:splitWord,wrap:wrapText,truncate:truncate}}),define("objects.views/charts/shapes/text",["objects.views/charts/shapes/display-object","objects.views/charts/shapes/text-helper","objects.utils/shapes/line"],function(DisplayObject,textHelper,Line){"use strict";function getFontHeight(g){return 1.5*g.measureText("m").width}function tokenize(text){dummyContext.font=this.font;var maxAllowedLines,fontHeight=getFontHeight(dummyContext),lineHeight=(this.lineHeightMultiplicator||1)*fontHeight,maxWidth="maxWidth"in this?this.maxWidth:this.width,maxHeight="maxHeight"in this?this.maxHeight:this.height,maxNumLines=this.maxNumLines,maxLines=[],totalMaxNumLines=0,lines=[];return this.lineHeight=lineHeight,fontHeight>maxHeight?[]:(maxAllowedLines=maxHeight?Math.max(1,Math.floor(maxHeight/lineHeight)):1,Array.isArray(maxNumLines)?(maxNumLines.forEach(function(v){totalMaxNumLines+=isNaN(v)||0>=v?0:v}),maxNumLines.forEach(function(v){maxLines.push(isNaN(v)||0>=v?maxAllowedLines-totalMaxNumLines:v)})):maxLines=[isNaN(maxNumLines)||0>=maxNumLines?maxAllowedLines:Math.min(maxAllowedLines,maxNumLines)],Array.isArray(text)?text.forEach(function(s,i){lines.length<maxAllowedLines&&(lines=lines.concat(textHelper.wrap(s,maxWidth,this.font,maxLines[i])))},this):(isNaN(maxNumLines)&&(maxNumLines=maxHeight?Math.max(1,Math.floor(maxHeight/lineHeight)):1),lines=textHelper.wrap(text,maxWidth,this.font,maxLines[0])),lines)}var Text,dummyContext=document.createElement("canvas").getContext("2d");return Text=DisplayObject.extend("Text",{init:function(){this._super(),this.options={},this.x=0,this.y=0,this.lineHeightMultiplicator=1,this._dirtyMeasures=!0,this._measures={numLines:0,width:0,height:0}},setText:function(s){return this.text=s,this.invalidateBounds(),this},tokenize:function(){return this.lines=tokenize.apply(this,[this.text]),this},measure:function(){if(this.preRender(),this._dirtyMeasures){var i,width=0,lines=this.lines;for(dummyContext.font!==this.font&&(dummyContext.font=this.font),i=0;i<lines.length;i++)width=Math.max(width,dummyContext.measureText(lines[i]).width);this._measures.numLines=lines.length,this._measures.width=width,this._measures.height=lines.length*this.lineHeight,this._dirtyMeasures=!1}return{numLines:this._measures.numLines,width:this._measures.width,height:this._measures.height}},getHorizontalAnchor:function(){var align,x=this.x||0;if(this.width>0){if(align=this.attr("align"),"center"===align)return x+this.width/2;if("right"===align)return x+this.width}return x},getVerticalAnchor:function(){var lineHeight,y=this.y||0,baseline=this.attr("baseline");return"middle"===baseline?(lineHeight=this.attr("lineHeight"),y-=(this.lines.length-1)*lineHeight/2,this.height>0&&(y+=this.height/2)):"bottom"===baseline&&(lineHeight=this.attr("lineHeight"),y-=(this.lines.length-1)*lineHeight,this.height>0&&(y+=this.height)),y},preRender:function(){var f,t="";Array.isArray(this.text)?this.text.forEach(function(s){t+=s+"__"}):t=this.text,f=this.attr("font"),this.font=f;var currentID=t+f+this.maxWidth;return currentID!==this._renderedID&&(this.tokenize(),this.invalidateBounds(),this._dirtyMeasures=!0,this._renderedID=currentID),this},getLocalBoundingRect:function(){var m=this.measure(),x=this.getHorizontalAnchor(),y=this.getVerticalAnchor(),align=this.attr("align")||"left",baseline=this.attr("baseline")||"top";return"middle"===baseline?y-=m.height/2:"bottom"===baseline&&(y-=m.height),"center"===align?x-=m.width/2:"right"===align&&(x-=m.width),{x:x,y:y,width:m.width,height:m.height}},containsPoint:function(x,y){var bounds=this.getLocalBoundingRect();return x>bounds.x&&x<bounds.x+bounds.width&&y>bounds.y&&y<bounds.y+bounds.height},getLocalPoints:function(){var b=this.getLocalBoundingRect();return[{x:b.x,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x+b.width,y:b.y+b.height},{x:b.x,y:b.y+b.height}]},intersectsLocalRect:function(rect){if(!rect)return!1;var b=this.getLocalBoundingRect();return b.x<=rect.x+rect.width&&rect.x<=b.x+b.width&&b.y<=rect.y+rect.height&&rect.y<=b.y+b.height},intersectsLocalLine:function(line){if(this.containsPoint(line.x1,line.y1)||this.containsPoint(line.x2,line.y2))return!0;var b=this.getLocalBoundingRect();return line.intersectsLine(new Line(b.x,b.y,b.x+b.width,b.y))||line.intersectsLine(new Line(b.x+b.width,b.y,b.x+b.width,b.y+b.height))||line.intersectsLine(new Line(b.x+b.width,b.y+b.height,b.x,b.y+b.height))||line.intersectsLine(new Line(b.x,b.y+b.height,b.x,b.y))}})}),define("objects.views/charts/renderers/canvas/text",["objects.views/charts/shapes/text"],function(Text){"use strict";return{displayObject:Text,render:function(g,fill,stroke){var i,x=this.x||0,y=this.y||0,lines=this.lines||[],num=lines.length,toRender=[],lineHeight=this.lineHeight;if(x=this.getHorizontalAnchor(),y=this.getVerticalAnchor(),fill&&toRender.push("fillText"),stroke&&(this.strokeFirst?toRender.unshift("strokeText"):toRender.push("strokeText")),toRender.length)for(i=0;num>i;i++)g[toRender[0]](lines[i],x,y),toRender[1]&&g[toRender[1]](lines[i],x,y),y+=lineHeight}}}),define("objects.views/charts/renderers/canvas-renderer",["jquery","core.utils/deferred","objects.views/charts/renderers/renderer","objects.views/charts/utils/matrix","objects.utils/animation-frame","objects.utils/shapes/rect","objects.views/charts/renderers/canvas/rect","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/line","objects.views/charts/renderers/canvas/polygon","objects.views/charts/renderers/canvas/arc","objects.views/charts/renderers/canvas/text"],function($,Deferred,Renderer,Matrix,aF,Rect){"use strict";function cacheFontHeight(font,height){fontCacheArr.length>100&&delete fontCacheObj[fontCacheArr.shift()],fontCacheArr.push(font),fontCacheObj[font]=height}function createDfd(){var dfdObj={dfd:Deferred(),state:DFD_STATE.PENDING},promise=dfdObj.dfd.promise;return promise.then(function(){dfdObj.state=DFD_STATE.RESOLVED},function(){dfdObj.state=DFD_STATE.REJECTED}),dfdObj}var CanvasRenderer,renderFnCounter=1,renderObjects=[].slice.call(arguments,6),displayObjectToRenderObjectMapping={},numRenderObjects=renderObjects.length,dummyCanvas=document.createElement("canvas"),dummyContext=dummyCanvas.getContext("2d"),contextAttributes=["fill","stroke","strokeWidth","opacity","font","align","baseline","lineJoin","lineCap"],contextAttributesRegex=new RegExp(contextAttributes.join("|")),numContextAttributes=contextAttributes.length,objectToContextPropertyMapping={fill:"fillStyle",stroke:"strokeStyle",strokeWidth:"lineWidth",opacity:"globalAlpha",align:"textAlign",baseline:"textBaseline"},DFD_STATE={PENDING:0,RESOLVED:1,REJECTED:2},fontCacheObj={},fontCacheArr=[],num=0;return CanvasRenderer=Renderer.extend("CanvasRenderer",{init:function(container,options){this._super(),this._id=++num,this._canvas=document.createElement("canvas"),this._canvas.width=this._size.width,this._canvas.height=this._size.height,this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._bufferCanvas=document.createElement("canvas"),this._bufferCanvas.width=this._canvas.width,this._bufferCanvas.height=this._canvas.height,this._mvMatrix=new Matrix,this._wrapper=document.createElement("div"),this._wrapper.style.position="relative",this._wrapper.style.left="0",this._wrapper.style.top="0",this._wrapper.appendChild(this._canvas),options&&options.name&&$(this._wrapper).attr({tid:options.name}),$(this._wrapper).attr({tcl:"renderer"}).data("_renderer",this),this.container=container,this.container.appendChild(this._wrapper),this._isCompositingEnabled=!0,this._invalidObjects=[],this._t={x:0,y:0,dx:0,dy:0,scale:1}},setDimensions:function(x,y,w,h){this._super(x,y,w,h),this._wrapper.style.left=x+"px",this._wrapper.style.top=y+"px"},setCompositingEnabled:function(v){this._isCompositingEnabled=v},getCompositingEnabled:function(){return this._isCompositingEnabled},render:function(schedule){return this._rendering?void 0:(this._resetImage(),this._renderDfdObj&&this._renderDfdObj.state===DFD_STATE.PENDING||(this._renderDfdObj=createDfd()),schedule?this._invalidate(!0,!1):(this._doClear=!1,this._doRender=!0,this._validate()),this._renderDfdObj.dfd.promise)},clear:function(schedule){this._rendering||(schedule?this._invalidate(!1,!0):(this._doRender=!1,this._doClear=!0,this._validate()))},release:function(){this._super(),this._clearSchedule(),$(this._wrapper).removeData(),this._bufferCanvas=null,this._canvas=null,this.container&&(this.container.removeChild(this._wrapper),this.container=null)},invalidateObject:function(o){this._isCompositingEnabled&&this._invalidObjects.indexOf(o)<0&&this._invalidObjects.push(o),this.render(!0)},translateScene:function(dx,dy){return this._t.dx+=dx,this._t.dy+=dy,this._t.x+=dx,this._t.y+=dy,this._t.scale=null,this._invalidate(!0,!1),this},scaleScene:function(x,y,scale){return this._t.scale={x:x,y:y,scale:scale},this._invalidate(!0,!1),this},setAttribute:function(attributeName,attribute){var prop;for(prop in attribute)attribute.hasOwnProperty(prop)&&(this._wrapper[attributeName][prop]=attribute[prop])},getTextWidth:function(text,font){return CanvasRenderer.getTextWidth(text,font,this._canvas.getContext("2d"))},getFontHeight:function(font){return CanvasRenderer.getFontHeight(font,this._canvas.getContext("2d"))},_render:function(){if(this._canvas){this._rendering=!0;var c=this._canvas,g=c.getContext("2d"),m=this._mvMatrix,invalidViews=[],patchImage=this._isCompositingEnabled&&(0!==this._t.dx||0!==this._t.dy||this._t.scale&&void 0!==this._t.scale.scale&&1!==this._t.scale.scale),dpiScale=CanvasRenderer.getDevicePixelToBackingStoreRatio();if(patchImage&&this._storeImage(),this._updateSize()||(this._isCompositingEnabled&&(invalidViews=this._getInvalidViews().filter(function(rect){return!rect.hasNaN()}),invalidViews.length&&patchImage?invalidViews=[]:patchImage&&(g.clearRect(0,0,c.width,c.height),invalidViews=invalidViews.concat(this._getInvalidImageParts()).filter(function(rect){return!rect.hasNaN()}))),invalidViews.length||g.clearRect(0,0,c.width,c.height)),g.save(),m.save(),this.stage.matrix&&this.stage.matrix.identity(),this.stage.scale(this.scaling.x,this.scaling.y),this.stage.translate(-this._extendedSize.x,-this._extendedSize.y),this.stage.translate(this._t.x,this._t.y),g.setTransform(dpiScale,0,0,dpiScale,0,0),invalidViews.length&&(patchImage&&(g.save(),g.setTransform(1,0,0,1,0,0),this._patchImage(),this._t.dx=0,this._t.dy=0,g.restore()),g.beginPath(),invalidViews.forEach(function(view){g.rect(view.x,view.y,view.width,view.height)}),g.clip(),g.clearRect(0,0,this._extendedSize.width,this._extendedSize.height)),!invalidViews.length){var scaleExt=new Rect(0,0,this.scaling.x*this._extendedSize.width,this.scaling.y*this._extendedSize.height);invalidViews.push(scaleExt)}CanvasRenderer._updateTransforms([this.stage],m,{}),CanvasRenderer._renderDisplayObjects(g,[this.stage],this._isCompositingEnabled?invalidViews:!1,dpiScale),m.restore(),g.restore(),this._invalidObjects=[],this._rendering=!1}},_updateSize:function(){var physicalW,physicalH,scaledSize,c=this._canvas,physicalToLogicalRatio=CanvasRenderer.getDevicePixelToBackingStoreRatio(),s=this._extendedSize;return this.edgeBleed?s.set(-this.edgeBleed.left,-this.edgeBleed.top,this._size.width+this.edgeBleed.left+this.edgeBleed.right,this._size.height+this.edgeBleed.top+this.edgeBleed.bottom):s.set(this._size.x,this._size.y,this._size.width,this._size.height),scaledSize=new Rect(Math.round(s.x*this.scaling.x),Math.round(s.y*this.scaling.y),Math.round(s.width*this.scaling.x),Math.round(s.height*this.scaling.y)),physicalW=Math.round(physicalToLogicalRatio*scaledSize.width),physicalH=Math.round(physicalToLogicalRatio*scaledSize.height),this._canvas.style.left=scaledSize.x+"px",this._canvas.style.top=scaledSize.y+"px",c.width!==physicalW||c.height!==physicalH?(c.width=physicalW,c.height=physicalH,c.style.width=scaledSize.width+"px",c.style.height=scaledSize.height+"px",this._bufferCanvas.width=physicalW,this._bufferCanvas.height=physicalH,!0):!1},_invalidate:function(doRender,doClear){if(this._doRender=doRender||this._doRender,this._doClear=doClear||this._doClear,!this._invalidated){var self=this;this._invalidated=!0,this._timer=aF.request(function(){self._validate()},this._canvas)}},_validate:function(){this._doClear&&!this._doRender?this._clear():this._doRender&&this._render(),this._renderDfdObj&&this._renderDfdObj.state===DFD_STATE.PENDING&&this._renderDfdObj.dfd.resolve(),this._clearSchedule()},_clear:function(){this._canvas&&(this._canvas.width=this._canvas.width)},_clearSchedule:function(){this._timer&&(aF.cancel(this._timer),this._timer=null),this._renderDfdObj&&this._renderDfdObj.state===DFD_STATE.PENDING&&this._renderDfdObj.dfd.reject(),this._doRender=!1,this._doClear=!1,this._invalidated=!1},_getInvalidViews:function(){var i,b,ob,minX,minY,maxX,maxY,ominX,ominY,omaxX,omaxY,num=this._invalidObjects?this._invalidObjects.length:0,r=new Rect,initiatedCurrent=!1,initiatedPrevious=!1,oldView=new Rect;for(i=0;num>i;i++)b=this._invalidObjects[i].getVisualBounds(),ob=this._invalidObjects[i].rData.oldVisualBounds,!initiatedCurrent&&b?(minX=b.x,maxX=b.x+b.width,minY=b.y,maxY=b.y+b.height,initiatedCurrent=!0):b&&(minX=Math.min(minX,b.x),maxX=Math.max(maxX,b.x+b.width),minY=Math.min(minY,b.y),maxY=Math.max(maxY,b.y+b.height)),!initiatedPrevious&&ob?(ominX=ob.x,omaxX=ob.x+ob.width,ominY=ob.y,omaxY=ob.y+ob.height,initiatedPrevious=!0):ob&&(ominX=Math.min(ominX,ob.x),omaxX=Math.max(omaxX,ob.x+ob.width),ominY=Math.min(ominY,ob.y),omaxY=Math.max(omaxY,ob.y+ob.height));return r.set(Math.floor(minX)-1,Math.floor(minY)-1,Math.ceil(maxX-minX)+2,Math.ceil(maxY-minY)+2),oldView.set(Math.floor(ominX)-1,Math.floor(ominY)-1,Math.ceil(omaxX-ominX)+2,Math.ceil(omaxY-ominY)+2),r.x!==oldView.x||r.y!==oldView.y||r.width!==oldView.width||r.height!==oldView.height?[r,oldView]:[r]},_getInvalidImageParts:function(){var views=[];return this._t.scale&&this._t.scale.scale>1?views.push(new Rect(0,0,0,0)):this._t.scale&&this._t.scale.scale<1&&views.push(new Rect(0,0,0,0)),0!==this._t.dx&&this._size.width>Math.abs(this._t.dx)&&views.push(new Rect(this._t.dx>0?0:this._size.width+this._t.dx,0,Math.abs(this._t.dx),this._size.height)),0!==this._t.dy&&this._size.height>Math.abs(this._t.dy)&&views.push(new Rect(0,this._t.dy>0?0:this._size.height+this._t.dy,this._size.width,Math.abs(this._t.dy))),views},_storeImage:function(){var g=this._bufferCanvas.getContext("2d");g.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),g.drawImage(this._canvas,0,0)},_patchImage:function(){var dx=this._t.dx,dy=this._t.dy,pixelRatio=CanvasRenderer.getDevicePixelToBackingStoreRatio();if(this._t.scale&&this._t.scale.scale){var dWidth,dHeight,sx,sy,sWidth,sHeight,canvasWidth=this._canvas.width,canvasHeight=this._canvas.height,offset={left:this._t.scale.x/this._size.width,top:this._t.scale.y/this._size.height};this._t.scale.scale>1?(dWidth=this._size.width,dHeight=this._size.height,sWidth=Math.min(this._size.width/this._t.scale.scale,canvasWidth),sHeight=Math.min(this._size.height/this._t.scale.scale,canvasHeight),sx=Math.max(this._t.scale.x-offset.left*sWidth,0),sy=Math.max(this._t.scale.y-offset.top*sHeight,0)):(sx=0,sy=0,sWidth=Math.min(this._size.width,canvasWidth),sHeight=Math.min(this._size.height,canvasHeight),dWidth=this._size.width*this._t.scale.scale,dHeight=this._size.height*this._t.scale.scale,dx=Math.max(this._t.scale.x-offset.left*dWidth,0),dy=Math.max(this._t.scale.y-offset.top*dHeight,0)),this._canvas.getContext("2d").drawImage(this._bufferCanvas,sx*pixelRatio,sy*pixelRatio,sWidth*pixelRatio,sHeight*pixelRatio,dx*pixelRatio,dy*pixelRatio,dWidth*pixelRatio,dHeight*pixelRatio)}else this._canvas.getContext("2d").drawImage(this._bufferCanvas,dx*pixelRatio,dy*pixelRatio)},_resetImage:function(){this._t.dx=0,this._t.dy=0,this._t.x=0,this._t.y=0,this._t.scale=1}}),CanvasRenderer.getFontHeightOfContext=function(g){return 1.5*g.measureText("m").width},CanvasRenderer.getFontHeight=function(font,g){if("string"!=typeof font)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(font in fontCacheObj)return fontCacheObj[font];var height;return g=g||dummyContext,g.font!==font?(g.save(),g.font=font,height=1.5*g.measureText("m").width,g.restore()):height=1.5*g.measureText("m").width,cacheFontHeight(font,height),height},CanvasRenderer.getTextWidth=function(text,font,g){var width;return g=g||dummyContext,g.save(),g.font=font,width=void 0!==text?Math.ceil(g.measureText(text).width):0,g.restore(),width},CanvasRenderer.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1)},CanvasRenderer.measureText=function(text,font,g){var h,w,metrics;return g=g||dummyContext,font&&g.font!==font&&(g.save(),g.font=font),w=g.measureText(text).width,font in fontCacheObj?h=fontCacheObj[font]:(h=1.5*g.measureText("m").width,cacheFontHeight(font,h)),font&&g.restore(),metrics=void 0!==text?{width:w,height:h}:{width:0,height:0}},CanvasRenderer._renderDisplayObjects=function(g,objects,views,dpiScale){var i,num,o,renderFn,j,hasChildren,numViews=views?views.length:0,zLayers=[],inView=!0,deferred=[];for(num=objects?objects.length:0,i=0;num>i;i++)if(o=objects[i],o.visible!==!1&&o.data.isVisible!==!1){if(numViews){for(inView=!1,j=0;numViews>j;j++)if(views[j].intersectsWith(o.getVisualBounds())){inView=!0;break}if(!inView)continue}renderFn=CanvasRenderer._getRenderFn(objects[i]),hasChildren=o.children.length>0,("function"==typeof renderFn||hasChildren)&&(o.zIndex>0?(zLayers[o.zIndex]||(zLayers[o.zIndex]={index:o.zIndex,objects:[]}),zLayers[o.zIndex].objects.push({object:o,renderFn:renderFn,hasChildren:hasChildren})):CanvasRenderer._renderObject(g,o,renderFn,hasChildren,views,dpiScale))}for(zLayers=zLayers.filter(function(a){return a&&a.objects.length}).sort(function(a,b){return a.index-b.index}),i=0;i<zLayers.length;i++)for(deferred=zLayers[i].objects,num=deferred.length,j=0;num>j;j++)CanvasRenderer._renderObject(g,deferred[j].object,deferred[j].renderFn,deferred[j].hasChildren,views,dpiScale)},CanvasRenderer._renderObject=function(g,o,renderFn,hasChildren,view,dpiScale){var mt,strokeWidth,doFill,doStroke,vr;"function"==typeof renderFn&&(strokeWidth=o.attr("strokeWidth"),"undefined"==typeof strokeWidth&&(strokeWidth=1),doFill=!!o.attr("fill"),doStroke=!!o.attr("stroke")&&strokeWidth>0),g.save(),o.rData.stroke=doStroke,o.rData.strokeWidth=strokeWidth,view&&(vr=o.getVisualBounds(),o.rData.oldVisualBounds={x:vr.x,y:vr.y,width:vr.width,height:vr.height}),CanvasRenderer._applyAttributes(g,o),o.rData.vmTransform&&(mt=o.rData.vmTransform,g.setTransform(dpiScale*mt[0][0],dpiScale*mt[1][0],dpiScale*mt[0][1],dpiScale*mt[1][1],dpiScale*mt[0][2],dpiScale*mt[1][2])),o.clip&&(g.beginPath(),g.rect(o.clip.x,o.clip.y,o.clip.width,o.clip.height),g.clip()),(doFill||doStroke)&&(o.preRender&&o.preRender(),renderFn.apply(o,[g,doFill,doStroke])),hasChildren&&CanvasRenderer._renderDisplayObjects(g,o.children,view,dpiScale),g.restore()},CanvasRenderer._registerRenderFn=function(renderFn,object){var o;if("function"!=typeof renderFn)throw new TypeError("First parameter must be a function");o="function"!=typeof object&&"function"==typeof object.constructor?object.constructor:object,o.__renderFnId="_"+renderFnCounter++,displayObjectToRenderObjectMapping[o.__renderFnId]=renderFn},CanvasRenderer._getRenderFn=function(object){var renderFnId=object.__renderFnId||(object.constructor?object.constructor.__renderFnId:void 0);if(renderFnId)return displayObjectToRenderObjectMapping[renderFnId];for(var j=0;numRenderObjects>j;j++)if(renderObjects[j].displayObject===object.constructor)return CanvasRenderer._registerRenderFn(renderObjects[j].render,object),renderObjects[j].render;for(j=0;numRenderObjects>j;j++)if(object instanceof renderObjects[j].displayObject)return CanvasRenderer._registerRenderFn(renderObjects[j].render,object),renderObjects[j].render;object.constructor.__renderFnId="does not exist"},CanvasRenderer._updateTransforms=function(objects,m,renderProps){var i,object,j,children,p,inherited={},num=objects?objects.length:0;for(p in renderProps)contextAttributesRegex.test(p)&&(inherited[p]=renderProps[p]);for(i=0;num>i;i++){object=objects[i],object.clearModelView(),object.matrix&&(m.save(),m.multiply(object.matrix),object.rData.vmTransform=m.elements,object.rData.dirtyVMTransform=!0),object.rData.inherited={};for(p in inherited)object.rData.inherited[p]=inherited[p];if(children=object.children,children&&children.length){for(j=0;numContextAttributes>j;j++)object.hasOwnProperty(contextAttributes[j])&&(inherited[p]=object[p]);CanvasRenderer._updateTransforms(children,m,inherited)}object.matrix&&m.restore()}},CanvasRenderer.Gradient={LINEAR:0,RADIAL:1},CanvasRenderer._applyAttributes=function(g,o){var key,j;for(j=0;numContextAttributes>j;j++)key=contextAttributes[j],key in o&&"undefined"!=typeof o[key]&&(("fill"===key||"stroke"===key)&&o[key]&&o[key].gradient?o[key].gradient.r?g[objectToContextPropertyMapping[key]]=CanvasRenderer._createGradient(g,o[key].gradient,CanvasRenderer.Gradient.RADIAL)||"#000000":g[objectToContextPropertyMapping[key]]=CanvasRenderer._createLinearGradient(g,o[key].gradient)||"#000000":g[objectToContextPropertyMapping[key]||key]=o[key])},CanvasRenderer._createLinearGradient=function(g,source){return CanvasRenderer._createGradient(g,source,CanvasRenderer.Gradient.LINEAR)},CanvasRenderer._createGradient=function(g,source,type){var gradient,j,len;if(!(isNaN(source.x0)||isNaN(source.y0)||isNaN(source.x1)||isNaN(source.y1))){for(gradient=type===CanvasRenderer.Gradient.RADIAL?g.createRadialGradient(source.x0,source.y0,0,source.x1,source.y1,source.r):g.createLinearGradient(source.x0,source.y0,source.x1,source.y1),len=source.limits.length,j=0;len>j;j++)gradient.addColorStop(source.limits[j],source.colors[j]);return gradient}},CanvasRenderer.registerRenderObject=function(object){renderObjects.push(object),numRenderObjects=renderObjects.length},CanvasRenderer}),define("extensions.qliktech/barchart/layers/bar-helpers",["objects.views/charts/shapes/rect"],function(Rect){"use strict";function updateRectangle(rect,x0,x1,y0,y1,rotate,bounds){var temp,temp2;return rotate?(temp=x0,
temp2=x1,x1=y1,x0=y0,y1=temp,y0=temp2,x0>x1&&(temp=x1,x1=x0,x0=temp),x0=Math.max(bounds.x,Math.min(bounds.x+bounds.width,x0)),x1=Math.max(bounds.x,Math.min(bounds.x+bounds.width,x1))):(y1>y0&&(temp=y1,y1=y0,y0=temp),y0=Math.max(bounds.y,Math.min(bounds.y+bounds.height,y0)),y1=Math.max(bounds.y,Math.min(bounds.y+bounds.height,y1))),rect.set(x0,y1,x1-x0,y0-y1),rect}function getSlicedPolygon(rect,side,depth,outwards){var points=[{x:rect.x,y:rect.y},{x:rect.x,y:rect.y+rect.height},{x:rect.x+rect.width,y:rect.y+rect.height},{x:rect.x+rect.width,y:rect.y}];switch(side){case"left":outwards?points[0].x-=depth:points[1].x+=depth;break;case"right":outwards?points[2].x+=depth:points[3].x-=depth;break;case"top":outwards?points[3].y-=depth:points[0].y+=depth;break;case"bottom":outwards?points[1].y+=depth:points[2].y-=depth}return points}function getSpike(rect,direction,cutOff){var tip,cutOffPad=cutOff.pad,gapSize=cutOff.gap,sharpness=cutOff.sharpness,r=rect.clone(),func=getSlicedPolygon,parts=[];return"right"===direction?(tip=new Rect(r.x+r.width+gapSize,r.y,cutOffPad-gapSize,r.height),parts.push(func(r,"right",sharpness,!0)),parts.push(func(tip,"left",sharpness,!1,!0)),rect.width+=tip.width+gapSize):"left"===direction?(tip=new Rect(0,r.y,cutOffPad-gapSize,r.height),parts.push(func(r,"left",sharpness,!0)),parts.push(func(tip,"right",sharpness,!1,!0)),rect.x=tip.x,rect.width+=tip.width+gapSize):"down"===direction?(tip=new Rect(r.x,r.y+r.height+gapSize,r.width,cutOffPad-gapSize),parts.push(func(r,"bottom",sharpness,!0)),parts.push(func(tip,"top",sharpness,!1,!0)),rect.height+=tip.height+gapSize):"up"===direction&&(tip=new Rect(r.x,0,r.width,cutOffPad-gapSize),parts.push(func(r,"top",sharpness,!0)),parts.push(func(tip,"bottom",sharpness,!1,!0)),rect.y=tip.y,rect.height+=tip.height+gapSize),parts}function updateSpike(polygon,direction,cutOff){polygon.set(getSpike(polygon.data.hitRect,direction,cutOff))}function updateHint(polygon,direction,bounds){polygon.set(getHint(polygon.data.hitRect,direction,bounds))}function getTriangleArrow(x,y,baseSize,tipSize,direction){var points=[];return"left"===direction?(points.push({x:x,y:y+baseSize/2}),points.push({x:x,y:y-baseSize/2}),points.push({x:x-tipSize,y:y})):"right"===direction?(points.push({x:x,y:y+baseSize/2}),points.push({x:x,y:y-baseSize/2}),points.push({x:x+tipSize,y:y})):"up"===direction?(points.push({x:x-baseSize/2,y:y}),points.push({x:x+baseSize/2,y:y}),points.push({x:x,y:y-tipSize})):"down"===direction&&(points.push({x:x-baseSize/2,y:y}),points.push({x:x+baseSize/2,y:y}),points.push({x:x,y:y+tipSize})),points}function getHint(rect,direction,bounds){var points,tipSize,baseSize;return baseSize=Math.min(rect[["left","right"].contains(direction)?"height":"width"]/2,8),tipSize=Math.min(baseSize,8),"left"===direction?(points=getTriangleArrow(bounds.x+tipSize,rect.y+rect.height/2,baseSize,tipSize,direction),rect.width+=tipSize):"right"===direction?(points=getTriangleArrow(bounds.x+bounds.width-tipSize-1,rect.y+rect.height/2,baseSize,tipSize,direction),rect.width+=tipSize,rect.x-=tipSize):"up"===direction?(points=getTriangleArrow(rect.x+rect.width/2,bounds.y+tipSize,baseSize,tipSize,direction),rect.height+=tipSize):"down"===direction&&(points=getTriangleArrow(rect.x+rect.width/2,bounds.y+bounds.height-tipSize-1,baseSize,tipSize,direction),rect.height+=tipSize,rect.y-=tipSize),points}return{updateRectangle:updateRectangle,getSpike:getSpike,getSlicedPolygon:getSlicedPolygon,getHint:getHint,updateSpike:updateSpike,updateHint:updateHint}}),define("extensions.qliktech/barchart/layers/bar-layer",["core.utils/class","objects.utils/shapes/rect","objects.views/charts/shapes/polygon","objects.views/charts/renderers/canvas-renderer","general.utils/property-resolver","extensions.qliktech/barchart/layers/bar-helpers"],function(Class,Rect,Polygon,Renderer,propertyResolver,barHelpers){"use strict";function updateBars(){var x0,x1,y0,y1,unitWidth,node,unitCenter,numBars,i,cacheItem,shapeStyle,isPolygon,barStyle=this.style.shape,tempRect=new Rect(0,0,0,0),widthRatio=this.widthRatio,isSpikingEnabled=this.isSpikingEnabled,isHintingEnabled=this.isHintingEnabled,nodesInView=[],isBarWidthStatic=this.majorAxis.isDiscrete(),staticWidth=this.majorAxis.getDiscreteSpacing()*widthRatio,axisMax=this.minorAxis.getPlotMax(),axisMin=this.minorAxis.getPlotMin(),vertical=!this.majorAxis.isVertical(),minorAxisPadding=this.minorAxis.getPadding(),zeroPos=this.minorAxis.getPositionOfValue(0)-1,posCutOff={pad:vertical?minorAxisPadding.top:minorAxisPadding.right},negCutOff={pad:vertical?minorAxisPadding.bottom:minorAxisPadding.left},bounds=new Rect;posCutOff.gap=.3*posCutOff.pad,posCutOff.sharpness=.3*posCutOff.pad,negCutOff.gap=.3*negCutOff.pad,negCutOff.sharpness=.3*negCutOff.pad,bounds.set(minorAxisPadding.left,minorAxisPadding.top,this.rect.width-minorAxisPadding.left-minorAxisPadding.right,this.rect.height-minorAxisPadding.top-minorAxisPadding.bottom),this._bounds=bounds;var edgeStart=0,edgeEnd=vertical?this.rect.width:this.rect.height,rangeViewStart=-1,rangeViewEnd=vertical?this.rect.height:this.rect.width;for(numBars=this.shapes?this.shapes.length:0,i=0;numBars>i;i++)if(node=this.shapes[i],isPolygon=node instanceof Polygon||"Polygon"===node.type,unitCenter=this.majorAxis.getPositionOfId(node.data.axisId),unitWidth=isBarWidthStatic?staticWidth:this.majorAxis.getWidthOfId(node.data.axisId)*widthRatio,node.data.isNaN||isNaN(node.data.value)?(node.data.isNaN=!0,y0=y1=zeroPos):(y0=this.minorAxis.getPositionOfValue(node.data.start)-1,y1=this.minorAxis.getPositionOfValue(node.data.end)-1),x0=unitCenter-unitWidth/2,x1=unitCenter+unitWidth/2,barHelpers.updateRectangle(node.data.hitRect,x0,x1,y0,y1,!vertical,bounds),delete node.data.labelRect,delete node.data.isCutOff,delete node.data.hintDirection,edgeStart>x1||x0>edgeEnd)node.data.isVisible=!1;else{node.data.isVisible=!0,isPolygon?node.set(node.data.hitRect.getPoints()):node.set(node.data.hitRect.x,node.data.hitRect.y,node.data.hitRect.width,node.data.hitRect.height),tempRect.set(node.data.hitRect.x,node.data.hitRect.y,node.data.hitRect.width,node.data.hitRect.height),nodesInView.push(node),cacheItem=node.data.cacheItem;var selected=cacheItem.selected;if(node.data.isFakeOtherCell&&node.data.highlightOnGroupSelect&&cacheItem.children[0].selected){selected=!0;for(var k=0;k<cacheItem.children.length;k++)if(!cacheItem.children[k].selected){selected=!1;break}}shapeStyle=selected?barStyle.selected:{border:{color:0,width:0}},node.stroke=shapeStyle.border.color,node.fill=node.data.isFakeOtherCell?this.othersFillPattern:node.data.fill,node.strokeWidth=shapeStyle.border.width,node.opacity=selected?1:this._globalAlpha;var hint=isHintingEnabled?this._getHint(y0,y1,bounds,vertical):!1,spike=isPolygon&&!hint&&isSpikingEnabled?this._getSpike(node.data.end,y0,y1,bounds,vertical,axisMin,axisMax):!1;spike?(node.data.labelRect=tempRect.clone(),barHelpers.updateSpike(node,vertical?node.data.end>=0?"up":"down":node.data.end>=0?"right":"left",node.data.end>=0?posCutOff:negCutOff),node.data.isCutOff=!0):hint?(node.fill="#999999",barHelpers.updateHint(node,hint,bounds),node.data.hintDirection=hint):(rangeViewStart>y0&&rangeViewStart>y1||y0>rangeViewEnd&&y1>rangeViewEnd)&&(node.data.isVisible=!1)}this.nodesInView=nodesInView}var BarLayer;return BarLayer=Class.extend("BarLayer",{init:function(container){this.renderer=new Renderer(container,{name:"bar-layer"}),this.widthRatio=.7,this.isSpikingEnabled=!1,this.isHintingEnabled=!1,this.shapes=[],this._globalAlpha=1},release:function(){this.renderer.release(),this.shapes=null,this.minorAxis=null,this.majorAxis=null},update:function(){updateBars.call(this)},render:function(){return this.renderer.render()},clear:function(){this.renderer.clear()},_getStyle:function(s){return{selected:{border:{color:propertyResolver.getValue(s,"shape.selected.border.color","rgba(0,0,0,0.25)"),width:propertyResolver.getValue(s,"shape.selected.border.width",1)}}}},_getHint:function(y0,y1,bounds,vertical){if(vertical){if(y1+1<bounds.y&&y0+1<=bounds.y)return"up";if(y1+1>bounds.y+bounds.height&&y0+1>=bounds.y+bounds.height)return"down"}else{if(y1+1<bounds.x&&y0+1<=bounds.x)return"left";if(y1+1>bounds.x+bounds.width&&y0+1>=bounds.x+bounds.width)return"right"}return!1},_getSpike:function(endValue,y0,y1,bounds,vertical,axisMin,axisMax){var positive=endValue>axisMax,negative=axisMin>endValue;return vertical?(positive=positive&&y1<bounds.y&&y0>bounds.y,negative=negative&&y1>bounds.y+bounds.height&&y0<bounds.y+bounds.height):(positive=positive&&y1>bounds.x+bounds.width&&y0<bounds.x+bounds.width,negative=negative&&y1<bounds.x&&y0>bounds.x),positive||negative}})}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","objects.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix","core.utils/deferred"],function(Class,Rect,aF,$,Matrix,Deferred){"use strict";function cacheFontHeight(font,height){fontCacheArr.length>100&&delete fontCacheObj[fontCacheArr.shift()],fontCacheArr.push(font),fontCacheObj[font]=height}function getFontHeightCanvas(g){if(g.font in fontCacheObj)return fontCacheObj[g.font];var height=1.5*g.measureText("m").width;return cacheFontHeight(g.font,height),height}function polygon(g,o,doFill,doStroke,close){var p,i,points=o.shape.points,num=points?points.length:0;if(g.beginPath(),p=points[0]){for(g.moveTo(p.x,p.y),i=1;num>i;i+=1)p=points[i],g.lineTo(p.x,p.y);close&&g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()}}function lineWrap(text,width,maxNumLines){var n,testLine,testWidth,words=text?text.replace(/^\s*|\s*$/,"").split(" "):[],lines=[],line=words[0];if(!line)return[];for(n=1;n<words.length;n++)testLine=line+" "+words[n],testWidth=dummyContext.measureText(testLine).width,testWidth>width&&maxNumLines>lines.length?(lines.push(line),line=words[n]):line=testLine;return lines.length<maxNumLines?lines.push(line):lines[Math.max(0,lines.length-1)]?lines[Math.max(0,lines.length-1)]+=" "+line:lines[Math.max(0,lines.length-1)]=" "+line,lines}function wordWrap(lines,width,maxNumLines){if(void 0!==lines){var n,line,testLine,rest,isSplit,i,maxNumLetters,postFixedTestLine,ellipsis="…",minWidthLetter=dummyContext.measureText("i").width;for(n=0;n<lines.length;n++){if(line=lines[n],maxNumLetters=Math.ceil(Math.max(0,width/minWidthLetter))+1,maxNumLetters<line.length?(rest=line.slice(maxNumLetters),line=line.slice(0,maxNumLetters)):rest="",testLine=line,line&&line.length>1&&dummyContext.measureText(line).width>width){for(isSplit=!1,i=line.length;i>0;i--)if(testLine=testLine.substring(0,testLine.length-1),postFixedTestLine=testLine+(maxNumLines>n+1?"-":ellipsis),dummyContext.measureText(postFixedTestLine).width<width){rest=line.substring(i-1)+rest,line=postFixedTestLine,isSplit=!0;break}isSplit||(rest=line.substring(1),line=line.substring(0,1)),isSplit||i||(rest="",line=ellipsis)}lines[n]=String(line).trim(),rest&&n<lines.length-1?lines[n+1]=rest+" "+lines[n+1]:rest&&lines.length<maxNumLines&&lines.push(rest)}}}function wrapText(text,maxNumLines,options){var lines,maxWidth=options.maxWidth;return isNaN(maxWidth)?[text]:(lines=maxNumLines>1?lineWrap(text,maxWidth,maxNumLines):[text],wordWrap(lines,maxWidth,maxNumLines),lines)}function renderTextAdvanced(g,options,isMeasuring){var lines,i,text=options.text,lineHeight=(options.lineHeight||1)*getFontHeightCanvas(g),maxWidth="maxWidth"in options?options.maxWidth:options.width,maxHeight="maxHeight"in options?options.maxHeight:options.height,width=options.width,height=options.height,maxNumLines=options.maxNumLines,x=options.x||0,y=options.y||0;if(dummyContext.font=g.font,isNaN(maxNumLines)&&(maxNumLines=maxHeight?Math.max(1,Math.floor(maxHeight/lineHeight)):1),lines=wrapText(text,maxNumLines,{maxWidth:maxWidth,maxHeight:maxHeight}),isMeasuring){for(width=0,i=0;i<lines.length;i++)width=Math.max(width,g.measureText(lines[i]).width);return{lines:lines,numLines:lines.length,width:width,height:lines.length*lineHeight,truncated:Array.isArray(/…$/.exec(lines[lines.length-1]))}}for("middle"===g.textBaseline?"undefined"!=typeof height?y+=height/2:lines.length&&(y-=(lines.length-1)*lineHeight/2):"bottom"===g.textBaseline&&("undefined"!=typeof height?y+=height:y-=(lines.length-1)*lineHeight),"center"===g.textAlign&&width?x+=width/2:"right"===g.textAlign&&width&&(x+=width),i=0;i<lines.length;i++)g.fillText(lines[i],x,y),y+=lineHeight}function drawStuff(g,m,objects,scale,ancestorFill,ancestorStroke){var i,j,t,object,mt,gradient,o;for(i=0;i<objects.length;i+=1)if(object=objects[i]){if(g.save(),t=object.transform,t&&(m.save(),m.multiply(t)),"opacity"in object&&(g.globalAlpha=object.opacity),object.fill)if(object.fill.gradient){if(o=object.fill.gradient,isNaN(o.x0)||isNaN(o.y0)||isNaN(o.x1)||isNaN(o.y1))return;for(gradient=g.createLinearGradient(o.x0,o.y0,o.x1,o.y1),j=0;j<o.limits.length;j++)gradient.addColorStop(o.limits[j],o.colors[j]);g.fillStyle=gradient}else g.fillStyle=object.fill;if(object.stroke&&0!==object.strokeWidth){if(object.stroke.gradient){for(o=object.stroke.gradient,gradient=g.createLinearGradient(o.x0,o.y0,o.x1,o.y1),j=0;j<o.limits.length;j++)gradient.addColorStop(o.limits[j],o.colors[j]);g.strokeStyle=gradient}else g.strokeStyle=object.stroke;g.lineWidth=object.strokeWidth||1,scale>1&&"polygon"!==object.type&&(g.lineWidth/=scale)}object.lineJoin&&(g.lineJoin=object.lineJoin),object.lineCap&&(g.lineCap=object.lineCap),mt=m.elements,"group"===object.type?(m.save(),object.clip&&(g.beginPath(),g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),g.rect(object.clip.rect.x,object.clip.rect.y,object.clip.rect.width,object.clip.rect.height),g.clip()),drawStuff(g,m,object.children,void 0,!!object.fill||!!ancestorFill,!!object.stroke&&0!==object.strokeWidth||!!ancestorStroke),m.restore()):object.type in render&&(g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),render[object.type](g,object,!!object.fill||!!ancestorFill,!!object.stroke&&0!==object.strokeWidth||!!ancestorStroke)),g.globalAlpha=1,t&&m.restore(),g.restore()}}function applyViewBox(g,m,vb){if(vb){var mt=m.elements;switch(vb.type){case"clip":g.save(),g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),g.beginPath(),g.rect(vb.rect.x,vb.rect.y,vb.rect.width,vb.rect.height),g.clip();break;case"slice":}}}function restoreViewBox(g,vb){vb&&g.restore()}var CanvasRenderer,render,_devicePixelRatio=window.devicePixelRatio||1,dummyCanvas=document.createElement("canvas"),dummyContext=dummyCanvas.getContext("2d"),dummySpan=document.createElement("span"),backingStoreRatio=dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1,devicePixelToBackingStoreRatio=_devicePixelRatio/backingStoreRatio,fontCacheObj={},fontCacheArr=[];dummySpan.innerText="Wj",render={rect:function(g,o,doFill,doStroke){doFill&&g.fillRect(o.shape.x||0,o.shape.y||0,o.shape.width||0,o.shape.height||0),doStroke&&g.strokeRect(o.shape.x||0,o.shape.y||0,o.shape.width||0,o.shape.height||0)},roundRect:function(g,o,doFill,doStroke){g.beginPath(),g.moveTo(o.shape.x+o.shape.radius,o.shape.y),g.lineTo(o.shape.x+o.shape.width-o.shape.radius,o.shape.y),g.quadraticCurveTo(o.shape.x+o.shape.width,o.shape.y,o.shape.x+o.shape.width,o.shape.y+o.shape.radius),g.lineTo(o.shape.x+o.shape.width,o.shape.y+o.shape.height-o.shape.radius),g.quadraticCurveTo(o.shape.x+o.shape.width,o.shape.y+o.shape.height,o.shape.x+o.shape.width-o.shape.radius,o.shape.y+o.shape.height),g.lineTo(o.shape.x+o.shape.radius,o.shape.y+o.shape.height),g.quadraticCurveTo(o.shape.x,o.shape.y+o.shape.height,o.shape.x,o.shape.y+o.shape.height-o.shape.radius),g.lineTo(o.shape.x,o.shape.y+o.shape.radius),g.quadraticCurveTo(o.shape.x,o.shape.y,o.shape.x+o.shape.radius,o.shape.y),g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()},circle:function(g,o,doFill,doStroke){if(o.shape&&o.shape.r&&!o.shape.radius&&(o.shape.radius=o.shape.r),!(isNaN(o.shape.cx)||isNaN(o.shape.cy)||isNaN(o.shape.radius)||o.shape.radius<=0)){var m=.551784;g.save(),g.translate(o.shape.cx,o.shape.cy),g.scale(o.shape.radius,o.shape.radius),g.beginPath(),g.moveTo(1,0),g.bezierCurveTo(1,-m,m,-1,0,-1),g.bezierCurveTo(-m,-1,-1,-m,-1,0),g.bezierCurveTo(-1,m,-m,1,0,1),g.bezierCurveTo(m,1,1,m,1,0),g.closePath(),g.restore(),doFill&&g.fill(),doStroke&&g.stroke()}},line:function(g,o,doFill,doStroke){doStroke&&(g.beginPath(),g.moveTo(o.shape.x1,o.shape.y1),g.lineTo(o.shape.x2,o.shape.y2),g.stroke())},polygon:function(g,o,doFill,doStroke){polygon(g,o,doFill,doStroke,!0)},polyline:function(g,o,doFill,doStroke){polygon(g,o,doFill,doStroke)},polygons:function(g,o,doFill,doStroke){var polygon,points,numPoints,p,i,j,polygons=o.shape.polygons,numPolygons=polygons?polygons.length:0;for(g.beginPath(),i=0;numPolygons>i;i++)if(polygon=polygons[i],points=polygon.points,numPoints=points?points.length:0,0!==numPoints&&(p=points[0]))for(g.moveTo(p.x,p.y),j=1;numPoints>j;j+=1)p=points[j],g.lineTo(p.x,p.y);doFill&&g.fill(),doStroke&&g.stroke()},multipolygon:function(g,o,doFill,doStroke){var polygons,numPolygons,points,numPoints,p,i,j,k,geopolygons=o.shape.geopolygons,numGeoPolygons=geopolygons?geopolygons.length:0;for(g.beginPath(),i=0;numGeoPolygons>i;i++)for(polygons=geopolygons[i].getPolygons(),numPolygons=polygons?polygons.length:0,j=0;numPolygons>j;j++)if(points=polygons[j].points,numPoints=points?points.length:0,0!==numPoints&&(p=points[0]))for(g.moveTo(p.x,p.y),k=1;numPoints>k;k+=1)p=points[k],g.lineTo(p.x,p.y);doFill&&g.fill(),doStroke&&g.stroke()},arc:function(g,o,doFill,doStroke){var arc=o.shape;g.beginPath(),arc.end-arc.start===2*Math.PI?(g.arc(arc.cx,arc.cy,arc.radius,arc.start+arc.radianOffset,arc.end+arc.radianOffset,!1),g.moveTo(arc.cx+arc.innerRadius*Math.cos(arc.radianOffset+arc.start),arc.cy+arc.innerRadius*Math.sin(arc.radianOffset+arc.start)),g.arc(arc.cx,arc.cy,arc.innerRadius,arc.end+arc.radianOffset,arc.start+arc.radianOffset,!0)):(g.arc(arc.cx,arc.cy,arc.radius,arc.start+arc.radianOffset,arc.end+arc.radianOffset,!1),isNaN(arc.innerRadius)||arc.innerRadius===arc.radius||(g.lineTo(arc.innerRadius*Math.cos(arc.end+arc.radianOffset)+arc.cx,arc.innerRadius*Math.sin(arc.end+arc.radianOffset)+arc.cy),arc.innerRadius>0&&g.arc(arc.cx,arc.cy,arc.innerRadius,arc.end+arc.radianOffset,arc.start+arc.radianOffset,!0),g.lineTo(arc.radius*Math.cos(arc.start+arc.radianOffset)+arc.cx,arc.radius*Math.sin(arc.start+arc.radianOffset)+arc.cy))),g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()},text:function(g,o){o.shape&&o.shape.text&&o.fill&&(o.shape.font&&(g.font=o.shape.font),o.shape.align&&(g.textAlign=o.shape.align),o.shape.baseline&&(g.textBaseline=o.shape.baseline),renderTextAdvanced(g,o.shape))}},CanvasRenderer=Class.extend({init:function(container,options){var settings=$.extend(!0,{storeObjects:!1},options);this._container=container,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,settings.name&&this._canvas.setAttribute("name",settings.name),this.storeRenderedObjects=settings.storeObjects===!0,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new Rect(0,0,0,0),this.shapes=[],this._matrix=new Matrix},setDimensions:function(x,y,w,h){this.rect.set(x,y,w,h)},setDimensionsToContainerRatio:function(x,y){this.scaling={x:x,y:y},this.ratios={x:x,y:y}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(schedule){if(schedule){if(!this._clearTimer){var self=this;this._clearTimer=aF.request(function(){self._clearTimer&&(self._canvas.width=0,self._clearTimer=0)})}}else aF.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,$(this._canvas).data("shapes",null),this.shapes=[]},render:function(){aF.cancel(this._clearTimer),this._clearTimer=0,_devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1,devicePixelToBackingStoreRatio=_devicePixelRatio/backingStoreRatio;var extendedWidth,extendedHeight,c=this._canvas,g=c.getContext("2d"),scale=devicePixelToBackingStoreRatio,m=this._matrix,shiftX=0,shiftY=0;return extendedHeight=this.rect.height*this.scaling.y,extendedWidth=this.rect.width*this.scaling.x,this.edgeBleed&&(shiftX=this.edgeBleed.left*this.scaling.x,shiftY=this.edgeBleed.top*this.scaling.y,extendedHeight+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,extendedWidth+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),extendedHeight=Math.round(extendedHeight),extendedWidth=Math.round(extendedWidth),this._canvas.style.left=-shiftX+"px",this._canvas.style.top=-shiftY+"px",c.width!==extendedWidth||c.height!==extendedHeight?(c.width=scale*extendedWidth,c.height=scale*extendedHeight,this._canvas.style.width=extendedWidth+"px",this._canvas.style.height=extendedHeight+"px"):g.clearRect(0,0,c.width,c.height),g.save(),m.save(),m.scale(scale*this.scaling.x,scale*this.scaling.y),m.translate(shiftX/this.scaling.x,shiftY/this.scaling.y),applyViewBox(g,m,this.viewBox),drawStuff(g,m,this.shapes,this.scaling.x),restoreViewBox(g,this.viewBox),g.restore(),m.restore(),this.storeRenderedObjects&&$(this._canvas).data("shapes",this.shapes),Deferred.resolve()},setFont:function(f){this._canvas.getContext("2d").font=f},getFontHeight:function(font){if("string"!=typeof font)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(font in fontCacheObj)return fontCacheObj[font];var height,g=this._canvas.getContext("2d");return g.font!==font?(g.save(),g.font=font,height=1.5*g.measureText("m").width,g.restore()):height=1.5*g.measureText("m").width,cacheFontHeight(font,height),height},getTextWidth:function(text,font){var width,g=this._canvas.getContext("2d");return g.save(),g.font=font,width=void 0!==text?Math.ceil(g.measureText(text).width):0,g.restore(),width},getEMFontWidth:function(font){var x,text="m",g=this._canvas.getContext("2d");return g.save(),g.font=font,x=g.measureText(text).width,g.restore(),x},getAverageLetterWidth:function(font){var x,latin="eeeaaaiinnoorsstldumcph";return dummyContext.font=font||this._canvas.getContext("2d").font,x=dummyContext.measureText(latin).width,x/latin.length},release:function(){$(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var i;for(i=0;i<this.shapes.length;i+=1)this.shapes[i].type in transforms&&transforms[this.shapes[i].type](this.shapes[i].shape,this.ratios)}});var transforms={rect:function(shape,o){shape.x*=o.x,shape.y*=o.y,shape.width*=o.x,shape.height*=o.y},line:function(shape,o){shape.x1*=o.x,shape.y1*=o.y,shape.x2*=o.x,shape.y2*=o.y},circle:function(shape,o){shape.cx*=o.x,shape.cy*=o.y,shape.r*=Math.min(o.x,o.y)},polygon:function(shape,o){var i,p;for(i=0;i<shape.points.length;i++)p=shape.points[i],p.x*=o.x,p.y*=o.y},text:function(shape,o){shape.x*=o.x,shape.y*=o.y,shape.width*=o.x,shape.height*=o.y}};return CanvasRenderer.getTextWidth=function(t){return Math.ceil(dummyContext.measureText(t).width)},CanvasRenderer.setFont=function(f){dummyContext.font=f},CanvasRenderer.getAverageLetterWidth=function(f){var x,latin="eeeaaaiinnoorsstldumcph";return dummyContext.font=f,x=dummyContext.measureText(latin).width,x/latin.length},CanvasRenderer.measureText=function(text,font){var h,w,metrics,g=dummyContext;return font&&g.font!==font&&(g.save(),g.font=font),w=g.measureText(text).width,font in fontCacheObj?h=fontCacheObj[font]:(h=1.5*g.measureText("m").width,cacheFontHeight(font,h)),font&&g.restore(),metrics=void 0!==text?{width:w,height:h}:{width:0,height:0}},CanvasRenderer.measureTextObject=function(o){return o.shape.font&&(dummyContext.font=o.shape.font),o.shape.align&&(dummyContext.textAlign=o.shape.align),o.shape.baseline&&(dummyContext.textBaseline=o.shape.baseline),renderTextAdvanced(dummyContext,o.shape,!0)},CanvasRenderer.getFontHeight=function(font){var height,g=dummyContext;return font in fontCacheObj?fontCacheObj[font]:(font&&(g.save(),g.font=font),height=1.5*g.measureText("m").width,cacheFontHeight(font,height),font&&g.restore(),height)},CanvasRenderer.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1)},CanvasRenderer}),define("general.utils/css-colors",[],function(){var colorStruct={aliceblue:{r:240,g:248,b:255},antiquewhite:{r:250,g:235,b:215},aqua:{r:0,g:255,b:255},aquamarine:{r:127,g:255,b:212},azure:{r:240,g:255,b:255},beige:{r:245,g:245,b:220},bisque:{r:255,g:228,b:196},black:{r:0,g:0,b:0},blanchedalmond:{r:255,g:235,b:205},blue:{r:0,g:0,b:255},blueviolet:{r:138,g:43,b:226},brown:{r:165,g:42,b:42},burlywood:{r:222,g:184,b:135},cadetblue:{r:95,g:158,b:160},chartreuse:{r:127,g:255,b:0},chocolate:{r:210,g:105,b:30},coral:{r:255,g:127,b:80},cornflowerblue:{r:100,g:149,b:237},cornsilk:{r:255,g:248,b:220},crimson:{r:220,g:20,b:60},cyan:{r:0,g:255,b:255},darkblue:{r:0,g:0,b:139},darkcyan:{r:0,g:139,b:139},darkgoldenrod:{r:184,g:134,b:11},darkgray:{r:169,g:169,b:169},darkgreen:{r:0,g:100,b:0},darkgrey:{r:169,g:169,b:169},darkkhaki:{r:189,g:183,b:107},darkmagenta:{r:139,g:0,b:139},darkolivegreen:{r:85,g:107,b:47},darkorange:{r:255,g:140,b:0},darkorchid:{r:153,g:50,b:204},darkred:{r:139,g:0,b:0},darksalmon:{r:233,g:150,b:122},darkseagreen:{r:143,g:188,b:143},darkslateblue:{r:72,g:61,b:139},darkslategray:{r:47,g:79,b:79},darkslategrey:{r:47,g:79,b:79},darkturquoise:{r:0,g:206,b:209},darkviolet:{r:148,g:0,b:211},deeppink:{r:255,g:20,b:147},deepskyblue:{r:0,g:191,b:255},dimgray:{r:105,g:105,b:105},dimgrey:{r:105,g:105,b:105},dodgerblue:{r:30,g:144,b:255},firebrick:{r:178,g:34,b:34},floralwhite:{r:255,g:250,b:240},forestgreen:{r:34,g:139,b:34},fuchsia:{r:255,g:0,b:255},gainsboro:{r:220,g:220,b:220},ghostwhite:{r:248,g:248,b:255},gold:{r:255,g:215,b:0},goldenrod:{r:218,g:165,b:32},gray:{r:128,g:128,b:128},green:{r:0,g:128,b:0},greenyellow:{r:173,g:255,b:47},grey:{r:128,g:128,b:128},honeydew:{r:240,g:255,b:240},hotpink:{r:255,g:105,b:180},indianred:{r:205,g:92,b:92},indigo:{r:75,g:0,b:130},ivory:{r:255,g:255,b:240},khaki:{r:240,g:230,b:140},lavender:{r:230,g:230,b:250},lavenderblush:{r:255,g:240,b:245},lawngreen:{r:124,g:252,b:0},lemonchiffon:{r:255,g:250,b:205},lightblue:{r:173,g:216,b:230},lightcoral:{r:240,g:128,b:128},lightcyan:{r:224,g:255,b:255},lightgoldenrodyellow:{r:250,g:250,b:210},lightgray:{r:211,g:211,b:211},lightgreen:{r:144,g:238,b:144},lightgrey:{r:211,g:211,b:211},lightpink:{r:255,g:182,b:193},lightsalmon:{r:255,g:160,b:122},lightseagreen:{r:32,g:178,b:170},lightskyblue:{r:135,g:206,b:250},lightslategray:{r:119,g:136,b:153},lightslategrey:{r:119,g:136,b:153},lightsteelblue:{r:176,g:196,b:222},lightyellow:{r:255,g:255,b:224},lime:{r:0,g:255,b:0},limegreen:{r:50,g:205,b:50},linen:{r:250,g:240,b:230},magenta:{r:255,g:0,b:255},maroon:{r:128,g:0,b:0},mediumaquamarine:{r:102,g:205,b:170},mediumblue:{r:0,g:0,b:205},mediumorchid:{r:186,g:85,b:211},mediumpurple:{r:147,g:112,b:219},mediumseagreen:{r:60,g:179,b:113},mediumslateblue:{r:123,g:104,b:238},mediumspringgreen:{r:0,g:250,b:154},mediumturquoise:{r:72,g:209,b:204},mediumvioletred:{r:199,g:21,b:133},midnightblue:{r:25,g:25,b:112},mintcream:{r:245,g:255,b:250},mistyrose:{r:255,g:228,b:225},moccasin:{r:255,g:228,b:181},navajowhite:{r:255,g:222,b:173},navy:{r:0,g:0,b:128},oldlace:{r:253,g:245,b:230},olive:{r:128,g:128,b:0},olivedrab:{r:107,g:142,b:35},orange:{r:255,g:165,b:0},orangered:{r:255,g:69,b:0},orchid:{r:218,g:112,b:214},palegoldenrod:{r:238,g:232,b:170},palegreen:{r:152,g:251,b:152},paleturquoise:{r:175,g:238,b:238},palevioletred:{r:219,g:112,b:147},papayawhip:{r:255,g:239,b:213},peachpuff:{r:255,g:218,b:185},peru:{r:205,g:133,b:63},pink:{r:255,g:192,b:203},plum:{r:221,g:160,b:221},powderblue:{r:176,g:224,b:230},purple:{r:128,g:0,b:128},red:{r:255,g:0,b:0},rosybrown:{r:188,g:143,b:143},royalblue:{r:65,g:105,b:225},saddlebrown:{r:139,g:69,b:19},salmon:{r:250,g:128,b:114},sandybrown:{r:244,g:164,b:96},seagreen:{r:46,g:139,b:87},seashell:{r:255,g:245,b:238},sienna:{r:160,g:82,b:45},silver:{r:192,g:192,b:192},skyblue:{r:135,g:206,b:235},slateblue:{r:106,g:90,b:205},slategray:{r:112,g:128,b:144},slategrey:{r:112,g:128,b:144},snow:{r:255,g:250,b:250},springgreen:{r:0,g:255,b:127},steelblue:{r:70,g:130,b:180},tan:{r:210,g:180,b:140},teal:{r:0,g:128,b:128},thistle:{r:216,g:191,b:216},tomato:{r:255,g:99,b:71},turquoise:{r:64,g:224,b:208},violet:{r:238,g:130,b:238},wheat:{r:245,g:222,b:179},white:{r:255,g:255,b:255},whitesmoke:{r:245,g:245,b:245},yellow:{r:255,g:255,b:0},yellowgreen:{r:154,g:205,b:50}};return colorStruct}),define("general.utils/color",["core.utils/class","./css-colors"],function(Class,CSSColors){var Color,rgb=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i,rgba=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d+)?)\)$/i,hex=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i,hexShort=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i,hsl=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i,hsla=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i,floor=Math.floor,round=Math.round;return Color=Class.extend({init:function(){var h,s,lcs,l,c,h_,x,rgb_,m,matches,colorString,r=0,g=0,b=0,a=1;if(arguments[0]instanceof Color)r=arguments[0]._r,g=arguments[0]._g,b=arguments[0]._b,a=arguments[0]._a;else if(arguments.length<3)if("string"==typeof arguments[0])if(colorString=arguments[0],matches=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(colorString))r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10);else if(matches=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d+)?)\s*\)$/i.exec(colorString))r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10),a=parseFloat(matches[4]);else if(matches=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(colorString))r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16),a=1;else if(matches=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(colorString))r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16),a=1;else if(matches=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(colorString)){switch(h=parseFloat(matches[1]),s=parseFloat(matches[3]),l=parseFloat(matches[5]),h%=360,s/=100,l/=100,h=0>h?0:h>360?360:h,s=0>s?0:s>1?1:s,l=0>l?0:l>1?1:l,c=.5>=l?2*l*s:(2-2*l)*s,h_=h/60,x=c*(1-Math.abs(h_%2-1)),rgb_=[],h_=Math.floor(h_)){case 0:rgb_=[c,x,0];break;case 1:rgb_=[x,c,0];break;case 2:rgb_=[0,c,x];break;case 3:rgb_=[0,x,c];break;case 4:rgb_=[x,0,c];break;case 5:rgb_=[c,0,x];break;default:rgb_=[0,0,0]}m=l-.5*c,r=rgb_[0]+m,g=rgb_[1]+m,b=rgb_[2]+m,r=round(255*r),g=round(255*g),b=round(255*b),a=1}else if(matches=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(colorString)){switch(h=parseFloat(matches[1]),s=parseFloat(matches[3]),l=parseFloat(matches[5]),a=parseFloat(matches[7]),h%=360,s/=100,l/=100,h=0>h?0:h>360?360:h,s=0>s?0:s>1?1:s,l=0>l?0:l>1?1:l,c=.5>=l?2*l*s:(2-2*l)*s,h_=h/60,x=c*(1-Math.abs(h_%2-1)),rgb_=[],h_=Math.floor(h_)){case 0:rgb_=[c,x,0];break;case 1:rgb_=[x,c,0];break;case 2:rgb_=[0,c,x];break;case 3:rgb_=[0,x,c];break;case 4:rgb_=[x,0,c];break;case 5:rgb_=[c,0,x];break;default:rgb_=[0,0,0]}m=l-.5*c,r=rgb_[0]+m,g=rgb_[1]+m,b=rgb_[2]+m,r=round(255*r),g=round(255*g),b=round(255*b)}else CSSColors[colorString.toLowerCase()]?(lcs=colorString.toLowerCase(),r=CSSColors[lcs].r,g=CSSColors[lcs].g,b=CSSColors[lcs].b,
a=1):this._invalid=!0;else"number"==typeof arguments[0]&&arguments[0]>=0&&"argb"===arguments[1]?(a=(4278190080&arguments[0])>>>24,a/=255,r=(16711680&arguments[0])>>16,g=(65280&arguments[0])>>8,b=255&arguments[0]):"number"==typeof arguments[0]&&arguments[0]>=0?(r=(16711680&arguments[0])>>16,g=(65280&arguments[0])>>8,b=255&arguments[0]):this._invalid=!0;else arguments.length>=3?(r=arguments[0],g=arguments[1],b=arguments[2],a=arguments.length>=4?arguments[3]:1):this._invalid=!0;this._r=floor(r),this._g=floor(g),this._b=floor(b),this._a=a,this._spaces={}},isInvalid:function(){return this._invalid},setAlpha:function(a){this._a=a,this._spaces={}},getAlpha:function(){return this._a},toRGB:function(){return this._spaces.rgb||(this._spaces.rgb=Color.toRGB(this)),this._spaces.rgb},toRGBA:function(){return this._spaces.rgba||(this._spaces.rgba=Color.toRGBA(this)),this._spaces.rgba},toString:function(){return this._spaces.rgb||(this._spaces.rgb=Color.toRGB(this)),this._spaces.rgb},toHex:function(){return this._spaces.hex||(this._spaces.hex=Color.toHex(this)),this._spaces.hex},toHSL:function(luma){return this._spaces.hsl||(this._spaces.hsl=Color.toHSL(this,luma)),this._spaces.hsl},toHSLA:function(luma){return this._spaces.hsla||(this._spaces.hsla=Color.toHSLA(this,luma)),this._spaces.hsla},toNumber:function(){return this._spaces.num||(this._spaces.num=Color.toNumber(this)),this._spaces.num},isDark:function(){return this.getLuminance()<125},getLuminance:function(){return"undefined"==typeof this._lumi&&(this._lumi=.299*this._r+.587*this._g+.114*this._b),this._lumi},shiftLuminance:function(value){var h,s,l,a,matches,chsla=this.toHSLA();return matches=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(chsla),h=parseFloat(matches[1]),s=parseFloat(matches[3]),l=parseFloat(matches[5]),a=parseFloat(matches[7]),l+=value,l=Math.max(0,Math.min(l,100)),"hsla("+h+","+s+","+l+","+a+")"},isEqual:function(c){return c instanceof Color?this._r===c._r&&this._g===c._g&&this._b===c._b:(c=new Color(c),this._r===c._r&&this._g===c._g&&this._b===c._b)},blend:function(c2,t){var r=floor(this._r+(c2._r-this._r)*t),g=floor(this._g+(c2._g-this._g)*t),b=floor(this._b+(c2._b-this._b)*t),a=floor(this._a+(c2._a-this._a)*t);return"rgba("+[r,g,b,a].join(",")+")"},createShiftedColor:function(v){(void 0===v||isNaN(v))&&(v=1);var lumi=this.getLuminance(),greenMultiplier=this._g<126?1:1+this._g/512,hsla_string=this.shiftLuminance(20*(220>lumi*greenMultiplier?.8+4*(1/(lumi+1)):-(.8+1*(lumi/255)))*v);return new Color(hsla_string)}}),Color.toRGB=function(c){if(c instanceof Color)return"rgb("+[c._r,c._g,c._b].join(",")+")";"string"==typeof c&&(c=Color.toNumber(c));var r=(16711680&c)>>16,g=(65280&c)>>8,b=255&c;return"rgb("+r+","+g+","+b+")"},Color.toRGBA=function(c,a){if(c instanceof Color)return"rgba("+[c._r,c._g,c._b,"undefined"!=typeof a?a:c._a].join(",")+")";"string"==typeof c&&(c=Color.toNumber(c));var r=(16711680&c)>>16,g=(65280&c)>>8,b=255&c;return"rgba("+r+","+g+","+b+","+("undefined"!=typeof a?a:c._a)+")"},Color.toHex=function(c){var r,g,b;return c instanceof Color?(r=c._r.toString(16),g=c._g.toString(16),b=c._b.toString(16),1===r.length&&(r="0"+r),1===g.length&&(g="0"+g),1===b.length&&(b="0"+b),"#"+[r,g,b].join("")):("string"==typeof c&&(c=Color.toNumber(c)),r=((16711680&c)>>16).toString(16),g=((65280&c)>>8).toString(16),b=(255&c).toString(16),1===r.length&&(r="0"+r),1===g.length&&(g="0"+g),1===b.length&&(b="0"+b),"#"+r+g+b)},Color.toHSL=function(c,luma){var r,g,b,s,l,max,min,ch,h=0;if("string"==typeof c&&(c=new Color(c)),r=c._r/255,g=c._g/255,b=c._b/255,max=Math.max(r,g,b),min=Math.min(r,g,b),l=luma?.21*r+.72*g+.07*b:(max+min)/2,max===min)h=s=0;else{switch(ch=max-min,s=l>.5?ch/(2-max-min):ch/(max+min),max){case r:h=(g-b)/ch+(b>g?6:0);break;case g:h=(b-r)/ch+2;break;case b:h=(r-g)/ch+4}h/=6}return"hsl("+360*h+","+100*s+","+100*l+")"},Color.toHSLA=function(c,luma){var r,g,b,a,s,l,max,min,ch,h=0;if("string"==typeof c&&(c=new Color(c)),r=c._r/255,g=c._g/255,b=c._b/255,a=c._a,max=Math.max(r,g,b),min=Math.min(r,g,b),l=luma?.21*r+.72*g+.07*b:(max+min)/2,max===min)h=s=0;else{switch(ch=max-min,s=l>.5?ch/(2-max-min):ch/(max+min),max){case r:h=(g-b)/ch+(b>g?6:0);break;case g:h=(b-r)/ch+2;break;case b:h=(r-g)/ch+4}h/=6}return"hsla("+360*h+","+100*s+","+100*l+","+a+")"},Color.toNumber=function(){if(1===arguments.length&&arguments[0]instanceof Color)return(arguments[0]._r<<16)+(arguments[0]._g<<8)+arguments[0]._b;var matches,colorString,r=0,g=0,b=0;return 1===arguments.length&&"string"==typeof arguments[0]&&(colorString=arguments[0],(matches=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i.exec(colorString))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(colorString))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(colorString))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16))),(r<<16)+(g<<8)+b},Color.blend=function(c1,c2,t){c1=Color.toNumber(c1),c2=Color.toNumber(c2);var r1=(16711680&c1)>>16,g1=(65280&c1)>>8,b1=255&c1,r2=(16711680&c2)>>16,g2=(65280&c2)>>8,b2=255&c2,r=r1+(r2-r1)*t,g=g1+(g2-g1)*t,b=b1+(b2-b1)*t;return(r<<16)+(g<<8)+b},Color.getBlend=function(c1,c2,t){var r=c1._r+(c2._r-c1._r)*t,g=c1._g+(c2._g-c1._g)*t,b=c1._b+(c2._b-c1._b)*t,a=c1._a+(c2._a-c1._a)*t;return new Color(r,g,b,a)},Color.isCSSColor=function(color){return arguments.length>1||"string"!=typeof color?!1:rgb.test(color)||rgba.test(color)||hex.test(color)||hexShort.test(color)||hsl.test(color)||hsla.test(color)||CSSColors[color.toLowerCase()]},Color.getBestContrast=function(color,cl,cd){var lum=color.getLuminance();return Math.abs(lum-cl.getLuminance())>Math.abs(lum-cd.getLuminance())?cl:cd},Color.getContrast=function(color1,color2){if(color1&&color2){var l1=color1.getLuminance()/100,l2=color2.getLuminance()/100;return l1>l2?(l1+.05)/(l2+.05):(l2+.05)/(l1+.05)}},Color.isDark=function(){var o={getLuminance:Color.prototype.getLuminance};return Color.prototype.init.apply(o,[].slice.call(arguments)),Color.prototype.isDark.call(o)},Color.useDarkLabel=function(areaColor,bgIsDark){return areaColor._a>.5?!areaColor.isDark():!bgIsDark},Color}),define("objects.views/charts/utils/tree-iterator",[],function(){var iterator={getLevel:function(){if(this&&this.parent!==this){for(var p=this.parent,level=0;p;)level+=1,p=p.parent;return level}},each:function(fn){var i,children=this.children;if(children)for(i=0;i<children.length;i+=1){if(fn&&fn(children[i],i,children.length-1)===!1)return!1;if(iterator.each.call(children[i],fn)===!1)return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var i,nodes=[];for(i=0;i<this.children.length;i+=1)this.children[i]&&this.children[i].children&&this.children[i].children.length?nodes=nodes.concat(iterator.getLeaves.call(this.children[i])):nodes.push(this.children[i]);return nodes}};return iterator}),define("extensions.qliktech/barchart/layers/label-layer",["core.utils/class","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/color","objects.views/charts/utils/tree-iterator"],function(Class,CanvasRenderer,Matrix,Color){"use strict";function getLabelColor(inline,areaColor){return inline?Color.useDarkLabel(areaColor,bgIsDark)?localStyle.label.dark.color:localStyle.label.light.color:bgIsDark?localStyle.label.light.color:localStyle.label.dark.color}function createLabel(text,value,rect,opacity,color,labelRect,hintDirection){return{type:"text",fill:localStyle.label.dark.color,opacity:opacity||1,data:{value:value,rect:rect,labelRect:labelRect,hintDirection:hintDirection,color:color},shape:{text:text,maxNumLines:1,align:"center",baseline:"middle"}}}function getLabelFromStack(stackNode){var leaves,rects,rect,label;return leaves=stackNode.descendants.filter(function(c){return!c.isBranch&&c.data.isVisible!==!1}),rects=leaves.map(function(c){return c.data.hitRect}),rects.length?(rect=rects[0],rects.length>1&&(rect=rect.combineWith(rects.slice(-1)[0])),label=createLabel(stackNode.data.valueLabel,stackNode.data.sum,rect,leaves[leaves.length-1].opacity,leaves[leaves.length-1].data.color,null,null),label.data.isFillPattern=window.CanvasPattern&&leaves[leaves.length-1].fill instanceof window.CanvasPattern,label.data.lastRect=rects[rects.length-1],label):void 0}function getShapesToLabel(shapes,pool){var children,label;shapes.forEach(function(s){children=s.children,s.data.isStack?(label=getLabelFromStack(s),label&&(label.data.isStack=!0,pool.push(label))):children&&children.length?getShapesToLabel(children,pool):s.data.isVisible!==!1&&pool.push(createLabel(s.data.valueLabel,s.data.value,s.data.hitRect,s.opacity,s.data.color,s.data.labelRect,s.data.hintDirection))})}function merge(o,r){Object.keys(r).forEach(function(k){o[k]=r[k]})}function renderLabels(){var numLabels,label,i,dataValueFitsInBar,labels=[],axisMin=this.minorAxis.getPlotMin(),axisMax=this.minorAxis.getPlotMax(),font=localStyle.label.font,bounds=this.bounds;getShapesToLabel(this._shapes,labels),CanvasRenderer.setFont(font),this.renderer.setFont(font),labels=labels.filter(function(l){return"NaN"===l.data.value?!0:l.data.labelRect||l.data.showHintLabel?!0:l.data.value>=0&&axisMax>=l.data.value&&axisMin<=l.data.value?!0:l.data.value<0&&axisMin<=l.data.value&&axisMax>=l.data.value?!0:l.data.rect.width&&l.data.rect.height&&bounds.intersectsWith(l.data.rect)?!0:!1});var longestCustomLabel,bar,availableWidth;for(this._shapes&&this._shapes.length?(bar=this._shapes[0].descendants.filter(function(s){return!s.isBranch})[0],availableWidth=bar?bar.data.hitRect.width:this.majorAxis._discreteSpacing):availableWidth=0,longestCustomLabel=0,numLabels=labels?labels.length:0,i=0;numLabels>i;i++)label=labels[i],label.shape&&(label.shape.font=font,label.data.labelWidth=CanvasRenderer.getTextWidth(label.shape.text),longestCustomLabel=Math.max(longestCustomLabel,label.data.labelWidth));this._longestLabel=longestCustomLabel,dataValueFitsInBar=this._longestLabel<availableWidth;var fn;for(fn=this.minorAxis.isVertical()?dataValueFitsInBar?findBestFitOnVerticalBarForHorizontalLabels:findBestFitOnVerticalBarForVerticalLabels:findBestFitOnHorizontalBar,i=0;numLabels>i;i++)fn.call(this,labels[i],availableWidth);labels.slice().forEach(function(label){label.fill&&label.backdrop&&(labels.unshift({opacity:label.opacity||1,type:"roundRect",fill:backdropColor,shape:label.backdrop}),label.fill=bgIsDark?localStyle.label.light.color:localStyle.label.dark.color)}),this.renderer.shapes=labels,this.renderer.render()}function findBestFitOnVerticalBarForHorizontalLabels(label,availableSize){for(var rect,fontHeight=this.renderer.getFontHeight(localStyle.label.font),rects=getVerticalRectsForLabelPositioning.apply(this,[label,!1,availableSize]),i=0;i<rects.length;i++)if(merge(label.shape,rects[i].rect),fontHeight<rects[i].rect.height){rect=rects[i];break}if(rect){var remainder=rect.rect.width-label.data.labelWidth;merge(label.shape,rect.rect),label.shape.baseline=rect.baseline,label.shape.align=rect.align,label.data.isStack&&rect.inline&&(label.data.lastRect.height<20||label.data.isFillPattern)?label.backdrop={x:rect.rect.x+Math.min(remainder/2,4),y:"top"===rect.baseline?rect.rect.y:rect.rect.y+rect.rect.height-16,width:Math.max(rect.rect.width-Math.min(remainder,8)),height:16,radius:4}:(label.fill=getLabelColor(rect.inline,label.data.color),label.backdrop=!1)}else label.fill=!1}function findBestFitOnVerticalBarForVerticalLabels(label,availableSize){var m,i,rect,rects=getVerticalRectsForLabelPositioning.apply(this,[label,!0,availableSize]);m="labelWidth"in label.data?label.data.labelWidth:CanvasRenderer.getTextWidth(label.shape.text);for(i=0;i<rects.length;i++)if(rects[i].rect.height>=m){rect=rects[i];break}if(rect||(rects.sort(function(a,b){return.8*b.rect.height-a.rect.height}),rects[0].rect.height>=8&&(rect=rects[0])),rect){var matrix=new Matrix;matrix.translate(rect.rect.x,rect.rect.y+rect.rect.height),matrix.rotate(-Math.PI/2),merge(label.shape,{width:rect.rect.height,height:rect.rect.width,baseline:rect.baseline,align:rect.align,x:0,y:0}),label.transform=matrix.elements,label.data.isStack&&rect.inline&&(label.data.lastRect.height<m+4||label.data.isFillPattern)?label.backdrop={radius:4,x:rect.rect.x+rect.rect.width/2-8,y:"right"===rect.align?rect.rect.y-4:rect.rect.y+rect.rect.height-m-4,width:16,height:m+8}:(label.fill=getLabelColor(rect.inline,label.data.color),label.backdrop=!1)}else label.fill=!1}function getVerticalRectsForLabelPositioning(label,rotated,availableSize){var w,h,x,y,pad=rotated&&label.data.isStack?8:4,rects=[];return w=label.data.rect.width,h=label.data.rect.height,x=label.data.rect.x,y=label.data.rect.y,"up"!==label.data.hintDirection&&label.data.value>=0||"down"===label.data.hintDirection?(y-this.bounds.y-2*pad>4&&rects.push({align:rotated?"left":"center",baseline:rotated?"middle":"bottom",rect:{x:x-.5*(availableSize-w),y:this.bounds.y+pad,width:availableSize,height:y-this.bounds.y-2*pad}}),label.data.labelRect&&(w=label.data.labelRect.width,h=label.data.labelRect.height,x=label.data.labelRect.x,y=label.data.labelRect.y),label.data.hintDirection||rects.push({align:rotated?"right":"center",baseline:rotated?"middle":"top",inline:!0,rect:{x:x,y:y+pad,width:w,height:h-2*pad}})):(this.bounds.height-y-h-2*pad>0&&rects.push({align:rotated?"right":"center",baseline:rotated?"middle":"top",rect:{x:x-.5*(availableSize-w),y:y+h+pad,width:availableSize,height:this.bounds.height-y-h-2*pad}}),label.data.labelRect&&(w=label.data.labelRect.width,h=label.data.labelRect.height,x=label.data.labelRect.x,y=label.data.labelRect.y),label.data.hintDirection||rects.push({align:rotated?"left":"center",baseline:rotated?"middle":"bottom",inline:!0,rect:{x:x,y:y+pad,width:w,height:h-2*pad}})),rects}function findBestFitOnHorizontalBar(label,availableSize){var m,i,rects,rect;rects=getHorizontalRectsForLabelPositioning.apply(this,[label,availableSize]),m="labelWidth"in label.data?label.data.labelWidth:CanvasRenderer.getTextWidth(label.shape.text);for(i=0;i<rects.length;i++)if(rects[i].rect.width>=m){rect=rects[i];break}!rect&&rects.length&&(rects.sort(function(a,b){return.8*b.rect.width-a.rect.width}),rects[0].rect.width>=8&&(rect=rects[0])),rect?(label.shape.baseline="middle",label.shape.align=rect.align,merge(label.shape,rect.rect),label.data.isStack&&rect.inline&&(label.data.lastRect.width<m+8||label.data.isFillPattern)?label.backdrop={y:rect.rect.y+rect.rect.height/2-8,height:16,x:("right"===rect.align?rect.rect.x+rect.rect.width-m:rect.rect.x)-4,width:m+8,radius:4}:(label.fill=getLabelColor(rect.inline,label.data.color),label.backdrop=!1)):label.fill=!1}function getHorizontalRectsForLabelPositioning(label){var w,h,x,y,pad=label.data.isStack?8:4,rects=[];return w=label.data.rect.width,h=label.data.rect.height,x=label.data.rect.x,y=label.data.rect.y,"right"!==label.data.hintDirection&&label.data.value>=0||"left"===label.data.hintDirection?(this.bounds.width-x-w-2*pad>0&&rects.push({align:"left",rect:{x:x+w+pad,y:y,width:this.bounds.width-x-w-2*pad,height:h}}),label.data.labelRect&&(w=label.data.labelRect.width,h=label.data.labelRect.height,x=label.data.labelRect.x,y=label.data.labelRect.y),label.data.hintDirection||rects.push({align:"right",inline:!0,rect:{x:x+pad,y:y,width:w-2*pad,height:h}})):(x-this.bounds.x-2*pad&&rects.push({align:"right",rect:{x:this.bounds.x+pad,y:y,width:x-this.bounds.x-2*pad,height:h}}),label.data.labelRect&&(w=label.data.labelRect.width,h=label.data.labelRect.height,x=label.data.labelRect.x,y=label.data.labelRect.y),label.data.hintDirection||rects.push({align:"left",inline:!0,rect:{x:x+pad,y:y,width:w-2*pad,height:h}})),rects}var LabelLayer,localStyle,backdropColor,bgColor,bgIsDark;return LabelLayer=Class.extend("LabelLayer",{init:function(container){this.renderer=new CanvasRenderer(container)},setData:function(d){this._data=d},setMeasureIndices:function(){},setBarData:function(d){this._barData=d},setShapes:function(d){this._shapes=d},show:function(){this.renderer.show()},hide:function(){this.renderer.hide()},clear:function(){this.renderer.clear()},release:function(){this.renderer.release()},render:function(){localStyle=this.style.dataPoints,bgColor=new Color(this.style.backgroundColor),bgIsDark=bgColor.isDark(),backdropColor=Color.toRGBA(bgColor,.75),renderLabels.call(this)}})}),define("core.utils/theme",["util","core.utils/notification","general.utils/property-resolver","text!themes/sense/theme.json","require"],function(Util,Notification,PropertyResolver,jsonTheme,require){"use strict";function injectStyleNode(themeName){var style=document.createElement("link");return style.setAttribute("rel","stylesheet"),style.setAttribute("href",require.toUrl("themes/"+themeName+"/theme.css")),document.head.appendChild(style),style}function injectJSONStyles(jsonTheme,applyExclusions){jsonTheme=JSON.parse(jsonTheme),Util.extend(!0,themeAPI,defaults,jsonTheme),applyExclusions&&extendExclusions.forEach(function(element){var prop=PropertyResolver.getValue(jsonTheme,element);void 0!==prop&&PropertyResolver.setValue(themeAPI,element,prop)}),currentThemeJSON=jsonTheme}function apply(themeName){var style=injectStyleNode(themeName);return require(["text!themes/"+themeName+"/theme.json"],function(jsonTheme){injectJSONStyles(jsonTheme,!0),themeAPI.ThemeChanged.emit()}),style}function cleanCurrentTheme(){currentThemeNode.parentNode.removeChild(currentThemeNode),Object.keys(currentThemeJSON).forEach(function(key){delete themeAPI[key]})}var defaults=JSON.parse(jsonTheme),defaultTheme="sense",currentTheme=null,currentThemeNode=null,currentThemeJSON={},extendExclusions=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],themeAPI={};return Notification.create(themeAPI,"ThemeChanged"),Object.defineProperty(themeAPI,"name",{iterable:!1,get:function(){return currentTheme||defaultTheme}}),themeAPI.set=function(theme){theme.indexOf("/")>-1||theme!==currentTheme&&(currentTheme&&cleanCurrentTheme(),theme&&(currentThemeNode=apply(theme),currentTheme=theme))},injectStyleNode("sense"),injectJSONStyles(jsonTheme),themeAPI}),/*!
 * mqa.js
 * https://github.com/peol/mqa.js/
 * MIT/GPL Dual License, use whatever fits your project.
 * Copyright(C) Andrée Hansson (@peolanha) 2013
 */
function(window,document){"use strict";function toArray(arrayLike){return Array.prototype.slice.apply(arrayLike)}function createHandler(alias){return function(mql){var stack=callbacks[alias];stack&&(log("Media query triggered for alias",alias),stack.forEach(function(callback){callback(mql.matches)}))}}function bind(alias){var mql=matchMedia(queries[alias]),cb=unbindCallbacks[alias]=createHandler(alias);cb.mql=mql,log("Binding",alias),mql.addListener(cb)}function unbind(alias){var unbindCallback=unbindCallbacks[alias];unbindCallback&&(log("Unbinding",alias),unbindCallback.mql.removeListener(unbindCallback)),delete callbacks[alias],delete unbindCallbacks[alias]}function log(){if(DEBUG){var args=toArray(arguments);args.unshift("[mqa.js]"),console.log.apply(console,args)}}var DEBUG=!1,callbacks={},unbindCallbacks={},queries={},origin=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),mqa={};mqa.add=function(alias,query){log("Creating alias",alias,"with query",query),queries[alias]=query},mqa.remove=function(alias){log("Removing alias",alias);var exist=queries.hasOwnProperty(alias);return exist&&(unbind(alias),delete queries[alias]),exist},mqa.parse=function(){log("Parsing CSS rules"),toArray(document.styleSheets).forEach(function(sheet){var isOutsideOfDomain=sheet.href&&0!==sheet.href.indexOf("/")&&0!==sheet.href.indexOf(origin);try{if(isOutsideOfDomain||null===sheet.cssRules)return}catch(e){return}toArray(sheet.cssRules).forEach(function(rule){if(rule&&rule instanceof CSSMediaRule){var alias=/#-mqa-alias-(\w+)\s*?\{/.exec(rule.cssText);alias&&mqa.add(alias[1],rule.media.mediaText)}})})},mqa.on=function(alias,callback){var stack=callbacks[alias];stack||(stack=[],bind(alias)),stack.push(callback),callbacks[alias]=stack,log("Added new listener on",alias,callback)},mqa.off=function(alias,callback){var stack=callbacks[alias];if(stack){var index=stack.indexOf(callback);stack.splice(index,1),stack.length||unbind(alias)}log("Removed listener from",alias,callback)},mqa.match=function(alias){var query=queries[alias],result=!1;return query&&(result=matchMedia(query).matches),result},Object.defineProperty(mqa,"queries",{get:function(){return JSON.parse(JSON.stringify(queries))}}),mqa.parse(),"function"==typeof define&&define.amd?define("mqa",mqa):window.mqa=mqa}(window,document),define("general.utils/responsive-state",["mqa","core.utils/notification"],function(mqa,Notification){"use strict";var currentIsSmallDevice,currentOrientation,ResponsiveState={};return ResponsiveState.Orientation={portrait:"portrait",landscape:"landscape"},Notification.mixin(ResponsiveState),ResponsiveState.notification("ViewChanged"),ResponsiveState.notification("OrientationChanged"),currentIsSmallDevice=mqa.match("smalldevice"),currentOrientation=mqa.match("portrait")?ResponsiveState.Orientation.portrait:ResponsiveState.Orientation.landscape,mqa.on("smalldevice",function(enabled){currentIsSmallDevice=enabled,ResponsiveState.ViewChanged.emit(currentIsSmallDevice)}),"undefined"==typeof window.orientation?mqa.on("portrait",function(enabled){currentOrientation=enabled?ResponsiveState.Orientation.portrait:ResponsiveState.Orientation.landscape,ResponsiveState.OrientationChanged.emit(currentOrientation)}):window.onorientationchange=function(){currentOrientation=ResponsiveState.Orientation.landscape,(0===window.orientation||180===window.orientation)&&(currentOrientation=ResponsiveState.Orientation.portrait),ResponsiveState.OrientationChanged.emit(currentOrientation),currentIsSmallDevice&&currentOrientation===ResponsiveState.Orientation.landscape&&window.scrollTo&&window.scrollTo(0,0)},Object.defineProperties(ResponsiveState,{isSmallDevice:{get:function(){return currentIsSmallDevice}},orientation:{get:function(){return currentOrientation}}}),document.body.scrollTop=document.documentElement.scrollTop=0,ResponsiveState}),define("objects.views/charts/chart-style-service",["core.utils/class","core.utils/theme","general.utils/responsive-state"],function(Class,theme,ResponsiveState){"use strict";function resolveVariable(value,variables){if("string"==typeof value&&"@"===value[0]){var ref=value.substring(1);return variables[ref]?resolveVariable(variables[ref],variables):value}return value}function stepToBestFit(obj,path,attribute,subPath,defaultValue){var i,steps=path.split("."),dataContainer=obj,currentValue=defaultValue;for(void 0!==dataContainer[attribute]&&(currentValue=dataContainer[attribute]),i=0;i<steps.length;++i){if(void 0===dataContainer[steps[i]])return currentValue;dataContainer=dataContainer[steps[i]],void 0!==dataContainer[attribute]&&(currentValue=dataContainer[attribute])}return void 0!==dataContainer[attribute]&&(currentValue=dataContainer[attribute]),["string","number","boolean","array"].contains(typeof currentValue)?currentValue:currentValue?void 0!==currentValue["default"]||void 0!==subPath?checkSubPath(currentValue,subPath,defaultValue):defaultValue:null}function checkSubPath(obj,path){var steps,i,dataContainer=obj,currentValue=obj["default"];if(!path)return currentValue;for(steps=path.split("."),i=0;i<steps.length;++i){if(void 0===dataContainer[steps[i]])return currentValue;dataContainer=dataContainer[steps[i]],currentValue=dataContainer}return currentValue}function buildVariables(input){input=input||{};var out=input;return out}function scaleFont(fontSize,scaling){return fontSize=fontSize.substring(0,fontSize.length-2),fontSize*=scaling,fontSize+"px"}var ChartStyleService,instance;return ChartStyleService=Class.extend("ChartStyleService",{init:function(){this._baseStyle=theme,this._chartStyles=theme,this._fontCache={},this._variables=buildVariables(theme._variables);var self=this;theme.ThemeChanged.bind(function(){self._variables=buildVariables(theme._variables)})},getValue:function(id,path,attribute,subPath,defaultValue){return id=id||"",""===id||this._chartStyles[id]?(""!==id&&(id+="."),path&&(id+=path),resolveVariable(stepToBestFit(this._chartStyles,id,attribute,subPath,defaultValue),this._variables)):defaultValue},getFont:function(id,path,subPath,defaultValue,explicitPixelSize,scaling){if(id=id||"",scaling=scaling||1,""===id||this._chartStyles[id]){""!==id&&(id+="."),path&&(id+=path);var cachePath=subPath?id+"."+subPath:id;if(this._fontCache[cachePath])return this._fontCache[cachePath];var lh=stepToBestFit(this._chartStyles,id,"lineHeight",subPath),ff=stepToBestFit(this._chartStyles,id,"fontFamily",subPath),fontArray=[stepToBestFit(this._chartStyles,id,"fontStyle",subPath)||"",stepToBestFit(this._chartStyles,id,"fontVariant",subPath)||"",stepToBestFit(this._chartStyles,id,"fontWeight",subPath)||"",stepToBestFit(this._chartStyles,id,"fontStretch",subPath)||"",explicitPixelSize||0===explicitPixelSize?explicitPixelSize+"px":scaleFont(stepToBestFit(this._chartStyles,id,"fontSize",subPath)||"12px",scaling),lh?"/"+lh:"",ff?"'"+ff+"'":"'Qlikview Sans'"];return fontArray=fontArray.filter(function(item){return""!==item}),this._fontCache[id+"."+subPath]=fontArray.join(" "),this._fontCache[id+"."+subPath]}return defaultValue}}),instance=new ChartStyleService,instance.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full",m:"mobile"},instance.getLayoutKey=function(mode){return ResponsiveState.isSmallDevice?this.layoutMap.m:this.layoutMap[mode]},{getInstance:function(){return instance}}}),define("extensions.qliktech/barchart/style",[],function(){return{dataPoint:{label:{dark:{color:"#666"},light:{color:"#eee"},font:"11px 'QlikView Sans'"}},shape:{selected:{border:{color:"#333",width:2}},unselected:{opacity:.5},highlighted:{border:{dark:{color:"rgba( 26, 26, 26, 0.75 )"},light:{color:"rgba( 230, 230, 230, 0.75)"},width:1}}}}}),define("extensions.qliktech/barchart/bararea",["objects.views/charts/components/chart-component","./layers/bar-layer","./layers/label-layer","general.utils/color","objects.utils/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","objects.views/charts/chart-style-service","core.utils/deferred","./style"],function(ChartComponent,BarLayer,LabelLayer,Color,Rect,Container,DisplayPolygon,DisplayRect,ChartStyleService,Deferred){"use strict";function getPattern(color){var ratio=1;return dummyCanvas.width=5*ratio,dummyCanvas.height=5*ratio,ctx.save(),ctx.fillStyle=Color.toRGBA(color,.8),ctx.scale(ratio,ratio),ctx.fillRect(0,0,1,1),ctx.fillRect(0,1,1,1),ctx.fillRect(1,0,1,1),ctx.fillRect(4,1,1,1),ctx.fillRect(4,2,1,1),ctx.fillRect(3,2,1,1),ctx.fillRect(3,3,1,1),ctx.fillRect(2,3,1,1),ctx.fillRect(2,4,1,1),ctx.fillRect(1,4,1,1),ctx.restore(),ctx.createPattern(dummyCanvas,"repeat")}function updateStyles(styleService,layoutMode){var mode=styleService.layoutMap[layoutMode]||"medium",style={shape:{selected:{border:{color:styleService.getValue(chartID,"shape.border","color","selected"),width:styleService.getValue(chartID,"shape.border","width","selected")}}},dataPoints:{label:{font:styleService.getFont(chartID,"value",mode),dark:{color:styleService.getValue(chartID,"value","color","dark")},light:{color:styleService.getValue(chartID,"value","color","light")}}},backgroundColor:styleService.getValue(chartID,null,"backgroundColor")};return style}var BarArea,chartID="barChart",STACKED="stacked",GROUPED="grouped",dummyCanvas=document.createElement("canvas"),ctx=dummyCanvas.getContext("2d");return BarArea=ChartComponent.extend("BarArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._barData=[],this._showDataPoints=!0,this._colorMap=null,this._groupingMode=GROUPED,this._globalAlpha=1,this._styleService=ChartStyleService.getInstance(),this._barLayer=new BarLayer(this.container),this._barLayer.isMini=this.isMini,this.layers=[this._barLayer],this.isMini||(this._labelLayer=new LabelLayer(this.container),this.layers.push(this._labelLayer))},beforeBarsAddedToRenderer:function(){},barsAddedToRenderer:function(){},labelAddedToRenderer:function(){},afterPaint:function(){return Deferred.resolve()},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setShowDataPoints:function(l){this._showDataPoints=l,this.invalidateDisplay("BarArea.setShowDataPoints")},getShowDataPoints:function(){return this._showDataPoints},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(v){this._measureIndices=v},setMajorAxis:function(ax){this._majorAxis=ax,this._majorAxis.listen("changed",function(){this.invalidateDisplay("BarArea.setMajorAxis")},this)},setMinorAxis:function(ax){this._minorAxis=ax,this._minorAxis.listen("changed",function(){this._localFormatting&&(this._areLabelsFormatted=!1),this.invalidateDisplay("BarArea.setMinorAxis")},this)},setDimensionTree:function(t){this._tree=t},setGroupingMode:function(m){this._groupingMode=m},_updateSize:function(){this.invalidateDisplay("BarArea._updateSize")},insertAdjacentTo:function(layoutRect,reduceLayoutRect){if(this._super(layoutRect,reduceLayoutRect),this._minorAxis&&this._minorAxis.isHorizontal())switch(this._minorAxis.dock){case"bottom":this.rect.height-=1}},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},setCacheItems:function(v){this._cacheItems=v},getCacheItems:function(){return this._cacheItems},createAxisData:function(data,staticProps,dynamicProps,level){level||(this._cacheIndex=0);var i,doStackChildren=staticProps.stackLevel===level+1,dataChildren=data.children;return"measure"===staticProps.types[level]&&this._measureIndices&&(dataChildren=dataChildren.filter(function(c,idx){return this._measureIndices.indexOf(idx)>=0},this)),dataChildren.map(function(d){var obj;if("dimension"===staticProps.types[level]){if(obj={label:d.data.qText,group:"dimension"===staticProps.types[level+1]||"measure"===staticProps.types[level+1]&&staticProps.numMeasures>1,id:d.data.id,cacheIndex:[]},"measure"===staticProps.types[level+1])for(i=0;i<staticProps.numMeasures;i++)obj.cacheIndex.push(this._cacheIndex++);!doStackChildren&&("dimension"===staticProps.types[level+1]||"measure"===staticProps.types[level+1]&&staticProps.numMeasures>1)&&(obj.children=this.createAxisData(d,staticProps,dynamicProps,level+1))}else"measure"===staticProps.types[level]&&(obj={label:d.data.qText,id:d.data.id});return obj}.bind(this))},_createMeasureDisplayNode:function(dataNode,measureIndex){if(dataNode.isBranch){var c=this.isMini===!0||this._isStacked?new DisplayRect:new DisplayPolygon,nodeChildren=dataNode.children,valueNode=nodeChildren[0].data,cacheItem=dataNode.parent.cacheItem,hitRect=new Rect(0,0,0,0),formatter=this.measureFormatters[measureIndex],value="undefined"!=typeof valueNode.qValue?valueNode.qValue:valueNode.qNum,ids=dataNode.ancestors.filter(function(d){return"qElemNo"in d.data}).map(function(d){return d.data.qElemNo}).reverse();return c.data={qText:dataNode.data.qText,measureIndex:measureIndex,value:value,start:0,end:value,valueLabel:dataNode.children[0].data.qText,formatted:!formatter||"U"!==formatter.type,hitRect:hitRect,cacheItem:cacheItem,color:this._colorMap.getColor(ids,value,measureIndex,dataNode.data.rowIndex)},cacheItem.addShape("dataArea",hitRect,!0),cacheItem.calculateTooltipPosition=!0,c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c}},_createDimensionDisplayNode:function(dataNode){var c=new Container;return c.data={qText:dataNode.data.qText,qElemNo:dataNode.data.qElemNo,qMaxPos:dataNode.data.qMaxPos,qMinNeg:dataNode.data.qMinNeg,qType:dataNode.data.qType},c},_createStackNode:function(){var c=new Container;return c.data={stack:!0},c},_createOtherNode:function(start,end){var c=new DisplayRect,hitRect=new Rect(0,0,0,0),formatter=this.measureFormatters[0];return c.data={measureIndex:0,value:end-start,start:start,end:end,isFakeOtherCell:!0,highlightOnGroupSelect:0===this._selectionIndices[0],valueLabel:"valueLabel",formatted:!formatter||"U"!==formatter.type,hitRect:hitRect,cacheItem:{},color:this._colorMap.getColor([-3],end-start,0,0)},c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c},_addOtherNode:function(stack,end,parentDataNode){var otherDimensionNode=this._createDimensionDisplayNode({data:{qMaxPos:0,qMinNeg:0,qElemNo:-3,qType:"O"}}),otherMeasureNode=this._createOtherNode(stack.data.sum,end);return otherMeasureNode.data.axisId=parentDataNode.data.id,otherMeasureNode.data.cacheItem=parentDataNode.cacheItem,otherDimensionNode.addChild(otherMeasureNode),stack.data.sum=end,stack.addChild(otherDimensionNode),otherMeasureNode},_stackNodes:function(nodes,parent,parentNode,shapes){var temp,sum,measureNodeData,hasPositive,hasNegative,pos=this._createStackNode(),neg=this._createStackNode(),hasPosOther=!1,hasNegOther=!1,localPosSum=0,localNegSum=0;pos.data.isStack=!0,neg.data.isStack=!0,nodes.forEach(function(child){temp=parent,measureNodeData=child.children&&child.children[0]?child.children[0].data:child.data,measureNodeData.value>=0?(temp=pos,measureNodeData.start=localPosSum,localPosSum+=measureNodeData.value,measureNodeData.end=localPosSum,sum=localPosSum,hasPositive=!0,temp.addChild(child),"O"===child.data.qType&&(hasPosOther=!0)):isNaN(measureNodeData.value)||(temp=neg,measureNodeData.start=localNegSum,localNegSum+=measureNodeData.value,measureNodeData.end=localNegSum,sum=localNegSum,hasNegative=!0,temp.addChild(child),"O"===child.data.qType&&(hasNegOther=!0)),temp.data.sum=sum}),"undefined"==typeof parent.data.qMaxPos||hasPosOther||localPosSum===parent.data.qMaxPos||(shapes.push(this._addOtherNode(pos,parent.data.qMaxPos,parentNode)),localPosSum=pos.data.sum,hasPositive=localPosSum>0),"undefined"==typeof parent.data.qMinNeg||hasNegOther||localNegSum===parent.data.qMinNeg||(shapes.push(this._addOtherNode(neg,parent.data.qMinNeg,parentNode)),localNegSum=neg.data.sum,hasNegative=0>localNegSum),hasPositive&&(pos.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(pos.data.sum):pos.data.sum+"",parent.addChild(pos)),hasNegative&&(neg.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(neg.data.sum):neg.data.sum+"",parent.addChild(neg)),parent.data.sum={positive:localPosSum,negative:localNegSum}},getRenderTree:function(data,staticProps,dynamicProps,level){var temp,children,dataChildren,i,num,cntnr,d,doStack=staticProps.stackLevel===level+1,result=[];for(dataChildren=data.children,"measure"===staticProps.types[level]&&this._measureIndices&&(dataChildren=dataChildren.filter(function(c,idx){return this._measureIndices.indexOf(idx)>=0},this)),num=dataChildren.length,i=0;num>i;i++)if(d=dataChildren[i],"dimension"===staticProps.types[level])cntnr=this._createDimensionDisplayNode(d),children=this.getRenderTree(d,staticProps,dynamicProps,level+1),doStack?(this._stackNodes(children,cntnr,d,dynamicProps.otherShapes),dynamicProps.globalPositiveSum=Math.max(dynamicProps.globalPositiveSum,cntnr.data.sum.positive),dynamicProps.globalNegativeSum=Math.min(dynamicProps.globalNegativeSum,cntnr.data.sum.negative)):cntnr.addChildren(children),cntnr.isBranch&&result.push(cntnr);else if("measure"===staticProps.types[level]){if(cntnr=this._createMeasureDisplayNode(d,this._measureIndices?this._measureIndices[i]:i),!cntnr)continue;temp=d,staticProps.numMeasures<=1&&(temp=temp.parent),staticProps.stackLevel===level&&(temp=temp.parent),cntnr.data.axisId=temp.data.id,dynamicProps.shapes.push(cntnr),result.push(cntnr)}return result},_applyIds:function(data,cols,types,level){var temp;data.children.forEach(function(d,idx){temp=data.data.id?data.data.id+";"||"":"","dimension"===types[level]?(d.data.id=temp+cols[level]+":"+d.data.qElemNo,this._applyIds(d,cols,types,level+1)):"measure"===types[level]&&(d.data.id=temp+cols[level+idx])}.bind(this))},_updateProperties:function(){if(this._data&&this._tree){this._barLayer.renderer.stage.removeChildren();var numDimensions=this._data.qHyperCube.qDimensionInfo.length,numMeasures=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,isStacked=this._groupingMode===STACKED&&(numDimensions>1||numMeasures>1),numLevels=numDimensions+1,stackLevel=-2,levelTypes=new Array(numDimensions).join(",").split(",").map(function(){return"dimension"}),colIds=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(o){return o.cId}),qApprMaxGlyphCount=this._data.qHyperCube.qDimensionInfo.map(function(d){return d.qApprMaxGlyphCount});levelTypes.push("measure"),qApprMaxGlyphCount.push(this._data.qHyperCube.qMeasureInfo.reduce(function(prev,current){return Math.max(prev,current.qApprMaxGlyphCount)},0)),isStacked&&(stackLevel=numMeasures>1?numDimensions:numDimensions-1),this._isStacked=isStacked;var dynamicProps={columns:[],shapes:[],shapesToLabel:[],otherShapes:[],globalPositiveSum:0,globalNegativeSum:0},staticProps={colIds:colIds,types:levelTypes,numLevels:numLevels,numMeasures:numMeasures,stackLevel:stackLevel};numDimensions>1&&this._allowInnerSelection&&!this._data.qHyperCube.qDimensionInfo[1].qLocked?(this.setSelectionIndices([1]),this._majorAxis.setSelectionIndices([1]),this._majorAxis.setCurrentDataIndices([1])):(this.setSelectionIndices([0]),this._majorAxis.setSelectionIndices([0]),this._majorAxis.setCurrentDataIndices([0])),this._applyIds(this._tree,colIds,levelTypes,0);var objects=this.getRenderTree(this._tree,staticProps,dynamicProps,0);this._objects=objects,this._formatted=this._isStacked||this.measureFormatters.every(function(m,i){var isMeasureUsed=this._measureIndices?this._measureIndices.indexOf(i)>=0:!0;return isMeasureUsed?"U"!==m.type:!0},this),this._shapes=dynamicProps.shapes;var cacheItems=dynamicProps.shapes.map(function(s){return s.data.cacheItem});this._shapes=this._shapes.concat(dynamicProps.otherShapes),objects.forEach(function(o){this._barLayer.renderer.stage.addChild(o)}.bind(this));var axisDataArray=this.createAxisData(this._tree,staticProps,dynamicProps,0),axisLabelLevelsDetails=levelTypes.map(function(v,idx){return{qApprMaxGlyphCount:qApprMaxGlyphCount[idx],show:idx<levelTypes.length-1}});this._majorAxisData={data:axisDataArray,info:axisLabelLevelsDetails,groupSize:isStacked?null:numMeasures},this._numDimensions=numDimensions,this._numMeasures=numMeasures,this._minorAxisData=isStacked?{min:dynamicProps.globalNegativeSum,max:dynamicProps.globalPositiveSum}:null,this.setSelectableShapes(cacheItems)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree&&(this._data.qHyperCube.qStackedDataPages.length>0||this._data.qHyperCube.qDataPages.length>0)},updateSize:function(){this._super(),this.layers.forEach(function(layer){layer.rect=this.rect,layer.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y),layer.renderer.setDimensions(0,0,this.rect.width,this.rect.height)},this)},paint:function(){this._super(this._layoutMode,this._data),this._majorAxis.updateNow(),this._minorAxis.updateNow();var minorAxisPadding=this._minorAxis.getPadding(),bounds=new Rect,self=this;return this._style=updateStyles(this._styleService,this._layoutMode),bounds.set(minorAxisPadding.left,minorAxisPadding.top,this.rect.width-minorAxisPadding.left-minorAxisPadding.right,this.rect.height-minorAxisPadding.top-minorAxisPadding.bottom),this.layers.forEach(function(layer){layer.minorAxis=this._minorAxis,layer.majorAxis=this._majorAxis,layer.shapes=this._shapes,layer.othersFillPattern=getPattern(this._colorMap.getColor([-3])),layer.groupingMode=this._groupingMode,layer.widthRatio=this._numDimensions<=1&&this._numMeasures<=1||this._groupingMode===STACKED?.7:.95,layer.isSpikingEnabled=!(this.isMini||this._groupingMode===STACKED&&(this._numDimensions>1||this._numMeasures>1)),layer.isHintingEnabled=!this.isMini&&(this._groupingMode===GROUPED||this._groupingMode===STACKED&&this._numDimensions+this._numMeasures<=2),layer.style=this._style,layer._globalAlpha=this._globalAlpha},this),this._barLayer.colorMap=this._colorMap,this._barLayer.update(),this.nodesInView=this._barLayer.nodesInView,this.barsAddedToRenderer(),this._labelLayer&&(this._labelLayer.setShapes(this._objects),this._labelLayer.bounds=bounds,this._labelLayer._longestLabel=20,this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPoints?(this._formatLabels(),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide()),this._barLayer.render().then(function(){return self.afterPaint()})},_formatLabels:function(){if(!this._isStacked&&!this._formatted){var i,d,num=this.nodesInView?this.nodesInView.length:0;for(i=0;num>i;i++)d=this.nodesInView[i].data,d.formatted||(d.formatted=!0,d.valueLabel=this.measureFormatters[d.measureIndex]?this.measureFormatters[d.measureIndex].formatValue(d.value):d.valueLabel)}},clear:function(){this._super(),this.layers.forEach(function(layer){layer.clear()})},release:function(){this.layers.forEach(function(layer){layer.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this)}})}),define("client.utils/property-hypercube-helper",["general.utils/property-resolver"],function(propertyResolver){var hcHelper={getDimensions:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qDimensions",[])},getNumDimensions:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qDimensions.length",0)},getMeasures:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qMeasures",[])},getNumMeasures:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qMeasures.length",0)},getDimensionLayouts:function(layout){return layout&&layout.qHyperCube?layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(cId,layout){return this.getDimensionLayouts(layout).filter(function(item){return cId===item.cId})[0]},getMeasureLayouts:function(layout){return layout&&layout.qHyperCube?layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(cId,layout){return this.getMeasureLayouts(layout).filter(function(item){return cId===item.cId})[0]}};return hcHelper}),define("client.utils/default-property-logic",["general.utils/property-resolver","client.utils/property-hypercube-helper"],function(propertyResolver,propHcHelper){function schemeIsReverse(data){return propertyResolver.getValue(data,"color.reverseScheme")!==!0}function expressionIsValue(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!1}function expressionIsColor(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!0}function showDimensionIdOption(data){var auto=propertyResolver.getValue(data,"color.auto"),mode=propertyResolver.getValue(data,"color.mode"),measures=propHcHelper.getNumMeasures(data),dims=propHcHelper.getNumDimensions(data);return dims>1&&1>=measures&&!auto&&"byDimension"===mode}function showCompressionResolution(layout){var dim=propHcHelper.getDimensionLayouts(layout)[0];return dim&&dim.qCardinal>compressionTreshold}function retriveLogic(chart,collection){var targetPatch=chartMap[chart]||defaultPatch;return targetPatch[collection]||defaultPatch[collection]}var compressionTreshold=1e3,defaultPatch={showLegend:function(data){var auto=propertyResolver.getValue(data,"color.auto"),mode=propertyResolver.getValue(data,"color.mode"),expressionIsColor=propertyResolver.getValue(data,"color.expressionIsColor"),numDim=propHcHelper.getNumDimensions(data),numMea=propHcHelper.getNumMeasures(data);return auto&&(numDim>1||numMea>1)||!auto&&"primary"!==mode&&("byExpression"!==mode||!expressionIsColor)},colorModeOptions:{primary:function(){return!0},dimension:function(data){return propHcHelper.getNumMeasures(data)<=1},multiColor:function(data){return propHcHelper.getNumMeasures(data)>1},measure:function(data){return 1===propHcHelper.getNumMeasures(data)},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}},persistentColorsShow:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)<=1},expressionLabelChange:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.label=propertyResolver.getValue(itemData,"color.expressionLabel"),colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},attributeExpressionChange:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.type="colorByExpression",colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},attributeExpressionGlobalChange:function(data){var i,index,currentAttribs,measures=propertyResolver.getValue(data,"qHyperCubeDef.qMeasures",[]),disabledMeasures=propertyResolver.getValue(data,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),colorByAttrib=null,elTypeFunc=function(element,j){"colorByExpression"===element.type&&(index=j)};if(measures.length+disabledMeasures.length>1){for(i=disabledMeasures.length-1;i>=0;--i)currentAttribs=disabledMeasures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);for(i=measures.length-1;i>=0;--i)currentAttribs=measures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);!measures[0].qAttributeExpressions&&colorByAttrib&&(measures[0].qAttributeExpressions=[]),colorByAttrib&&measures[0].qAttributeExpressions.splice(0,0,colorByAttrib)}var exps=propertyResolver.getValue(data,"color.colorExpression");1!==measures.length||measures[0].qAttributeExpressions&&0!==measures[0].qAttributeExpressions.length||!exps||(measures[0].qAttributeExpressions=[{qExpression:exps,type:"colorByExpression"}])}},pieChartPatch={showLegend:function(data){var auto=propertyResolver.getValue(data,"color.auto"),expressionIsColor=propertyResolver.getValue(data,"color.expressionIsColor"),mode=propertyResolver.getValue(data,"color.mode");return!(!auto&&"primary"===mode||!auto&&"byExpression"===mode&&(expressionIsColor||void 0===expressionIsColor))}},scatterPlotPatch={colorModeOptions:{primary:function(){return!0},dimension:function(){return!0},multiColor:function(){return!1},measure:function(){return!1},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}},showLegend:function(data){return"primary"!==propertyResolver.getValue(data,"color.mode")&&!propertyResolver.getValue(data,"color.auto")},persistentColorsShow:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")}},lineChartPatch={colorModeOptions:{primary:function(){return!0},dimension:function(data){return propHcHelper.getNumDimensions(data)>1},multiColor:function(data){return propHcHelper.getNumMeasures(data)>1},measure:function(data){return 1===propHcHelper.getNumMeasures(data)&&propHcHelper.getNumDimensions(data)<=1},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}}},chartMap={scatterplot:scatterPlotPatch,piechart:pieChartPatch,linechart:lineChartPatch},propertyLogic=function(mode,chart){var colorModeOptionsFunc=retriveLogic(chart,"colorModeOptions"),persistentColorsShowFunc=retriveLogic(chart,"persistentColorsShow"),expressionLabelChangeFunc=retriveLogic(chart,"expressionLabelChange"),attributeExpressionChangeFunc=retriveLogic(chart,"attributeExpressionChange"),attributeExpressionGlobalChangeFunc=retriveLogic(chart,"attributeExpressionGlobalChange");this.helpers={schemeIsReverse:schemeIsReverse,showDimensionIdOption:showDimensionIdOption,showCompressionResolution:showCompressionResolution,colorModeOptions:colorModeOptionsFunc},this.color={colorMode:{options:function(data){var options=[];return"explore"===mode&&options.push({value:"auto",translation:"Common.Auto"}),colorModeOptionsFunc.primary(data)&&options.push({value:"primary",translation:"properties.colorMode.primary"}),colorModeOptionsFunc.multiColor(data)&&options.push({value:"byDimension",translation:"properties.colorMode.multicolored"}),colorModeOptionsFunc.dimension(data)&&options.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),colorModeOptionsFunc.measure(data)&&options.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),colorModeOptionsFunc.expression(data)&&"explore"!==mode&&options.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),options},show:function(data){return!propertyResolver.getValue(data,"color.auto")}},singleColor:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"primary"===propertyResolver.getValue(data,"color.mode")}},persistentColors:{show:persistentColorsShowFunc,readOnly:function(data){return propertyResolver.getValue(data,"qHyperCubeDef.qDimensions.length")>1}},attributeExpression:{change:attributeExpressionChangeFunc,globalChange:attributeExpressionGlobalChangeFunc,show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)>0}},expressionIsColor:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)>0}},expressionLabel:{change:expressionLabelChangeFunc,show:function(data){return!propertyResolver.getValue(data,"color.auto")&&expressionIsValue(data)&&propHcHelper.getNumMeasures(data)>0}},colorSchemeMeasure:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data));
}},reverseScheme:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))}},colorSchemeDimension:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")}},customRange:{show:function(data){return!propertyResolver.getValue(data,"color.auto")},autoMinMax:{show:function(data){return"byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data)}},min:{show:function(data){return("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))&&propertyResolver.getValue(data,"color.autoMinMax")===!1},invalid:function(data){return"minMax"===propertyResolver.getValue(data,"color.minMax")?propertyResolver.getValue(data,"color.measureMin")>=propertyResolver.getValue(data,"color.measureMax"):!1}},max:{show:function(data){return("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))&&propertyResolver.getValue(data,"color.autoMinMax")===!1},invalid:function(data){return"minMax"===propertyResolver.getValue(data,"color.minMax")?propertyResolver.getValue(data,"color.measureMin")>=propertyResolver.getValue(data,"color.measureMax"):!1}}}};var showLegendFunc=retriveLogic(chart,"showLegend");this.legend={show:showLegendFunc,showTitle:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&showLegendFunc(data)&&!expressionIsColor(data)}},dock:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&showLegendFunc(data)}}}};return{getLogicFor:function(mode,chart){return new propertyLogic(mode,chart)}}}),define("extensions.qliktech/barchart/barchart-properties",["translator","client.utils/default-property-logic"],function(translator,propertyLogicModule){function getMeasures(data,handler){return handler?handler.getMeasureLayouts():data.qHyperCubeDef.qMeasures.map(function(m){return m.qDef})}function getDimensions(data,handler){return handler?handler.getDimensionLayouts():data.qHyperCubeDef.qDimensions.map(function(m){return m.qDef})}var settings,sorting,addons,propertyLogic=propertyLogicModule.getLogicFor("hard","barchart");settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"ª",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(data){var numMeasures=data.qHyperCubeDef.qMeasures.length,numDimensions=data.qHyperCubeDef.qDimensions.length;return numMeasures+numDimensions>2},change:function(data,handler){handler.getDimensions().length>1&&"stacked"===data.barGrouping.grouping?(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0):data.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"º",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"Ω",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(data){return data.gridLine&&!data.gridLine.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:propertyLogic.helpers.showDimensionIdOption}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(properties,handler){var label,direction="y",dimensions=getDimensions(properties,handler).map(function(d){return d.qFallbackTitle||""}).join(", ");return"vertical"===properties.orientation&&(direction="x"),label=dimensions?translator.get("properties."+direction+"AxisWithInfo",[dimensions]):translator.get("properties."+direction+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",group:!1,tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(data){return"vertical"===data.orientation&&data.dimensionAxis&&["all","labels"].contains(data.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:function(data){var nearStr,farStr;return"vertical"===data.orientation?(nearStr="Common.Bottom",farStr="Common.Top"):(nearStr="properties.dock.left",farStr="properties.dock.right"),[{value:"near",translation:nearStr},{value:"far",translation:farStr}]},show:function(data){return data.dimensionAxis&&"none"!==data.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(properties,handler){var label,direction="x",measures=getMeasures(properties,handler).map(function(m){return m.qFallbackTitle}).join(", ");return"vertical"===properties.orientation&&(direction="y"),label=measures?translator.get("properties."+direction+"AxisWithInfo",[measures]):translator.get("properties."+direction+"Axis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",group:!1,tid:"property-yAxis"}}}}}}}},sorting={uses:"sorting",items:{dimensions:{locked:function(index,data,handler){return 1===handler.getMeasures().length&&2===handler.getDimensions().length?0===index:!1}}}},addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var data={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("general.utils/array-util",[],function(){function isArray(array){return array&&"[object Array]"===Object.prototype.toString.call(array)}function isFunction(func){return func&&"function"==typeof func}function forEach(array,actionFunction){var i,keyword;if(!isArray(array))throw"No valid items were specified.";if(!isFunction(actionFunction))throw"No valid action function was specified.";if(Array.prototype.forEach)array.forEach(actionFunction);else for(i in array)keyword=array[i],actionFunction(keyword)}function contains(array,item){if(!isArray(array))throw"No valid items were specified.";if(Array.prototype.indexOf)return-1!==array.indexOf(item);for(var i=array.length;i--;)if(array[i]===item)return!0;return!1}function intersects(array1,array2){if(!(array1&&array2&&array1.length&&array2.length))return!1;var i,len=array2.length;for(i=0;len>i;i++)if(array1.indexOf(array2[i])>-1)return!0;return!1}function move(array,old_index,new_index){if(new_index>=array.length)for(var k=new_index-array.length;k--+1;)array.push(void 0);array.splice(new_index,0,array.splice(old_index,1)[0])}function swap(array,firstIndex,secondIndex){var firstItem=array[firstIndex];array[firstIndex]=array[secondIndex],array[secondIndex]=firstItem}function indexAdded(array,index){var i;for(i=0;i<array.length;++i)array[i]>=0&&array[i]>=index&&++array[i];array.push(index)}function indexRemoved(array,index){var i,removeIndex=0;for(i=0;i<array.length;++i)array[i]>index?--array[i]:array[i]===index&&(removeIndex=i);array.splice(removeIndex,1)}function limit(array,len){return array.length>len?array.slice(0,len):array}function _copy(array){if(!(array instanceof Array))throw new Error("Argument is not an Array.");return array.slice(0)}return{forEach:forEach,contains:contains,move:move,swap:swap,limit:limit,indexAdded:indexAdded,indexRemoved:indexRemoved,intersects:intersects,copy:_copy}}),define("core.utils/json-patch",["jquery"],function($){function generateValue(val){return val&&(val=extend({},{val:val}).val),val}function isSpecialProperty(obj,key){return isFunction(obj[key])||"$$"===key.substring(0,2)||"_"===key.substring(0,1)}function getParent(data,str){var numPart,seperator="/",parts=str.substring(1).split(seperator).slice(0,-1);return parts.forEach(function(part,i){i!==parts.length&&(numPart=+part,data=data[numPart||part]=isUndef(data[numPart||part])?isNaN(numPart)?{}:[]:data[part])}),data}function emptyObject(obj){Object.keys(obj).forEach(function(key){var config=Object.getOwnPropertyDescriptor(obj,key);config.configurable&&!isSpecialProperty(obj,key)&&delete obj[key]})}function compare(a,b){var i,l,isIdentical=!0;if(isObject(a)&&isObject(b))return Object.keys(a).length!==Object.keys(b).length?!1:(Object.keys(a).forEach(function(key){return compare(a[key],b[key])?void 0:(isIdentical=!1,!1)}),isIdentical);if(isArray(a)&&isArray(b)){if(a.length!==b.length)return!1;for(i=0,l=a.length;l>i;i++)if(!compare(a[i],b[i]))return!1;return!0}return a===b}function patchArray(original,newA,basePath){function findIndex(a,id,idx){if(a[idx]&&isUndef(a[idx].qInfo))return null;if(a[idx]&&a[idx].qInfo.qId===id)return idx;for(var i=0,l=a.length;l>i;i++)if(a[i]&&a[i].qInfo.qId===id)return i;return-1}var i,l,patches=[],oldA=original.slice(),tmpIdx=-1;if(compare(newA,oldA))return patches;if(!isUndef(newA[0])&&isUndef(newA[0].qInfo))return patches.push({op:"replace",path:basePath,value:newA}),patches;for(i=oldA.length-1;i>=0;--i)tmpIdx=findIndex(newA,oldA[i].qInfo&&oldA[i].qInfo.qId,i),-1===tmpIdx?(patches.push({op:"remove",path:basePath+"/"+i}),oldA.splice(i,1)):patches=patches.concat(JSONPatch.generate(oldA[i],newA[tmpIdx],basePath+"/"+i));for(i=0,l=newA.length;l>i;++i)tmpIdx=findIndex(oldA,newA[i].qInfo&&newA[i].qInfo.qId),-1===tmpIdx?(patches.push({op:"add",path:basePath+"/"+i,value:newA[i]}),oldA.splice(i,0,newA[i])):tmpIdx!==i&&(patches.push({op:"move",path:basePath+"/"+i,from:basePath+"/"+tmpIdx}),oldA.splice(i,0,oldA.splice(tmpIdx,1)[0]));return patches}var JSONPatch={},extend=function(){return $.extend.apply($,[!0].concat(Array.prototype.slice.call(arguments)))},isObject=$.isPlainObject,isArray=Array.isArray,isUndef=function(v){return"undefined"==typeof v},isFunction=function(v){return"function"==typeof v};return JSONPatch.generate=function(original,newData,basePath){basePath=basePath||"";var patches=[];return Object.keys(newData).forEach(function(key){var val=generateValue(newData[key]),oldVal=original[key],tmpPath=basePath+"/"+key;compare(val,oldVal)||isSpecialProperty(newData,key)||(isUndef(oldVal)?patches.push({op:"add",path:tmpPath,value:val}):isObject(val)&&isObject(oldVal)?patches=patches.concat(JSONPatch.generate(oldVal,val,tmpPath)):isArray(val)&&isArray(oldVal)?patches=patches.concat(patchArray(oldVal,val,tmpPath)):patches.push({op:"replace",path:basePath+"/"+key,value:val}))}),Object.keys(original).forEach(function(key){isUndef(newData[key])&&!isSpecialProperty(original,key)&&patches.push({op:"remove",path:basePath+"/"+key})}),patches},JSONPatch.apply=function(original,patches){patches.forEach(function(patch){var parent=getParent(original,patch.path),key=patch.path.split("/").splice(-1)[0],target=key&&isNaN(+key)?parent[key]:parent[+key]||parent,from=patch.from?patch.from.split("/").splice(-1)[0]:null;if("add"===patch.op||"replace"===patch.op)if(isArray(parent))"-"===key&&(key=parent.length),parent.splice(+key,"add"===patch.op?0:1,patch.value);else if(isArray(target)&&isArray(patch.value)){var newValues=patch.value.slice();target.length=0,target.push.apply(target,newValues)}else isObject(target)&&isObject(patch.value)?(emptyObject(target),extend(target,patch.value)):parent[key]=patch.value;else if("move"===patch.op){var oldParent=getParent(original,patch.from);isArray(parent)?parent.splice(+key,0,oldParent.splice(+from,1)[0]):(parent[key]=oldParent[from],delete oldParent[from])}else"remove"===patch.op&&(isArray(parent)?parent.splice(+key,1):delete parent[key])})},JSONPatch.clone=function(obj){return extend({},obj)},JSONPatch.createPatch=function(op,val,path){var patch={op:op.toLowerCase(),path:path};return"move"===patch.op?patch.from=val:"undefined"!=typeof val&&(patch.value=val),patch},JSONPatch.updateObject=function(original,newData){return Object.keys(original).length?void JSONPatch.apply(original,JSONPatch.generate(original,newData)):void extend(original,newData)},JSONPatch}),define("core.utils/debug-flags",["util"],function(util){var isBrowser="undefined"!=typeof window&&"undefined"!=typeof document,urlFlags=(isBrowser&&util.getParameterByName("debug")||"").split("+"),DebugFlags={};return urlFlags.forEach(function(flag){DebugFlags[flag.toUpperCase()]=!0}),DebugFlags}),define("core.utils/permissions",[],function(){function parse(privileges,mapToObj){return privileges.length||(privileges=["update","publish","export","exportdata","changeowner","delete"]),forceReadOnly&&(privileges=[]),mapToObj=mapToObj||{},mapToObj.update=-1!==privileges.indexOf("update"),mapToObj.publish=-1!==privileges.indexOf("publish"),mapToObj["export"]=-1!==privileges.indexOf("export"),mapToObj.exportData=-1!==privileges.indexOf("exportdata"),mapToObj.changeOwner=-1!==privileges.indexOf("changeowner"),mapToObj.remove=-1!==privileges.indexOf("delete"),mapToObj}function parseCreate(creatables,mapToObj){mapToObj=mapToObj||{};for(var key in mapToObj)delete mapToObj[key];return forceReadOnly?mapToObj:(creatables.forEach(function(creatable){creatable.canCreate&&(mapToObj["create"+creatable.resource[0].toUpperCase()+creatable.resource.substring(1)]=!0)}),mapToObj)}function mapToLayout(layout,isApp){var permissions={};return layout.permissions||Object.defineProperty(layout,"permissions",{configurable:!1,enumerable:!1,get:function(){return layout&&(isApp&&(forceReadOnly=layout.qReadOnly,parseCreate(layout.create||CREATABLE_RESOURCES,permissions)),parse(layout.privileges||layout.qMeta&&layout.qMeta.privileges||[],permissions)),permissions}}),layout}var CREATABLE_RESOURCES=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],forceReadOnly=!0;return{mapToLayout:mapToLayout,parse:parse,parseCreate:parseCreate}}),define("core.utils/model-garbage-collector",["core.utils/notification","core.utils/debug-flags"],function(Notification,DebugFlags){function _canBeReleased(model){return model.Invalidated&&model.Invalidated.observers&&0===model.Invalidated.observers.length}function _tryToRelease(){for(var model,i=_queue.length;i--;)model=_queue[i],DebugFlags.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Checking model (id, handle, model):",model.id,model.handle,model),_canBeReleased(model)&&(_releaseModel(model),_queue.splice(i,1))}function _releaseModel(model){DebugFlags.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Releasing model (id):",model.id),Notification.release(model);for(var key in model)delete model[key]}function addToQueue(model){_queue.push(model)}var _queue=[];return setInterval(_tryToRelease,1e4),{addToQueue:addToQueue}}),define("autogenerated/qix/engine-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_INTERNAL_ERROR:-128,LOCERR_GENERIC_UNKNOWN:-1,LOCERR_GENERIC_OK:0,LOCERR_GENERIC_NOT_SET:1,LOCERR_GENERIC_NOT_FOUND:2,LOCERR_GENERIC_ALREADY_EXISTS:3,LOCERR_GENERIC_INVALID_PATH:4,LOCERR_GENERIC_ACCESS_DENIED:5,LOCERR_GENERIC_OUT_OF_MEMORY:6,LOCERR_GENERIC_NOT_INITIALIZED:7,LOCERR_GENERIC_INVALID_PARAMETERS:8,LOCERR_GENERIC_EMPTY_PARAMETERS:9,LOCERR_GENERIC_INTERNAL_ERROR:10,LOCERR_GENERIC_CORRUPT_DATA:11,LOCERR_GENERIC_MEMORY_INCONSISTENCY:12,LOCERR_GENERIC_INVISIBLE_OWNER_ABORT:13,LOCERR_GENERIC_PROHIBIT_VALIDATE:14,LOCERR_GENERIC_ABORTED:15,LOCERR_GENERIC_CONNECTION_LOST:16,LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION:17,LOCERR_GENERIC_REST_CONNECTION_FAILURE:18,LOCERR_HTTP_400:400,LOCERR_HTTP_401:401,LOCERR_HTTP_402:402,LOCERR_HTTP_403:403,LOCERR_HTTP_404:404,LOCERR_HTTP_405:405,LOCERR_HTTP_406:406,LOCERR_HTTP_407:407,LOCERR_HTTP_408:408,LOCERR_HTTP_409:409,LOCERR_HTTP_410:410,LOCERR_HTTP_411:411,LOCERR_HTTP_412:412,LOCERR_HTTP_413:413,LOCERR_HTTP_414:414,LOCERR_HTTP_415:415,LOCERR_HTTP_416:416,LOCERR_HTTP_417:417,LOCERR_HTTP_500:500,LOCERR_HTTP_501:501,LOCERR_HTTP_502:502,LOCERR_HTTP_503:503,LOCERR_HTTP_504:504,LOCERR_HTTP_505:505,LOCERR_HTTP_509:509,LOCERR_APP_ALREADY_EXISTS:1e3,LOCERR_APP_INVALID_NAME:1001,LOCERR_APP_ALREADY_OPEN:1002,LOCERR_APP_NOT_FOUND:1003,LOCERR_APP_IMPORT_FAILED:1004,LOCERR_APP_SAVE_FAILED:1005,LOCERR_APP_CREATE_FAILED:1006,LOCERR_APP_INVALID:1007,LOCERR_APP_CONNECT_FAILED:1008,LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE:1009,LOCERR_APP_MIGRATION_COULD_NOT_CONTACT_MIGRATION_SERVICE:1010,LOCERR_APP_MIGRATION_COULD_NOT_START_MIGRATION:1011,LOCERR_APP_MIGRATION_FAILURE:1012,LOCERR_CONNECTION_ALREADY_EXISTS:2e3,LOCERR_CONNECTION_NOT_FOUND:2001,LOCERR_CONNECTION_FAILED_TO_LOAD:2002,LOCERR_CONNECTION_FAILED_TO_IMPORT:2003,LOCERR_CONNECTION_NAME_IS_INVALID:2004,LOCERR_FILE_ACCESS_DENIED:3e3,LOCERR_FILE_NAME_INVALID:3001,LOCERR_FILE_CORRUPT:3002,LOCERR_FILE_NOT_FOUND:3003,LOCERR_FILE_FORMAT_UNSUPPORTED:3004,LOCERR_FILE_OPENED_IN_UNSUPPORTED_MODE:3005,LOCERR_USER_ACCESS_DENIED:4e3,LOCERR_USER_IMPERSONATION_FAILED:4001,LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS:5e3,LOCERR_SERVER_OUT_OF_SESSION_CALS:5001,LOCERR_SERVER_OUT_OF_USAGE_CALS:5002,LOCERR_SERVER_OUT_OF_CALS:5003,LOCERR_SERVER_OUT_OF_NAMED_CALS:5004,LOCERR_SERVER_OFF_DUTY:5005,LOCERR_SERVER_BUSY:5006,LOCERR_SERVER_LICENSE_EXPIRED:5007,LOCERR_SERVER_AJAX_DISABLED:5008,LOCERR_HC_INVALID_OBJECT:6e3,LOCERR_HC_RESULT_TOO_LARGE:6001,LOCERR_HC_INVALID_OBJECT_STATE:6002,LOCERR_HC_MODAL_OBJECT_ERROR:6003,LOCERR_CALC_INVALID_DEF:7e3,LOCERR_CALC_NOT_IN_LIB:7001,LOCERR_CALC_HEAP_ERROR:7002,LOCERR_CALC_TOO_LARGE:7003,LOCERR_CALC_TIMEOUT:7004,LOCERR_CALC_EVAL_CONDITION_FAILED:7005,LOCERR_CALC_MIXED_LINKED_AGGREGATION:7006,LOCERR_CALC_MISSING_LINKED:7007,LOCERR_CALC_INVALID_COL_SORT:7008,LOCERR_CALC_PAGES_TOO_LARGE:7009,LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED:7010,LOCERR_CALC_VALIDATION_STATE_INVALID:7011,LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:7012,LOCERR_CALC_MISSING_LINKED_FIELD:7013,LOCERR_LAYOUT_EXTENDS_INVALID_ID:8e3,LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND:8001,LOCERR_LAYOUT_LINKED_OBJECT_INVALID:8002,LOCERR_PERSISTENCE_WRITE_FAILED:9e3,LOCERR_PERSISTENCE_READ_FAILED:9001,LOCERR_PERSISTENCE_DELETE_FAILED:9002,LOCERR_PERSISTENCE_NOT_FOUND:9003,LOCERR_PERSISTENCE_UNSUPPORTED_VERSION:9004,LOCERR_PERSISTENCE_MIGRATION_FAILED_READ_ONLY:9005,LOCERR_PERSISTENCE_MIGRATION_CANCELLED:9006,LOCERR_PERSISTENCE_MIGRATION_BACKUP_FAILED:9007,LOCERR_PERSISTENCE_DISK_FULL:9008,LOCERR_PERSISTENCE_NOT_SUPPORTED_FOR_SESSION_APP:9009,LOCERR_PERSISTENCE_SYNC_SET_CHUNK_INVALID_PARAMETERS:9510,LOCERR_PERSISTENCE_SYNC_GET_CHUNK_INVALID_PARAMETERS:9511,LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED:1e4,LOCERR_RELOAD_IN_PROGRESS:11e3,LOCERR_PERSONAL_NEW_VERSION_AVAILABLE:12e3,LOCERR_PERSONAL_VERSION_EXPIRED:12001,LOCERR_PERSONAL_SECTION_ACCESS_DETECTED:12002,LOCERR_PERSONAL_APP_DELETION_FAILED:12003,LOCERR_EXPORT_OUT_OF_MEMORY:13e3,LOCERR_EXPORT_NO_DATA:13001,LOCERR_SYNC_INVALID_OFFSET:14e3,LOCERR_SEARCH_TIMEOUT:15e3,LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:16e3,LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:16001,LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:16002,LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:16003,LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:16004,LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:16005,LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED:16006,LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED:16007,LOCERR_SMART_LOAD_TABLE_NOT_FOUND:17e3,LOCERR_SMART_LOAD_TABLE_DUPLICATED:17001,LOCERR_VARIABLE_NO_NAME:18e3,LOCERR_VARIABLE_DUPLICATE_NAME:18001,LOCERR_VARIABLE_INCONSISTENCY:18002,LOCERR_MEDIA_LIBRARY_CONTENT_FAILED:19e3,LOCERR_MEDIA_LIBRARY_LIST_FAILED:19001,LOCERR_MEDIA_BUNDLING_FAILED:19002,LOCERR_MEDIA_UNBUNDLING_FAILED:19003,LOCERR_MEDIA_LIBRARY_NOT_FOUND:19004,LOCERR_JSON_RPC_INVALID_REQUEST:-32600,LOCERR_JSON_RPC_METHOD_NOT_FOUND:-32601,LOCERR_JSON_RPC_INVALID_PARAMETERS:-32602,LOCERR_JSON_RPC_INTERNAL_ERROR:-32603,LOCERR_JSON_RPC_PARSE_ERROR:-32700},NxLocalizedWarningCode:{LOCWARN_PERSONAL_RELOAD_REQUIRED:0,LOCWARN_PERSONAL_VERSION_EXPIRES_SOON:1,LOCWARN_EXPORT_DATA_TRUNCATED:1e3,LOCWARN_COULD_NOT_OPEN_ALL_OBJECTS:2e3},NxLocalizedMessageCode:{LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE:0,LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED:1,LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT:2,LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES:3,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR:4,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED:5,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO:6,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED:7,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWISH:8,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_COLUMNAR:9,LOCMSG_SCRIPTEDITOR_ERROR:10,LOCMSG_SCRIPTEDITOR_DONE:11,LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA:12,LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING:13,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING:14,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED:15,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING:16,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING:17,LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC:18,LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING:19,LOCMSG_SCRIPTEDITOR_RELOAD:20,LOCMSG_SCRIPTEDITOR_LINES_FETCHED:21}}}),define("core.utils/authentication",["jquery"],function($){"use strict";var userId,userDirectory,logoutUri,loginUri,Authentication={},mustAuthenticate=!1,onDataReceived=$.Deferred();return Authentication.parse=function(data){userId=data.userId,userDirectory=data.userDirectory,mustAuthenticate=data.mustAuthenticate,loginUri=data.loginUri,logoutUri=data.logoutUri,mustAuthenticate===!0&&data.loginUri&&(window.location.href=data.loginUri),onDataReceived.resolve(this)},Authentication.onDataReceived=onDataReceived.promise(),Object.defineProperties(Authentication,{userId:{get:function(){return userId}},userDirectory:{get:function(){return userDirectory}},mustAuthenticate:{get:function(){return mustAuthenticate}},loginUri:{get:function(){return loginUri}},logoutUri:{get:function(){return logoutUri}}}),Authentication}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/debug-flags","core.utils/permissions","core.utils/model-garbage-collector","autogenerated/qix/engine-enums","core.utils/authentication"],function(Deferred,Notification,Class,JSONPatch,DebugFlags,Permissions,ModelGarbageCollector,enums,authentication){"use strict";function patch(model,data){Array.isArray(data)?JSONPatch.apply(model,data):JSONPatch.updateObject(model,data)}var userId,userDirectory,errors=enums.NxLocalizedErrorCode,cacheableMethods=["GetLayout","GetAppLayout","AbortModal","DoSave"];authentication.onDataReceived.then(function(data){"NONE"!==data.userDirectory&&(userId=data.userId,userDirectory=data.userDirectory)});var RPCBase=Class.extend("RPCBase",{init:function(input){var that=this;Notification.mixin(that),that.notification("Validated"),that.notification("Invalidated"),that.notification("Aborted"),that.notification("Validating"),that.notification("Closed"),that.notification("Closing"),that.notification("Cancelled"),that.id=input.id,that.session=input.session,that.handle=input.handle,that.layout={},that._properties={},that.properties={},that.propertyTree={},that.ongoingRequests={},that.needCacheProperties=!0,that._effectiveProperties={},that.effectiveProperties={},that.needCacheEffectiveProperties=!0,that.setState(RPCBase.States.INVALID),Permissions.mapToLayout(that.layout,input.checkCreate),"App"!==that.constructor.name&&that.bindToRPC()},bindToRPC:function(){var that=this;that.session.onChange(that.handle,that.changeHandler.bind(that)),that.Aborted.bind(that.clearPending.bind(that)),that.Cancelled.bind(that.clearPending.bind(that))},changeHandler:function(){var that=this;that.clearPending(),that.needCacheProperties=!0,that.needCacheEffectiveProperties=!0,that.isCancelled||that.setState(RPCBase.States.INVALID)},clearPending:function(){for(var key in this.ongoingRequests)delete this.ongoingRequests[key]},publish:function(){return this.layout.permissions.publish?this.rpc("Publish"):Deferred.reject("permission denied")},unpublish:function(){var that=this,deferred=Deferred();return that.getLayout().then(function(layout){return!layout.qMeta.published||layout.qMeta.approved||layout.qMeta.owner.userId!==userId||layout.qMeta.owner.userDirectory!==userDirectory?deferred.reject("permission denied"):void that.rpc("UnPublish").then(function(data){deferred.resolve(data)})}),deferred.promise},setState:function(state){var that=this,oldState=that.state;delete this.__layoutRPCId,that.state=state,oldState!==that.state&&(state===RPCBase.States.INVALID?that.Invalidated.emit():state===RPCBase.States.VALID?that.Validated.emit():state===RPCBase.States.ABORTED?that.Aborted.emit():state===RPCBase.States.VALIDATING?that.Validating.emit():state===RPCBase.States.CLOSED?that.Closed.emit():state===RPCBase.States.CLOSING?that.Closing.emit():state===RPCBase.States.CANCELLED&&that.Cancelled.emit())},getLayout:function(method,responseProperty){function onLayout(data){return DebugFlags.DELTA&&delta&&window.console.info("[DBGFLG:DELTA] APPLY ["+that.constructor.name+"]:",data),patch(that.layout,data),that.setState(RPCBase.States.VALID),that.layout}function onFail(err){return err.error.code!==errors.LOCERR_GENERIC_ABORTED||that.isCancelled||(that.setState(RPCBase.States.ABORTED),err.isHandled=!0),Deferred.reject(err)}var that=this,delta=!0;if(that.isValid||that.isCancelled)return Deferred.resolve(that.layout);if(method=method||"GetLayout",responseProperty=responseProperty||"qLayout",that.isValidating||that.setState(RPCBase.States.VALIDATING),that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var req=that.rpc(method,responseProperty,[],{delta:delta}),promise=req.then(onLayout,onFail);return that.__layoutRPCId=req.rpcId,that.ongoingRequests[method+delta]=promise,promise},getProperties:function(method){var that=this,delta=!1;if(method=method||"GetProperties",that.isValid&&!that.needCacheProperties)return Deferred.resolve(that.properties);if(that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var promise=that.rpc(method,"qProp",[],{delta:delta}).then(function(data){var patches=JSONPatch.generate(that._properties,data);return that._properties=data,JSONPatch.apply(that.properties,patches),that.isValid&&(that.needCacheProperties=!1),that.properties});return that.ongoingRequests[method+delta]=promise,promise},getEffectiveProperties:function(){var that=this,delta=!1,method="GetEffectiveProperties";if(that.isValid&&!that.needCacheEffectiveProperties)return Deferred.resolve(that.effectiveProperties);if(that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var promise=that.rpc(method,"qProp",[],{delta:delta}).then(function(data){var patches=JSONPatch.generate(that._effectiveProperties,data);return that._effectiveProperties=data,JSONPatch.apply(that.effectiveProperties,patches),that.isValid&&(that.needCacheEffectiveProperties=!1),that.effectiveProperties});return that.ongoingRequests[method+delta]=promise,promise},hasChanges:function(){var patches=JSONPatch.generate(this._properties,this.properties);return patches.length>0},markAsInvalid:function(){this.state=-99,this.setState(RPCBase.States.INVALID)},markAsCancelled:function(){this.setState(RPCBase.States.CANCELLED)},getFullPropertyTree:function(method){var that=this,delta=!1;return method=method||"GetFullPropertyTree",that.rpc(method,"qPropEntry",[],delta).then(function(data){return that._propertyTree=data,patch(that.propertyTree,data),that.propertyTree})},setProperties:function(props,method,delta){var that=this;return method=method||"SetProperties",Array.isArray(props)||(props=[props]),this.rpc(method,null,props,delta).then(function(){JSONPatch.updateObject(that._properties,that.properties)})},setFullPropertyTree:function(props,method,delta){return method=method||"SetFullPropertyTree",Array.isArray(props)||(props=[props]),this.rpc(method,null,props,delta)},save:function(){return this.hasChanges()?this.setProperties(this.properties):Deferred.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(byServer){var that=this;that.setState(RPCBase.States.CLOSING);var dfd=byServer||"App"===that.constructor.name?Deferred.resolve():that.rpc("Close","qReturn",[]);delete that.session.changeHandlers[that.handle],delete that.session.modelCache[that.id];for(var key in that.ongoingRequests)that.ongoingRequests[key].then&&that.ongoingRequests[key].then(null,function(err){err.isHandled=!0});return dfd.then(function(){that.setState(RPCBase.States.CLOSED),ModelGarbageCollector.addToQueue(that)})},rpc:function(method,responseProperty,params,options){options=options||{delta:!1,raw:!1};var that=this,args=[].slice.call(arguments);if(!that.handle&&"App"===that.constructor.name)return that.waitForOpen.promise.then(function(){return that.rpc.apply(that,args)});var transport={method:method,handle:this.handle,params:params||[]};if(options.delta&&(transport.delta=!0),!that.session||that.isClosing||that.isClosed)return Deferred.reject();var request=that.session.rpc(transport).then(function(data){return responseProperty?data.result[responseProperty]:options.raw?data:data.result},function(err){return err.error.code===errors.LOCERR_HC_MODAL_OBJECT_ERROR?(err.isHandled=!0,that.session.currentApp.abortModal().then(function(){return that.rpc.apply(that,args)})):Deferred.reject(err)});return cacheableMethods.indexOf(method)>-1&&(that.ongoingRequests[method+options.delta]=request,request["finally"](function(){delete that.ongoingRequests[method+options.delta]})),request.rpcId=transport.id,request}});return RPCBase.getModel=function(id,session,getHandle){function failed(data){return delete session.modelCache[id],Deferred.reject({error:{code:data&&data.error&&data.error.code,message:"No object with Id "+id+" found",parameter:id}})}var instance=session.modelCache[id],Model=this;return id?instance?instance:(instance=getHandle().then(function(result){var model=null!==result.qHandle?new Model({id:id,session:session,handle:result.qHandle}):null;return model?model:failed({error:{code:errors.LOCERR_GENERIC_NOT_FOUND}})},failed),session.modelCache[id]=instance,instance):Deferred.reject("No ID given to RPCBase#getModel")},RPCBase.getLayout=function(id,app){return this.get(id,app).then(function(model){return model.getLayout().then(function(layout){return layout})})},RPCBase.getProperties=function(id,app){return this.get(id,app).then(function(model){
return model.getProperties().then(function(){return model})})},RPCBase.extend=function(name,proto){var ctor=Class.extend.call(this,name,proto);return ctor.bindLayout=RPCBase.bindLayout,ctor.getLayout=RPCBase.getLayout,ctor.getProperties=RPCBase.getProperties,ctor.getModel=RPCBase.getModel,ctor},Object.defineProperties(RPCBase.prototype,{isValid:{get:function(){return this.state===RPCBase.States.VALID}},isValidating:{get:function(){return this.state===RPCBase.States.VALIDATING}},isInvalid:{get:function(){return this.state===RPCBase.States.INVALID}},isAborted:{get:function(){return this.state===RPCBase.States.ABORTED}},isClosed:{get:function(){return this.state===RPCBase.States.CLOSED}},isClosing:{get:function(){return this.state===RPCBase.States.CLOSING}},isCancelled:{get:function(){return this.state===RPCBase.States.CANCELLED}}}),RPCBase.States={VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7},RPCBase.bindLayout=function($scope,watchString,callback,modelChangedCallback){function unbind(){var model=$scope.$eval(watchString);model&&model.Invalidated&&model.Invalidated.unbind(validateFunc)}watchString=watchString||"model";var validateFunc,unWatchFn,destroyFn,validate=function(){var model=this,req=this.getLayout();$scope.__layoutRPCId=req.rpcId,req.then(function(layout){var currentModel=$scope.$eval(watchString);currentModel===model&&callback&&callback(layout)})};return destroyFn=$scope.$on("$destroy",function(){unbind()}),unWatchFn=$scope.$watch(watchString,function(model,oldModel){oldModel&&oldModel!==model&&oldModel.Invalidated&&oldModel.Invalidated.unbind(validateFunc),!model||model.isClosing&&model.isClosed||(modelChangedCallback&&modelChangedCallback(model),model.getLayout().then(callback),validateFunc=validate.bind(model),model.Invalidated.bind(validateFunc))}),function(){unbind(),unWatchFn(),destroyFn(),callback&&(callback=null),modelChangedCallback&&(modelChangedCallback=null)}},RPCBase}),define("core.utils/websocket",[],function(){if("undefined"!=typeof window&&"undefined"!=typeof document)return window.angular&&window.angular.mock?function(){}:window.WebSocket;var ws=require("ws");return ws}),define("assets/core/models/rpc-session",["core.utils/websocket","core.utils/notification","core.utils/deferred"],function(WebSocket,Notification,Deferred){"use strict";function RPCSession(options){var that=this;Notification.mixin(that),that.notification("Open"),that.notification("Close"),that.notification("Send"),that.notification("Data"),that.notification("Error"),that.notification("ClosedHandles"),that.notification("ChangedHandles"),that.notification("Notification"),that.notification("Warning"),that.changeHandlers=[],that.cacheName=options.cacheName,that.queue=[],that.dfdCache={},that.reqCache={},that.modelCache={},that.options=options}var __expando=1;return RPCSession.prototype={open:function(){var that=this;that.socket=that.socket||RPCSession.createSocket(RPCSession.buildUrl(that.options)),that.socket.onopen=that.onOpen.bind(that),that.socket.onclose=that.onClose.bind(that),that.socket.onerror=that.onError.bind(that),that.socket.onmessage=that.onData.bind(that)},onOpen:function(){var that=this;setTimeout(function(){that.queue.forEach(function(data){that.send(data)}),that.queue.length=0,that.Open.emit()},100)},onError:function(err){var that=this;Object.keys(that.dfdCache).forEach(function(dfdKey){err.error={err:err,isHandled:!0},that.dfdCache[dfdKey].reject(err)}),that.Error.emit(err)},_cleanup:function(){var that=this;if(that.Close){that.Close.emit();for(var id in that.modelCache)that.modelCache[id].then(function(model){"App"!==model.constructor.name&&model.close(!0)});Notification.release(that)}},onClose:function(){var that=this;that._isClosed||(that.queue.length=0,delete RPCSession.__cache[that.cacheName],RPCSession.useTimeoutOnClose?setTimeout(that._cleanup.bind(that),1e3):that._cleanup(),that._isClosed=!0)},onData:function(event){var session=this,data=JSON.parse(event.data),dfd=session.dfdCache[data.id];data.change&&session.handleChanged(data),data.close&&session.handleClosed(data),RPCSession.debounceApply(function(){data.handle&&!session.changeHandlers[data.handle]&&dfd?dfd.reject("No model mapped to handle"):data.result?(session.Data.emit(data),data.warnings&&session.Warning.emit(data),dfd&&dfd.resolve(data)):data.params?(session.Notification.emit(data),dfd&&dfd.resolve(data)):data.suspend?(session.rpc({method:"Resume",params:[],handle:data.suspend[0]}),dfd&&dfd.resolve(data)):data.error&&(dfd&&dfd.reject(data),session.Error.emit(data)),delete session.dfdCache[data.id],delete session.reqCache[data.id]})},handleChanged:function(data){var session=this;data.change.forEach(function(handle){var handlers=session.changeHandlers[handle];handlers&&handlers.forEach(function(handler){handler()})}),session.ChangedHandles.emit(data.change)},handleClosed:function(data){var session=this;Object.keys(session.modelCache).forEach(function(id){session.modelCache[id].then(function(model){data.close.indexOf(model.handle)>-1&&model.close(!0)})}),session.ClosedHandles.emit(data.close)},send:function(data){var that=this,stringified=data;return"string"!=typeof data&&(stringified=JSON.stringify(data)),that.socket&&1===that.socket.readyState?(that.Send.emit(data),void that.socket.send(stringified)):void that.queue.push(data)},close:function(){var that=this;that.socket&&(that.socket.close(),delete that.socket)},rpc:function(data,dfd){return dfd||(dfd=new Deferred),RPCSession.hookIntoDeferred(dfd),"undefined"==typeof data.id&&(data.id=__expando++),data.jsonrpc="2.0",this.send(data),this.dfdCache[data.id]=dfd,this.reqCache[data.id]=data,dfd.id=data.id,dfd.promise},onChange:function(handle,handlerFn){this.changeHandlers[handle]||(this.changeHandlers[handle]=[]),this.changeHandlers[handle].push(handlerFn)},getRequest:function(reqId){return this.reqCache[reqId]||null}},RPCSession.__cache={},Notification.create(RPCSession,"NewSessionCreated"),RPCSession.createSocket=function(url){return new WebSocket(url)},RPCSession.createInput=function(appName,opts){return opts=opts||{},opts.appName=appName,opts.cacheName=RPCSession.buildUrl(opts),opts},RPCSession.debounceApply=function(fn){fn()},RPCSession.get=function(appName,opts){var input=RPCSession.createInput(appName,opts),session=RPCSession.getIfCached(appName,opts);return session||(session=RPCSession.__cache[input.cacheName]=new RPCSession(input),RPCSession.NewSessionCreated.emit(session)),session},RPCSession.getIfCached=function(appName,opts){var input=RPCSession.createInput(appName,opts);return RPCSession.__cache[input.cacheName]},RPCSession.buildUrl=function(options){var connection="",host=options.host,port="string"==typeof options.port?options.port:options.isSecure?443:4848;return connection+=options.isSecure?"wss":"ws",connection+="://",connection+=host||"localhost",options.port&&(connection+=":",connection+=port),connection+=options.prefix||"/",options.subpath&&(connection+=options.subpath+"/"),connection+=options.route?options.route:"app/"+encodeURIComponent(options.appName),options.identity&&(connection+="/identity/"+encodeURIComponent(options.identity)),connection+="?reloadUri="+(options.reloadURI||"")},RPCSession.hookIntoDeferred=function(){},RPCSession}),define("assets/qvangular/qvangular-locale",["assets/qvangular/qvangular-core","translator"],function(qvangular,translator){qvangular.directive("qPlaceholder",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){iAttrs.ngDisabled?scope.$watch(iAttrs.ngDisabled,function(value){value?iElement.attr("placeholder",""):iElement.attr("placeholder",translator.get(iAttrs.qPlaceholder))}):iElement.attr("placeholder",translator.get(iAttrs.qPlaceholder))}}}),qvangular.directive("qSimpleTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){iElement.text(translator.get(value))}translator.ready.then(function(){iAttrs.$observe("qTranslation",updateContent)})}}}),qvangular.directive("qTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){var translatedText,id,i,data=value.split(","),htmlTemplates=JSON.parse(iAttrs.qHtmlTranslationIndexes||"null"),insertFn=htmlTemplates?"html":"text",pipeIndex=data[0].indexOf("|");for(id=pipeIndex>=0&&data.length>=2?"1"===data[1]?data[0].substring(0,pipeIndex).trim():data[0].substring(pipeIndex+1).trim():data[0],translatedText=translator.get(id),htmlTemplates&&data.push.apply(data,htmlTemplates),i=1;i<data.length;i++)translatedText=translatedText.replace("{"+(i-1)+"}",data[i]);iElement[insertFn](translatedText)}translator.ready.then(function(){iAttrs.$observe("qTranslation",updateContent),updateContent(iAttrs.qTranslation)})}}}),qvangular.directive("translate",function(){return function(scope,element,attrs){function update(text){text?"string"==typeof text?(element.attr("data-translation",text),element.removeAttr("data-text")):(element.attr("data-translation",text.id),element.data("text",{value:text.value})):(element.removeAttr("data-translation"),element.removeAttr("data-text")),translator.apply(element[0])}scope.$watch(attrs.translate,update)}}),qvangular.directive("qTitleTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){value?iElement.attr("title",translator.get(value)):iElement.removeAttr("title")}translator.ready.then(function(){iAttrs.$observe("qTitleTranslation",updateContent),updateContent(iAttrs.qTitleTranslation)})}}}),qvangular.filter("translate",function(){return function(input){return translator.get(input)}}),qvangular.filter("translatetoupper",function(){return function(input){return translator.get(input).toUpperCase()}})}),define("assets/qvangular/qvangular-filters",["assets/qvangular/qvangular-core"],function(qvangular){qvangular.filter("qvCropString",function(){function cropStr(str,limit){return"undefined"!=typeof limit&&str.length>limit&&(str=str.substr(0,limit)+"..."),str}return cropStr}),qvangular.filter("qvOptStringExpression",function(){function getValue(value){return"object"==typeof value&&(value=value.qStringExpression.qExpr,value.length&&"="===value[0]||(value="="+value)),value}return getValue}),qvangular.filter("qvToArray",function(){return function(object){var array=[];for(var key in object)object.hasOwnProperty(key)&&array.push(object[key]);return array}}),qvangular.filter("qvFirstToUpper",function(){return function(string){return string.substring(0,1).toUpperCase()+string.substring(1)}})}),define("assets/qvangular/qvangular-highlight/highlight",["general.utils/string-normalization","util","encoder"],function(SN,util,encoder){function directive(){return{scope:{text:"@",query:"="},restrict:"EA",replace:!0,link:function(scope,element){scope.$watchCollection("[text, query]",function(){var query=SN.string(scope.query);if(!query)return void element.text(scope.text);var html=directive.highlightMatches(SN.string(scope.text),query,"qui-texthighlight",scope.text);element.html(html)})}}}return directive.highlightMatches=function(text,query,className,originalText){return directive.markMatches(text,query,originalText).map(function(item){return item.match?"<span "+encoder.encodeForAttr("class",className)+">"+encoder.encodeForHTML(item.text)+"</span>":encoder.encodeForHTML(item.text)}).join("")},directive.markMatches=function(text,query,targetText){targetText=text;for(var list=[],index=0,re=new RegExp(util.escapeRegExp(query),"gi");;){var match=re.exec(text);if(!match){index<text.length&&list.push({text:targetText.substring(index),match:!1});break}match.index>index&&list.push({text:targetText.substring(index,match.index),match:!1}),list.push({text:targetText.substring(match.index,re.lastIndex),match:!0}),index=re.lastIndex}return list},directive}),define("general.utils/dom-util",["jquery"],function($){"use strict";var DOMUtil={};return DOMUtil.getParentElementWithAttribute=function(elem,tag,attr){for(var match=!1,limit=0;elem&&elem.parentNode&&100>limit&&!match;){if(limit++,elem.nodeName===tag.toUpperCase()&&elem.hasAttribute(attr))return match=!0,elem;elem=elem.parentNode}return match?void 0:null},DOMUtil.getAncestorsUntil=function(elem,stopFn){var ancestors=[];for(stopFn||(stopFn=function(){return!1});elem&&elem.parentNode&&!stopFn(elem);)ancestors.push(elem),elem=elem.parentNode;return ancestors},DOMUtil.isInput=function(element){return element&&("INPUT"===element.tagName||"SELECT"===element.tagName||"TEXTAREA"===element.tagName||element.isContentEditable)},DOMUtil.elementFromEventPosition=function(event){var doc=document,body=doc.body,clientX=event.pageX+(doc&&doc.clientLeft||body&&body.clientLeft||0)-(doc&&doc.scrollLeft||body&&body.scrollLeft||0),clientY=event.pageY+(doc&&doc.clientTop||body&&body.clientTop||0)-(doc&&doc.scrollTop||body&&body.scrollTop||0);return document.elementFromPoint(clientX,clientY)},DOMUtil.scrollElmentIntoView=function(activeElem,scrollSelector,scrollToMiddle,includeMargin){var winElement;if(activeElem.length&&(winElement=scrollSelector instanceof $?scrollSelector:activeElem.closest(scrollSelector),winElement.length)){var offset,winTop=winElement.offset().top,winBottom=winTop+winElement.height(),elementTop=activeElem.offset().top,elementBottom=elementTop+activeElem.outerHeight(!!includeMargin),elementHeight=elementBottom-elementTop,windowHeight=winBottom-winTop;offset=activeElem[0].getBoundingClientRect().top,scrollToMiddle?(offset-=winElement.height()/2,winElement.scrollTop(winElement.scrollTop()+offset)):elementHeight>windowHeight?(offset=elementTop-winTop,winElement.scrollTop(winElement.scrollTop()+offset)):elementBottom>winBottom?(offset=elementBottom-winBottom,winElement.scrollTop(winElement.scrollTop()+offset)):winTop>elementTop&&(offset=elementTop-winTop,winElement.scrollTop(winElement.scrollTop()+offset))}},DOMUtil.getAction=function(e,scopeSelector,closestIsDataAction){var action,elem,thatScope,parent=(closestIsDataAction?$(e.target).closest("[data-action]"):$(e.target).parent())[0];return e.target.getAttribute("data-action")?(action=e.target.getAttribute("data-action"),elem=$(e.target)):parent&&parent.getAttribute("data-action")&&(action=parent.getAttribute("data-action"),elem=$(parent)),action&&scopeSelector&&(thatScope=$(elem.closest(scopeSelector)).scope()),{action:action,element:elem,scope:thatScope}},DOMUtil.isElementInViewport=function(element,parent){var parentRect,rect=element.getBoundingClientRect(),visible={top:!1,right:!1,bottom:!1,left:!1,inView:!1};return parentRect=(parent?parent:$("body")[0]).getBoundingClientRect(),visible.top=rect.top+rect.height-parentRect.top>=0,visible.right=parentRect.right-(rect.right-rect.width)>=0,visible.bottom=parentRect.bottom+rect.height>=rect.bottom,visible.left=rect.left-parentRect.left+rect.width>=0,visible.inView=visible.top&&visible.right&&visible.bottom&&visible.left,visible},DOMUtil}),define("general.utils/support",["touche"],function(Touche){"use strict";function treatAsDesktop(){return!Touche.utils.msPointer||0!==window.navigator.msMaxTouchPoints&&0!==window.navigator.maxTouchPoints?Touche.utils.msPointer&&(window.navigator.msMaxTouchPoints>0||window.navigator.maxTouchPoints>0)?!1:!Touche.utils.touch:!0}function isMouse(e){return Touche.utils.isMouse(e)}return{treatAsDesktop:treatAsDesktop,isMouse:isMouse}}),define("assets/qvangular/qvangular-directives",["jquery","assets/qvangular/qvangular-core","angular","assets/qvangular/qvangular-highlight/highlight","general.utils/dom-util","touche","general.utils/support"],function($,qvangular,angular,highlight,domUtil,Touche,Support){function registerDelegatedDirective(directiveName,eventName){qvangular.directive(directiveName,["$parse",function($parse){return function(scope,element,attrs){for(var clicks=attrs[directiveName].split(";"),i=0;i<clicks.length;i++){var data=clicks[i].trim().split("#"),selector=data[0],fn=$parse(data[1]);!function(iSelector,iFn){element.on(eventName,selector,function(evt){scope.$apply(function(){iFn(scope,{$event:evt})})})}(selector,fn)}}}])}function getKeydownDirectiveWithKeyCode(directiveName,keycode,overrideElement){return["$parse",function($parse){return{restrict:"A",link:function(scope,elem,attr){var fn=$parse(attr[directiveName]),eventHandler=function(e){keycode&&keycode!==e.which||setTimeout(function(){e.preventDefault(),scope.$apply(function(){fn(scope,{$event:e})})})};$(overrideElement?overrideElement:elem).bind("keydown",eventHandler),scope.$on("$destroy",function(){$(overrideElement?overrideElement:elem).unbind("keydown",eventHandler)})}}}]}qvangular.directive("qvaBlur",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaBlur);element.bind("blur",function(event){qvangular.$apply(scope,function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaDblclick",["$parse",function($parse){return function($scope,$element,$attr){var fn=$parse($attr.qvaDblclick),ns="qva-dblclick"+$scope.$id;Touche($element[0]).doubletap({id:ns,options:{timeThreshold:250,preventDefault:!1},end:function(){$scope.$apply(fn)}}),$scope.$on("$destroy",function(){Touche($element[0]).off("doubletap",ns)})}}]),qvangular.directive("qvaDblclick",["$parse",function($parse){return function($scope,$element,$attr){var fn=$parse($attr.qvaDblclick),ns="qva-dblclick"+$scope.$id;Touche($element[0]).doubletap({id:ns,options:{timeThreshold:250,preventDefault:!1},end:function(){$scope.$apply(fn)}}),$scope.$on("$destroy",function(){Touche($element[0]).off("doubletap",ns)})}}]),qvangular.directive("qvaActivate",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaActivate);element.on("qv-activate keypress",function(event){var isSpaceBar="keypress"===event.type&&32===event.which;("keypress"!==event.type||isSpaceBar&&$(event.target).is(":input"))&&scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaScrollIntoView",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaScrollIntoView,function(val){val.scrollSelector&&val.scroll&&$timeout(function(){domUtil.scrollElmentIntoView(element,val.scrollSelector)})},!0)}}}]),qvangular.directive("qvaPreventDrag",function(){return{restrict:"A",link:function(scope,element){element.on("qv-press",function(e){e.preventDefault()})}}}),qvangular.directive("qvaPress",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaPress);element.on("qv-press",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaStopProp",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaPress);element.on("qv-press",function(event){$(event.target).is(element)&&(event.stopPropagation(),event.preventDefault(),scope.$apply(function(){fn(scope,{$event:event})}))})}}]),qvangular.directive("qvaContextMenu",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaContextMenu);element.bind("qv-contextmenu",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaRadialContextMenu",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaRadialContextMenu);element.bind("qv-radial-contextmenu",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaSwipeUpdate",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaSwipeUpdate);element.bind("qv-swipeupdate",function(event){scope.$apply(function(){fn(scope,{$event:event,$element:element})})})}}]),qvangular.directive("qvaSwipe",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaSwipe);element.bind("qv-swipe",function(event){scope.$apply(function(){fn(scope,{$event:event,$element:element})})})}}]),qvangular.directive("qvaLoad",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaLoad);element.on("load",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),registerDelegatedDirective("qvaDelegatedClick","click"),registerDelegatedDirective("qvaDelegatedActivate","qv-activate"),qvangular.directive("qvaIndeterminate",["$parse",function(){return function(scope,element,attrs){var value=attrs.qvaIndeterminate;element.prop("indeterminate",value===!0||"true"===value),scope.$watch(attrs.qvaIndeterminate,function(newValue){element.prop("indeterminate",newValue===!0||"true"===newValue)})}}]),qvangular.directive("qvaOutside",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaOutside),forceIgnore=!1,override=!1;element.bind("qv-outside",function(event){forceIgnore="allOutside"===$(event.target).attr("qva-outside-ignore-for")||$(event.target).closest('[qva-outside-ignore-for="allOutside"]').length,override=$(event.target).data("overrideignore"),(!forceIgnore||override)&&(attr.qvaOutsideIgnoreFor&&attr.qvaOutsideIgnoreFor===$(event.target).closest("[qva-outside-ignore-for]").attr("qva-outside-ignore-for")||scope.$apply(function(){fn(scope,{$event:event})}))})}}]),qvangular.directive("qvaOnDragstart",["$parse",function($parse){return function(scope,element,attrs){if("ondragstart"in window){var fn=$parse(attrs.qvaOnDragstart);scope.$watch(attrs.qvaDragDisabled,function(disabled){disabled||element.attr("draggable","true").addClass("draggable").on("dragstart",function(event){$(this).addClass("dragging"),fn(scope,{$event:event})}).on("dragend",function(){$(this).removeClass("dragging")}).on("selectstart",function(e){var target=e.originalEvent.target;target.dragDrop&&target.dragDrop()}).on("mousedown","button",function(e){e.preventDefault()})})}}}]),qvangular.directive("qvaModelOnblur",function(){return{restrict:"A",require:"ngModel",priority:1,link:function(scope,elm,attr,ngModelCtrl){"radio"!==attr.type&&"checkbox"!==attr.type&&(elm.unbind("input keydown change compositionend"),elm.bind("blur",function(){scope.$apply(function(){"undefined"!=typeof attr.qvaCancelEditingOnEmpty&&""===elm.val().trim()?elm.val(ngModelCtrl.$modelValue):ngModelCtrl.$setViewValue(elm.val())})}),elm.bind("keydown",function(e){27===e.which?(e.stopPropagation(),elm.val(ngModelCtrl.$modelValue),elm.closest("*[tabindex]").focus()):13===e.which&&(e.stopPropagation(),elm.closest("*[tabindex]").focus())}))}}}),qvangular.directive("qvaSelect",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,data){(0===data.qvaSelect.length||"true"===data.qvaSelect)&&Support.treatAsDesktop()&&$timeout(function(){element[0].select()},100)}}}]),qvangular.directive("qvaSelectWatch",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaSelectWatch,function(val){(""===attrs.qvaSelectWatch||""!==attrs.qvaSelectWatch&&val===!0)&&Support.treatAsDesktop()&&$timeout(function(){element[0].select()})},!0)}}}]),qvangular.directive("qvaFallbackSrc",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("error",function(){angular.element(this).attr("src",attrs.qvaFallbackSrc)})}}}),qvangular.directive("qvaFocus",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaFocus,function(val){val===!0&&$timeout(function(){element[0].focus()})},!0)}}}]),qvangular.directive("qveHighlight",highlight),qvangular.directive("qvaReportedWindowSize",function(){return{restrict:"A",link:function(scope,elem,attr){function reportSize(){qvangular.$apply(function(){scope[attr.qvaReportedWindowSize]={width:$(window).width(),height:$(window).height()}})}reportSize(),$(window).bind("resize",reportSize),scope.$on("$destroy",function(){$(window).unbind("resize",reportSize)})}}}),qvangular.directive("qvGlobalKeydown",getKeydownDirectiveWithKeyCode("qvGlobalKeydown",void 0,$("body"))),qvangular.directive("qvGlobalEscape",getKeydownDirectiveWithKeyCode("qvGlobalEscape",27,$("body"))),qvangular.directive("qvGlobalEnter",getKeydownDirectiveWithKeyCode("qvGlobalEnter",13,$("body"))),qvangular.directive("qvKeydown",getKeydownDirectiveWithKeyCode("qvKeydown",void 0)),qvangular.directive("qvEscape",getKeydownDirectiveWithKeyCode("qvEscape",27)),qvangular.directive("qvEnter",getKeydownDirectiveWithKeyCode("qvEnter",13))}),define("text!assets/qvangular/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\r\n		class="qui-popover-button qui-dropdown"\r\n		tid="{{quiModel.tid}}"\r\n		data-ng-disabled="quiModel.isDisabled()"\r\n		data-ng-class="buttonClasses"\r\n		data-icon="{{quiModel.icon}}"\r\n		q-title-translation="{{currentTitle}}"\r\n		data-qva-activate="onClick()"></button>'}),define("text!assets/qvangular/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo"\r\n					  smallview="quiModel.menuOptions.smallview"\r\n					  position="quiModel.menuOptions.position"\r\n					  width="quiModel.menuOptions.width"\r\n					  top="quiModel.menuOptions.top"\r\n					  hidepointer="quiModel.menuOptions.hidepointer"\r\n					  on-close-view="onClose(event)">\r\n	<div qva-include-qui-popover-button component=\'quiList\' input="quiModel.menuOptions.content" data-destroy-component="closeFromContent()"></div>\r\n</immidiate-contextual>'}),define("general.services/show-service/show-service",["jquery","assets/qvangular/qvangular-core","core.utils/deferred"],function($,qvangular,Deferred){"use strict";function ensureInitialized(){if(!initialized){var elementAtTheEndOfTheBody=$("<div id='show-service-popup-dialog'></div>");$("body").append(elementAtTheEndOfTheBody),elementAtTheEndOfTheBody.showComponent(containerComponent,{views:views}),initialized=!0}}function showNormal(component,input){function destroy(){var index=views.indexOf(view);index>=0&&views.splice(index,1)}ensureInitialized();var deferredResult=new Deferred,view={component:component,input:input,deferredResult:deferredResult,exposedApi:{destroy:destroy,resultPromise:deferredResult.promise}};return views.push(view),view.exposedApi}function showDeferred(component,input){var locals={$element:$("body"),input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key]);return qvangular.$injector.invoke(component,{},locals)}function show(component,input){return"function"==typeof component||Array.isArray(component)?showDeferred(component,input):showNormal(component,input)}function isViewShowing(){return views.length>0}var initialized,views=[];qvangular.componentDirective("qvShowServiceView",{destroyComponent:"&",input:"=",deferredResult:"=",exposedApi:"="});var containerComponent={template:"<div><div ng-repeat='view in views' qv-show-service-view component='view.component' data-input='view.input' data-deferred-result='view.deferredResult' destroy-component='unshow(view)' data-exposed-api='view.exposedApi'></div></div>",controller:["$scope",function($scope){$scope.unshow=function(view){var index=$scope.views.indexOf(view);index>=0&&$scope.views.splice(index,1)}}]},exports={show:show,isViewShowing:isViewShowing};return exports}),define("text!assets/qlikui/components/qui-list/qui-list.ng.html",[],function(){return'<ul ng-class="menuClasses" tid="{{tid}}">\r\n	<li class="toolbar-menu-li" ng-repeat="menuItem in menuItems" data-icon="{{menuItem.icon}}" ng-disabled="menuItem.disable" qui-click=\'menuItem.fn()\' ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\r\n		<span class="qui-textlist-text"\r\n			  tid="{{menuItem.tid}}"\r\n			  q-title-translation="{{ menuItem.title || menuItem.text}}"\r\n			  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\r\n			  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\r\n		</span>\r\n		<span ng-if="menuItem.openInNewTab" class="open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" data-icon="stacked-windows" q-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}" qva-activate="selectMenuItem(menuItem, $event, \'true\')" ng-disabled="menuItem.disable"></span>\r\n	</li>\r\n</ul>'}),define("assets/qlikui/components/qui-list/qui-list",["qlikui/qui","text!./qui-list.ng.html"],function(qui,listTemplate){return qui.component("quiList",{scope:{tid:"=",menuClasses:"=",createMenuItems:"="},template:listTemplate,controller:["$scope",function($scope){$scope.menuClasses=$scope.menuClasses?$scope.menuClasses:"qui-textlist",$scope.createMenuItems().then(function(items){$scope.menuItems=items}),$scope.selectMenuItem=function(menuItem,event,openInNewTab){event&&event.preventDefault&&event.preventDefault(),menuItem.disable||($scope.destroyComponent(),menuItem.selected(event,openInNewTab))}}]})}),define("pubsub",[],function(){function PubSub(){this.topics={},this.wildcards=[]}return PubSub.prototype.getTopics=function(topic,create){var topicArray=this.topics[topic];return"undefined"==typeof topicArray&&create&&(topicArray=this.topics[topic]=[]),topicArray},PubSub.prototype.createMatcher=function(topic){return topic=topic.replace(/\$/g,"\\$"),new RegExp("^"+topic.replace(/\*/g,".+?")+"$","i")},PubSub.prototype.subscribe=function(topic,handler,context){if(topic=topic.toLowerCase().split("."),"function"!=typeof handler)throw"pubsub: Invalid handler";var obj={handler:handler,topic:topic[0],namespace:topic[1],context:context||window};topic[0].indexOf("*")>-1?(obj.matcher=this.createMatcher(topic[0]),this.wildcards.push(obj)):this.getTopics(topic[0],!0).push(obj)},PubSub.prototype.subscribeOnce=function(topic,handler,context){function wrapper(){handler.apply(this,arguments),self.unsubscribe(topic,handler)}var self=this;wrapper.original=handler,this.subscribe(topic,wrapper,context)},PubSub.prototype.unsubscribe=function(topic,handler){topic=topic.toLowerCase(),this["."===topic[0]?"unsubscribeNamespace":"unsubscribeTopic"](topic,handler)},PubSub.prototype.unsubscribeNamespace=function(namespace){function compare(item){return item.namespace!==namespace}namespace=namespace.substr(1);var topic;this.wildcards=this.wildcards.filter(compare);for(topic in this.topics)this.topics[topic]=this.topics[topic].filter(compare),this.topics[topic].length||delete this.topics[topic]},PubSub.prototype.unsubscribeTopic=function(topic,handler){function matcher(item){var result=item.topic!==topic[0];return!result&&handler&&(result=item.handler.original?item.handler.original!==handler:item.handler!==handler),result}topic=topic.split(".");var arr=this.getTopics(topic[0]);this.wildcards=this.wildcards.filter(matcher),arr&&(arr=this.topics[topic[0]]=arr.filter(matcher),arr.length||delete this.topics[topic[0]])},PubSub.prototype.publish=function(topic,data){function callIt(item){(!item.matcher||item.matcher&&item.matcher.test(topic[0]))&&item.handler.call(item.context,data,topic[0])}topic=topic.toLowerCase().split(".");var arr=this.getTopics(topic[0]);this.wildcards.forEach(callIt),arr&&arr.forEach(callIt)},window.pubsub=new PubSub,window.pubsub}),define("general.utils/android-keyboard-fix",[],function(){"use strict";function AndroidKeyboardFix(viewport,_window,_document){this.lastHeight=null,this.document=_document||document,this.window=_window||window,this.viewport=viewport||this.document.querySelector("meta[name=viewport]"),this.viewportContent=this.viewport.getAttribute("content"),this.updateHeight()}return AndroidKeyboardFix.prototype.clearHeight=function(){this.viewport.setAttribute("content",this.viewportContent)},AndroidKeyboardFix.prototype.setHeight=function(height){this.viewport.setAttribute("content",this.viewportContent+", height="+height)},AndroidKeyboardFix.prototype.updateHeight=function(){var w_height=this.window.innerHeight;return this.lastHeight!==w_height?(this.lastHeight=w_height,this.setHeight(w_height),!0):!1},AndroidKeyboardFix.prototype.rotate=function(resize){var update=function(){this.updateHeight()&&resize()}.bind(this);this.document.activeElement&&this.document.activeElement.blur(),
this.clearHeight(),this.window.setTimeout(update,500),this.window.setTimeout(update,1e3),this.window.setTimeout(update,1500)},AndroidKeyboardFix.isNeeded=function(){var isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;return isAndroid},AndroidKeyboardFix}),define("core.utils/resize",["touche","pubsub","general.utils/android-keyboard-fix"],function(Touche,pubsub,AndroidKeyboardFix){function start(e){isStarted=!0,publish("/resize/start",e)}function end(e){publish("/resize/end",e),isStarted=!1}function publish(topic,e){pubsub.publish(topic,{width:window.innerWidth,height:window.innerHeight,element:e.target})}function resizeEvt(e){(e.target===window||e.target===document)&&(isStarted||start(e),clearTimeout(timer),publish("/resize/update",e),timer=setTimeout(function(){end(e)},delay))}function orientationEvt(e){keyboardfix?keyboardfix.rotate(function(){start(e),end(e)}):(start(e),end(e))}var timer,delay=250,isStarted=!1,keyboardfix=AndroidKeyboardFix.isNeeded()?new AndroidKeyboardFix:null;return Touche.utils.touch&&"ondeviceorientation"in window&&window.addEventListener("orientationchange",orientationEvt,!1),keyboardfix||window.addEventListener("resize",resizeEvt,!1),{on:function(type,callback){pubsub.subscribe("/resize/"+type,callback)},off:function(type,callback){pubsub.unsubscribe("/resize/"+type,callback)},force:function(type){type=type||"end",pubsub.publish("/resize/"+type)}}}),define("general.utils/window-positioner",["jquery","objects.utils/shapes/rect"],function($,Rect){"use strict";function rectRight(dialog,target){var top,left,maxH=$("body").outerHeight();return top=target.y+target.height/2-dialog.height/2,top=0>top?0:top,maxH-top-dialog.height<0&&(top=maxH-dialog.height),left=target.x+target.width,new Rect(left,top,dialog.width,dialog.height)}function rectBottom(dialog,target){var top,left,maxW=$("body").outerWidth();return left=target.x+target.width/2-dialog.width/2,left=0>left?0:left,maxW-left-dialog.width<0&&(left=maxW-dialog.width),top=target.y+target.height,new Rect(left,top,dialog.width,dialog.height)}function rectLeft(dialog,target){var top,left,maxH=$("body").outerHeight();return top=target.y+target.height/2-dialog.height/2,top=0>top?0:top,maxH-top-dialog.height<0&&(top=maxH-dialog.height),left=target.x-dialog.width,new Rect(left,top,dialog.width,dialog.height)}function rectTop(dialog,target){var top,left,maxW=$("body").outerWidth();return left=target.x+target.width/2-dialog.width/2,left=0>left?0:left,maxW-left-dialog.width<0&&(left=maxW-dialog.width),top=target.y-dialog.height,new Rect(left,top,dialog.width,dialog.height)}function getElemRect(elem){var offset=elem[0]===window?{left:0,top:0}:elem.offset();return new Rect(offset.left,offset.top,elem.outerWidth(),elem.outerHeight())}function getPositionRect(dialog,target,position){var func,map={top:rectTop,right:rectRight,bottom:rectBottom,left:rectLeft};return func=map[position]||rectRight,func.call({},dialog,target)}function validatePosition(position){var valid="bottom,bottomLeft,bottomRight,centerLeft,center,centerRight,topLeft,top,topRight,topLeft,left,right".split(",");if(-1===valid.indexOf(position))throw new Error("Not a valid docking position. Try "+valid.join(" ,")+".")}function distanceOutsideWindow(position,dialog,windowRect){return"right"===position?dialog.getRight()-windowRect.getRight():"left"===position?windowRect.x-dialog.x:"top"===position?windowRect.y-dialog.y:"bottom"===position?dialog.getBottom()-windowRect.getBottom():0}function flip(position){var map={top:"bottom",right:"left",bottom:"top",left:"right"};return map[position]}function allowFlip(collision){return"flip"===collision||"flipfit"===collision}function allowFit(collision){return"fit"===collision||"flipfit"===collision}function getPositionAxis(position){var map={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"};return map[position]}function getAxisPositions(axis){var map={vertical:["top","bottom"],horizontal:["left","right"]};return map[axis]}function flipAxis(axis){var map={horizontal:"vertical",vertical:"horizontal"};return map[axis]}function getCollision(options){var values=options.collision.split(" "),collision={horizontal:values[0],vertical:values[1]||values[0]},primaryAxis=getPositionAxis(options.position),secondaryAxis=flipAxis(primaryAxis);return{flipPrimary:allowFlip(collision[primaryAxis]),fitPrimary:allowFit(collision[primaryAxis]),fitSecondary:allowFit(collision[secondaryAxis])}}function fitRect(rect,sides,windowRect){var i,side;for(i=0;i<sides.length;i++){if(side=sides[i],"left"===side&&rect.x<windowRect.x){rect.x=windowRect.x;break}if("right"===side&&rect.getRight()>windowRect.getRight()){rect.x=windowRect.getRight()-rect.width;break}if("top"===side&&rect.y<window.y){rect.y=window.y;break}if("bottom"===side&&rect.getBottom()>windowRect.getBottom()){rect.y=windowRect.getBottom()-rect.height;break}}return rect}function calculatePossiblePositionsAndAligns(aligns,positions,shapeIsArc,cx,cy,d){if(!shapeIsArc)return aligns.map(function(a,index){return{align:a,x:positions[index].x,y:positions[index].y}});var x=positions[0].x,y=positions[0].y,createObjects=function(a){var i,t,x0,y0,len=a?a.length/2:0,positionsAndAligns=new Array(len);for(i=0;len>i;i++)t=a[2*i+1],x0=t*x+(1-t)*cx,y0=t*y+(1-t)*cy,positionsAndAligns[i]={align:a[2*i],x:x0,y:y0};return positionsAndAligns},combinedAligns=aligns[0]+(aligns[1]?"-"+aligns[1]:""),tc1=1,tc2=.7,tc3=.5,tf1=d>.5?0:.5-d,tf2=d>.5?.5:.7-.4*d;switch(combinedAligns){case"top":return createObjects(x>=cx?["top",tc1,"top",tc2,"top",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"bottom",tf1,"bottom",tf2]:["top",tc1,"top",tc2,"top",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"bottom",tf1,"bottom",tf2]);case"top-right":return createObjects(["top",tc1,"top",tc2,"top",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"bottom",tf1,"bottom",tf2]);case"top-left":return createObjects(["top",tc1,"top",tc2,"top",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"bottom",tf1,"bottom",tf2]);case"bottom":return createObjects(x>=cx?["bottom",tc1,"bottom",tc2,"bottom",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"top",tf1,"top",tf2]:["bottom",tc1,"bottom",tc2,"bottom",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"top",tf1,"top",tf2]);case"bottom-right":return createObjects(["bottom",tc1,"bottom",tc2,"bottom",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"top",tf1,"top",tf2]);case"bottom-left":return createObjects(["bottom",tc1,"bottom",tc2,"bottom",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"top",tf1,"top",tf2]);case"left":return createObjects(cy>=y?["left",tc1,"left",tc2,"left",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"right",tc3,"right",tc2]:["left",tc1,"left",tc2,"left",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"right",tc3,"right",tc2]);case"left-top":return createObjects(["left",tc1,"left",tc2,"left",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"right",tc3,"right",tc2]);case"left-bottom":return createObjects(["left",tc1,"left",tc2,"left",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"right",tc3,"right",tc2]);case"right":return createObjects(cy>=y?["right",tc1,"right",tc2,"right",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"left",tc3,"left",tc2]:["right",tc1,"right",tc2,"right",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"left",tc3,"left",tc2]);case"right-top":return createObjects(["right",tc1,"right",tc2,"right",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"left",tc3,"left",tc2]);case"right-bottom":return createObjects(["right",tc1,"right",tc2,"right",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"left",tc3,"left",tc2])}}var positioner={align:function(dialogElement,alignToElement,options){if(options=options||{position:"right",collision:"none"},options.position=options.position||"right",options.collision=options.collision||"none",dialogElement&&alignToElement){var isFlipPositionBetter,windowRect=getElemRect($(window)),dialog=getElemRect(dialogElement),target=getElemRect(alignToElement),collision=getCollision(options),positionRect=getPositionRect(dialog,target,options.position);isFlipPositionBetter=function(rect){var flipRect=getPositionRect(dialog,target,flip(options.position)),distance=distanceOutsideWindow(options.position,rect,windowRect),flipDistance=distanceOutsideWindow(flip(options.position),flipRect,windowRect);return distance>flipDistance},collision.flipPrimary&&distanceOutsideWindow(options.position,positionRect,windowRect)>0&&isFlipPositionBetter(positionRect)&&(positionRect=getPositionRect(dialog,target,flip(options.position)),options.position=flip(options.position)),collision.fitPrimary&&(positionRect=fitRect(positionRect,[options.position],windowRect)),collision.fitSecondary&&(positionRect=fitRect(positionRect,getAxisPositions(flipAxis(getPositionAxis(options.position))),windowRect)),options.limits&&positionRect.y<options.limits.top&&(positionRect.y=options.limits.top),dialogElement.offset({top:positionRect.y,left:positionRect.x})}return options.position},alignToCoordinate:function(dialogElement,x,y,position,secondaryPosition){validatePosition(position);var calculatePosition,point;position=position||"top",calculatePosition=function(pos,x0,y0){var x1=x0,y1=y0;switch(pos){case"topRight":y1=y0-dialogElement.outerHeight();break;case"top":x1=x0-dialogElement.outerWidth()/2,y1=y0-dialogElement.outerHeight();break;case"topLeft":x1=x0-dialogElement.outerWidth(),y1=y0-dialogElement.outerHeight();break;case"right":case"centerRight":y1=y0-dialogElement.outerHeight()/2;break;case"center":x1=x0-dialogElement.outerWidth()/2,y1=y0-dialogElement.outerHeight()/2;break;case"left":case"centerLeft":x1=x0-dialogElement.outerWidth(),y1=y0-dialogElement.outerHeight()/2;break;case"bottom":x1=x0-dialogElement.outerWidth()/2;break;case"bottomLeft":x1=x0-dialogElement.outerWidth();break;case"bottomRight":x1=x0,y1=y0}return{x:x1,y:y1}},point=calculatePosition(position,x,y);var win,padding,xDiff,yDiff,min={},max={};win=$(window),padding=10,max.x=win.outerWidth()-dialogElement.outerWidth()-padding,min.x=padding,max.y=win.outerHeight()-dialogElement.outerHeight()-padding,min.y=padding;var getDiff=function(dir,poi){return poi[dir]>max[dir]?poi[dir]-max[dir]:poi[dir]<min[dir]?min[dir]-poi[dir]:0};if(secondaryPosition){xDiff=getDiff("x",point),yDiff=getDiff("y",point);var newPoint=calculatePosition(secondaryPosition,x,y);(xDiff>getDiff("x",newPoint)||yDiff>getDiff("y",newPoint))&&(point=newPoint,position=secondaryPosition)}return point.x=Math.max(min.x,Math.min(max.x,point.x)),point.y=Math.max(min.y,Math.min(max.y,point.y)),dialogElement.offset({left:point.x,top:point.y}),position},alignToBestCoordinate:function(dialogElement,positions,aligns,target,shapeIsArc,innerPadding,outerPadding){validatePosition(aligns[0]),positions=positions instanceof Array?positions:[positions];var x=positions[0].x,y=positions[0].y;dialogElement.offset({left:0,top:0}),dialogElement.width("auto"),dialogElement.height("auto");var win=$(window),windowWidth=win.outerWidth(),windowHeight=win.outerHeight(),dialogWidth=dialogElement.outerWidth(),dialogHeight=dialogElement.outerHeight(),min={},max={};outerPadding=void 0===outerPadding?5:outerPadding;var padding=(void 0===innerPadding?5:innerPadding)+outerPadding;max.x=windowWidth-dialogWidth-padding,min.x=outerPadding,max.y=windowHeight-dialogHeight-padding,min.y=outerPadding,dialogWidth+2*padding>windowWidth&&(dialogWidth=windowWidth-2*padding,dialogElement.width(dialogWidth),max.x=min.x),dialogHeight+2*padding>windowHeight&&(dialogHeight=windowHeight-2*padding,dialogElement.height(dialogHeight),max.y=min.y),aligns=aligns||["top"];var k,goodAlign,point,cx,cy,r1,r2,d,xDiff,yDiff,possiblePositionsAndAligns,calculatePosition=function(align0,x0,y0){var x1=x0,y1=y0;switch(align0){case"topRight":y1=y0-dialogHeight;break;case"top":x1=x0-dialogWidth/2,y1=y0-dialogHeight;break;case"topLeft":x1=x0-dialogWidth,y1=y0-dialogHeight;break;case"right":case"centerRight":y1=y0-dialogHeight/2;break;case"center":x1=x0-dialogWidth/2,y1=y0-dialogHeight/2;break;case"left":case"centerLeft":x1=x0-dialogWidth,y1=y0-dialogHeight/2;break;case"bottom":x1=x0-dialogWidth/2;break;case"bottomLeft":x1=x0-dialogWidth;break;case"bottomRight":x1=x0,y1=y0}return{x:x1,y:y1}},getDiff=function(axis,p){return p[axis]>max[axis]?p[axis]-max[axis]:p[axis]<min[axis]?p[axis]-min[axis]:0},goodX=x,goodY=y;shapeIsArc&&(cx=target.shape.cx+target.targetToPageTranslation.x,cy=target.shape.cy+target.targetToPageTranslation.y,r1=target.shape.innerRadius,r2=target.shape.radius,d=0,r1>0&&(d=r1/r2,cx+=d*(x-cx),cy+=d*(y-cy))),possiblePositionsAndAligns=calculatePossiblePositionsAndAligns(aligns,positions,shapeIsArc,cx,cy,d);var findGoodPositionAndAlign=function(){for(k=0;k<possiblePositionsAndAligns.length;k++)if(goodAlign=possiblePositionsAndAligns[k].align,goodX=possiblePositionsAndAligns[k].x,goodY=possiblePositionsAndAligns[k].y,point=calculatePosition(goodAlign,goodX,goodY),xDiff=getDiff("x",point),yDiff=getDiff("y",point),(0!==xDiff||0!==yDiff)&&(0!==yDiff||"top"!==goodAlign&&"bottom"!==goodAlign?0!==xDiff||"left"!==goodAlign&&"right"!==goodAlign||(point.y-=yDiff,yDiff=0):(point.x-=xDiff,xDiff=0)),0===xDiff&&0===yDiff)return};return findGoodPositionAndAlign(),point&&dialogElement.offset({left:point.x,top:point.y}),{position:goodAlign,x:goodX,y:goodY}}};return positioner}),define("general.utils/arrow-positioner",[],function(){"use strict";function opposite(position){var map={left:"right",right:"left",top:"bottom",bottom:"top"};return map[position]}function align(dialogElem,alignTo,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},factor=factors[position],parent_width=dialogElem.outerWidth(),parent_height=dialogElem.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height),top=alignTo.offset().top+alignTo.outerHeight()*(1-factor.height)-dialogElem.offset().top-pointer_width*(1-factor.height)):(left=alignTo.offset().left+alignTo.outerWidth()*(1-factor.width)-dialogElem.offset().left-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)),pointer.css({left:parseInt(left,10),top:parseInt(top,10)})}function alignToCoordinate(dialogElem,x,y,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5,size:-1.5},right:{width:1,height:.5,size:.5},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}},factor=factors[position],parent_width=dialogElem.outerWidth(),parent_height=dialogElem.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height)+pointer_height*factor.size,top=y-dialogElem.offset().top-pointer_height*(1-factor.height)):(left=x-dialogElem.offset().left-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)+pointer_height*factor.size),pointer.css({left:floor(left),top:floor(top)})}function alignToParent(dialogElement,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},factor=factors[position],parent_width=dialogElement.outerWidth(),parent_height=dialogElement.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height),top=pointer.offset().top-pointer_width*(1-factor.height)):(left=parent_width*(1-factor.width)-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)+pointer_height),pointer.css({left:left,top:top})}var floor=Math.floor;return{align:align,alignToParent:alignToParent,alignToCoordinate:alignToCoordinate}}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div class='qui-immidiateContextual' qva-outside='onOutsidePopover($event)'>\r\n	<div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n	<div class='content' ng-transclude></div>\r\n</div>\r\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)' qva-outside='onOutsidePopover($event)'>\r\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n    <div class='content' ng-transclude></div>\r\n</div>\r\n"}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function($,windowPositioner,arrowPositioner,template,templateSmall,qvangular,resize,DOMUtil,responsiveState){qvangular.directive("immidiateContextual",function(){return{replace:!0,template:function(elm,attr){var tmp=template;return responsiveState.isSmallDevice&&attr.smallview&&(tmp=templateSmall),tmp},transclude:!0,scope:{onCloseView:"&",hidepointer:"="},restrict:"E",link:function(scope,element,attrs){var realPosition,timeoutId,alignTo=$(scope.$parent.$eval(attrs.alignTo)),offset=$(scope.$parent.$eval(attrs.offset))[0],width=scope.$parent.$eval(attrs.width),top=scope.$parent.$eval(attrs.top),height=scope.$parent.$eval(attrs.height),position=scope.$parent.$eval(attrs.position),limits=scope.$parent.$eval(attrs.limits)||null,collision=scope.$parent.$eval(attrs.collision)||"none";"undefined"!=typeof height&&element.css("height",height||"100"),"undefined"!=typeof width&&element.css("width",width||"100"),scope.onOutsidePopover=function(event){event.stopPropagation(),event.preventDefault(),scope.onCloseView({event:event})},$(document).on("keydown.immediateContextual",function(event){var isInput=DOMUtil.isInput(document.activeElement);!$(".qui-immidiateContextual").length||isInput||9!==event.which&&32!==event.which||(event.preventDefault(),scope.onCloseView({event:event}),scope.$apply(),alignTo.hasClass("qui-button")&&alignTo.hasClass("qui-active")&&alignTo.removeClass("qui-active"))}),scope.positionMap=function(position){var map={topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"};return map[position]},scope.synchronAlign=function(){scope.hidepointer?scope.$parent.event&&(realPosition=windowPositioner.alignToCoordinate(element,scope.$parent.event.pageX,scope.$parent.event.pageY,attrs.position)):(offset?(realPosition=windowPositioner.alignToCoordinate(element,offset.x,offset.y,position),realPosition=scope.positionMap(realPosition)):realPosition=windowPositioner.align(element,alignTo,{position:position,collision:collision,limits:limits}),element.find("div.immidiate-contextual-arrow").addClass(realPosition),arrowPositioner.align(element,alignTo,realPosition,element.children("div.immidiate-contextual-arrow")))},scope.align=function(){"undefined"!=typeof top&&element.css({top:parseInt(top,10)}),timeoutId=qvangular.getService("$timeout")(scope.synchronAlign)},scope.$on("recalculatePointer",function(){scope.hidepointer||arrowPositioner.align(element,alignTo,realPosition,element.children("div.immidiate-contextual-arrow"))}),scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(timeoutId),resize.off("end",scope.align),$(document).off("keydown.immediateContextual")}),resize.on("end",scope.align),scope.align()}}})}),define("assets/qvangular/qui-popover-button/qui-popover-button",["assets/qvangular/qvangular-core","jquery","text!./qui-popover-button.ng.html","text!./qui-popover-button-menu.ng.html","general.services/show-service/show-service","assets/qlikui/components/qui-list/qui-list","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(qvangular,$,template,menuTemplate,showService,quiList,resize){qvangular.componentDirective("qvaIncludeQuiPopoverButton",{ngModel:"=",destroyComponent:"&"});var popoverContainerComponent={template:menuTemplate,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function($scope){$scope.quiList=quiList,$scope.shared.destroyComponent=$scope.destroyComponent,$scope.onClose=function($event){$($event.target).hasClass("qui-popover-button")&&$scope.quiModel.tid===$($event.target).attr("tid")||($scope.destroyComponent(),$scope.shared.pressed=!1)},$scope.closeFromContent=function(){$scope.destroyComponent(),$scope.shared.pressed=!1},$scope.$on("$destroy",function(){resize.off("start",$scope.onClose)}),resize.on("start",$scope.onClose)}]};qvangular.directive("quiPopoverButton",function(){return{template:template,transclude:!0,replace:!0,restrict:"E",scope:{quiModel:"="},controller:["$scope","$element",function($scope,$element){$scope.shared={},$scope.shared.pressed=!1,$scope.buttonClasses={"qui-active":$scope.shared.pressed},$scope.$watch("quiModel.buttonType",function(buttonType){buttonType&&($scope.buttonClasses[buttonType]=!0)}),$scope.$watch("shared.pressed",function(pressed){$scope.buttonClasses["qui-active"]=pressed,$scope.currentTitle=pressed&&$scope.quiModel.tooltipActive?$scope.quiModel.tooltipActive:$scope.quiModel.tooltipInactive}),$scope.onClick=function(){$scope.shared.pressed?($scope.shared.destroyComponent(),$scope.shared.pressed=!1):($scope.shared.pressed=!0,showService.show(popoverContainerComponent,{quiModel:$scope.quiModel,alignTo:$element,shared:$scope.shared}))}}]}})}),define("qvangular",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-locale","assets/qvangular/qvangular-filters","assets/qvangular/qvangular-directives","assets/qvangular/qvangular-qui","assets/qvangular/qui-popover-button/qui-popover-button"],function(qvangularCore){return qvangularCore}),define("general.enums/qrs-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_JSON_RPC_ENTITY_NOT_FOUND:-32001,LOCERR_JSON_RPC_ACCESS_DENIED:-32002,LOCERR_JSON_RPC_APP_DUPLICATION_FAILED:-32003}}}),define("core.utils/external-urls",["translator"],function(translator){var ExternalUrls={serverHelpBaseUrl:"http://help.qlik.com/sense/2.1/",personalHelpBaseUrl:"http://help.qlik.com/sense/2.1/",cloudBaseUrl:"https://qlikcloud.com/",cloudUploadUrl:"https://qlikcloud.com/upload?",personalUpgradeBase:"qlik.com/QlikSenseDesktopUpgrade",personalUpgradeUrl:"http://qlik.com/QlikSenseDesktopUpgrade"};return Object.defineProperty(ExternalUrls,"gettingStarted",{get:function(){return"http://www.qlik.com/"+translator.language+"-sense-gettingstarted"}}),ExternalUrls}),define("text!client.controllers/expire-dialog.ng.html",[],function(){return"<div>\r\n	<p class='dm-pb' ng-class=\"{'dm-pt': noTitle}\" q-translation=\"{{content}}\"></p>\r\n	<p><upgrade-msg/></p>\r\n</div>"}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="qui-delayedModal" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle" tid="errorDialog">\r\n	<header class="dm-header" ng-if="title" q-translation="{{title}}"></header>\r\n	<main ng-if="!html" class="dm-main"> <p class="dm-p">{{content | translate}}</p></main>\r\n	<main ng-if="html" class="dm-main qv-appname"></main>\r\n	<footer class="dm-footer">\r\n		<qui-button qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" qva-activate="closeModal( $event, true );" qva-focus="true"\r\n					q-translation="Common.OK" tid="confirm"></qui-button>\r\n		<qui-button qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" qva-activate="closeModal( $event );" ng-disabled="button.expression === false"\r\n					q-translation="{{button.name}}" tid="{{button.tid}}"></qui-button>\r\n	</footer>\r\n</div>\r\n'}),define("text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\r\n	<!-- This will be replaced by ng-transclude -->\r\n</div>'}),define("assets/qlikui/components/qui-dialog-default/qui-dialog-default",["qlikui/qui","text!./qui-dialog-default.html"],function(qui,template){qui.component("quiDialogDefault",{template:template})}),define("text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\r\n		<main class="dm-main">\r\n			<p class="qui-pleasewaitdialog-loader-container"><img src="../resources/img/loader.svg"/></p>\r\n\r\n			<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qlikui/qui","text!./qui-dialog-pleasewait.html"],function(qui,template){qui.component("quiDialogPleasewait",{template:template})}),define("assets/qlikui/components/qui-input-number/numerical-interval-transformer",[],function(){function removeNonIntegers(value){return Number(String(value).replace(/[^-\d]/g,""))}return{getNumerical:function(value,min,max){return value=removeNonIntegers(value),min=Number(min),max=Number(max),min>value?min:0!==max&&value>max?max:value}}}),define("text!assets/qlikui/components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span>\r\n	<input class="qui-button" type="button" value="-" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n\r\n	<input type="tel" class="qui-input {{quiClass}}" tid="{{quiTid}}" title="{{quiTitle}}" ng-model="quiModel" ng-change="onChange()" ng-disabled="quiDisabled"/>\r\n\r\n	<input class="qui-button" type="button" value="+" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n</span>\r\n'}),define("assets/qlikui/components/qui-input-number/qui-input-number",["qlikui/qui","./numerical-interval-transformer","text!./qui-input-number.ng.html"],function(qui,numericalIntervalTransformer,template){qui.component("quiInputNumber",{template:template,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@",quiTid:"@"},controller:["$scope","$element",function($scope,$element){$scope.quiSelectTextOnFocus&&($scope.selected=!1,$element.click(function(){$scope.selected===!1&&($element.select(),$scope.selected=!0)}),$element.blur(function(){$scope.selected=!1})),$scope.onChange=function(newValue){var valueChange=parseInt(newValue)||0;$scope.quiModel=numericalIntervalTransformer.getNumerical(parseInt($element.find(".qui-input").val())+valueChange,$scope.quiMin,$scope.quiMax)}}]})}),define("text!assets/qlikui/components/qui-modal-default/qui-modal-default.html",[],function(){return'<div class="qui-modalbackground"></div>'}),define("assets/qlikui/components/qui-modal-default/qui-modal-default",["qlikui/qui","text!./qui-modal-default.html"],function(qui,template){qui.component("quiModalDefault",{template:template})}),define("text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html",[],function(){return'<div>\r\n	<label class="qui-radiobutton" ng-repeat="option in options" ng-class="{ \'qui-checked\' : option.value === quiSelectedValue, \'qui-disabled\': quiDisabled }">\r\n		<input type="radio" name="{{quiGroupName}}" value="{{option.value}}" ng-disabled="quiDisabled">\r\n		<div class="radio-wrap" ng-click="selected(option.value)">\r\n			<span class="radio"></span>\r\n			<span class="radio-text">{{option.label}}</span>\r\n			<div></div>\r\n		</div>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup",["qlikui/qui","text!./qui-radiobuttongroup.html"],function(qui,template){"use strict";qui.component("quiRadiobuttongroup",{template:template,scope:{quiGroupName:"@",quiOptions:"@",quiSelectedValue:"=",quiDisabled:"="},controller:["$scope",function($scope){function createSortableOptions(){for(var parsedOptions=JSON.parse($scope.quiOptions),sortedOptions=[],i=0;i<Object.keys(parsedOptions).length;i++){var key=Object.keys(parsedOptions)[i],value=parsedOptions[key];sortedOptions.push({label:key,value:value})}$scope.options=sortedOptions}$scope.selected=function(option){$scope.quiSelectedValue=option},$scope.isChecked=function(value){return $scope.quiSelectedValue===value?"checked":""},createSortableOptions()}]})}),define("text!assets/qlikui/components/qui-checkbox/qui-checkbox.html",[],function(){return'<label class="qui-checkboxicon" title="{{quiTitle}}" ng-class="{ \'qui-hover\': hover }" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n	<input type="checkbox" ng-model="quiModel" ng-disabled="quiDisabled">\r\n		<div class="check-wrap">\r\n			<span class="check"></span>\r\n			<span class="check-text">{{quiLabel}}</span>\r\n		</div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-checkbox/qui-checkbox",["qlikui/qui","text!./qui-checkbox.html"],function(qui,template){qui.component("quiCheckbox",{template:template,scope:{quiModel:"=",quiDisabled:"=",quiLabel:"@",quiTitle:"@"}})}),define("text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html",[],function(){return'<label class="qui-radiobutton" ng-class="{ \'qui-disabled\': quiDisabled, \'qui-hover\': hover }" title="{{quiTitle}}" qva-activate="focus()" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n    <input type="radio" value="{{quiValue}}" ng-model="quiModel" ng-disabled="quiDisabled" ng-change="quiChange" name="{{quiName}}" tid="{{quiTid}}">\r\n    <div class="radio-wrap" qui-tabindex="{{tabindex}}">\r\n        <span class="radio"></span>\r\n        <span class="radio-text">{{quiLabel}}</span>\r\n    </div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory",[],function(){"use strict";function RadioButtonLogic($scope){function updateTabindex(){$scope.tabindex=$scope.quiDisabled?-1:$scope.quiTabindex}function select(event){$scope.quiDiasabled||32===event.keyCode&&($scope.quiModel=$scope.quiValue,$scope.$apply())}return $scope.quiTabindex||($scope.quiTabindex=0),updateTabindex(),{select:select,updateTabindex:updateTabindex}}return{createRadioButtonLogic:function(scope){return new RadioButtonLogic(scope)}}}),define("assets/qlikui/directives/qui-tabindex/qui-tabindex-logic",[],function(){"use strict";function updateTabindex(tabindex,$element){0>tabindex?$element[0].removeAttribute("tabindex"):$element[0].setAttribute("tabindex",tabindex)}return{updateTabindex:updateTabindex}}),define("assets/qlikui/directives/qui-tabindex/qui-tabindex",["qlikui/qui","./qui-tabindex-logic"],function(factory,tabindexLogic){"use strict";factory.directive("quiTabindex",function(){return{restrict:"A",scope:{qvaTabindex:"@"},controller:["$scope","$element",function($scope,$element){$scope.$watch("qvaTabindex",function(tabindex){tabindexLogic.updateTabindex(tabindex,$element)})}]}})}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton",["qlikui/qui","text!./qui-radiobutton.html","./qui-radiobutton-logic-factory","../../directives/qui-tabindex/qui-tabindex"],function(qui,template,radioButtonLogicFactory){"use strict";qui.component("quiRadiobutton",{template:template,scope:{quiLabel:"@",quiTitle:"@",quiValue:"@",quiName:"@",quiTabindex:"@",quiModel:"=",quiDisabled:"=",quiChange:"=",quiTid:"@"},controller:["$scope","$element","$timeout",function($scope,$element,$timeout){$timeout(function(){function onKeyDown(event){radioButtonLogic.select(event)}var radioButtonLogic=radioButtonLogicFactory.createRadioButtonLogic($scope);$scope.$watch("quiDisabled",radioButtonLogic.updateTabindex),$scope.focus=function(){
$element[0].querySelector(".radio-wrap").focus()},$element.on("keydown",onKeyDown)})}]})}),define("text!assets/qlikui/components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\r\n	<div ng-transclude></div>\r\n</div>'}),define("assets/qlikui/components/qui-float/qui-float",["qlikui/qui","text!./qui-float.html"],function(qui,template){qui.component("quiFloat",{template:template,replace:!0,scope:{quiOffset:"=",quiResizeOnChange:"="},transclude:!0,controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function update(){$scope.quiOffset&&$scope.reportedSize&&$scope.reportedWindowSize?($scope.quiOffset.left+$scope.reportedSize.width<$scope.reportedWindowSize.width?$scope.left=$scope.quiOffset.left:$scope.left=$scope.reportedWindowSize.width-$scope.reportedSize.width,$scope.quiOffset.top+$scope.reportedSize.height<$scope.reportedWindowSize.height?$scope.top=$scope.quiOffset.top:$scope.top=$scope.reportedWindowSize.height-$scope.reportedSize.height,$scope.visible=!0):$scope.visible=!1}function contentSizeMaybeChanged(){$timeout(function(){$scope.reportedSize={width:$element.outerWidth(),height:$element.outerHeight()}})}$scope.$watch("quiResizeOnChange",contentSizeMaybeChanged,!0),$scope.$watch("[quiOffset, reportedSize, reportedWindowSize]",update,!0)}]})}),define("text!assets/qlikui/components/qui-button/qui-button.html",[],function(){return'<button class="{{className}}" ng-transclude></button>'}),define("assets/qlikui/components/qui-button/qui-button",["qlikui/qui","text!./qui-button.html"],function(qui,template){function setClassName(scope,outline,type,round,light){var a=["qui"];a.push(type||(outline?"outlinebutton":"button")),scope.className=a.join("-"),round&&(scope.className+=" round"),light&&(scope.className+="-light")}var ENTER=13;qui.component("quiButton",{template:template,scope:{theme:"@"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){setClassName($scope,$attrs.hasOwnProperty("outline"),$attrs.buttonType,$attrs.hasOwnProperty("round"),$attrs.hasOwnProperty("light")),$element.on("keypress",function(e){e.keyCode===ENTER&&$element.trigger("qv-activate")})}]})}),define("text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html",[],function(){return'<div class="switch qui-onoffswitch" ng-class="{ \'qui-focus\': focus, \'qui-checked\': value }" ng-disabled="readOnly">\r\n	<label class="onoffswitch-label" >\r\n		<input type="checkbox" ng-model="value" class="onoffswitch-checkbox" ng-disabled="readOnly || touch">\r\n		<span class="onoffswitch-span">\r\n			<div class="onoffswitch-inner"></div>\r\n			<div class="onoffswitch-switch" ></div>\r\n		</span>\r\n	</label>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-toggle-switch/qui-toggle-switch",["qlikui/qui","text!./qui-toggle-switch.ng.html"],function(qui,template){qui.component("quiToggleSwitch",{scope:{readOnly:"=",value:"=",isFocused:"=?"},template:template,controller:["$scope","$element",function($scope,$element){var linkFn=qui.getConfigOption("quiToggleSwitchLink");"function"==typeof linkFn&&linkFn($scope,$element)}]})}),define("text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html",[],function(){return'<div class="qui-searchfield"  ng-class="{ \'qui-focus\': focus }" ng-disabled="disabled">\r\n	<span class="magnifying-glass"></span>\r\n	<span q-title-translation="Common.Clear" class="clear-button" ng-show="query.length" qva-activate="clearSearch($event)"></span>\r\n	<input maxlength="{{maxlength || 255}}" q-placeholder="{{placeholder}}" ng-model="query" ng-disabled="disabled" autocomplete="{{autocomplete}}" spellcheck="false" ng-trim="false" type="text" qva-blur="blurred()"\r\n			qva-focus="autoFocus" qv-escape="escape($event)" qv-enter="enter($event)"/>\r\n</div>'}),define("assets/qlikui/components/qui-search-field/qui-search-field",["qlikui/qui","text!./qui-search-field.ng.html"],function(qui,template){qui.component("quiSearchField",{scope:{query:"=",disabled:"=",autocomplete:"=",placeholder:"@",autoFocus:"=?",isFocused:"=?",focuscallback:"&",maxlength:"=",onEscape:"&",onEnter:"&"},template:template,link:function(scope,element){var clearButton=element.find("span.clear-button"),input=element.find("input");scope.focus=!1,input.on("focus.quiSearchField",function(){scope.$root.$$phase?scope.focused():scope.$apply(function(){scope.focused()})}),scope.focused=function(){scope.focuscallback(),scope.focus=!0,scope.isFocused=!0},scope.blurred=function(){scope.focus=!1,scope.isFocused=!1},scope.escape=function(event){scope.onEscape&&scope.onEscape({$event:event})},scope.enter=function(event){scope.onEnter&&scope.onEnter({$event:event})},scope.clearSearch=function(event){event.preventDefault(),scope.query="",input[0]&&qui.getConfigOption("treatAsDesktop")&&input[0].focus()},scope.$on("$destroy",function(){input.off(".quiSearchField"),clearButton.off(".quiSearchField")})}})}),define("text!assets/qlikui/components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter qui-buttongroup">\r\n	<qui-button light\r\n				qva-activate="toggleAscDesc()"\r\n				class="asc-desc"\r\n				title="{{sortTitle | translate}}"\r\n				data-icon="{{isAscending ? \'ascending\' : \'descending\'}}"></qui-button>\r\n\r\n	<qui-button light\r\n				disabled="disabled"\r\n				ng-if="sections.length <= 1"\r\n				class="sort-filter qui-dropdown"\r\n				title="{{ sortOptTitle | translate }}">\r\n		{{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\r\n	</qui-button>\r\n\r\n	<qui-select ng-if="sections.length > 1"\r\n				class="sort-filter light"\r\n				qui-model="$parent.selectedFltr"\r\n				qui-options="option.value as option.text | translate for option in sections"\r\n				title="{{sortOptTitle | translate}}"></qui-select>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-filter/qui-filter",["qlikui/qui","text!./qui-filter.ng.html"],function(qui,template){qui.component("quiFilter",{restrict:"E",replace:!0,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"},template:template})}),define("text!assets/qlikui/components/qui-select/qui-select.html",[],function(){return'<div class="qui-select">\r\n	<select class="select" %attrs%>\r\n		%options%\r\n	</select>\r\n	<div class="arrow"></div>\r\n	<div class="border"></div>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-select/qui-select",["qlikui/qui","text!./qui-select.html"],function(qui,template){qui.component("quiSelect",{transclude:!1,template:function($element,$attrs){var attrs='ng-model="'+$attrs.quiModel+'"';$attrs.quiDisabled&&(attrs+=' ng-disabled="'+$attrs.quiDisabled+'"'),$attrs.quiOptions&&(attrs+=' ng-options="'+$attrs.quiOptions+'"'),$attrs.quiChange&&(attrs+=' ng-change="'+$attrs.quiChange+'"'),$attrs.quiTid&&(attrs+=' tid="'+$attrs.quiTid+'"');var result=template.replace("%attrs%",attrs).replace("%options%",$element.html());return result},link:function($scope,$element){var select=$element.find(".select");select.on("mouseenter",function(){select.addClass("qui-hover")}),select.on("mouseleave",function(){select.removeClass("qui-hover")})},scope:!1})}),define("text!assets/qlikui/components/qui-button-outline-round/qui-button-outline-round.html",[],function(){return'<button class="qv-btn-outline-round" ng-class="{\'qv-btn-outline-round-no-text\': !qvaButtonText && !qvaButtonPreIconText, \'qv-btn-outline-round-with-text\':  qvaButtonText || qvaButtonPreIconText}">\r\n	<div class="qv-btn-outline-round-flex">\r\n		<div ng-if="qvaButtonPreIconText" ng-class="{\'qv-btn-outline-round-icon-right\': classIcon}" class="qv-btn-outline-round-text">{{qvaButtonPreIconText}}</div>\r\n		<i class="outline-icon {{ classIcon }}"></i>\r\n		<div ng-if="qvaButtonText" ng-class="{\'qv-btn-outline-round-icon-left\': classIcon}" class="qv-btn-outline-round-text" q-translation="{{qvaButtonText}}"></div>\r\n	</div>\r\n</button>'}),define("assets/qlikui/components/qui-button-outline-round/qui-button-outline-round",["qlikui/qui","text!./qui-button-outline-round.html"],function(qui,template){qui.component("quiButtonOutlineRound",{template:template,replace:!0,scope:{"class":"@",classIcon:"@",qvaButtonText:"@",qvaButtonPreIconText:"="},link:function($scope){$scope.$watch("classIcon",function(newIcon){$scope.classIcon=newIcon})}})}),define("text!assets/qlikui/components/qui-button-icon/qui-button-icon.html",[],function(){return'<button class="{{className}}" ng-class="classes" ng-transclude></button>'}),define("assets/qlikui/components/qui-button-icon/qui-button-icon",["qlikui/qui","text!./qui-button-icon.html"],function(qui,template){function setClassName(scope,toggleButton,active){var string="qui-btn-icn";scope.className=string+(toggleButton?"-tgl":""),active&&(scope.className+=" qui-active")}var ENTER=13;qui.component("quiButtonIcon",{template:template,scope:{icon:"@",active:"="},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function setClassNameWatcher(){setClassName($scope,$attrs.hasOwnProperty("toggle"),$scope.active)}function keyPress(e){e.keyCode===ENTER&&$element.trigger("qv-activate")}$scope.$watch("active",setClassNameWatcher),$element.on("keypress",keyPress)}]})}),define("qlikui/components",["assets/qlikui/components/qui-dialog-default/qui-dialog-default","assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/components/qui-input-number/qui-input-number","assets/qlikui/components/qui-modal-default/qui-modal-default","assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup","assets/qlikui/components/qui-checkbox/qui-checkbox","assets/qlikui/components/qui-radiobutton/qui-radiobutton","assets/qlikui/components/qui-float/qui-float","assets/qlikui/components/qui-button/qui-button","assets/qlikui/components/qui-list/qui-list","assets/qlikui/components/qui-toggle-switch/qui-toggle-switch","assets/qlikui/components/qui-search-field/qui-search-field","assets/qlikui/components/qui-filter/qui-filter","assets/qlikui/components/qui-select/qui-select","assets/qlikui/components/qui-button-outline-round/qui-button-outline-round","assets/qlikui/components/qui-button-icon/qui-button-icon"],function(){}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular","qlikui/components"],function($,Deferred,qvangular,modalTemplate){var defaultEscButton,angular=window.angular,modalDefault={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},isOpened=!1,isLocked=!1;qvangular.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function($scope){$scope.button&&$scope.button.defaultEscButton&&(defaultEscButton=$scope),$scope.closeModal=function(e,close){e&&(e.preventDefault(),e.stopPropagation()),$scope.button&&$scope.button.callback&&("undefined"==typeof $scope.button.expression||$scope.button.expression)&&$scope.button.callback(),(close||$scope.autoClose||$scope.button&&!$scope.button.callback)&&$scope.destroyModal()}}}}),qvangular.service("$delayedModal",["$compile","$rootScope","$document",function($compile,$rootScope,$document){var $scope,$previousScope,$container,$previousContainer,o={},template=modalTemplate,exports={open:function(options){var unWatchElement,dfr=new Deferred;$scope&&($previousScope=$scope,$previousContainer=$container),$scope=$rootScope.$new(),$container=angular.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),$scope.containerStyle={content:" "},$scope.classes={},$scope.modalStyle={};for(var k in modalDefault)$scope.modalStyle[k]=modalDefault[k];$scope.wasDisabled=[],$scope.showDefaultButton=!0,isOpened=!0,isLocked=!1,o=options,$scope.failed=!1,$scope.autoClose=!0;for(k in o)$scope[k]=o[k];return $container.html(template).appendTo($document.find("body")),$scope.html&&$container.find("main").append($scope.html),unWatchElement=$scope.$watch("element",function(){dfr.resolve(),unWatchElement()}),$scope.element=$compile($container)($scope),$scope.destroyModal=this.close.bind(this),$scope.handleEscButton=function(e){e&&(e.preventDefault(),e.stopPropagation()),$scope.buttons&&defaultEscButton?defaultEscButton&&defaultEscButton.closeModal():$scope.destroyModal()},$scope.$broadcast("delayed-modal-opened"),$scope.$watchCollection("[width, height]",function(){$scope.width&&($scope.modalStyle.width=$scope.width),$scope.height&&($scope.modalStyle.height=$scope.height)}),dfr.promise},update:function(options){if(isOpened){for(var i in options)$scope[i]=options[i],o[i]=options[i];(options.html||options.buttons)&&($container.html(template),$container.find("main").html(options.html),$document.find("body").find(".qui-delayedModal").replaceWith($container.html()),$scope.element=$compile($container)($scope))}},close:function(){$scope&&$container&&($container.remove(),$scope.$destroy(),$scope.$broadcast("delayed-modal-closed"),$scope=$previousScope||null,$container=$previousContainer||null,$previousScope=$previousContainer=null),isOpened=!1,isLocked=!1},lock:function(){isLocked=!0,$scope.wasDisabled.length=0,$scope.element.find("button, input, textarea, select").each(function(){var $elem=$(this);$elem.prop("disabled")?$scope.wasDisabled.push(this):$elem.prop("disabled",!0)})},unlock:function(){isLocked=!1,$scope.element.find("button, input, textarea, select").each(function(){-1===$scope.wasDisabled.indexOf(this)&&$(this).prop("disabled",!1)}),$scope.wasDisabled.length=0}};return Object.defineProperty(exports,"isOpened",{get:function(){return isOpened}}),Object.defineProperty(exports,"isLocked",{get:function(){return isLocked}}),Object.defineProperty(exports,"scope",{get:function(){return $scope}}),exports}])}),define("client.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.enums/qrs-enums","general.controllers/route-controller","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function($,qvangular,translator,engineEnums,qrsEnums,RouteController,externalUrl,expireTemplate){"use strict";function showDialog(error){if(!modalOpen){var delayedDialog=qvangular.getService("$delayedModal");if(modalOpen=!0,"OnSessionLoggedOut"===error)return options={title:"Hub.OnSessionLoggedOut.title",content:"Hub.OnSessionLoggedOut.message",buttons:[{name:"Hub.OnSessionLoggedOut.button",defaultButton:!0,callback:function(){location.href=RouteController.buildUrl(!0,"hub")}}],showDefaultButton:!1,classes:{"qs-e-dim":!0}},void translator.ready.then(function(){qvangular.getService("$delayedModal").open(options),qvangular.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){modalOpen=!1})});if(error.code===errors.LOCERR_JSON_RPC_INVALID_PARAMETERS)return void(modalOpen=!1);var buttons=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0,callback:function(){var secondButton=null;2===options.buttons.length&&(secondButton=options.buttons[1]),delayedDialog.scope.$root.$broadcast("errorHandlerClosed",options.content,secondButton)}}];error.buttons?buttons=error.buttons:error.method&&"OnEngineWebsocketFailed"===error.method||error.code===errors.LOCERR_APP_NOT_FOUND||error.code===errors.LOCERR_APP_CONNECT_FAILED?buttons=[{name:"Common.Refresh",callback:function(){qvangular.getService("$timeout")(function(){location.reload(!0)})}},{name:"ErrorDialog.GoToHub",defaultButton:!0,callback:function(){location.href=RouteController.buildUrl(!0,"hub")}}]:(error.code===errors.LOCERR_SERVER_LICENSE_EXPIRED||error.code===errors.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_SESSION_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_USAGE_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_NAMED_CALS||error.code===errors.LOCERR_GENERIC_CONNECTION_LOST)&&(buttons[0].defaultButton=!1,buttons.push({name:"Common.Refresh",defaultButton:!0,callback:function(){qvangular.getService("$timeout")(function(){location.reload(!0)});var secondButton=null;2===options.buttons.length&&(secondButton=options.buttons[1]),qvangular.$rootScope.$broadcast("errorHandlerRefresh",options.content,secondButton)}})),translator.ready.then(function(){if(options=$.extend(!0,{},error,{title:"ErrorDialog.Title",content:error.code?"ErrorCode."+error.code:error.message,buttons:buttons,showDefaultButton:!1,classes:{"qs-e-dim":!0}}),error.code===errors.LOCERR_PERSONAL_VERSION_EXPIRED){var upgradeMsg=translator.get("Info.QlikView.Personal.Upgrade",["<a href='"+externalUrl.personalUpgradeUrl+"' target='_blank'>"+externalUrl.personalUpgradeBase+"</a>"]),htmlTemplate=expireTemplate.replace("<upgrade-msg/>",upgradeMsg);options.html=htmlTemplate,options.title="ErrorCode.12001.Sense.Desktop.Expired"}delayedDialog.open(options),delayedDialog.scope.$on("delayed-modal-closed",function(){modalOpen=!1}),delayedDialog.scope.$root.$broadcast("errorHandlerOpen")}),document.activeElement&&$(document.activeElement).blur()}}var modalOpen=!1,errors=$.extend({},engineEnums.NxLocalizedErrorCode,qrsEnums.NxLocalizedErrorCode),options={};return{showDialog:showDialog,isOpen:function(){return modalOpen}}}),define("client.controllers/warning-handler-controller",["jquery","qvangular","autogenerated/qix/engine-enums","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function($,qvangular,enums,externalUrl,expireTemplate){"use strict";function listenToDialogCloseEvent(){qvangular.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){warningQueue.length&&qvangular.getService("$timeout")(function(){showDelayedModal(warningQueue.shift())})})}function findExpiryWarningIndex(warnings){for(var index=-1,i=0;i<warnings.length;i++)if("undefined"!=typeof warnings[i].code&&warnings[i].code===warningCodes.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){index=i;break}return index}function showDelayedModal(warning){var options={};translator.ready.then(function(){if(options=$.extend(!0,{},warning,{title:"WarningDialog.Title",content:"undefined"!=typeof warning.code?"WarningCode."+warning.code:warning.message,buttons:buttons,showDefaultButton:!1}),"undefined"!=typeof warning.code&&warning.code===warningCodes.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){var upgradeMsg=translator.get("Info.QlikView.Personal.Upgrade",["<a href='"+externalUrl.personalUpgradeUrl+"' target='_blank'>"+externalUrl.personalUpgradeBase+"</a>"]);options.html=expireTemplate.replace("<upgrade-msg/>",upgradeMsg)}qvangular.getService("$delayedModal").open(options),listenToDialogCloseEvent()}),document.activeElement&&$(document.activeElement).blur()}function showDialog(warnings,theTranslator){var warningsClone=$.extend(!0,[],warnings);if(translator||(translator=theTranslator),expireWarningAlreadyShown){var index=findExpiryWarningIndex(warningsClone);-1!==index&&warningsClone.splice(index,1)}else-1!==findExpiryWarningIndex(warningsClone)&&(expireWarningAlreadyShown=!0,sessionStorage.setItem("ExpireWarningShown",!0));warningsClone.length>0&&(warningQueue.push.apply(warningQueue,warningsClone),qvangular.getService("$delayedModal").isOpened?listenToDialogCloseEvent():showDelayedModal(warningQueue.shift()))}var translator,warningCodes=enums.NxLocalizedWarningCode,buttons=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0}],warningQueue=[],expireWarningAlreadyShown=sessionStorage.ExpireWarningShown;return{showDialog:showDialog}}),define("client.models/rpc-session",["assets/core/models/rpc-session","core.utils/websocket","core.utils/deferred","core.utils/authentication","core.utils/debug-flags","translator","client.controllers/error-handler-controller","client.controllers/warning-handler-controller","autogenerated/qix/engine-enums","qvangular"],function(RPCSession,WebSocket,Deferred,Authentication,DebugFlags,translator,ErrorDialog,WarningDialog,enums,qvangular){function onNotification(data){var proxyNotifications=["OnLicenseAccessDenied","OnSessionClosed","OnEngineWebsocketFailed","OnNoEngineAvailable","OnSessionTimedOut","OnSessionClosed","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"];"OnSessionLoggedOut"===data.method?ErrorDialog.showDialog(data.method):"OnEngineWebsocketFailed"===data.method?ErrorDialog.showDialog({method:data.method,message:translator.get("ProxyError."+data.method)}):proxyNotifications.indexOf(data.method)>-1?ErrorDialog.showDialog({message:translator.get("ProxyError."+data.method)}):"OnAuthenticationInformation"===data.method&&Authentication.parse(data.params)}function logTraffic(data){var direction="string"==typeof data?"SENT":"RECV";window.console.info("[DBGFLG:SOCKET]",direction,":",data)}function onWarning(data){var warnings=[];if("ExportData"!==this.reqCache[data.id].method){for(var i=0;i<data.warnings.length;i++)warnings.push({code:data.warnings[i]});WarningDialog.showDialog(warnings,translator)}}var debounceTimer,Errors=enums.NxLocalizedErrorCode,debouncedFns=[];return RPCSession.createSocket=function(url){var ws;try{ws=new WebSocket(url)}catch(err){ErrorDialog.showDialog({message:"ErrorDialog.NoConnectionCreated"})}return ws},RPCSession.hookIntoDeferred=function(dfd){dfd.promise.then(null,function(err){return qvangular.getService("$timeout")(function(){err||(err={isHandled:!1}),err.isHandled||err.error.isHandled||err.error.code===Errors.LOCERR_GENERIC_ABORTED||ErrorDialog.showDialog(err.error)},1e3),Deferred.reject(err)})},RPCSession.debounceApply=function(fn){clearTimeout(debounceTimer),debouncedFns.push(fn),debounceTimer=setTimeout(function(){qvangular.$apply(qvangular.$rootScope,function(){for(var i=0;i<debouncedFns.length;i++)try{debouncedFns[i]()}catch(e){}debouncedFns.length=0})})},RPCSession.NewSessionCreated.bind(function(session){session.Notification.bind(onNotification),session.Warning.bind(onWarning),DebugFlags.SOCKET&&(session.Data.bind(logTraffic),session.Error.bind(logTraffic),session.Send.bind(logTraffic))}),RPCSession}),define("autogenerated/qix/engine-api-def",[],function(){"use strict";var definition={Field:{GetCardinal:{In:[],Out:[]},GetAndMode:{In:[],Out:[]},SelectValues:{In:[{Name:"qFieldValues",DefaultValue:[{qText:"",qIsNumeric:!1,qNumber:0}]},{Name:"qToggleMode",DefaultValue:!1,Optional:!0},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Select:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ToggleSelect:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ClearAllButThis:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectPossible:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectExcluded:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectAll:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Lock:{In:[],Out:[]},Unlock:{In:[],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qOneAndOnlyOne:!1}}],Out:[]},SetAndMode:{In:[{Name:"qAndMode",DefaultValue:!1}],Out:[]},SelectAlternative:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},LowLevelSelect:{In:[{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Clear:{In:[],Out:[]}},Variable:{GetContent:{In:[],Out:[{Name:"qContent"}]},GetRawContent:{In:[],Out:[]},SetContent:{In:[{Name:"qContent",DefaultValue:""},{Name:"qUpdateMRU",DefaultValue:!1}],Out:[]},ForceContent:{In:[{Name:"qs",DefaultValue:""},{Name:"qd",DefaultValue:0}],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qName:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qUsePredefListedValues:!1,qPreDefinedList:[""]}}],Out:[]}},GenericObject:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},GetListObjectData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeReducedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qZoomFactor",DefaultValue:0},{Name:"qReductionMode",DefaultValue:0}],Out:[{Name:"qDataPages"}]},GetHyperCubePivotData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeStackData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0,Optional:!0}],Out:[{Name:"qDataPages"}]},GetHyperCubeBinnedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qViewport",DefaultValue:{qWidth:0,qHeight:0,qZoomLevel:0}},{Name:"qDataRanges",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0},{Name:"qQueryLevel",DefaultValue:0},{Name:"qBinningMethod",DefaultValue:0}],Out:[{Name:"qDataPages"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]},{Name:"qSoftPatch",DefaultValue:!1,Optional:!0}],Out:[]},ClearSoftPatches:{In:[],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetEffectiveProperties:{In:[],Out:[{Name:"qProp"}]},SetFullPropertyTree:{In:[{Name:"qPropEntry",DefaultValue:{qProperty:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}},qChildren:[],qEmbeddedSnapshotRef:null}}],Out:[]},GetFullPropertyTree:{In:[],Out:[{Name:"qPropEntry"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},ClearSelections:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},ExportData:{In:[{Name:"qFileType",DefaultValue:0},{Name:"qPath",DefaultValue:"",Optional:!0},{Name:"qFileName",DefaultValue:"",Optional:!0},{Name:"qExportState",DefaultValue:0,Optional:!0}],Out:[{Name:"qUrl"}]},SelectListObjectValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectPossible:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectExcluded:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAlternative:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAll:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SearchListObjectFor:{In:[{Name:"qPath",DefaultValue:""},{Name:"qMatch",DefaultValue:""}],Out:[{Name:"qSuccess"}]},AbortListObjectSearch:{In:[{Name:"qPath",DefaultValue:""}],Out:[]},AcceptListObjectSearch:{In:[{Name:"qPath",DefaultValue:""},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},ExpandLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},ExpandTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},DrillUp:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qNbrSteps",DefaultValue:0}],Out:[]},Lock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},Unlock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},SelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1}],Out:[{Name:"qSuccess"}]},SelectHyperCubeCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRowIndices",DefaultValue:[0]},{Name:"qColIndices",DefaultValue:[0]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectPivotCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSelections",DefaultValue:[{qType:0,qCol:0,qRow:0}]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},RangeSelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRanges",DefaultValue:[{qRange:{qMin:0,qMax:0,qMinInclEq:!1,qMaxInclEq:!1},qMeasureIx:0}]},{Name:"qColumnsToSelect",DefaultValue:[0],Optional:!0},{Name:"qOrMode",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},GetChild:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetChildInfos:{In:[],Out:[{Name:"qInfos"}]},CreateChild:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qInfo"}]},DestroyChild:{In:[{Name:"qId",DefaultValue:""},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qSuccess"}]},DestroyAllChildren:{In:[{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[]},SetChildArrayOrder:{In:[{Name:"qIds",DefaultValue:[""]}],Out:[]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},CopyFrom:{In:[{Name:"qFromId",DefaultValue:""}],Out:[]},BeginSelections:{In:[{Name:"qPaths",DefaultValue:[""]}],Out:[]},EndSelections:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},ResetMadeSelections:{In:[],Out:[]},EmbedSnapshotObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetSnapshotObject:{In:[],Out:[]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDimension:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDimension:{In:[],Out:[{Name:"qDim"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericBookmark:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},Apply:{In:[],Out:[{Name:"qSuccess"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericVariable:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},SetStringValue:{In:[{Name:"qVal",DefaultValue:""}],Out:[]},SetNumValue:{In:[{Name:"qVal",DefaultValue:0}],Out:[]},SetDualValue:{In:[{Name:"qText",DefaultValue:""},{Name:"qNum",
DefaultValue:0}],Out:[]}},GenericMeasure:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetMeasure:{In:[],Out:[{Name:"qMeasure"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDerivedDefinition:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},MatchTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedDefinitionData:{In:[],Out:[{Name:"qData"}]},GetExpression:{In:[{Name:"qExpressionName",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]}],Out:[]}},GenericDerivedFields:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedFieldData:{In:[],Out:[{Name:"qData"}]},GetDerivedField:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qFields"}]},GetListData:{In:[],Out:[{Name:"qListData"}]},GetDerivedFields:{In:[],Out:[{Name:"qFields"}]},GetDerivedGroups:{In:[],Out:[{Name:"qGroups"}]}},InternalTest:{Initialised:{In:[],Out:[]},TestMemoryManagement:{In:[],Out:[]},TestNextFileFormat:{In:[],Out:[]},BombQRS:{In:[],Out:[]},BombQRSParallel:{In:[{Name:"qNThreads",DefaultValue:0}],Out:[]},TestLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qSteps",DefaultValue:0,Optional:!0}],Out:[]},TestRepositoryLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qMessage",DefaultValue:""}],Out:[]},GetQixCounters:{In:[],Out:[{Name:"qCounters"}]},ResetQixCounters:{In:[],Out:[]}},Doc:{GetProperties:{In:[],Out:[]},GetField:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},GetFieldDescription:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[]},GetVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLooselyCoupledVector:{In:[],Out:[{Name:"qv"}]},SetLooselyCoupledVector:{In:[{Name:"qv",DefaultValue:[0]}],Out:[]},Evaluate:{In:[{Name:"qExpression",DefaultValue:""}],Out:[]},EvaluateEx:{In:[{Name:"qExpression",DefaultValue:""}],Out:[{Name:"qValue"}]},ClearAll:{In:[{Name:"qLockedAlso",DefaultValue:!1,Optional:!0},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},LockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},UnlockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},Back:{In:[],Out:[]},Forward:{In:[],Out:[]},ReduceData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0},{Name:"qDropFieldNames",DefaultValue:[""],Optional:!0}],Out:[]},RemoveAllData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0}],Out:[]},CreateVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},RemoveVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLocaleInfo:{In:[],Out:[]},GetTablesAndKeys:{In:[{Name:"qWindowSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qNullSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qCellHeight",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qIncludeSysVars",DefaultValue:!1}],Out:[{Name:"qtr"},{Name:"qk"}]},GetViewDlgSaveInfo:{In:[],Out:[]},SetViewDlgSaveInfo:{In:[{Name:"qInfo",DefaultValue:{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCtlInfo:{qInternalView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0},qSourceView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0}},qMode:0}}],Out:[]},GetEmptyScript:{In:[{Name:"qLocalizedMainSection",DefaultValue:"",Optional:!0}],Out:[]},DoReload:{In:[{Name:"qMode",DefaultValue:0,Optional:!0},{Name:"qPartial",DefaultValue:!1,Optional:!0},{Name:"qDebug",DefaultValue:!1,Optional:!0}],Out:[]},GetScriptBreakpoints:{In:[],Out:[{Name:"qBreakpoints"}]},SetScriptBreakpoints:{In:[{Name:"qBreakpoints",DefaultValue:[{qbufferName:"",qlineIx:0,qEnabled:!1}]}],Out:[]},GetScript:{In:[],Out:[{Name:"qScript"}]},GetTextMacros:{In:[],Out:[{Name:"qMacros"}]},SetFetchLimit:{In:[{Name:"qLimit",DefaultValue:0}],Out:[]},DoSave:{In:[{Name:"qFileName",DefaultValue:"",Optional:!0}],Out:[]},GetTableData:{In:[{Name:"qOffset",DefaultValue:0},{Name:"qRows",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qTableName",DefaultValue:""}],Out:[{Name:"qData"}]},GetAppLayout:{In:[],Out:[{Name:"qLayout"}]},SetAppProperties:{In:[{Name:"qProp",DefaultValue:{qTitle:"",qLastReloadTime:"",qMigrationHash:"",qSavedInProductVersion:"",qThumbnail:{qUrl:""}}}],Out:[]},GetAppProperties:{In:[],Out:[{Name:"qProp"}]},CreateSessionObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},DestroySessionObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CreateObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qDraftId"}]},CommitDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[]},DestroyDraft:{In:[{Name:"qId",DefaultValue:""},{Name:"qSourceId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},Undo:{In:[],Out:[{Name:"qSuccess"}]},Redo:{In:[],Out:[{Name:"qSuccess"}]},ClearUndoBuffer:{In:[],Out:[]},CreateDimension:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateMeasure:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateSessionVariable:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[]},DestroySessionVariable:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CreateVariableEx:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[{Name:"qInfo"}]},DestroyVariableById:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},DestroyVariableByName:{In:[{Name:"qName",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetVariableById:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetVariableByName:{In:[{Name:"qName",DefaultValue:""}],Out:[]},MigrateVariables:{In:[],Out:[]},CreateDerivedDefinition:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetDerivedDefinitionByName:{In:[{Name:"qName",DefaultValue:""}],Out:[]},CloneDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},GetDerivedDefinitionsForTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qInstanceName"}]},AssignDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qDerivedDefinitionNames",DefaultValue:[""]}],Out:[]},CreateDerivedFields:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetAllDerivedFields_INTERNAL:{In:[],Out:[{Name:"qDerivedFields"}]},GetDerivedFieldDimensionDef:{In:[{Name:"qLibraryId",DefaultValue:""}],Out:[{Name:"qDimensionDef"}]},GetDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qGetDerivedDefinitionsForTags",DefaultValue:""}],Out:[]},GetAllDerivedFieldsFor:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[{Name:"qDerivedFields"}]},MigrateDerivedFields:{In:[],Out:[]},CheckExpression:{In:[{Name:"qExpr",DefaultValue:""},{Name:"qLabels",DefaultValue:[""],Optional:!0}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"},{Name:"qDangerousFieldNames"}]},CheckNumberOrExpression:{In:[{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"}]},AddAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},RemoveAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},CreateBookmark:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[]},ApplyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CloneBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},AddFieldFromExpression:{In:[{Name:"qName",DefaultValue:""},{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetAllInfos:{In:[],Out:[{Name:"qInfos"}]},Resume:{In:[],Out:[]},AbortModal:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},Publish:{In:[{Name:"qStreamId",DefaultValue:""},{Name:"qName",DefaultValue:"",Optional:!0}],Out:[]},UnPublish:{In:[],Out:[]},GetMatchingFields:{In:[{Name:"qTags",DefaultValue:[""]},{Name:"qMatchingFieldMode",DefaultValue:0,Optional:!0}],Out:[{Name:"qFieldNames"}]},FindMatchingFields:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qFieldNames"}]},SearchSuggest:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]}],Out:[{Name:"qResult"}]},SearchAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qPage",DefaultValue:{qOffset:0,qCount:0,qMaxNbrFieldMatches:0}}],Out:[{Name:"qResults"}]},SelectAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qMatchIx",DefaultValue:0},{Name:"qSoftLock",DefaultValue:null,Optional:!0}],Out:[]},SaveObjects:{In:[],Out:[]},GetAssociationScores:{In:[{Name:"qTable1",DefaultValue:""},{Name:"qTable2",DefaultValue:""}],Out:[{Name:"qScore"}]},GetMediaList:{In:[],Out:[{Name:"qList"}]},GetContentLibraries:{In:[],Out:[{Name:"qList"}]},GetLibraryContent:{In:[{Name:"qName",DefaultValue:""}],Out:[{Name:"qList"}]},DoReloadEx:{In:[{Name:"qParams",DefaultValue:{qMode:0,qPartial:!1,qDebug:!1},Optional:!0}],Out:[{Name:"qResult"}]},BackCount:{In:[],Out:[]},ForwardCount:{In:[],Out:[]},SetScript:{In:[{Name:"qScript",DefaultValue:""}],Out:[]},CheckScriptSyntax:{In:[],Out:[{Name:"qErrors"}]},GetFavoriteVariables:{In:[],Out:[{Name:"qNames"}]},SetFavoriteVariables:{In:[{Name:"qNames",DefaultValue:[""]}],Out:[]},GetIncludeFileContent:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qContent"}]},CreateConnection:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qConnectionId"}]},ModifyConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},{Name:"qOverrideCredentials",DefaultValue:!1,Optional:!0}],Out:[]},DeleteConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[]},GetConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qConnection"}]},GetConnections:{In:[],Out:[{Name:"qConnections"}]},GetDatabaseInfo:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qInfo"}]},GetDatabases:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qDatabases"}]},GetDatabaseOwners:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0}],Out:[{Name:"qOwners"}]},GetDatabaseTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0}],Out:[{Name:"qTables"}]},GetDatabaseTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"}]},GetDatabaseTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"}]},GetFolderItemsForConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qFolderItems"}]},GuessFileType:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qDataFormat"}]},GetFileTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},GetFileTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"},{Name:"qFormatSpec"}]},GetFileTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"},{Name:"qFormatSpec"}]},GetFileTablesEx:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},SendGenericCommandToCustomConnector:{In:[{Name:"qProvider",DefaultValue:""},{Name:"qCommand",DefaultValue:""},{Name:"qMethod",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]},{Name:"qAppendConnection",DefaultValue:""}],Out:[{Name:"qResult"}]}},Global:{AbortRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},AbortAll:{In:[],Out:[]},GetProgress:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qProgressData"}]},QvVersion:{In:[],Out:[]},OSVersion:{In:[],Out:[]},OSName:{In:[],Out:[]},QTProduct:{In:[],Out:[]},GetDocList:{In:[],Out:[{Name:"qDocList"}]},GetInteract:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qDef"}]},InteractDone:{In:[{Name:"qRequestId",DefaultValue:0},{Name:"qDef",DefaultValue:{qType:0,qTitle:"",qMsg:"",qButtons:0,qLine:"",qOldLineNr:0,qNewLineNr:0,qPath:"",qHidden:!1,qResult:0,qInput:""}}],Out:[]},GetAuthenticatedUser:{In:[],Out:[]},GetStreamList:{In:[],Out:[{Name:"qStreamList"}]},CreateDocEx:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qDocId"}]},GetActiveDoc:{In:[],Out:[]},AllowCreateApp:{In:[],Out:[]},CreateApp:{In:[{Name:"qAppName",DefaultValue:""},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"},{Name:"qAppId"}]},DeleteApp:{In:[{Name:"qAppId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},IsDesktopMode:{In:[],Out:[]},GetConfiguration:{In:[],Out:[{Name:"qConfig"}]},CancelRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},GetInternalTest:{In:[{Name:"qKey",DefaultValue:""}],Out:[]},ShutdownProcess:{In:[],Out:[]},ReloadExtensionList:{In:[],Out:[]},ReplaceAppFromID:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppID",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},CopyApp:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportAppEx:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]},{Name:"qExcludeConnections",DefaultValue:!1}],Out:[]},ExportApp:{In:[{Name:"qTargetPath",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},PublishApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qStreamId",DefaultValue:""},{Name:"qCopy",DefaultValue:!1},{Name:"qReplaceId",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"}]},IsPersonalMode:{In:[],Out:[]},GetUniqueID:{In:[],Out:[{Name:"qUniqueID"}]},OpenDoc:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qNoData",DefaultValue:!1,Optional:!0}],Out:[]},CreateSessionApp:{In:[],Out:[{Name:"qSessionAppId"}]},CreateSessionAppFromApp:{In:[{Name:"qSrcAppId",DefaultValue:""}],Out:[{Name:"qSessionAppId"}]},ProductVersion:{In:[],Out:[]},GetAppEntry:{In:[{Name:"qAppID",DefaultValue:""}],Out:[{Name:"qEntry"}]},ConfigureReload:{In:[{Name:"qCancelOnScriptError",DefaultValue:!1},{Name:"qUseErrorData",DefaultValue:!1},{Name:"qInteractOnError",DefaultValue:!1}],Out:[]},CancelReload:{In:[],Out:[]},GetBNF:{In:[{Name:"qBnfType",DefaultValue:0}],Out:[{Name:"qBnfDefs"}]},GetFunctions:{In:[{Name:"qGroup",DefaultValue:0,Optional:!0}],Out:[{Name:"qFunctions"}]},GetOdbcDsns:{In:[],Out:[{Name:"qOdbcDsns"}]},GetOleDbProviders:{In:[],Out:[{Name:"qOleDbProviders"}]},GetDatabasesFromConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qDatabases"}]},IsValidConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[]},GetDefaultAppFolder:{In:[],Out:[{Name:"qPath"}]},GetMyDocumentsFolder:{In:[],Out:[{Name:"qFolder"}]},GetLogicalDriveStrings:{In:[],Out:[{Name:"qDrives"}]},GetFolderItemsForPath:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qFolderItems"}]},GetSupportedCodePages:{In:[],Out:[{Name:"qCodePages"}]},GetCustomConnectors:{In:[{Name:"qReloadList",DefaultValue:!1,Optional:!0}],Out:[{Name:"qConnectors"}]}}};return definition}),define("core.models/engine",["client.models/rpc-session","autogenerated/qix/engine-api-def","core.utils/deferred"],function(RPCSession,engineApiDef,Deferred){"use strict";function addOpenDoc(name,doc){engineModule.openApps[name]=doc}function SessionWrapper(session){this._session=session}function createSession(self,appId,rpcOptions){var rpcSession=RPCSession.get(appId,rpcOptions);return rpcSession.Close.bind(function(){delete self._session,delete engineModule.openApps[appId]}),rpcSession.open(),new SessionWrapper(rpcSession)}function javascriptifyName(name){return name.substring(0,1).toLowerCase()+name.substring(1)}function createType(typeName,typeDef){var EngineProxy=function(result,session){this._cache={},this._handle=!!result&&!!result.qReturn&&result.qReturn.qHandle,this._session=session,this.__engineTypeName=typeName};for(var methodName in typeDef){var methodDef=typeDef[methodName];EngineProxy.prototype[javascriptifyName(methodName)]=createMethod(methodName,methodDef)}return function(result,session){return new EngineProxy(result,session)}}function obtainSession(self,methodName,appId){var sessionToUse;return self._session?sessionToUse="OpenDoc"!==methodName&&"OpenApp"!==methodName||!self._session.isAssignToApp()&&appId===self._session.getAppName()?self._session:createSession(self,appId,self._rpcOptions):(self._session=createSession(self,appId,self._rpcOptions),sessionToUse=self._session),sessionToUse}function singleObjectMatchesMethodArgs(object,signatureParameters){var sentParametersNames=Object.keys(object),methodParametersNames=signatureParameters.In.map(function(param){return param.Name});return 0!==sentParametersNames.filter(function(v,i){return v===methodParametersNames[i]}).length}function createMethod(methodName,methodDef){var methodFunction=function(){var self=this,params=Array.prototype.slice.apply(arguments);1===params.length&&"object"==typeof params[0]&&singleObjectMatchesMethodArgs(params[0],methodDef)&&(params=params[0]);var sessionToUse;"OpenDoc"===methodName||"OpenApp"===methodName?(sessionToUse=obtainSession(self,methodName,params[0]),delete self._rpcOptions):!self._session&&"Global"===self.__engineTypeName&&Object.keys(engineModule.openApps).length?(self._session=Object.keys(engineModule.openApps).map(function(key){return engineModule.openApps[key]._session})[0],sessionToUse=self._session):sessionToUse=obtainSession(self,methodName);var dataToSend={method:methodName,params:params,handle:this._handle||-1},promise=sessionToUse.rpc(dataToSend).then(function(result){var wrappedResult;if(result){if(result.qReturn&&result.qReturn.qHandle&&result.qReturn.qType){var createEngineProxy=engineObjectTypes[result.qReturn.qType];wrappedResult=createEngineProxy(result,sessionToUse)}else if(result.hasOwnProperty("qResult"))wrappedResult=result.qResult,self["current"+methodName]=result.qResult;else if(result.hasOwnProperty("qReturn")&&1===Object.keys(result).length)wrappedResult=result.qReturn,self["current"+methodName]=result.qReturn;else{for(var resultName in result)result.hasOwnProperty(resultName)&&(self[resultName]=result[resultName]);wrappedResult=result}return("OpenDoc"===methodName||"OpenApp"===methodName)&&(sessionToUse._session.connectedAppHandle=result.qReturn.qHandle,wrappedResult.name=params[0],wrappedResult.selectAsCurrentApp=function(){engineModule.currentApp=wrappedResult},addOpenDoc(params[0],wrappedResult)),wrappedResult&&"object"==typeof wrappedResult&&(wrappedResult.__protocolRequestId=dataToSend.id),wrappedResult}return void 0},function(error){return Deferred.reject(error.error)});return promise.__protocolRequestId=dataToSend.id,promise};return methodFunction}function createApi(){var _engineObjectTypes={};for(var rootTypeName in engineApiDef){var rootTypeDef=engineApiDef[rootTypeName];_engineObjectTypes[rootTypeName]=createType(rootTypeName,rootTypeDef)}return _engineObjectTypes}var engineObjectTypes={},engineModule={global:void 0,openApps:{},currentApp:void 0};return SessionWrapper.prototype.rpc=function(obj){return this._session.rpc(obj).then(function(payload){return payload.result})},SessionWrapper.prototype.getAppName=function(){return this._session.options.appName},SessionWrapper.prototype.isAssignToApp=function(){return!!this.appName},engineObjectTypes=createApi(),engineModule.global=engineObjectTypes.Global(),engineModule.types=engineObjectTypes,engineModule.getCurrentApp=function(){return engineModule.currentApp},engineModule.openApp=function(appId,rpcOptions){var global=engineModule.global,noData=rpcOptions&&rpcOptions.openWithoutData?rpcOptions.openWithoutData:!1;return global._rpcOptions=rpcOptions,global._session&&(global._session=new SessionWrapper(RPCSession.get(appId,rpcOptions))),global.openDoc(appId,"","","",noData)},"undefined"!=typeof window&&(window.engineModuleGlobal=engineModule),engineModule}),define("core.models/app",["core.models/rpc-base","client.models/rpc-session","core.models/engine","core.utils/deferred","util","qvangular","client.controllers/error-handler-controller","autogenerated/qix/engine-enums"],function(RPCBase,RPCSession,Engine,Deferred,Util,qvangular,ErrorHandler,enums){"use strict";function connectionLostError(){qvangular.getService("$timeout")(function(){ErrorHandler.showDialog({code:enums.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}var App,_current,_cache={};return App=RPCBase.extend("App",{init:function(appName,rpcOptions,keepCurrent){var that=this;keepCurrent&&_current||(_current=that);var session=RPCSession.get(appName,rpcOptions);if(session.Close.bind(connectionLostError),session.modelCache[appName]=Deferred.resolve(that),that.waitForOpen=new Deferred,that.rpcOptions=rpcOptions,that._super({id:appName,session:session,checkCreate:!0}),that.session.connectedAppHandle)that.handle=that.session.connectedAppHandle,that.bindToRPC(),that.waitForOpen.resolve(that);else try{that.session.open(),that.open().then(function(){that.waitForOpen.resolve(that)},function(e){that.waitForOpen.reject({error:e})})}catch(error){that.waitForOpen.reject({isHandled:!1,error:error})}that.session.currentApp=that},open:function(){function getDataFromEngineApp(engineApp){engineApp.selectAsCurrentApp(),that.session.connectedAppHandle=that.handle=engineApp._handle,that.engineApp=engineApp,that.bindToRPC()}var that=this;return that.rpcOptions||(that.rpcOptions={}),that.session.Error.bind(function(err){window.console.log("Error from Engine:",err)}),that.rpcOptions||(that.rpcOptions={}),"true"===Util.getParameterByName("noData")&&(that.rpcOptions.openWithoutData=!0),Engine.openApp(that.id,that.rpcOptions).then(getDataFromEngineApp)},close:function(fromEngine){return fromEngine?ErrorHandler.showDialog({message:"ErrorDialog.AppClosed"}):this.session.Close.unbind(connectionLostError),this.session.close(),this._super()},createSessionObject:function(data){return this.rpc("CreateSessionObject","qReturn",[data])},createSessionVariable:function(data){return this.rpc("CreateSessionVariable","qReturn",[data])},doSave:function(){return this.rpc("DoSave",null)},getLayout:function(){return this._super("GetAppLayout")},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(props){return this._super(props,"SetAppProperties")},checkExpression:function(expr,labels){var params=[expr];return labels&&params.push(labels),this.rpc("CheckExpression",null,params)},checkNumberOrExpression:function(expr){return this.rpc("CheckNumberOrExpression",null,[expr])},evaluateExpression:function(expr){return this.rpc("Evaluate","qReturn",[expr])},getConfiguration:function(){return this.session.rpc({method:"GetConfiguration",handle:-1,params:[]}).then(function(data){return data.result.qConfig})},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(data){return data.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(data){return data.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var that=this;return that.streamsList?Deferred.resolve(that.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(res){return that.streamsList=res.result.qStreamList,that.streamsList})},getPublishableStreams:function(){var layout=this.getLayout(),streams=this.getStreams(),dfd=new Deferred;return Deferred.all({layout:layout,streams:streams}).then(function(res){var streams=res.streams.filter(function(stream){return res.layout.stream?stream.qId===res.layout.stream.id&&-1!==stream.privileges.indexOf("publish"):-1!==stream.privileges.indexOf("publish")});dfd.resolve(streams)}),dfd.promise},getMatchingFields:function(tags){return this.rpc("GetMatchingFields",null,[tags])},getContentLibraries:function(){return this.rpc("GetContentLibraries").then(function(list){return list.qList.qItems})},getLibraryContent:function(libraryId){return this.rpc("GetLibraryContent",null,[libraryId]).then(function(list){return list.qList.qItems})},getMediaList:function(){return this.rpc("GetMediaList").then(function(list){return list.qList.qItems})},findMatchingFields:function(fieldName,tags){return this.rpc("FindMatchingFields",null,[fieldName,tags])},abortModal:function(accept){return accept=void 0!==accept?accept:!0,this.setModal(null),this.rpc("AbortModal",null,[accept])},switchModal:function(object,path,accept){var pathArray,that=this;return object=object||null,path=path||"",pathArray=Array.isArray(path)?path:[path],accept=void 0!==accept?accept:!0,that.modalObject&&!that.modalObject.isClosed&&that.modalObject.rpc("EndSelections",null,[accept]),object&&!object.isClosed?(that.modalObject=object,object.rpc("BeginSelections",null,[pathArray])):(that.setModal(null),Deferred.resolve())},setModal:function(obj){this.modalObject=obj},isModal:function(){return null!=this.modalObject},publish:function(streamId){return this.rpc("Publish",null,[streamId])}}),Object.defineProperty(App,"current",{get:function(){return _current}}),App.makeCacheId=function(appName,opts){var id=appName.toLowerCase();return opts&&(id+=opts.host?"/"+opts.host:"/",id+=opts.identity?"/"+opts.identity:"/",id+=opts.openWithoutData?"/openWithoutData":"/"),id},App.get=function(appName,opts,keepCurrent){var app=App.getSync(appName,opts,keepCurrent);return app.waitForOpen.promise},App.getSync=function(appName,opts,keepCurrent){appName=appName||Util.getParameterByName("app")||"?transient=","undefined"==typeof opts&&(opts={}),"string"!=typeof opts.host&&(opts.host=Util.hostname),"string"!=typeof opts.port&&(opts.port=Util.port),"string"!=typeof opts.prefix&&(opts.prefix=Util.basePath),"boolean"!=typeof opts.isSecure&&(opts.isSecure=Util.isSecure),"string"!=typeof opts.reloadURI&&(opts.reloadURI=Util.reloadURI);var cacheId=App.makeCacheId(appName,opts),app=_cache[cacheId]=_cache[cacheId]||new App(appName,opts,keepCurrent);return app},App.create=function(appId,session){return session.rpc({method:"CreateApp",handle:-1,params:[appId]}).then(function(data){return data.result})},App.remove=function(appId,session){return session.rpc({method:"DeleteApp",handle:-1,params:[appId]}).then(function(data){return data.result})},App.getList=function(session){return session.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(data){return data.result.qDocList})},App}),define("core.models/base-object",["core.models/rpc-base","core.models/app","core.utils/deferred","core.utils/permissions","util"],function(RPCBase,App,Deferred,Permissions,util){"use strict";function createListModel(ctor,props){var listDfd,List,name=ctor.name+"List",listDef=Object.keys(props).filter(function(key){return key.indexOf("ListDef")>-1?key:void 0})[0].replace(/Def$/g,"");if(!listDef)throw new Error("BaseObject: Tried to create a model without a ListDef in properties");
List=RPCBase.extend(name,{strippedLayout:{},getLayout:function(){var that=this;return this._super().then(function(layout){return that.strippedLayout=layout[listDef].qItems,that.strippedLayout.forEach(function(item){"object"==typeof item&&Permissions.mapToLayout(item)}),that.strippedLayout})}}),props.qInfo={qId:name,qType:name},ctor.getList=function(app){return app=app||App.current,listDfd?listDfd:listDfd=app.createSessionObject(props).then(function(result){return new List({id:name,handle:result.qHandle,session:app.session})})},ctor.getListLayout=function(app){return this.getList(app).then(function(model){return model.getLayout()})}}var BaseObject;return BaseObject=RPCBase.extend("BaseObject",{getInfo:function(){return this.rpc("GetInfo","qInfo")},clone:function(method,app){var that=this;return app=app||App.current,app.rpc(method||"CloneObject","qCloneId",[that.id]).then(function(id){return that.constructor.get(id)})}}),BaseObject.get=function(id,app){function getHandle(){return app.rpc("GetObject","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},BaseObject.create=function(props,method,parent){var Model=this;return props.qInfo=props.qInfo||{},props.qInfo.qId=props.qInfo.qId||util.generateId(),props.qInfo.qType=props.qInfo.qType||this.name.toLowerCase(),method=method||"CreateObject",parent=parent||App.current,parent.rpc(method,null,[props]).then(function(result){return Model.getModel(result.qInfo&&result.qInfo.qId||props.qInfo.qId,parent.session,function(){return Deferred.resolve(result.qReturn)})})},BaseObject.remove=function(id,method,parent,propForThis){var params=[id];return propForThis&&params.push(propForThis),parent=parent||App.current,method=method||"DestroyObject",parent.rpc(method,"qReturn",params)},BaseObject.States=RPCBase.States,BaseObject.extend=function(name,proto,opts){var ctor=RPCBase.extend.call(this,name,proto);return ctor.extend=BaseObject.extend,ctor.get=BaseObject.get,ctor.create=BaseObject.create,ctor.remove=BaseObject.remove,ctor.States=BaseObject.States,opts&&opts.listProperties&&createListModel(ctor,opts.listProperties),ctor},BaseObject}),define("general.models/field",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Field;return Field=BaseObject.extend("Field",{clear:function(){return this.rpc("Clear","qReturn")},lock:function(){return this.rpc("Lock","qReturn")},unlock:function(){return this.rpc("Unlock","qReturn")},clearOther:function(softlock){return this.rpc("ClearAllButThis","qReturn",[softlock||!1])},selectPossible:function(softlock){return this.rpc("SelectPossible","qReturn",[softlock||!1])},selectExcluded:function(softlock){return this.rpc("SelectExcluded","qReturn",[softlock||!1])},selectAll:function(softlock){return this.rpc("SelectAll","qReturn",[softlock||!1])},selectAlternative:function(softLock){return this.rpc("SelectAlternative",null,[softLock||!1])},selectMatch:function(match,softlock){return this.rpc("Select","qReturn",[match||"",softlock||!1])},toggleSelect:function(match,softlock){return this.rpc("ToggleSelect","qReturn",[match||"",softlock||!1])},select:function(values,toggle,softlock){return this.rpc("LowLevelSelect","qReturn",[values,toggle||!1,softlock||!1])},selectValues:function(values,toggle,softlock){return this.rpc("SelectValues","qReturn",[values,toggle||!1,softlock||!1])}},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}}}),Field.get=function(fieldName,stateName,app){function getHandle(){return app.rpc("GetField","qReturn",[fieldName,stateName])}stateName=stateName||"$";var id="FIELD_"+fieldName+"_"+stateName;return app=app||App.current,this.getModel(id,app.session,getHandle)},Field}),define("general.models/library/dimension",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Dimension;return Dimension=BaseObject.extend("Dimension",{clone:function(){return this._super("CloneDimension")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}}),Dimension.get=function(id,app){function getHandle(){return app.rpc("GetDimension","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Dimension.create=function(props,app){return BaseObject.create.call(Dimension,props,"CreateDimension",app)},Dimension.remove=function(id,app){return BaseObject.remove(id,"DestroyDimension",app)},Dimension}),define("general.models/library/measure",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Measure;return Measure=BaseObject.extend("Measure",{clone:function(){return this._super("CloneMeasure")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qMeasureListDef:{qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}}}),Measure.get=function(id,app){function getHandle(){return app.rpc("GetMeasure","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Measure.create=function(props,app){return BaseObject.create.call(Measure,props,"CreateMeasure",app)},Measure.remove=function(id,app){return BaseObject.remove(id,"DestroyMeasure",app)},Measure}),define("objects.utils/data-properties/listobject-util",["util"],function(util){"use strict";return{autoSortDimension:function(dimension,fields){return dimension.qDef.qSortCriterias=[],dimension.qDef.autoSort=!0,fields?fields.forEach(function(field,index){dimension.qDef.qSortCriterias[index]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):dimension.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},dimension},createFieldDimension:function(field){return{qDef:{qFieldDefs:[field],qFieldLabels:[field],qSortCriterias:[]}}},createLibraryDimension:function(id){return{qLibraryId:id,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(dimensionDef,title){var i,listboxDef=util.extend(!0,{},dimensionDef);for(listboxDef.qShowAlternatives=!0,i=0;i<listboxDef.qDef.qSortCriterias.length;++i)listboxDef.qDef.qSortCriterias[i].qSortByState=1;return title=title||(dimensionDef.qDef.qFieldLabels&&dimensionDef.qDef.qFieldLabels.length?dimensionDef.qDef.qFieldLabels[0]:""),{qInfo:{qType:"listbox"},qListObjectDef:listboxDef,title:title,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){"use strict";function isMeasure(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_measure")}function isDetails(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_details")}function isDimension(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_dimension")}function isDirectDiscoveryField(field){return!!field.qTags&&-1!==field.qTags.indexOf("$directdiscovery")}function removeMeasureAndDetailsFields(fields){var filteredFields=fields;return fields&&(filteredFields=fields.filter(function(field){return!isMeasure(field)&&!isDetails(field)})),filteredFields}function getTypeTranslationKey(tags){var translationKey="",field={qTags:tags};return isMeasure(field)?translationKey="DirectDiscovery.Measure":isDetails(field)?translationKey="DirectDiscovery.Details":isDimension(field)&&(translationKey="DirectDiscovery.Dimension"),translationKey}return{isMeasure:isMeasure,isDetails:isDetails,isDimension:isDimension,removeMeasureAndDetailsFields:removeMeasureAndDetailsFields,getTypeTranslationKey:getTypeTranslationKey,isDirectDiscoveryField:isDirectDiscoveryField}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service"],function(listObjectUtil,directDiscoveryService){"use strict";function getDropOption(item){var dimDef;return dimDef=listObjectUtil.createFieldDimension(item.qName),listObjectUtil.autoSortDimension(dimDef,[item]),{id:"newObject",args:{template:"filterpane",children:[listObjectUtil.createDefaultListBox(dimDef,item.qName)],init:{}}}}function expand(list){for(var result=[],i=0;i<list.length;++i){var field=list[i];if(result.push(field),field.qDerivedFieldData)for(var j=0;j<field.qDerivedFieldData.qDerivedFieldLists.length;++j)for(var derived=field.qDerivedFieldData.qDerivedFieldLists[j],k=0;k<derived.qFieldDefs.length;++k){var derived_field=derived.qFieldDefs[k];result.push({qName:derived_field.qName,qSrcTables:field.qSrcTables,qTags:derived_field.qTags,isDerived:!0,sourceField:field.qName,derivedDefinitionName:derived.qDerivedDefinitionName})}}return result}var model={create:function(list){return list.map(function(field){return{id:field.qName,name:field.qName,type:"field",srcTables:field.qSrcTables,sourceField:field.sourceField,calendarTemplateName:field.derivedDefinitionName,getDropOption:getDropOption.bind(null,field),tags:field.qTags,icon:directDiscoveryService.isDirectDiscoveryField(field)?"directdiscovery":"",iconTooltip:directDiscoveryService.getTypeTranslationKey(field.qTags),derivedCalendars:field.qDerivedFieldData?field.qDerivedFieldData.qDerivedFieldLists.map(function(cal){return cal.qDerivedDefinitionName}):[]}})},expand:expand,createFromArray:function(array,mappingName){var i,fields=[];for(i=0;i<array.length;i++)mappingName&&(array[i].qName=array[i][mappingName]),fields.push({name:array[i].qName,type:"field",getDropOption:getDropOption.bind(null,array[i])});return fields},getTables:function(list){var i,j,tables,fields=list;for(tables=[],i=0;i<fields.length;++i)for(j=0;j<fields[i].qSrcTables.length;++j)-1===tables.indexOf(fields[i].qSrcTables[j])&&tables.push(fields[i].qSrcTables[j]);return tables}};return model}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","general.models/field","general.models/library/dimension","general.models/library/measure","client.assets/tab-contents/fields/assets-field-list-model"],function(ArrayUtil,FieldModel,DimensionModel,MeasureModel,FieldListModel){"use strict";function findField(name){return FieldModel.getListLayout().then(function(fieldList){fieldList=FieldListModel.expand(fieldList);var i,item;if(fieldList)for(i=0;i<fieldList.length;i++)if(item=fieldList[i],item.qName===name)return item;return null})}function findLibraryMeasure(id){return MeasureModel.getListLayout().then(function(measureList){var i,item;if(measureList)for(i=0;i<measureList.length;i++)if(item=measureList[i],item.qInfo.qId===id)return item;return null})}function findLibraryDimension(id){return DimensionModel.getListLayout().then(function(dimensionList){var i,layout;if(dimensionList)for(i=0;i<dimensionList.length;i++)if(layout=dimensionList[i],layout.qInfo.qId===id)return layout;return null})}function getSortedFields(){return FieldModel.getListLayout().then(function(fields){return FieldListModel.expand(fields).sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())})})}function getSortedDimensions(){return DimensionModel.getListLayout().then(function(dimensions){return ArrayUtil.copy(dimensions).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}function getSortedMeasures(){return MeasureModel.getListLayout().then(function(measures){return ArrayUtil.copy(measures).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}return{findField:findField,findLibraryDimension:findLibraryDimension,findLibraryMeasure:findLibraryMeasure,getSortedFields:getSortedFields,getSortedDimensions:getSortedDimensions,getSortedMeasures:getSortedMeasures}}),define("extensions.qliktech/barchart/barchart-data",["core.utils/deferred","general.utils/array-util","general.utils/property-resolver","objects.utils/data-properties/library-utils","general.models/library/dimension"],function(Deferred,arrayUtils,propertyResolver,libraryUtils,DimensionModel){function setInitialSort(handler){function setSorting(cardinal){cardinal>10?1!==handler.getSorting()[0]&&handler.changeSorting(1,0):0!==handler.getSorting()[0]&&handler.changeSorting(1,0)}var index,dims=handler.getDimensions(),meas=handler.getMeasures();if(1===dims.length&&1===meas.length){var dimension=dims[0];return dimension.qLibraryId?DimensionModel.getLayout(dimension.qLibraryId).then(function(dimLayout){if(dimLayout&&dimLayout.qDimInfos&&dimLayout.qDimInfos[0]){var cardinal=dimLayout.qDimInfos[0].qCardinal;setSorting(cardinal)}return dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){if(field){var cardinal=field.qCardinal;setSorting(cardinal)}return dimension})}return dims.length>1&&1===meas.length&&(index=handler.getSorting().indexOf(0),0!==index&&handler.changeSorting(index,0)),Deferred.resolve()}function setColorVars(data,handler){var dims=handler.getDimensions(),measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");dims.length>1&&data.color&&(data.color.persistent=!0),"byMeasure"===mode&&measures.length>1?propertyResolver.setValue(data,"color.mode","byDimension"):"byExpression"===mode&&0===measures.length&&propertyResolver.setValue(data,"color.mode","primary")}function maxMeasures(nDims){return nDims>=2?1:15}var data={measures:{min:1,max:maxMeasures,add:function(measure,data,handler){return setInitialSort(handler).then(function(){return measure.qSortBy.qSortByNumeric=-1,setColorVars(data,handler),measure})},remove:function(measure,data,handler){var dimensions=handler.getDimensions(),disabledDimensions=handler.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===dimensions.length&&disabledDimensions&&disabledDimensions.length&&(dimensions.push(disabledDimensions.splice(0,1)[0]),arrayUtils.indexAdded(handler.hcProperties.qInterColumnSortOrder,dimensions.length-1)),setColorVars(data,handler),dimensions.length>1&&"stacked"===data.barGrouping.grouping?(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===dimensions.length&&(data.qHyperCubeDef.qMode="S")}},dimensions:{min:1,max:function(nMeasures){return nMeasures>=2?1:2},add:function(dimension,data,handler){return handler.getDimensions().length>1&&"stacked"===data.barGrouping.grouping&&(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0),setInitialSort(handler).then(function(){return setColorVars(data,handler),dimension})},remove:function(dimension,data,handler){var dimensions=handler.getDimensions(),measures=handler.getMeasures(),maxNumMeasures=maxMeasures(dimensions.length),disabledMeasures=handler.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===measures.length&&disabledMeasures&&disabledMeasures.length&&disabledMeasures.splice(0,maxNumMeasures-1).forEach(function(m){measures.push(m),handler.hcProperties.qInterColumnSortOrder.push(dimensions.length+measures.length-1)}),setColorVars(data,handler),1===dimensions.length&&(data.qHyperCubeDef.qMode="S")}}};return data}),define("extensions.qliktech/barchart/barchart-explore-properties",["client.utils/property-hypercube-helper"],function(hcHelper){return{type:"items",component:"accordion",items:{sort:{uses:"sort",items:{dimensions:{locked:function(index,data){return 1===hcHelper.getNumMeasures(data)&&2===hcHelper.getNumDimensions(data)?0===index:!1}}}},color:{uses:"color",items:{dimension:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:function(data){return hcHelper.getNumDimensions(data)>1},change:function(data){data.color.mode="byDimension",data.color.auto=!1}}}}}},presentation:{uses:"presentation",items:{showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"ª",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(data){var numMeasures=data.qHyperCubeDef.qMeasures.length,numDimensions=data.qHyperCubeDef.qDimensions.length;return numMeasures+numDimensions>2},change:function(data){var numDimensions=data.qHyperCubeDef.qDimensions.length;numDimensions>1&&"stacked"===data.barGrouping.grouping?(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0):data.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",horizontal:!0,items:[{component:"icon-item",icon:"º",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"Ω",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]}}}}}}),define("objects.views/charts/layout-engine",["objects.utils/shapes/rect"],function(Rect){function LayoutEngine(){this._layoutComponents=[],this._componentSizes=[]}function storeComponentSize(component){var o=this._componentSizes.filter(function(obj){return obj.component===component})[0];o||(o={component:component},this._componentSizes.push(o)),o.rect=component.rect.clone()}function getComponentsOldSize(component){return this._componentSizes.filter(function(obj){return obj.component===component})[0]}function doAPass(layoutRect,fullRect,layoutMode,firstDirection,fn){var i,cs=this._layoutComponents.slice(),directions=[{fn:"_reduceComponentRectBySpacingV",dock:["left","right"]},{fn:"_reduceComponentRectBySpacingH",dock:["top","bottom"]}];for("vertical"===firstDirection&&directions.reverse(),cs.sort(function(a,b){return(a.reductionOrder||1e3)-(b.reductionOrder||1e3)}),i=0;i<cs.length;i++)cs[i].perpendicularlyRelevantSpacing={top:0,left:0,right:0,bottom:0},cs[i].preRelevantSizeCalculation&&cs[i].preRelevantSizeCalculation();var preliminaryRect=layoutRect.clone();directions.forEach(function(dir){this._reducePreliminaryLayoutRectForComponents(cs,preliminaryRect,fullRect,layoutMode,function(component){return component&&dir.dock.indexOf(component.dock)>=0}),this[dir.fn](preliminaryRect,fullRect,cs,layoutMode)},this),fn&&fn()&&(preliminaryRect=layoutRect.clone(),directions.forEach(function(dir){this._reducePreliminaryLayoutRectForComponents(cs,preliminaryRect,fullRect,layoutMode,function(component){return component&&dir.dock.indexOf(component.dock)>=0}),this[dir.fn](preliminaryRect,fullRect,cs,layoutMode)},this)),directions.forEach(function(dir){this._reduceLayoutRectForComponents(cs,layoutRect,fullRect,preliminaryRect,layoutMode,function(component){return component&&dir.dock.indexOf(component.dock)>=0}),this[dir.fn](layoutRect,fullRect,cs,layoutMode)},this)}return LayoutEngine.prototype={addComponent:function(component){var cs;cs=this._layoutComponents,this.removeComponent(component),cs.push(component)},removeComponent:function(component){var j,cs;for(cs=this._layoutComponents,j=0;j<cs.length;++j)if(cs[j]===component)return void cs.splice(j,1)},_reduceLayoutRectForComponents:function(cs,layoutRect,fullRect,preliminaryCenter,layoutMode,condition){var i;for(i=0;i<cs.length;++i)cs[i]&&["left","right","bottom","top"].contains(cs[i].dock)&&condition(cs[i])&&(cs[i].calculateRelevantSize(layoutRect,fullRect,preliminaryCenter),cs[i].isVisible(layoutMode)&&cs[i].reduceLayoutRect(layoutRect))},_reducePreliminaryLayoutRectForComponents:function(cs,layoutRect,fullRect,layoutMode,condition){var i;for(i=0;i<cs.length;++i)cs[i]&&["left","right","bottom","top"].contains(cs[i].dock)&&condition(cs[i])&&(cs[i].calculatePreliminaryRelevantSize?cs[i].calculatePreliminaryRelevantSize(layoutRect,fullRect):cs[i].calculateRelevantSize(layoutRect,fullRect),cs[i].isVisible(layoutMode)&&cs[i].reduceLayoutRect(layoutRect))},_reduceComponentRectBySpacingH:function(layoutRect,fullRect,cs,layoutMode){var i,spacing;for(i=0;i<cs.length;++i)spacing=cs[i].perpendicularlyRelevantSpacing,spacing&&cs[i].isVisible(layoutMode)&&(spacing.left>layoutRect.x&&layoutRect.x>=0&&(layoutRect.width-=spacing.left-layoutRect.x,layoutRect.x=spacing.left),spacing.right>fullRect.width-layoutRect.x-layoutRect.width&&(layoutRect.width-=spacing.right-(fullRect.width-layoutRect.x-layoutRect.width-fullRect.x)))},_reduceComponentRectBySpacingV:function(layoutRect,fullRect,cs,layoutMode){var i,spacing;for(i=0;i<cs.length;++i)spacing=cs[i].perpendicularlyRelevantSpacing,spacing&&cs[i].isVisible(layoutMode)&&(spacing.top>layoutRect.y&&layoutRect.y>=0&&(layoutRect.height-=spacing.top-layoutRect.y,layoutRect.y=spacing.top),spacing.bottom>fullRect.height-layoutRect.y-layoutRect.height&&(layoutRect.height-=spacing.bottom-(fullRect.height-layoutRect.y-layoutRect.height-fullRect.y)))},_layoutComponent:function(component,layoutMode,tmpRects,layoutRect){component&&component.insertAdjacentTo(component.dock&&"center"!==component.dock?component.isVertical()?tmpRects.x:tmpRects.y:layoutRect,component.isVisible(layoutMode))},layout:function(fullRect,layoutMode,containerRect,firstDirection,fn){var pad=2;fullRect=new Rect(fullRect.x,fullRect.y,fullRect.width,fullRect.height),containerRect=new Rect(containerRect.x,containerRect.y,containerRect.width,containerRect.height);var i,cs,layoutRect,tmpRects,oldComponentSize,scaleX=containerRect.width/fullRect.width,scaleY=containerRect.height/fullRect.height;for(cs=this._layoutComponents,cs.sort(function(a,b){return"center"===a.dock?"center"===b.dock?0:-1:"center"===b.dock?1:a.layoutOrder-b.layoutOrder}),fullRect=new Rect(fullRect.x,fullRect.y,fullRect.width-2*pad,fullRect.height-2*pad),layoutRect=new Rect(fullRect.x,fullRect.y,fullRect.width,fullRect.height),tmpRects={x:new Rect,y:new Rect},doAPass.apply(this,[layoutRect,fullRect,layoutMode,firstDirection,fn]),layoutRect.x+=pad,layoutRect.y+=pad,tmpRects.x.set(layoutRect.x,layoutRect.y,layoutRect.width,layoutRect.height),tmpRects.y.set(layoutRect.x,layoutRect.y,layoutRect.width,layoutRect.height),i=0;i<cs.length;++i)cs[i].setLayoutToContainerRatios(scaleX,scaleY),this._layoutComponent(cs[i],layoutMode,tmpRects,layoutRect),oldComponentSize=getComponentsOldSize.call(this,cs[i]),cs[i].updateSize(!oldComponentSize||oldComponentSize.rect.width!==cs[i].rect.width||oldComponentSize.rect.height!==cs[i].rect.height),storeComponentSize.call(this,cs[i])}},LayoutEngine}),define("objects.views/charts/components/data-area",["./chart-component"],function(ChartComponent){var DataArea;return DataArea=ChartComponent.extend({paint:function(layoutMode){this._super(layoutMode)}})}),define("objects.views/charts/components/axis/radial-axis-helper",["objects.views/charts/utils/matrix","objects.utils/shapes/rect"],function(Matrix){function renderRadial(levels,axis,windowSizeMultiplier){var x,y,calcDirection,nValue,angle,position,labelPos,i,positions=levels.length>0?levels[0].positions:[],style=axis._style,options=axis._radialOptions,matrix=new Matrix,tickLength=style.tick.length*windowSizeMultiplier,labelOffset=style.label.offset*windowSizeMultiplier*20,lineThickness=1,align="far"===axis.getAlignment()?"left":"right",objectsToRender=[],max=Math.min(axis.rect.height,axis.rect.width),min=0,rPositions=[],radius=axis._radius;if(calcDirection="left"===align?1:-1,tickLength=calcDirection*tickLength,x=calcDirection>0?0:axis.rect.width,y=0,x+=calcDirection*lineThickness/2,y+=axis._padding.top,axis.getShowLine()&&objectsToRender.push({stroke:style.line.color,shape:{cx:axis._centerPoint.x,cy:axis._centerPoint.y,radius:radius,radianOffset:0,start:options.start,end:options.end},type:"arc"}),axis.getShowLabels())for(i=0;i<positions.length;i++)nValue=(positions[i]-min)/(max-min),position=getPointOfValue(nValue,axis),labelPos=getPolPos(position),labelPos.r=labelPos.r+labelOffset,labelPos=getCartPos(labelPos,axis._centerPoint),angle=getAngleOfNormalizedValue(nValue,axis),labelPos.angle=angle,rPositions.push(labelPos),matrix.save(),matrix.translate(position.x+axis._centerPoint.x,position.y+axis._centerPoint.y),matrix.rotate(angle),objectsToRender.push({stroke:style.tick.color,opacity:axis.ticks[i].opacity,transform:matrix.elements,shape:{x1:0,x2:-tickLength,y1:0,y2:0},type:"line"}),matrix.restore();if(x+=style.tick.length*calcDirection,axis._showLabels&&axis._layoutMode>1)for(i=0;i<levels.length;i++)objectsToRender=objectsToRender.concat(renderHorizontalLabelsOnRadialAxis(levels[i],rPositions,x,axis)),x+=levels[i].labelSpace*calcDirection;axis._showTitle&&axis._layoutMode>1&&(objectsToRender=objectsToRender.concat(renderTitle(axis,style))),axis._renderer.shapes=objectsToRender,axis._renderer.render()}function renderHorizontalLabelsOnRadialAxis(data,rPositions,x,axis){var labelWidth,side,angle,pos,i,h,values=data.labels,positions=rPositions,opacities=data.opacities,objectsToRender=[],style=axis._style;if(values){for(i=0;i<values.length;i++)labelWidth=axis._renderer.getTextWidth(values[i],style.label.font),pos=positions[i],angle=pos.angle,side=angle-.1<3*Math.PI/2&&angle+.1>3*Math.PI/2?"center":angle<Math.PI/2||angle>3*Math.PI/2?"left":"right",objectsToRender.push({type:"text",fill:style.label.color,opacity:opacities?opacities[i]:1,shape:{text:values[i],x:pos.x,y:pos.y,maxWidth:pos.x-labelWidth<0?pos.x:pos.x+labelWidth>axis.rect.width?axis.rect.width-pos.x:labelWidth,height:h,maxNumLines:1,font:style.label.font,align:side,baseline:"middle"}});return objectsToRender}}function renderTitle(axis,style){var objectsToRender=[],minDim=Math.min(axis.rect.width,axis.rect.height),cp=findCenterPoint(axis);return objectsToRender.push({type:"text",fill:style.label.color,opacity:1,shape:{text:axis._title,x:cp.x,y:cp.y+minDim*(.06+.04*(Math.min(minDim-300,0)/-300)),maxWidth:1.4*axis._radius,maxNumLines:1,font:style.label.font,align:"center",baseline:"middle"}}),objectsToRender}function findCenterPoint(axis){var cp={x:axis.rect.width/2,y:axis.rect.height/2};return cp}function getAngleOfNormalizedValue(nValue,axis){var options=axis._radialOptions,a=Math.max(Math.min(nValue,1),0)*(options.end-options.start)+options.start;return a}function getPointOfValue(nValue,axis,center){var options=axis._radialOptions,a=nValue*(options.end-options.start)+options.start,r=axis._radius;return getCartPos({a:a,r:r},center)}function getPolPos(p){return{r:Math.sqrt(p.x*p.x+p.y*p.y),a:Math.atan2(p.y,p.x)}}function getCartPos(pol,center){return center||(center={x:0,y:0}),{x:center.x+pol.r*Math.cos(pol.a),y:center.y+pol.r*Math.sin(pol.a)}}return{renderRadial:renderRadial,getPointOfValue:getPointOfValue,getPolPos:getPolPos,getCartPos:getCartPos,getAngleOfNormalizedValue:getAngleOfNormalizedValue}}),define("objects.views/charts/components/axis/axis",["jquery","../chart-component","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.utils/shapes/polygon","objects.views/charts/chart-style-service"],function($,ChartComponent,RadialAxisHelper,CanvasRenderer,Matrix,Rect,Polygon,ChartStyleService){"use strict";function render(){var levels,self=this;return levels=this.getLabels()||[],levels.length||this._showTitle_internal?(this._cacheItems&&this._cacheItems.length&&(this._cacheItems[0].objectShapes?this._cacheItems.forEach(function(item){item.objectShapes[self.selectionIdentifier]=null}):this._cacheItems.forEach(function(item){item.clearShapes(self.selectionIdentifier)})),void(this.isRadial()?RadialAxisHelper.renderRadial(levels,this,this._windowSizeMultiplier):this.isVertical()?renderVertical.apply(this,[levels]):renderHorizontal.apply(this,[levels]))):void this._renderer.clear()}function renderTiltedLabelsOnHorizontalAxis(data,y,radians,calcDirection,isInner){var pos,xc,yc,points,shape,w,matrix,hitBoxMatrix,i,baseline,values=data.labels,positions=data.positions,fontExcess=Math.abs(this._fontHeight*Math.sin(radians)),labelSpace=data.labelSpace,labelLength=Math.abs(labelSpace/Math.sin(radians)),cosRad=Math.cos(radians),hitBoxTransformMatrix=(new Matrix).skew(1.57079632679-radians,0).scale(this._discreteSpacing*(this._groupSize||1)/this._fontHeight,1).translate(0,-calcDirection*this._fontHeight/2).rotate(-1.57079632679),objectsToRender=[],align=0>radians?"right":"left";for(baseline="middle","near"===this.getAlignment()&&"center"!==align&&(align="left"===align?"right":"left"),i=0;i<values.length;i++)pos=positions[i],0>pos||pos>this.rect.width||(matrix=new Matrix,matrix.translate(positions[i],y+calcDirection*fontExcess/2),hitBoxMatrix=matrix.clone(),matrix.rotate(radians),w="right"===align?Math.min((pos+this._edgeBleed.left)/cosRad,labelLength):Math.min((this.rect.width-pos+this._edgeBleed.right)/cosRad,labelLength),w-=2*fontExcess,objectsToRender.push({type:"text",fill:this._style.label.color,opacity:data.opacities[i],transform:matrix.elements,shape:{text:values[i]||"",font:this._style.label.font,maxWidth:w,align:align,baseline:baseline}}),useCacheItems(this._cacheItems,this.isDiscrete(),data.indecies,i)&&isInner&&(xc="left"===align?0:-Math.abs(labelSpace),yc=this._fontHeight/2,points=[{x:xc,y:-yc},{x:xc+labelSpace,y:-yc},{x:xc+labelSpace,y:yc},{x:xc,y:yc}],hitBoxMatrix.multiply(hitBoxTransformMatrix),shape=new Polygon(hitBoxMatrix.transformPoints(points)),this._cacheItems[data.indecies[i]].addShape(this.selectionIdentifier,shape)));return objectsToRender}function renderHorizontalLabelsOnHorizontalAxis(data,y,calcDirection,isInner){var i,x,w,shape,yPos,baseline="near"===this.getAlignment()?"bottom":"top",align="center",values=data.labels,positions=data.positions,opacities=data.opacities,labelingMode=data.labelMode,style=this._style,widths=data.widths,objectsToRender=[];for(i=0;i<values.length;i++)x=positions[i],-.5>x||x>this.rect.width+.5||(this.isDiscrete()||0!==i&&i!==values.length-1?!this.isDiscrete()||labelingMode!==HORIZONTAL||0!==i&&i!==values.length-1?align="center":(w=CanvasRenderer.measureTextObject({type:"text",shape:{text:values[i]||"",x:x,y:y,maxWidth:widths[i]-4,font:this._style.label.font,align:align,baseline:baseline}}).width,0===i&&w/2>x?x+=w/2-x:i===values.length-1&&w/2>this._plotSize-x&&(x-=w/2-(this._plotSize-x))):(w=CanvasRenderer.measureTextObject({type:"text",shape:{text:values[i]||"",x:x,y:y+(labelingMode===HORIZONTAL?0:1.5*this._fontHeight*(i%2)*calcDirection),maxWidth:widths[i]-4,font:this._style.label.font,align:align,baseline:baseline}}).width,0===i&&w/2>x?x+=w/2-x:i===values.length-1&&w/2>this._plotSize-x+this._padding.left&&(x-=w/2-(this._plotSize-x+this._padding.left))),yPos=y+(labelingMode===HORIZONTAL?0:1.5*this._fontHeight*(i%2)*calcDirection),useCacheItems(this._cacheItems,this.isDiscrete(),data.indecies,i)&&isInner&&(shape=new Rect(x-(widths[i]-4)/2,yPos-("bottom"===baseline?this._fontHeight*style.label.lineHeight:0),widths[i]-4,this._fontHeight*style.label.lineHeight),this._cacheItems[data.indecies[i]].addShape(this.selectionIdentifier,shape)),objectsToRender.push({type:"text",fill:this._style.label.color,opacity:opacities?opacities[i]:1,shape:{text:values[i]||"",x:x,y:yPos,maxWidth:widths[i]-4,font:this._style.label.font,align:align,baseline:baseline}}));return objectsToRender}function renderHorizontalLabelsOnVerticalAxis(data,x,align,isInner){var labelHeight,y,i,h,shape,values=data.labels,positions=data.positions,opacities=data.opacities,labelSpace=data.labelSpace,objectsToRender=[],style=this._style;for(labelHeight=this._renderer.getFontHeight(style.label.font),h=positions.length>1?Math.abs(positions[0]-positions[1]):this.rect.height,this.isDiscrete()||(h=0),i=0;i<values.length;i++)y=positions[i],y=Math.max(labelHeight/2,Math.min(this._padding.top+this._plotSize-labelHeight/2,y)),0>y-.5||y+.5>this.rect.height||(useCacheItems(this._cacheItems,this.isDiscrete(),data.indecies,i)&&isInner&&(shape=new Rect(x-("right"===align?labelSpace:0),y-h/2,labelSpace,h),this._cacheItems[data.indecies[i]].addShape(this.selectionIdentifier,shape)),objectsToRender.push({type:"text",fill:style.label.color,
opacity:opacities?opacities[i]:1,shape:{text:values[i],x:x,y:y-h/2,maxWidth:labelSpace,height:h,maxNumLines:1,font:style.label.font,align:align,baseline:"middle"}}));return objectsToRender}function renderVertical(levels){var x,y,calcDirection,i,positions=levels[0]?levels[0].positions:[],opacities=levels[0]?levels[0].opacities:[],style=this._style,tickLength=this.isDiscrete()?0:style.tick.length,lineThickness=1,matrix=new Matrix,align="far"===this.getAlignment()?"left":"right",objectsToRender=[];if(calcDirection="left"===align?1:-1,tickLength=calcDirection*tickLength,x=calcDirection>0?0:this.rect.width,y=0,x+=calcDirection*lineThickness/2,y+=this._padding.top,!this.isDiscrete()&&this._showLabels_internal){if(this._showLabels_internal)for(i=0;i<positions.length;i++)objectsToRender.push({stroke:style.tick.color,opacity:opacities[i],shape:{x1:x,x2:x+tickLength,y1:positions[i],y2:positions[i]},type:"line"});this._showLine_internal&&objectsToRender.push({stroke:style.line.color,shape:{x1:x,x2:x,y1:y-1,y2:y+this._plotSize},type:"line"}),x+=style.tick.length*calcDirection}if(this._showLabels_internal){for(x+=style.label.margin*calcDirection,levels.reverse(),i=0;i<levels.length;i++)levels[i].labelMode!==NONE&&(objectsToRender=objectsToRender.concat(renderHorizontalLabelsOnVerticalAxis.apply(this,[levels[i],x,align,0===i])),x+=levels[i].labelSpace*calcDirection);levels.reverse()}this._showTitle_internal&&(matrix=new Matrix,matrix.translate((calcDirection>0?x:0)+(calcDirection>0?this.rect.width-x:x)/2,this._padding.top+this._plotSize/2),matrix.rotate(.5*Math.PI*("right"===align?-1:1)),objectsToRender.push({type:"text",fill:style.title.color,transform:matrix.elements,shape:{text:this._title||"",maxWidth:this._plotSize,font:style.title.font,align:"center",baseline:"middle"}})),this._renderer.shapes=objectsToRender,this._renderer.render()}function renderHorizontal(levels){var x,y,i,positions=levels[0]?levels[0].positions:[],opacities=levels[0]?levels[0].opacities:[],tickLength=this._style.tick.length,lineThickness=1,calcDirection="far"===this.getAlignment()?1:-1,objectsToRender=[];if(tickLength*=calcDirection,x=this._padding.left||0,y="near"===this.getAlignment()?this.rect.height-1:0,y+=lineThickness/2*calcDirection,!this.isDiscrete()&&this._showLabels_internal){for(this._showLine_internal&&objectsToRender.push({stroke:this._style.line.color,shape:{x1:x-1,x2:x+this._plotSize,y1:y,y2:y},type:"line"}),y+=lineThickness*calcDirection/2,i=0;i<positions.length;i++)objectsToRender.push({stroke:this._style.tick.color,opacity:opacities[i],shape:{x1:positions[i],x2:positions[i],y1:y,y2:y+tickLength},type:"line"});y+=tickLength}if(this._showLabels_internal)for(y+=this._style.label.margin*calcDirection,i=0;i<levels.length;i++)levels[i].labelMode!==NONE&&(objectsToRender=levels[i].labelMode===TILTED?objectsToRender.concat(renderTiltedLabelsOnHorizontalAxis.apply(this,[levels[i],y,levels[i].radians,calcDirection,i===levels.length-1])):objectsToRender.concat(renderHorizontalLabelsOnHorizontalAxis.apply(this,[levels[i],y,calcDirection,i===levels.length-1])),levels[i].labelSpace&&(y+=levels[i].labelSpace*calcDirection));this._showTitle_internal&&objectsToRender.push({type:"text",fill:this._style.title.color,shape:{x:x,y:calcDirection>0?y:0,width:this._plotSize,height:calcDirection>0?this.rect.height-y:y,text:this._title||"",font:this._style.title.font,align:"center",baseline:"middle"}}),this._renderer.shapes=objectsToRender,this._renderer.render()}function useCacheItems(cIs,isDiscreet,indecies,index){return isDiscreet&&cIs&&indecies&&cIs[indecies[index]]}var Axis,NONE=0,HORIZONTAL=1,TILTED=3;return Axis=ChartComponent.extend("Axis",{init:function(parentContainer,options,testId){this._super.apply(this,[parentContainer,$.extend(!0,{},{components:{title:{show:!0,showFlag:options.showFlag},labels:{show:!1,showFlag:options.showFlag}}},options),testId]),this._fontHeight=20,this._titleShowFlag=options.titleShowFlag||null,this._showLabels=!0,this._showLabels_internal=!0,this._showLine=!0,this._showLine_internal=!0,this._showTitle=!1,this._dataIndex=0,this._radial=!1,this._relevantAngle=0,this._cacheItems=null,this._styleService=ChartStyleService.getInstance(),this._style=this._getStyleObject(this._styleService),this._padding={top:0,bottom:0,left:0,right:0},this._renderer=new CanvasRenderer(this.container),this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-axis"),this.innerRect=new Rect(0,0,0,0),this.renderers={axis:this._renderer}},getLabels:function(){return[]},setSelectableShapes:function(s){this._cacheItems=s},calculateValuePositionMappingInfo:function(){},_calculatePlotSize:function(rect){var plotSize,minRadius,radiusIncrease=0;this.isRadial()?(plotSize=Math.min(rect.height,rect.width),minRadius=.4*plotSize,this._relevantAngle=this._radialOptions.end-this._radialOptions.start,radiusIncrease=Math.tan(-this._relevantAngle/4+Math.PI/2)*plotSize*.02,this._radius=minRadius+radiusIncrease,this._centerPoint={x:rect.width/2,y:rect.height/2+4*radiusIncrease}):plotSize=this.isVertical()?rect.height-this._padding.top-this._padding.bottom:rect.width-this._padding.left-this._padding.right,0===this._plotSize&&0!==plotSize?this._plotSize=plotSize:this._plotSize=plotSize},_calculateEdgeBleedAndPlotSize:function(rect){this._edgeBleed={top:this.isVertical()?1:0,bottom:this.isVertical()?1:0,left:this.isVertical()?1:Math.max(rect.x,1),right:this.isVertical()?0:Math.max(0,this.outerRect.width-rect.width-rect.x)},this._calculatePlotSize(rect)},preRelevantSizeCalculation:function(){this._isSizing=!0,this.updateNow(["properties"]),this._isVertical=this.isVertical(),this._style=this._getStyleObject(this._styleService,this._layoutMode,this.isDiscrete()),this._fontHeight=Math.ceil(this._renderer.getFontHeight(this._style.label.font));var isVertical=this._isVertical;this._showTitle_internal=ChartComponent.prototype.isVisible.call({show:this._showTitle&&!!this._title,_verticalLayoutMode:this._verticalLayoutMode,_horizontalLayoutMode:this._horizontalLayoutMode,isVertical:function(){return isVertical},showFlag:null!==this._titleShowFlag?this._titleShowFlag:this.showFlag<<1},this._layoutMode),this._showTitle_internal&&(this._titleFontHeight=this._renderer.getFontHeight(this._style.title.font),this.relevantSize+=this._titleFontHeight*this._style.title.lineHeight)},calculatePreliminaryRelevantSize:function(currentRect,fullRect){var temp,wantedLabelSpace=0,relevantSpacing=0,size=currentRect[this.isVertical()?"height":"width"];this._isSizing=!0,this.relevantSize=0,this.preliminaryRelevantSize=0,this._preliminaryStatics=0,0>=size||(temp=this.calculatePreliminaryLabelSpace(currentRect,fullRect),wantedLabelSpace=temp.relevantLabelSize||0,relevantSpacing=temp.relevantSpacing||0,this.isDiscrete()||(this._preliminaryStatics+=this._style.tick.length),wantedLabelSpace&&(this.preliminaryRelevantSize+=wantedLabelSpace,this.preliminaryRelevantSize+=this._style.label.margin),this._showTitle_internal&&(this._preliminaryStatics+=this._titleFontHeight*this._style.title.lineHeight),this.preliminaryRelevantSize+=this._preliminaryStatics,this.preliminaryRelevantSize=Math.ceil(this.preliminaryRelevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?relevantSpacing:0,right:"near"===this.getAlignment()?relevantSpacing:0,bottom:0},this.relevantSize=this.preliminaryRelevantSize)},calculateRelevantSize:function(currentRect,fullRect,preliminaryCenter){this._isSizing=!0,this._isVertical=this.isVertical(),this.relevantSize=0;var rect=preliminaryCenter?preliminaryCenter:currentRect,wantedLabelSpace=0,relevantSpacing=0;if(this.rect.set(rect.x,rect.y,rect.width,rect.height),this._calculationSize=rect[this.isVertical()?"height":"width"],this.isVertical()?this._calculationSize-=this._padding.top+this._padding.bottom:this._calculationSize-=this._padding.left+this._padding.right,this._plotSize=this._calculationSize,0!==rect.width){var temp=this.calculateLabelSpace(currentRect,fullRect,preliminaryCenter);return wantedLabelSpace=temp.relevantLabelSize||0,relevantSpacing=temp.relevantSpacing||0,wantedLabelSpace&&(this.relevantSize+=wantedLabelSpace,this.relevantSize+=this._style.label.margin),this.relevantSize+=this._preliminaryStatics,this.relevantSize=Math.ceil(this.relevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?relevantSpacing:0,right:"near"===this.getAlignment()?relevantSpacing:0,bottom:0},this._isSizing=!1,this}},insertAdjacentTo:function(layoutRect,reduceLayoutRect){if(this._super(layoutRect,reduceLayoutRect),!this.isDiscrete())switch(this.dock){case"top":this.rect.y+=1;break;case"bottom":this.rect.y-=1}},_getStyleObject:function(styleService,layoutMode,discrete){var chartID="",mode=styleService.layoutMap[layoutMode]||"medium",type=discrete?".discrete":"";return{backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),label:{lineHeight:1.4,color:styleService.getValue(chartID,"axis.label","color"),margin:styleService.getValue(chartID,"axis.label","margin"),offset:1,font:styleService.getFont(chartID,"axis.label"+type,mode)},tick:{color:styleService.getValue(chartID,"axis.tick","color"),length:styleService.getValue(chartID,"axis.tick","length")},line:{color:styleService.getValue(chartID,"axis.line","color")},title:{lineHeight:1.4,font:styleService.getFont(chartID,"axis.title",mode),color:styleService.getValue(chartID,"axis.title","color")}}},isVisible:function(){return this._super.apply(this,[].slice.call(arguments))&&this._showSubcomponents},setShowLabels:function(v){this._showLabels_internal=v,this._showLabels=v},getShowLabels:function(){return this._showLabels},getSpacingMode:function(){return void 0},setShowLine:function(v){this._showLine_internal=v,this._showLine=v},getShowLine:function(){return this._showLine},setShowStrategy:function(show){this._showSubcomponents="none"!==show,this._showTitle=["all","title"].contains(show),this._showTitle_internal=this._showTitle,this.components.title.show=this._showSubcomponents&&["all","title"].contains(show),this._showLabels=["all","labels"].contains(show),this._showLabels_internal=this._showLabels,this.components.labels.show=this._showSubcomponents&&["all","labels"].contains(show)},getShowStrategy:function(){return this._showSubcomponents},setTitle:function(s){this._title=s},setLabelMode:function(s){this._explicitLabelMode=s},setCurrentDataIndices:function(s){this._currentDataIndices=Array.isArray(s)?s:[s]},setDataIndices:function(a){this._dataIndices=Array.isArray(a)?a:[a]},setDataRange:function(){},setOffset:function(){},setInnerOffset:function(){},getInnerOffset:function(){},getNumDiscreteUnits:function(){},setNumDiscreteUnits:function(){},getNumDiscreteUnitsInView:function(){},setMaxDiscreteUnitSize:function(){},setMinDiscreteUnitSize:function(){},setUnitAlignment:function(){},_updateProperties:function(){var indices=this.getType().indices;return this._formatter=1===indices.length&&this.measureFormatters.length?this.measureFormatters[indices[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this.container.setAttribute("data-type",this.isDiscrete()?"discrete":"continuous"),this},updateSize:function(){this._super(),this._calculateEdgeBleedAndPlotSize(this.rect),this._renderer.edgeBleed=this._edgeBleed,this.innerRect=new Rect(this.rect.x+this._padding.left,this.rect.y+this._padding.top,this.rect.width-this._padding.left-this._padding.right,this.rect.height-this._padding.top-this._padding.bottom),this._isVertical=this.isVertical()},paint:function(){return render.apply(this,[]),this.fire("rendered"),this},isDiscrete:function(){return!1},getPositionOfValue:function(){},getAngleOfValue:function(){},getValueOfPosition:function(){},getType:function(){return{type:this.isDiscrete()?"dimension":"measure",indices:this._dataIndices||[0],current:this._currentDataIndices||[0]}},setPadding:function(top,right,bottom,left){this._padding={top:top>0?top:0,right:right>0?right:0,bottom:bottom>0?bottom:0,left:left>0?left:0}},getPadding:function(){return this._padding},isVertical:function(){var dock=this.options.dock;switch(dock){case"left":case"right":return!0;case"center":return"vertical"===this._orientation;default:return!1}},setOrientation:function(o){this._orientation=o},setAlignment:function(d){this._align=d},getAlignment:function(){var dock=this.options.dock;switch(dock){case"left":case"top":return"near";case"center":return this._align;default:return"far"}},setRadial:function(b,options){this._radial=b,this._radialOptions=options},isRadial:function(){return this._radial}})}),define("objects.views/charts/components/axis/discrete-axis",["./axis","objects.utils/shapes/rect"],function(Axis,Rect){"use strict";function getItemAlpha(arr){var cache=this._cacheItems;return cache&&arr&&arr.some(function(index){return cache[index]&&cache[index].selected})?1:this._globalAlpha}function getDiscreteLabels(data,idx,selection,size){var i,pos,isHorizontal=this.isHorizontal(),widths=[],positions=[],labels=[],indecies=[],opacities=[];for(i=0;i<data.length;i+=1)pos={center:this.getPositionOfValue(i,idx),width:this.getWidthOfValue(i,idx)},pos.width>=2*this._discreteSpacing&&(pos.center-this._discreteSpacing+pos.width/2<0||pos.center+this._discreteSpacing-pos.width/2>size)||pos.width<2*this._discreteSpacing&&(pos.center<0||pos.center>size)||(isHorizontal&&pos.center+pos.width/2>size?widths.push(Math.min(size,size-(pos.center-pos.width/2))):isHorizontal&&pos.center-pos.width/2<0?widths.push(Math.min(size,pos.width/2+pos.center)):widths.push(Math.min(size,pos.width)),pos.width>this._discreteSpacing?positions.push(Math.max(1,Math.min(pos.center,size-1))):positions.push(pos.center),labels.push(data[i].label),indecies.push(data[i].cacheIndex?data[i].cacheIndex[0]:0),opacities.push(selection?getItemAlpha.apply(this,[data[i].cacheIndex]):1));return{labels:labels,widths:widths,positions:positions,indecies:indecies,opacities:opacities}}function getCharacterRatios(s){var CJK=s.match(/[\u4E00-\u9FFF]/g);return CJK=CJK?CJK.length:0,{latin:s.length-CJK,cjk:CJK}}function normalize(data,levels,nLevel,parent,details,labelIds){if(!data||!data.length)return[];var i,o,normalized,label,children,characterTypes,a=[];for(i=0;i<data.length;i++)o=data[i],normalized={},label="",children=null,"object"==typeof o?(label=o.label,children=o.children?normalize(o.children,levels,nLevel+1,normalized,details,labelIds):null,normalized.cacheIndex="cacheIndex"in data[i]?data[i].cacheIndex:[],normalized.group=o.group===!0,o.id&&(labelIds[o.id]=normalized)):label=o,normalized.label=label||"",normalized.parent=parent,characterTypes=getCharacterRatios(normalized.label),children&&children.length&&(normalized.children=children),a.push(normalized),levels[nLevel]||(levels[nLevel]={data:[]},levels[nLevel].show=!(details&&details[nLevel]&&details[nLevel].show===!1||levels[nLevel].silo),levels[nLevel].qApprMaxGlyphCount=details&&details[nLevel]&&details[nLevel].qApprMaxGlyphCount||10,levels[nLevel].characterRatios={latin:0,cjk:0}),levels[nLevel].data.push(normalized),levels[nLevel].characterRatios.latin+=characterTypes.latin,levels[nLevel].characterRatios.cjk+=characterTypes.cjk;return a}function getAncestors(node){for(var p=node.parent,arr=[];p;)p.collapseChildren||arr.push(p),p=p.parent;return arr}function calculateSpacings(levels,spacing){var currentPath,newPath,level,i,j,from,currentGroup,newGroup,bottomLevel=levels[levels.length-1].data;for(bottomLevel[0].distanceFrom=spacing/2,bottomLevel[0].distanceTo=bottomLevel[0].distanceFrom+1,currentPath=getAncestors(bottomLevel[0]),currentGroup=currentPath.filter(function(o){return o.group})[0],i=1;i<bottomLevel.length;i++){if(from=bottomLevel[i-1].distanceTo,newPath=getAncestors(bottomLevel[i]),newGroup=newPath.filter(function(o){return o.group})[0],newGroup!==currentGroup){for(j=0;j<newPath.length&&(newPath[j]!==currentPath[j]||!(newPath[j]<0||newPath[j].group));j++);from+=spacing*j,currentGroup=newGroup,currentPath=newPath}bottomLevel[i].distanceFrom=from,bottomLevel[i].distanceTo=bottomLevel[i].distanceFrom+1}if(levels.length>1)for(i=levels.length-2;i>=0;i--)for(level=levels[i].data,j=0;j<level.length;j++)level[j].distanceFrom=level[j].children[0].distanceFrom,level[j].distanceTo=level[j].children[level[j].children.length-1].distanceTo}function getDecentTextWidth(n,renderer,font,ratios){var cjk=renderer.getTextWidth("客",font),latin=24>=n?renderer.getTextWidth("m",font):renderer.getAverageLetterWidth(font);return ratios?n*(cjk*ratios.cjk+latin*ratios.latin):n*latin}var DiscreteAxis,NONE=0,HORIZONTAL=1,TILTED=3;return DiscreteAxis=Axis.extend("DiscreteAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._unitsOffset=0,this._innerOffset=0,this._shrinkToFitThreshold=arguments[1]&&null!==arguments[1].shrinkToFitThreshold?arguments[1].shrinkToFitThreshold:.85,this._maxDiscreteUnitSize=null,this._minDiscreteUnitSize=null,this._alignmentOffset=0,this._unitAlignment="center"},updateSize:function(){this._super(),1===this._numDiscrete?this._discreteSpacing=Math.min(this._discreteSpacing,this._plotSize/this._numDiscrete):this._discreteSpacing-=(this._preliminarySize-this._plotSize)/(this._numUnitsInView||1),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,this._plotSize),this.extendedRect=new Rect(this.rect.x-this._edgeBleed.left,this.rect.y-this._edgeBleed.top,this.rect.width+this._edgeBleed.left+this._edgeBleed.right,this.rect.height+this._edgeBleed.top+this._edgeBleed.bottom)},updateLevels:function(){var oldLevels=this._oldLevels;this._levels.forEach(function(level,idx){level.labelSpace=oldLevels[idx].labelSpace,level.labelMode=oldLevels[idx].labelMode,level.radians=oldLevels[idx].radians})},_getPerpendicularExtensionForTiltedLabels:function(level,currentRect,layoutSize,maxLabelsSpace){var horizontalSpacing,radians=-40*Math.PI/180,verticalSpacing=Math.abs(Math.sin(radians))*level.longestLabelWidth,additionalSpacing=0;return verticalSpacing=Math.min(maxLabelsSpace,verticalSpacing),horizontalSpacing=Math.abs(Math.cos(radians))*verticalSpacing,horizontalSpacing=Math.max(horizontalSpacing-this._discreteSpacing/2,0),"bottom"===this.dock?(horizontalSpacing=Math.max(horizontalSpacing-this._alignmentOffset,0),horizontalSpacing>currentRect.x&&(additionalSpacing=horizontalSpacing-currentRect.x)):"top"===this.dock&&(horizontalSpacing=Math.max(horizontalSpacing-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0),horizontalSpacing>layoutSize.width-currentRect.x-currentRect.width&&(additionalSpacing=horizontalSpacing-(layoutSize.width-layoutSize.x-currentRect.x-currentRect.width))),additionalSpacing},_getLabelMode:function(level,last,availableSpace){var longestLevelLabelWidth,glyphCount=level.qApprMaxGlyphCount;return this._showLabels&&"none"!==this._explicitLabelMode?this._explicitLabelMode&&"auto"!==this._explicitLabelMode?"none"===this._explicitLabelMode?NONE:"tilted"===this._explicitLabelMode?TILTED:HORIZONTAL:last&&this.isHorizontal()&&level.data&&level.data.length&&(longestLevelLabelWidth=getDecentTextWidth(glyphCount,this._renderer,this._style.label.font,level.characterRatios),this._groupSize&&(availableSpace*=this._groupSize),longestLevelLabelWidth>availableSpace)?TILTED:HORIZONTAL:NONE},preRelevantSizeCalculation:function(){this._super();var i,levels=this._levels?this._levels.filter(function(lev){return lev.show!==!1}):[],numLevels=levels.length,maxLabelsSpace=this.outerRect[this.isVertical()?"width":"height"]/4,totalLabelWidth=0,totalRatio=0;if(this.isVisible()){for(i=0;numLevels>i;i++)levels[i].longestLabelWidth=getDecentTextWidth(levels[i].qApprMaxGlyphCount,this._renderer,this._style.label.font,levels[i].characterRatios),totalLabelWidth+=levels[i].longestLabelWidth;for(i=0;numLevels>i;i++)levels[i].labelSizeRatio=Math.min(1/numLevels,levels[i].longestLabelWidth/Math.min(totalLabelWidth,maxLabelsSpace)),totalRatio+=levels[i].labelSizeRatio;1>totalRatio&&numLevels>1?levels[0].labelSizeRatio===1/numLevels?levels[0].labelSizeRatio+=1-totalRatio:levels[1].labelSizeRatio===1/numLevels&&(levels[1].labelSizeRatio+=1-totalRatio):1===numLevels&&(levels[0].labelSizeRatio=1)}},calculatePreliminaryLabelSpace:function(currentRect,fullRect){var i,hideMyLabels=this._hideMyLabels,levels=this._levels?this._levels.filter(function(lev){return lev.show!==!1&&!hideMyLabels}):[],numLevels=levels.length,maxLabelsSpace=this.outerRect[this._isVertical?"width":"height"]/4,lineHeightInPixels=this._fontHeight*this._style.label.lineHeight,relevantSpacing=0,wantedLabelSpace=0;if(this._preliminarySize=currentRect[this._isVertical?"height":"width"],this._calculateDiscreteUnits(this._preliminarySize),this.isVisible())for(i=0;numLevels>i;i++){levels[i].labelMode=this._getLabelMode(levels[i],i===levels.length-1,this._discreteSpacing);var additionalSpacing=0;switch(levels[i].labelMode){case HORIZONTAL:levels[i].labelSpace=this.isHorizontal()?lineHeightInPixels:levels[i].longestLabelWidth,levels[i].labelSpace=Math.min(levels[i].labelSizeRatio*maxLabelsSpace,levels[i].labelSpace);break;case TILTED:levels[i].radians=-40*Math.PI/180,additionalSpacing=this._getPerpendicularExtensionForTiltedLabels(levels[i],currentRect,fullRect,maxLabelsSpace*levels[i].labelSizeRatio),additionalSpacing>currentRect.width/5&&(levels[i].radians=-90*Math.PI/180),levels[i].labelSpace=Math.abs(Math.sin(levels[i].radians))*levels[i].longestLabelWidth+Math.abs(this._fontHeight*Math.sin(levels[i].radians)*2),levels[i].labelSpace=Math.min(levels[i].labelSizeRatio*maxLabelsSpace+Math.abs(this._fontHeight*Math.sin(levels[i].radians)/2),levels[i].labelSpace);break;default:levels[i].labelSpace=0}levels[i].labelMode===TILTED&&(relevantSpacing=Math.max(relevantSpacing,Math.min(currentRect.width/3,Math.ceil(Math.cos(levels[i].radians)*levels[i].labelSpace))),relevantSpacing=Math.max(relevantSpacing-this._discreteSpacing/2,0),"bottom"===this.dock?relevantSpacing=Math.max(relevantSpacing-this._alignmentOffset,0):"top"===this.dock&&(relevantSpacing=Math.max(relevantSpacing-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0)),relevantSpacing=Math.ceil(relevantSpacing)),wantedLabelSpace+=levels[i].labelSpace}return relevantSpacing>0&&("bottom"===this.dock&&relevantSpacing>currentRect.x?this._preliminarySize=this._preliminarySize-(relevantSpacing-currentRect.x):"top"===this.dock&&relevantSpacing>fullRect.width-currentRect.x-currentRect.width&&(this._preliminarySize=this._preliminarySize-(relevantSpacing-(fullRect.width-fullRect.x-currentRect.x-currentRect.width))),this._calculateDiscreteUnits(this._preliminarySize)),this.fire("numDiscreteUnitsChanged"),this.fire("numDiscreteUnitsInViewChanged"),this._showLabels_internal=this._showLabels&&levels&&levels.some(function(level){return level.labelMode!==NONE}),this._preliminaryRelevantSize={relevantLabelSize:wantedLabelSpace,relevantSpacing:relevantSpacing},this._preliminaryRelevantSize},calculateLabelSpace:function(){return this.updateNow(["properties"]),this._preliminaryRelevantSize},setDataRange:function(labels,details){var bottomLevel,totalDistance,space,charTotal;if(this._levels&&this._levels.length&&(this._oldLevels=this._levels.map(function(level){return{labelMode:level.labelMode,labelSpace:level.labelSpace,radians:level.radians}})),this._levels=[],this._labelIds={},normalize(labels,this._levels,0,-1,details,this._labelIds),space=this._levels.length>1?1:0,this._levels&&this._levels.length){calculateSpacings(this._levels,space);for(var i=0;i<this._levels.length;i++)this._levels[i].characterRatios&&(charTotal=this._levels[i].characterRatios.latin+this._levels[i].characterRatios.cjk||1,this._levels[i].characterRatios.latin=this._levels[i].characterRatios.latin/charTotal,this._levels[i].characterRatios.cjk=this._levels[i].characterRatios.cjk/charTotal);bottomLevel=this._levels[this._levels.length-1].data,totalDistance=bottomLevel[bottomLevel.length-1].distanceTo+space/2,this._numDiscrete=bottomLevel.length,this._numDiscrete=totalDistance||0,this._explicitNumDiscrete&&(this._numDiscrete=this._explicitNumDiscrete,this._numDiscrete=this._explicitNumDiscrete)}return this.invalidateProperties(),this.invalidateDisplay("setDataRange"),this},setOffset:function(offset){return this._unitsOffset!==offset?(this._unitsOffset=offset,this.invalidateProperties(),this.invalidateDisplay("setOffset"),this.fire("changed"),this):void 0},getOffset:function(){return this._unitsOffset},setGroupSize:function(v){this._groupSize=v},setInnerOffset:function(offset){this._innerOffset=offset},getInnerOffset:function(){return this._innerOffset||0},getNumDiscreteUnits:function(){return this._numDiscrete},setNumDiscreteUnits:function(v){this._explicitNumDiscrete=v},getNumDiscreteUnitsInView:function(){return this._numUnitsInView},setMaxDiscreteUnitSize:function(v){this._maxDiscreteUnitSize=v},setMinDiscreteUnitSize:function(v){this._minDiscreteUnitSize=v},setUnitAlignment:function(s){this._unitAlignment=s},isDiscrete:function(){return!0},setLockedInfo:function(l){this._lockedInfo=l},getLabels:function(){var level,i,levels=[];if(this._levels&&this._levels.length)for(i=0;i<this._levels.length;i++)this._levels[i].show&&(level=getDiscreteLabels.call(this,this._levels[i].data,i,i===this._levels.length-1,this._plotSize),level.labelMode=this._levels[i].labelMode,level.labelSpace=this._levels[i].labelSpace,level.radians=this._levels[i].radians,levels.push(level));return levels},calculateValuePositionMappingInfo:function(){this._calculateDiscreteUnits(this._plotSize)},getDiscreteSpacing:function(){return this._discreteSpacing},getPositionOfValue:function(i,nLevel){var level,o,idx=this._levels.length-1;"undefined"!=typeof nLevel&&(idx=Math.min(this._levels.length-1,Math.max(0,nLevel))),level=this._levels[idx].data,o=level[i];var units=o.distanceFrom+.5*(o.distanceTo-o.distanceFrom)+this._innerOffset-this._unitsOffset;return units*this._discreteSpacing+this._alignmentOffset},getWidthOfValue:function(i,nLevel){var level,idx=this._levels.length-1;return"undefined"!=typeof nLevel&&(idx=Math.min(this._levels.length-1,Math.max(0,nLevel))),level=this._levels[idx].data,(level[i].distanceTo-level[i].distanceFrom)*this._discreteSpacing},getPositionOfId:function(id){var o=this._labelIds[id]||this._labelIds[id.split(";").reverse().slice(-1).reverse().join(";")];if(!o)return 0;var units=o.distanceFrom+.5*(o.distanceTo-o.distanceFrom)+this._innerOffset-this._unitsOffset;return units*this._discreteSpacing+this._alignmentOffset},getWidthOfId:function(id){var o=this._labelIds[id]||this._labelIds[id.split(";").reverse().slice(-1).reverse().join(";")];return o?(o.distanceTo-o.distanceFrom)*this._discreteSpacing:0},getValueOfPosition:function(p){var fromP,toP,i,o,data=this._levels[0].data,len=data.length;for(i=0;len>i;i+=1)if(o=data[i],fromP=(o.distanceFrom+this._innerOffset-this._unitsOffset)*this._discreteSpacing,toP=fromP+(o.distanceTo-o.distanceFrom)*this._discreteSpacing,p>=fromP&&toP>=p)return o.label;return""},_calculateDiscreteUnits:function(size){this._discreteSpacing=Math.max(null!==this._minDiscreteUnitSize?this._minDiscreteUnitSize:0,size/this._numDiscrete),null!==this._maxDiscreteUnitSize&&(this._discreteSpacing=Math.min(this._maxDiscreteUnitSize,this._discreteSpacing)),(1===this._numDiscrete||this._numDiscrete*this._discreteSpacing>size&&this._numDiscrete*this._discreteSpacing*this._shrinkToFitThreshold<size)&&(this._discreteSpacing=Math.min(this._discreteSpacing,size/this._numDiscrete)),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,size),this._numUnitsInView=Math.min(this._numDiscrete,Number((size/this._discreteSpacing).toFixed(5)))},_getAlignmentOffset:function(alignment,size){var offset=null!==this._maxDiscreteUnitSize&&this._discreteSpacing<size/this._numDiscrete?.5*(size-this._numDiscrete*this._discreteSpacing):0;return"near"===alignment?0:"far"===alignment?2*offset:offset}})}),define("objects.views/charts/components/chart-component-angular",["jquery","qvangular","./chart-component"],function($,qvangular,ChartComponent){"use strict";var ChartComponentAngular;return ChartComponentAngular=ChartComponent.extend({init:function(parentContainer,options,testId,template){this._super(parentContainer,options,testId);var $compile=qvangular.getService("$compile");this._innerContainer=$(template).appendTo($(this.container)),$compile(this._innerContainer)($(this.container).scope().$new()),this._innerScope=this._innerContainer.scope()},getInnerContainer:function(){return this._innerContainer},getInnerContainerScope:function(){return this._innerScope},release:function(){this._super(),this._innerContainer.remove(),this._innerContaine=null,this._innerScope.$destroy(),this._innerScope=null}})}),define("text!objects.views/charts/components/legend/color-legend.ng.html",[],function(){return'<div class="color-legend">\r\n    <div qv-discrete-legend\r\n         ng-if="discrete && visible"\r\n         view-items="viewItems"\r\n         options="options">\r\n    </div>\r\n\r\n	<div qv-continous-legend\r\n		 ng-if="!discrete && visible"\r\n		 view-items="viewItems"\r\n		 options="options"></div>\r\n</div>\r\n'}),define("objects.views/charts/components/legend/legend-data",["objects.views/charts/utils/canvas-renderer"],function(CanvasRenderer){function getItemText(item){return item.label?item.label:item.min&&item.max?item.min+" - "+(item.isMax?"":"<")+item.max:item.max?"<"+item.max:">"+item.min}function buildCacheMap(cacheItems,dimIndex){var i,dim,target,id,l=cacheItems.length,cm={};for(i=0;l>i;i++){for(target=cacheItems[i],dim=0;dimIndex>dim&&target.parent;)target=target.parent,dim++;id=target.id,cm[id]?cm[id].push(cacheItems[i]):cm[id]=[cacheItems[i]]}return cm}function prepareDiscrete(colorItems,cacheItems,style,approxFullWidth,scaling,dimIndex){var i,color,cellHeight,cellWidth,maxTextWidth,cacheMap,model=[],maxCellWidth=0,maxCellHeight=MIN_CELL_HEIGHT,length=Math.min(MAX_NUMBER_OF_ITEMS,colorItems.length);dimIndex=dimIndex||0,cacheMap=buildCacheMap(cacheItems,dimIndex),style=style||{font:"13px 'QlikView Sans'"},maxTextWidth=CanvasRenderer.getAverageLetterWidth(style.font)*MAX_NUM_CHARACTERS_PER_ROW,approxFullWidth>(maxTextWidth+MARKER_WIDTH)*colorItems.length&&(maxTextWidth=approxFullWidth/colorItems.length-MARKER_WIDTH-PRECISION_ERROR_FIX);var t={type:"text",fill:0,opacity:1,shape:{text:null,font:style.font,maxWidth:maxTextWidth,align:"left",baseline:"middle",maxNumLines:2}};for(i=0;length>i;i++){var item=colorItems[i];color=item.color.toHex(),t.shape.text=getItemText(item);var measurements=CanvasRenderer.measureTextObject(t);measurements.height=Math.ceil(measurements.height),maxCellWidth=Math.max(maxCellWidth,measurements.width),maxCellHeight=Math.max(maxCellHeight,measurements.height),"range"===item.type?model.push({text:measurements.lines.join(" "),height:Math.max(measurements.height,MIN_CELL_HEIGHT)*scaling,tipText:item.label,marker:"rect",color:color,isDimensionValue:!0,locked:!1,id:item.id,index:item.index,isMax:item.isMax,type:item.type}):model.push({text:measurements.lines.join(" "),tipText:item.label,height:Math.max(measurements.height,MIN_CELL_HEIGHT)*scaling,marker:item.marker||"rect",color:color,isDimensionValue:!0,locked:!1,id:item.id,index:item.index,cacheItems:cacheMap[item.id],type:item.type})}return cellHeight=maxCellHeight,cellWidth=Math.max(maxCellWidth+MARKER_WIDTH,MIN_CELL_WIDTH),{viewItems:model,cellHeight:cellHeight,cellWidth:cellWidth+PRECISION_ERROR_FIX+2*PADDING}}function prepareContinous(colorItems,style,formatter){var i,model=[],maxTextWidth=0;for(CanvasRenderer.setFont(style.font),i=colorItems.length-1;i>=0;i--){var item=colorItems[i],legendItem={colorFrom:item.grad[0].toHex(),colorTo:item.grad[1].toHex(),maxText:formatter.formatValue(item.max),minText:formatter.formatValue(item.min),max:item.id[0],min:item.id[1]};model.push(legendItem),maxTextWidth=Math.max(maxTextWidth,CanvasRenderer.getTextWidth(legendItem.maxText.substr(0,MAX_LABEL_CHARACTERS)),CanvasRenderer.getTextWidth(legendItem.minText.substr(0,MAX_LABEL_CHARACTERS)));
}return{viewItems:model,labelHeight:CanvasRenderer.getFontHeight(style.font),maxLabelWidth:maxTextWidth}}function prepareTitle(text,style){var maxTextWidth=CanvasRenderer.getAverageLetterWidth(style.font)*MAX_TITLE_CHARACTERS,shape={type:"text",fill:0,opacity:1,shape:{text:text,font:style.font,maxWidth:maxTextWidth,align:"left",baseline:"middle",maxNumLines:2}},measurements=CanvasRenderer.measureTextObject(shape);return{text:measurements.lines.join(" "),fullText:text,height:measurements.height,width:measurements.width+PRECISION_ERROR_FIX}}var MARKER_WIDTH=26,MIN_CELL_HEIGHT=26,MIN_CELL_WIDTH=54,PADDING=4,MAX_NUM_CHARACTERS_PER_ROW=20,MAX_TITLE_CHARACTERS=15,MAX_LABEL_CHARACTERS=10,PRECISION_ERROR_FIX=1,MAX_NUMBER_OF_ITEMS=100;return{prepareDiscreteData:prepareDiscrete,prepareContinousData:prepareContinous,prepareLegendTitle:prepareTitle,Modes:{DISCRETE:"discrete",CONTINOUS:"continous"},constants:{PADDING:PADDING}}}),define("text!objects.views/charts/components/legend/continous-legend.ng.html",[],function(){return'<div class="qv-continous-color-legend"\r\n	 ng-class="cclOrientationClass"\r\n	 ng-style="options.labelStyle">\r\n	<div class="ccl-title"\r\n		 ng-style="options.titleStyle"\r\n		 ng-class="cclOrientationClass">\r\n		<div class="ccl-title-inner"\r\n			 ng-if="options.legendTitle && options.legendTitle.length"\r\n			 title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\r\n	</div>\r\n    <div class="ccl-gradient"\r\n		 ng-class="cclOrientationClass"\r\n         ng-style="options.vertical ? {height: \'calc(100% - \' + options.titleHeight + \'px)\'} : {}"\r\n		 tid="ccl.gradient">\r\n        <div class="ccl-axis" ng-class="cclOrientationClass">\r\n			<div ng-repeat="axisVal in axisValues track by $index" class="ccl-axis-value" ng-class="{\'first\': $first, \'last\':$last}">{{axisVal}}</div>\r\n            <!--\r\n                <div class="ccl-axis-top-value">{{axisValues[1]}}</div>\r\n                <div class="ccl-axis-bottom-value">{{axisValues[0]}}</div>\r\n                -->\r\n        </div>\r\n		<div class="ccl-gradient-color"\r\n			 ng-class="cclOrientationClass"\r\n			 qva-apply-style="cclGradientStyle">\r\n		</div>\r\n		<div class="ccl-range"\r\n			 ng-show="selectionEnabled && !isLocked"\r\n			 ng-style="cclRangeStyle"\r\n			 ng-class="cclOrientationClass">\r\n			<div ng-show="active" class="ccl-range-inner"\r\n				 ng-class="cclOrientationClass"\r\n				 ng-style="rangeStyle">\r\n				<div class="ccl-axis-cover"\r\n					 ng-style="active && cclCoverStyle"\r\n					 tid="ccl.cover"\r\n					 ng-class="{\'active\' : activeOptions.cover}"></div>\r\n				<div class="ccl-far-edge"\r\n					 tid="ccl.edge.far"\r\n					 ng-class="{\'active\' : activeOptions.far}">\r\n				</div>\r\n				<div class="ccl-near-edge"\r\n					 tid="ccl.edge.near"\r\n					 ng-class="{\'active\' : activeOptions.near}">\r\n				</div>\r\n				<div class="ccl-outer-bubble-wrapper"\r\n					 ng-class="active && cclOrientationClass">\r\n					<qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="false" data="values.start" active="activeOptions.near"> </qva-range-selection-bubble>\r\n					<qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="true" data="values.end" active="activeOptions.far"> </qva-range-selection-bubble>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("objects.utils/shapes/point",[],function(){"use strict";function Point(x,y){0===arguments.length?this.set(0,0):this.set(x,y)}return Point.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new Point(this.x,this.y)},set:function(x,y){this.x=x,this.y=y},equal:function(p){return this.x===p.x&&this.y===p.y},closeTo:function(p,d){return p?Math.abs(this.x-p.x)<d&&Math.abs(this.y-p.y)<d:!1},distanceTo:function(point){return point?Math.sqrt(Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2)):NaN}},Point}),define("general.directives/apply-style",["qvangular"],function(qvangular){qvangular.directive("qvaApplyStyle",function(){return{restrict:"A",link:function(scope,element,attr){scope.$watch(attr.qvaApplyStyle,function(newStyles){newStyles&&element.attr("style",element.attr("style")?element.attr("style")+newStyles:newStyles)},!1)}}})}),define("objects.views/charts/components/legend/qv-continous-legend",["touche","qvangular","text!./continous-legend.ng.html","objects.utils/shapes/point","general.directives/apply-style"],function(Touche,qvangular,template,Point){function assembleCssGradient(colors,reverse,vertical){var i,middle,end,lines=vertical?vgl:hgl;if(middle="",end=")",reverse)for(i=colors.length-1;i>0;i--)middle+=", "+colors[i]+" "+100/(colors.length-1)*(colors.length-1-i)+"%";else for(i=0;i<colors.length;i++)middle+=", "+colors[i]+" "+100/(colors.length-1)*i+"%";return"background:"+colors[colors.length/2]+"; background:"+lines.moz+middle+end+"; background:"+lines.webkit+middle+end+"; background:"+lines.opera+middle+end+"; background:"+lines.ie+middle+end+"; background:"+lines.w3c+middle+end}function getTargetPoint(points,grt,dir){return grt?points[0][dir]>points[1][dir]?0:1:points[0][dir]<points[1][dir]?0:1}function isDockedNear(dock){return["left","bottom"].contains(dock)}function checkHandlePointBounds(handlePoints,element,vertical){var relevantSize=vertical?element.height():element.width(),dir=vertical?"y":"x";handlePoints[0][dir]=min(max(handlePoints[0][dir],0),relevantSize),handlePoints[1][dir]=min(max(handlePoints[1][dir],0),relevantSize)}function updatePoints(initials,target,vertical,distance){var arr=[];return vertical?(arr[target]=new Point(initials[target].x,initials[target].y+distance),arr[1^target]=initials[1^target]):(arr[target]=new Point(initials[target].x+distance,initials[target].y),arr[1^target]=initials[1^target]),arr}function getRelevantSize($element,vertical){var axis=$element.find(".ccl-axis");return vertical?axis.width():axis.height()}function updateEdgeDependencies($scope,grt){return{vertical:$scope.options.vertical,direction:$scope.options.vertical?"y":"x",grt:$scope.options.vertical?grt:!grt}}var namespace=".legendRangeSelection",min=Math.min,max=Math.max,vgl={moz:"-moz-linear-gradient(bottom",webkit:"-webkit-linear-gradient(bottom",opera:" -o-linear-gradient(bottom",ie:"-ms-linear-gradient(bottom",w3c:"linear-gradient(to top"},hgl={moz:"-moz-linear-gradient(left",webkit:"-webkit-linear-gradient(left",opera:" -o-linear-gradient(left",ie:"-ms-linear-gradient(left",w3c:"linear-gradient(to right"};qvangular.directive("qvContinousLegend",function(){return{template:template,replace:!0,scope:!0,link:function($scope,$element){function getValueLabel(position){if($scope.positionToFormattedValue&&position){var size,scaledPos;return $scope.options.vertical?(size=elements.rangeElement.height(),scaledPos=1-position.y/size):(size=elements.rangeElement.width(),scaledPos=position.x/size),$scope.positionToFormattedValue(scaledPos)}return position+""}function on(){if(!isOn){isOn=!0;var startPoint,initialPoints="hey";Touche(elements.gradient[0]).swipe({id:namespace,options:{preventDefault:!0},start:function(e,data){if($scope.selectionEnabled){var point=data.pagePoints[0];startPoint=transformPoint(point.x,point.y),Touche.preventGestures(this.gestureHandler),onStart()}},update:function(e,data){if($scope.selectionEnabled){$scope.active=!0,$scope.swiping=!0;var point=data.pagePoints[0];$scope.handlePoints=[startPoint,transformPoint(point.x,point.y)],$scope.updateHandlePoints($scope.handlePoints),$scope.$digest()}},end:function(){$scope.selectionEnabled&&($scope.swiping=!1,onEnd())}}),Touche(elements.axisCover[0]).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{preventDefault:!0},start:function(){initialPoints=$scope.handlePoints,Touche.preventGestures(this.gestureHandler),onStart(),$scope.activeOptions.cover=!0},update:function(e,data){var deltaY=$scope.options.vertical?data.swipe.deltaY:0,deltaX=$scope.options.vertical?0:data.swipe.deltaX;$scope.handlePoints=[new Point(initialPoints[0].x+deltaX,initialPoints[0].y+deltaY),new Point(initialPoints[1].x+deltaX,initialPoints[1].y+deltaY)],$scope.updateHandlePoints($scope.handlePoints),$scope.$digest()},end:function(){onEnd(),$scope.activeOptions.cover=!1}}),Touche.utils.touch||(attachEdgeEvent(elements.farEdge[0],!1),attachEdgeEvent(elements.nearEdge[0],!0)),$scope.$broadcast("on")}}function attachEdgeEvent(targetElement,grt){var initialPoints,targetPoint,id,edgeDependecies=updateEdgeDependencies($scope,grt);Touche(targetElement).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{radiusThreshold:0},start:function(){edgeDependecies=updateEdgeDependencies($scope,grt),targetPoint=getTargetPoint($scope.handlePoints,edgeDependecies.grt,edgeDependecies.direction),initialPoints=$scope.handlePoints,Touche.preventGestures(this.gestureHandler),onStart($scope)},update:function(e,data){$scope.handlePoints=updatePoints(initialPoints,targetPoint,edgeDependecies.vertical,edgeDependecies.vertical?data.swipe.deltaY:data.swipe.deltaX),$scope.updateHandlePoints($scope.handlePoints),$scope.activeOptions.near=$scope.activeOptions.far=!1,id=getTargetPoint($scope.handlePoints,edgeDependecies.grt,edgeDependecies.direction)?"far":"near",$scope.activeOptions[id]=!0,$scope.$digest()},end:function(){onEnd($scope.handlePoints),$scope.activeOptions.near=$scope.activeOptions.far=!1,$scope.$digest()}})}function off(){$scope.active=!1,Object.keys(elements).forEach(function(key){Touche(elements[key][0]).off("*",namespace)}),isOn=!1,$scope.$broadcast("off")}function onStart(){$scope.$emit("rangeStart")}function onUpdate(points,valueInfo){$scope.$emit("rangeUpdate",points,$scope.options.vertical?elements.rangeElement.height():elements.rangeElement.width(),valueInfo)}function onEnd(){var points;$scope.options.vertical&&$scope.handlePoints[0].y<$scope.handlePoints[1].y?(points=[],points[1]=$scope.handlePoints[0],points[0]=$scope.handlePoints[1],$scope.handlePoints=points):!$scope.options.vertical&&$scope.handlePoints[0].x>$scope.handlePoints[1].x&&(points=[],points[1]=$scope.handlePoints[0],points[0]=$scope.handlePoints[1],$scope.handlePoints=points),$scope.$emit("rangeEnd")}function transformPoint(pageX,pageY){var offset=elements.rangeElement.offset();return new Point(pageX-offset.left,pageY-offset.top)}function setBubbleEdgeShift(vertical,dockNear,handleNear){elements.nearBubbleWrapper||(elements.nearBubbleWrapper=$element.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near"),elements.nearBubble=$element.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near .bubble"),elements.farBubbleWrapper=$element.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far"),elements.farBubble=$element.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far .bubble")),elements.nearBubbleWrapper.css($scope.cclBubbleNearStyle),elements.farBubbleWrapper.css($scope.cclBubbleFarStyle);var edgeShift=getBubbleEdgeShift(vertical,handleNear);edgeShift=edgeShift>0?edgeShift:0,handleNear?elements.nearBubble.css({"margin-left":Math.round(edgeShift)+"px"}):elements.farBubble.css({"margin-right":Math.round(edgeShift)+"px"})}function getBubbleEdgeShift(vertical,handleNear){return vertical?0:handleNear?$element.offset().left-(elements.nearBubbleWrapper.offset().left-.5*elements.nearBubbleWrapper.width()-5):elements.farBubbleWrapper.offset().left-$element.offset().left+1.5*elements.farBubbleWrapper.width()+5-$element.width()}var isOn=!1,elements={gradient:$element.find(".ccl-gradient"),rangeElement:$element.find(".ccl-range"),rangeInner:$element.find(".ccl-range-inner"),axisCover:$element.find(".ccl-axis-cover"),nearEdge:$element.find(".ccl-near-edge"),farEdge:$element.find(".ccl-far-edge")};$scope.fakeAxis={getPositionOfValue:function(value){var minValue=$scope.viewItems[0].min,maxValue=$scope.viewItems[$scope.viewItems.length-1].max,normalizedValue=(value-minValue)/(maxValue-minValue),size=$scope.options.vertical?elements.rangeElement.height():elements.rangeElement.width();return $scope.options.vertical&&(normalizedValue=1-normalizedValue),normalizedValue*size},isDiscrete:function(){return!1}},$scope.activeOptions={far:!1,near:!1,cover:!1},$scope.values={start:{},end:{}},$scope.setRangeStyle=function(handlePoints){if(handlePoints&&2===handlePoints.length){$scope.relevantSize=getRelevantSize($element,$scope.options.vertical);var start=handlePoints[0],end=handlePoints[1],dir=$scope.options.vertical?"y":"x";$scope.options.vertical?$scope.rangeStyle={height:Math.abs(start[dir]-end[dir]),top:Math.min(start[dir],end[dir])}:$scope.rangeStyle={width:Math.abs(start[dir]-end[dir]),left:Math.min(start[dir],end[dir])}}},$scope.updateHandleValues=function(handlePoints,valueInfo){if(checkHandlePointBounds(handlePoints,elements.rangeElement,$scope.options.vertical),$scope.setRangeStyle(handlePoints),$scope.active){var dir=$scope.options.vertical?"y":"x",size=$scope.options.vertical?elements.rangeElement.height():elements.rangeElement.width(),startPoint=handlePoints[getTargetPoint($scope.handlePoints,$scope.options.vertical,dir)],endPoint=handlePoints[getTargetPoint($scope.handlePoints,!$scope.options.vertical,dir)];if($scope.values.start.text=$scope.cclNearValueLabel=getValueLabel(startPoint),$scope.values.end.text=$scope.cclFarValueLabel=getValueLabel(endPoint),valueInfo){if(valueInfo["switch"]){var temp=$scope.values.start.value;$scope.values.start.value=$scope.values.end.value,$scope.values.end.value=temp}0===valueInfo.index?$scope.values.start.value=valueInfo.value:$scope.values.end.value=valueInfo.value}else $scope.options.vertical?($scope.values.start.value=$scope.positionToValue((size-startPoint[dir])/size),$scope.values.end.value=$scope.positionToValue((size-endPoint[dir])/size)):($scope.values.start.value=$scope.positionToValue(startPoint[dir]/size),$scope.values.end.value=$scope.positionToValue(endPoint[dir]/size))}if($scope.active&&$scope.options){var dockNear=isDockedNear($scope.options.dock);setBubbleEdgeShift($scope.options.vertical,dockNear,!1),setBubbleEdgeShift($scope.options.vertical,dockNear,!0)}},$scope.updateHandlePoints=function(handlePoints){handlePoints&&($scope.updateHandleValues(handlePoints),onUpdate($scope.handlePoints))},$scope.$on("rangeUpdate",function($event,points,size,valueInfo){isNaN(size)&&($scope.handlePoints=[points[0],points[1]],$scope.updateHandleValues($scope.handlePoints,valueInfo),$scope.$digest(),onUpdate(points,valueInfo),$event.stopPropagation())}),$scope.$watchCollection("[viewItems, options.reverse, options.vertical]",function(newValues){var items=newValues[0],reverse=newValues[1],vertical=newValues[2];if(items&&items.length){for(var colors=[items[0].colorTo],i=0;i<items.length;i++)colors.push(items[i].colorFrom);if($scope.cclGradientStyle=assembleCssGradient(colors,reverse,vertical),$scope.positionToFormattedValue){var axisValues=[items[0].minText,items[items.length-1].maxText];(reverse?!vertical:vertical)&&axisValues.reverse(),$scope.axisValues=axisValues}}}),$scope.$watchCollection("[options.vertical, options.dock, relevantSize]",function(newValues){var vertical=newValues[0],dockNear=isDockedNear(newValues[1]),relevantSize=newValues[2];$scope.cclOrientationClass={vertical:vertical,horizontal:!vertical,near:dockNear,far:!dockNear},dockNear?($scope.cclCoverStyle=vertical?{left:"0px",width:relevantSize+"px"}:{bottom:"0px",height:relevantSize+"px"},$scope.cclBubbleNearStyle=vertical?{}:{bottom:"0px",right:""},$scope.cclBubbleFarStyle=vertical?{}:{bottom:"0px",right:""}):($scope.cclCoverStyle=vertical?{right:"0px",width:relevantSize+"px"}:{top:"0px",height:relevantSize+"px"},$scope.cclBubbleNearStyle=vertical?{right:"0px",bottom:""}:{},$scope.cclBubbleFarStyle=vertical?{right:"0px",bottom:""}:{})}),on.call(this),$scope.$watch("selectionEnabled",function(value){value?on.call():off.call()}),$scope.$on("$destroy",function(){off.call()}),$scope.$on("cancelSelection",function(){$scope.active=!1})}}})}),define("text!objects.views/charts/components/legend/discrete-legend.ng.html",[],function(){return'<div class="qv-discrete-color-legend"\r\n	 ng-class="{ \'vertical\': options.vertical }"\r\n	 ng-style="options.labelStyle">\r\n	<div class="dcl-title"\r\n		 ng-if="options.legendTitle && options.legendTitle.length"\r\n		 ng-style="options.titleStyle"\r\n		 ng-class="{\'vertical\': options.vertical }">\r\n		<div class="dcl-title-inner" title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\r\n	</div>\r\n	<div class="dcl-flex" ng-class="{\'align\': align, \'vertical\': options.vertical, \'in-selections\': selectionsApi.active }"\r\n		 qv-selections-toggle-dimension-value="{ selector: \'.color-item\', itemKey: \'item\' }"\r\n		 qv-selections-on-toggle-dimension-value="selectionEnabled && !isScrolling && select($event, item)">\r\n		<div ng-repeat="item in viewItems track by $index"\r\n			 ng-style="{\'height\':item.height,  \'width\': options.cellWidth}"\r\n			 class="color-item" ng-class="{\'selected\': item.selected}"\r\n			 tid="dcl.item">\r\n			<div class="marker">\r\n				<div ng-style="item.markerClass[\'glyph-triangle\']  ? {\'border-bottom-color\': item.color} : ( item.markerClass[\'glyph-inverse-triangle\'] ? {\'border-top-color\': item.color} : {background: item.color} )" ng-class="item.markerClass"></div>\r\n			</div>\r\n			<div class="text"\r\n				 title="{{item.tipText}}">{{item.text}}</div>\r\n		</div>\r\n	</div>\r\n	<div class="dcl-buttons-v" ng-show="options.vertical && overflow">\r\n		<!--DOWN-->\r\n		<button class="dcl-down qui-plainbuttonicon" data-icon="S" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.down"></button>\r\n		<!--UP-->\r\n		<button class="dcl-up qui-plainbuttonicon" data-icon="R" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.up"></button>\r\n	</div>\r\n	<div class="dcl-buttons-h" ng-show="!options.vertical && overflow">\r\n		<!--RIGHT-->\r\n		<button class="dcl-right qui-plainbuttonicon" data-icon="U" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.right"></button>\r\n		<!--LEFT-->\r\n		<button class="dcl-left qui-plainbuttonicon" data-icon="T" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.left"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.utils/event-utils",["qvangular","touche"],function(qvangular){"use strict";function cancelGestures(handler,exception){handler.gestures.forEach(function(gesture){gesture!==exception&&handler.cancelGesture(gesture)})}function getMouseWheelData(orgEvent){var delta=0,deltaX=0,deltaY=0,divider=60;return orgEvent.wheelDelta&&(delta=orgEvent.wheelDelta/divider),orgEvent.detail&&(delta=-orgEvent.detail/3),deltaY=delta,void 0!==orgEvent.axis&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaY=0,deltaX=-1*delta),void 0!==orgEvent.wheelDeltaY&&(deltaY=orgEvent.wheelDeltaY/divider),void 0!==orgEvent.wheelDeltaX&&(deltaX=-1*orgEvent.wheelDeltaX/divider),{delta:delta,deltaX:deltaX,deltaY:deltaY,x:orgEvent.pageX,y:orgEvent.pageY}}function throttle(fn,threshold,scope){var prev,dTimer;return function(){var context=scope||this,now=+new Date,args=arguments;prev&&prev+threshold>now?(clearTimeout(dTimer),dTimer=setTimeout(function(){prev=now,fn.apply(context,args)},threshold)):(prev=now,fn.apply(context,args))}}function debounce(fn,delay){return function(){var context=this,args=arguments;clearTimeout(timer),timer=setTimeout(function(){fn.apply(context,args)},delay)}}function showLockedFeedback(dimensions){dimensions&&(dimensions=dimensions.map(function(item){return item.qGroupFieldDefs?item.qGroupFieldDefs[item.qGroupPos||0]:item.qFallbackTitle}),qvangular.$rootScope.$broadcast("locked-feedback",[dimensions]),debounce(function(){qvangular.$rootScope.$broadcast("locked-feedback",[dimensions,!0])},100)())}var WheelSwipe=Touche.Gesture.augment(function(Gesture){function WheelSwipe(){Gesture.apply(this,arguments)}return this.defaults={which:2,radiusThreshold:3},this.start=function(event,data){Touche.utils.touch||Touche.utils.msPointer&&event.pointerType!==event.MSPOINTER_TYPE_MOUSE||this.isValidMouseButton(event,this.options.which)&&(this.initiated=!0,data.startPoint=data.points[0],this.binder.start.call(this,event,data))},this.update=function(event,data){!this.started&&data.startPoint&&data.startPoint.distanceTo(data.points[0])>=this.options.radiusThreshold?(this.started=!0,this.binder.update.call(this,event,data)):this.started&&this.binder.update.call(this,event,data)},this.end=function(event,data){this.initiated&&(this.binder.end.call(this,event,data),this.initiated=!1)},WheelSwipe});Touche.gestures.add("wheelswipe",WheelSwipe);var timer=null;return{getMouseWheelData:getMouseWheelData,cancelGestures:cancelGestures,throttle:throttle,debounce:debounce,showLockedFeedback:showLockedFeedback}}),define("objects.grid/directives/selections",["qvangular","jquery","touche"],function(qvangular,$,Touche){"use strict";qvangular.directive("qvSelectionsToggleValue",["$parse",function($parse){return{restrict:"A",link:function($scope,$element,$attrs){var options=$parse($attrs.qvSelectionsToggleValue)(),selector=options.selector,namespace="."+$scope.$id+"-toggle-value",itemKey=options.itemKey||"cell";$element.on("qv-activate"+namespace,selector,function(e){var $cell=$(e.target).closest(selector),cell=$cell.scope()[itemKey];$cell.length&&cell&&$scope.$apply(function(){var locals={$event:e};locals[itemKey]=cell,$scope.$eval($attrs.qvSelectionsOnToggleValue,locals)})}),$scope.$on("$destroy",function(){$element.off(namespace)})}}}]),qvangular.directive("qvSelectionsToggleDimensionValue",["$parse",function($parse){return{restrict:"A",link:function($scope,$element,$attrs){var options=$parse($attrs.qvSelectionsToggleDimensionValue)(),selector=options.selector,namespace="."+$scope.$id+"-toggle-dimension-value",itemKey=options.itemKey||"cell";$element.on("qv-activate"+namespace,selector,function(e){var $cell=$(e.target).closest(selector),cell=$cell.scope()[itemKey];if(!$scope.$eval($attrs.qvSelectionsExcludeToggleDimensionValue,{$event:e})&&cell&&cell.isDimensionValue)return cell.locked?void $scope.$eval($attrs.qvSelectionsSelectWhileLocked):void $scope.$apply(function(){var locals={$event:e};locals[itemKey]=cell,$scope.$eval($attrs.qvSelectionsOnToggleDimensionValue,locals)})}),$scope.$on("$destroy",function(){$element.off(namespace)})}}}]),qvangular.directive("qvSelectionsMultiselect",["$parse",function($parse){return{restrict:"A",controller:function(){},link:function($scope,$element,$attrs,ctrl){function bindMultiselect(){return Touche($element[0]).tap({id:namespaceMultiselect,options:{preventDefault:!1},start:function(e){$startElem=$(e.target).closest(selector)}}),Touche($element[0]).swipe({id:namespaceMultiselect,options:{radiusThreshold:4,preventDefault:!1},start:function(e){var cell,locals;return Touche.utils.isMouse(e)&&$startElem.length?(cell=$startElem.scope()[itemKey],cell.isDimensionValue?cell.locked?($scope.$eval($attrs.qvSelectionsSelectWhileLocked),void this.cancel()):(start=cell,locals={$event:e},locals[itemKey]=cell,void $scope.$apply($scope.$eval($attrs.qvSelectionsStartMultiselect,locals))):void this.cancel()):void this.cancel()},update:function(e){var cell,$cell=$(e.target).closest(selector);$cell.length&&(cell=$cell.scope()[itemKey],$scope.$apply($scope.$eval($attrs.qvSelectionsUpdateMultiselect,{start:start,current:cell,dataColIx:cell.dataColIx})))},end:function(e){$scope.$apply($scope.$eval($attrs.qvSelectionsEndMultiselect,{$event:e}))}}),function(){Touche($element[0]).off("*",namespaceMultiselect)}}function bind2FingerMultiselect(){return Touche($element[0]).tap({id:namespace2FingerMultiselect,options:{touches:2,preventDefault:!1},end:function(e,data){var locals,p1=data.pagePoints[0],p2=data.pagePoints[1],$e1=$(document.elementFromPoint(p1.x,p1.y)),$e2=$(document.elementFromPoint(p2.x,p2.y)),c1=$e1.closest(selector).scope()[itemKey],c2=$e2.closest(selector).scope()[itemKey];if(c1.isDimensionValue&&c2.isDimensionValue)return c1.locked||c2.locked?void $scope.$eval($attrs.qvSelectionsSelectWhileLocked):void $scope.$apply(function(){locals={offsetLeft:$e1[0].offsetLeft,width:$e1[0].clientWidth,$event:e},locals[itemKey]=c1,$scope.$eval($attrs.qvSelectionsStartMultiselect,locals),$scope.$eval($attrs.qvSelectionsUpdateMultiselect,{start:c1,current:c2,dataColIx:c1.dataColIx}),$scope.$eval($attrs.qvSelectionsEndMultiselect,{$event:e})})}}),function(){Touche($element[0]).off("*",namespace2FingerMultiselect)}}var unbindMultiselect,unbind2FingerMultiselect,$startElem,start,options=$parse($attrs.qvSelectionsMultiselect)(),selector=options.selector,itemKey=options.itemKey||"cell",namespaceMultiselect=$scope.$id+"-multiselect",namespace2FingerMultiselect=$scope.$id+"-2finger-multiselect";ctrl.on=function(){unbindMultiselect||(unbindMultiselect=bindMultiselect()),unbind2FingerMultiselect||(unbind2FingerMultiselect=bind2FingerMultiselect())},ctrl.off=function(){unbindMultiselect&&(unbindMultiselect(),unbindMultiselect=void 0),unbind2FingerMultiselect&&(unbind2FingerMultiselect(),unbind2FingerMultiselect=void 0)},$scope.$watch("interactive",function(interactive){void 0!==interactive&&(interactive?ctrl.on():ctrl.off())}),$scope.$on("$destroy",function(){ctrl.off()})}}}])}),define("objects.views/charts/components/legend/qv-discrete-legend",["assets/qvangular/qvangular-core","text!./discrete-legend.ng.html","touche","objects.utils/event-utils","objects.grid/directives/selections"],function(qvangular,template,Touche,EventUtils){var VERTICAL_SCROLL_SPEED=5,HORIZONTAL_SCROLL_SPEED=10,namespace=".discretelegend";qvangular.directive("qvDiscreteLegend",function(){return{template:template,replace:!0,scope:!0,link:function($scope,$element){function findItemPosition(index,vertical){var item,viewItems=$scope.viewItems,position=0,i=0;if(vertical)for(;i!==index&&i<viewItems.length;)item=viewItems[i],position+=item.height,i++;else position=index*$scope.options.cellWidth;return position}function getScrollPos(){return $scope.options.vertical?scrollContent.scrollTop():scrollContent.scrollLeft()}function shiftScrollPos(diff){setScrollPos(getScrollPos()+diff)}function setScrollPos(pos){$scope.options.vertical?scrollContent.scrollTop(pos):scrollContent.scrollLeft(pos)}function updateButtons(){var pos=getScrollPos();$scope.scrollAtStart=0>=pos,$scope.options.vertical?$scope.scrollAtEnd=pos+scrollContent.height()>=scrollContent[0].scrollHeight:$scope.scrollAtEnd=pos+scrollContent.width()>=scrollContent[0].scrollWidth,$scope.$digest()}function findClosestItemPosition(originalPos,vertical){var viewItems=$scope.viewItems,item=viewItems[0],position=0,i=0;if(originalPos=Math.max(0,originalPos),vertical){for(;originalPos>position&&i<viewItems.length;)item=viewItems[i],position+=item.height,i++;originalPos+scrollContent.height()>=scrollContent[0].scrollHeight?position=originalPos:Math.abs(originalPos-position)>Math.abs(originalPos-(position-item.height))&&(i--,position-=item.height)}else position=Math.round(originalPos/$scope.options.cellWidth)*$scope.options.cellWidth,i=Math.round(originalPos/$scope.options.cellWidth),originalPos+scrollContent.width()>=scrollContent[0].scrollWidth&&(position=originalPos,i++);return{position:position,index:i}}function snapToPosition(vertical,animate,offset){offset=offset||0;var pos=getScrollPos(),target=findClosestItemPosition(pos+offset,vertical);target.position!==pos&&(vertical?scrollContent.animate({scrollTop:target.position+"px"},animate?200:0):scrollContent.animate({scrollLeft:target.position+"px"},animate?200:0)),$scope.$emit("scrollPositionChanged",target.index)}function setupInteraction(selector,dir,vertical){var longTapInProgress=!1,$target=$element.find(selector).first();Touche($element.find(selector)[0]).longtap({id:namespace,options:{timeThreshold:1e4},update:function(event,data){data.percentage>2&&$scope.interactionEnabled&&(buttonClickHandler(dir*(vertical?VERTICAL_SCROLL_SPEED:HORIZONTAL_SCROLL_SPEED)),longTapInProgress=!0,$target.addClass("qui-active"),Touche.preventGestures(this.gestureHandler))},end:function(){longTapInProgress=!1,$target.removeClass("qui-active"),Touche.preventGestures(this.gestureHandler),updateButtons()},cancel:function(){$target.removeClass("qui-active"),Touche.preventGestures(this.gestureHandler)}}).tap({end:function(){$scope.interactionEnabled&&(longTapInProgress?(snapToPosition(vertical,!0),updateButtons()):(buttonClickHandler(dir*(vertical?$scope.options.cellHeight:$scope.options.cellWidth)),snapToPosition(vertical,!1),updateButtons()),longTapInProgress=!1)}})}function buttonClickHandler(data){shiftScrollPos(data)}function on($element,$scope){var startScrollPos=null,scrollFunc=EventUtils.throttle(function(e){if($scope.interactionEnabled){var scrollValue,event=EventUtils.getMouseWheelData(e.originalEvent);scrollValue=(event.delta>0?-1:1)*($scope.options.vertical?$scope.options.cellHeight:$scope.options.cellWidth),snapToPosition($scope.options.vertical,!1,scrollValue),updateButtons()}},20);scrollContent.on("mousewheel"+namespace+" DOMMouseScroll"+namespace,function(e){scrollFunc(e),e.preventDefault()}),setupInteraction(".dcl-up",-1,!0),setupInteraction(".dcl-down",1,!0),setupInteraction(".dcl-left",-1,!1),setupInteraction(".dcl-right",1,!1),Touche(scrollContent[0]).swipe({options:{useMomentum:!0,inertia:.7,preventDefault:!0},start:function(e){$scope.interactionEnabled&&(startScrollPos=getScrollPos(),$scope.isScrolling=!0,Touche.preventGestures(this.gestureHandler),e.preventDefault())},update:function(e,data){if(null!==startScrollPos&&data.swipe){var d=data.swipe.distance;$scope.options.vertical?"up"===data.swipe.direction?setScrollPos(startScrollPos-d):"down"===data.swipe.direction&&setScrollPos(startScrollPos+d):"left"===data.swipe.direction?setScrollPos(startScrollPos-d):"right"===data.swipe.direction&&setScrollPos(startScrollPos+d)}},end:function(){null!==startScrollPos&&(snapToPosition($scope.options.vertical,!0),updateButtons(),$scope.isScrolling=!1,startScrollPos=null)}})}function off($element){Touche($element.find(".dcl-up").off("*",namespace)),Touche($element.find(".dcl-down").off("*",namespace)),Touche($element.find(".dcl-left").off("*",namespace)),Touche($element.find(".dcl-right").off("*",namespace))}var scrollContent=$element.find(".dcl-flex");$scope.$watch("viewItems",function(viewItems){viewItems.forEach(function(item){for(var ret={},markers=Array.isArray(item.marker)?item.marker:[item.marker],i=0;i<markers.length;i++)switch(markers[i]){case"line":ret["glyph-line"]=!0;break;case"triangle":ret["glyph-triangle"]=!0;break;case"inverse-triangle":ret["glyph-inverse-triangle"]=!0;break;case"diamond":ret["glyph-diamond"]=!0;break;case"circle":ret["glyph-circle"]=!0;break;case"rect":default:ret["glyph-rect"]=!0}item.markerClass=ret})}),$scope.$on("clearSelection",function(){if($scope.viewItems){$scope.selectedValues=[];for(var i=0;i<$scope.viewItems.length;i++){var item=$scope.viewItems[i];item.selected=!1}}}),$scope.$on("invalidateSelections",function(){if($scope.viewItems){$scope.selectedValues=[];for(var i=0;i<$scope.viewItems.length;i++){var item=$scope.viewItems[i];"dimension"===item.type&&item.cacheItems&&item.cacheItems[0]&&(item.selected=item.cacheItems[0].selected)}}$scope.$digest()}),$scope.select=function($event,item){"range"===item.type&&(item.selected=!item.selected),$scope.$emit("toggleSelect",$event,[item])},$scope.$on("$destroy",function(){off($element)}),$scope.$watch("explicitScrollPosition",function(value){$scope.explicitScrollPosition=value}),$scope.$on("updateSize",function(){if(updateButtons(),void 0!==$scope.explicitScrollPosition){var position=findItemPosition($scope.explicitScrollPosition,$scope.options.vertical);$scope.options.vertical?scrollContent.scrollTop(position):scrollContent.scrollLeft(position)}}),on($element,$scope)}}})}),define("objects.views/charts/components/legend/color-legend",["jquery","objects.views/charts/chart-style-service","../chart-component-angular","text!./color-legend.ng.html","./legend-data","client.utils/state","./qv-continous-legend","./qv-discrete-legend"],function($,ChartStyleService,ChartComponentAngular,template,LegendData,state){
function canBeActivated(options){return state.state===state.States.analysis||state.state===state.States.play&&(!options.backendApi||!options.backendApi.isSnapshot)}function updateStyles(styleService,fontScale){var localStyle={backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),label:{font:styleService.getFont(chartID,"label"),lineHeight:"1em"},scaledLabel:{font:styleService.getFont(chartID,"label",null,null,null,fontScale),color:styleService.getValue(chartID,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:styleService.getFont(chartID,"title"),lineHeight:"1em"},scaledTitle:{font:styleService.getFont(chartID,"title",null,null,null,fontScale),color:styleService.getValue(chartID,"title","color"),lineHeight:"1em"}};return localStyle}function calculateHorizontalLegendMetrics(rect,legendMetrics,titleMetrics){var metrics={};return metrics.maxItemsPerRow=Math.floor((rect.width-(titleMetrics.show?titleMetrics.width:0))/legendMetrics.cellWidth),metrics.numRows=Math.ceil(legendMetrics.viewItems.length/metrics.maxItemsPerRow),metrics.itemsPerRow=Math.ceil(legendMetrics.viewItems.length/metrics.numRows),metrics.w=metrics.itemsPerRow*legendMetrics.cellWidth,metrics.h=Math.ceil(Math.max(titleMetrics.height,Math.min(legendMetrics.cellHeight*MAX_NUM_DISCRETE_ROWS,metrics.numRows*legendMetrics.cellHeight))),metrics}function clearScope($scope){$scope.visible=!1,$scope.discreteItems=null,$scope.continousItems=null,this._titleMetrics=null,this._legendMetrics=null}function hasRelevantColorMode(mode){return mode&&"primary"!==mode.colorMode}function getGradientSize(titleMetrics,legendMetrics,vertical){return vertical?Math.max(titleMetrics.width,legendMetrics.maxLabelWidth+GRADIENT_SIZE):Math.max(legendMetrics.labelHeight+GRADIENT_SIZE,titleMetrics.height)}function getRangeValues(points,size,vertical,viewItems){var min,max,minValue=viewItems[0].min,maxValue=viewItems[viewItems.length-1].max,span=maxValue-minValue;return vertical?(min=1-Math.max(points[0].y,points[1].y)/size,max=1-Math.min(points[0].y,points[1].y)/size):(min=Math.min(points[0].x,points[1].x)/size,max=Math.max(points[0].x,points[1].x)/size),min=0===min?minValue:min*span+minValue,max=1===max?maxValue:max*span+minValue,{startVal:min,updateVal:max,isMax:!0}}function getRangeValue(point,viewItems){var val,minValue=viewItems[0].min,maxValue=viewItems[viewItems.length-1].max,span=maxValue-minValue;return val=0===point?minValue:1===point?maxValue:point*span+minValue}function getDiscreetRangeValues(viewItems,selectedItems){for(var item,ret=[],i=0;i<selectedItems.length;i++)item=selectedItems[i],ret.push({startVal:item.id[0],updateVal:item.id[1],isMax:item.isMax});return ret}function selectionsAvailable(mode){return!("measure"===mode.colorMode&&"item"===mode.boxType)}function getEmptyFormatter(){return{prepare:function(){},formatValue:function(v){return v}}}var ColorLegend,chartID="legend",MAX_NUM_DISCRETE_ROWS=2,MIN_VERTICAL_PADDING=12,GRADIENT_SIZE=48;return ColorLegend=ChartComponentAngular.extend("ColorLegend",{init:function(){var mainArguments=Array.prototype.slice.call(arguments);mainArguments.push(template),this._super.apply(this,mainArguments),this._styleService=ChartStyleService.getInstance(),this._nrEditing=0,this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={},this.$scope.options={};var self=this;this.$scope.$on("toggleSelect",function($event,e,items){if(selectionsAvailable(self._mode)){if("range"===self._mode.boxType){self.selections.rangeStart();var rangeValues=getDiscreetRangeValues(self.$scope.viewItems,items);self.selections.rangeUpdate(rangeValues,!0),self.selections.rangeEnd()}else{var i,cacheItems=[],l=items.length;for(i=0;l>i;i++)cacheItems=cacheItems.concat(items[i].cacheItems);self.selections.updateFromItems(e,cacheItems)}$event.preventDefault()}}),this.$scope.$on("rangeStart",function($event){self._formatter=self._colorMap._measureFormatters[0]||getEmptyFormatter(),self._formatter.prepare(),self.selections&&self.selections.rangeStart(),$event.preventDefault()}),this.$scope.$on("rangeUpdate",function($event,points,size,valueInfo){var rangeValues=getRangeValues(points,size,self.isVertical(),self.$scope.viewItems);valueInfo&&(0===valueInfo.index?rangeValues.startVal=valueInfo.value:rangeValues.updateVal=valueInfo.value),self.selections&&self.selections.rangeUpdate([rangeValues]),$event.preventDefault()}),this.$scope.$on("rangeEnd",function($event){self.selections&&self.selections.rangeEnd(),$event.preventDefault()}),this.$scope.$on("rangeEditChanged",function($event,editing){self._nrEditing=editing?self._nrEditing+1:self._nrEditing-1,self._nrEditing>1&&(self.selections.confirmEdit(),self._nrEditing=1,$event.targetScope.onEditBubble()),self._editing=self._nrEditing>0,self.selections.setIsEditing(self._editing,self.$scope)}),this.$scope.$on("scrollPositionChanged",function($event,pos){self._scrollPosition=pos}),this.formatValue=function(value){return self._formatter.formatValue(value)},this.$scope.positionToFormattedValue=function(position){return self.formatValue(getRangeValue(position,self.$scope.viewItems))},this.$scope.positionToValue=function(position){return getRangeValue(position,self.$scope.viewItems)}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMap:function(c){this._colorMap=c,this.invalidateProperties("Legend.setColorMap"),this.invalidateDisplay("Legend.setColorMap")},getColorMap:function(){return this._colorMap},getSelectionIndices:function(){return this._colorMap.getSelectionIndices()},setData:function(data){this._super(data),this._dataInvalid=!0},setSelectableShapes:function(cacheItems){this._super(cacheItems),this._dataInvalid=!0,this.invalidateProperties("Legend.setSelectableShapes")},isVisible:function(layoutMode){return this._super(layoutMode)&&hasRelevantColorMode(this._mode)&&this._data&&this._data.qHyperCube&&!this._data.qHyperCube.isReduced},setHasValidData:function(b){this._super(b),b||(this.clear(),clearScope(this.$scope))},updateSize:function(){this._super(),this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this._colorMap||!this._data||!this._data.qHyperCube||this._data.qHyperCube.isReduced||!this._data.legend)return void clearScope(this.$scope);var numDims,colorItems=this._colorMap.getColorMapping().concat(),style=updateStyles(this._styleService,this.chartScale),modes=this._colorMap.getLegendMode();return this._mode={legend:"scale"!==modes[0]?LegendData.Modes.DISCRETE:LegendData.Modes.CONTINOUS,boxType:modes[1],colorMode:modes[2],selectionEnabled:!modes[3],showTitle:this._data.legend.showTitle},this.isVisible()?(this.$scope.visible=!0,this.$scope.selectionEnabled=!this.options._disableSelections&&this._mode.selectionEnabled&&canBeActivated(this.options)&&!!this.selections,this.$scope.interactionEnabled=canBeActivated(this.options),this._mode.showTitle?(this._titleMetrics=LegendData.prepareLegendTitle(this._colorMap.getLegendTitle(),style.title),this._titleMetrics.show=this._mode.showTitle):this._titleMetrics={show:!1,width:0,height:0},this._mode.legend===LegendData.Modes.DISCRETE?(numDims=this._data.qHyperCube?this._data.qHyperCube.qDimensionInfo.length:1,this._legendMetrics=LegendData.prepareDiscreteData(colorItems,this._selectableShapes,style.label,this.rect.width-(this._mode.showTitle&&this.isHorizontal()?this._titleMetrics.width:0),this.chartScale,numDims-this._colorMap.getDimensionIndex()[0]-1),this.$scope.viewItems=this._legendMetrics.viewItems):(this._formatter=this._colorMap._measureFormatters[0]||getEmptyFormatter(),this._formatter.prepare(),this._legendMetrics=LegendData.prepareContinousData(colorItems,style.label,this._formatter),this.$scope.viewItems=this._legendMetrics.viewItems),this.isHorizontal()?(this._horizontalMetrics=calculateHorizontalLegendMetrics(this.rect,this._legendMetrics,this._titleMetrics),this.$scope.align=this._horizontalMetrics.numRows>=MAX_NUM_DISCRETE_ROWS,this.$scope.overflow=this._horizontalMetrics.numRows>MAX_NUM_DISCRETE_ROWS):this.$scope.overflow=this._legendMetrics.cellHeight*this._legendMetrics.viewItems.length>this.rect.height,this.$scope.discrete=this._mode.legend===LegendData.Modes.DISCRETE,this.$scope.options.vertical=this.isVertical(),this.$scope.options.labelStyle=style.scaledLabel,this.$scope.options.titleStyle=$.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},style.scaledTitle),this.$scope.options.titleHeight=(Math.max(this._titleMetrics.height,MIN_VERTICAL_PADDING)+MIN_VERTICAL_PADDING)*this.chartScale,this.$scope.options.legendTitle=this._titleMetrics.show?this._titleMetrics.text:null,this.$scope.options.legendTitleTooltip=this._titleMetrics.fullText,this.$scope.options.cellWidth=Math.ceil(this._legendMetrics.cellWidth*this.chartScale),this.$scope.options.cellHeight=Math.ceil(this._legendMetrics.cellHeight*this.chartScale),this.$scope.options.reverse=this._data.legend.reverse,this.$scope.options.dock=this.dock,void(this._dataInvalid=!1)):void clearScope(this.$scope)},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(currentRect){if(this._super(),this.relevantSize=0,this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.isVisible()&&this._titleMetrics&&this._legendMetrics)if(this.isDiscrete())if(this.isHorizontal()){var metrics=calculateHorizontalLegendMetrics(currentRect,this._legendMetrics,this._titleMetrics);this.relevantSize=metrics.h+(metrics.numRows>MAX_NUM_DISCRETE_ROWS?MAX_NUM_DISCRETE_ROWS:metrics.numRows)+2*LegendData.constants.PADDING}else this.relevantSize=Math.max(this._legendMetrics.cellWidth,this._titleMetrics.width);else this.relevantSize=getGradientSize(this._titleMetrics,this._legendMetrics,this.isVertical(),this._values)},isDiscrete:function(){return this._mode.legend===LegendData.Modes.DISCRETE},clear:function(){this._super()},on:function(){this.$scope.selectionEnabled=!!this._mode.selectionEnabled&&!!this.selections,this.$scope.interactionEnabled=!0},off:function(){this.$scope.selectionEnabled=!1,this.$scope.interactionEnabled=!1},getSelectionMode:function(){return this._mode.legend},clearSelection:function(){this.$scope.$broadcast("clearSelection"),this.$scope.$broadcast("cancelSelection")},cancelSelection:function(){this.$scope.$broadcast("cancelSelection")},getScrollPosition:function(){return this._scrollPosition},setScrollPosition:function(v){this.$scope.explicitScrollPosition=v},setLocked:function(lock){this.$scope.isLocked=lock}}),Object.defineProperties(ColorLegend.prototype,{pagingMode:{get:function(){return this._pagingMode},set:function(v){this._pagingMode=v}}}),Object.defineProperty(ColorLegend.prototype,"className",{value:"ColorLegend"}),ColorLegend}),/**
 * @preserve IntegraXor Web SCADA - JavaScript Number Formatter
 * http://www.integraxor.com/
 * author: KPL, KHL
 * (c)2011 ecava
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
define("assets/external/numberformatter/format",[],function(){return function(m,v){if(!m||isNaN(+v))return v;var v="-"==m.charAt(0)?-v:+v,isNegative=0>v?v=-v:0,result=m.match(/[^\d\-\+#]/g),Decimal=result&&result[result.length-1]||".",Group=result&&result[1]&&result[0]||",",m=m.split(Decimal);v=v.toFixed(m[1]&&m[1].length),v=+v+"";var pos_trail_zero=m[1]&&m[1].lastIndexOf("0"),part=v.split(".");(!part[1]||part[1]&&part[1].length<=pos_trail_zero)&&(v=(+v).toFixed(pos_trail_zero+1));var szSep=m[0].split(Group);m[0]=szSep.join("");var pos_lead_zero=m[0]&&m[0].indexOf("0");if(pos_lead_zero>-1)for(;part[0].length<m[0].length-pos_lead_zero;)part[0]="0"+part[0];else 0==+part[0]&&(part[0]="");v=v.split("."),v[0]=part[0];var pos_separator=szSep[1]&&szSep[szSep.length-1].length;if(pos_separator){for(var integer=v[0],str="",offset=integer.length%pos_separator,i=0,l=integer.length;l>i;i++)str+=integer.charAt(i),!((i-offset+1)%pos_separator)&&l-pos_separator>i&&(str+=Group);v[0]=str}return v[1]=m[1]&&v[1]?Decimal+v[1]:"",(isNegative?"-":"")+v[0]+v[1]}}),define("objects.utils/number-formatter",["core.utils/class","util","assets/external/numberformatter/format"],function(Class,util,formatter){"use strict";function formatRadix(value,radix,pattern,decimal){return value=value.toString(radix),pattern[1]===pattern[1].toUpperCase()&&(value=value.toUpperCase()),value.length-value.indexOf(".")>10&&(value=value.slice(0,value.indexOf(".")+11)),value.replace(".",decimal||".")}function formatFunctional(value,pattern,d){var temp;return radix.test(pattern)?value=formatRadix(value,Number(/\d{2}/.exec(pattern)[0]),pattern,d):oct.test(pattern)?value=formatRadix(value,8,pattern,d):dec.test(pattern)?value=formatRadix(value,10,pattern,d):hex.test(pattern)?value=formatRadix(value,16,pattern,d):bin.test(pattern)?value=formatRadix(value,2,pattern,d):rom.test(pattern)&&(temp="",0>value&&(temp="-",value=-value),value=Math.floor(value),0===value?value="0":5e5>=value?(value=formatRoman(value,pattern),value=temp+value):value=pattern+temp+value.toExponential(0)),value}function formatRoman(value,pattern){for(var i,s="",v=Number(String(value).slice(-3)),nThousands=(value-v)/1e3,decimal=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),numeral=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();v>0;)for(i=0;i<decimal.length;i++)if(decimal[i]<=v){s+=numeral[i],v-=decimal[i];break}for(i=0;nThousands>i;i++)s="M"+s;return pattern[1]!==pattern[1].toUpperCase()&&(s=s.toLowerCase()),s}function preparePattern(o,t,d){var parts,lastPart,numericPattern,prefix,postfix,groupTemp,decTemp,temp,regex,pattern=o.pattern;pattern.indexOf("A")>=0&&(pattern=pattern.replace("A",""),o.abbreviate=!0),regex=createRegExp(t,d),numericPattern=pattern.match(regex),numericPattern=numericPattern?numericPattern[0]:"",prefix=numericPattern?pattern.substr(0,pattern.indexOf(numericPattern)):pattern,postfix=numericPattern?pattern.substring(pattern.indexOf(numericPattern)+numericPattern.length):"",numericPattern||(numericPattern=pattern?"#":"##########"),t&&t===d&&(parts=numericPattern.split(d),lastPart=parts.pop(),numericPattern=parts.join("")+d+lastPart,t=""),groupTemp=t,t=/,/.test(d)?"¤":",",groupTemp&&(numericPattern=numericPattern.replace(escape(groupTemp,"g"),t)),decTemp=d,d=".",decTemp&&(numericPattern=numericPattern.replace(escape(decTemp,"g"),d)),temp=numericPattern.match(/#/g),temp=temp?temp.length:0,o.prefix=prefix||"",o.postfix=postfix||"",o.pattern=pattern,o.percentage=percentage.test(pattern),o.numericPattern=numericPattern||"",o.numericRegex=new RegExp(escape(t,null,!0)+"|"+escape(d,null,!0),"g"),o.groupTemp=groupTemp,o.decTemp=decTemp,o.t=t,o.d=d,o.temp=temp}function escape(value,flags,justStr){var str=util.escapeRegExp(value);return justStr?str:new RegExp(str||"",flags)}function createRegExp(thousand,decimal){return decimal&&(decimal=util.escapeRegExp(decimal)),thousand&&(thousand=util.escapeRegExp(thousand)),new RegExp("(?:[#0]+"+thousand+")?[#0]+(?:"+decimal+"[#0]+)?")}var NumberFormatter,SIprefixes={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"μ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},percentage=/%$/,radix=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,oct=/^\(oct\)/i,dec=/^\(dec\)/i,hex=/^\(hex\)/i,bin=/^\(bin\)/i,rom=/^\(rom\)/i,functional=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;return NumberFormatter=Class.extend("NumberFormatter",{init:function(localeInfo,pattern,thousand,decimal,type){this.localeInfo=localeInfo,this.pattern=pattern,this.thousandDelimiter=thousand||",",this.decimalDelimiter=decimal||".",this.type=type||"numeric",this.prepare()},clone:function(){var n=new NumberFormatter(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return n.subtype=this.subtype,n},format:function(value,pattern,t,d){return this.prepare(pattern,t,d),this.formatValue(value)},prepare:function(pattern,t,d){var prep,isFunctional;return"undefined"==typeof pattern&&(pattern=this.pattern),"undefined"==typeof t&&(t=this.thousandDelimiter),"undefined"==typeof d&&(d=this.decimalDelimiter),pattern?(this._prepared={positive:{d:d,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:d,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},prep=this._prepared,pattern=pattern.split(";"),prep.positive.pattern=pattern[0],prep.negative.pattern=pattern[1],functional.test(pattern[0])&&(prep.positive.isFunctional=!0),pattern[1]?functional.test(pattern[1])&&(prep.negative.isFunctional=!0):prep.negative=!1,isFunctional=prep.positive.isFunctional&&(!prep.negative||prep.negative&&prep.negative.isFunctional),void(isFunctional||(preparePattern(prep.positive,t,d),prep.negative&&preparePattern(prep.negative,t,d)))):void(this._prepared={pattern:!1})},formatValue:function(value){var temp,exponent,absValue,num,d,t,i,numericPattern,decimalPartPattern,prep=this._prepared,abbr="",sciValue="";if(isNaN(value))return value;if(prep.pattern===!1)return value.toString();if(0>value&&prep.negative?(prep=prep.negative,value=-value):prep=prep.positive,d=prep.d,t=prep.t,prep.isFunctional)value=formatFunctional(value,prep.pattern,d);else{if(prep.percentage&&(value*=100),prep.abbreviate&&(exponent=Number(Number(value).toExponential().split("e")[1]),exponent-=exponent%3,exponent in SIprefixes&&(abbr=SIprefixes[exponent],value/=Math.pow(10,exponent))),absValue=Math.abs(value),temp=prep.temp,numericPattern=prep.numericPattern,decimalPartPattern=numericPattern.split(d)[1],"I"===this.type&&(value=Math.round(value)),num=value,decimalPartPattern||"#"!==numericPattern.slice(-1)[0])if(absValue>=1e15||absValue>0&&1e-14>=absValue)value=absValue?absValue.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var wholePart=Number(value.toFixed(Math.min(20,decimalPartPattern?decimalPartPattern.length:0)).split(".")[0]),wholePartPattern=numericPattern.split(d)[0];if(wholePartPattern+=d,value=formatter(wholePartPattern,wholePart)||"0",decimalPartPattern){var nDecimals=Math.max(0,Math.min(14,decimalPartPattern.length)),nZeroes=decimalPartPattern.replace(/#+$/,"").length,decimalPart=(absValue%1).toFixed(nDecimals).slice(2).replace(/0+$/,"");for(i=decimalPart.length;nZeroes>i;i++)decimalPart+="0";decimalPart&&(value+=d+decimalPart)}else 0===wholePart&&(num=0)}else if(absValue>=Math.pow(10,temp)||1>absValue||1e-4>absValue)0===value?value="0":1e-4>absValue||absValue>=1e20?(value=num.toExponential(Math.max(1,Math.min(14,temp))-1),value=value.replace(/\.?0+(?=e)/,""),sciValue=""):(value=value.toPrecision(Math.max(1,Math.min(14,temp))),value.indexOf(".")>=0&&(value=value.replace(value.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,""),value=value.replace(".",d)));else{for(numericPattern+=d,temp=Math.max(0,Math.min(20,temp-Math.ceil(Math.log(absValue)/Math.log(10)))),i=0;temp>i;i++)numericPattern+="#";value=formatter(numericPattern,value)}value=value.replace(prep.numericRegex,function(m){return m===t?prep.groupTemp:m===d?prep.decTemp:""}),0>num&&!/^\-/.test(value)&&(value="-"+value)}return prep.prefix+value+sciValue+abbr+prep.postfix}}),window.NumberFormatter=NumberFormatter,NumberFormatter}),define("objects.views/charts/components/legend/color-legend-light",["jquery","objects.views/charts/chart-style-service","../chart-component-angular","text!./color-legend.ng.html","./legend-data","translator","objects.utils/number-formatter","./qv-continous-legend","./qv-discrete-legend"],function($,ChartStyleService,ChartComponentAngular,template,LegendData,translator,NumberFormatter){function clearScope($scope){$scope.visible=!1,$scope.discreteItems=null,$scope.continousItems=null,this._titleMetrics=null,this._legendMetrics=null}function updateStyles(styleService,fontScale){var localStyle={backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),label:{font:styleService.getFont(chartID,"label"),lineHeight:"1em"},scaledLabel:{font:styleService.getFont(chartID,"label",null,null,null,fontScale),color:styleService.getValue(chartID,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:styleService.getFont(chartID,"title"),lineHeight:"1em"},scaledTitle:{font:styleService.getFont(chartID,"title",null,null,null,fontScale),color:styleService.getValue(chartID,"title","color"),lineHeight:"1em"}};return localStyle}function getRangeValue(point,viewItems){var val,minValue=viewItems[0].min,maxValue=viewItems[viewItems.length-1].max,span=maxValue-minValue;return val=0===point?minValue:1===point?maxValue:point*span+minValue}var ColorLegendLight,chartID="legend",MIN_VERTICAL_PADDING=12;return ColorLegendLight=ChartComponentAngular.extend("ColorLegendLight",{init:function(){var mainArguments=Array.prototype.slice.call(arguments);mainArguments.push(template),this._super.apply(this,mainArguments),this._styleService=ChartStyleService.getInstance(),this._numberFormatter=new NumberFormatter,this._defaultPattern="#.#A",this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={};var self=this;this.formatValue=function(value){return self._formatter.formatValue(value)},this.$scope.positionToValue=function(position){return self.formatValue(getRangeValue(position,self.$scope.viewItems))}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMapLight:function(c){this._colorMapLight=c},getColorMapLight:function(){return this._colorMapLight},setData:function(data){this._super(data),this._dataInvalid=!0},setClusterDataPage:function(dataPage){this._dataPage=dataPage},isVisible:function(layoutMode){return this._super(layoutMode)&&this._data&&this._data.legend&&this._data.legend.show&&this._data.qHyperCube&&this._data.qHyperCube.isReduced},updateSize:function(){this._super(),this.invalidateProperties("LegendLight.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this.isVisible())return void clearScope(this.$scope);var style=updateStyles(this._styleService,this.chartScale),legendTitle=translator.get("properties.compression.density"),legendTitleTooltip=translator.get("properties.compression.density");this._data.legend.showTitle?(this._titleMetrics=LegendData.prepareLegendTitle(legendTitle,style.title),this._titleMetrics.show=!0):this._titleMetrics={show:!1,width:0,height:0},this.$scope.visible=!0,this._maxNrInBin=this._dataPage[0][0].qNum,this.$scope.viewItems=[{colorFrom:"rgba(29,51,72,1.0)",colorTo:"rgba(111,153,197,1.0)",max:1,maxText:this._numberFormatter.format(this._maxNrInBin,this._defaultPattern),min:0,minText:"1"}],this.$scope.options={vertical:this.isVertical(),labelStyle:style.scaledLabel,titleStyle:$.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},style.scaledTitle),titleHeight:(Math.max(this._titleMetrics.height,MIN_VERTICAL_PADDING)+MIN_VERTICAL_PADDING)*this.chartScale,legendTitle:this._titleMetrics.show?legendTitle:null,legendTitleTooltip:legendTitleTooltip,reverse:this._data.legend.reverse,dock:this.dock},this.$scope.discrete=!1,this.$scope.overflow=!1,this.$scope.visible=!0},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(){var minWidth=90;this._super(),this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.relevantSize=this._titleMetrics&&this.isVertical()?Math.max(minWidth,this._titleMetrics.width):minWidth},isDiscrete:function(){return this._mode.legend===LegendData.Modes.DISCRETE},clear:function(){this._super()},setLocked:function(lock){this.$scope.isLocked=lock}}),Object.defineProperties(ColorLegendLight.prototype,{pagingMode:{get:function(){return this._pagingMode},set:function(v){this._pagingMode=v}}}),Object.defineProperty(ColorLegendLight.prototype,"className",{value:"ColorLegendLight"}),ColorLegendLight}),define("objects.views/charts/utils/axis-utils",[],function(){"use strict";function calculateForOutOfRangeCase1(){var magnitude,max,min,range;magnitude=0===this.explicitPlotMax?1:AxisUtils.getMagnitude(this.explicitPlotMax),max=this.explicitPlotMax,min=this.maxNumIntervals<2?max-magnitude:max-2*magnitude,min=Math.ceil(min/magnitude)*magnitude,range=max-min,this.tickDataSpacing=range/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(magnitude/10,AxisUtils.getNiceNumber(this.tickDataSpacing)),this.plotMax=max,this.plotMin=min,this.plotRange=range,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMin)}function calculateForOutOfRangeCase2(){var magnitude,max,min,range;magnitude=0===this.explicitPlotMin?1:AxisUtils.getMagnitude(this.explicitPlotMin),min=this.explicitPlotMin,max=this.maxNumIntervals<2?min+magnitude:min+2*magnitude,max=Math.floor(max/magnitude)*magnitude,range=max-min,this.tickDataSpacing=range/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(magnitude/10,AxisUtils.getNiceNumber(this.tickDataSpacing)),this.plotMax=max,this.plotMin=min,this.plotRange=range,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMax-this.tickDataSpacingNN)}function calculateForOutOfRangeCase(){null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin?calculateForOutOfRangeCase1.call(this):null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax&&calculateForOutOfRangeCase2.call(this)}function calculateForSameMaxMinCase1(){this.plotMax=this.plotMin=this.tickBaseValue=this.usedDataMin,this.plotRange=0,this.tickDataSpacing=this.tickDataSpacingNN=0===this.usedDataMin?1:Math.abs(this.usedDataMin),this.tickMaxIndex=this.tickMinIndex=0}function calculateForSameMaxMinCase2(){if(0===this.usedDataMax)this.maxNumIntervals<2?(this.plotMin=0,this.plotMax=1):(this.plotMin=-1,this.plotMax=1),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(.1,AxisUtils.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.ceil(this.plotMin/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor(this.plotMax/this.tickDataSpacingNN);else{var result=calculateMaxMinAndTickBase(Math.abs(this.usedDataMax),this.maxNumIntervals);this.usedDataMax>0?(this.plotMax=result.max,this.plotMin=result.min,this.tickBaseValue=result.tickBaseValue):(this.plotMax=-result.min,this.plotMin=-result.max,this.tickBaseValue=-result.tickBaseValue),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(result.magnitude/10,AxisUtils.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.floor((this.plotMin-this.tickBaseValue)/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor((this.plotMax-this.tickBaseValue)/this.tickDataSpacingNN)}}function calculateForSameMaxMinCase3(){0===this.explicitPlotMax?(this.plotMax=0,this.plotMin=-1,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,AxisUtils.getNiceNumber(this.plotRange/this.maxNumIntervals))):calculateForOutOfRangeCase1.call(this)}function calculateForSameMaxMinCase4(){0===this.explicitPlotMin?(this.plotMax=1,this.plotMin=0,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,AxisUtils.getNiceNumber(this.plotRange/this.maxNumIntervals))):calculateForOutOfRangeCase2.call(this)}function calculateMaxMinAndTickBase(value,numIntervals){var min,max,magnitude=AxisUtils.getMagnitude(value),k=value/magnitude,m=Math.floor(k),n=Math.round(k),tickBaseValue=0;return 2>numIntervals?(min=m*magnitude,max=(m+1)*magnitude,1>numIntervals&&(tickBaseValue=min)):(min=(n-1)*magnitude,max=(n+1)*magnitude),{min:min,max:max,tickBaseValue:tickBaseValue,magnitude:magnitude}}function calculateForSameMaxMinCase(){null!==this.explicitPlotMin&&null!==this.explicitPlotMax?calculateForSameMaxMinCase1.call(this):null===this.explicitPlotMin&&null===this.explicitPlotMax?calculateForSameMaxMinCase2.call(this):null===this.explicitPlotMin&&null!==this.explicitPlotMax?calculateForSameMaxMinCase3.call(this):calculateForSameMaxMinCase4.call(this)}function calculateForSimpleCase(minIsStrict,maxIsStrict,usingGoodNumber){void 0===minIsStrict&&(minIsStrict=null!==this.explicitPlotMin),void 0===maxIsStrict&&(maxIsStrict=null!==this.explicitPlotMax),this.tickDataSpacingNN=usingGoodNumber?AxisUtils.getGoodNumber(this.tickDataSpacing):AxisUtils.getNiceNumber(this.tickDataSpacing),calculateTickMaxMinIndices.apply(this,[minIsStrict,maxIsStrict])}function calculateForNormalCase(){var numIntervals,range,numLoops,spaceConditionFailed;if(calculateForSimpleCase.call(this),numIntervals=this.tickMaxIndex-this.tickMinIndex,range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,spaceConditionFailed=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,spaceConditionFailed&&this.maxNumIntervals>=5){for(numLoops=0;this.tickDataSpacing<=this.absMax&&spaceConditionFailed;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,calculateForSimpleCase.call(this),range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,spaceConditionFailed=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,numLoops++;if(!spaceConditionFailed)return}for(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,(spaceConditionFailed||2>=numIntervals&&this.maxNumIntervals>=2*numIntervals)&&calculateForSimpleCase.apply(this,[void 0,void 0,!0]),range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,spaceConditionFailed=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,numLoops=0;this.tickDataSpacing<=this.absMax&&spaceConditionFailed;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,calculateForSimpleCase.apply(this,[void 0,void 0,!0]),range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,spaceConditionFailed=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,numLoops++}function calculateForMaxPositiveMinNegativeCase(b){b?(this.tickDataSpacingNN=AxisUtils.getGoodNumber(this.absMax),this.tickBaseValue=-this.tickDataSpacingNN,this.plotMin=null===this.explicitPlotMin?-this.tickDataSpacingNN:this.explicitPlotMin,this.plotMax=null===this.explicitPlotMax?this.tickDataSpacingNN:this.explicitPlotMax,this.tickMinIndex=null===this.explicitPlotMin?0:1,this.tickMaxIndex=(null===this.explicitPlotMax,1),this.tickDataSpacingNN=2*this.tickDataSpacingNN):(this.plotMax=this.usedDataMax,this.plotMin=this.usedDataMin,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,this.tickDataSpacingNN=AxisUtils.getNiceNumber(this.absMax),this.tickDataSpacingNN===this.absMax&&(this.tickDataSpacingNN=AxisUtils.getNiceNumber(1.1*this.absMax)))}function calculateForSpecialCase1(){var temp;this.tickDataSpacingNN=AxisUtils.getNiceNumber(this.tickDataSpacing),this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,(this.usedDataMax<0||this.usedDataMin>0)&&(temp=AxisUtils.getSmallNiceNumber(this.plotRange),this.tickBaseValue=Math.ceil(this.plotMin/temp)*temp)}function calculateForSpecialCase2(){var minIsStrict,maxIsStrict,c,range,numLoops,maxDataSpacing;for(c=this.usedDataMax>=-this.usedDataMin,minIsStrict=c||null!==this.explicitPlotMin,maxIsStrict=!c||null!==this.explicitPlotMax,calculateForSimpleCase.apply(this,[minIsStrict,maxIsStrict,!0]),numLoops=0,maxDataSpacing=(this.absMax+(1-this.spaceUseLimit)*this.absMin)/this.spaceUseLimit*1.0001;this.tickDataSpacing<=maxDataSpacing&&this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,calculateForSimpleCase.apply(this,[minIsStrict,maxIsStrict,!0]),numLoops++;range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&calculateForMaxPositiveMinNegativeCase.call(this)}function calculateForSpecialCase3(){calculateForNormalCase.call(this);var range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin);this.spaceUseFactor=range/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,calculateForSpecialCase2.call(this))}function refineTickDataSpacing(){var oldTickDataSpacingNN,oldPlotMin,oldPlotMax,oldTickMinIndex,oldTickMaxIndex,oldNumIntervals,range,spaceConditionFailed,numIntervals,nn=AxisUtils.getNiceNumber(this.tickDataSpacingNN);this.tickDataSpacingNN!==nn&&0===this.tickBaseValue&&(oldTickDataSpacingNN=this.tickDataSpacingNN,oldTickMinIndex=this.tickMinIndex,oldTickMaxIndex=this.tickMaxIndex,oldNumIntervals=oldTickMaxIndex-oldTickMinIndex,oldPlotMin=this.plotMin,oldPlotMax=this.plotMax,this.tickDataSpacingNN=nn,calculateTickMaxMinIndices.apply(this,[null!==this.explicitPlotMin,null!==this.explicitPlotMax]),range=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=range/this.plotRange,spaceConditionFailed=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,numIntervals=this.tickMaxIndex-this.tickMinIndex,(spaceConditionFailed||!(numIntervals===oldNumIntervals||numIntervals>=10||numIntervals>=3&&1.5*numIntervals>=oldNumIntervals))&&(this.tickDataSpacingNN=oldTickDataSpacingNN,this.tickMinIndex=oldTickMinIndex,this.tickMaxIndex=oldTickMaxIndex,this.plotMin=oldPlotMin,this.plotMax=oldPlotMax,this.plotRange=this.plotMax-this.plotMin))}function calculateMaxMinTickValues(){this.niceNumberEnabled&&this.plotMax!==this.plotMin&&0!==this.plotSize?(this.minTickValue=this.tickBaseValue+this.tickMinIndex*this.tickDataSpacingNN,this.maxTickValue=this.tickBaseValue+this.tickMaxIndex*this.tickDataSpacingNN):(this.minTickValue=this.plotMin,this.maxTickValue=this.plotMax)}function calculateTickValues(){var startValue,i,range;if(this.mainTickValues=[],this.secondaryTickValues=[],calculateMaxMinTickValues.call(this),0!==this.plotSize)if(this.niceNumberEnabled){if(startValue=this.tickBaseValue,range=this.tickMaxIndex-this.tickMinIndex,!(range>100||1>range)){for(i=0;range>=i;i++)this.mainTickValues.push(startValue+(i+this.tickMinIndex)*this.tickDataSpacingNN);for(startValue=this.tickBaseValue+this.tickDataSpacingNN/2,i=0;range>i;i++)this.secondaryTickValues.push(startValue+(i+this.tickMinIndex)*this.tickDataSpacingNN)}}else{for(this.numIntervals=Math.floor(this.maxNumIntervals),this.tickDataSpacing=this.usedDataRange/this.numIntervals,startValue=this.usedDataMin,i=0;i<=this.numIntervals;i++)this.mainTickValues.push(startValue+i*this.tickDataSpacing);for(startValue=this.usedDataMin+this.tickDataSpacing/2,i=0;i<this.numIntervals;i++)this.secondaryTickValues.push(startValue+i*this.tickDataSpacing)}}function updatePlotMin(){var tickMin,plotMin,plotRange,s,i,fractions=[.5];for(tickMin=this.mainTickValues[0],i=0;i<fractions.length;i++)if(plotMin=tickMin-this.tickDataSpacingNN*fractions[i],plotRange=this.plotMax-plotMin,s=this.plotSize*this.tickDataSpacingNN/plotRange,s>3*this.fontHeight)return this.plotMin=plotMin,this.plotRange=plotRange,void this.mainTickValues.splice(0,0,plotMin)}function updatePlotMax(){var tickMax,plotMax,plotRange,s,i,fractions=[.5];for(tickMax=this.mainTickValues[this.mainTickValues.length-1],i=0;i<fractions.length;i++)if(plotMax=tickMax+this.tickDataSpacingNN*fractions[i],plotRange=plotMax-this.plotMin,s=this.plotSize*this.tickDataSpacingNN/plotRange,s>3*this.fontHeight)return this.plotMax=plotMax,this.plotRange=plotRange,void this.mainTickValues.push(plotMax)}function calculateTickMaxMinIndices(minIsStrict,maxIsStrict){this.tickMinIndex=minIsStrict?Math.ceil(this.usedDataMin/this.tickDataSpacingNN):Math.floor(this.usedDataMin/this.tickDataSpacingNN),this.tickMaxIndex=maxIsStrict?Math.floor(this.usedDataMax/this.tickDataSpacingNN):Math.ceil(this.usedDataMax/this.tickDataSpacingNN),this.plotMin=minIsStrict?this.usedDataMin:this.tickMinIndex*this.tickDataSpacingNN,this.plotMax=maxIsStrict?this.usedDataMax:this.tickMaxIndex*this.tickDataSpacingNN,this.plotRange=this.plotMax-this.plotMin}function addMainExtraTicksIfNeeded(){var numIntervals,tickMin,tickMax,numTicks,numLoops,oldPlotMin=this.plotMin,oldPlotMax=this.plotMax,oldTickMinIndex=this.tickMinIndex,oldTickMaxIndex=this.tickMaxIndex,oldTickDataSpacing=this.tickDataSpacingNN,oldNumIntervals=this.tickMaxIndex-this.tickMinIndex,minIsStrict=null!==this.explicitPlotMin,maxIsStrict=null!==this.explicitPlotMax,cont=!0,minTickSpacingInPixel=2*this.fontHeight,newNumIntervals=oldNumIntervals;if(numTicks=this.mainTickValues?this.mainTickValues.length:0,tickMin=this.mainTickValues[0],tickMax=this.mainTickValues[numTicks-1],null===this.explicitPlotMin&&tickMin>this.dataMin&&newNumIntervals++,null===this.explicitPlotMax&&tickMax<this.dataMax&&newNumIntervals++,newNumIntervals!==oldNumIntervals){for(numLoops=0;cont&&10>numLoops;)this.tickDataSpacingNN=AxisUtils.getSmallNiceNumber(.99*this.tickDataSpacingNN),calculateTickMaxMinIndices.apply(this,[minIsStrict,maxIsStrict]),numIntervals=this.tickMaxIndex-this.tickMinIndex,numIntervals>newNumIntervals&&(cont=!1),numLoops++;for(cont=!0,numLoops=0;this.tickDataSpacingNN<oldTickDataSpacing&&cont&&10>numLoops;)this.tickDataSpacingNN=AxisUtils.getGoodNumber(1.1*this.tickDataSpacingNN),calculateTickMaxMinIndices.apply(this,[minIsStrict,maxIsStrict]),numIntervals=this.tickMaxIndex-this.tickMinIndex,numIntervals===newNumIntervals&&this.plotSize*this.tickDataSpacingNN/this.plotRange>minTickSpacingInPixel&&(cont=!1),numLoops++;cont?(this.plotMin=oldPlotMin,this.plotMax=oldPlotMax,this.tickMinIndex=oldTickMinIndex,this.tickMaxIndex=oldTickMaxIndex,this.tickDataSpacingNN=oldTickDataSpacing):calculateTickValues.call(this)}}function addSubExtraTicksIfNeeded(){var tickMin,tickMax,numTicks;numTicks=this.mainTickValues?this.mainTickValues.length:0,tickMin=this.mainTickValues[0],tickMax=this.mainTickValues[numTicks-1],null===this.explicitPlotMin&&tickMin>this.dataMin&&null===this.explicitPlotMax&&tickMax<this.dataMax?Math.abs(this.dataMin)<=Math.abs(this.dataMax)?(updatePlotMin.call(this),updatePlotMax.call(this)):(updatePlotMax.call(this),updatePlotMin.call(this)):null===this.explicitPlotMin&&tickMin>this.dataMin?updatePlotMin.call(this):null===this.explicitPlotMax&&tickMax<this.dataMax&&updatePlotMax.call(this)}function createResult(){return{plotMin:this.plotMin,plotMax:this.plotMax,tickSpacing:this.tickDataSpacingNN,tickBaseValue:this.tickBaseValue,tickMinIndex:this.tickMinIndex,tickMaxIndex:this.tickMaxIndex,minTickValue:this.minTickValue,maxTickValue:this.maxTickValue,mainTickValues:this.mainTickValues,secondaryTickValues:this.secondaryTickValues}}var AxisUtils,log10=Math.log(10),epsilon=1e-12;return AxisUtils={log:function(value,base){return 0>=value||0>=base?NaN:Math.log(value)/Math.log(base)},log10:function(value){return 0>=value?NaN:Math.log(value)/log10},eliminateFloatingError:function(value){var round=Math.round(value);return Math.abs(value-round)<epsilon&&(value=round),value},getNiceNumber:function(value){var magnitude,fraction,roundedFraction;return 0===value?0:(magnitude=Math.floor(Math.log(Math.abs(value))/log10),fraction=value/Math.pow(10,magnitude),roundedFraction=1>=fraction?1:2>=fraction?2:5>=fraction?5:10,roundedFraction*Math.pow(10,magnitude)*(0>value?-1:1))},getSmallNiceNumber:function(value){var magnitudeOrder,fraction,roundedFraction;return 0===value?0:(magnitudeOrder=Math.floor(Math.log(Math.abs(value))/log10),fraction=value/Math.pow(10,magnitudeOrder),1>fraction?(roundedFraction=5,magnitudeOrder--):roundedFraction=2>fraction?1:5>fraction?2:5,roundedFraction*Math.pow(10,magnitudeOrder)*(0>value?-1:1))},getMagnitude:function(value){var magnitude;return 0===value?0:(magnitude=Math.floor(Math.log(Math.abs(value))/log10),Math.pow(10,magnitude))},getFraction:function(value){var magnitude;return 0===value?0:(magnitude=Math.floor(Math.log(Math.abs(value))/log10),value/Math.pow(10,magnitude))},getGoodNumber:function(value){var magnitudeOrder,fraction,roundedFraction;return 0===value?0:(magnitudeOrder=Math.floor(Math.log(Math.abs(value))/log10),fraction=value/Math.pow(10,magnitudeOrder),roundedFraction=Math.ceil(fraction),(7===roundedFraction||9===roundedFraction)&&roundedFraction++,fraction>1&&1.5>=fraction?roundedFraction=1.5:fraction>2&&2.5>=fraction&&(roundedFraction=2.5),roundedFraction*Math.pow(10,magnitudeOrder)*(0>value?-1:1))},calculateTicks:function(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled,spaceUseLimit,tickMinMaxCoverDataMinMax){var temp,outOfRangeCase=!1;return void 0===tickMinMaxCoverDataMinMax&&(tickMinMaxCoverDataMinMax=!1),isNaN(explicitPlotMin)&&(explicitPlotMin=null),isNaN(explicitPlotMax)&&(explicitPlotMax=null),dataMin>dataMax&&(temp=dataMin,dataMin=dataMax,dataMax=temp),null!==explicitPlotMin&&null!==explicitPlotMax&&explicitPlotMin>explicitPlotMax&&(temp=explicitPlotMin,explicitPlotMin=explicitPlotMax,explicitPlotMax=temp),this.plotSize=plotSize,this.dataMin=dataMin,this.dataMax=dataMax,this.explicitPlotMin=explicitPlotMin,this.explicitPlotMax=explicitPlotMax,this.minTickSpacingInPixel=minTickSpacingInPixel,this.usedDataMin=null===this.explicitPlotMin?this.dataMin:this.explicitPlotMin,this.usedDataMax=null===this.explicitPlotMax?this.dataMax:this.explicitPlotMax,this.absMax=Math.max(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.absMin=Math.min(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=this.plotSize/this.minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,this.fontHeight=fontHeight,this.niceNumberEnabled=niceNumberEnabled,this.tickBaseValue=0,this.spaceUseLimit=void 0===spaceUseLimit?.6:spaceUseLimit,this.spaceOptimizingEnabled=spaceOptimizingEnabled,this.plotMaxCanBeTuned=null===this.explicitPlotMax&&this.usedDataMax>0,this.plotMinCanBeTuned=null===this.explicitPlotMin&&this.usedDataMin<0,niceNumberEnabled&&0!==plotSize?(null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin||null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax?(outOfRangeCase=!0,
calculateForOutOfRangeCase.call(this)):0===this.usedDataRange?calculateForSameMaxMinCase.call(this):this.maxNumIntervals<1?calculateForSpecialCase1.call(this):(this.usedDataMax>0&&this.usedDataMin<0?1===this.maxNumIntervals?calculateForMaxPositiveMinNegativeCase.call(this,!0):this.maxNumIntervals>=5?calculateForNormalCase.call(this):this.maxNumIntervals<2?calculateForSpecialCase2.call(this):calculateForSpecialCase3.call(this):calculateForNormalCase.call(this),this.tickMaxIndex<this.tickMinIndex?(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,calculateForSpecialCase1.call(this)):refineTickDataSpacing.call(this)),calculateTickValues.call(this),tickMinMaxCoverDataMinMax&&this.maxNumIntervals>=1&&!outOfRangeCase&&(addMainExtraTicksIfNeeded.call(this),addSubExtraTicksIfNeeded.call(this)),createResult.call(this)):(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.tickDataSpacingNN=this.tickDataSpacing,calculateTickValues.call(this),createResult.call(this))}}}),define("objects.views/charts/components/axis/linear-scale",["core.utils/class","../../utils/axis-utils"],function(Class,AxisUtils){"use strict";var LinearScale=Class.extend("LinearScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(plotSize){this._plotSize=plotSize},getPositionOfValue:function(v){return(v-this.plotMin)/this.plotRange*this._plotSize},getValueOfPosition:function(p){return this.plotMin+this.plotRange*p/this._plotSize},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin},calculateTicks:function(){var result,max,min,largestValue,smallestValue;min=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,max=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,result=AxisUtils.calculateTicks(this._calculationSize,min,max,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled,.6,this._showExplicitMinMax),this._tickSpacing=result.tickSpacing,this.plotMin=result.plotMin,this.plotMax=result.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=result.tickMinValue,this.tickMax=result.tickMaxValue,this.mainValues=result.mainTickValues,this.secondaryValues=result.secondaryTickValues,0===this.mainValues.length&&this.mainValues.push(result.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(smallestValue=this.mainValues[0],this.mainValues[0]=result.plotMin,smallestValue-result.plotMin>=result.tickSpacing/2&&this.mainValues.splice(1,0,smallestValue),largestValue=result.mainTickValues[result.mainTickValues.length-1],result.plotMax-largestValue<=result.tickSpacing/2?this.mainValues[result.mainTickValues.length-1]=result.plotMax:this.mainValues.push(result.plotMax))},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return LinearScale}),define("objects.views/charts/utils/axis-log-utils",["objects.views/charts/utils/axis-utils"],function(AxisUtils){"use strict";function calculateMinRatio(array,min,max){var i,len=array?array.length:0,ratio=void 0===min?Number.MAX_VALUE:array[0]/min;for(i=1;len>i;i++)ratio=Math.min(ratio,array[i]/array[i-1]);void 0!==max&&(ratio=Math.min(ratio,max/array[len-1])),array.splice(0,0,ratio)}function calculateMinRatioArray2D(array,min,max){var i,len=array?array.length:0;for(i=0;len>i;i++)calculateMinRatio(array[i],min,max)}function updateReferenceTables(){var i,j;for(calculateMinRatioArray2D(referenceTable1,1,10),i=0;i<referenceTable2.length;i++)if(referenceTable2[i])for(j=0;j<referenceTable2[i].length;j++)referenceTable2[i][j]instanceof Array&&calculateMinRatioArray2D(referenceTable2[i][j])}function calculateRoughMainTicks1(){var tickDataSpacingNNLog,tickMinIndex,tickMaxIndex,plotMinLog,plotMaxLog,plotRangeLog,tickBaseValueLog,cont=!0,numLoops=0;for(tickDataSpacingNNLog=this.tickDataSpacingLog,tickBaseValueLog=0;cont&&5>numLoops;)tickDataSpacingNNLog=0===numLoops?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*tickDataSpacingNNLog),tickMinIndex=this.minIsStrict?Math.ceil(this.usedDataMinLog/tickDataSpacingNNLog):Math.floor(this.usedDataMinLog/tickDataSpacingNNLog),tickMaxIndex=this.maxIsStrict?Math.floor(this.usedDataMaxLog/tickDataSpacingNNLog):Math.ceil(this.usedDataMaxLog/tickDataSpacingNNLog),plotMinLog=this.minIsStrict?this.explicitPlotMinLog:tickMinIndex*tickDataSpacingNNLog,plotMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:tickMaxIndex*tickDataSpacingNNLog,plotRangeLog=plotMaxLog-plotMinLog,cont=tickDataSpacingNNLog/plotRangeLog*this.plotSize<this.minTickSpacingInPixel,numLoops++;return cont&&(tickDataSpacingNNLog=Math.ceil(this.tickDataSpacingLog),tickMinIndex=this.minIsStrict?Math.ceil(this.usedDataMinLog/tickDataSpacingNNLog):Math.floor(this.usedDataMinLog/tickDataSpacingNNLog),tickMaxIndex=this.maxIsStrict?Math.floor(this.usedDataMaxLog/tickDataSpacingNNLog):Math.ceil(this.usedDataMaxLog/tickDataSpacingNNLog),plotMinLog=this.minIsStrict?this.explicitPlotMinLog:tickMinIndex*tickDataSpacingNNLog,plotMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:tickMaxIndex*tickDataSpacingNNLog),{plotMinLog:plotMinLog,plotMaxLog:plotMaxLog,tickMinIndex:tickMinIndex,tickMaxIndex:tickMaxIndex,tickDataSpacingNNLog:tickDataSpacingNNLog,tickBaseValueLog:tickBaseValueLog,success:!cont}}function calculateRoughMainTicks2(){var tickDataSpacingNNLog,tickMinIndex,tickMaxIndex,plotMinLog,plotMaxLog,plotRangeLog,tickBaseValueLog,cont=!0,numLoops=0;for(tickDataSpacingNNLog=this.tickDataSpacingLog,tickMinIndex=0,tickBaseValueLog=this.usedDataMinLogFloor;cont&&5>numLoops;)tickDataSpacingNNLog=0===numLoops?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*tickDataSpacingNNLog),tickMinIndex=this.minIsStrict?Math.ceil((this.usedDataMinLog-tickBaseValueLog)/tickDataSpacingNNLog):Math.floor((this.usedDataMinLog-tickBaseValueLog)/tickDataSpacingNNLog),tickMaxIndex=this.maxIsStrict?Math.floor((this.usedDataMaxLog-tickBaseValueLog)/tickDataSpacingNNLog):Math.ceil((this.usedDataMaxLog-tickBaseValueLog)/tickDataSpacingNNLog),plotMinLog=this.minIsStrict?this.explicitPlotMinLog:tickMinIndex*tickDataSpacingNNLog+tickBaseValueLog,plotMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:tickMaxIndex*tickDataSpacingNNLog+tickBaseValueLog,plotRangeLog=plotMaxLog-plotMinLog,cont=tickDataSpacingNNLog/plotRangeLog*this.plotSize<this.minTickSpacingInPixel,numLoops++;return cont&&(tickDataSpacingNNLog=0===numLoops?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*tickDataSpacingNNLog),tickMinIndex=this.minIsStrict?Math.ceil((this.usedDataMinLog-tickBaseValueLog)/tickDataSpacingNNLog):Math.floor((this.usedDataMinLog-tickBaseValueLog)/tickDataSpacingNNLog),tickMaxIndex=this.maxIsStrict?Math.floor((this.usedDataMaxLog-tickBaseValueLog)/tickDataSpacingNNLog):Math.ceil((this.usedDataMaxLog-tickBaseValueLog)/tickDataSpacingNNLog),plotMinLog=this.minIsStrict?this.explicitPlotMinLog:tickMinIndex*tickDataSpacingNNLog+tickBaseValueLog,plotMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:tickMaxIndex*tickDataSpacingNNLog+tickBaseValueLog),{plotMinLog:plotMinLog,plotMaxLog:plotMaxLog,tickMinIndex:tickMinIndex,tickMaxIndex:tickMaxIndex,tickDataSpacingNNLog:tickDataSpacingNNLog,tickBaseValueLog:tickBaseValueLog,success:!cont}}function calculateRoughMainTicks(){var result1,result2,usedDataLogRange,useFactor1,useFactor2,numTicks1,numTicks2;return result2=calculateRoughMainTicks2.call(this),result2.success?(usedDataLogRange=this.usedDataMaxLog-this.usedDataMinLog,useFactor2=usedDataLogRange/(result2.plotMaxLog-result2.plotMinLog),1===useFactor2?result2:(result1=calculateRoughMainTicks1.call(this),result1.success?(useFactor1=usedDataLogRange/(result1.plotMaxLog-result1.plotMinLog),numTicks1=result1.tickMaxIndex-result1.tickMinIndex,numTicks2=result2.tickMaxIndex-result2.tickMinIndex,numTicks2>numTicks1||numTicks2===numTicks1&&useFactor2>useFactor1||numTicks2===numTicks1&&useFactor2===useFactor1&&result2.plotMinLog<result1.plotMinLog?result2:result1):result2)):result1=calculateRoughMainTicks1.call(this)}function increaseTickDataSpacing(minIsStrict,maxIsStrict,dataMin,dataMax,previousTickDataSpacing){var tickDataSpacing=AxisUtils.getNiceNumber(1.1*previousTickDataSpacing),tickMinIndex=minIsStrict?Math.ceil(dataMin/tickDataSpacing):Math.floor(dataMin/tickDataSpacing),tickMaxIndex=maxIsStrict?Math.floor(dataMax/tickDataSpacing):Math.ceil(dataMax/tickDataSpacing),plotMin=minIsStrict||0===tickMinIndex?dataMin:tickMinIndex*tickDataSpacing,plotMax=maxIsStrict?dataMax:tickMaxIndex*tickDataSpacing;return{plotMin:plotMin,plotMax:plotMax,tickSpacing:tickDataSpacing,tickBaseValue:0}}function findLowIndexOutOfRange(values,min){var i;for(i=0;i<values.length;i++)if(values[i]>=min)return i-1}function findHighIndexOutOfRange(values,max){var i;for(i=values.length-1;i>=0;i--)if(values[i]<=max)return i+1}function removeOutOfRangeTicks(tickValues,dataMin,dataMax,minIsStrict,maxIsStrict){var idx1,idx2;idx1=findLowIndexOutOfRange(tickValues,dataMin),idx2=findHighIndexOutOfRange(tickValues,dataMax),!minIsStrict&&void 0!==tickValues[idx1+1]&&tickValues[idx1+1]>dataMin&&(idx1-=1),!maxIsStrict&&idx2>0&&void 0!==tickValues[idx2-1]&&tickValues[idx2-1]<dataMax&&(idx2+=1),idx2<tickValues.length&&tickValues.splice(idx2,tickValues.length-idx2),idx1>=0&&tickValues.splice(0,idx1+1)}function checkTickSpaceCondition(tickValues,min,max,threshold){var i,len,tickValuesLog,tickSpacing,minTickSpacingLog=Number.MAX_VALUE,maxTickSpacingLog=-Number.MAX_VALUE,maxLog=AxisUtils.log10(max),minLog=AxisUtils.log10(min),rangeLog=maxLog-minLog;for(len=tickValues?tickValues.length:0,tickValuesLog=new Array(len),(null===threshold||isNaN(threshold))&&(threshold=1.71),i=0;len>i;i++)tickValuesLog[i]=AxisUtils.log10(tickValues[i]);for(i=1;len>i;i++)tickSpacing=tickValuesLog[i]-tickValuesLog[i-1],minTickSpacingLog=Math.min(minTickSpacingLog,tickSpacing),maxTickSpacingLog=Math.max(maxTickSpacingLog,tickSpacing);return maxTickSpacingLog=Math.max(maxTickSpacingLog,Math.abs(tickValuesLog[0]-minLog)),maxTickSpacingLog=Math.max(maxTickSpacingLog,Math.abs(maxLog-tickValuesLog[len-1])),minTickSpacingLog/rangeLog*this.plotSize>=this.minTickSpacingInPixel-epsilon&&threshold>=maxTickSpacingLog/minTickSpacingLog&&tickValues.length-1<=this.maxNumIntervals}function calculateSpaceDistributionFactor(result){var i,len,tickValuesLog,tickSpacing,minTickSpacing=Number.MAX_VALUE,maxTickSpacing=-Number.MAX_VALUE,mainTickValues=result.mainTickValues;for(len=mainTickValues?mainTickValues.length:0,tickValuesLog=new Array(len),i=0;len>i;i++)tickValuesLog[i]=AxisUtils.log10(mainTickValues[i]);for(i=1;len>i;i++)tickSpacing=tickValuesLog[i]-tickValuesLog[i-1],minTickSpacing=Math.min(minTickSpacing,tickSpacing),maxTickSpacing=Math.max(maxTickSpacing,tickSpacing);result.maxTickSpacing=maxTickSpacing,result.minTickSpacing=minTickSpacing,result.tickSpacingRatio=maxTickSpacing/minTickSpacing,result.spaceUseFactor=this.usedDataRange/(result.plotMax-result.plotMin),result.factor=result.spaceUseFactor/(result.tickSpacingRatio*result.tickSpacingRatio)}function findGoodNumberBetweenMaxAndMin(min,max,logMin,logMax,closedValue){var middle,middleRound,middleFloor,middleCeil,temp;return middle=(logMax+logMin)/2,void 0===closedValue?(middleRound=Math.round(middle),middleRound>=logMin&&logMax>=middleRound?Math.pow(10,middleRound):(middleFloor=Math.floor(middle),middleFloor>=logMin&&logMax>=middleFloor?Math.pow(10,middleFloor):(middleCeil=Math.ceil(middle),middleCeil>=logMin&&logMax>=middleCeil?Math.pow(10,middleCeil):(temp=AxisUtils.getSmallNiceNumber(Math.max(1,max-min)),Math.ceil(min/temp)*temp)))):(middleFloor=Math.pow(10,Math.floor(middle)),middleCeil=Math.pow(10,Math.ceil(middle)),Math.abs(middleFloor-closedValue)<Math.abs(middleCeil-closedValue)?middleFloor:middleCeil)}function calculateTickValues(dataMin,dataMax,tickBaseValue,tickDataSpacing,minIsStrict,maxIsStrict){var i,v,tickMinIndex=minIsStrict?Math.ceil((dataMin-tickBaseValue)/tickDataSpacing):Math.floor((dataMin-tickBaseValue)/tickDataSpacing),tickMaxIndex=maxIsStrict?Math.floor((dataMax-tickBaseValue)/tickDataSpacing):Math.ceil((dataMax-tickBaseValue)/tickDataSpacing),mainTickValues=[];for(i=tickMinIndex;tickMaxIndex>=i;i++)v=i*tickDataSpacing+tickBaseValue,v>0&&mainTickValues.push(i*tickDataSpacing+tickBaseValue);return mainTickValues}function setResultObject(result,mainTickValues,plotMin,plotMax){result.mainTickValues=mainTickValues,result.plotMin=plotMin,result.plotMax=plotMax}function determineSubCase(){return this.usedDataMax>=10*this.usedDataMin?1:this.usedDataMaxLogFloor===this.usedDataMinLogFloor?this.maxIsStrict&&this.minIsStrict?2:3:1}function sortArray(array){array.sort(function(a,b){return a-b})}function calculateForSubCase1(referenceTable,tickDataSpacing,initTickValues,tickMinIndex,tickMaxIndex,tickDataSpacingNNLog,tickBaseValueLog){var j,k,l1,l,mainTickValues,plotMin,plotMax,i=0,results=[];for(i=0;i<referenceTable.length;i++)if(tickDataSpacing<=referenceTable[i][0]+epsilon){for(mainTickValues=initTickValues.concat(),j=tickMinIndex;tickMaxIndex>j;j++)for(k=1;k<referenceTable[i].length;k++)mainTickValues.push(referenceTable[i][k]*Math.pow(10,j*tickDataSpacingNNLog+tickBaseValueLog));sortArray(mainTickValues),removeOutOfRangeTicks(mainTickValues,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],checkTickSpaceCondition.apply(this,[mainTickValues,plotMin,plotMax])&&results.push({mainTickValues:mainTickValues,plotMin:plotMin,plotMax:plotMax})}if(0===results.length)return mainTickValues=initTickValues,removeOutOfRangeTicks(mainTickValues,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],{mainTickValues:mainTickValues,plotMin:plotMin,plotMax:plotMax};if(1===results.length)return results[0];for(l=initTickValues.length-1,i=0;i<results.length;i++)if(l1=results[i].mainTickValues.length-1,results[i].mainTickValues[0]===initTickValues[0]&&results[i].mainTickValues[l1]===initTickValues[l])return results[i];return results[0]}function calculateForSubCase2(referenceTable,tickDataSpacing){var j,mainTickValues,plotMin,plotMax,table,n,cont=!0,from=Math.ceil(this.fractionMinLog),to=Math.floor(this.fractionMaxLog),i=0;if(referenceTable[from]&&referenceTable[from][to])for(table=referenceTable[from][to],table instanceof Array||(table=referenceTable[from][table]),n=table.length;n>i&&cont;){if(tickDataSpacing<=table[i][0]+epsilon&&table[i].length-2<=this.maxNumIntervals){for(mainTickValues=[],j=1;j<table[i].length;j++)mainTickValues.push(table[i][j]*this.dataMinMagnitude);cont=!checkTickSpaceCondition.apply(this,[mainTickValues,this.usedDataMin,this.usedDataMax])}cont&&i++}return cont&&(mainTickValues=[findGoodNumberBetweenMaxAndMin(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],{mainTickValues:mainTickValues,plotMin:plotMin,plotMax:plotMax}}function calculateForSubCase3(referenceTable,tickDataSpacing){var i,j,k,mainTickValues,plotMin,plotMax,fromToArray,numFromTos,from,to,table,n,b,min,max,idx1=this.minIsStrict?Math.ceil(this.fractionMinLog):Math.floor(this.fractionMinLog),idx2=this.maxIsStrict?Math.floor(this.fractionMaxLog):Math.ceil(this.fractionMaxLog),result={};if(controlTable[idx1]&&controlTable[idx1][idx2])for(fromToArray=controlTable[idx1][idx2],numFromTos=fromToArray instanceof Array?fromToArray.length/2:0,result.mainTickValues=[],i=0;numFromTos>i;i++)if(from=fromToArray[2*i],to=fromToArray[2*i+1],referenceTable[from]&&referenceTable[from][to])for(table=referenceTable[from][to],n=table.length,j=0;n>j;j++)if(b=tickDataSpacing<=table[j][0]+epsilon&&table[j].length-2<=this.maxNumIntervals,min=table[j][1]*this.dataMinMagnitude,max=table[j][table[j].length-1]*this.dataMinMagnitude,b=this.minIsStrict?b&&min>=this.usedDataMin:b&&min<=this.usedDataMin,b=this.maxIsStrict?b&&max<=this.usedDataMax:b&&max>=this.usedDataMax){for(mainTickValues=[],k=1;k<table[j].length;k++)mainTickValues.push(table[j][k]*this.dataMinMagnitude);if(removeOutOfRangeTicks(mainTickValues,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],checkTickSpaceCondition.apply(this,[mainTickValues,plotMin,plotMax])){result.mainTickValues.length<mainTickValues.length&&setResultObject(result,mainTickValues,plotMin,plotMax);break}}return result.mainTickValues&&0!==result.mainTickValues.length||(result.mainTickValues=[findGoodNumberBetweenMaxAndMin(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),mainTickValues=result.mainTickValues,result.plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],result.plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],result}function checkAgainstPattern(mainTickValues,partern,backward){var i,len=mainTickValues.length;if(backward){for(i=len-1;i>=0;i--)if(Math.abs(mainTickValues[i]-partern[i]*this.dataMinMagnitude)>epsilon)return!1;return!0}for(i=0;len>i;i++)if(Math.abs(mainTickValues[i]-partern[i]*this.dataMinMagnitude)>epsilon)return!1;return!0}function refineTickValues(result){var oldValue,newValue,mainTickValues=result.mainTickValues,len=mainTickValues.length;if(!(2>len||len>4))return newValue=5*this.dataMinMagnitude,(this.minIsStrict&&this.usedDataMin<=newValue||!this.minIsStrict&&this.usedDataMin>=newValue)&&(checkAgainstPattern.apply(this,[mainTickValues,[6,10,20,40]])||checkAgainstPattern.apply(this,[mainTickValues,[4,10,20,40]]))?(oldValue=mainTickValues[0],mainTickValues[0]=newValue,result.plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],void(checkTickSpaceCondition.apply(this,[mainTickValues,result.plotMin,result.plotMax])||(mainTickValues[0]=oldValue,result.plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0]))):(newValue=80*this.dataMinMagnitude,(this.maxIsStrict&&this.usedDataMax>=newValue||!this.maxIsStrict&&this.usedDataMax<=newValue)&&checkAgainstPattern.apply(this,[mainTickValues,[10,20,40,60],!0])?(oldValue=mainTickValues[len-1],mainTickValues[len-1]=newValue,result.plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[len-1],void(checkTickSpaceCondition.apply(this,[mainTickValues,result.plotMin,result.plotMax])||(mainTickValues[len-1]=oldValue,result.plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[len-1]))):void 0)}function calculateForLinearCase(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled,spaceUseLimit){var mainTickValues,plotMin,plotMax,fraction,result=AxisUtils.calculateTicks(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled,spaceUseLimit),minIsStrict=null!==explicitPlotMin,maxIsStrict=null!==explicitPlotMax,usedDataMin=minIsStrict?explicitPlotMin:dataMin,usedDataMax=maxIsStrict?explicitPlotMax:dataMax,numLoops=1;for(0===result.plotMin&&(result.plotMin=minIsStrict?explicitPlotMin:dataMin),mainTickValues=result.mainTickValues,plotMin=minIsStrict?explicitPlotMin:Math.min(dataMin,mainTickValues[0]),plotMax=maxIsStrict?explicitPlotMax:Math.max(mainTickValues[mainTickValues.length-1],dataMax);!checkTickSpaceCondition.apply(this,[mainTickValues,plotMin,plotMax])&&20>=numLoops;)result=increaseTickDataSpacing(minIsStrict||result.tickSpacing>usedDataMin,maxIsStrict,usedDataMin,usedDataMax,result.tickSpacing),mainTickValues=calculateTickValues(usedDataMin,usedDataMax,result.tickBaseValue,result.tickSpacing,minIsStrict,maxIsStrict),plotMin=minIsStrict?explicitPlotMin:Math.min(dataMin,mainTickValues[0]),plotMax=maxIsStrict?explicitPlotMax:Math.max(mainTickValues[mainTickValues.length-1],dataMax),numLoops++;return checkTickSpaceCondition.apply(this,[mainTickValues,plotMin,plotMax])?(fraction=AxisUtils.getFraction(mainTickValues[0])/2,2===mainTickValues.length&&mainTickValues[1]/mainTickValues[0]===2&&mainTickValues[0]/2>=plotMin&&fraction===Math.floor(fraction)&&(mainTickValues.splice(0,0,mainTickValues[0]/2),fraction=AxisUtils.getFraction(mainTickValues[0])/2,mainTickValues[0]/2>=plotMin&&fraction===Math.floor(fraction)&&mainTickValues.splice(0,0,mainTickValues[0]/2))):mainTickValues=[],result.mainTickValues=mainTickValues,result.numLoops=numLoops,result}function calculateForLogCase(){var usedDataMaxLogCeil,usedDataMiddleLog,closedValue,tickDataSpacing,tickDataSpacingNNLog,tickBaseValueLog,roughMainTicks,tickMinIndex,tickMaxIndex,i,initTickValues,subCase,mainTickValues,plotMin,plotMax,result={};if(this.maxIsStrict&&this.explicitPlotMax<=this.usedDataMin?(this.dataMinLog=Math.ceil(this.explicitPlotMaxLog-(this.maxNumIntervals<2?1:2)),this.dataMin=Math.pow(10,this.dataMinLog)):this.minIsStrict&&this.explicitPlotMin>=this.usedDataMax?(this.dataMaxLog=Math.floor(this.explicitPlotMinLog+(this.maxNumIntervals<2?1:2)),this.dataMax=Math.pow(10,this.dataMaxLog)):this.usedDataMin===this.usedDataMax&&(closedValue=this.usedDataMin,this.dataMinLog=Math.floor(this.dataMinLog),this.dataMaxLog=this.dataMinLog+1,this.dataMin=Math.pow(10,this.dataMinLog),this.dataMax=Math.pow(10,this.dataMaxLog)),this.usedDataMin=this.minIsStrict?this.explicitPlotMin:this.dataMin,this.usedDataMax=this.maxIsStrict?this.explicitPlotMax:this.dataMax,this.usedDataMinLog=this.minIsStrict?this.explicitPlotMinLog:this.dataMinLog,this.usedDataMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:this.dataMaxLog,this.maxNumIntervals<1)return setResultObject(result,[findGoodNumberBetweenMaxAndMin(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog,closedValue)],this.usedDataMin,this.usedDataMax),result;if(this.tickDataSpacingLog=(this.usedDataMaxLog-this.usedDataMinLog)/this.maxNumIntervals,this.usedDataMinLogFloor=Math.floor(this.usedDataMinLog),this.usedDataMaxLogFloor=Math.floor(this.usedDataMaxLog),this.dataMinMagnitude=Math.pow(10,this.usedDataMinLogFloor),this.fractionMinLog=this.usedDataMin/this.dataMinMagnitude,this.fractionMaxLog=this.usedDataMax/this.dataMinMagnitude,usedDataMaxLogCeil=Math.ceil(this.usedDataMaxLog),this.usedDataMinLog===this.usedDataMinLogFloor&&this.usedDataMaxLog===usedDataMaxLogCeil&&this.maxNumIntervals>=2&&this.maxNumIntervals<3&&this.tickDataSpacingLog>1&&this.tickDataSpacingLog-Math.floor(this.tickDataSpacingLog)<log10Of3&&(usedDataMiddleLog=Math.floor((this.usedDataMinLogFloor+usedDataMaxLogCeil)/2),mainTickValues=[Math.pow(10,this.usedDataMinLogFloor),3*Math.pow(10,usedDataMiddleLog),Math.pow(10,usedDataMaxLogCeil)],removeOutOfRangeTicks(mainTickValues,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),plotMin=this.minIsStrict?this.explicitPlotMin:mainTickValues[0],plotMax=this.maxIsStrict?this.explicitPlotMax:mainTickValues[mainTickValues.length-1],mainTickValues.length>=2&&checkTickSpaceCondition.apply(this,[mainTickValues,plotMin,plotMax])))return setResultObject(result,mainTickValues,plotMin,plotMax),result;if(roughMainTicks=calculateRoughMainTicks.call(this),!roughMainTicks.success)return setResultObject(result,[findGoodNumberBetweenMaxAndMin(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)],this.usedDataMin,this.usedDataMax),result;for(tickMinIndex=roughMainTicks.tickMinIndex,tickMaxIndex=roughMainTicks.tickMaxIndex,tickDataSpacingNNLog=roughMainTicks.tickDataSpacingNNLog,tickBaseValueLog=roughMainTicks.tickBaseValueLog,this.minIsStrict&&tickMinIndex--,this.maxIsStrict&&tickMaxIndex++,initTickValues=[],i=tickMinIndex;tickMaxIndex>=i;i++)initTickValues.push(Math.pow(10,i*tickDataSpacingNNLog+tickBaseValueLog));return tickDataSpacing=Math.pow(10,this.tickDataSpacingLog),subCase=determineSubCase.call(this),2===subCase?calculateForSubCase2.apply(this,[referenceTable2,tickDataSpacing]):3===subCase?calculateForSubCase3.apply(this,[referenceTable2,tickDataSpacing]):(result=calculateForSubCase1.apply(this,[referenceTable1,tickDataSpacing,initTickValues,tickMinIndex,tickMaxIndex,tickDataSpacingNNLog,tickBaseValueLog]),refineTickValues.call(this,result),result)}function calculateForTrivialCase(){var i,n,d,mainTickValues,result={};for(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,n=Math.floor(this.maxNumIntervals),d=(this.dataMaxLog-this.dataMinLog)/n,mainTickValues=[this.usedDataMin],i=0;n>i;i++)mainTickValues.push(Math.pow(10,this.dataMinLog+(i+1)*d));return setResultObject(result,mainTickValues,this.plotMin,this.plotMax),result}var AxisLogUtils,log10=Math.log(10),epsilon=1e-12,log10Of3=Math.log(3)/log10,referenceTable1=[[2,4,6],[2,4],[3]],referenceTable2=[,[,,[[1,2]],[[1,2,3],[1,3]],[[1,2,4],[1,4]],[[1,2,4],[1,5]],[[1,2,4,6],[2,4,6],[1,3,6],[1,6]],[[1,2,4,6],[2,4,6],[1,3,6],[1,7]],[[1,2,4,8],[2,4,8],[1,8]],[[1,2,4,8],[2,4,8],[1,3,9],[1,9]],[[1,2,4,6,10],[1,2,4,10],[1,3,10],[3,10],[1,10]]],[,,,[[2,3]],[[2,3,4],[2,4]],[[2,3,4],[2,4],[2,5]],[[2,4,6],[2,6]],[[2,4,6],[2,6],[2,7]],[[2,4,8],[2,8]],[[2,4,8],[2,8],[2,9]],[[2,4,6,10],[2,4,10],[5,10],[3,10]]],[,,,,[[3,4]],[[3,4,5],[3,5]],[[3,4,5,6],[3,6]],[[3,4,5,6],[3,5,7],[3,7]],[[3,4,5,6,8],[3,5,7],[4,8],[3,8]],[[3,4,5,6,8],[3,4,6,9],[3,4,6,8],[3,6,9],[4,8],[3,9]],[[4,6,10],[5,10],[3,10]]],[,,,,,[[4,5]],[[4,5,6],[4,6]],[[4,5,6,7],[4,5,6],[4,6]],[[4,5,6,7,8],[4,5,6,7],[4,6,8],[4,8]],[[4,5,6,7,8],[4,6,9],[4,6,8],[4,8]],[[4,6,10],[5,7,9],[5,10],[4,10]]],[,,,,,,[[5,6]],[[5,6,7],[5,7]],[[5,6,7,8],[5,6,7],[6,8]],[[5,6,7,8,9],[5,6,7,8],[5,7,9],[5,9]],[[6,8,10],[5,10]]],[,,,,,,,[[6,7]],[[6,7,8],[6,8]],[[6,7,8,9],[6,7,8],[6,9]],[[6,7,8,9,10],[6,8,10],[6,10]]],[,,,,,,,,[[7,8]],[[7,8,9],[7,9]],[[7,8,9,10],[8,10],[7,10],[7,9]]],[,,,,,,,,,[[8,9]],[[8,9,10],[8,10]]],[,,,,,,,,,,[[9,10]]]],controlTable=[,[,,[1,2],[1,3],[1,4],[1,5,1,6],[1,6],[1,10,1,8,1,7],[1,8,1,10],[1,10,1,9]],[,,,[2,3],[2,4],[2,6,2,5],[2,6,2,8],[2,8,2,7],[2,8,1,10],[1,10,2,10,2,9],[1,10,2,10]],[,,,,[3,4,2,4],[3,6,3,5],[3,6,2,6],[2,8,3,8,3,7],[2,8,3,8,3,9],[2,10,3,10,3,9]],[,,,,,[4,5,4,6,3,5],[4,6],[4,8,4,7],[4,8],[4,10,4,9,3,9],[4,10]],[,,,,,[5,6,4,6],[5,7,4,8],[4,8,5,8,5,10],[5,10,4,10,5,9],[5,10,4,10]],[,,,,,,[6,7,6,8],[6,8],[6,10,5,10,6,9],[6,10,5,10]],[,,,,,,,[7,8,6,8],[7,9,6,10],[6,10,7,10]],[,,,,,,,,[8,10,8,9],[8,10]],[,,,,,,,,,[9,10]]];return updateReferenceTables(),AxisLogUtils={calculateTicksLogPositive:function(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled){var temp,result1,result2,result={};return isNaN(explicitPlotMin)&&(explicitPlotMin=null),isNaN(explicitPlotMax)&&(explicitPlotMax=null),dataMin>dataMax&&(temp=dataMin,dataMin=dataMax,dataMax=temp),null!==explicitPlotMin&&null!==explicitPlotMax&&explicitPlotMin>explicitPlotMax&&(temp=explicitPlotMin,explicitPlotMin=explicitPlotMax,explicitPlotMax=temp),this.plotSize=plotSize,this.dataMin=dataMin,this.dataMax=dataMax,this.explicitPlotMin=explicitPlotMin,this.explicitPlotMax=explicitPlotMax,this.minTickSpacingInPixel=minTickSpacingInPixel,this.minIsStrict=null!==explicitPlotMin,this.maxIsStrict=null!==explicitPlotMax,this.usedDataMin=this.minIsStrict?explicitPlotMin:dataMin,this.usedDataMax=this.maxIsStrict?explicitPlotMax:dataMax,this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=plotSize/minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.explicitPlotMinLog=this.minIsStrict?AxisUtils.eliminateFloatingError(AxisUtils.log10(explicitPlotMin)):null,this.explicitPlotMaxLog=this.maxIsStrict?AxisUtils.eliminateFloatingError(AxisUtils.log10(explicitPlotMax)):null,this.dataMinLog=AxisUtils.eliminateFloatingError(AxisUtils.log10(dataMin)),this.dataMaxLog=AxisUtils.eliminateFloatingError(AxisUtils.log10(dataMax)),niceNumberEnabled&&0!==plotSize?this.minIsStrict&&this.maxIsStrict&&this.explicitPlotMin===this.explicitPlotMax?(setResultObject(result,[this.explicitPlotMin],this.explicitPlotMin,this.explicitPlotMax),result):(result2=calculateForLogCase.call(this),this.usedDataMax>=10*this.usedDataMin?result2:(result1=calculateForLinearCase.apply(this,[plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled]),result1.mainTickValues.length<2?result2:result2.mainTickValues.length<2?result1:result1.mainTickValues.length===result2.mainTickValues.length?(calculateSpaceDistributionFactor.call(this,result1),calculateSpaceDistributionFactor.call(this,result2),result1.factor>result2.factor?result1:result2):result1.mainTickValues.length-1>=1.5*(result2.mainTickValues.length-1)&&result1.mainTickValues.length>result2.mainTickValues.length?result1:result2)):calculateForTrivialCase.call(this)},calculateTicks:function(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled){var temp,result,result2,array1,array2,len,i;if(isNaN(explicitPlotMin)&&(explicitPlotMin=null),isNaN(explicitPlotMax)&&(explicitPlotMax=null),dataMin>dataMax&&(temp=dataMin,dataMin=dataMax,dataMax=temp),null!==explicitPlotMin&&null!==explicitPlotMax&&explicitPlotMin>explicitPlotMax&&(temp=explicitPlotMin,explicitPlotMin=explicitPlotMax,explicitPlotMax=temp),0>=dataMin*dataMax&&(dataMin=null===explicitPlotMin?dataMin:explicitPlotMin,dataMax=null===explicitPlotMax?dataMax:explicitPlotMax),dataMin>0&&dataMax>0&&(null===explicitPlotMin||explicitPlotMin>0)&&(null===explicitPlotMax||explicitPlotMax>0))return result=AxisLogUtils.calculateTicksLogPositive(plotSize,dataMin,dataMax,explicitPlotMin,explicitPlotMax,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled),result.sign=1,result;if(0>dataMin&&0>dataMax&&(null===explicitPlotMin||0>explicitPlotMin)&&(null===explicitPlotMax||0>explicitPlotMax)){for(result2=AxisLogUtils.calculateTicksLogPositive(plotSize,-dataMax,-dataMin,null===explicitPlotMax?null:-explicitPlotMax,null===explicitPlotMin?null:-explicitPlotMin,minTickSpacingInPixel,fontHeight,niceNumberEnabled,spaceOptimizingEnabled),result={},result.plotMin=-result2.plotMax,result.plotMax=-result2.plotMin,array2=result2.mainTickValues,len=array2?array2.length:0,array1=new Array(len),i=0;len>i;i++)array1[i]=-array2[len-1-i];return result.mainTickValues=array1,result.sign=-1,result}return{plotMin:null===explicitPlotMin?dataMin:explicitPlotMin,plotMax:null===explicitPlotMax?dataMax:explicitPlotMax,mainTickValues:[]}}}}),define("objects.views/charts/components/axis/log-scale",["core.utils/class","../../utils/axis-utils","../../utils/axis-log-utils"],function(Class,AxisUtils,AxisLogUtils){var LogScale=Class.extend("LogScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(plotSize){this._plotSize=plotSize},getPositionOfValue:function(value){var valueLog10;return 0===value?this._usedDataMin>0?0:this._plotSize:(valueLog10=value>0?AxisUtils.log10(value):-AxisUtils.log10(-value),(valueLog10-this._plotMinLog10)/this._plotRangeLog10*this._plotSize)},getValueOfPosition:function(p){var value;return 0===p?0:(value=this._plotMinLog10+this._plotRangeLog10*p/this._plotSize,
this._usedDataMin>0?Math.pow(10,value):-Math.pow(10,-value))},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin,this._plotMinLog10=AxisUtils.log10(Math.abs(this.plotMin))*(this.plotMin<0?-1:1),this._plotMaxLog10=AxisUtils.log10(Math.abs(this.plotMax))*(this.plotMax<0?-1:1),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10},calculateTicks:function(){var result;result=AxisLogUtils.calculateTicks(this._calculationSize,this._usedDataMin,this._usedDataMax,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled),this.plotMin=result.plotMin,this.plotMax=result.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=result.tickMin,this.tickMax=result.tickMax,this.mainValues=result.mainTickValues,this.secondaryValues=[],this._dataSign=result.sign,this._tickSpacing=this.mainValues.length>1?this.mainValues[1]-this.mainValues[0]:this.plotMax-this.plotMin,this._plotMinLog10=this._dataSign*AxisUtils.log10(Math.abs(this.plotMin)),this._plotMaxLog10=this._dataSign*AxisUtils.log10(Math.abs(this.plotMax)),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10,0===this.mainValues.length&&this.mainValues.push(result.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1)},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return LogScale}),define("objects.views/charts/utils/tween",["core.utils/class","objects.utils/animation-frame"],function(Class,aF){"use strict";function ticker(){Tween.tick()&&(tickerID=aF.request(ticker))}function addTween(tween){tweens.push(tween),tween._isRunning=!0,null===tickerID&&(tickerID=aF.request(ticker))}function createProps(props,name){for(var p in props)this._props[p]||(this._props[p]={}),this._props[p][name]=Array.isArray(props[p])?props[p].slice():props[p]}function prepare(){var p,from,to,prop;for(p in this._props)if(prop=this._props[p],from="from"in prop?prop.from:this._target[p],to=prop.to,prop.from=from,Array.isArray(from)){var fromIds=from.map(function(obj){return obj.value}),toIds=to.map(function(obj){return obj.value});prop.fresh=to.filter(function(obj){return fromIds.indexOf(obj.value)<0}),prop.rotten=from.filter(function(obj){return toIds.indexOf(obj.value)<0}),prop.ripe=to.filter(function(obj){return fromIds.indexOf(obj.value)>=0}),prop.combined=prop.rotten.concat(prop.ripe).concat(prop.fresh),prop.isArray=!0}else isNaN(from)||isNaN(prop.to)||(prop.change=prop.to-from)}function isChanged(props){var p;for(p in props)if(props[p].isArray){if(props[p].fresh.length||props[p].rotten.length)return!0}else if(props[p].change)return!0;return!1}function updateProps(props,s,end){var i,p,prop,to,from,fresh,rotten;for(p in props){if(prop=props[p],to=prop.to,from=prop.from,prop.isArray){for(fresh=prop.fresh,rotten=prop.rotten,prop.value=end?prop.to:prop.combined,i=0;i<fresh.length;i++)fresh[i].opacity=s;for(i=0;i<rotten.length;i++)rotten[i].opacity=1-s;end&&(delete prop.combined,delete prop.fresh,delete prop.rotten,delete prop.ripe)}else!end&&"change"in prop?prop.value=from+prop.change*s:prop.value=to;end&&delete props[p].from}}var Tween,tickerID=null,tweens=[],enabled=!0,pi=Math.PI,cos=Math.cos;Tween=Class.extend("Tween",{init:function(target,props,duration,easing){var p,from,to,prop={},autoStart=!0;this._target=target,this._enabled=!0;for(p in props)from=Array.isArray(target[p])?target[p].slice():target[p],to=Array.isArray(props[p])?props[p].slice():props[p],prop[p]={from:from,to:to};this._props=prop,prepare.call(this),"object"==typeof duration?(this._duration=duration.duration||200,this._easing="function"==typeof duration.easing?duration.easing:Tween.easing[duration.easing||"linear"],autoStart=duration.autoStart!==!1):(this._duration=duration||200,this._easing="function"==typeof easing?easing:Tween.easing[easing||"linear"]),this._dfd=new Def,this._pos=0,this._isRunning=!1,autoStart&&(isChanged(this._props)?(this._startTime=Date.now(),addTween(this)):this._step(!0))},from:function(props){return this._isRunning||createProps.call(this,props,"from"),this},to:function(props){return this._isRunning||createProps.call(this,props,"to"),this},start:function(){return!this._isRunning&&this._enabled&&enabled&&(prepare.call(this),isChanged(this._props)?this._start():this._dfd.resolve()),this},willStart:function(){return!this._isRunning&&this._enabled&&enabled&&(prepare.call(this),isChanged(this._props))?!0:!1},stop:function(){return this._isRunning&&(this._isRunning=!1,tweens.splice(tweens.indexOf(this),1)),this},end:function(){return this._isRunning&&this._step(!0),this},then:function(){return this._dfd.then.apply(this._dfd,[].slice.call(arguments)),this},progress:function(){return this._dfd.progress.apply(this._dfd,[].slice.call(arguments)),this},isRunning:function(){return this._isRunning},on:function(){this._enabled=!0},off:function(){this._enabled=!1},destroy:function(){this.stop(),this._dfd.destroy()},_update:function(){var p;for(p in this._props)this._target[p]=this._props[p].value},_step:function(end){var idx,t=Date.now()-this._startTime;return t>=this._duration||end?(this._pos=1,this._isRunning=!1,idx=tweens.indexOf(this),idx>=0&&tweens.splice(idx,1),updateProps(this._props,this._pos,!0),this._update(),this._dfd.notify(t,t/this._duration,this._pos),void this._dfd.resolve()):(this._pos=this._easing(t/this._duration),updateProps(this._props,this._pos,!1),this._update(),void this._dfd.notify(t,t/this._duration,this._pos))},_start:function(){this._startTime=Date.now(),addTween(this),this._step()}}),Tween.off=function(){enabled=!1},Tween.on=function(){enabled=!0},Tween.tick=function(){var i,tween,tws=tweens.slice(),len=tws.length;for(i=0;len>i;i++)tween=tws[i],tween._step();return tweens.length?!0:(aF.cancel(tickerID),tickerID=null,!1)},Tween.clear=function(){},Tween.easing={linear:function(t){return t},easeInOut:function(t){return.5*(1-cos(t*pi))}},Tween.tweens=tweens;var Def=function(){this._onSuccess=[],this._onProgress=[],this._isResolved=!1};return Def.prototype={then:function(fn){this._onSuccess.push(fn),this._isResolved&&fn.call(null,[].slice.apply(arguments))},progress:function(fn){this._onProgress.push(fn)},resolve:function(){this._isResolved=!0;var i,len=this._onSuccess.length;for(i=0;len>i;i++)this._onSuccess[i].apply(null,[].slice.call(arguments))},notify:function(){var i,len=this._onProgress.length;for(i=0;len>i;i++)this._onProgress[i].apply(null,[].slice.call(arguments))},destroy:function(){this._onSuccess=[],this._onProgress=[]}},Tween}),define("objects.views/charts/components/axis/continuous-axis",["./axis","./linear-scale","./log-scale","objects.views/charts/components/axis/radial-axis-helper","util","objects.views/charts/utils/tween","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(Axis,LinearScale,LogScale,RadialAxisHelper,Util,Tween){"use strict";function getTicks(values){var i,x,ticks=[],num=values?values.length:0;for(i=0;num>i;i++)x=values[i],ticks.push({position:0,value:x,opacity:1});return ticks}function getLabels(ticks){var i,num=ticks?ticks.length:0,labels=[],values=[],positions=[],opacities=[],widths=[];if(ticks.forEach(function(t){positions.push(t.position),values.push(t.value),opacities.push("opacity"in t?t.opacity:1),labels.push(t.formatted||t.value+"")},this),1>=num)widths=[this._plotSize];else{for(widths[0]=Math.abs(ticks[1].position-ticks[0].position)/2+ticks[0].position,i=1;i<ticks.length-1;i++)widths.push(Math.abs(ticks[i].position-ticks[i-1].position)/2+Math.abs(ticks[i+1].position-ticks[i].position)/2);widths[i]=Math.abs(ticks[i].position-ticks[i-1].position)/2+(this._padding.left+this._plotSize-ticks[i].position)}return{values:values,widths:widths,positions:positions,opacities:opacities,labels:labels,labelMode:HORIZONTAL,labelSpace:this._wantedLabelSpace}}function getPreliminaryLabelSize(currentRect,fullRect){var f,r,wantedLabelSpace=0,size=currentRect[this._isVertical?"height":"width"],largestLabelSize=0,style=this._style;if(size-=this._isVertical?this._padding.top+this._padding.bottom:this._padding.left+this._padding.right,this.isRadial())wantedLabelSpace=2*Math.sin(this._relevantAngle/4)*this._fontHeight*style.label.lineHeight;else if(this._isVertical){if(this._calculateScale(size),f=this._formatter,r=this._renderer,f){var labelArray=this._scale.getValues().mainValues.map(function(value){return r.getTextWidth(f.formatValue(value)+"ml",style.label.font)});largestLabelSize=Math.max.apply(null,labelArray.length?labelArray:[0])}wantedLabelSpace=Math.min(fullRect[this._isVertical?"width":"height"]/3,largestLabelSize<this.outerRect.width/2?largestLabelSize:this.outerRect.width/3)}else wantedLabelSpace=this._fontHeight*style.label.lineHeight;return this._wantedLabelSpace=wantedLabelSpace,wantedLabelSpace}var ContinuousAxis,HORIZONTAL=1,transition={onProgress:function(){this._updateTickPositions(),this.invalidateDisplay(),this.fire("changed")},on:function(){this._tickTween.on(),this._linearTween.on()},off:function(){this._tickTween.off(),this._linearTween.off()},to:function(){this._linearTween.stop().to({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().to({ticks:this.ticks})},from:function(){this._linearTween.stop().from({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().from({ticks:this.ticks})},start:function(){this._scale===this._linearScale&&this._linearTween.willStart()&&(this._tickTween.start(),this._linearTween.start())},end:function(){this._scale===this._linearScale&&(this._tickTween.end(),this._linearTween.end())},stop:function(){this._tickTween.stop(),this._linearTween.stop()}};return ContinuousAxis=Axis.extend("ContinuousAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._scaleDetails={showExplicitMinMax:!0,niceNumberEnabled:!0,tickMultiplier:1},this.ticks=[],this.minorTicks=[],this._defaultFormatter={formatValue:function(v){return String(v)},format:function(v){return String(v)}},this._formatter=this._defaultFormatter,this._useLogScaleIfPossible=!1,this._linearScale=new LinearScale,this._logarithmicScale=new LogScale,this._scale=this._linearScale,this._cacheItems=null,this._useTransition=!1;var transitionProps={autoStart:!1,duration:500,easing:"easeInOut"};this._linearTween=new Tween(this._linearScale,{},transitionProps).progress(transition.onProgress.bind(this)),this._tickTween=new Tween(this,{},transitionProps)},setSelectableShapes:function(s){this._cacheItems=s},updateSize:function(){this._super(),this._calculationSize=this._plotSize,this._updateScaleAndTicks(),this._scale.setSize(this._plotSize),this._updateTickPositions(),transition.to.call(this),this._changed?(this._changed=!1,transition.start.call(this)):transition.end.call(this)},calculateValuePositionMappingInfo:function(){this._scale.setSize(this._plotSize),this._scale._calculationSize=this._plotSize,this._scale.calculateLimits()},setUseTransition:function(b){this._super(),transition[b?"on":"off"].call(this)},preRelevantSizeCalculation:function(){this._super(),this._areLabelsVisible=this.isVisible(this._layoutMode)&&this._showLabels},calculatePreliminaryLabelSpace:function(currentRect){var sizeForLabels=0;return this._areLabelsVisible&&(sizeForLabels=getPreliminaryLabelSize.call(this,currentRect,currentRect)),{relevantLabelSize:sizeForLabels||0,relevantSpacing:0}},calculateLabelSpace:function(currentRect,fullRect,centerRect){var sizeForLabels=0;return this._calculateScale(this._calculationSize),this._areLabelsVisible&&(sizeForLabels=getPreliminaryLabelSize.call(this,centerRect||currentRect,currentRect)),{relevantLabelSize:sizeForLabels||0,relevantSpacing:0}},_updateTickPositions:function(){for(var i=0;i<this.ticks.length;i++)this.ticks[i].position=Math.floor(this.getPositionOfValue(this.ticks[i].value))-.5;for(i=0;i<this.minorTicks.length;i++)this.minorTicks[i].position=Math.floor(this.getPositionOfValue(this.minorTicks[i].value))-.5;this._areLabelsVisible&&(this._levels=[getLabels.call(this,this.ticks)])},_generateLevels:function(){this._updateTickFormatting(this.ticks,this._formatter),this._levels=[getLabels.call(this,this.ticks)]},_calculateScale:function(size){if(0!==size){var s=this._scaleDetails,usedDataMin=isNaN(s.realDataMin)?s.dataMin:s.realDataMin,usedDataMax=isNaN(s.realDataMax)?s.dataMax:s.realDataMax,min=isNaN(s.explicitPlotMin)||null===s.explicitPlotMin?usedDataMin:s.explicitPlotMin,max=isNaN(s.explicitPlotMax)||null===s.explicitPlotMax?usedDataMax:s.explicitPlotMax,defaultLabelWidth=this.isRadial()?96:Math.max(96,this._getApproximateLabelWidth(min,max)),minTickSpacingInPixel=this.isVertical()?4*this._fontHeight:defaultLabelWidth,numTicks=Math.max(2,size/minTickSpacingInPixel/s.tickMultiplier+1);minTickSpacingInPixel=size/(numTicks-1),this._scale=this._linearScale,this._useLogScaleIfPossible&&min*max>0&&usedDataMin*usedDataMax>0&&(this._scale=this._logarithmicScale),s.usedDataMin=usedDataMin,s.usedDataMax=usedDataMax,s.defaultLabelWidth=defaultLabelWidth,s.minTickSpacingInPixel=minTickSpacingInPixel,s.numTicks=numTicks,s.plotSize=this._plotSize,s.calculationSize="undefined"!=typeof size?size:this._calculationSize,s.fontHeight=this._fontHeight,Object.keys(s).forEach(function(key){this._scale["_"+key]=s[key]},this),this._scale.calculateTicks()}},_getLabelWidthFromValues:function(values){var f=this._formatter,r=this._renderer,font=this._style.label.font;return f?Math.max.apply(null,values.map(function(value){return r.getTextWidth(f.formatValue(value)+"ml",font)})):0},_getApproximateLabelWidth:function(min,max){var f=this._formatter,r=this._renderer,font=this._style.label.font;return f?Math.max.apply(null,[min,max,(max-min)/2].map(function(value){return r.getTextWidth(f.formatValue(value),font)})):0},_generateTickObjects:function(scale,size){var values=scale.getValues();this.ticks=getTicks.call(this,values.mainValues,this._padding,size),this.minorTicks=getTicks.call(this,values.secondaryValues,this._padding,size)},_updateTickFormatting:function(ticks,formatter){var i,num=ticks?ticks.length:0;for(i=0;num>i;i++)ticks[i].formatted=formatter.formatValue(ticks[i].value)},setPlotMin:function(v){this._scaleDetails.explicitPlotMin="number"==typeof v?v:null,this.invalidateProperties("setPlotMin")},getPlotMin:function(){return this._scale.plotMin},setPlotMax:function(v){this._scaleDetails.explicitPlotMax="number"==typeof v?v:null,this.invalidateProperties("setPlotMax")},getPlotMax:function(){return this._scale.plotMax},setTickMultiplier:function(v){this._scaleDetails.tickMultiplier=v||1,this.invalidateProperties("setTickMultiplier")},setSpacingMode:function(m){this._scaleDetails.spacingMode=m,this.invalidateProperties("setSpacingMode")},getSpacingMode:function(){return this._scaleDetails.spacingMode},setShowExplicitMinMax:function(b){this._scaleDetails.showExplicitMinMax=b,this.invalidateProperties("setShowExplicitMinMax")},setLogScale:function(b){this._useLogScaleIfPossible=b,this.invalidateProperties("setLogScale")},getLogScale:function(){return this._scale===this._logarithmicScale},numberFormat:function(value,precision){return this._discrete?value:Util.numberFormat(value,precision?precision:this._precision,this._exponentUsed)},format:function(value){return this._discrete||!this._formatter?value+"":this._formatter.format(value,this._formatPattern)},getNumberFormatPrecision:function(){return this._precision},_transition:function(){this._onAnimatitonEnd()},setDataRangeTransition:function(b){this._transitionEnabled=b},setDataRange:function(min,max){return this._scaleDetails.dataMin=min,this._scaleDetails.dataMax=max,this.invalidateDisplay("setDataRange"),this.invalidateProperties("setDataRange"),this},setRealDataRange:function(min,max){this._scaleDetails.realDataMin=min,this._scaleDetails.realDataMax=max,this.invalidateProperties("setRealDataRange")},getDataMin:function(){return this._scaleDetails.dataMin},getDataMax:function(){return this._scaleDetails.dataMax},setNiceNumberEnabled:function(b){this._scaleDetails.niceNumberEnabled!==b&&(this._scaleDetails.niceNumberEnabled=b,this.invalidateProperties("setNiceNumberEnabled"))},setWhiteSpaceOptimizingEnabled:function(b){this._scaleDetails.whiteSpaceOptimizingEnabled=b,this.invalidateProperties("setWhiteSpaceOptimizingEnabled")},getLabels:function(){return this._levels},updateFormatter:function(){var indices=this.getType().indices;this._formatter=1===indices.length&&this.measureFormatters.length?this.measureFormatters[indices[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this._formatter.prepare&&this._formatter.prepare()},_onAnimatitonEnd:function(){this._super(),this.rect.width>0&&this.calculateLabelSpace(this.rect)},_updateProperties:function(){transition.from.call(this),this._changed=this._oldIsVertical===this.isVertical()&&"number"==typeof this._scale.plotRange&&!isNaN(this._scale.plotRange),this._oldIsVertical=this.isVertical(),this.updateFormatter(),this._isSizing||this._updateScaleAndTicks()},_updateScaleAndTicks:function(){this._calculateScale(this._calculationSize,this._calculatedPlotMin,this._calculatedPlotMax),this._generateTickObjects(this._scale,this._plotSize),this._updateTickPositions(),this._areLabelsVisible&&this._generateLevels()},clear:function(){this._linearTween.end(),this._tickTween.end(),this._super()},getWidthOfValue:function(){return 1},getPositionOfValue:function(value){var p,plotMin=this._scale.plotMin,plotRange=this._scale.plotRange;return p=0===plotRange?value>plotMin?100*this._plotSize:plotMin>value?100*-this._plotSize:this._plotSize/2:this._scale.getPositionOfValue(value),(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(p=this._plotSize-p),p+this._padding[this._isVertical?"top":"left"]},getPositionOfNormalizedValue:function(nValue){var plotMin=this._scale.plotMin,plotMax=this._scale.plotMax;return this.getPositionOfValue(nValue*(plotMax-plotMin)+plotMin)},getValueOfPosition:function(p){return this._plotSize<=0?NaN:(p-=this._padding[this._isVertical?"top":"left"],(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(p=this._plotSize-p),this._scale.getValueOfPosition(p))},getAngleOfValue:function(value){return RadialAxisHelper.getAngleOfNormalizedValue((value-this._scale.plotMin)/(this._scale.plotMax-this._scale.plotMin),this)},getAngleOfNormalizedValue:function(nValue){return RadialAxisHelper.getAngleOfNormalizedValue(nValue,this)}})}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(Class){"use strict";function shapeIsNaN(shape){var rect=shape.getBoundingRect();return isNaN(rect.x+rect.y+rect.width+rect.height)}var CacheItem=Class.extend({init:function(dimensions,measures,values,labels,row,col,id){if(dimensions&&!(dimensions instanceof Array)||measures&&!(measures instanceof Array)||values&&!(measures instanceof Array)||labels&&!(values instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=values||[],this.labels=labels||[],this.row=row,this.col=col,this.id=id,this.parent=void 0,this.children=[],this._dimensions=dimensions||[],this._measures=measures||[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(id){id&&this._objectShapes[id]&&(this._objectShapes[id]=[]),this._shapes=[];for(var i in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[i])},getShapes:function(id){return id?this._objectShapes[id]||(this._objectShapes[id]=[]):this._shapes},getShapeBounds:function(id){if(this._calculateTooltipPosition&&id){var shapes=this.getShapes(id),bounds=shapes.map(function(s){return s.getBoundingRect()});if(bounds=bounds.filter(function(r){return!shapeIsNaN(r)}),bounds.length){var rect=bounds.reduce(function(prev,current){return prev.combineWith(current)},bounds[0]);return rect}return null}return null},addShape:function(id,shape,isTooltipHandle){if(shape instanceof Array&&(!shape[0].pointInside||!shape[0].getBoundingRect)||!shape.pointInside||!shape.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[id]instanceof Array||(this._objectShapes[id]=[]),this._objectShapes[id].push(shape),this._shapes.push(shape),isTooltipHandle&&(this._tooltipShape=shape,this._tooltipShapeComponent=id)},addMeasure:function(measureName,value,label){this.values.push(value),this.labels.push(label),this._measures.push(measureName)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(item,index){return index})},addDimension:function(dimension){this._dimensions.push(dimension)},getDimensions:function(){return this._dimensions},getValue:function(measureIndex){return measureIndex=measureIndex||0,this.values[measureIndex]},getPreformattedLabel:function(measureIndex){return measureIndex=measureIndex||0,this.labels[measureIndex]},getCombinedElementID:function(){for(var current=this,ret=[current.id];current.parent;)current=current.parent,ret.push(current.id);return ret.reverse(),ret.join(",")}});return CacheItem.prototype.isCacheItem=!0,Object.defineProperties(CacheItem.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(v){this._calculateTooltipPosition=v},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(v){this._interactPosition=v},get:function(){return this._interactPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),CacheItem}),define("objects.views/selections/cache-item-combo",["./cache-item-base"],function(CacheItem){"use strict";var ComboCacheItem=CacheItem.extend({addShape:function(id,shape,isTooltipHandle,measures){this._super(id,shape,isTooltipHandle),void 0!==measures&&(this._shapeMeasures||(this._shapeMeasures=[]),this._shapeMeasures.push(measures))},getMeasuresIndecies:function(shape){if(this._shapeMeasures&&void 0!==this._shapeMeasures[this._shapes.indexOf(shape)]){var measure=this._shapeMeasures[this._shapes.indexOf(shape)];return void 0!==measure?[measure]:[]}return this._super()}});return ComboCacheItem}),define("objects.views/charts/chart-data-helper",["objects.views/charts/utils/tree-node","objects.views/selections/cache-item-combo"],function(TreeNode,CacheItem){function getCurrentID(parent,node){var cI=parent?getClosestParentCacheItem(parent):null;if(cI){var parentDims=cI.getDimensions();if(parentDims.length)return node.qText+","+parentDims.join(",")}return node.qText}function getClosestParentCacheItem(parent){return"P"===parent.data.qType&&parent.parent?parent.parent.cacheItem:parent.cacheItem}function prepareData(data,measInfo,dimInfo){var outData,root=new TreeNode,cacheItems=[],cacheMap=[];return data&&data.length?(rowIndex=0,levelDepth=0,addMeasureNode=measInfo&&measInfo.length<2,measureInfo=measInfo,dimensionInfo=dimInfo,root.data.qApprMaxGlyphCount=dimensionInfo[0]?dimensionInfo[0].qApprMaxGlyphCount:0,outData=connectNodes(data[0].qSubNodes,root,cacheItems,cacheMap,0),{dimensionTree:outData,cacheItems:cacheItems}):{dimensionTree:root,cacheItems:[]}}function connectNodes(indata,outdata,cacheItems,cacheMap,dimLevel){var node,parentNode,i,j,cI,cIDims;for(cacheMap[levelDepth]||(cacheMap[levelDepth]={}),i=0;i<indata.length;i++)if("T"!==indata[i].qType){if(node=new TreeNode,node.data.qType=indata[i].qType,node.data.qMaxPos=indata[i].qMaxPos,node.data.qMinNeg=indata[i].qMinNeg,"P"===indata[i].qType&&(pseudoNode=indata[i]),"V"===indata[i].qType||"E"===indata[i].qType||"P"===indata[i].qType?(node.data.qText=indata[i].qText,node.data.qNum=indata[i].qNum,node.data.qValue=indata[i].qValue,node.data.rowIndex=0,addMeasureNode?(parentNode=new TreeNode,parentNode.data.qType="_M",parentNode.data.qMaxPos=node.data.qMaxPos,parentNode.data.qMinNeg=node.data.qMinNeg,parentNode.data.qText=measureInfo[0].qFallbackTitle,parentNode.data.rowIndex=indata[i].qRow,parentNode.addChild(node),node=parentNode):node.data.rowIndex=indata[i].qRow):(node.data.qText="O"===indata[i].qType&&dimensionInfo[dimLevel]?dimensionInfo[dimLevel].othersLabel||"":indata[i].qText,dimensionInfo[dimLevel+1]&&(node.data.qApprMaxGlyphCount=dimensionInfo[dimLevel+1].qApprMaxGlyphCount),node.data.qElemNo=indata[i].qElemNo,node.data.rowIndex=indata[i].qRow),outdata.addChild(node),"V"!==indata[i].qType&&"P"!==indata[i].qType){var currentID=getCurrentID(outdata,indata[i]);if(cacheMap[levelDepth][currentID]&&pseudoNode)cI=cacheMap[levelDepth][currentID],node.cacheItem=cI;else{cI=new CacheItem(null,null,null,null,indata[i].qRow,levelDepth),node.cacheItem=cI,cI.addDimension(node.data.qText),cI.id=indata[i].qElemNo;var pCI=getClosestParentCacheItem(outdata);if(pCI){cI=node.cacheItem,cI.parent=pCI,pCI.children.push(cI),cIDims=cI.parent.getDimensions();for(j in cIDims)cI.addDimension(cIDims[j])}cacheMap[levelDepth][currentID]=cI}}"V"===indata[i].qType&&(cI=getClosestParentCacheItem(outdata),cI&&(cI.addMeasure(pseudoNode?pseudoNode.qText:node.data.qText,indata[i].qValue,indata[i].qText),cacheItems.contains(cI)||cacheItems.push(cI))),indata[i].qSubNodes&&indata[i].qSubNodes.length>0&&(levelDepth++,node=connectNodes(indata[i].qSubNodes,node,cacheItems,cacheMap,dimLevel+("N"===indata[i].qType||"O"===indata[i].qType?1:0)))}return 0===--levelDepth&&rowIndex++,outdata}var rowIndex,levelDepth,addMeasureNode,measureInfo,dimensionInfo,pseudoNode;return{prepareData:prepareData}}),define("objects.views/charts/chart-context",["./events/event-launcher","objects.views/charts/utils/tree-node","objects.views/charts/chart-data-helper","objects.views/selections/cache-item-combo"],function(EventLauncher,TreeNode,ChartDataHelper,CacheItem){"use strict";function getNewNode(tx,ti,id,idx){var node=new TreeNode;return node.text=tx,node.title=ti,node.id=id,node.idx=idx,node}function getNewerNode(parent,attrs){var key,node=new TreeNode;node.data.qApprMaxGlyphCount=0;for(key in attrs)node.data[key]=attrs[key];return parent&&parent.addChild(node),node}var ChartContext;return ChartContext=EventLauncher.extend({init:function(data){this._super(),this._properties={},data&&this.refresh(data)},refresh:function(data){this._data=data,this._qDataObject=data.qHyperCube?data.qHyperCube:data.qListObject;var treeDef;if(this._qDataObject.qStackedDataPages&&this._qDataObject.qStackedDataPages.length>0)treeDef=this._generatePivotTree();else{if(!(this._qDataObject.qDataPages&&this._qDataObject.qDataPages.length>0))return;treeDef=this._generateDimensionTree()}this._dimensionTree=treeDef?treeDef.dimensionTree:null,this._cacheItems=treeDef?treeDef.cacheItems:null,this.fire("dimensionTreeChanged")},bindProperty:function(){throw new Error("ChartContext bindProperty: Deprecated")},unBindProperty:function(){throw new Error("ChartContext unBindProperty: Deprecated")},releaseAll:function(){throw new Error("ChartContext releaseAll: Deprecated")},release:function(){this._data=null,this._dimensionTree=null,this._cacheItems=null,this._qDataObject=null},_generateDimensionTree:function(){var row,dim,currentNode,newNode,valueNode,i,j,k,index,containsLabel,cI,cIDims,temp,root=getNewNode(),matrix=this.getDataMatrix(),qDataObject=this._qDataObject,measures=qDataObject.qMeasureInfo,dimensions=qDataObject.qDimensionInfo,rowOffset=qDataObject.qDataPages[0].qArea.qTop,tails=qDataObject.qDataPages[0].qTails,numMeasures=measures.length,numDimensions=dimensions.length,cubeWidth=matrix&&matrix[0]?matrix[0].length:0,dimMap=[],cacheItems=[];for(j=0,i=0;numDimensions>i;i++)dimensions[i].qError||(dimMap[j]=i,j++);if(numDimensions=j,0===numDimensions)return null;for(containsLabel=function(array,str,num){for(var ii=0;ii<array.length;ii++)if(array[ii].data.qText===str&&array[ii].data.qNum===num)return ii;return-1},i=0;i<matrix.length;i++){for(row=matrix[i],currentNode=root,j=0;numDimensions>j;j++){if(dim=row[j],!dim)return;if(index=dim.qIsOtherCell?void 0===currentNode.data.othersIndex?-1:currentNode.data.othersIndex:containsLabel(currentNode.children,dim.qText,dim.qNum),-1===index){if(newNode=getNewerNode(currentNode,{qElemNo:row[j].qElemNumber,qText:row[j].qText,rowIndex:rowOffset+i,type:"dimension"}),void 0!==typeof row[j].qNum&&(newNode.data.qNum=row[j].qNum),dim.qIsOtherCell&&(newNode.data.qIsOtherCell=!0,newNode.data.qText=dimensions[dimMap[j]].othersLabel||""),dim.qIsTotalCell&&(newNode.data.qIsTotalCell=!0),currentNode.data.qApprMaxGlyphCount=dimensions[dimMap[j]].qApprMaxGlyphCount,dim.qIsOtherCell&&(currentNode.data.othersIndex=currentNode.children.length-1),cI=new CacheItem([newNode.data.qText],null,null,null,rowOffset+i,j,newNode.data.qElemNo),currentNode.cacheItem){cI.parent=currentNode.cacheItem,cI.parent.children.push(cI),cIDims=cI.parent.getDimensions();for(temp in cIDims)cI.addDimension(cIDims[temp])}newNode.cacheItem=cI,currentNode=newNode}else currentNode=currentNode.children[index]}for(k=0;numMeasures>k&&cubeWidth>numDimensions+k;k++)newNode=getNewerNode(currentNode,{qText:measures[k].qFallbackTitle,qNum:row[numDimensions+k].qNum,rowIndex:rowOffset+i,type:"measure"}),currentNode.data.qApprMaxGlyphCount=Math.max(currentNode.qApprMaxGlyphCount,measures[k].qApprMaxGlyphCount),cI=currentNode.cacheItem,cI.addMeasure(newNode.data.qText,newNode.data.qNum,row[numDimensions+k].qText),0===k&&cacheItems.push(cI),valueNode=new TreeNode,valueNode.data={qText:row[numDimensions+k].qText,qNum:row[numDimensions+k].qNum,qElemNo:row[numDimensions+k].qElemNumber,qState:row[numDimensions+k].qState},newNode.addChild(valueNode)}return tails&&tails[0]&&(tails[0].qUp>0||tails[0].qDown>0)&&(root.children[root.children.length-1].incomplete=!0),{dimensionTree:root,cacheItems:cacheItems}},_generatePivotTree:function(){return ChartDataHelper.prepareData(this._qDataObject.qStackedDataPages[0].qData,this._qDataObject.qMeasureInfo,this._qDataObject.qDimensionInfo)},_extractProperties:function(){throw new Error("ChartContext _extractProperties: Deprecated")},_updateProperty:function(){throw new Error("ChartContext _updateProperty: Deprecated")},getDataMatrix:function(){return this._qDataObject.qDataPages[0].qMatrix},getDimensionTree:function(){return this._dimensionTree},getCacheItems:function(){return this._cacheItems}})}),define("objects.views/charts/events/chart-event",["core.utils/class"],function(Class){"use strict";return Class.extend({init:function(type){this._type=type},getType:function(){return this._type}})}),define("objects.views/charts/events/property-change-event",["objects.views/charts/events/chart-event"],function(ChartEvent){"use strict";return ChartEvent.extend({init:function(property,oldValue,newValue){this._super("propertyChange"),this.property=property,this.oldValue=oldValue,this.newValue=newValue}})}),define("objects.views/charts/utils/binding",["core.utils/class","objects.views/charts/events/event-launcher","objects.views/charts/events/property-change-event"],function(Class,EventLauncher,PropertyChangeEvent){function createChangeWatcher(){var host,hostPropertyChain,chain,props,hostProp,supressUpdate,link,i;for(4===arguments.length?(chain=new Chain(arguments[0]),host=arguments[1],hostPropertyChain=arguments[2],supressUpdate=arguments[3]):(chain=new Chain(arguments[0],arguments[1]),host=arguments[2],hostPropertyChain=arguments[3],supressUpdate=arguments[4]),
props=hostPropertyChain.split("."),hostProp=props[0],i=0;i<props.length;i++)link=new Link(host,hostProp),chain.add(link),host=host&&"function"==typeof host[getter(hostProp)]?host[getter(hostProp)]():void 0,hostProp=props[i+1];return chain.startObserving(supressUpdate),new ChangeWatcher(chain)}function getter(property){return"get"+property.substring(0,1).toUpperCase()+property.substring(1)}function wrapSetter(host,prop){var oldFunc,isOriginalOwn,capiProp=prop.substring(0,1).toUpperCase()+prop.substring(1);"function"==typeof host["set"+capiProp]&&(host[setterList]||(host[setterList]={}),void 0===host[setterList][prop]?(oldFunc=host["set"+capiProp],isOriginalOwn=host.hasOwnProperty("set"+capiProp),host["set"+capiProp]=function(value){var oldValue="function"==typeof host["get"+capiProp]?host["get"+capiProp]():void 0;return"function"==typeof host["get"+capiProp]&&value===oldValue?void oldFunc.call(host,value):(oldFunc.call(host,value),void host.fire(new PropertyChangeEvent(prop,oldValue,value)))},host[setterList][prop]={observers:1,original:oldFunc,isOriginalOwn:isOriginalOwn,keep:!1}):host[setterList][prop].observers++)}var Link,Chain,ChangeWatcher,Binding,setterList="__setters";return Link=EventLauncher.extend("Link",{init:function(host,property){this._super(),this._property=property,this._host=host},setHost:function(h){this._host===h&&this._hostObserved||(this.unobserve(),this._host=h,this.observe())},observe:function(supressUpdate){if(!this._host)return void this.fire("hostPropertyValueChanged",[void 0]);wrapSetter(this._host,this._property);var self=this,sourceCapiProp=getter(this._property);this._callback=function(e){e.property===self._property&&self.fire("hostPropertyValueChanged",[e.newValue])},this._callbackSimple=function(){"function"==typeof this[sourceCapiProp]&&self.fire("hostPropertyValueChanged",[this[sourceCapiProp]()])},supressUpdate||"function"!=typeof this._host[sourceCapiProp]||self.fire("hostPropertyValueChanged",[this._host[sourceCapiProp]()]),this._host.listen("propertyChange",this._callback),this._host.listen(this._property+"Changed",this._callbackSimple),this._hostObserved=!0},unobserve:function(){if(this._host){if(this._callback&&this._host.stopListen("propertyChange",this._callback),this._callbackSimple&&this._host.stopListen(this._property+"Changed",this._callbackSimple),this._host[setterList]&&this._host[setterList][this._property]){var setterName,setterObject=this._host[setterList][this._property];setterObject.observers--,setterObject.observers<=0&&(setterName="set"+this._property.substring(0,1).toUpperCase()+this._property.substring(1),setterObject.isOriginalOwn?this._host[setterName]=setterObject.original:(this._host[setterName]=null,delete this._host[setterName]),setterObject.original=null,this._host[setterList][this._property]=null,delete this._host[setterList][this._property])}this._host=void 0,this._callback=void 0,this._callbackSimple=void 0,this._hostObserved=!1}}}),Chain=Class.extend("Chain",{init:function(wannabe,wannabeProp){this._links=[],1===arguments.length&&"function"==typeof wannabe?this._setter=wannabe:(this._wannabe=wannabe,this._wannabeProp=wannabeProp)},add:function(link){var linkIdx,self=this;link.listen("hostPropertyValueChanged",function(value){if(linkIdx=self._links.indexOf(this),linkIdx===self._links.length-1)if(self._setter)self._setter(value);else{var setterName="set"+self._wannabeProp.substring(0,1).toUpperCase()+self._wannabeProp.substring(1);"function"==typeof self._wannabe[setterName]&&self._wannabe[setterName](value)}else self._links[linkIdx+1].setHost(value)}),this._links.push(link)},startObserving:function(supressUpdate){this._links[0].observe(supressUpdate)},isBroken:function(){return this._isBroken},unwatch:function(){for(var link=this._links.pop();link;)link.unobserve(),link.stopListen("hostPropertyValueChanged"),link=this._links.pop();this._setter=void 0,this._wannabe=void 0,this._wannabeProp=void 0}}),ChangeWatcher=Class.extend("ChangeWatcher",{init:function(chain){this._chain=chain},unbind:function(){this._chain.unwatch()}}),Binding={},Binding.bindProperty=function(target,targetProperty,host,hostPropertyChain,supressUpdate){return createChangeWatcher(target,targetProperty,host,hostPropertyChain,supressUpdate)},Binding.bindSetter=function(setter,host,hostPropertyChain,supressUpdate){return createChangeWatcher(setter,host,hostPropertyChain,supressUpdate)},Binding.getter=getter,Binding}),define("objects.views/charts/components/mini-chart",["./chart-component","../components/axis/continuous-axis","../components/data-area","../chart-context","objects.views/charts/utils/binding","general.utils/color","core.utils/deferred"],function(ChartComponent,ContinuousAxis,DataArea,ChartContext,Binding,Color,Deferred){function getPartialCopy(data,create){var prop,partial={};if(create)for(prop in data)"qHyperCube"===prop?partial[prop]={qDataPages:[],qDimensionInfo:data.qHyperCube.qDimensionInfo.slice(),qMeasureInfo:data.qHyperCube.qMeasureInfo.slice(),qStackedDataPages:[],qMode:"S",qSize:{qcx:2,qcy:0}}:partial[prop]=data[prop];else{if(!data.reducedHyperCube)return data;partial={};for(prop in data)"qHyperCube"===prop?partial[prop]=data.reducedHyperCube:partial[prop]=data[prop]}return partial}var MiniChart;return MiniChart=ChartComponent.extend("MiniChart",{init:function(container,options){this._super.apply(this,Array.prototype.slice.call(arguments)),this.components={},this.options=options,this._chartContext=new ChartContext,this._createComponents();var disabledColor=12303291;this._colorMap=void 0,this._constantColorMap={getColorByNode:function(){return new Color(disabledColor)},getColor:function(){return new Color(disabledColor)}},this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(this._constantColorMap),this.components.dataArea.setLayoutMode(3),Binding.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree"),this._logScale=!1},setData:function(data){if(!data||!data.qHyperCube)return Deferred.resolve();this._data=null;var reducedData,cube,srcCube=data.qHyperCube,self=this,nrInContext=Math.min(2e3,1e4/(srcCube.qMeasureInfo.length+1)),zoomLevel=-1,isStackedDims=("linechart"===data.visualization||"barchart"===data.visualization&&data.barGrouping&&"stacked"===data.barGrouping.grouping)&&srcCube.qDimensionInfo.length>1&&"K"===srcCube.qMode?1:0;return"function"!=typeof this.backendApi.getReducedData?(this._data=getPartialCopy(data),this.invalidateProperties()):(reducedData=getPartialCopy(data,!0),data.reducedHyperCube=reducedData.qHyperCube,cube=data.reducedHyperCube,this.backendApi.getReducedData([{qTop:0,qLeft:isStackedDims,qWidth:data.qHyperCube.qDimensionInfo.length+data.qHyperCube.qMeasureInfo.length+isStackedDims,qHeight:nrInContext}],zoomLevel).then(function(dataPages){return cube.qDataPages=dataPages,self._data=reducedData,isStackedDims&&dataPages&&(dataPages[0].isReduced||dataPages[0].qIsReduced)&&(cube.qDimensionInfo=srcCube.qDimensionInfo.slice(0,1),cube.qMeasureInfo=[srcCube.qMeasureInfo[0],srcCube.qMeasureInfo[0]]),self.invalidateProperties()}))},calculateRelevantSize:function(){this.relevantSize=Math.max(30,Math.min(40,this.outerRect[this.isVertical()?"width":"height"]/8))},setRect:function(x,y,w,h){this._super(x,y,w,h);for(var k in this.components)this.components[k].setRect(0,0,w,h);this.updateSize()},setOuterRect:function(x,y,w,h){this._super(x,y,w,h);for(var k in this.components)this.components[k].setOuterRect(x,y,w,h)},setLayoutToContainerRatios:function(x,y){this._super(x,y);for(var k in this.components)this.components[k].setLayoutToContainerRatios(x,y)},setContainerRect:function(x,y,w,h){this._super(x,y,w,h);for(var k in this.components)this.components[k].setContainerRect(x,y,w,h)},updateSize:function(){this._super();for(var k in this.components)this.components[k].updateSize()},isVisible:function(layoutMode){return this._super(layoutMode)&&this.rect&&this.rect.width>0&&this.rect.height>0},setLogScale:function(b){this._logScale=b,this._logScale!==!0&&(this._logScale=!1)},getLogScale:function(){return this._logScale},setHasValidData:function(b){this._super(b),Object.keys(this.components).forEach(function(key){this.components[key].setHasValidData(b)},this)},setDock:function(d){this._super(d),this.isVertical()?(this.components.measureAxis.setDock("top"),this.components.dimensionAxis.setDock("left")):(this.components.measureAxis.setDock("left"),this.components.dimensionAxis.setDock("bottom"))},paint:function(layoutMode,data){if(!data||!this.isVisible())return Deferred.resolve();this._super(layoutMode,data);var key,dfds=[];this.components.dataArea.rect=this.rect.clone(),this.components.dimensionAxis.rect=this.components.dataArea.rect,this.components.measureAxis.rect=this.components.dataArea.rect,this.components.dataArea.rect.x=0,this.components.dataArea.rect.y=0,this.components.dimensionAxis.invalidateProperties("MiniChart.paint"),this.components.dimensionAxis.updateNow(["properties"]),this.components.measureAxis.invalidateProperties("MiniChart.paint"),this.components.measureAxis.updateNow(["properties"]),this.components.dimensionAxis.calculateValuePositionMappingInfo(),this.components.measureAxis.calculateValuePositionMappingInfo();for(key in this.components)dfds.push(this.components[key].invalidateDisplay("MiniChart.paint"));return Deferred.all(dfds)},_createComponents:function(){var cmps=this.components,opts=this.options;Object.keys(opts.components).forEach(function(key){var klass,testID=[this.testId||"component",key].join("."),componentOptions=opts.components[key];if(componentOptions.label=key,"function"==typeof opts.components[key].clazz)klass=opts.components[key].clazz;else switch(key){case"dataArea":klass=DataArea;break;case"yAxis":case"measureAxis":klass=ContinuousAxis}klass&&(cmps[key]=new klass(this.container,componentOptions,testID)),cmps[key].setUseTransition&&cmps[key].setUseTransition(!1)},this)},updateColorMap:function(data){if(data&&data.qHyperCube&&data.qHyperCube.qDimensionInfo[0]){var reduxMode=data.qHyperCube.qDataPages[0]&&data.qHyperCube.qDataPages[0].qIsReduced;this.components.dataArea.setColorMap&&(reduxMode||!data.color.auto&&"byExpression"===data.color.mode?this.components.dataArea.setColorMap(this._constantColorMap):this.components.dataArea.setColorMap(this._colorMap))}},updateAxis:function(data){var measureAxis,dimensionAxis,major,minor,min,max;min=Math.min.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return v.qMin})),max=Math.max.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMax)}).map(function(v){return v.qMax})),measureAxis=this.components.measureAxis,dimensionAxis=this.components.dimensionAxis,measureAxis.setNiceNumberEnabled(!1),measureAxis.setLogScale(this._logScale),"barchart"===data.visualization&&(max=Math.max(0,max),min=Math.min(0,min)),minor=this.components.dataArea.getMinorAxisData(),minor&&(max=minor.max,min=minor.min),(min===max&&0===max||isNaN(min)&&isNaN(max))&&(max=10,min=-10,measureAxis.setDataRange(min,max)),major=this.components.dataArea.getMajorAxisData(),major?dimensionAxis.setDataRange(major.data,major.info):dimensionAxis.setDataRange([],[])},setBackendApi:function(backendApi){this.backendApi=backendApi},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setOrientation:function(value){this._orientation=value||"horizontal"},_updateProperties:function(){if(this._data){var data=this._data;this.updateColorMap(data),this._chartContext.refresh(data),this.components.dataArea.setData(data),this.components.dataArea.updateNow(["properties"]),this.updateAxis(data),this.invalidateDisplay("MiniChart._updateProperties")}},clear:function(){Object.keys(this.components).forEach(function(key){this.components[key].clear()},this)},release:function(){this._super(),Object.keys(this.components).forEach(function(key){this.components[key].release()},this)},showComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var r in this.components.dataArea.renderers)this.components.dataArea.renderers[r].show()},hideComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var r in this.components.dataArea.renderers)this.components.dataArea.renderers[r].hide()}}),Object.defineProperty(MiniChart.prototype,"className",{value:"MiniChart"}),MiniChart}),define("objects.views/charts/representation/legend-data-provider",["../events/event-launcher","objects.views/charts/utils/tree-iterator"],function(EventLauncher,TreeIterator){function generateTreeBasedMapping(byMeasure,dimIndex){var tree,mapItem,i,idArr,measures,numMeasures,nodeDepth,mapping=[],addedItems={},qDataObject=this._qDataObject,marker=this._legendMarker?this._legendMarker:"rect",dimensions=qDataObject?qDataObject.qDimensionInfo instanceof Array?qDataObject.qDimensionInfo:[qDataObject.qDimensionInfo]:null,cm=this._colorMap;if(dimIndex=void 0===dimIndex?dimensions.length-1:dimIndex,tree=this._dimensionTree,byMeasure)for(measures=qDataObject.qMeasureInfo,numMeasures=measures.length,i=0;numMeasures>i;i++)mapping.push({label:measures[i].qFallbackTitle,color:cm.getColor(0,0,i),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes?this._measureLegendTypes[i]||"box":"box"});else TreeIterator.each.call(tree,function(node){nodeDepth=TreeIterator.getLevel.call(node),nodeDepth-1===dimIndex&&-2!==node.data.qElemNo&&void 0===addedItems[node.data.qText]&&(idArr=[],idArr[dimIndex]=node.data.qElemNo,mapItem={label:-3!==node.data.qElemNo?node.data.qText:dimensions[0].othersLabel,color:cm.getColor(idArr,0,0,node.data.rowIndex),id:[node.data.qElemNo],index:node.data.rowIndex,type:"dimension",marker:marker},mapping.push(mapItem),addedItems[node.data.qText]=mapItem)});return mapping}function generateListBoxMapping(byExpression,dimIndex){var measures,numMeasures,y,i,node,idArr,mapItem,mapping=[],addedItems={},matrix=this._data.qListObject.qDataPages[0].qMatrix,qDataObject=this._qDataObject,dimensions=qDataObject?qDataObject.qDimensionInfo instanceof Array?qDataObject.qDimensionInfo:[qDataObject.qDimensionInfo]:null,cm=this._colorMap;if(dimIndex=void 0===dimIndex?dimensions.length-1:dimIndex,byExpression)for(measures=this._data.qListObject.qMeasureInfo,numMeasures=measures.length,i=0;numMeasures>i;i++)mapping.push({label:measures[i].qFallbackTitle,color:cm.getColor(0,0,i),id:[-1],type:"measure"});else for(y=0;y<matrix.length;y++)node=matrix[y][dimIndex],-3!==node.qElemNumber&&-2!==node.qElemNumbero&&void 0===addedItems[node.qText]&&(idArr=[],idArr[dimIndex]=node.qElemNumber,mapItem={label:node.qText,color:cm.getColor(idArr,0,0,y),id:[node.qElemNumber],type:"dimension"},mapping.push(mapItem),addedItems[node.qText]=mapItem);return mapping}var LegendDataProvider;return LegendDataProvider=EventLauncher.extend({init:function(data){this._data=data,this._colorMappings={}},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},getColorMapping:function(){if(!this._colorMap||!this._data)return[];var mapping,mode=this._colorMap.getLegendMode();return"primary"===mode[2]?[]:this._colorMappings[mode]?this._colorMappings[mode]:(mapping="box"===mode[0]&&"range"===mode[1]||"scale"===mode[0]?this._colorMap.generateScaleBasedMapping():this._data.qListObject?generateListBoxMapping.apply(this,["measure"===mode[2],this._colorMap.getDimensionIndex()[0]]):generateTreeBasedMapping.apply(this,["measure"===mode[2],this._colorMap.getDimensionIndex()[0]]),this._colorMappings[mode]=mapping,mapping)},setData:function(data){var qData=data.qHyperCube?data.qHyperCube:data.qListObject,qDimensionInfo=data.qHyperCube?data.qHyperCube.qDimensionInfo:[data.qListObject.qDimensionInfo];this._qDataObject=qData,this._data=data,data&&qData.qDataPages.length?this._others=qData.qDataPages[0].qMatrix.some(function(element){return qDimensionInfo&&qDimensionInfo.length&&element[qDimensionInfo.length-1].qIsOtherCell===!0}):this._others=!1,this._colorMappings={}},setDimensionTree:function(value){this._dimensionTree=value,this._colorMappings={}},setMeasureLegendTypes:function(types){this._measureLegendTypes=types},setLegendMarker:function(marker){this._legendMarker=marker},release:function(){this._colorMap=null,this._dimensionTree=null,this._data=null,this._qDataObject=null}})}),define("general.utils/color-cache",["./color"],function(Color){function create(Constructor,args){return function(){var inst,ret,Temp=function(){};return Temp.prototype=Constructor.prototype,inst=new Temp,ret=Constructor.apply(inst,args),Object(ret)===ret?ret:inst}}function increaseStack(){stackSize++}function retriveColor(){var inputString,argbString,i,color;if(arguments.length<3)"string"==typeof arguments[0]?inputString=arguments[0]:"number"==typeof arguments[0]&&arguments[0]>=0&&(inputString=arguments[0]+"");else if(arguments.length>=3)for(inputString=arguments[0],i=0;i>arguments.length;i++)inputString+=","+arguments[i];if(inputString&&inputMap[inputString])return inputMap[inputString];if(color=create(Color,arguments)(),argbString=color._r+","+color._g+","+color._b+","+color._a,argbMap[argbString])color=argbMap[argbString];else{if(stackSize>=stackMaxSize)return color;argbMap[argbString]=color,increaseStack()}return inputString&&(inputMap[inputString]=color),color}function retriveBlend(c1,c2,t){var argbString,color,r=floor(c1._r+(c2._r-c1._r)*t),g=floor(c1._g+(c2._g-c1._g)*t),b=floor(c1._b+(c2._b-c1._b)*t),a=floor(c1._a+(c2._a-c1._a)*t);if(argbString=r+","+g+","+b+","+a,argbMap[argbString])color=argbMap[argbString];else{if(color=create(Color,[r,g,b,a])(),stackSize>=stackMaxSize)return color;argbMap[argbString]=color,increaseStack()}return color}function clear(){inputMap={},argbMap={},stackSize=0}var inputMap={},argbMap={},stackMaxSize=5e3,stackSize=0,floor=Math.floor;return{retriveColor:retriveColor,retriveBlend:retriveBlend,clear:clear}}),define("objects.views/charts/representation/color-scale",["core.utils/class","general.utils/color-cache"],function(Class,Color){"use strict";function limitFunction(scaledValue,numEdges){var k;return scaledValue=min(max(.999999999999*(scaledValue+1e-12),1e-12),.999999999999),k=numEdges-scaledValue*numEdges}function getLevel(level){return level=level?level:this._startLevel,min(level,this._colorParts.length-1)}function reverseScale(parts){parts.forEach(function(element){element.forEach(function(pair){pair.reverse()}),element.reverse()})}var ColorScale,max=Math.max,min=Math.min,NaNColor=Color.retriveColor(13816530);return ColorScale=Class.extend({init:function(){this._colorParts=[],this._startLevel=0,this._reverse=!1},addColorPart:function(color1,color2,level){level=level||0,this._startLevel=max(level,this._startLevel),this._colorParts[level]||(this._colorParts[level]=[]),this._colorParts[level].push([Color.retriveColor(color1),Color.retriveColor(color2)])},setReverse:function(reverse){this._reverse!==reverse&&(this._reverse=reverse,reverseScale(this._colorParts))},getColor:function(scaledValue,level){var k,f,t,part,c1,c2,uc;return isNaN(scaledValue)?NaNColor:(level=getLevel.apply(this,[level]),k=limitFunction(scaledValue,this._colorParts[level].length),f=Math.floor(k),part=this._colorParts[level][f],c1=part[0],c2=part[1],t=k-f,uc=Color.retriveBlend(c1,c2,t))},getColors:function(array){var i,ret=[];for(i=0;i<array.length;i++)ret.push(this.getColor(array[i]));return ret},getLegendParts:function(level){var i,l,p,ret=[];for(level=getLevel.apply(this,[level]),l=this._colorParts[level].length,i=0;l>i;++i)p=this._colorParts[level][i],ret.push({grad:p,color:p[0],solid:p[0]===p[1],index:i});return ret}})}),define("objects.views/charts/representation/color-globals",[],function(){var colorStruct={};return colorStruct.qualitativeColors=[["#4477aa"],["#4477aa","#cc6677"],["#4477aa","#ddcc77","#cc6677"],["#4477aa","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#882255","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#88ccee","#44aa99","#117733","#999933","#ddcc77","#661100","#cc6677","#aa4466","#882255","#aa4499"]],colorStruct.largeQualitativeColors=["#99c867","#e43cd0","#e2402a","#66a8db","#3f1a20","#e5aa87","#3c6b59","#aa2a6b","#e9b02e","#7864dd","#65e93c","#5ce4ba","#d0e0da","#d796dd","#64487b","#e4e72b","#6f7330","#932834","#ae6c7d","#986717","#e3cb70","#408c1d","#dd325f","#533d1c","#2a3c54","#db7127","#72e3e2","#e2c1da","#d47555","#7d7f81","#54ae9b","#e9daa6","#3a8855","#5be66e","#ab39a4","#a6e332","#6c469d","#e39e51","#4f1c42","#273c1c","#aa972e","#8bb32a","#bdeca5","#63ec9b","#9c3519","#aaa484","#72256d","#4d749f","#9884df","#e590b8","#44b62b","#ad5792","#c65dea","#e670ca","#e38783","#29312d","#6a2c1e","#d7b1aa","#b1e7c3","#cdc134","#9ee764","#56b8ce","#2c6323","#65464a","#b1cfea","#3c7481","#3a4e96","#6493e1","#db5656","#747259","#bbabe4","#e33f92","#d0607d","#759f79","#9d6b5e","#8574ae","#7e304c","#ad8fac","#4b77de","#647e17","#b9c379","#8da8b0","#b972d9","#786279","#7ec07d","#916436","#2d274f","#dce680","#759748","#dae65a","#459c49","#b7934a","#51c671","#9ead3f","#969a5c","#b9976a","#46531a","#c0f084","#76c146","#bad0ad"],colorStruct.divColors=["#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e"].reverse(),colorStruct.divColorPyramid=[null,["#4477aa","#4477aa"].reverse(),["#99c7ec","#99c7ec","#f5a275","#f5a275"].reverse(),["#99c7ec","#99c7ec","#fffad2","#fffad2","#f5a275","#f5a275"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#fffad2","#fffad2","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#fffad2","#fffad2","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse()],colorStruct.seqColorPyramid=[null,["#d95f0e","#d95f0e"],["#fec44f","#fec44f","#d95f0e","#d95f0e"].reverse(),["#fed98e","#fed98e","#fb9a29","#fb9a29","#cc4c02","#cc4c02"].reverse(),["#fed98e","#fed98e","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#ec7014","#ec7014","#cc4c02","#cc4c02","#8c2d04","#8c2d04"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506","#662506"].reverse()],colorStruct.seqColors=["#fff7bc","#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506"].reverse(),colorStruct.primaryColor="#4477aa",colorStruct.othersColor="#a5a5a5",colorStruct.nullColor="#d2d2d2",colorStruct}),define("objects.views/charts/representation/sequential-color-map",["jquery","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher","objects.views/charts/representation/color-scale","objects.views/charts/representation/color-globals"],function($,Theme,Color,EventLauncher,ColorScale,ColorGlobals){"use strict";function createColorScale(colors,pyramid){var i,j,inner,cs=new ColorScale;if(pyramid){for(j=0;j<colors.length;j++)if(inner=colors[j])for(i=0;i<inner.length;i+=2)cs.addColorPart(inner[i],inner[i+1],j)}else for(i=0;i<colors.length;i+=2)cs.addColorPart(colors[i],colors[i+1]);return cs}function generateBaseMapping(qDataObject,explicitRange){var measures,dimensions,matrix,i,j,k,d,dim,mea,values,max,min,dataMaxMinValues,numUsedColors=[],useClientMaxMin=!1;if(!qDataObject||!qDataObject.qDataPages||!qDataObject.qDataPages.length)return[];for(measures=qDataObject.qMeasureInfo,dimensions=qDataObject.qDimensionInfo instanceof Array?qDataObject.qDimensionInfo:[qDataObject.qDimensionInfo],matrix=qDataObject.qDataPages[0].qMatrix,values=[],this._others=!1,dataMaxMinValues=[],this._dataMaxMinValues=null,j=dimensions.length,k=j;k<measures.length+j;k++){values[k-j]||(values[k-j]=[]),max=-Number.MAX_VALUE,min=Number.MAX_VALUE;matrixLoop:for(i=0;i<matrix.length;i++){for(d=0;j>d;d++){if(dim=matrix[i][d],-3===dim.qElemNumber&&d===dimensions.length-1){this._others=!0;continue matrixLoop}if(-2===dim.qElemNumber&&d===dimensions.length-1){this._null=!0;continue matrixLoop}}mea=matrix[i][k],mea&&(values[k-j].push(mea.qNum),isNaN(mea.qNum)||(max=Max(mea.qNum,max),min=Min(mea.qNum,min),useClientMaxMin=!0))}dataMaxMinValues.push({max:max,min:min}),qDataObject.qSize.qcy<=matrix.length&&!explicitRange?numUsedColors[k-j]=calculateNumberOfUsedColors(max,min,values[k-j],1,this.getLargestScaleSize()):numUsedColors[k-j]=this.getLargestScaleSize()}return qDataObject.qSize.qcy<=matrix.length&&!explicitRange&&useClientMaxMin&&(this._dataMaxMinValues=dataMaxMinValues),numUsedColors}function calculateNumberOfUsedColors(max,min,values,startScale,maxScale){var span,i,val,index,numCols=0,usedColors=[];if(span=(max-min)/(startScale+1),0===span)return 1;for(i=0;i<values.length;i++)val=.99*(values[i]-min),index=values[i]>max?Math.floor(max/span):values[i]<min?0:Math.floor(val/span),isNaN(index)||(usedColors[index]?usedColors[index]++:usedColors[index]=1);for(i=0;i<usedColors.length;i++)usedColors[i]&&numCols++;return startScale>=numCols||numCols>=maxScale?Math.max(numCols,startScale):calculateNumberOfUsedColors(max,min,values,++startScale,maxScale)}function populatePyramid(pyramid){var i,ret=[];for(i=0;i<pyramid.length;i++)pyramid[i]?ret.push(populateScale(pyramid[i],!1)):ret.push(null);return ret}function populateScale(scale,isGradient){var i=1,ret=[];for(ret.push(scale[0]),isGradient||ret.push(scale[0]);i<scale.length-1;i++)ret.push(scale[i]),ret.push(scale[i]);return i<scale.length&&(ret.push(scale[i]),isGradient||ret.push(scale[i])),ret}function initializeScales(theme){var scheme=theme.colorSchemes.ordinalScales[0];this._seqScale=createColorScale(populateScale(scheme.scale,"gradient"===scheme.type),"class-pyramid"===scheme.type),this._largestScaleSize=scheme.scale.length,scheme=theme.colorSchemes.ordinalScales[1],this._seqClasses=createColorScale(populatePyramid(scheme.scale),"class-pyramid"===scheme.type),this._largestScaleSize=Max(scheme.scale.length,this._largestScaleSize),scheme=theme.colorSchemes.ordinalScales[2],this._divScale=createColorScale(populateScale(scheme.scale,"gradient"===scheme.type),"class-pyramid"===scheme.type),this._largestScaleSize=Max(scheme.scale.length,this._largestScaleSize),scheme=theme.colorSchemes.ordinalScales[3],this._divClasses=createColorScale(populatePyramid(scheme.scale),"class-pyramid"===scheme.type),this._largestScaleSize=Max(scheme.scale.length,this._largestScaleSize),this._activeScale=this._seqScale}var SequentialColorMap,Max=Math.max,Min=Math.min;return SequentialColorMap=EventLauncher.extend({init:function(data){initializeScales.call(this,Theme),this._activeScale=this._seqScale,this._measure=0,this.setData(data)},setData:function(data){if(this._data=data,data){var colorProperties=data.color||{},qDataObject=data.qHyperCube?data.qHyperCube:data.qListObject,dimensions=qDataObject?qDataObject.qDimensionInfo instanceof Array?qDataObject.qDimensionInfo:[qDataObject.qDimensionInfo]:null;if(this._qDataObject=qDataObject,this._persistantColors=colorProperties.persistent!==!1,this._byExpression="byExpression"===colorProperties.mode,this._classes=!1,this._numUsedColors=generateBaseMapping.apply(this,[this._qDataObject,colorProperties.autoMinMax===!1||this._byExpression]),this._dimIndex=dimensions?dimensions.length-1:0,void 0!==colorProperties.measureScheme){var split=colorProperties.measureScheme.split("");"s"===split[0]?"c"===split[1]?(this._activeScale=this._seqClasses,this._classes=!0):this._activeScale=this._seqScale:"c"===split[1]?(this._activeScale=this._divClasses,this._classes=!0):this._activeScale=this._divScale}void 0!==colorProperties.reverseScheme&&(this._seqScale.setReverse(colorProperties.reverseScheme===!0),this._divScale.setReverse(colorProperties.reverseScheme===!0),this._divClasses.setReverse(colorProperties.reverseScheme===!0),this._seqClasses.setReverse(colorProperties.reverseScheme===!0))}},getColor:function(id,rowIndex,measureIndex,value){var color,sv,m,qDataObject=this._qDataObject;if(measureIndex=measureIndex||0,id=id instanceof Array?id[this._dimIndex]:id,-3===id)color=Color.retriveColor(ColorGlobals.othersColor);else if(-2===id||measureIndex>=qDataObject.qMeasureInfo.length)color=Color.retriveColor(ColorGlobals.nullColor);else{if(m=this._getMinMax(qDataObject.qMeasureInfo[measureIndex],measureIndex),!m||isNaN(value))return Color.retriveColor(ColorGlobals.nullColor);sv=m.min===m.max?.5:(value-m.min)/(m.max-m.min),color=this._activeScale.getColor(sv,this._getNumUsedColors(measureIndex))}return color},getActiveScale:function(){return this._activeScale},getLargestScaleSize:function(){return this._largestScaleSize||0},generateScaleBasedMapping:function(){var m,span,i,step,l,current,parts,p,result,scale,qDataObject=this._qDataObject,formatter=this.getValueFormatter();if(scale=this._activeScale,result=[],parts=scale.getLegendParts(this._getNumUsedColors(0)),m=this._getMinMax(qDataObject.qMeasureInfo[this._measure],this._measure),!m)return result;if(span=m.max-m.min,isNaN(span))return result;for(l=parts.length,step=span/l,current=m.max,!isNaN(m.measureMax)&&this._classes&&(p=$.extend(!0,{},parts[0]),p.isMax=!0,p.min=formatter.formatValue(current),p.id=[m.measureMax,current],p.type="range",result.push(p)),i=0;l-1>i;i++)p=parts[i],p.isMax=0===i,p.max=formatter.formatValue(current),p.min=formatter.formatValue(current-step),p.id=[current,current-step],p.type="range",current-=step,result.push(p);return p=parts[i],p.max=formatter.formatValue(current),p.min=formatter.formatValue(m.min),p.id=[current,m.min],p.type="range",result.push(p),!isNaN(m.measureMin)&&this._classes&&(p=$.extend(!0,{},parts[i]),p.max=formatter.formatValue(m.min),p.min=void 0,p.id=[m.min,m.measureMin],p.type="range",result.push(p)),result},getColorMapping:function(){return this.generateScaleBasedMapping()},getLegendMode:function(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function(){return this._qDataObject.qMeasureInfo[this._measure].qFallbackTitle},setMeasureFormatters:function(value){this._measureFormatters=value},setGenericFormatter:function(value){this._formatter=value},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function(v){return v}}},_getMinMax:function(measure,measureIndex){var ret;return this._data.color.autoMinMax===!1?ret={min:this._data.color.measureMin||0,max:this._data.color.measureMax||10}:this._dataMaxMinValues&&this._dataMaxMinValues[measureIndex]?this._dataMaxMinValues[measureIndex]:measure?{
min:measure.qMin,max:measure.qMax}:null},_getNumUsedColors:function(index){return this._numUsedColors[index]},calculateNumberOfUsedColors:calculateNumberOfUsedColors})}),define("objects.utils/date-formatter",["core.utils/class"],function(Class){"use strict";function pad(s,n){for(var i=s.length;n>i;i++)s="0"+s;return s}function parseDate(d,twelveFormat){var h=d.getHours(),day=d.getDay()-1;return twelveFormat&&(h%=12,h||(h=12)),0>day&&(day=6),{year:d.getFullYear(),month:d.getMonth(),day:day,date:d.getDate(),h:h,m:d.getMinutes(),s:d.getSeconds(),f:d.getMilliseconds(),t:d.getHours()>=12?"pm":"am"}}function getRemainder(value){var s=value.toString().split(".");return s[1]?s=Number("0."+s[1]):0}function parseIntervalDays(days){var d=days,h=24*getRemainder(d),m=60*getRemainder(h),s=60*getRemainder(m),ms=1e3*getRemainder(s);return{d:Math.floor(d),h:Math.floor(h),m:Math.floor(m),s:Math.floor(s),f:Math.round(ms)}}function parseInterval(days,pattern){var date,units=parseIntervalDays(days),d=units.d,h=units.h,m=units.m,s=units.s,f=units.f,w=0;return/w+|t+/gi.test(pattern)&&(date=new Date(1899,11,30+Math.floor(days),0,0,86400*(days-Math.floor(days))),isNaN(date.getTime())&&(date=null)),/D+/gi.test(pattern)||(h+=24*d),/h+/gi.test(pattern)||(m+=60*h),/m+/gi.test(pattern)||(s+=60*m),/w+/gi.test(pattern)&&(w=date?date.getDay()-1:0,0>w&&(w=6)),{year:0,month:0,day:w,date:d,h:h,m:m,s:s,f:f,t:date?date.getHours()>=12?"pm":"am":""}}function getMasks(inst,d){return{"Y+|y+":{Y:Number((d.year+"").slice(-2))+"",YY:pad((d.year+"").slice(-2),2),YYY:pad((d.year+"").slice(-3),3),def:function(m){return pad(d.year+"",m.length)}},"M+":{M:d.month+1,MM:pad(d.month+1+"",2),MMM:inst.locale_months_abbr[d.month],def:inst.locale_months[d.month]},"W+|w+":{W:d.day,WW:pad(d.day+"",2),WWW:inst.locale_days_abbr[d.day],def:inst.locale_days[d.day]},"D+|d+":{D:d.date,def:function(m){return pad(d.date+"",m.length)}},"h+|H+":{h:d.h,def:function(m){return pad(d.h+"",m.length)}},"m+":{m:d.m,def:function(m){return pad(d.m+"",m.length)}},"s+|S+":{s:d.s,def:function(m){return pad(d.s+"",m.length)}},"f+|F+":{def:function(m){var f=d.f+"",n=m.length-f.length;if(n>0)for(var i=0;n>i;i++)f+="0";else 0>n&&(f=f.slice(0,m.length));return f}},"t{1,2}|T{1,2}":{def:function(m){var t=d.t;return m[0].toUpperCase()===m[0]&&(t=t.toUpperCase()),t=t.slice(0,m.length)}}}}var DateFormatter,DAYS=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],DAYS_ABBR=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],MONTHS_ABBR=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return DateFormatter=Class.extend({init:function(localeInfo,pattern){var info=localeInfo||{};info.qCalendarStrings||(info.qCalendarStrings={qLongDayNames:DAYS,qDayNames:DAYS_ABBR,qLongMonthNames:MONTHS,qMonthNames:MONTHS_ABBR}),this.localeInfo=info,this.locale_days=info.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=info.qCalendarStrings.qDayNames.slice(),this.locale_months=info.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=info.qCalendarStrings.qMonthNames.slice(),this.pattern=pattern},clone:function(){var n=new DateFormatter(this.localeInfo,this.pattern);return n.subtype=this.subtype,n},format:function(date,pattern){pattern||(pattern=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),pattern=pattern.replace(/\[.+\]|\[|\]/g,"");var parsedDate,hasTwelveFlag=/t+/gi.test(pattern);parsedDate=date instanceof Date?parseDate(date,hasTwelveFlag):parseInterval(date,pattern);var masks=getMasks(this,parsedDate),masksArr=[];for(var mask in masks)masksArr.push(mask);var dateTimeRegex=new RegExp(masksArr.join("|"),"g"),result=pattern.replace(dateTimeRegex,function(m){var r;for(var mask in masks)if(r=new RegExp(mask),r.test(m))break;if(!r)return"";var value;for(var submask in masks[mask])if(submask===m||submask.toLowerCase()===m){value=masks[mask][submask],"undefined"==typeof value&&(value=masks[mask][submask.toLowerCase()]);break}return"undefined"==typeof value&&(value=masks[mask].def),"function"==typeof value&&(value=value(m)),value});return result}}),DateFormatter.parseInterval=parseIntervalDays,DateFormatter}),define("objects.utils/num-date-time-formatter",["objects.utils/number-formatter","objects.utils/date-formatter"],function(NumberFormatter,DateFormatter){"use strict";function significantIntegers(num){if(isNaN(num)||!isFinite(num))return 1;var n=Number(num).toExponential(),exp=n.split("e"),integers=1;return"+"===exp[1][0]&&(integers+=Number(exp[1])),integers}function significantDecimals(num){if(isNaN(num)||!isFinite(num))return 0;var integers,n=Number(num).toExponential(),exp=n.split("e"),decimals=0;return"-"===exp[1][0]?(decimals=Math.abs(Number(exp[1])),exp=exp[0].split("."),exp[1]&&(decimals+=exp[1].length)):(integers=Number(exp[1]),exp=exp[0].split("."),decimals=exp[1]?exp[1].length-integers:0),decimals}var NumDateTimeFormatter,TYPES={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};return NumDateTimeFormatter=NumberFormatter.extend("QFormatter",{init:function(localeInfo,pattern,thousand,decimal,type){var info=localeInfo||{};this.localeInfo=info,this.pattern=pattern||"",this.decimalDelimiter="string"==typeof decimal?decimal:"string"==typeof info.qDecimalSep?info.qDecimalSep:".",this.thousandDelimiter="string"==typeof thousand?thousand:"string"==typeof info.qThousandSep&&this.decimalDelimiter!==info.qThousandSep?info.qThousandSep:"",this.type=type||TYPES.AUTO,type===TYPES.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A"),this._numberFormatter=new NumberFormatter(localeInfo),this._dateFormatter=new DateFormatter(localeInfo),this.prepare()},clone:function(){return new NumDateTimeFormatter(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function(pattern,t,d){if(pattern||(pattern=this.pattern),!pattern)switch(this.type){case TYPES.INTEGER:pattern="##############";break;case TYPES.NUMBER:pattern=Array(this.localeInfo.qnDec||11).join("#");break;case TYPES.FIXED_TO:pattern="#"+this.localeInfo.qDecimalSep||"."+Array(this.localeInfo.qnDec||4).join("#");break;case TYPES.MONEY:pattern=this.localeInfo.qMoneyFmt,d||(d=this.localeInfo.qMoneyDecimalSep||"."),t||d===this.localeInfo.qMoneyThousandSep||(t=this.localeInfo.qMoneyThousandSep);break;case TYPES.DATE:pattern=this.localeInfo.qDateFmt||"YYYY-MM-DD";break;case TYPES.DATE_TIME:pattern=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case TYPES.TIME:case TYPES.INTERVAL:pattern=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:pattern="##########"}this._numberFormatter.pattern=this.pattern,this._dateFormatter.pattern=this.pattern,this._numberFormatter.thousandDelimiter=this.thousandDelimiter,this._numberFormatter.decimalDelimiter=this.decimalDelimiter,this._numberFormatter.type=this.type,this._numberFormatter.prepare(pattern,t,d),this._prepared={pattern:pattern,t:t,d:d}},formatValue:function(value){var date,prep=this._prepared;if("NaN"===value||"number"==typeof value&&isNaN(value))return"-";if(isNaN(value)||"number"!=typeof value)return value+"";switch(this.type){case TYPES.DATE:case TYPES.TIME:case TYPES.DATE_TIME:return date=new Date(1899,11,30+Math.floor(value),0,0,86400*(value-Math.floor(value))),isNaN(date.getTime())?this._numberFormatter.format(value,"0",prep.t,prep.d):this._dateFormatter.format(date,prep.pattern);case TYPES.INTERVAL:return this._dateFormatter.format(value,prep.pattern);default:return this._numberFormatter.formatValue(value)}},format:function(value,pattern,t,d){return"NaN"===value||"number"==typeof value&&isNaN(value)?"-":isNaN(value)||"number"!=typeof value?value+"":(this.prepare(pattern,t,d),this.formatValue(value))},createPatternFromRange:function(min,max,abbreviate){var i,reduceBy,nDecimals,p="",minMagnitude=Number(Number(min).toExponential().split("e")[1]),maxMagnitude=Number(Number(max).toExponential().split("e")[1]),minDecimals=Math.min(Math.abs(minMagnitude),Math.abs(maxMagnitude)),range=Math.abs(max-min),rangeMagnitude=Number(Number(range/50).toExponential().split("e")[1]);if(nDecimals=Math.abs(rangeMagnitude),0===range)return"0"+this.decimalDelimiter+"##"+(abbreviate?"A":"");if(rangeMagnitude>=0?nDecimals=abbreviate?Math.max(2,minDecimals-rangeMagnitude):0:(reduceBy=(abbreviate?minDecimals-minDecimals%3:0)*(0>maxMagnitude?1:-1),nDecimals-=reduceBy),p+=this.thousandDelimiter?"#"+this.thousandDelimiter+"##0":"0",nDecimals)for(p+=this.decimalDelimiter,i=0;nDecimals>i;i++)p+="#";return p+(abbreviate?"A":"")}}),NumDateTimeFormatter.getSignificantIntegers=function(value){return significantIntegers(value)},NumDateTimeFormatter.getSignificantDecimals=function(value){return significantDecimals(value)},NumDateTimeFormatter}),define("objects.views/charts/representation/expression-color-map",["core.utils/theme","general.utils/color-cache","objects.views/charts/representation/sequential-color-map","objects.utils/num-date-time-formatter","translator"],function(theme,Color,SequentialColorMap,NumFormatter,Translator){"use strict";function generateMinMax(mapping,data){var value,max=-Number.MAX_VALUE,min=Number.MAX_VALUE;return data.color.autoMinMax===!1?{min:data.color.measureMin||0,max:data.color.measureMax||10}:mapping?(Object.keys(mapping).forEach(function(key){value=mapping[key].value;var ids=key.split(",");isNaN(value)||ids.contains("-3")||ids.contains("-2")||(max=Math.max(max,value),min=Math.min(min,value))}),{min:min,max:max}):null}function mapHyperCubeColors(qData){if(!(qData&&qData.qDataPages[0]&&qData.qMeasureInfo&&qData.qMeasureInfo.length))return{};var color,value,ele,attribs,i,j,qMatrix=qData.qDataPages[0].qMatrix,numDimensions=getNumDimensions(qData.qDimensionInfo),ret={},attribExpsIndex=0;for(qData.qMeasureInfo[0].qAttrExprInfo&&qData.qMeasureInfo[0].qAttrExprInfo.every(function(element,k){"colorByExpression"===element.type&&(attribExpsIndex=k)}),i=0;i<qMatrix.length;i++){for(attribs=qMatrix[i][numDimensions].qAttrExps,ele=""+qMatrix[i][0].qElemNumber,j=1;numDimensions>j;j++)ele+=","+qMatrix[i][j].qElemNumber;attribs&&attribs.qValues.length?(color=Color.retriveColor(isNaN(attribs.qValues[attribExpsIndex].qNum)?attribs.qValues[attribExpsIndex].qText:attribs.qValues[attribExpsIndex].qNum,"argb"),value=attribs.qValues[attribExpsIndex].qNum):(color=Color.retriveColor(theme.colorSchemes.nullColor),value=NaN),ret[ele]={color:color,value:value}}return ret}function mapStackedCubeColors(qData){if(!(qData&&qData.qStackedDataPages[0]&&qData.qMeasureInfo&&qData.qMeasureInfo.length))return{};var color,value,attribs,recur,root=qData.qStackedDataPages[0].qData[0],ret={};return recur=function(node,elementID){if("V"===node.qType)attribs=node.qAttrExps,attribs&&attribs.qValues.length?(color=Color.retriveColor(isNaN(attribs.qValues[0].qNum)?attribs.qValues[0].qText:attribs.qValues[0].qNum,"argb"),value=attribs.qValues[0].qNum,ret[elementID]={color:color,value:value}):(color=Color.retriveColor(theme.colorSchemes.nullColor),value=NaN,ret[elementID]||(ret[elementID]={color:color,value:value}));else if(node.qSubNodes.length>0){"N"===node.qType&&(elementID?elementID+=","+node.qElemNo:elementID=""+node.qElemNo);for(var i=0;i<node.qSubNodes.length;i++)recur(node.qSubNodes[i],elementID)}},recur(root),ret}function getNumDimensions(dimInfo){return Array.isArray(dimInfo)?dimInfo.length:1}var ExpressionColorMap;return ExpressionColorMap=SequentialColorMap.extend({init:function(data){this._formatter=new NumFormatter(null),this._super(data)},setData:function(data){if(this._super(data),this._mapping={},data){var colorProperties=data.color||{},qData=data.qHyperCube?data.qHyperCube:data.qListObject;if(this._qDataObject=qData,this._data=data,this._isColorExpression=colorProperties.expressionIsColor!==!1,this._byExpression="byExpression"===colorProperties.mode,this._expressionLabel=colorProperties.expressionLabel&&""!==colorProperties.expressionLabel?colorProperties.expressionLabel:Translator.get("Object.ChartTooltip.ColorExpression"),this._byExpression){qData.qDataPages&&qData.qDataPages[0]?this._mapping=mapHyperCubeColors(qData):qData.qStackedDataPages&&qData.qStackedDataPages[0]&&(this._mapping=mapStackedCubeColors(qData)),this._minMax=generateMinMax(this._mapping,data);var mapping=this._mapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,Object.keys(mapping).map(function(item){var ids=item.split(",");return ids.contains("-3")||ids.contains("-2")?null:mapping[item].value}),1,this.getLargestScaleSize())],this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()}else this._minMax=null,this._mapping=null,this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()}},getColor:function(id,rowIndex,measureIndex,value){if(!this._byExpression)return this._super(id,rowIndex,measureIndex,value);var color,ele,eleCombo,qData=this._qDataObject,numMeasures=qData?qData.qMeasureInfo.length:0;return measureIndex=0,ele=id instanceof Array?this._dimIndex>=0?id[this._dimIndex]:void 0:id,eleCombo=id instanceof Array?id.join(","):id+"",-3===ele||void 0===ele&&id instanceof Array&&-1!==id.indexOf(-3)?Color.retriveColor(theme.colorSchemes.othersColor):-2===ele?Color.retriveColor(theme.colorSchemes.nullColor):numMeasures?!this._mapping[eleCombo]||this._mapping[eleCombo].color.isInvalid()&&this._isColorExpression?Color.retriveColor(theme.colorSchemes.nullColor):color=this._isColorExpression?this._mapping[eleCombo].color:this._super(id,rowIndex,0,this._mapping[eleCombo].value):this._super(id,rowIndex,measureIndex,value)},getExpressionValue:function(id){var eleCombo=id instanceof Array?id.join(","):id+"";return!this._mapping[eleCombo]||this._isColorExpression?void 0:this._mapping[eleCombo].value},getLegendTitle:function(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function(){return this._byExpression?this._isColorExpression?["box","item","primary",!0]:[this._classes?"box":"scale",this._classes?"range":"item","measure",!0]:this._super()},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:this._formatter},setGenericFormatter:function(value){this._super(value),this._byExpression&&this._minMax?(this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()):this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()},_getMinMax:function(measure,measureIndex){return this._byExpression?measure&&this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(measure,measureIndex)},_getNumUsedColors:function(index){return this._numUsedColors[index]}})}),define("objects.views/charts/representation/qualitative-color-map",["translator","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher"],function(Translator,theme,Color,EventLauncher){"use strict";function determineInternalMode(mode,autoMode,primaryMode,qData){var numDim=qData.qDimensionInfo instanceof Array?qData.qDimensionInfo.length:1,numMea=qData.qMeasureInfo?qData.qMeasureInfo.length:0;return mode&&mode!==AUTO?numMea>1&&primaryMode!==DIMENSION&&mode!==PRIMARY&&(mode=DIMENSION):mode=autoMode===PRIMARY||primaryMode===AUTO&&1>=numDim&&1>=numMea?PRIMARY:DIMENSION,"byDimension"===mode?DIMENSION:mode}function getDimensionIndex(auto,dimensions,dimensionID,multiDimSchem){var cId,i=0,dimensionsIsArray=dimensions instanceof Array,numDims=dimensionsIsArray?dimensions.length:1;if(dimensionID&&!auto)for(i;numDims>i;++i)if(cId=dimensionsIsArray?dimensions[i].cId:dimensions.cId,cId===dimensionID)return i;return multiDimSchem===FIRST?0:numDims-1}function getDimSize(qData,numMeasures,primaryColorMode,persistentColors,haveNoDimension,qDimensionInfo,dimIndex){return numMeasures>1&&primaryColorMode!==DIMENSION?numMeasures:persistentColors?haveNoDimension?0:qDimensionInfo[dimIndex].qCardinal:qData.qDataPages.length?qData.qDataPages[0].qMatrix.length:qData.qStackedDataPages.length&&qData.qStackedDataPages[0].qData.length?qData.qStackedDataPages[0].qData[0].qSubNodes.length:haveNoDimension?0:qDimensionInfo[dimIndex].qCardinal}function resolveColor(input){return theme.palette[input]?theme.palette[input]:input}var QualitativeColorMap,qualitativePyramid,qualitative100,AUTO="auto",PRIMARY="primary",DIMENSION="dimension",MEASURE="measure",FIRST="first",LAST="last";return QualitativeColorMap=EventLauncher.extend({init:function(data,options){options=options||{},this._primaryColorMode=options.colorBy||AUTO,this._autoMode=options.autoMode||AUTO,this._multiDimScheme=options.multiDimScheme||LAST,this._primaryColor=theme.colorSchemes.primaryColor,qualitativePyramid=theme.colorSchemes.qualitativeScales[0].scale,qualitative100=theme.colorSchemes.qualitativeScales[1].scale,this._qualitativeScale=qualitativePyramid[qualitativePyramid.length-1],this._persistantColors=!1,data&&this.setData(data)},setData:function(data){var colorProperties=data.color||{},qData=data.qHyperCube?data.qHyperCube:data.qListObject,numMeasures=qData&&qData.qMeasureInfo?qData.qMeasureInfo.length:0,qDimensionInfo=qData.qDimensionInfo instanceof Array?qData.qDimensionInfo:[qData.qDimensionInfo];this._qDataObject=qData,this._data=data,this._colorMode=colorProperties.auto?AUTO:colorProperties.mode||PRIMARY,this._internalMode=determineInternalMode(colorProperties.auto?AUTO:colorProperties.mode||AUTO,this._autoMode,this._primaryColorMode,qData),this._persistentColors=colorProperties.persistent!==!1,this._dimIndex=getDimensionIndex(colorProperties.auto,qDimensionInfo,colorProperties.dimensionId,this._multiDimScheme),this._haveNoDimension=0===qDimensionInfo.length||this._dimIndex<0,this._dimLabel=this._haveNoDimension?"":qDimensionInfo[this._dimIndex].qFallbackTitle,this._dimSize=getDimSize(qData,numMeasures,this._primaryColorMode,this._persistentColors,this._haveNoDimension,qDimensionInfo,this._dimIndex),void 0!==colorProperties.singleColor&&(this._primaryColor=resolveColor(colorProperties.singleColor)),this._dimSize>qualitativePyramid.length?this._qualitativeScale="100"!==colorProperties.dimensionScheme?qualitativePyramid[qualitativePyramid.length-1]:qualitative100:this._qualitativeScale=qualitativePyramid[(this._dimSize-1)%qualitativePyramid.length]},getColor:function(id,rowIndex,measureIndex){var index,color,ele,qData=this._qDataObject,numMeasures=qData?qData.qMeasureInfo.length:0;return ele=id instanceof Array?this._dimIndex>=0?id[this._dimIndex]:void 0:id,-3===ele||id instanceof Array&&-1!==id.indexOf(-3)?Color.retriveColor(theme.colorSchemes.othersColor):-2===ele?Color.retriveColor(theme.colorSchemes.nullColor):this._internalMode===PRIMARY&&this._colorMode===AUTO?Color.retriveColor(theme.colorSchemes.primaryColor):this._internalMode===PRIMARY?Color.retriveColor(this._primaryColor):(index=numMeasures>1&&this._primaryColorMode!==DIMENSION?measureIndex:this._persistentColors?ele:rowIndex,color=Color.retriveColor(this._qualitativeScale[index%this._qualitativeScale.length]))},getLegendMode:function(){var numMeasures=this._qDataObject?this._qDataObject.qMeasureInfo.length:0,colorMode=this._internalMode===PRIMARY?PRIMARY:this._autoMode===MEASURE||this._primaryColorMode===MEASURE||numMeasures>1&&this._primaryColorMode!==DIMENSION?"measure":"dimension";return["box","item",colorMode,"measure"===colorMode]},getDimensionIndex:function(){return this._dimIndex},getLegendTitle:function(){var qData=this._qDataObject,numMeasures=qData?qData.qMeasureInfo.length:0,numDimensions=qData?qData.qDimensionInfo instanceof Array?qData.qDimensionInfo.length:1:0;return this._primaryColorMode===MEASURE||1===numDimensions&&numMeasures>1&&this._primaryColorMode!==DIMENSION?Translator.get("Common.Measures"):this._dimLabel}})}),define("objects.views/charts/representation/combo-color-map",["objects.views/charts/events/event-launcher","objects.views/charts/representation/legend-data-provider","objects.views/charts/representation/expression-color-map","objects.views/charts/representation/qualitative-color-map"],function(EventLauncher,LegendDataProvider,ExpressionColorMap,QualitativeColorMap){var ComboColorMap,AUTO_MODE="auto",QUALITATIVE_MODE="qualitative",PRIMARY_MODE="primary",EXPRESSION_MODE="expression",MEASURE_MODE="measure";return ComboColorMap=EventLauncher.extend({init:function(data,options){this._qualitativeMap=new QualitativeColorMap(data,options),this._sequentialMap=new ExpressionColorMap(data,options),this._legendDataProvider=new LegendDataProvider(data),this._legendDataProvider.setColorMap(this),this._title="DEBUG",data&&this.setData(data)},getColor:function(id,value,measureIndex,rowIndex){return this._colorMode===MEASURE_MODE||this._colorMode===EXPRESSION_MODE?this._sequentialMap.getColor(id,rowIndex,measureIndex,value):this._qualitativeMap.getColor(id,rowIndex,measureIndex,value)},getTooltipContent:function(id){var value,formatter,row=null;return this._colorMode===EXPRESSION_MODE&&(value=this._sequentialMap.getExpressionValue(id),void 0!==value&&(this._sequentialMap.getValueFormatter&&(formatter=this._sequentialMap.getValueFormatter())&&(value=formatter.formatValue(value)),row={label:this.getLegendTitle(),value:value})),row},getColorMapping:function(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function(){return this._sequentialMap.generateScaleBasedMapping()},getLegendMode:function(){return this._colorMode===MEASURE_MODE||this._colorMode===EXPRESSION_MODE?this._sequentialMap.getLegendMode():this._qualitativeMap.getLegendMode()},getSelectionIndices:function(){return this.getDimensionIndex()},getLegendTitle:function(){return this._colorMode===MEASURE_MODE||this._colorMode===EXPRESSION_MODE?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function(){return this._colorMode===MEASURE_MODE?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function(data){if(this._colorMode=QUALITATIVE_MODE,this._data=data,data.color)if(data.color.auto)this._colorMode=AUTO_MODE,this._sequentialMap.setData(data),this._qualitativeMap.setData(data);else switch(data.color.mode){case"byMeasure":this._colorMode=MEASURE_MODE,this._sequentialMap.setData(data);break;case"byExpression":this._colorMode=EXPRESSION_MODE,this._sequentialMap.setData(data);break;case"primary":this._colorMode=PRIMARY_MODE,this._qualitativeMap.setData(data);break;default:this._qualitativeMap.setData(data)}else this._sequentialMap.setData(data),this._qualitativeMap.setData(data);this._legendDataProvider.setData(data)},setMeasureFormatters:function(value){this._measureFormatters=value,this._sequentialMap.setMeasureFormatters(value)},setGenericFormatter:function(value){this._sequentialMap.setGenericFormatter(value)},setDimensionTree:function(value){this._dimensionTree=value,this._legendDataProvider.setDimensionTree(value)},getLegendDataProvider:function(){return this._legendDataProvider},release:function(){this._qualitativeMap.release&&this._qualitativeMap.release(),this._sequentialMap.release&&this._sequentialMap.release(),this._legendDataProvider.release&&this._legendDataProvider.release(),this._dimensionTree=null,this._legendDataProvider=null,this._sequentialMap=null,this._qualitativeMap=null}}),Object.defineProperties(ComboColorMap.prototype,{mode:{get:function(){return this._colorMode}}}),Object.defineProperties(ComboColorMap,{AUTO:{value:AUTO_MODE,writable:!1},PRIMARY:{value:PRIMARY_MODE,writable:!1},MEASURE:{value:MEASURE_MODE,writable:!1},EXPRESSION:{value:EXPRESSION_MODE,writable:!1},QUALITATIVE:{value:QUALITATIVE_MODE,writable:!1}}),Object.defineProperties(ComboColorMap.prototype,{AUTO:{value:AUTO_MODE,writable:!1},PRIMARY:{value:PRIMARY_MODE,writable:!1},MEASURE:{value:MEASURE_MODE,writable:!1},EXPRESSION:{value:EXPRESSION_MODE,writable:!1},QUALITATIVE:{value:QUALITATIVE_MODE,writable:!1}}),ComboColorMap}),define("objects.views/charts/utils/chart-formatting",["core.utils/class","objects.utils/num-date-time-formatter","objects.utils/number-formatter"],function(Class,NumDateTimeFormatter){"use strict";function isAutoFormat(measure){return!!measure.qIsAutoFormat&&["M","D","T","TS","IV"].indexOf(measure.qNumFormat.qType)<0}var ChartFormatting=Class.extend("ChartFormatting",{init:function(localeInfo,measureInfo){this.localeInfo=localeInfo,this.measureFormatters=this.getFormattersForMeasures(measureInfo),this.combinedMeasuresFormatter=this.getFormatterFromFormatters(this.measureFormatters)},createFormatter:function(){return new NumDateTimeFormatter(this.localeInfo)},getLocaleInfo:function(){return this.localeInfo||{}},getFormatters:function(){return this.measureFormatters||[]},getMeasureFormatter:function(index){return this.measureFormatters[index]?this.measureFormatters[index]:void 0},getCombinedMeasuresFormatter:function(){return this.combinedMeasuresFormatter},formatMeasure:function(value,measureIndex){var f=this.measureFormatters[measureIndex];return f?f.format(value):value},getFormatterFromFormatters:function(formatters){var min,max,range,combinedMeasuresFormatter,form,dateTimes=0,auto=0,numeric=0,validFormatters=formatters?formatters.filter(function(f){return f.values?!isNaN(f.values.range):!1}):[];return formatters&&formatters.length&&(formatters.forEach(function(f){return"U"===f.type||f.values&&isNaN(f.values.range)?auto++:["D","T","TS","IV"].contains(f.type)?dateTimes=1:numeric=1,f.prepare(),f}),validFormatters.length&&(min=validFormatters.reduce(function(prev,f){return Math.min(f.values.min,prev)},validFormatters[0].values.min),max=validFormatters.reduce(function(prev,f){return Math.max(f.values.max,prev)},validFormatters[0].values.max),range=Math.abs(max-min)),dateTimes+numeric>1?(form=formatters.filter(function(nf){return"datetime"!==nf.type})[0]||{},combinedMeasuresFormatter=new NumDateTimeFormatter(this.localeInfo,form.pattern,form.thousandDelimiter,form.decimalDelimiter,"U"),isNaN(range)||(combinedMeasuresFormatter.pattern=combinedMeasuresFormatter.createPatternFromRange(min,max,!0))):dateTimes+numeric===1&&0===auto?(form=formatters[0]||{},combinedMeasuresFormatter=new NumDateTimeFormatter(this.localeInfo,form.pattern,form.thousandDelimiter,form.decimalDelimiter,form.type)):(form=formatters.filter(function(nf){return"U"!==nf.type}),form=form.length?form[0]:formatters[0]||{},combinedMeasuresFormatter=new NumDateTimeFormatter(this.localeInfo,form.pattern,form.thousandDelimiter,form.decimalDelimiter,form.type),isNaN(range)||"U"!==form.type||(combinedMeasuresFormatter.pattern=combinedMeasuresFormatter.createPatternFromRange(min,max,!0))),combinedMeasuresFormatter.prepare()),combinedMeasuresFormatter||(combinedMeasuresFormatter=new NumDateTimeFormatter(this.localeInfo,"0")),combinedMeasuresFormatter},getFormattersForMeasures:function(measureInfo,indices){var measures,formatters=[];return measureInfo&&measureInfo.length&&(measures=indices?measureInfo.filter(function(m,idx){return indices.indexOf(idx)>=0}):measureInfo,formatters=measures.map(function(measure){var shouldUseAuto=isAutoFormat(measure),f=new NumDateTimeFormatter(this.localeInfo,measure.qNumFormat.qFmt,measure.qNumFormat.qThou,measure.qNumFormat.qDec,shouldUseAuto?"U":measure.qNumFormat.qType),range=Math.abs(measure.qMax-measure.qMin),isInvalid=isNaN(range);return f.values={min:measure.qMin,max:measure.qMax,range:range},!isInvalid&&shouldUseAuto&&(f.pattern=f.createPatternFromRange(measure.qMin,measure.qMax,!0)),f.prepare(),f},this)),formatters}});return ChartFormatting}),define("objects.views/selections/cache-item",[],function(){"use strict";function CacheItem(shape,selected,value,parent,index,node,cacheId){if(shape instanceof Array&&!shape[0].pointInside&&!shape.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(shape),this.selected=!!selected,this.value=value,this.parent=parent,this.index=index,this.objectShapes={},node&&(this.parent=node.parent,this.node=node,this.rowIndex=node.data.rowIndex,this.label=node.data.qText,this.id=node.data.qElemNo),cacheId&&shape&&(this.objectShapes[cacheId]=shape instanceof Array?shape:[shape])}return CacheItem.prototype={getShapes:function(id){return(id||0===id)&&this.objectShapes&&this.objectShapes[id]?this.objectShapes[id]:this.shapes?this.shapes:[this.shape]},addShape:function(id,shape){this.objectShapes[id]instanceof Array||(this.objectShapes[id]=[]),this.objectShapes[id].push(shape),this.shapes.push(shape)},setShape:function(shape){this.shape=shape instanceof Array?shape[0]:shape,shape?this.shapes=shape instanceof Array?shape:[shape]:this.shapes=[]},addValue:function(v){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(v)}},CacheItem}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(Class){"use strict";var SelectionToolbar;return SelectionToolbar=Class.extend("SelectionToolbar",{menuButtons:[],init:function(backendApi,selectionsApi,showMenu,showLock,addBeforeDefaultButtons,menuButtons){this.backendApi=backendApi,this.selectionsApi=selectionsApi,this.showMenu=showMenu,this.showLock=showLock,addBeforeDefaultButtons=addBeforeDefaultButtons||[],this.menuButtons=menuButtons||[];var defaultButtons=[{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"icon-toolbar-clearselections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.backendApi.hasSelections()}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}}];defaultButtons.push({name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"icon-cancel",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}}),defaultButtons.push({name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"icon-tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}),this.buttons=addBeforeDefaultButtons.concat(defaultButtons)},hasState:function(states){if(!states)return!0;for(var dimensionInfos=this.backendApi.getDimensionInfos(),i=0;i<dimensionInfos.length;++i)for(var j=0;j<states.length;++j)if(dimensionInfos[i].qStateCounts[states[j]]>0)return!0;return!1}})}),define("objects.extension/default-view",["core.utils/class","qvangular","objects.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar"],function(Class,qvangular,Rect,CacheItem,DefaultSelectionToolbar){"use strict";var DefaultView;return DefaultView=Class.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function($scope,$element,options,backendApi){this.$scope=$scope,this.$element=$element,this.options=options,this.backendApi=backendApi,this._toggleLasso=!1},on:function(){this.selections&&this.selections.on(),this.selectionsEnabled=!0},off:function(){this.selections&&this.selections.off(),this.selectionsEnabled=!1},prePaint:function(){},suppressOnPaint:function(layout){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):layout.qSelectionInfo&&layout.qSelectionInfo.qInSelections},paint:function(){},updateData:function(){},resize:function($element,layout){return this.paint($element,layout)},destroy:function(){},initialize:function(){this.initSelections()},setSelections:function(selections){this.selections=selections},initSelections:function(){this.selections&&(this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",{rect:new Rect(0,0,this.$element.width(),this.$element.height())}),this.options._disableSelections||(this.selections.Select.bind(function(shapes,toggle){
this.onSelect(shapes,toggle)}.bind(this)),this.selections.ToggleShape.bind(function(shape){var index=this.selectedShapes.indexOf(shape);-1!==index?this.selectedShapes.splice(index,1):this.selectedShapes.push(shape),this.onToggleShape(shape)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this))))},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(shape){shape.$element[this.isSelected(shape.value)?"addClass":"removeClass"]("selected")},onSelect:function(shapes,toggle){if(shapes.length){var values=this.selectedShapes.map(function(shape){return shape.value});values.length>0&&this.activeDimensions.length>0?this.backendApi.select(values,this.activeDimensions,toggle):1!==shapes.length||shapes[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function($element,value){if(this.selections){var cRect=this.containerRect,rect=$element[0].getBoundingClientRect(),item=new CacheItem(new Rect(rect.left-cRect.left,rect.top-cRect.top,rect.right-rect.left,rect.bottom-rect.top),!1,value);item.$element=$element,this.selections.cache.add(item)}},isSelected:function(value){return this.selectedShapes.filter(function(shape){return shape.value===value}).length},getContextMenu:function(){},setSnapshotData:function(){},getViewState:function(){return{}},toggleLasso:function(enabled){qvangular.$apply(function(){this.selections&&(this._toggleLasso=enabled,this.options.lassoEnabled=enabled,this.selections.setLassoEnabled(enabled))}.bind(this))},isLassoing:function(){return this._toggleLasso},getSelectionToolbar:function(){var view=this;return new DefaultSelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"icon-toolbar-lasso",action:function(){view.toggleLasso(!view._toggleLasso)},isActive:function(){return this.name=view._toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",view.isLassoing()},isDisabled:function(){return view.isLassoDisabled&&view.isLassoDisabled()?!0:!1}}],[])},setBackendApi:function(backendApi){this.backendApi=backendApi},selectValues:function(qDimNo,qValues,qToggleMode){if(this.selectionsEnabled){if(!this.backendApi.inSelections()){var $scope=this.$scope,self=this;$scope.selectionsApi.confirm=function(){$scope.backendApi.endSelections(!0).then(function(){$scope.selectionsApi.deactivated()})},$scope.selectionsApi.cancel=function(){$scope.backendApi.endSelections(!1),$scope.selectionsApi.deactivated()},$scope.selectionsApi.deactivate=function(){this.deactivated()},$scope.selectionsApi.clear=function(){self.clearSelectedValues(self.$element),$scope.backendApi.clearSelections(),self.selectedArrays={}},this.getSelectionToolbar=function(){return new DefaultSelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[])},this.backendApi.beginSelections(),$scope.selectionsApi.activated(),$scope.selectionsApi.selectionsMade=!0,this.selectedArrays={}}if(this.selectedArrays[qDimNo]||(this.selectedArrays[qDimNo]=[]),qToggleMode)for(var i=0;i<qValues.length;i++){var pos=this.selectedArrays[qDimNo].indexOf(qValues[i]);-1===pos?this.selectedArrays[qDimNo].push(qValues[i]):this.selectedArrays[qDimNo].splice(pos,1)}else this.selectedArrays[qDimNo]=this.selectedArrays[qDimNo].concat(qValues);this.backendApi.selectValues(qDimNo,this.selectedArrays[qDimNo],!1)}},clearSelectedValues:function($element){$element.find(".selected").removeClass("selected")},onStateChanged:function(){},allowInteraction:function(state){var allow=!1;return state.state!==state.States.analysis&&(state.state!==state.States.play||this.backendApi&&this.backendApi.isSnapshot)||(allow=!0),allow},setInteraction:function(){}})}),define("objects.views/charts/chart",["jquery","./events/event-launcher","./layout-engine","./components/data-area","./components/axis/axis","./components/axis/discrete-axis","./components/legend/color-legend","./components/legend/color-legend-light","./components/mini-chart","./representation/combo-color-map","./chart-context","objects.utils/shapes/rect","objects.utils/layout","objects.views/charts/utils/binding","objects.views/charts/utils/chart-formatting","client.utils/state","objects.extension/default-view","objects.utils/event-utils","core.utils/deferred"],function($,EventLauncher,LayoutEngine,DataArea,Axis,DiscreteAxis,Legend,ColorLegendLight,MiniChart,ColorMap,ChartContext,Rect,layout,Binding,ChartFormatting,State,DefaultView,EventUtils,Deferred){"use strict";function updateSelectionCache(){if(this.selections){var row,col,p,shapes=this.components.dataArea.getSelectableShapes(),selected=this._selectedRows,selectionIndex=0,groupedSelection=!1,toSelect=[],active=this.selections.getActiveType?this.selections.getActiveType():!1,isActive=!!active;this.selections.cache&&(this.selections.cache.clear(),shapes.forEach(function(cacheItem){this.selections.cache.add(cacheItem)},this),isActive&&("item"===active.getActiveMode()?(selectionIndex=this.components.dimensionAxis?this.components.dimensionAxis.getSelectionIndices()[0]:0,groupedSelection=this.components.dimensionAxis&&this._data.qHyperCube.qDimensionInfo.length>1,shapes.forEach(function(cacheItem){col=cacheItem.col,row=cacheItem.rowIndex||cacheItem.row||0,groupedSelection?col===selectionIndex?cacheItem.selected=selected.indexOf(row)>=0:selected.indexOf(row)>=0&&col>selectionIndex&&(p=cacheItem.parent,p&&p.col===selectionIndex&&toSelect.indexOf(p)<0&&toSelect.push(p)):cacheItem.selected=selected.indexOf(row)>=0},this),toSelect&&toSelect.forEach(function(node){node.children.forEach(function(c){row=c.rowIndex||c.row||0,c.selected=!0,selected.indexOf(row)<0&&selected.push(row)})})):(active.activeComponent instanceof Axis&&!active.activeComponent.isDiscrete()||active.activeComponent instanceof Legend&&"range"===active.getActiveMode())&&active.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(shapes)),Object.keys(this.components).forEach(function(key){["colorLegend","xAxis","dimensionAxis"].contains(key)&&this.components[key].setSelectableShapes(shapes)},this)}}function limitSize(){var w,h,cw,ch,sw,sh,contentSize,scale,key,parent=this.container.parentElement,l="",t="";if(parent.style.height="100%",parent.style.width="",parent.style.left="",parent.style.top="",this._readStoredData&&this._data.snapshotData.content.size){w=this.container.clientWidth,h=this.container.clientHeight,contentSize=this._data.snapshotData.content.size,cw=contentSize.w,ch=contentSize.h;var snapRatio=cw/ch,containerRatio=w/h;containerRatio>=snapRatio?(scale=h/ch,sw=h*snapRatio/w,w=100*sw+"%",h="100%",l=50*(1-sw)+"%"):(scale=w/cw,sh=w/snapRatio/h,h=100*sh+"%",w="",t=50*(1-sh)+"%"),this._chartScale=scale,this.$scope.dataAttributes.chartScale=scale;for(key in this.components)this.components[key].chartScale=this._chartScale;parent.style.width=w,parent.style.height=h,parent.style.left=l,parent.style.top=t}}function updateSize(){this._sizeChanged=!1,limitSize.call(this);var key,layoutSize,oldRect=this.rect,w=this.container.clientWidth,h=this.container.clientHeight,rect=new Rect(0,0,w,h);if(this.containerRect=new Rect(0,0,w,h),this._readStoredData&&this._data.snapshotData.content.size&&(layoutSize={width:this._data.snapshotData.content.size.w,height:this._data.snapshotData.content.size.h}),layoutSize&&(rect=new Rect(0,0,layoutSize.width,layoutSize.height)),!oldRect||oldRect.width!==rect.width||oldRect.height!==rect.height){for(key in this.components)this.components[key].setOuterRect(rect.x+1,rect.y+1,rect.width-2,rect.height-2);this.rect=rect,this._updateLayoutMode(this.rect.width,this.rect.height),this._sizeChanged=!0}}function updateGlobalOpacity(op,doNotInvalidate){Object.keys(this.components).forEach(function(key){["colorLegend","xAxis","dimensionAxis","dataArea"].contains(key)&&this.components[key].setGlobalOpacity(op,doNotInvalidate||!1)},this)}function createFormatters(){var component;this.chartFormatter=new ChartFormatting(this.backendApi.localeInfo,this._data.qHyperCube.qMeasureInfo);for(component in this.components)this.components[component].chartFormatter=this.chartFormatter,this.components[component].measureFormatters=this.chartFormatter.getFormatters(),this.components[component].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter()}function getProto(){var key,proto={};for(key in EventLauncher.prototype)EventLauncher.prototype.hasOwnProperty(key)&&"init"!==key&&(proto[key]=EventLauncher.prototype[key]);return proto}function clearSelections(){var self=this;this.backendApi.clearSelections();var selectableShapes=this.components.dataArea.getSelectableShapes();selectableShapes.forEach(function(item){item.selected=!1,self.onSelection.ToggleShape.call(self,item)}),this._selectedRows=[],this.onSelection.scheduleInvalidation.call(this)}var Chart,_defaults,ChartDefault;return _defaults={debug:!0,components:{}},ChartDefault=DefaultView.extend(getProto()),Chart=ChartDefault.extend({refreshSelections:function(){this.specialCaseForSingleSelect=!1},initialize:function(){this._super(),this._initiateBindings()},init:function($scope,$element,options,backendApi){EventLauncher.prototype.init.call(this),options=$.extend(!0,options||{},{},_defaults),this._super($scope,$element,options,backendApi),this.container=$element[0],this.backendApi=backendApi,this.layoutEngine=new LayoutEngine,this.components={},this.providers={},this._changeWatchers=[],this._createComponents(),this._createProviders(),this._chartScale=1,this.chartFormatter=new ChartFormatting(this.backendApi.localeInfo),this._selectedRows=[],this._chartContext=new ChartContext,this._layoutMode=layout.LayoutMode.FULL,this.$scope.dataAttributes={},this.resize(),this.specialCaseForSingleSelect=!1},selectionModeAlpha:.5,setMinimumRequirements:function(numDimensions,numMeasures){this._requirements={dimensions:{min:numDimensions},measures:{min:numMeasures}}},onToggleLasso:function(){this.toggleLasso(!this.isLassoing())},notUsingLasso:function(e){var activeType,inDataArea;return this.selections&&this.selections.options.getSelectionType&&this.selections.types&&this.selections.types.dataArea?this.selections.types.dataArea.options.lassoSelection?!1:(activeType=this.selections.options.getSelectionType.call(this.selections,{x:e.pageX,y:e.pageY}),inDataArea=!(!activeType||"item"!==activeType._activeMode||!activeType.activeComponent||activeType.activeComponent&&activeType.activeComponent!==this.components.dataArea)):!0},onSelection:{ToggleShape:function(item){var layout=this.$scope.layout.layers?this.$scope.layout.layers[0]:this.$scope.layout,qData=layout.qListObject?layout.qListObject:layout.qHyperCube;if(!item.selected&&1===qData.qSize.qcy)return void(this.specialCaseForSingleSelect=!0);if(this.toggleCacheItem?this.toggleCacheItem(item):this.onSelection.scheduleInvalidation.call(this),-3===item.id||item.id>=0){var row=item.rowIndex||item.row||0;item.selected&&this._selectedRows.indexOf(row)<0?this._selectedRows.push(row):!item.selected&&this._selectedRows.indexOf(row)>=0&&this._selectedRows.splice(this._selectedRows.indexOf(row),1)}this.specialCaseForSingleSelect=!1,this._haveToggledShapes=!!this._selectedRows.length},Activated:function(){updateGlobalOpacity.apply(this,[this.selectionModeAlpha]),this._haveToggledShapes=!1},Deactivated:function(){updateGlobalOpacity.apply(this,[1]),this._selectedRows=[],this._toggleLasso&&this.toggleLasso(!1)},Select:function(shapes,toggle,dimension,pivotType){var self=this;if(!this.specialCaseForSingleSelect){var dimensions=Array.isArray(dimension)?dimension:[dimension||0];this._selectedRows.length?this.backendApi.select(this._selectedRows,dimensions,pivotType).then(function(res){res.qSuccess||clearSelections.call(self)})["catch"](function(err){err.isHandled=!0}):shapes.length&&shapes.every(function(item){return!item.selected})&&this.backendApi.clearSelections()}},SelectRange:function(ranges,orMode){var self=this;this.backendApi.selectRange(ranges,orMode).then(function(res){res.qSuccess||clearSelections.call(self)})},Confirm:function(){},Cancel:function(){},Clear:function(){this._selectedRows=[]},scheduleInvalidation:function(){var self=this;this._invalidationTimer||(this._invalidationTimer=setTimeout(function(){self.onSelection.invalidate.call(self),self._invalidationTimer=null},10))},cancelInvalidation:function(){clearTimeout(this._invalidationTimer),this._invalidationTimer=null},invalidate:function(){this.components.dataArea.invalidateDisplay("Chart.onSelection.invalidate"),this.components.colorLegend&&this.components.colorLegend.invalidateDisplay("Chart.onSelection.invalidate"),Object.keys(this.components).forEach(function(comp){this.components[comp]instanceof DiscreteAxis&&this.components[comp].invalidateDisplay("Chart.onSelection.invalidate")},this)}},getLayoutMode:function(){return this._layoutMode},getVerticalLayoutMode:function(){return this._verticalLayoutMode},getHorizontalLayoutMode:function(){return this._horizontalLayoutMode},setLayoutMode:function(lm){this._explicitLayoutMode=lm,this._layoutMode!==lm&&(this._layoutMode=lm,this.fire("layoutModeChanged"))},getSnapshotSize:function(){return{w:this.rect.width,h:this.rect.height}},_updateLayoutMode:function(w,h){this._explicitLayoutMode||(this._layoutMode=layout.getLayoutMode(w,h),this._horizontalLayoutMode=layout.getHorizontalLayoutMode(w),this._verticalLayoutMode=layout.getVerticalLayoutMode(h),this.fire("layoutModeChanged"),this.fire("verticalLayoutModeChanged"),this.fire("horizontalLayoutModeChanged"))},_createProviders:function(){var opts=this.options;opts.providers.colorMap&&(this.providers.colorMap="function"==typeof opts.providers.colorMap.clazz?new opts.providers.colorMap.clazz(void 0,opts.providers.colorMap):new ColorMap,this.components.dataArea&&this.components.dataArea.setColorMap(this.providers.colorMap),this.components.colorLegend&&this.components.colorLegend.setColorMap(this.providers.colorMap))},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var component;for(component in this.components)this._changeWatchers.push(Binding.bindProperty(this.components[component],"layoutMode",this,"layoutMode")),this._changeWatchers.push(Binding.bindProperty(this.components[component],"verticalLayoutMode",this,"verticalLayoutMode")),this._changeWatchers.push(Binding.bindProperty(this.components[component],"horizontalLayoutMode",this,"horizontalLayoutMode"));this.components.dataArea&&this._changeWatchers.push(Binding.bindSetter(updateSelectionCache.bind(this),this.components.dataArea,"selectableShapes"))},_createComponents:function(){var testID,componentOptions,klass,self=this,cmps=this.components,opts=this.options;Object.keys(opts.components).map(function(key){return{sortKey:opts.components[key].sortKey||0,cmpKey:key}}).sort(function(o1,o2){return o1.sortKey-o2.sortKey}).forEach(function(o){var key=o.cmpKey;if(testID=["component",key].join("."),componentOptions=opts.components[key],componentOptions.label=key,componentOptions.backendApi=self.backendApi,klass=null,"function"==typeof opts.components[key].clazz)klass=opts.components[key].clazz;else switch(key){case"dataArea":case"dataArea2":klass=DataArea;break;case"colorLegend":klass=Legend;break;case"colorLegendLight":klass=ColorLegendLight}klass&&(componentOptions._disableSelections=opts._disableSelections,cmps[key]=new klass(this.container,componentOptions,testID),cmps[key].setUseTransition(State.state<2),cmps[key]instanceof MiniChart||this.layoutEngine.addComponent(cmps[key]))},this)},preLayout:function(){},layout:function(firstDirection,fn){this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect,firstDirection,fn)},resize:function(){return this._data&&this.isValid(this._data)?(this.prePaint(this._data),this._paint()):Deferred.resolve()},setSnapshotData:function(snapshotLayout,options){var size=this.getSnapshotSize(),components={};Object.keys(this.components).forEach(function(key){components[key]={visible:this.components[key].isVisible(),dock:this.components[key].dock,size:{w:this.components[key].rect.width,h:this.components[key].rect.height}}},this),snapshotLayout.snapshotData.content={chartData:this.getSnapshotChartData(options),size:{w:size.w,h:size.h},components:components,v:.96}},getSnapshotChartData:function(){var snapshotChartData={};return this.components.colorLegend&&(snapshotChartData.legendScrollOffset=this.components.colorLegend.getScrollPosition()),snapshotChartData},getSnapshotStoredChartData:function(){return this._data&&this._data.snapshotData&&this._data.snapshotData.content?this._data.snapshotData.content.chartData:void 0},_postResize:function(){},_paint:function(){if(!this.isValid(this._data))return this.clear().then(function(){return{invalid:!0}});var storedData=this.getSnapshotStoredChartData();return this.components.colorLegend&&(this.components.colorLegend.pagingMode=this._pagingMode||0,this._readStoredData&&storedData&&this.components.colorLegend.setScrollPosition(storedData.legendScrollOffset||0)),updateSize.call(this),this.$scope.dataAttributes.doesNotFit=this.rect.height<10,this._sizeChanged&&this._postResize(),Deferred.resolve()},paint:function(data){return data.qSelectionInfo&&data.qSelectionInfo.qInSelections||!this.isValid(this._data)?Deferred.resolve():this._paint()},suppressOnPaint:function(data){var ret=this._super(data);return ret&&this.prePaint(data),ret},prePaint:function(){this.$scope.dataAttributes.layoutMode=this._layoutMode},updateData:function(data){this._data=data;var component,valid=this.isValid(data);for(component in this.components)this.components[component].setHasValidData(valid);if(!valid)return this.updateSelectableState(data),this.clear();var ret=this._updateData(data);return ret&&"function"==typeof ret.then?ret:Deferred.resolve()},_updateData:function(data){var component;this._data=data,this._readStoredData=this.options._readStoredData||data&&data.snapshotData&&data.snapshotData.content&&!this.isEffect&&State.view===State.Views.story,this._selectedRows=[],data.legend&&this.components.colorLegend&&this.components.colorLegend[(data.legend.auto||data.legend.show?"show":"hide")+"Component"](),createFormatters.call(this),this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this._chartContext.refresh(data);var isValid=this.isValid(this._data);for(component in this.components)this.components[component]._hasValidData=isValid;this.updateSelectableState()},destroy:function(){for(this.off();this._changeWatchers.length;)this._changeWatchers.pop().unbind();var component;for(component in this.components)this.components[component].release();for(component in this.providers)this.providers[component].release&&this.providers[component].release();this.$scope.dataAttributes={},this.selections&&this.selections.cache.clear(),this._chartContext.release(),this._data&&State.view!==State.Views.story&&delete this._data.snapshotData,this._super.apply(this,arguments)},clear:function(){var comps=[];return Object.keys(this.components).forEach(function(key){comps.push(this.components[key].clear())},this),Deferred.all(comps)},isValid:function(data){var valid=!!data&&!!data.qHyperCube&&data.qHyperCube.qDimensionInfo.length&&!data.qHyperCube.qDimensionInfo.some(function(d){return!!d.qError})&&data.qHyperCube.qMeasureInfo.length&&!data.qHyperCube.qMeasureInfo.some(function(m){return!!m.qError});return valid},isDataSelectable:function(data){return this.isValid(this._data)&&this.allowInteraction(State)?data.qHyperCube.qDimensionInfo.some(function(dim){return dim.qLocked!==!0}):!1},updateSelectableState:function(data){this.selections&&(this.isDataSelectable(data||this._data)?(this.selections.setLocked(!1),this.components.colorLegend&&this.components.colorLegend.setLocked(!1)):(this.selections.setLocked(!0),this.components.colorLegend&&this.components.colorLegend.setLocked(!0)))},on:function(){Object.keys(this.components).forEach(function(key){this.components[key].on()},this),this.updateSelectableState(this._data),this._super()},off:function(){Object.keys(this.components).forEach(function(key){this.components[key].off()},this),this._super()},setInteraction:function(on){on?this.on():this.off()},selectWhileLocked:function(){EventUtils.showLockedFeedback(this._data.qHyperCube.qDimensionInfo)}})}),define("objects.views/charts/components/ref-lines",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer"],function(ChartComponent,Theme,CanvasRenderer){"use strict";function getRefValue(ref){return Number(void 0!==ref.value?ref.value:ref)}function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:input}function checkIfHavingVisibleRefLines(){if(!this._numRefLinesDataAxes||!this._numAxes)return!1;var i,j,axis,axisRefLinesData,refValue,axisPlotMinValue,axisPlotMaxValue;for(i=0;i<this._numAxes;i+=1)for(axis=this._axes[i],axisPlotMinValue=axis.getPlotMin(),axisPlotMaxValue=axis.getPlotMax(),this._axisPlotMinValues[i]=axisPlotMinValue,this._axisPlotMaxValues[i]=axisPlotMaxValue,axisRefLinesData=this._data[i]||[],j=0;j<axisRefLinesData.length;j+=1)if(refValue=getRefValue(axisRefLinesData[j].refLineExpr),axisRefLinesData[j]&&axisRefLinesData[j].show&&void 0!==axisRefLinesData[j].refLineExpr&&null!==refValue&&!isNaN(refValue)&&refValue>=axisPlotMinValue&&axisPlotMaxValue>=refValue)return!0;return!1}function checkIfAxisPlotMaxMinValuesChanged(){var i,axis,axisPlotMinValue,axisPlotMaxValue;for(i=0;i<this._numAxes;i+=1)if(axis=this._axes[i],axisPlotMinValue=axis.getPlotMin(),axisPlotMaxValue=axis.getPlotMax(),this._axisPlotMinValues[i]!==axisPlotMinValue||this._axisPlotMaxValues[i]!==axisPlotMaxValue)return!0;return!1}function updateLocalAxisPlotMaxMinValues(){var i,axis;for(i=0;i<this._numAxes;i+=1)axis=this._axes[i],this._axisPlotMinValues[i]=axis.getPlotMin(),this._axisPlotMaxValues[i]=axis.getPlotMax()}var RefLines,defaultColor="#333";return RefLines=ChartComponent.extend("RefLines",{init:function(){this._super.apply(this,arguments),this.renderer=new CanvasRenderer(this.container),this.renderer.edgeBleed={top:1,left:1,right:0,bottom:0},this._$renderAreaWrap.addClass("qv-chart-component-reflines"),this._hasVisibleRefLines=!1,this._numAxes=0,this.renderers={lines:this.renderer}},setData:function(){this._super.apply(this,arguments),this._numRefLinesDataAxes=void 0===this._data?0:this._data.length,this._hasVisibleRefLines=checkIfHavingVisibleRefLines.call(this),updateLocalAxisPlotMaxMinValues.call(this)},setAxes:function(axes){var self=this;this._axes=axes,this._axes.forEach(function(element){element.listen("changed",function(){this.invalidateDisplay()},self)}),this._numAxes=void 0===axes?0:axes.length,(void 0===this._axisPlotMinValues||this._axisPlotMinValues.length!==this._numAxes)&&(this._axisPlotMinValues=new Array(this._numAxes)),(void 0===this._axisPlotMaxValues||this._axisPlotMaxValues.length!==this._numAxes)&&(this._axisPlotMaxValues=new Array(this._numAxes))},isVisible:function(){var b=this._super.apply(this,arguments);return b&&this._numAxes&&this._numRefLinesDataAxes?!0:!1},hasValidData:function(){return this._super()&&this._numRefLinesDataAxes&&this._numAxes},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),checkIfAxisPlotMaxMinValuesChanged.call(this)&&(this._hasVisibleRefLines=checkIfHavingVisibleRefLines.call(this),updateLocalAxisPlotMaxMinValues.call(this)),!this._hasVisibleRefLines)return this.renderer.shapes=[],void this.renderer.clear();var i,j,axisRefLinesData,axis,axisPlotMinValue,axisPlotMaxValue,refValue,position,x1,y1,x2,y2,color,shapeWrappers=[];for(i=0;i<this._numRefLinesDataAxes;i+=1)for(axisRefLinesData=this._data[i],axis=this._axes[i],axisPlotMinValue=this._axisPlotMinValues[i],axisPlotMaxValue=this._axisPlotMaxValues[i],j=0;j<axisRefLinesData.length;j+=1)axisRefLinesData[j].show&&void 0!==axisRefLinesData[j].refLineExpr&&(refValue=this._currentProperties["value"+i+j],null===refValue||isNaN(refValue)||refValue>axisPlotMaxValue||axisPlotMinValue>refValue||(position=axis.getPositionOfValue(refValue),position=Math.floor(position)-.5,axis.isVertical()?(x1=0,y1=position,x2=this.rect.width,y2=position):(x1=position,y1=0,x2=position,y2=this.rect.height),color=void 0!==axisRefLinesData[j].color?resolveColor(axisRefLinesData[j].color):defaultColor,shapeWrappers.push({type:"line",stroke:color,strokeWidth:1,shape:{x1:x1,y1:y1,x2:x2,y2:y2}})));this.renderer.shapes=shapeWrappers,this.renderer.render()},_updateProperties:function(){if(this._data){var i,j,data=this._data,l=data.length;for(i=0;l>i;i++)if(void 0!==data[i])for(j=0;j<data[i].length;j++)this._transitionProperties["value"+i+j]=data[i][j].refLineExpr.value;this._super()}}})}),define("text!objects.views/charts/components/axis/axis-title.ng.html",[],function(){return'<div qva-breadcrumb-bar \r\n     class="qva-breadcrumb-bar" \r\n     fontscale="fs" \r\n     vertical="vertical" \r\n     ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}">\r\n</div>\r\n'}),define("text!objects.views/charts/components/axis/breadcrumb-bar.ng.html",[],function(){return'<div class="qv-breadcrumb" ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}" ng-style="fontStyle">\r\n	<div class="qv-breadcrumb-container" ng-style="containerStyle">\r\n		<span ng-if="dim1">\r\n			<span class="crumb-item" ng-repeat="label in dim1" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked0" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled}"\r\n					  qva-activate="onClick($event,0,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow" ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n		<span ng-if="dim1 && dim2">,&nbsp;</span>\r\n		<span ng-if="dim2">\r\n			<span class="crumb-item" ng-repeat="label in dim2" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked1" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled }"\r\n					  qva-activate="onClick($event,1,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow"\r\n						  ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n	</div>\r\n	<div class="qv-breadcrumb-h-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleH">&nbsp;</div>\r\n</div>\r\n<div class="qv-breadcrumb-v-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleV">&nbsp;</div>'}),define("objects.views/charts/components/axis/breadcrumb-bar",["general.utils/color","assets/qvangular/qvangular-core","text!./breadcrumb-bar.ng.html","objects.views/charts/chart-style-service","touche"],function(Color,qvangular,template,ChartStyleService){function updateStyles($scope){var bg=styleService.getValue("",null,"backgroundColor","#ffffff"),bgA0=Color.toRGBA(bg,0),bgA1=Color.toRGBA(bg,1);$scope.fontStyle={"font-size":styleService.getValue("","axis.title","fontSize"),"font-family":styleService.getValue("","axis.title","fontFamily"),"font-weight":styleService.getValue("","axis.title","fontWeight")},$scope.faderStyleH={background:"linear-gradient(to right, "+bgA1+", "+bgA0+")"},$scope.faderStyleV={background:"linear-gradient(to right, "+bgA1+", "+bgA0+")"},colorStyles.crumbColor={color:styleService.getValue("","axis.title","color")},colorStyles.crumbButtonColor={color:styleService.getValue("","axis.title","color","inactive")},colorStyles.crumbButtonHoverColor={color:styleService.getValue("","axis.title","color","active")},colorStyles.crumbButtonLockedColor={color:styleService.getValue("","axis.title","color","locked")},colorStyles.crumbButtonDisabledColor={color:styleService.getValue("","axis.title","color","disabled")}}function updateContainerStyle($scope){var v=$scope.fontScale;$scope.containerStyle={"font-size":1*v+"em","line-height":"1em"},$scope.rightAlign&&!$scope.singleLabelMode?($scope.containerStyle.position="absolute",$scope.containerStyle.right=rightPadding+"px"):$scope.rightAlign&&($scope.containerStyle.width="100%"),$scope.vertical&&!$scope.singleLabelMode?$scope.containerStyle.left="-"+(52+$scope.verticalLeftShift)+"%":$scope.vertical&&($scope.containerStyle.left="-"+(52-$scope.verticalLeftShift)+"%")}function checkLabelMode(ar1,ar2){return(ar1?ar1.length:0)+(ar2?ar2.length:0)===1}function checkDrillMode(ar1,ar2){return ar1&&ar1.length>1||ar2&&ar2.length>1}var styleService=ChartStyleService.getInstance(),colorStyles={},rightPadding=10;qvangular.directive("qvaBreadcrumbBar",function(){return{template:template,link:function($scope,element,$attrs){$scope.labels1=$scope.$eval($attrs.labels1),$scope.hoverIndex=-1,$scope.height=element.width(),$scope.singleLabelMode=!0,$scope.onClick=function(event,columnIndex,labelIndex){$scope.disabled||$scope.$emit("drill-up",columnIndex,labelIndex)},$scope.setDimension=function(dim,arr){0===dim?$scope.dim1=arr:$scope.dim2=arr,$scope.singleLabelMode=checkLabelMode($scope.dim1,$scope.dim2),$scope.hasDrillDown=checkDrillMode($scope.dim1,$scope.dim2)},$scope.getCrumbStyle=function(hover,last,disabled){return disabled?colorStyles.crumbButtonDisabledColor:last?colorStyles.crumbColor:hover?colorStyles.crumbButtonHoverColor:colorStyles.crumbButtonColor},updateStyles($scope),$scope.$watch("fontScale",function(){updateContainerStyle($scope,$attrs)}),$scope.setRelevantSize=function(v){!$scope.vertical&&element.find(".qv-breadcrumb-container").width()+rightPadding>v?$scope.rightAlign=!0:$scope.rightAlign=!1,$scope.vertical&&element.find(".qv-breadcrumb-container").width()>v?$scope.verticalLeftShift=(element.find(".qv-breadcrumb-container").width()-v)/.02/element.find(".qv-breadcrumb-container").width():$scope.verticalLeftShift=2,updateContainerStyle($scope,$attrs)},$scope.setLocked=function(dim,l){$scope["locked"+dim]=l}}}})}),define("objects.views/charts/components/axis/axis-title",["../chart-component-angular","objects.views/charts/utils/canvas-renderer","text!./axis-title.ng.html","objects.views/charts/components/axis/breadcrumb-bar","jquery"],function(ChartComponentAngular,CanvasRenderer,template){"use strict";var AxisTitle,padding=3;return AxisTitle=ChartComponentAngular.extend("AxisTitle",{init:function(){var self=this,mainArguments=Array.prototype.slice.call(arguments);mainArguments.push(template),this._super.apply(this,mainArguments),this._type="measure",this._numCrumbs=[1,1],this._showTitle=!0,this._innerScope.fontScale=1,this._innerScope.vertical=!1,this.drillUpRef=this._innerScope.$on("drill-up",function(event,columnIndex,labelIndex){self._numCrumbs[columnIndex]-labelIndex>0&&self.fire("drill-up",[event,columnIndex,self._numCrumbs[columnIndex]-labelIndex])})},calculateRelevantSize:function(){this._super();var fontStyle={font:"12px 'QlikView Sans'",lineHeight:1.4};this._titleFontHeight=CanvasRenderer.getFontHeight(fontStyle.font),this.relevantSize=this._titleFontHeight*fontStyle.lineHeight+padding},setShowStrategy:function(show){this._showTitle=["all","title"].contains(show)},setDock:function(dock){this._super(dock),this._innerScope.vertical=this.isVertical();
},setTitle:function(s){this._title=s},setType:function(t){this._type=t},setData:function(){if(this._super.apply(this,arguments),"dimension"===this._type){this._qDimensionInfo=this._data&&this._data.qHyperCube?this._data.qHyperCube.qDimensionInfo:null;var numDims,dimInfo;numDims=this._qDimensionInfo?this._qDimensionInfo.length:0,numDims>0&&3>numDims?(dimInfo=this._qDimensionInfo[0],this._numCrumbs[0]=dimInfo.qGroupPos,this._innerScope.setLocked(0,dimInfo.qLocked||!1),this._innerScope.setDimension(0,dimInfo.qGroupFallbackTitles.slice(0,dimInfo.qGroupPos+1)),1===numDims?this._innerScope.setDimension(1,!1):(dimInfo=this._qDimensionInfo[1],this._numCrumbs[1]=dimInfo.qGroupPos,this._innerScope.setLocked(1,dimInfo.qLocked||!1),this._innerScope.setDimension(1,dimInfo.qGroupFallbackTitles.slice(0,dimInfo.qGroupPos+1)))):(this._innerScope.setDimension(0,!1),this._innerScope.setDimension(1,!1))}},setFont:function(font){this._style&&(this._style.font=font)},isVisible:function(){return this._super.apply(this,arguments)&&this._showTitle},on:function(){this._innerScope.disabled=!1},off:function(){this._innerScope.disabled=!0},paint:function(){this._innerScope.fontScale=this.chartScale,this._innerScope.setRelevantSize(this.isVertical()?this.rect.height:this.rect.width),this._innerScope.$digest()},release:function(){this._super(),this.drillUpRef()}})}),define("objects.views/charts/components/grid",["./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service"],function(ChartComponent,CanvasRenderer,ChartStyleService){function getLine(position,color,opacity,width,height,thickness,isVertical){var x1,x2,y1,y2;return isVertical?(x1=0,x2=width,y1=position,y2=position):(x1=position,x2=position,y1=0,y2=height),{type:"line",opacity:opacity,strokeWidth:thickness,shape:{x1:x1,x2:x2,y1:y1,y2:y2},stroke:color}}function renderLines(axis,o){var v,position,opacity,i,majorTicks=axis.ticks,minorTicks=axis.minorTicks,numMajorTicks=majorTicks?majorTicks.length:0,numMinorTicks=minorTicks?minorTicks.length:0,showMinorTicks=axis.getSpacingMode()===SpacingMode.DENSE,gridTickMultiplier=axis.getSpacingMode()===SpacingMode.SPARSE?2:1,height=o.rect.height,width=o.rect.width,style=o.style,linesToRender=[];if(axis.getSpacingMode()===SpacingMode.NONE||!majorTicks)return[];for(i=0;numMajorTicks>i;i+=1)position=majorTicks[i].position,v=majorTicks[i].value,opacity=majorTicks[i].opacity,(i%gridTickMultiplier===0||0===v)&&(0===v?linesToRender.push(getLine(position,style.zero.color,opacity,width,height,style.zero.width,axis.isVertical())):linesToRender.push(getLine(position,style.major.color,opacity,width,height,style.major.width,axis.isVertical())));if(showMinorTicks&&minorTicks)for(i=0;numMinorTicks>i;i+=1)position=minorTicks[i].position,linesToRender.push(getLine(position,style.minor.color,1,width,height,style.minor.width,axis.isVertical()));return linesToRender}function updateStyles(styleService,layoutMode){var chartID="",mode=styleService.layoutMap[layoutMode]||"medium",ret={ticks:{major:{color:styleService.getValue(chartID,"axis.grid.major","color",mode),width:styleService.getValue(chartID,"axis.grid.major","width",mode)},minor:{color:styleService.getValue(chartID,"axis.grid.minor","color",mode),width:styleService.getValue(chartID,"axis.grid.major","width",mode)},zero:{color:styleService.getValue(chartID,"axis.grid.zero","color",mode),width:styleService.getValue(chartID,"axis.grid.major","width",mode)}}};return ret}var Grid,SpacingMode;return SpacingMode={NONE:0,SPARSE:1,NORMAL:1,DENSE:3},Grid=ChartComponent.extend("Grid",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._styleService=ChartStyleService.getInstance(),this._style=updateStyles(this._styleService,this._layoutMode),this._renderer=new CanvasRenderer(this.container),this._renderer.edgeBleed={top:1,left:1,bottom:0,right:0},this._$renderAreaWrap.addClass("qv-chart-component-grid"),this.renderers={gridlines:this._renderer}},afterRenderLines:function(){},setAxes:function(primaryHorizontalAxis,primaryVerticalAxis){this._primaryHorizontalAxis!==primaryHorizontalAxis&&(this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryHorizontalAxis=primaryHorizontalAxis,this._primaryHorizontalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this)),this._primaryVerticalAxis!==primaryVerticalAxis&&(this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this),this._primaryVerticalAxis=primaryVerticalAxis,this._primaryVerticalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this))},hasValidData:function(){return this._super()&&this._primaryVerticalAxis&&this._primaryHorizontalAxis},paint:function(layoutMode,data){this._super(layoutMode,data);var linesToRender;return this._primaryVerticalAxis.updateNow(),this._primaryHorizontalAxis.updateNow(),linesToRender=renderLines(this._primaryVerticalAxis,{rect:this.rect,style:this._style.ticks}),linesToRender=linesToRender.concat(renderLines(this._primaryHorizontalAxis,{rect:this.rect,style:this._style.ticks})),this.afterRenderLines(linesToRender),this._renderer.shapes=linesToRender,this._renderer.render(),this},release:function(){this._super(),this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this)}})}),define("objects.views/charts/axis-chart",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-lines","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/axis/axis-title","objects.views/charts/components/grid","general.utils/property-resolver"],function($,Chart,ChartComponent,RefLines,ContinuousAxis,AxisTitle,Grid,propResolver){"use strict";function updateLegendPosition(colorLegend,data){data&&"auto"!==propResolver.getValue(data,"legend.dock","auto")?colorLegend.setDock(data.legend.dock):colorLegend.outerRect.height/colorLegend.outerRect.width<1?colorLegend.setDock("right"):colorLegend.setDock("bottom")}var AxisChart;return AxisChart=Chart.extend({init:function($scope,$element,superoptions,backendApi){var options=$.extend(!0,{components:{grid:{show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:Grid},refLines:{clazz:RefLines},colorLegend:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:ChartComponent.prototype.ShowFlags.MEDIUM},xAxis:{show:!0,order:1,dock:"bottom",relevantSize:120,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:ContinuousAxis},yAxis:{show:!0,order:1,dock:"left",relevantSize:90,reductionOrder:2,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:ContinuousAxis},xAxisTitle:{show:!0,order:1.1,dock:"bottom",relevantSize:30,reductionOrder:1,showFlag:ChartComponent.prototype.ShowFlags.SMALL,clazz:AxisTitle}}},superoptions||{});this._super($scope,$element,options,backendApi)},_updateData:function(data,options){this._super.apply(this,[].slice.call(arguments)),this.updateDataArea(data,options),this.updateAxis(data,options),this.updateLegend(data,options),this.updateGrid(data,options),this.updateRefLines(data,options)},updateDataArea:function(data,options){var key,axis;for(key in options.axes)axis=options.axes[key],axis.component.setDataIndices(axis.dataIndices||[axis.dataIndex||0]),axis.component.setCurrentDataIndices(axis.currentDataIndices||axis.dataIndices||[axis.dataIndex||0])},setAxisDataRange:function(axis,max,min,emax,emin,shift){var rangeMin,rangeMax;null!==emax&&null!==emin||null===emax&&null===emin?(rangeMin=min,rangeMax=max):null!==emax&&min>=emax?(rangeMin=emax-shift,rangeMax=max):null!==emin&&emin>=max?(rangeMin=min,rangeMax=emin+shift):(rangeMin=min,rangeMax=max),axis.setDataRange(rangeMin,rangeMax),this.components.miniChart&&this.components.miniChart.components.measureAxis.setDataRange(rangeMin,rangeMax)},updateAxis:function(data,options){var key,axis,minMax,axes=options.axes,miniChart=this.components.miniChart;for(key in options.axes)axis=axes[key],axis.component.setTitle(axis.title),axis.component.setShowStrategy(axis.data.show),axis.component.setLabelMode(axis.data.label),axis.component.setLockedInfo&&axis.component.setLockedInfo(data.qHyperCube.qDimensionInfo.map(function(dim){return dim.qLocked===!0})),axis.component.setPlotMin&&(minMax=this.getAxisOptions(axis),axis.component.setPlotMin(minMax.min),axis.component.setPlotMax(minMax.max),axis.component.setTickMultiplier(axis.data.spacing),axis.component.setLogScale(axis.data.logarithmic),miniChart&&(minMax=this.getAxisOptions(axis),miniChart.components.measureAxis.setPlotMin(minMax.min),miniChart.components.measureAxis.setPlotMax(minMax.max))),axis.component.isVertical()?axis.component.setDock("far"===axis.data.dock?"right":"left"):axis.component.setDock("far"===axis.data.dock?"top":"bottom");for(key in options.axisTitles)axis=options.axisTitles[key],axis.component.setTitle(axis.title),axis.component.setShowStrategy(axis.data.show),axis.component.isVertical()?axis.component.setDock("far"===axis.data.dock?"right":"left"):axis.component.setDock("far"===axis.data.dock?"top":"bottom")},getAxisOptions:function(axis){return axis&&axis.data?axis.data.autoMinMax?{min:null,max:null}:{min:["min","minMax"].contains(axis.data.minMax)?Number(axis.data.min):null,max:["max","minMax"].contains(axis.data.minMax)?Number(axis.data.max):null}:void 0},_postResize:function(){this._super(),updateLegendPosition.apply(this,[this.components.colorLegend,this._data])},updateLegend:function(){this.components.colorLegend&&updateLegendPosition.apply(this,[this.components.colorLegend,this._data])},updateGrid:function(data,options){if(this.components.grid){var key,spacing;if(data.gridLine&&"number"==typeof data.gridLine.spacing){spacing=data.gridLine.auto?2:data.gridLine.spacing;for(key in options.axes)options.axes[key].component.setSpacingMode&&options.axes[key].component.setSpacingMode(spacing)}}},updateRefLines:function(data,options){var key,refLineLabels=options.refLineLabels,axesData=[],axes=[];for(key in refLineLabels)refLineLabels[key].component&&(refLineLabels[key].component.setData(refLineLabels[key].data),refLineLabels[key].component.setAxis(refLineLabels[key].axis),refLineLabels[key].component.setDock(refLineLabels[key].axis.getOppositeDock()),axes.push(refLineLabels[key].axis),axesData.push(refLineLabels[key].data));options.refLines&&options.refLines.component&&(options.refLines.component.setAxes(axes),options.refLines.component.setData(axesData))}})}),define("objects.views/charts/components/scroll-area",["./chart-component","objects.utils/shapes/rect","client.utils/state","jquery","touche"],function(ChartComponent,Rect,State,$){function onTapEnd(data){var rp,self=this,isVertical=this.isVertical(),foo={size:isVertical?"height":"width",pos:isVertical?"y":"x",coord:isVertical?"pageY":"pageX"},containerRect=new Rect(0,0,0,0),offset=self._$renderAreaWrap.offset();containerRect.x=offset.left,containerRect.y=offset.top,containerRect.width=self._$renderAreaWrap.width(),containerRect.height=self._$renderAreaWrap.height(),this.fire("scrollStart"),rp=data.points[0][foo.pos]-containerRect[foo.pos]-self.scrollRect[foo.size]*containerRect[foo.size]/2,self.scrollRect[foo.pos]=Math.max(0,Math.min(containerRect[foo.size]*(1-self.scrollRect[foo.size]),rp))/containerRect[foo.size],self.setOffset(self.scrollRect[foo.pos]*self.fullState.max)}function onSwipeStart(data){var self=this,isVertical=this.isVertical(),foo={size:isVertical?"height":"width",pos:isVertical?"y":"x",coord:isVertical?"pageY":"pageX"},offset=self._$renderAreaWrap.offset();this._containerRect=new Rect(0,0,0,0),this._containerRect.x=offset.left,this._containerRect.y=offset.top,this._containerRect.width=self._$renderAreaWrap.width(),this._containerRect.height=self._$renderAreaWrap.height(),self.scrollRect[foo.size]=self.viewState.range/self.fullState.max,this._rp=data.points[0][foo.pos]-this._containerRect[foo.pos]-self.scrollRect[foo.pos]*this._containerRect[foo.size],this._rp<0?(self.scrollRect[foo.pos]=Math.max(0,self.scrollRect[foo.pos]-this._rp/this._containerRect[foo.size]),this._rp=0):this._rp/this._containerRect[foo.size]>self.scrollRect[foo.size]&&(self.scrollRect[foo.pos]=Math.min(1,this._rp/this._containerRect[foo.size])-self.scrollRect[foo.size],this._rp=self.scrollRect[foo.size]*this._containerRect[foo.size]),this.fire("scrollStart")}function onSwipeUpdate(data){var self=this,options=this.options,isVertical=this.isVertical(),onScroll="function"==typeof options.onScroll?options.onScroll:function(){},foo={size:isVertical?"height":"width",pos:isVertical?"y":"x",coord:isVertical?"pageY":"pageX"},p=data.points[0][foo.pos]-this._containerRect[foo.pos];self.scrollRect[foo.pos]=Math.max(0,Math.min(this._containerRect[foo.size]*(1-self.scrollRect[foo.size]),p-this._rp))/this._containerRect[foo.size],self.setOffset(self.scrollRect[foo.pos]*self.fullState.max),onScroll()}function miniChartOn(){if(this.miniChart){var self=this;Touche(this.miniChart.container).tap({id:namespace,end:function(e,data){onTapEnd.call(self,data)}}),Touche(this.miniChart.container).swipe({id:namespace,options:{radiusThreshold:1},start:function(e,data){onSwipeStart.call(self,data)},update:function(e,data){onSwipeUpdate.call(self,data)}})}}function miniChartOff(){this.miniChart&&($(this.miniChart.container).off(namespace),Touche(this.miniChart.container).off("*",namespace))}function updateMiniChartVisibility(){this.miniChart&&(this._internalUseMiniChart?this.miniChart.showComponent():this.miniChart.hideComponent())}function updateViewState(caller,triggerEvent){var old=this.viewState.min;this.viewState.min=Math.max(0,Math.min(this._explicitOffset||0,(this.fullState.max||0)-(this.viewState.range||0))),this.viewState.min!==old&&(this.invalidateDisplay(caller),triggerEvent&&this.fire("offsetChanged"))}function resetAndSetClass(elements,cssClass,attrsToReset){var els=Array.isArray(elements)?elements:[elements];els.forEach(function(element){attrsToReset.forEach(function(attr){element.style[attr]=""}),element.className=cssClass})}var ScrollArea,namespace=".scrollarea";return ScrollArea=ChartComponent.extend("ScrollArea",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._useMiniChart=!0,this._internalUseMiniChart=!0,this._miniChartThreshold=.5,this._miniChartMinimunNumberOfBars=3,this.scrollRect=new Rect(0,0,0,0),this.fullState={min:0,max:20},this.viewState={min:0,range:10},this._$renderAreaWrap.addClass("qv-chart-component-scroll-area"),this.before=document.createElement("div"),this.bar=document.createElement("div"),this.after=document.createElement("div"),this.before.style.position="absolute",this.bar.style.position="absolute",this.after.style.position="absolute",this.before.style.backgroundColor=this.after.style.backgroundColor="rgba(0,0,0,0.1)",this.bar.style.marginTop="-1px",$(this.before).attr("tid","component.scrollArea.before"),$(this.bar).attr("tid","component.scrollArea.bar"),$(this.after).attr("tid","component.scrollArea.after"),this.container.appendChild(this.before),this.container.appendChild(this.bar),this.container.appendChild(this.after)},on:function(){var self=this;Touche(this.container).tap({id:namespace,end:function(e,data){State.isInEditMode()||onTapEnd.call(self,data)}}),Touche(this.container).swipe({id:namespace,options:{radiusThreshold:1},start:function(e,data){State.isInEditMode()||onSwipeStart.call(self,data)},update:function(e,data){State.isInEditMode()||onSwipeUpdate.call(self,data)}}),miniChartOn.call(this)},off:function(){$(this.container).off(namespace),Touche(this.container).off("*",namespace),miniChartOff.call(this)},calculateRelevantSize:function(){var mcSize,size=Touche.utils.touch?32:16;this.miniChart&&this._useMiniChart&&(this.miniChart.calculateRelevantSize(),mcSize=this.miniChart.relevantSize,this._internalUseMiniChart=!0,updateMiniChartVisibility.apply(this)),this.relevantSize=this._internalUseMiniChart?mcSize||16:size},insertAdjacentTo:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setRect:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setDock:function(d){this._super(d),this.miniChart&&this.miniChart.setDock(d)},getOffset:function(){return this.viewState.min},setOffset:function(offset){this._explicitOffset=offset,updateViewState.call(this,"ScrollArea.setOffset")},setMiniChart:function(chart){miniChartOff.call(this),this.miniChart=chart,this.miniChart&&(this.miniChart.setDock(this.options.dock),updateMiniChartVisibility.apply(this)),State.isInEditMode()||chart.backendApi.isSnapshot||miniChartOn.call(this),this.invalidateDisplay("ScrollArea.setMiniChart")},setUseMiniChart:function(bool){this._useMiniChart=bool,this._internalUseMiniChart=bool,updateMiniChartVisibility.apply(this),this.invalidateDisplay("ScrollArea.setUseMiniChart")},getUseMiniChart:function(){return this._useMiniChart},setViewRange:function(range){this.viewState.range=range,updateViewState.call(this,"ScrollArea.setViewRange",!0),this.invalidateDisplay("ScrollArea.setViewRange")},getViewRange:function(){return this.viewState.range},setSpaces:function(v){this._spaces=v},setDataRange:function(v){this.dataRange=v,this.invalidateDisplay("ScrollArea.setDataRange")},getDataRange:function(){return this.dataRange},setFullRange:function(range){this.fullState.max=range,updateViewState.apply(this,["ScrollArea.setFullRange",!0]),this.invalidateDisplay("ScrollArea.setFullRange")},isVisible:function(layoutMode){return this._super(layoutMode)&&this.viewState.range<this.fullState.max},setOuterRect:function(x,y,w,h){this._super(x,y,w,h),this.miniChart&&this.miniChart.setOuterRect(x,y,w,h)},setLayoutToContainerRatios:function(x,y){this._super(x,y),this.miniChart&&this.miniChart.setLayoutToContainerRatios(x,y)},setContainerRect:function(x,y,w,h){this._super(x,y,w,h),this.miniChart&&this.miniChart.setContainerRect(x,y,w,h)},updateSize:function(){this._super(),this.miniChart&&this._internalUseMiniChart&&this.miniChart.isVisible()?(this.before.style.display="block",this.bar.style.border="1px solid rgba(0,0,0,0.4)",this.bar.style.backgroundColor="transparent",this.after.style.display="block",this.isVertical()?resetAndSetClass.apply(this,[[this.before,this.bar,this.after],"qv-chart-scrollable-mini-chart-vertical",["width","left"]]):(resetAndSetClass.apply(this,[[this.before,this.after],"qv-chart-scrollable-mini-chart-horizontal",["height","top"]]),resetAndSetClass.apply(this,[this.bar,"qv-chart-scrollable-mini-chart-bar-horizontal",["height","top"]]))):(this.before.style.display="none",this.bar.style.backgroundColor="rgba(0,0,0,0.2)",this.bar.style.boxShadow="none",this.bar.style.border="none",this.after.style.display="none",this.isVertical()?resetAndSetClass.apply(this,[this.bar,"qv-chart-scrollable-vertical",["width","left"]]):resetAndSetClass.apply(this,[this.bar,"qv-chart-scrollable-horizontal",["height","top"]]))},paint:function(layoutMode,data){var scrollSize;this.bar.style.display="block",this._super(layoutMode,data),this.scrollRect[this.isVertical()?"height":"width"]=this.viewState.range/this.fullState.max,this.scrollRect[this.isVertical()?"y":"x"]=this.viewState.min/this.fullState.max,scrollSize=this.scrollRect[this.isVertical()?"height":"width"]*this.rect[this.isVertical()?"height":"width"],scrollSize=1>scrollSize?1:scrollSize,scrollSize=100*scrollSize/this.rect[this.isVertical()?"height":"width"],this.isVertical()?($(this.before).css({height:100*this.scrollRect.y+"%",top:"0%"}),$(this.bar).css({top:100*this.scrollRect.y+"%",height:scrollSize+"%"}),$(this.after).css({top:100*this.scrollRect.y+scrollSize+"%",height:100-(100*this.scrollRect.y+scrollSize)+"%"})):($(this.before).css({width:100*this.scrollRect.x+"%",left:"0%"}),$(this.bar).css({left:100*this.scrollRect.x+"%",width:scrollSize+"%"}),$(this.after).css({left:100*this.scrollRect.x+scrollSize+"%",width:100-(100*this.scrollRect.x+scrollSize)+"%"}))},clear:function(){this.bar.style.display="none"}}),Object.defineProperty(ScrollArea.prototype,"className",{value:"ScrollArea"}),ScrollArea}),define("objects.views/charts/utils/label-positioner",[],function(){"use strict";var LabelPositioner;return LabelPositioner={positionRectanglesAlongAxis:function(rects,rectGap,boundaryGap,totalSize,rectsAreAlreadySorted){function determineGroups(){if(0===numRects)return rectGroups=[],void(numRectGroups=0);var i,position,size,previousPosition,previousSize;for(rectGroups=[[0]],i=1;numRects>i;i++)position=rects[i].position,size=rects[i].size,previousPosition=rects[i-1].position,previousSize=rects[i-1].size,previousPosition+previousSize/2+rectGap>position-size/2?rectGroups[rectGroups.length-1].push(i):rectGroups.push([i]);numRectGroups=rectGroups?rectGroups.length:0}function positionRects(){0!==numRects&&(startPositioningFromMinPositionToMaxPosition(),updatePositionsFromMaxPositionToMinPosition(),calculateGroupsInfo(),spaceIsFull=checkIfSpaceFull(),spaceIsFull||improveGroupPositions())}function startPositioningFromMinPositionToMaxPosition(){var i,position,size,previousNewPosition,previousSize;for(position=rects[0].position,size=rects[0].size,position=Math.max(boundaryGap,position-size/2)+size/2,rects[0].newPosition=position,i=1;numRects>i;i++)previousNewPosition=rects[i-1].newPosition,previousSize=rects[i-1].size,position=rects[i].position,size=rects[i].size,position=Math.max(previousNewPosition+previousSize/2+rectGap,position-size/2)+size/2,rects[i].newPosition=position}function updatePositionsFromMaxPositionToMinPosition(){var i,newPosition,size,subsequentNewPosition,subsequentSize;if(newPosition=rects[numRects-1].newPosition,size=rects[numRects-1].size,newPosition+size/2>totalSize)for(rects[numRects-1].newPosition=totalSize-size/2-boundaryGap,i=numRects-2;i>=0;i--)subsequentNewPosition=rects[i+1].newPosition,subsequentSize=rects[i+1].size,newPosition=rects[i].newPosition,size=rects[i].size,newPosition=Math.min(subsequentNewPosition-subsequentSize/2-rectGap,newPosition+size/2)-size/2,rects[i].newPosition=newPosition}function checkIfSpaceFull(){var i,previousNewPosition,previousSize,newPosition=rects[0].newPosition,size=rects[0].size;if(boundaryGap>newPosition-size/2)return!0;if(newPosition-size/2>boundaryGap)return!1;for(i=1;numRects>i;i++)if(previousNewPosition=rects[i-1].newPosition,previousSize=rects[i-1].size,newPosition=rects[i].newPosition,size=rects[i].size,newPosition-size/2>previousNewPosition+previousSize/2+rectGap)return!1;return!0}function calculateGroupsInfo(){var i,group,firstIndex,lastIndex,firstRect,lastRect,firstSize,lastSize,firstPosition,lastPosition,minPosition,maxPosition;for(groupsInfo&&groupsInfo.length===numRectGroups||(groupsInfo=new Array(numRectGroups)),i=0;numRectGroups>i;i+=1)group=rectGroups[i],firstIndex=group[0],lastIndex=group[group.length-1],firstRect=rects[firstIndex],lastRect=rects[lastIndex],firstPosition=firstRect.position,firstSize=firstRect.size,minPosition=firstRect.newPosition-firstSize/2,lastPosition=lastRect.position,lastSize=lastRect.size,maxPosition=lastRect.newPosition+lastSize/2,groupsInfo[i]={firstPosition:firstPosition,lastPosition:lastPosition,minPosition:minPosition,maxPosition:maxPosition}}function improveGroupPositions(){updateGroup(0,boundaryGap);for(var i=1;numRectGroups>i;i++)updateGroup(i,groupsInfo[i-1].maxPosition+rectGap)}function updateGroup(i,lowerLimitPosition){var group=rectGroups[i];group.length%2===0?updateGroupOfEvenNumberOfItems(i,lowerLimitPosition):updateGroupOfOddNumberOfItems(i,lowerLimitPosition)}function updateGroupOfEvenNumberOfItems(i,lowerLimitPosition){var group,firstIndex,middleIndex1,middleIndex2,firstRect,middleRect1,middleRect2,firstSize,firstNewPosition,updatedFirstNewPosition,centerPosition,centerNewPosition,delta;group=rectGroups[i],firstIndex=group[0],middleIndex1=group[group.length/2-1],middleIndex2=group[group.length/2],firstRect=rects[firstIndex],middleRect1=rects[middleIndex1],middleRect2=rects[middleIndex2],firstNewPosition=firstRect.newPosition,firstSize=firstRect.size,centerPosition=(middleRect1.position+middleRect2.position)/2,centerNewPosition=(middleRect1.newPosition+middleRect2.newPosition)/2,delta=centerNewPosition-centerPosition,updatedFirstNewPosition=firstNewPosition-delta,moveGroupPositionDown(i,firstNewPosition,updatedFirstNewPosition,firstSize,lowerLimitPosition)}function updateGroupOfOddNumberOfItems(i,lowerLimitPosition){var group,firstIndex,middleIndex,firstRect,middleRect,firstNewPosition,firstSize,centerPosition,centerNewPosition,delta,updatedFirstNewPosition;group=rectGroups[i],firstIndex=group[0],middleIndex=group[(group.length-1)/2],firstRect=rects[firstIndex],middleRect=rects[middleIndex],firstNewPosition=firstRect.newPosition,firstSize=firstRect.size,centerPosition=middleRect.position,centerNewPosition=middleRect.newPosition,delta=centerNewPosition-centerPosition,updatedFirstNewPosition=firstNewPosition-delta,moveGroupPositionDown(i,firstNewPosition,updatedFirstNewPosition,firstSize,lowerLimitPosition)}function moveGroupPositionDown(i,from,to,firstSize,lowerLimitPosition){if(!(to>=from)){to=Math.max(lowerLimitPosition+firstSize/2,to);var delta=from-to;groupsInfo[i].minPosition-=delta,groupsInfo[i].maxPosition-=delta,translateRectsOfGroup(i,delta)}}function translateRectsOfGroup(i,delta){var j,k,rect,group=rectGroups[i],len=group?group.length:0;for(j=0;len>j;j++)k=group[j],rect=rects[k],rect.newPosition-=delta}var numRects,rectGroups,numRectGroups,spaceIsFull,groupsInfo;numRects=rects?rects.length:0,rectsAreAlreadySorted!==!0&&rects.sort(function(rect1,rect2){return rect1.position>rect2.position?1:-1}),determineGroups(),positionRects()}}}),define("objects.views/charts/components/ref-line-labels",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/label-positioner","util"],function(ChartComponent,Theme,CanvasRenderer,LabelPositioner,util){"use strict";function calculateLabelHeights(labelObjects){var i,labelObject,shapeWrapper,shapeInfo,numLabels=labelObjects?labelObjects.length:0;for(i=0;numLabels>i;i++)labelObject=labelObjects[i],shapeWrapper=labelObject.shapeWrapper,shapeInfo=CanvasRenderer.measureTextObject(shapeWrapper),labelObject.size=shapeInfo.height,labelObject.info=shapeInfo}function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:input}function createTextShape(text,font,x,y,maxWidth,maxNumLines){return void 0===maxWidth&&(maxWidth=Number.MAX_VALUE),void 0===maxNumLines&&(maxNumLines=1),{type:"text",fill:"black",shape:{text:text,font:font,x:x,y:y,align:textAlign,baseline:textBaseline,maxWidth:maxWidth,maxNumLines:maxNumLines}}}function measureTextWidth(text){if(void 0===text||""===text)return 0;dummyTextShape.shape.text=text;var obj=CanvasRenderer.measureTextObject(dummyTextShape);return obj.width}function measureTextWidthHeight(text){return void 0===text||""===text?0:(dummyTextShape3.shape.text=text,CanvasRenderer.measureTextObject(dummyTextShape3))}function measureTextWidthWithMax3Lines(text){if(void 0===text||""===text)return 0;dummyTextShape2.shape.text=text;var obj=CanvasRenderer.measureTextObject(dummyTextShape2);return obj.width}function measureTextHeightAndNumLines(text,maxWidth){return void 0===text||""===text?{numLines:0,width:0,height:0,lines:[]}:(dummyTextShape2.shape.text=text,dummyTextShape2.shape.maxWidth=maxWidth,CanvasRenderer.measureTextObject(dummyTextShape2))}function measureMinTextWidthSplitInto2Lines(text,textWidth,whiteSpaceWidth){if(void 0===text||""===text)return{index:-1,width1:0,width2:0,width:0};void 0===textWidth&&(textWidth=measureTextWidth(text));for(var subString1Width,subString2Width,maxSubStringWidth,result,minWidth=Number.MAX_VALUE,textLength=text.length,textLengthHalf=Math.floor(textLength/2),subString=text.substring(0,textLengthHalf),numAssignments=0,cont=!0,idx=subString.lastIndexOf(" ");idx>-1&&cont;)subString=text.substring(0,idx),subString1Width=measureTextWidth(subString),subString2Width=textWidth-subString1Width-whiteSpaceWidth,maxSubStringWidth=Math.max(subString1Width,subString2Width),maxSubStringWidth>minWidth?cont=!1:(minWidth=maxSubStringWidth,numAssignments++,result={index:idx,width1:subString1Width,width2:subString2Width,width:minWidth},idx=subString.lastIndexOf(" "));if(numAssignments>1)return result;for(idx=text.indexOf(" ",textLengthHalf),numAssignments=0;idx>-1;){if(subString=text.substring(idx+1),subString2Width=measureTextWidth(subString),subString1Width=textWidth-subString2Width-whiteSpaceWidth,maxSubStringWidth=Math.max(subString1Width,subString2Width),maxSubStringWidth>minWidth)return result;minWidth=maxSubStringWidth,numAssignments++,result={index:idx,width1:subString1Width,width2:subString2Width,width:minWidth},idx=text.indexOf(" ",idx+1)}return void 0===result&&(result={index:-1,width1:0,width2:textWidth,width:textWidth}),result}function measureMinTextWidthSplitInto3Lines(text,textWidth,whiteSpaceWidth){if(void 0===text||""===text)return{index1:-1,index2:-1,width1:0,width2:0,width3:0,width:0};void 0===textWidth&&(textWidth=measureTextWidth(text));for(var subString23,subString1Width,subString23Width,maxSubStringWidth,maxSubString23Width,result23,result,minWidth=Number.MAX_VALUE,textLength=text.length,textLengthOneThird=Math.floor(textLength/3),subString1=text.substring(0,textLengthOneThird),numAssignments=0,cont=!0,idx=subString1.lastIndexOf(" ");idx>-1&&cont;)subString1=text.substring(0,idx),subString23=text.substring(idx+1),subString23Width=measureTextWidth(subString23),subString1Width=textWidth-subString23Width-whiteSpaceWidth,result23=measureMinTextWidthSplitInto2Lines(subString23,subString23Width,whiteSpaceWidth),maxSubString23Width=result23.width,maxSubStringWidth=Math.max(subString1Width,maxSubString23Width),maxSubStringWidth>minWidth?cont=!1:(minWidth=maxSubStringWidth,numAssignments++,result={index1:idx,index2:result23.index,width1:subString1Width,width2:result23.width1,width3:result23.width2,width:minWidth},idx=subString1.lastIndexOf(" "));if(numAssignments>1)return result;for(idx=text.indexOf(" ",textLengthOneThird),numAssignments=0;idx>-1;){if(subString23=text.substring(idx+1),subString23Width=measureTextWidth(subString23),subString1Width=textWidth-subString23Width-whiteSpaceWidth,result23=measureMinTextWidthSplitInto2Lines(subString23,subString23Width,whiteSpaceWidth),maxSubString23Width=result23.width,maxSubStringWidth=Math.max(subString1Width,maxSubString23Width),maxSubStringWidth>minWidth)return result;minWidth=maxSubStringWidth,numAssignments++,result={index1:idx,index2:result23.index,width1:subString1Width,width2:result23.width1,width3:result23.width2,width:minWidth},idx=text.indexOf(" ",idx+1)}return void 0===result&&(result={index1:-1,index2:-1,width1:0,width2:0,width3:textWidth,width:textWidth}),result}function measureMinTextWidth(text,singleLineTextWidth,maxWidth,whiteSpaceWidth,longestLetterWidth){var result;if(maxWidth>=singleLineTextWidth)return{minTextWidth:singleLineTextWidth,level:1};if(2*maxWidth>=singleLineTextWidth){if(result=measureMinTextWidthSplitInto2Lines(text,singleLineTextWidth,whiteSpaceWidth),result.width<=maxWidth)return{minTextWidth:result.width,level:0===result.width1?3:2};if(0===result.width1)return{minTextWidth:Math.ceil(result.width/2)+longestLetterWidth,level:3}}return 3*maxWidth>singleLineTextWidth?(result=measureMinTextWidthSplitInto3Lines(text,singleLineTextWidth,whiteSpaceWidth),0===result.width1&&0===result.width2?{minTextWidth:Math.min(Math.ceil(result.width/3)+Math.ceil(3*longestLetterWidth/2),maxWidth),level:3}:{minTextWidth:Math.min(result.width,maxWidth),level:3}):{minTextWidth:maxWidth,level:3}}function updateRect(rect,size,size2,numLines,level,info){rect.size=size,rect.size2=size2,rect.numLines=numLines,
rect.level=level,rect.info=info}function reduceLabelWidth(rect,space,whiteSpaceWidth,reduceOnlyOneStep){if(!(rect.size/2<=space||3===rect.numLines||3===rect.level)){var result,textHeightAndNumLines;if(2===rect.numLines)return result=measureMinTextWidthSplitInto3Lines(rect.text,rect.singleLineTextWidth,whiteSpaceWidth),textHeightAndNumLines=measureTextHeightAndNumLines(rect.text,result.width),void updateRect(rect,result.width,textHeightAndNumLines.height,textHeightAndNumLines.numLines,3,textHeightAndNumLines);if(result=measureMinTextWidthSplitInto2Lines(rect.text,rect.singleLineTextWidth,whiteSpaceWidth),0!==result.width1){if(result.width/2<=space||reduceOnlyOneStep===!0)return textHeightAndNumLines=measureTextHeightAndNumLines(rect.text,result.width),void updateRect(rect,result.width,textHeightAndNumLines.height,textHeightAndNumLines.numLines,2,textHeightAndNumLines);result=measureMinTextWidthSplitInto3Lines(rect.text,rect.singleLineTextWidth,whiteSpaceWidth),textHeightAndNumLines=measureTextHeightAndNumLines(rect.text,result.width),updateRect(rect,result.width,textHeightAndNumLines.height,textHeightAndNumLines.numLines,3,textHeightAndNumLines)}}}function reduceLabelWidthIfOverlapping(rect1,rect2,rectGap,whiteSpaceWidth){var rect,space;rect1.position+rect1.size/2+rectGap>rect2.position-rect2.size/2&&(rect1.size>rect2.size?(rect=rect1,space=rect2.position-rect2.size/2-rectGap-rect1.position):(rect=rect2,space=rect2.position-(rect1.position+rect1.size/2+rectGap)),reduceLabelWidth(rect,space,whiteSpaceWidth,!0))}function setLabelObjectProperties(labelObject,singleLineTextWidth,size,size2,numLines,level,info){labelObject.singleLineTextWidth=singleLineTextWidth,labelObject.size=size,labelObject.size2=size2,labelObject.numLines=numLines,labelObject.level=level,labelObject.info=info}function getRefLabel(ref){return String(void 0!==ref.label?ref.label:ref)}function getFormattedValueString(refLabel,refValue){var engineFormattedString=refLabel,specialChars=util.escapeRegExp("+-"+(this.chartFormatter.getLocaleInfo().qDecimalSep||"")+(this.chartFormatter.getLocaleInfo().qThousandSep||"")),formattedValueString=engineFormattedString.replace(new RegExp("[0-9e"+specialChars+"]","g"),"");return formattedValueString=formattedValueString.length?engineFormattedString:this._axis.format(refValue)}function generateLabelObjects(useTransitionalValues){if(this._axis&&this._data){this._axis.updateFormatter();var i,refLabel,refValue,text1,text2,text,len=this._data?this._data.length:0,labelObjects=[],plotMinValue=this._axis.getPlotMin(),plotMaxValue=this._axis.getPlotMax(),maxLowerRefValue=-Number.MAX_VALUE,minUpperRefValue=Number.MAX_VALUE,numLowerLabels=0,numUpperLabels=0;for(this._plotMinValueForRelevantSize=plotMinValue,this._plotMaxValueForRelevantSize=plotMaxValue,this._maxLowerLabelIndex=void 0,this._minUpperLabelIndex=void 0,i=0;len>i;i+=1)this._data[i]&&this._data[i].show&&void 0!==this._data[i].refLineExpr&&(refLabel=getRefLabel(this._data[i].refLineExpr),refValue=useTransitionalValues?this._currentProperties["value"+i]:this._data[i].refLineExpr.value,null===refValue||isNaN(refValue)||(plotMinValue>refValue?(numLowerLabels++,refValue>maxLowerRefValue&&(this._maxLowerLabelIndex=i)):refValue>plotMaxValue?(numUpperLabels++,minUpperRefValue>refValue&&(this._minUpperLabelIndex=i)):(text1=this._data[i].label,text2=" ("+getFormattedValueString.apply(this,[refLabel,refValue])+")",text=text1+text2,labelObjects.push({index:i,text:text,value:refValue,text1:text1,text2:text2}))));numUpperLabels>0&&labelObjects.push({index:-1,text:10>numUpperLabels?numUpperLabels.toString():"9+",value:"max",type:1}),numLowerLabels>0&&labelObjects.push({index:-2,text:10>numLowerLabels?numLowerLabels.toString():"9+",value:"min",type:-1}),this._labelObjects=labelObjects,this._numLabelObjects=this._labelObjects?this._labelObjects.length:0,this._labelsMaxWidthNeedToUpdate=!0,this._labelsMaxHeightNeedToUpdate=!0,this._labelObjectsNeedToUpdate=!1,this._numLowerLabels=numLowerLabels,this._numUpperLabels=numUpperLabels}}function calculateLabelsMaxWidth(){if(this._labelsMaxWidthNeedToUpdate){this._labelsMaxWidthNeedToUpdate=!1;var i,shapeInfo,d,maxWidth=0;for(dummyTextShape2.shape.maxWidth=this._labelMaxWidthForYAxis,i=0;i<this._numLabelObjects;i++)if(void 0!==this._labelObjects[i].type?(shapeInfo=measureTextWidthHeight(this._labelObjects[i].text),d=calculateCircleSize(shapeInfo),maxWidth=Math.max(maxWidth,d+4)):maxWidth=Math.max(maxWidth,measureTextWidthWithMax3Lines(this._labelObjects[i].text)+4),maxWidth>=this._labelMaxWidthForYAxis)return void(this._labelsMaxWidth=this._labelMaxWidthForYAxis);this._labelsMaxWidth=maxWidth}}function calculatePositionOfValue(value){return"max"===value?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.5+(this.isVertical()?-.1:.1):"min"===value?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.5+(this.isVertical()?.1:-.1):Math.floor(this._axis.getPositionOfValue(value))-.5}function updateLabelObjectsPosition(){var i,labelObject,position;for(i=0;i<this._numLabelObjects;i+=1)labelObject=this._labelObjects[i],position=calculatePositionOfValue.call(this,labelObject.value),labelObject.position=position}function calculateCircleSize(rect){return Math.sqrt(rect.width*rect.width+rect.height*rect.height)}function calculateLabelsMaxHeight(){if(this._labelsMaxHeightNeedToUpdate){this._labelsMaxHeightNeedToUpdate=!1,updateLabelObjectsPosition.call(this);var i,shapeInfo,d,maxHeight=0;for(this.calculateLabelWidths(this._labelObjects,this._componentWidth,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),LabelPositioner.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this._componentWidth,!0),i=0;i<this._numLabelObjects;i+=1)void 0!==this._labelObjects[i].type?(shapeInfo=measureTextWidthHeight(this._labelObjects[i].text),d=calculateCircleSize(shapeInfo),maxHeight=Math.max(maxHeight,d)):maxHeight=Math.max(maxHeight,this._labelObjects[i].size2);this._labelsMaxHeight=maxHeight}}function getStartIndexOfLastLine(lines){var i,line,idx=0,n=lines.length-1;for(i=0;n>i;i++)line=lines[i],idx+="-"===line.substr(line.length-1,1)?line.length-1:line.length+1;return idx}function getReducedText(text,maxWidth){dummyTextShape4.shape.text=text,dummyTextShape4.shape.maxWidth=maxWidth;var obj=CanvasRenderer.measureTextObject(dummyTextShape4);return obj.lines[0]}function reduceLongLabels(labelObjects){var i,labelObject,info,lines,text,text1,text2,text3,text4,lastLine,idx1,idx2,idx3,reducedText1,w1,w2,n=labelObjects?labelObjects.length:0;for(i=0;n>i;i++)labelObject=labelObjects[i],info=labelObject.info,info&&info.truncated===!0&&(lines=info.lines,text=labelObject.text,text1=labelObject.text1,text2=labelObject.text2,lastLine=lines[lines.length-1],idx1=getStartIndexOfLastLine(lines),idx2=text.indexOf(lastLine.substring(0,lastLine.length-1),idx1),0>idx2||(text3=text1.substring(idx2),w2=measureTextWidth(text2),w1=info.width-w2-2,ellipsisWidth||(ellipsisWidth=measureTextWidth(ellipsis)),ellipsisWidth>w1?reducedText1=text1.substring(0,idx2):(text4=getReducedText(text3,w1),idx3=idx2+text4.length-1,reducedText1=text1.substring(0,idx3)+ellipsis),labelObject.text=reducedText1+text2,labelObject.shapeWrapper.shape.text=labelObject.text))}var RefLineLabels,dummyTextShape,dummyTextShape2,dummyTextShape3,dummyTextShape4,whiteSpaceWidth,longestLetterWidth,ellipsisWidth,textAlign="center",textBaseline="bottom",defaultColor="#333",oorCirlceColor="#737373",ellipsis="…",oorSize=2;return RefLineLabels=ChartComponent.extend("RefLineLabels",{init:function(){this._super.apply(this,arguments),this.renderer=new CanvasRenderer(this.container),this._currentProperties={},this._transitionProperties={},this.renderers={labels:this.renderer},this._$renderAreaWrap.addClass("qv-chart-component-reflinelabels"),this._hasVisibleRefLines=!1,this._font="12px 'QlikView Sans'",this._font2="10px 'QlikView Sans'",this._labelMargin=4,this._labelMaxWidthForYAxis=70,this._labelMaxWidthForXAxis=100,this._labelMaxHeightForXAxis=50,this._verticaLabelGap=4,this._horizontalLabelGap=6,this._boundaryGap=4,dummyTextShape=createTextShape("",this._font,0,0,Number.MAX_VALUE,1),dummyTextShape2=createTextShape("",this._font,0,0,Number.MAX_VALUE,3),dummyTextShape3=createTextShape("",this._font2,0,0,Number.MAX_VALUE,1),dummyTextShape4=createTextShape("",this._font,0,0,Number.MAX_VALUE,1)},calculateRelevantSize:function(){if(this._super(),generateLabelObjects.call(this),this.isVertical())calculateLabelsMaxWidth.call(this),this.relevantSize=this._labelsMaxWidth+this._labelMargin;else{var s=this.rect.width?this.rect.width:this._axis._plotSize;this._componentWidth!==s&&(this._componentWidth=s,this._labelsMaxHeightNeedToUpdate=!0),calculateLabelsMaxHeight.call(this),this.relevantSize=this._labelsMaxHeight+this._labelMargin}},calculatePreliminaryRelevantSize:function(){this.relevantSize=this.isVertical()?this._labelMaxWidthForYAxis:this._labelMaxHeightForXAxis},setData:function(){this._super.apply(this,arguments),this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues(),this._labelObjectsNeedToUpdate=!0},setAxis:function(axis){var self=this;this._axis=axis,this._axis.listen("changed",function(){this.invalidateDisplay()},self),this._labelObjectsNeedToUpdate=!0},isVisible:function(){var b=this._super.apply(this,arguments);return b?(this._axis&&(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines):!1},calculateLabelWidths:function(labelObjects,containerWidth,labelGap,boundaryGap,labelMaxWidth){var i,j,labelObject,text,singleLineTextWidth,result,textHeightAndNumLines,numLabels=labelObjects?labelObjects.length:0;if(0!==numLabels){for(whiteSpaceWidth=measureTextWidth("m m")-measureTextWidth("mm"),longestLetterWidth=measureTextWidth("m"),i=0;numLabels>i;i++)labelObject=labelObjects[i],text=labelObject.text,void 0===text||""===text?setLabelObjectProperties(labelObject,0,0,0,0,0,void 0):(singleLineTextWidth=measureTextWidth(text),result=measureMinTextWidth(text,singleLineTextWidth,labelMaxWidth,whiteSpaceWidth,longestLetterWidth),textHeightAndNumLines=measureTextHeightAndNumLines(text,result.minTextWidth),setLabelObjectProperties(labelObject,singleLineTextWidth,result.minTextWidth,textHeightAndNumLines.height,textHeightAndNumLines.numLines,result.level,textHeightAndNumLines));for(labelObjects.sort(function(label1,label2){return label1.position>label2.position?1:-1}),labelObject=labelObjects[numLabels-1],void 0!==labelObject.text&&""!==labelObject.text&&reduceLabelWidth(labelObject,containerWidth-labelObject.position-boundaryGap,whiteSpaceWidth),labelObject=labelObjects[0],void 0!==labelObject.text&&""!==labelObject.text&&reduceLabelWidth(labelObject,labelObject.position-boundaryGap,whiteSpaceWidth),i=0;numLabels-1>i;i++)if(void 0!==labelObjects[i].text&&""!==labelObjects[i].text&&void 0!==labelObjects[i+1].text&&""!==labelObjects[i+1].text)for(j=0;4>j;j++)reduceLabelWidthIfOverlapping(labelObjects[i],labelObjects[i+1],labelGap,whiteSpaceWidth)}},checkIfHavingVisibleRefLines:function(){if(!this._data||0===this._data.length||!this._axis)return!1;var i;for(i=0;i<this._data.length;i+=1)if(this._data[i]&&this._data[i].show&&void 0!==this._data[i].refLineExpr){if("value"in this._data[i].refLineExpr&&(null===this._data[i].refLineExpr.value||isNaN(this._data[i].refLineExpr.value)))continue;return!0}return!1},updateLocalPlotMaxMinValues:function(){this._axis&&(this._plotMinValue=this._axis.getPlotMin(),this._plotMaxValue=this._axis.getPlotMax())},setLabelMargin:function(m){this._labelMargin=void 0===m?4:m},hasValidData:function(){return this._super()&&this._data&&this._axis},paint:function(){if(this._super.apply(this,arguments),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines){generateLabelObjects.call(this,!0);var i,k,position,x,y,color,shapeWrapper,shape,shapeInfo,circle1,circle2,labelObject,baseline,baseline1=this.isVertical()?"middle":"top"===this.dock?"bottom":"top",baseline2="middle",w=this.rect.width,h=this.rect.height,tempX=w/2+this._labelMargin/2+1,tempY="top"===this.dock?h-this._labelMargin:this._labelMargin,shapeWrappers=new Array(this._numLabelObjects),labelMaxWidth=this._labelMaxWidthForYAxis,font=this._font,w05=tempX,h05="top"===this.dock?(h-this._labelMargin)/2:(h+this._labelMargin)/2;for(i=0;i<this._numLabelObjects;i+=1)labelObject=this._labelObjects[i],k=labelObject.index,position=calculatePositionOfValue.call(this,labelObject.value),this.isVertical()?(x=tempX,y=position):(x=position,y=void 0!==labelObject.type?h05:tempY),color=k>-1&&void 0!==this._data[k].color?resolveColor(this._data[k].color):defaultColor,void 0!==labelObject.type?(font=this._font2,baseline=baseline2,color="white"):(font=this._font,baseline=baseline1),shapeWrapper={type:"text",fill:color,shape:{text:labelObject.text,x:x,y:y,align:"center",baseline:baseline,font:font,maxWidth:labelMaxWidth,maxNumLines:3}},shapeWrappers[i]=shapeWrapper,labelObject.position=position,labelObject.shapeWrapper=shapeWrapper;if(0!==this._numLabelObjects){if(this.isVertical()){for(calculateLabelHeights(this._labelObjects),this._numUpperLabels>0&&(position=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.7,this._labelObjects.push({position:position,size:oorSize})),this._numLowerLabels>0&&(position=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.3,this._labelObjects.push({position:position,size:oorSize})),LabelPositioner.positionRectanglesAlongAxis(this._labelObjects,this._verticaLabelGap,this._boundaryGap,this.rect.height,!1),i=this._labelObjects.length-1;i>-1;i--)void 0===this._labelObjects[i].shapeWrapper&&this._labelObjects.splice(i,1);for(i=0;i<this._numLabelObjects;i+=1)labelObject=this._labelObjects[i],shape=labelObject.shapeWrapper.shape,shape.y=labelObject.newPosition,1===labelObject.type&&(shapeInfo=CanvasRenderer.measureTextObject(labelObject.shapeWrapper),circle1={cx:shape.x,cy:shape.y,r:calculateCircleSize(shapeInfo)/2}),-1===labelObject.type&&(shapeInfo=CanvasRenderer.measureTextObject(labelObject.shapeWrapper),circle2={cx:shape.x,cy:shape.y,r:calculateCircleSize(shapeInfo)/2})}else{for(this.calculateLabelWidths(this._labelObjects,this.rect.width,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),this._numUpperLabels>0&&(position=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.3,this._labelObjects.push({position:position,size:oorSize})),this._numLowerLabels>0&&(position=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.7,this._labelObjects.push({position:position,size:oorSize})),LabelPositioner.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this.rect.width,!1),i=this._labelObjects.length-1;i>-1;i--)void 0===this._labelObjects[i].shapeWrapper&&this._labelObjects.splice(i,1);for(i=0;i<this._numLabelObjects;i+=1)labelObject=this._labelObjects[i],shape=labelObject.shapeWrapper.shape,shape.x=labelObject.newPosition,shape.maxWidth=labelObject.size,1===labelObject.type&&(shapeInfo=CanvasRenderer.measureTextObject(labelObject.shapeWrapper),circle1={cx:shape.x,cy:h05,r:calculateCircleSize(shapeInfo)/2}),-1===labelObject.type&&(shapeInfo=CanvasRenderer.measureTextObject(labelObject.shapeWrapper),circle2={cx:shape.x,cy:h05,r:calculateCircleSize(shapeInfo)/2})}reduceLongLabels(this._labelObjects),this.isVertical()?(this._numUpperLabels>0&&(shapeWrapper={type:"polygon",fill:defaultColor,shape:{points:[{x:w05-3,y:5.2},{x:w05,y:0},{x:w05+3,y:5.2}]}},shapeWrappers.push(shapeWrapper),shapeWrapper={type:"circle",fill:oorCirlceColor,shape:circle1},shapeWrappers.splice(0,0,shapeWrapper)),this._numLowerLabels>0&&(shapeWrapper={type:"polygon",fill:defaultColor,shape:{points:[{x:w05-3,y:h-5.2},{x:w05,y:h},{x:w05+3,y:h-5.2}]}},shapeWrappers.push(shapeWrapper),shapeWrapper={type:"circle",fill:oorCirlceColor,shape:circle2},shapeWrappers.splice(0,0,shapeWrapper))):(this._numLowerLabels>0&&(shapeWrapper={type:"polygon",fill:defaultColor,shape:{points:[{x:5.2,y:h05-3},{x:0,y:h05},{x:5.2,y:h05+3}]}},shapeWrappers.push(shapeWrapper),shapeWrapper={type:"circle",fill:oorCirlceColor,shape:circle2},shapeWrappers.splice(0,0,shapeWrapper)),this._numUpperLabels>0&&(shapeWrapper={type:"polygon",fill:defaultColor,shape:{points:[{x:w-5.2,y:h05-3},{x:w,y:h05},{x:w-5.2,y:h05+3}]}},shapeWrappers.push(shapeWrapper),shapeWrapper={type:"circle",fill:oorCirlceColor,shape:circle1},shapeWrappers.splice(0,0,shapeWrapper))),this.renderer.shapes=shapeWrappers,this.renderer.render()}}},release:function(){this._super(),this._axis&&this._axis.stopListen("changed",null,this)},_updateProperties:function(){if(this._data){var propertyName,i,data=this._data,l=data.length;for(i=0;l>i;i++)propertyName="value"+i,this._transitionProperties[propertyName]=data[i].refLineExpr.value;this.calculateRelevantSize(),this._super()}}})}),define("objects.backend-api/stacked-cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(Class,Rect){"use strict";var StackedCubeSlicer,areaRect=new Rect(0,0,0,0),pageRect=new Rect(0,0,0,0);return StackedCubeSlicer=Class.extend("StackedCubeSlicer",{init:function(){this.pages=[]},get:function(areas){return areas.map(function(area){return this.getPage(area)}.bind(this))},getPage:function(area){var storage,i,cover,coverage=[];for(i=0;i<this.pages.length;i++)if(storage=this.pages[i].qArea,areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(storage.qLeft,storage.qTop,storage.qWidth,storage.qHeight),cover=pageRect.intersection(areaRect,!0),coverage.push({coverage:cover?cover.clone():new Rect(0,0,0,0),idx:i}),storage.qLeft<=area.qLeft&&storage.qLeft+storage.qWidth>=area.qLeft+area.qWidth&&storage.qTop<=area.qTop&&storage.qTop+storage.qHeight>=area.qTop+area.qHeight)return this._extract(area,this.pages[i]);return coverage.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),coverage[0].coverage.height>0&&coverage[0].coverage.width>0?this._extract(area,this.pages[coverage[0].idx]):{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qData:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(pages){this.pages=pages},containsArea:function(area){for(var a,i=0;i<this.pages.length;i++)if(a=this.pages[i].qArea,a.qLeft<=area.qLeft&&a.qLeft+a.qWidth>=area.qLeft+area.qWidth&&a.qTop<=area.qTop&&a.qTop+a.qHeight>=area.qTop+area.qHeight)return!0;return!1},contains:function(areas){return this.pages&&this.pages.length?0===areas.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(area,fromPage){areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(fromPage.qArea.qLeft,fromPage.qArea.qTop,fromPage.qArea.qWidth,fromPage.qArea.qHeight);var data,y,intersection=areaRect.intersection(pageRect,!0);if(!intersection)return{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qData:[]};y=Math.max(0,area.qTop-fromPage.qArea.qTop);var source=fromPage.qData[0],nodes=source.qSubNodes;data={};for(var key in source)source.hasOwnProperty(key)&&("qSubNodes"===key?data[key]=nodes.slice(y,y+intersection.height):data[key]=source[key]);return data.qUp+=y,data.qDown+=fromPage.qArea.qHeight-intersection.height-y,{qArea:{qTop:intersection.y,qLeft:intersection.x,qWidth:intersection.width,qHeight:intersection.height},qData:[data]}}})}),define("objects.views/charts/scrollable-chart",["jquery","./axis-chart","objects.views/charts/components/axis/discrete-axis","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/chart-component","objects.views/charts/components/scroll-area","objects.views/charts/components/mini-chart","objects.views/charts/components/ref-line-labels","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","objects.utils/event-utils","objects.utils/shapes/rect","core.utils/deferred","objects.backend-api/stacked-cube-slicer","touche"],function($,AxisChart,DiscreteAxis,ContinuousAxis,ChartComponent,ScrollArea,MiniChart,RefLineLabels,ColorMap,Binding,EventUtils,Rect,Deferred,StackedCubeSlicer){function panUpdate(e,data){var scrollValue,currentValue,scrollArea=this.components.scrollArea;this._panning||(this._panning=!0,this._panX=data.points[0].x,this._panY=data.points[0].y),scrollArea.isHorizontal()?(currentValue=data.swipe&&data.swipe.currentPoint?data.swipe.currentPoint.x:e.pageX,scrollValue=scrollArea.getOffset()-(currentValue-this._panX)/(this.components.dimensionAxis._discreteSpacing||28),this._panX=currentValue):(currentValue=data.swipe&&data.swipe.currentPoint?data.swipe.currentPoint.y:e.pageY,scrollValue=scrollArea.getOffset()-(currentValue-this._panY)/(this.components.dimensionAxis._discreteSpacing||28),this._panY=currentValue),scrollValue=0>scrollValue?0:scrollValue,scrollArea.setOffset(scrollValue)}function checkSelectionState(selections){var type=selections.getActiveType(),tooltipType=selections.types.tooltip;type&&"range.dimension"===type.getActiveMode()&&type.cancel(),tooltipType&&tooltipType.clearSelection()}function updateAvailableSelectionTypes(numDimensions,numMeasures,hasStackedDataSource,colorMode){var discreteDirection,continuousDirection,dimensionAxis=[],measureAxis=[];Object.keys(this.components).forEach(function(key){this.components[key]instanceof DiscreteAxis?dimensionAxis.push(this.components[key]):this.components[key]instanceof ContinuousAxis&&!this.components[key].isStacked&&measureAxis.push(this.components[key])}.bind(this)),discreteDirection=["top","bottom"].contains(dimensionAxis[0].dock)?"x":"y",continuousDirection="x"===discreteDirection?"y":"x",this.selections.types.range.setComponent(discreteDirection,dimensionAxis),1===numDimensions&&this.selections.types.tooltip.setComponent(discreteDirection,dimensionAxis),this.selections.types.range.setComponent(continuousDirection,measureAxis),hasStackedDataSource&&(numDimensions>1||numMeasures>1)?(this.selections.types.range.setComponent(continuousDirection,[]),"byMeasure"===colorMode?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)}function disablePagingTransitions(){this._isPagingTransitionEnabled&&(this.components.measureAxis.setDataRangeTransition(!1),this.components.measureAxis.stopListen("endTransition",onAxisTransitionEnded,this),this.components.measureAxis.stopListen("startTransition",onAxisTransitionStarted,this),clearTimeout(this._pagingTransitionTimer),delete this.components.measureAxis.setDataRange,this._isPagingTransitionEnabled=!1)}function onAxisTransitionEnded(){this.components.refLineLabels&&this.layout();for(var key in this.components)this.components[key].invalidateDisplay("ScrollableChart.onAxisTransitionEnded")}function onAxisTransitionStarted(){this._visibleRefLines=this.components.refLineLabels.isVisible()}function enablePagingTransitions(){if(!this._isPagingTransitionEnabled){this._isPagingTransitionEnabled=!0;var self=this,axis=this.components.measureAxis,protoSetDataRange=axis.setDataRange;axis.listen("endTransition",onAxisTransitionEnded,this),axis.listen("startTransition",onAxisTransitionStarted,this),this._pagingTransitionTimer=null,this.components.measureAxis.setDataRange=function(min,max){clearTimeout(self._pagingTransitionTimer),self._pagingTransitionTimer=setTimeout(function(){var key;axis.setDataRangeTransition(!0),protoSetDataRange.apply(axis,[min,max]),self.layout();for(key in self.components)self.components[key].invalidateDisplay()},500)}}}function updateScrollabilityCue(){var canIncrease,canDecrease,pos,max,range,scroll=this.components.scrollArea,$c=this._scrollableHint,directions=[];this._scrollAffordance||(this._scrollAffordance={canIncrease:!1,canDecrease:!1}),pos=scroll.getOffset(),range=scroll.getViewRange(),max=scroll.fullState.max,canDecrease=pos>0,canIncrease=max>pos+range,(canDecrease!==this._scrollAffordance.canDecrease||canIncrease!==this._scrollAffordance.canIncrease)&&(this._scrollAffordance.canIncrease=canIncrease,this._scrollAffordance.canDecrease=canDecrease,canDecrease&&directions.push(scroll.isVertical()?"up":"left"),canIncrease&&directions.push(scroll.isVertical()?"down":"right"),$c.attr("class",function(i,c){return c.replace(/\bqv-chart-scrollable-\S+/g,"")}),$c.addClass("qv-chart-scrollable-"+directions.join("-")))}var ScrollableChart,PAGING={NONE:0,ONE_DIM:1,TWO_DIM:2};return ScrollableChart=AxisChart.extend("ScrollableChart",{init:function($scope,$element,superoptions,backendApi){var self=this,options=$.extend(!0,{providers:{colorMap:{clazz:ColorMap,multiDimScheme:"last"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.SPARK},miniChart:{show:!0,clazz:MiniChart,components:{dimensionAxis:{show:!1,clazz:DiscreteAxis},measureAxis:{show:!1},dataArea:{isMini:!0,show:!0}}},xAxis:{clazz:DiscreteAxis,reductionOrder:10,shrinkToFitThreshold:.85,showFlag:{whenVertical:{vertical:ChartComponent.prototype.ShowFlags.XSMALL,horizontal:ChartComponent.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:ChartComponent.prototype.ShowFlags.SMALL,horizontal:ChartComponent.prototype.ShowFlags.XSMALL}},titleShowFlag:{whenVertical:{vertical:ChartComponent.prototype.ShowFlags.XSMALL,horizontal:ChartComponent.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:ChartComponent.prototype.ShowFlags.MEDIUM,horizontal:ChartComponent.prototype.ShowFlags.XSMALL}}},xAxisTitle:{showFlag:{whenVertical:{vertical:ChartComponent.prototype.ShowFlags.XSMALL,horizontal:ChartComponent.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:ChartComponent.prototype.ShowFlags.MEDIUM,horizontal:ChartComponent.prototype.ShowFlags.XSMALL}},reductionOrder:1},scrollArea:{sortKey:2,show:!0,dock:"bottom",order:2,relevantSize:20,reductionOrder:10.1,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:ScrollArea},refLineLabels:{show:!0,dock:"right",order:3,reductionOrder:3,showFlag:{whenVertical:{vertical:ChartComponent.prototype.ShowFlags.XSMALL,horizontal:ChartComponent.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:ChartComponent.prototype.ShowFlags.MEDIUM,horizontal:ChartComponent.prototype.ShowFlags.XSMALL}},clazz:RefLineLabels}}},superoptions||{});this._super($scope,$element,options,backendApi),this._scrollableHint=$("<div class='qv-chart-scrollable'>").appendTo($element),this._changeWatchers=this._changeWatchers||[],this._pagingInfo=new Rect(0,0,0,0),this.components.measureAxis=this.components.yAxis,this.components.dimensionAxis=this.components.xAxis,this.components.dimensionAxisTitle=this.components.xAxisTitle,delete this.components.xAxisTitle,delete this.components.xAxis,delete this.components.yAxis,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(ev,col,index){self.backendApi.drillUp(col,index)}),this.components.scrollArea.listen("scrollStart",function(){checkSelectionState(this.selections)}.bind(this)),this._showLegend=!1,this.scrollMultiplicator=1,this.components.dataArea.setMinorAxis(this.components.measureAxis),this.components.dataArea.setMajorAxis(this.components.dimensionAxis),this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis),this.components.dimensionAxis.setMinDiscreteUnitSize(28),this._changeWatchers.push(Binding.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(Binding.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(Binding.bindSetter(function(){self.components.dimensionAxis.setOffset(self.components.scrollArea.getOffset())},this.components.scrollArea,"offset")),this._changeWatchers.push(Binding.bindSetter(function(v){self.components.scrollArea.setFullRange(v)},this.components.dimensionAxis,"numDiscreteUnits")),this._changeWatchers.push(Binding.bindSetter(function(v){self.components.scrollArea.setViewRange(self._pagingMode===PAGING.TWO_DIM?v/2:v)},this.components.dimensionAxis,"numDiscreteUnitsInView")),this._changeWatchers.push(Binding.bindSetter(function(){self._checkPage!==!1&&self.checkPage(),updateScrollabilityCue.call(self)},this.components.dimensionAxis,"offset"))},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.Pan.bind(this.onPan.bind(this)),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},getSnapshotSize:function(){var w=this.rect.width,h=this.rect.height,snapshotChartData=this.getSnapshotChartData();return!snapshotChartData.hasMiniChart&&this.components.scrollArea.isVisible()&&(this.components.scrollArea.isVertical()?w-=this.components.scrollArea.rect.width:h-=this.components.scrollArea.rect.height),{w:w,h:h}},getSnapshotChartData:function(options){var obj=$.extend(!0,this._super()||{},{scrollOffset:options&&options.ignoreReducedData?0:this.components.scrollArea.getOffset(),discreteSpacing:this.components.dimensionAxis.getDiscreteSpacing(),axisInnerOffset:options&&options.ignoreReducedData?0:this.components.dimensionAxis.getInnerOffset(),hasMiniChart:this.components.miniChart&&!!this.components.miniChart.isVisible()});return options&&options.ignoreReducedData&&this.components.measureAxis.isStacked&&(obj.dataRanges=[{min:this.components.measureAxis.getPlotMin(),max:this.components.measureAxis.getPlotMax()}]),obj},setSnapshotData:function(snapshotLayout,options){function getPage(){var scroll=this.components.scrollArea,scrollP=scroll.getOffset()/this.scrollMultiplicator,scrollPos=Math.round(scrollP),scrollR=scroll.getViewRange()/this.scrollMultiplicator,scrollRange=Math.round(scrollR-(scrollPos-scrollP)),dataPos=this._pagingInfo.y;if(isNaN(scrollRange)&&(scrollRange=10),this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qMeasureInfo.length>1)scrollPos=Math.floor(scrollP),scrollRange=Math.ceil(scrollR-(scrollPos-scrollP)),snapshotLayout.snapshotData.content.chartData.scrollOffset=scroll.getOffset()%this.scrollMultiplicator;else if(this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qDimensionInfo.length>1){var t=this.components.dataArea._tree;if(scrollPos=Math.max(Math.round(scrollP-.5),dataPos),scrollRange=Math.round(this.components.dimensionAxis.getNumDiscreteUnitsInView()-(scrollPos-(scrollP-.5))),t){var child,i=0,j=0,numDataPoints=0,num=dataPos;if(dataPos!==scrollPos){for(i=0;i<t.children.length&&scrollPos>num;i++,
num++)for(child=t.children[i],j=0;j<child.children.length&&scrollPos>num;j++,++num)numDataPoints++;scrollPos=dataPos+numDataPoints,i=Math.max(0,i-1),j=Math.max(0,j-1)}for(numDataPoints=0,num=0;i<t.children.length&&scrollRange>num;i++,num++){for(child=t.children[i],j;j<child.children.length&&scrollRange>num;j++,++num)numDataPoints++;j=0}scrollRange=numDataPoints}else scrollRange*=2}return{qTop:scrollPos,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:scrollRange}}this._super(snapshotLayout,options);var d=Deferred();if(!options||!options.ignoreReducedData)return d.resolve(snapshotLayout),d.promise;delete snapshotLayout.reducedHyperCube;var cube=snapshotLayout.qHyperCube;if("K"===cube.qMode){var slicer=new StackedCubeSlicer;slicer.store(cube.qStackedDataPages);var dd=slicer.get([getPage.call(this)]);cube.qSize.qcy=dd[0].qArea.qHeight,dd[0]&&dd[0].qData[0]&&(dd[0].qData[0].qDown=0,dd[0].qData[0].qUp=0),cube.qStackedDataPages=dd,d.resolve(snapshotLayout)}else this.backendApi.getData([getPage.call(this)]).then(function(dataPages){"S"===cube.qMode?cube.qDataPages=dataPages:cube.qStackedDataPages=dataPages,cube.qSize.qcy=dataPages[0].qArea.qHeight,cube.qDimensionInfo[0].qStateCounts&&(cube.qDimensionInfo[0].qStateCounts.qOption=cube.qSize.qcy,cube.qDimensionInfo[0].qStateCounts.qSelected=0),d.resolve(snapshotLayout)});return d.promise},getViewState:function(){return{scrollOffset:this.components.scrollArea.getOffset(),axisInnerOffset:this.components.dimensionAxis.getInnerOffset()}},checkPage:function(reLayout){if(!this.isValid(this._data)||!this._pagingMode)return!1;var scroll=this.components.scrollArea,scrollPos=Math.floor(scroll.getOffset()/this.scrollMultiplicator),dataPos=this._pagingInfo.y,dataHeight=this._pagingInfo.height,scrollBuffer=this._pagingMode===PAGING.TWO_DIM?0:20,scrollRange=Math.ceil(scroll.getViewRange()/this.scrollMultiplicator);return isNaN(scrollRange)&&(scrollRange=500),this._pagingMode===PAGING.TWO_DIM&&(scrollRange*=2),scrollPos+scrollRange>dataPos+dataHeight||Math.max(0,scrollPos)<dataPos?this.pageData(Math.floor(Math.max(0,scrollPos-scrollBuffer)),scrollRange+2*scrollBuffer,reLayout):void 0},pageData:function(top,height,reLayout){if("function"!=typeof this.backendApi.getReducedData)return!1;var def=Deferred();if(this._data.qHyperCube){var hasData,self=this;hasData="K"===this._data.qHyperCube.qMode?this._data.qHyperCube.qStackedDataPages[0]&&this._data.qHyperCube.qStackedDataPages[0].qData&&this._data.qHyperCube.qStackedDataPages[0].qData.length>0:this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>0,0>=height?("S"===self._data.qHyperCube.qMode?self._data.qHyperCube.qDataPages=[]:self._data.qHyperCube.qStackedDataPages=[],self._pagingInfo.set(top,0,this._data.qHyperCube.qSize.qcx,height)):this.backendApi.getData([{qTop:top,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:height}]).then(function(dataPages){if("S"===self._data.qHyperCube.qMode){self._data.qHyperCube.qDataPages=dataPages;var area=dataPages[0].qArea;self._pagingInfo.set(area.qLeft,area.qTop,area.qWidth,area.qHeight)}else self._data.qHyperCube.qStackedDataPages=dataPages,self._pagingInfo.set(0,top,self._data.qHyperCube.qSize.qcx,height);reLayout||!hasData?(self._chartContext.refresh(self._data),self.paint(self._data).then(function(){def.resolve()})):self.partialUpdate(self._data).then(function(){def.resolve()})})}else def.resolve();return def.promise},partialUpdate:function(data){var key,top,major,minor,dfds=[];enablePagingTransitions.call(this),this._chartContext.refresh(data),this.providers.colorMap.setData(data),top=data.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:data.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(top*this.scrollMultiplicator);for(key in this.components)"miniChart"!==key&&this.components[key].invalidateProperties("ScrollableChart.partialUpdate");return this.components.dataArea.updateNow(["properties"]),major=this.components.dataArea.getMajorAxisData(),minor=this.components.dataArea.getMinorAxisData(),!minor||this._readStoredData&&this.getSnapshotStoredChartData().dataRanges||this.components.measureAxis.setDataRange(minor.min,minor.max),this.components.dimensionAxis.setDataRange(major.data,major.info),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),dfds.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),dfds.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),dfds.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),Deferred.all(dfds)},_updateData:function(data){if(this._super.apply(this,[].slice.call(arguments)),this._pagingInfo.set(0,0,0,0),this.isValid(data)){var area,lastPage=data.qHyperCube.qStackedDataPages[data.qHyperCube.qStackedDataPages.length-1];area=lastPage&&lastPage.qData?lastPage.qData.length?{qLeft:0,qTop:0,qWidth:data.qHyperCube.qSize.qcx,qHeight:lastPage.qData[0].qSubNodes.length}:lastPage.qArea:data.qHyperCube.qDataPages[0].qArea,this._pagingInfo.set(area.qLeft,area.qTop,area.qWidth,area.qHeight)}},updateAxis:function(data){this._super.apply(this,[].slice.call(arguments)),this._readStoredData&&this.options.hideChartScrollWithoutMiniChart&&!this.components.scrollArea.getUseMiniChart()?this.components.scrollArea.hideComponent():this.components.scrollArea.showComponent(),updateAvailableSelectionTypes.apply(this,[data.qHyperCube.qDimensionInfo.length,data.qHyperCube.qMeasureInfo.length,"S"!==data.qHyperCube.qMode,data.color?data.color.mode:null]),this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_disablePagingTransitions:function(){disablePagingTransitions.call(this)},_enablePagingTransitions:function(){enablePagingTransitions.call(this)},_postResize:function(){this._super(),this.components.dimensionAxis&&this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_updateMinDiscreteUnitSize:function(axis){var totalData=this._data.qHyperCube.qSize.qcy,cube=this._data.qHyperCube,pages="S"===cube.qMode?"qDataPages":"qStackedDataPages",currentAmount=cube[pages]&&cube[pages][0]?cube[pages][0].qArea.qHeight:0;return currentAmount>=totalData&&this.options.components.scrollArea.show===!1?void axis.setMinDiscreteUnitSize(null):void(!axis.isVisible(this._layoutMode)||"title"===this._data.dimensionAxis.show||"all"===this._data.dimensionAxis.show&&"none"===this._data.dimensionAxis.label?this._layoutMode===ChartComponent.prototype.ShowFlags.SPARK?axis.setMinDiscreteUnitSize(7):axis.setMinDiscreteUnitSize(20):axis.setMinDiscreteUnitSize(28))},layout:function(){var fn;if(this.options.components.scrollArea.show===!1){var dimAxis=this.components.dimensionAxis;dimAxis._hideMyLabels=!1,fn=function(){return dimAxis._discreteSpacing*(dimAxis._groupSize||1)<20?(dimAxis._hideMyLabels=!0,!0):void 0}}this._super(this.components.dimensionAxis.isVertical()?"vertical":"horizontal",fn);var r=this.components.dataArea.rect.clone(),padding={top:0,left:0,right:0,bottom:0},axisPadding=this.components.measureAxis.getPadding(),scale=this.components.dataArea.layoutToContainerRatios;padding.top+=axisPadding.top,padding.left+=axisPadding.left,padding.right+=axisPadding.right,padding.bottom+=axisPadding.bottom,this._scrollableHint.css({left:(r.x+padding.left)*scale.x,top:(r.y+padding.top)*scale.y,width:(r.width-padding.left-padding.right)*scale.x,height:(r.height-padding.top-padding.bottom)*scale.y}),updateScrollabilityCue.call(this)},onPan:function(when,e,data){var self=this;switch(when){case"start":self._panX=data.points[0].x,self._panY=data.points[0].y,checkSelectionState(self.selections);break;case"update":panUpdate.apply(self,[e,data]);break;case"end":this._panning=!1}},on:function(){if(this._super(),!this.options._disableSelections){var self=this,namespace=this.namespace,scrollSpeed=3,mouseScroll=function(e){var scrollValue,event=EventUtils.getMouseWheelData(e.originalEvent),scrollArea=self.components.scrollArea,legendRect=self.components.colorLegend.rect.clone(),legendOffset=$(self.components.colorLegend.container).offset();legendRect.x=legendOffset.left,legendRect.y=legendOffset.top,legendRect.pointInside(event.x,event.y)||(scrollValue=Math.floor(scrollArea.getOffset())+(event.delta>0?-scrollSpeed:scrollSpeed),scrollValue=0>scrollValue?0:scrollValue,scrollArea.setOffset(scrollValue),checkSelectionState(self.selections))};Touche(this.container).swipe({id:namespace,options:{preventDefault:!1,useMomentum:!0,touches:2,inertia:.7},start:function(e,data){self._panning=!0,self._panX=data.points[0].x,self._panY=data.points[0].y,checkSelectionState(self.selections)},update:function(e,data){panUpdate.apply(self,[e,data])},end:function(){self._panning=!1}}),Touche(this.container).wheelswipe({id:namespace,options:{useMomentum:!0,inertia:.7},start:function(e){self._panning=!0,self._panX=e.pageX,self._panY=e.pageY,checkSelectionState(self.selections)},update:function(e,data){panUpdate.apply(self,[e,data])},end:function(){self._panning=!1}}),$(this.container).on("mousewheel"+namespace+" DOMMouseScroll"+namespace,EventUtils.throttle(mouseScroll,20)),this.components.miniChart&&$(this.components.miniChart.container).on("mousewheel"+namespace+" DOMMouseScroll"+namespace,EventUtils.throttle(mouseScroll,20))}},off:function(){Touche(this.components.dataArea.container).off("*",this.namespace),Touche(this.container).off("*",this.namespace),this.components.miniChart&&$(this.components.miniChart.container).off(this.namespace),$(this.container).off(this.namespace),this._super()},destroy:function(){this._super(),this._disablePagingTransitions(),this.components.scrollArea.stopListen("scrollStart"),this.components.dimensionAxisTitle.stopListen("drill-up")}})}),define("objects.backend-api/engine-throttle",["jquery","core.utils/class","core.utils/notification","util"],function($,Class,Notification,util){function throttleQueue(q,t){var self=this;this.queuedRequests.push(q),clearTimeout(this._debounceTimer),t>=10?this._debounceTimer=setTimeout(function(){sendLastThrottledRequest.call(self)},t):sendLastThrottledRequest.call(self)}function sendLastThrottledRequest(){if(this.ongoingRequests.length)return void(this.waitingForResponse=!0);var req=this.queuedRequests.pop();for(req&&sendRequest.call(this,req);this.queuedRequests.length;)req=this.queuedRequests.shift(),req.dfd.reject()}function sendRequest(q){this.waitingForResponse=!1,this.ongoingRequests.push(q);var self=this,wrapper=q.wrapper;q.sentAt=Date.now(),wrapper.then(function(){self.ongoingRequests.splice(self.ongoingRequests.indexOf(q),1),q.respondedAt=Date.now(),self.resolvedRequests.push({sentAt:q.sentAt,respondedAt:q.respondedAt,requestedAt:q.requestedAt}),self.resolvedRequests.length>10&&(self.resolvedRequests=self.resolvedRequests.slice(-10)),q.requestedAt>self._latestResolvedRequestedAt?q.dfd.resolve.apply(q.dfd,[].slice.call(arguments)):q.dfd.reject(),self._latestResolvedRequestedAt=q.requestedAt},function(){self.ongoingRequests.splice(self.ongoingRequests.indexOf(q),1),q.respondedAt=Date.now(),q.dfd.reject.apply(q.dfd,[].slice.call(arguments))}).always(function(){self.waitingForResponse&&sendLastThrottledRequest.call(self)}),this.Send.emit(q.data,wrapper)}var Throttle,defaultOptions={enabled:!0,delay:50};return Throttle=Class.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,Notification.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],Notification.release(this)},setOptions:function(opts){this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(var request;this.queuedRequests.length;)request=this.queuedRequests.pop(),request.dfd.reject();for(;this.ongoingRequests.length;)request=this.ongoingRequests.pop(),request.dfd.reject()},queue:function(data){var debounceDelay=this.enabled?this.delay:-1,requestObject={data:data,dfd:new $.Deferred,wrapper:new $.Deferred,requestedAt:Date.now()},avgResponseTime=Math.max(this._getAvgResolutionTime(),debounceDelay);return 1>debounceDelay||this.recentRequests.length<1||Date.now()-this.recentRequests.slice(-1)[0].requestedAt>avgResponseTime?throttleQueue.apply(this,[requestObject,0]):throttleQueue.apply(this,[requestObject,Math.min(debounceDelay,1e3)]),this.recentRequests.push(requestObject),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),requestObject.dfd.promise()},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var avgResponseTime;return this.resolvedRequests.length&&(avgResponseTime=0,this.resolvedRequests.forEach(function(q){avgResponseTime+=q.respondedAt-q.sentAt}),avgResponseTime/=this.resolvedRequests.length),avgResponseTime}})}),define("objects.backend-api/cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(Class,Rect){"use strict";var CubeSlicer,areaRect=new Rect(0,0,0,0),pageRect=new Rect(0,0,0,0);return CubeSlicer=Class.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(areas){return areas.map(function(area){return this.getPage(area)}.bind(this))},getPage:function(area){var storage,i,cover,coverage=[];for(i=0;i<this.pages.length;i++)if(storage=this.pages[i].qArea,areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(storage.qLeft,storage.qTop,storage.qWidth,storage.qHeight),cover=pageRect.intersection(areaRect,!0),coverage.push({coverage:cover?cover.clone():new Rect(0,0,0,0),idx:i}),storage.qLeft<=area.qLeft&&storage.qLeft+storage.qWidth>=area.qLeft+area.qWidth&&storage.qTop<=area.qTop&&storage.qTop+storage.qHeight>=area.qTop+area.qHeight)return this._extract(area,this.pages[i]);return coverage.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),coverage[0].coverage.height>0&&coverage[0].coverage.width>0?this._extract(area,this.pages[coverage[0].idx]):{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(pages){this.pages=pages},containsArea:function(area){for(var a,i=0;i<this.pages.length;i++)if(a=this.pages[i].qArea,a.qLeft<=area.qLeft&&a.qLeft+a.qWidth>=area.qLeft+area.qWidth&&a.qTop<=area.qTop&&a.qTop+a.qHeight>=area.qTop+area.qHeight)return!0;return!1},contains:function(areas){return this.pages&&this.pages.length?0===areas.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(area,fromPage){areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(fromPage.qArea.qLeft,fromPage.qArea.qTop,fromPage.qArea.qWidth,fromPage.qArea.qHeight);var matrix,x,y,intersection=areaRect.intersection(pageRect,!0);return intersection?(y=Math.max(0,area.qTop-fromPage.qArea.qTop),x=Math.max(0,area.qLeft-fromPage.qArea.qLeft),matrix=fromPage.qMatrix.slice(y,y+intersection.height).map(function(row){return row.slice(x,x+intersection.width)}),{qArea:{qTop:intersection.y,qLeft:intersection.x,qWidth:intersection.width,qHeight:intersection.height},qMatrix:matrix}):{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","objects.utils/shapes/rect"],function(CubeSlicer,Rect){"use strict";function addNode(node,slicedTrunk){var key,newNode={};for(key in node)"qSubNodes"!==key&&node.hasOwnProperty(key)&&(newNode[key]=node[key]);return slicedTrunk.push(newNode),newNode}function getSlicedTreeRecursive(offset,length,subNodes){var i,qixNode,node,slicedTrunk=[],subSlicedTree=[],up=0,down=0;for(subNodes.length&&(up=subNodes[0].qUp||0,down=subNodes[subNodes.length-1].qDown||0),i=0;i<subNodes.length;++i)if(qixNode=subNodes[i],qixNode.qSubNodes.length>0&&(subSlicedTree=getSlicedTreeRecursive(offset,length,qixNode.qSubNodes)),node=null,(0===qixNode.qSubNodes.length&&deepCount>=offset&&offset+length>=deepCount||subSlicedTree.length>0)&&(node=addNode(qixNode,slicedTrunk),void 0!==node.qUp&&1===slicedTrunk.length&&(node.qUp=up+i),node.qSubNodes=subSlicedTree),0===qixNode.qSubNodes.length&&deepCount++,deepCount===offset+length){node&&void 0!==node.qDown&&(node.qDown=down+(subNodes.length-1-i));break}return slicedTrunk}function getSlicedTree(offset,length,subNodes){return deepCount=0,getSlicedTreeRecursive(offset,length,subNodes)}var deepCount,PivotCubeSlicer,areaRect=new Rect(0,0,0,0),pageRect=new Rect(0,0,0,0);return PivotCubeSlicer=CubeSlicer.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(area){var storage,i,cover,coverage=[];for(i=0;i<this.pages.length;i++)if(storage=this.pages[i].qArea,areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(storage.qLeft,storage.qTop,storage.qWidth,storage.qHeight),cover=pageRect.intersection(areaRect,!0),coverage.push({coverage:cover?cover.clone():new Rect(0,0,0,0),idx:i}),storage.qLeft<=area.qLeft&&storage.qLeft+storage.qWidth>=area.qLeft+area.qWidth&&storage.qTop<=area.qTop&&storage.qTop+storage.qHeight>=area.qTop+area.qHeight)return this._extract(area,this.pages[i]);return coverage.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),coverage[0].coverage.height>0&&coverage[0].coverage.width>0?this._extract(area,this.pages[coverage[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0}}},_extract:function(area,fromPage){var leftTree,topTree;areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(fromPage.qArea.qLeft,fromPage.qArea.qTop,fromPage.qArea.qWidth,fromPage.qArea.qHeight);var matrix,x,y,intersection=areaRect.intersection(pageRect,!0);return intersection?(y=Math.max(0,area.qTop-fromPage.qArea.qTop),x=Math.max(0,area.qLeft-fromPage.qArea.qLeft),matrix=fromPage.qData.slice(y,y+intersection.height).map(function(row){return row.slice(x,x+intersection.width)}),leftTree=getSlicedTree(y,intersection.height,fromPage.qLeft),topTree=getSlicedTree(x,intersection.width,fromPage.qTop),{qLeft:leftTree,qTop:topTree,qData:matrix,qArea:{qTop:intersection.y,qLeft:intersection.x,qWidth:intersection.width,qHeight:intersection.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["jquery","core.utils/class","util","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function($,Class,util,EngineThrottle,CubeSlicer,PivotCubeSlicer){var Cache,defaultOptions={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250};return Cache=Class.extend("CacheCube",{init:function(model,responseProperty,path,opts){this.model=model,this.responseProperty=responseProperty,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(opts||{}),this.setPath(path),"P"===this.options.mode?this.cube=new PivotCubeSlicer:this.cube=new CubeSlicer,this.throttle=new EngineThrottle;var self=this;this.throttle.Send.bind(function(areas,dfd){var directions=self._getDirections(self.throttle.recentRequests.map(function(q){return{top:q.data[0].qTop,left:q.data[0].qLeft}})),areasToCache=self._getAreasToCache(areas,directions.vertical,directions.horizontal);self.cacheData(areasToCache,areas).then(function(subset){self.cube?dfd.resolve(subset):dfd.reject()},function(){dfd.reject()})}),this._modelBinding=function(){self.clear()},this.model.Invalidated.bind(this._modelBinding)},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(s){this.method=s},setPath:function(s){this.path=s},setCubeSize:function(size){this.cubeHeight=size.qcy,this.cubeWidth=size.qcx},setOptions:function(opts){opts&&(this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(dataPages){this.clear(),dataPages&&dataPages.length&&this.cube.store(dataPages)},cacheData:function(areasToCache,subset){return this.model.rpc(this.method,this.responseProperty,[this.path,areasToCache]).then(function(pages){return this.cube?(this.cube.store(pages),this.cube.get(subset)):pages}.bind(this))},getData:function(srcAreas){if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model.rpc(this.method,this.responseProperty,[this.path,srcAreas]);var i,area,areas=[];for(i=0;i<srcAreas.length;++i)area=srcAreas[i],areas.push({qTop:Math.max(Math.floor(area.qTop),0),qLeft:Math.max(area.qLeft,0),qHeight:Math.min(area.qHeight,this.cubeHeight-Math.floor(area.qTop)),qWidth:Math.min(area.qWidth,this.cubeWidth-area.qLeft)});return this.cube.contains(areas)?(this.throttle.updateResolutionTime(),$.Deferred().resolve(this.cube.get(areas)).promise()):0===areas[0].qTop&&this.cube.isEmpty()?(this.throttle.updateResolutionTime(),this.cacheData(areas,areas)):this.throttle.queue(areas)},_getDirections:function(lastRequests){if(!lastRequests||lastRequests.length<2)return{vertical:0,horizontal:0};var lastCouple=lastRequests.slice(-2),diffY=lastCouple[1].top-lastCouple[0].top,diffX=lastCouple[1].left-lastCouple[0].left;return{vertical:0>diffY?-1:diffY>0?1:0,horizontal:0>diffX?-1:diffX>0?1:0}},_getAreasToCache:function(areas,h,w){var i,wiggleHeight,wiggleWidth,offsetTop,offsetLeft,height,width,top,left,cacheAreas=[];for("undefined"==typeof h&&(h=0),"undefined"==typeof w&&(w=0),i=0;i<areas.length;++i)wiggleHeight=0!==h?Math.floor(.5*Math.max(0,this.cacheHeight-areas[i].qHeight)):0,wiggleWidth=0!==w?Math.floor(.5*Math.max(0,this.cacheWidth-areas[i].qWidth)):0,offsetTop=wiggleHeight*h-wiggleHeight,offsetLeft=wiggleWidth*w-wiggleWidth,height=0!==h?Math.max(0,Math.min(Math.max(areas[i].qHeight,this.cacheHeight),this.cubeHeight)):areas[i].qHeight,width=0!==w?Math.max(0,Math.min(Math.max(areas[i].qWidth,this.cacheWidth),this.cubeWidth)):areas[i].qWidth,top=Math.max(0,Math.min(areas[i].qTop+offsetTop,this.cubeHeight-height)),left=Math.max(0,Math.min(areas[i].qLeft+offsetLeft,this.cubeWidth-width)),cacheAreas.push({qTop:top,qHeight:height,qLeft:left,qWidth:width});return cacheAreas}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(Class,util,EngineThrottle){var Cache,defaultOptions={enabled:!0,debouncing:{enabled:!0,delay:50}};return Cache=Class.extend({init:function(model,responseProperty,path){this.model=model,this.responseProperty=responseProperty,this.options={},this.setOptions({}),this.setPath(path),this.throttle=new EngineThrottle,this.throttle.Send.bind(function(areas,dfd){self.model.rpc(self.method,self.responseProperty,[self.path,areas]).then(function(pages){dfd.resolve(pages)},function(){dfd.reject()})});var self=this;this._modelBinding=function(){self.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(s){this.method=s},setPath:function(s){this.path=s},setOptions:function(opts){this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(areas){return this.enabled?this.throttle.queue(areas):this.model.rpc(this.method,this.responseProperty,[this.path,areas])}})}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle","core.models/app"],function($,Class,Deferred,CacheCube,BackendThrottle,App){"use strict";var BackendApi;return BackendApi=Class.extend("BackendApi",{init:function(model,path,cacheOpts){this.model=model,this.localeInfo=model.session.currentApp.layout.qLocaleInfo,this.path=path,path&&(this.dataPath=path.slice(1,-3)),this.cacheCube=new CacheCube(model,"qDataPages",this.path,cacheOpts),this.backendStackThrottle=new BackendThrottle(model,"qDataPages",this.path)},setCacheOptions:function(o){this.cacheCube.setOptions(o)},updateCache:function(){},applyPatches:function(replaceParams){return this.model.rpc("ApplyPatches",null,replaceParams)},clearSoftProperties:function(){var self=this;return this.model.getLayout().then(function(layout){return layout.qHasSoftPatches?self.model.rpc("ClearSoftPatches"):Deferred.resolve()})},beginSelections:function(){return App.current.switchModal(this.model,this.path)},endSelections:function(accept){return App.current.switchModal(null,null,accept)},clearSelections:function(dimNo){return dimNo=dimNo||0,this.model.rpc("ClearSelections",null,[this.path,[dimNo]])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(callback){var myData=this.model.layout[this.dataPath],cont=!0;myData&&$.each(myData.qDataPages,function(i,page){return $.each(page.qMatrix,function(x,row){return cont=callback(page.qArea.qTop+x,row)}),cont})},drillUp:function(column,steps){return this.model.rpc("DrillUp",null,[this.path,column,steps])},hasSelections:function(){for(var dimensionInfos=this.getDimensionInfos(),i=0;i<dimensionInfos.length;++i)if(dimensionInfos[i].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("objects.backend-api/hypercube-api",["./backend-api"],function(BackendApi){"use strict";var HyperCubeApi;return HyperCubeApi=BackendApi.extend("HyperCube",{init:function(model){this._super(model,"/qHyperCubeDef"),this.cacheCube.setMethodName("GetHyperCubeData")},updateCache:function(layout){layout&&layout.qHyperCube?(this.cacheCube.set(layout.qHyperCube.qDataPages),this.cacheCube.setCubeSize(layout.qHyperCube.qSize)):this.cacheCube.clear()},getData:function(pages){return this.cacheCube.getData(pages)},getHyperCubeBinnedData:function(pages,area,maxNrCells,queryLevel){return this.model.rpc("GetHyperCubeBinnedData","qDataPages",[this.path,pages,{width:0,height:0},area,maxNrCells,queryLevel,0])},getReducedData:function(pages,zoomFactor,reductionMode){return reductionMode=void 0!==reductionMode?reductionMode:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,pages,zoomFactor,reductionMode])},selectRange:function(ranges,orMode,columnsToSelect){var params;return orMode=!!orMode,columnsToSelect=columnsToSelect||[],params=ranges.map(function(o){return{qMeasureIx:o.measure,qRange:{qMin:o.range.min,qMax:o.range.max,qMinInclEq:o.range.minInclEq!==!1,qMaxInclEq:o.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,params,columnsToSelect,orMode])},select:function(rowIndices,colIndices){return this.model.rpc("SelectHyperCubeCells",null,[this.path,rowIndices,colIndices])},selectValues:function(dimNo,values,toggleMode){return this.model.rpc("SelectHyperCubeValues",null,[this.path,dimNo,values,toggleMode])},getProperties:function(){return this.model.getProperties()},save:function(){return this.model.save()},getDimensionInfos:function(){return this.model.layout.qHyperCube.qDimensionInfo},getMeasureInfos:function(){return this.model.layout.qHyperCube.qMeasureInfo},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections}})}),define("objects.backend-api/stacked-api",["./hypercube-api"],function(HyperCubeApi){"use strict";function createPivotSelectionCells(selectionCells,columns,pivotType){var i,j,item,items=[];for(j=0;j<columns.length;j++)for(i=0;i<selectionCells.length;i++)item={qType:pivotType,qCol:columns[j],qRow:selectionCells[i]},items.push(item);return items}var StackedApi;return StackedApi=HyperCubeApi.extend("StackedApi",{init:function(){this._super.apply(this,arguments),this.backendStackThrottle.setMethodName("GetHyperCubeStackData")},updateCache:function(layout){layout&&layout.qHyperCube&&"S"===layout.qHyperCube.qMode?(this.cacheCube.set(layout.qHyperCube.qDataPages),this.cacheCube.setCubeSize(layout.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(pages){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,pages]);case"S":return this.cacheCube.getData(pages);case"K":return this.backendStackThrottle.getData(pages);default:return this.cacheCube.getData(pages)}},getReducedData:function(pages,zoomFactor,reductionMode){return reductionMode=void 0!==reductionMode?reductionMode:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,pages,zoomFactor,reductionMode])},select:function(selectionCells,colIndices,pivotType){switch(this.model.layout.qHyperCube.qMode){case"P":case"K":return this.model.rpc("SelectPivotCells",null,[this.path,createPivotSelectionCells(selectionCells,colIndices,pivotType)]);default:return this.model.rpc("SelectHyperCubeCells",null,[this.path,selectionCells,colIndices])}}})}),define("text!extensions.qliktech/barchart/barchart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div class="qv-viz-disclaimer" ng-if="dataAttributes.limitedData || dataAttributes.hasNegativeData">\r\n	<span>*</span>\r\n	<span ng-if="dataAttributes.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData" ng-style="getDisclaimerStyle(dataAttributes.chartScale)"></span>\r\n</div>\r\n'}),define("objects.extension/export-format",[],function(){"use strict";function ExportFormat(nDataGroups){nDataGroups=void 0!==nDataGroups?nDataGroups:1,this.data=[];for(var i=0;nDataGroups>i;++i)this.data.push({dimensions:[],measures:[]});this.properties={}}return ExportFormat}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","general.utils/property-resolver","translator"],function(util,ExportFormat,arrayUtils,propertyResolver,translator){function moveDefaultIfExist(propName,source,target){source.hasOwnProperty(propName)&&(target[propName]=source[propName])}function moveOrSetDefault(propName,source,target,defaultValue){source.hasOwnProperty(propName)?target[propName]=source[propName]:target[propName]=defaultValue}function importCommonProperties(newProperties,exportedFmt,initialProperties){"masterobject"===exportedFmt.properties.qInfo.qType?newProperties.qInfo.qType="masterobject":newProperties.qInfo.qType=initialProperties.qInfo.qType,newProperties.visualization=initialProperties.visualization}function changeProperty(propertyPath,newValue,object){var properties=object.qProperty,propExcluded=object.qProperty.qLayoutExclude;return/boolean|number|string/.test(typeof newValue)?(propExcluded&&(propExcluded.changed||(propExcluded.changed={}),
propExcluded.changed[propertyPath]={from:propertyResolver.getValue(properties,propertyPath),to:newValue}),void propertyResolver.setValue(properties,propertyPath,newValue)):void propertyResolver.setValue(properties,propertyPath,newValue)}function restoreChangedProperties(tree){for(var propertyPath in tree.qLayoutExclude.changed)tree.qLayoutExclude.changed[propertyPath].to===propertyResolver.getValue(tree,propertyPath)&&propertyResolver.setValue(tree,propertyPath,tree.qLayoutExclude.changed[propertyPath].from)}function quarantineProperty(propertyPath,object,objectType){var stringified,depth,properties=object.properties,propExcluded=object.properties.qLayoutExclude,value=propertyResolver.getValue(properties,propertyPath);if(!/boolean|number|string/.test(typeof value))try{if(stringified=JSON.stringify(value),depth=stringified.match(/:\{/g),depth=depth?depth.length:0,depth>2)return;value=JSON.parse(stringified)}catch(e){return}propExcluded||(object.properties.qLayoutExclude={quarantine:{}},propExcluded=object.properties.qLayoutExclude),propExcluded.quarantine||(propExcluded.quarantine={}),propExcluded.quarantine[objectType]||(propExcluded.quarantine[objectType]={}),propExcluded.quarantine[objectType][propertyPath]=value}function unquarantineObject(tree,id){var p,props=tree.qLayoutExclude?tree.qLayoutExclude.quarantine:{};if(!props[id])return!1;props=props[id];for(p in props)propertyResolver.setValue(tree,p,props[p]);return delete tree.qLayoutExclude.quarantine[id],!0}var hypercube,listbox,colorChart,axisChart,pivotChart,other,MAX_SAFE_INTEGER=Math.pow(2,53)-1;return hypercube={exportProperties:function(propertyTree){var i,key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty,hcd=properties.qHyperCubeDef,dataGroup=exportFmt.data[0];for(i=0;i<hcd.qDimensions.length;++i)dataGroup.dimensions.push(hcd.qDimensions[i]);if(hcd.qLayoutExclude&&hcd.qLayoutExclude.qHyperCubeDef&&hcd.qLayoutExclude.qHyperCubeDef.qDimensions)for(i=0;i<hcd.qLayoutExclude.qHyperCubeDef.qDimensions.length;++i)dataGroup.dimensions.push(hcd.qLayoutExclude.qHyperCubeDef.qDimensions[i]);for(i=0;i<hcd.qMeasures.length;++i)dataGroup.measures.push(hcd.qMeasures[i]);if(hcd.qLayoutExclude&&hcd.qLayoutExclude.qHyperCubeDef&&hcd.qLayoutExclude.qHyperCubeDef.qMeasures)for(i=0;i<hcd.qLayoutExclude.qHyperCubeDef.qMeasures.length;++i)dataGroup.measures.push(hcd.qLayoutExclude.qHyperCubeDef.qMeasures[i]);delete hcd.qLayoutExclude;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude||(properties.qLayoutExclude={}),properties.qLayoutExclude.disabled){for(key in properties.qLayoutExclude.disabled)propName=key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);delete properties.qLayoutExclude.disabled}return properties.qLayoutExclude.changed&&(restoreChangedProperties(properties),delete properties.qLayoutExclude.changed),(!properties.qLayoutExclude.quarantine||util.isEmpty(properties.qLayoutExclude.quarantine))&&delete properties.qLayoutExclude,exportFmt},importProperties:function(exportedFmt,initialProperties,ext){var key,i,nCols,newPropertyTree={qChildren:[]},newProperties={},dataGroup=exportedFmt.data[0],measureDef=ext.data&&ext.data.measures;measureDef||(measureDef=ext.definition&&ext.definition.items&&ext.definition.items.measures||{max:0});var maxMeasures="function"==typeof measureDef.max?measureDef.max(dataGroup.dimensions.length):isNaN(measureDef.max)?MAX_SAFE_INTEGER:measureDef.max,dimensionDef=ext.data&&ext.data.dimensions;dimensionDef||(dimensionDef=ext.definition&&ext.definition.items&&ext.definition.items.dimensions||{max:0});var maxDimensions="function"==typeof dimensionDef.max?dimensionDef.max(maxMeasures):isNaN(dimensionDef.max)?MAX_SAFE_INTEGER:dimensionDef.max;newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={},newProperties.qLayoutExclude.quarantine={};for(key in exportedFmt.properties)"qLayoutExclude"===key?exportedFmt.properties[key].quarantine&&(newProperties.qLayoutExclude.quarantine=util.extend(!0,{},exportedFmt.properties[key].quarantine)):initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key];for(newProperties=util.extend(!0,{},initialProperties,newProperties),newProperties.qHyperCubeDef.qDimensions.length=0,newProperties.qHyperCubeDef.qMeasures.length=0,(dataGroup.dimensions.length>maxDimensions||dataGroup.measures.length>maxMeasures)&&(newProperties.qHyperCubeDef.qLayoutExclude||(newProperties.qHyperCubeDef.qLayoutExclude={}),newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef={}),dataGroup.dimensions.length>maxDimensions&&(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[])),dataGroup.measures.length>maxMeasures&&(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]))),i=0;i<dataGroup.dimensions.length;++i)dataGroup.dimensions[i].qDef.hasOwnProperty("othersLabel")||(dataGroup.dimensions[i].qDef.othersLabel=translator.get("properties.dimensionLimits.others"));for(i=0;i<dataGroup.dimensions.length;++i)newProperties.qHyperCubeDef.qDimensions.length<maxDimensions?newProperties.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]):newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]);for(i=0;i<dataGroup.measures.length;++i)newProperties.qHyperCubeDef.qMeasures.length<maxMeasures?newProperties.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]):newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]);for(nCols=newProperties.qHyperCubeDef.qDimensions.length+newProperties.qHyperCubeDef.qMeasures.length,newProperties.qHyperCubeDef.qInterColumnSortOrder||(newProperties.qHyperCubeDef.qInterColumnSortOrder=[]),i=newProperties.qHyperCubeDef.qInterColumnSortOrder.length;i!==nCols;)nCols>i?(arrayUtils.indexAdded(newProperties.qHyperCubeDef.qInterColumnSortOrder,i),++i):(--i,arrayUtils.indexRemoved(newProperties.qHyperCubeDef.qInterColumnSortOrder,i));return moveDefaultIfExist("qAlwaysFullyExpanded",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qMaxStackedCells",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qSuppressZero",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qSuppressMissing",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qNoOfLeftDims",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveOrSetDefault("qInitialDataFetch",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),moveOrSetDefault("qMode",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,"S"),moveOrSetDefault("qReductionMode",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,"N"),importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree}},listbox={exportProperties:function(propertyTree){var i,key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty,lo=properties.qListObjectDef,dataGroup=exportFmt.data[0];if(dataGroup.dimensions.push({qLibraryId:lo.qLibraryId,qDef:lo.qDef,title:lo.title}),lo.qLayoutExclude&&lo.qLayoutExclude.qHyperCubeDef&&lo.qLayoutExclude.qHyperCubeDef.qDimensions)for(i=0;i<lo.qLayoutExclude.qHyperCubeDef.qDimensions.length;++i)dataGroup.dimensions.push(lo.qLayoutExclude.qHyperCubeDef.qDimensions[i]);if(lo.qLayoutExclude&&lo.qLayoutExclude.qHyperCubeDef&&lo.qLayoutExclude.qHyperCubeDef.qMeasures)for(i=0;i<lo.qLayoutExclude.qHyperCubeDef.qMeasures.length;++i)dataGroup.measures.push(lo.qLayoutExclude.qHyperCubeDef.qMeasures[i]);delete lo.qLayoutExclude;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude&&properties.qLayoutExclude._disabled){for(key in properties.qLayoutExclude._disabled)propName="_"===key.substr(0,1)?key.substring(1):key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);delete properties.qLayoutExclude.disabled}for(i=0;i<dataGroup.dimensions[0].qDef.qSortCriterias.length;++i)dataGroup.dimensions[0].qDef.qSortCriterias[i].qSortByFrequency=0;return exportFmt},importProperties:function(exportedFmt,initialProperties){var key,i,newPropertyTree={qChildren:[]},newProperties={},dataGroup=exportedFmt.data[0],maxDimensions=1;newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={};for(key in exportedFmt.properties)"qLayoutExclude"===key?exportedFmt.properties[key].quarantine&&(newProperties.qLayoutExclude.quarantine=util.extend(!0,{},exportedFmt.properties[key].quarantine)):initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key];for(newProperties=util.extend(!0,{},initialProperties,newProperties),newProperties.qListObjectDef.qLayoutExclude||(newProperties.qListObjectDef.qLayoutExclude={}),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),i=0;i<dataGroup.dimensions.length;++i)maxDimensions>i?(newProperties.qListObjectDef.qDef=dataGroup.dimensions[i].qDef,newProperties.qListObjectDef.qLibraryId=dataGroup.dimensions[i].qLibraryId):newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]);for(i=0;i<dataGroup.measures.length;++i)newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]);return newProperties.qListObjectDef.qInitialDataFetch=initialProperties.qListObjectDef.qInitialDataFetch,importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree}},colorChart={importProperties:function(exportedFmt,initialProperties,definition){var propTree=this.hypercube.importProperties(exportedFmt,initialProperties,definition),visualization=propertyResolver.getValue(propTree,"qProperty.visualization"),dimensions=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qDimensions",[]),numMeasures=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures",[]).length,attributeExps=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),colorExps=propertyResolver.getValue(propTree,"qProperty.color.colorExpression",""),colorMode=propertyResolver.getValue(propTree,"qProperty.color.mode",""),isPersistent=propertyResolver.getValue(propTree,"qProperty.color.persistent",!1);return numMeasures&&(attributeExps.splice(0,0,{qExpression:colorExps,type:"colorByExpression"}),propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",attributeExps)),("scatterplot"===visualization||numMeasures>1)&&"byMeasure"===colorMode&&propertyResolver.setValue(propTree,"qProperty.color.mode","primary"),dimensions.length>1&&!isPersistent&&changeProperty("color.persistent",!0,propTree),dimensions.forEach(function(d){"qTotalMode"in d.qOtherTotalSpec&&delete d.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in d.qOtherTotalSpec&&delete d.qOtherTotalSpec.qGlobalOtherGrouping}),propTree},exportProperties:function(propertyTree){var expFormat=this.hypercube.exportProperties(propertyTree),index=-1,attributeExps=propertyResolver.getValue(expFormat,"properties.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]);return attributeExps.every(function(element,i){"colorByExpression"===element.type&&(index=i)}),index>=0&&attributeExps.splice(index,1),expFormat}},axisChart={importProperties:function(exportedFmt,initialProperties,definition){var temp,index,propTree=this.colorChart.importProperties.apply(this,[exportedFmt,initialProperties,definition]),props=propTree.qProperty;if(initialProperties.measureAxis&&"undefined"==typeof initialProperties.measureAxis.autoMinMax?unquarantineObject(props,"unsupportedAutoMinMax")||util.extend(props.measureAxis,initialProperties.measureAxis):unquarantineObject(props,"supportedAutoMinMax")||util.extend(props.measureAxis,initialProperties.measureAxis),exportedFmt.properties.measureAxes&&!initialProperties.measureAxes&&initialProperties.measureAxis&&"undefined"!=typeof initialProperties.measureAxis.autoMinMax){var measuresPerAxis=[];if(props.qHyperCubeDef.qMeasures.length>0&&props.qHyperCubeDef.qMeasures.forEach(function(measure){measure.qDef.series&&(measuresPerAxis[measure.qDef.series.axis]||(measuresPerAxis[measure.qDef.series.axis]={axis:measure.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(measure.qDef.series.type)&&measuresPerAxis[measure.qDef.series.axis].type[measure.qDef.series.type]++,measuresPerAxis[measure.qDef.series.axis].type.total++)}),measuresPerAxis.length){var type="barchart"===initialProperties.visualization?"bar":"linechart"===initialProperties.visualization?"line":"";type&&(temp=measuresPerAxis.filter(function(m){return m.type[type]>0}).sort(function(a,b){return b.type[type]-a.type[type]})),temp&&temp.length||(temp=measuresPerAxis.sort(function(a,b){return b.type.total-a.type.total})),temp&&temp[0]&&util.extend(props.measureAxis,exportedFmt.properties.measureAxes[temp[0].axis])}else util.extend(props.measureAxis,exportedFmt.properties.measureAxes[0])}return props.qHyperCubeDef.qDimensions.length>1&&(index=props.qHyperCubeDef.qInterColumnSortOrder.indexOf(0),0!==index&&(temp=props.qHyperCubeDef.qInterColumnSortOrder[0],props.qHyperCubeDef.qInterColumnSortOrder[0]=0,props.qHyperCubeDef.qInterColumnSortOrder[index]=temp)),propTree},exportProperties:function(propertyTree){var exportedFmt=this.colorChart.exportProperties.apply(this,[propertyTree]);return"gauge"===exportedFmt.properties.visualization?(quarantineProperty("measureAxis.min",exportedFmt,"unsupportedAutoMinMax"),quarantineProperty("measureAxis.max",exportedFmt,"unsupportedAutoMinMax")):(quarantineProperty("measureAxis.min",exportedFmt,"supportedAutoMinMax"),quarantineProperty("measureAxis.max",exportedFmt,"supportedAutoMinMax")),exportedFmt}},pivotChart={importProperties:function(exportedFmt,initialProperties,definition){var i,lastPivotSortOrder,propTree=this.hypercube.importProperties(exportedFmt,initialProperties,definition),dimensions=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qDimensions",[]),numDimensions=dimensions.length,numMeasures=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures",[]).length,interColSortOrder=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),restoreNoOfLeftDims=!0;numDimensions+numMeasures===interColSortOrder.length&&propertyResolver.setValue(propTree,"qProperty.qLayoutExclude.quarantine.interColSortOrder",interColSortOrder);var pivotInterColSortOrder=propertyResolver.getValue(propTree,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");if(pivotInterColSortOrder&&(interColSortOrder=pivotInterColSortOrder,lastPivotSortOrder=pivotInterColSortOrder.slice(),propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qInterColumnSortOrder",interColSortOrder),delete propTree.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder),numDimensions>interColSortOrder.length)for(i=interColSortOrder.length;numDimensions>i;i++)interColSortOrder.indexOf(i)<0&&interColSortOrder.push(i);for(i=interColSortOrder.length-1;i>=0;i--)interColSortOrder[i]>=numDimensions&&interColSortOrder.splice(i,1);if(numMeasures>1&&interColSortOrder.indexOf(-1)<0?interColSortOrder.push(-1):2>numMeasures&&interColSortOrder.indexOf(-1)>-1&&interColSortOrder.splice(interColSortOrder.indexOf(-1),1),numDimensions>0&&-1===propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)&&propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qNoOfLeftDims",numDimensions),lastPivotSortOrder&&interColSortOrder&&lastPivotSortOrder.length===interColSortOrder.length){for(i=0;i<lastPivotSortOrder.length;i++)if(lastPivotSortOrder[i]!==interColSortOrder[i]){restoreNoOfLeftDims=!1;break}restoreNoOfLeftDims&&unquarantineObject(propTree.qProperty,"noOfLeftDims")}return dimensions.forEach(function(d){"qTotalMode"in d.qOtherTotalSpec||(d.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),propTree},exportProperties:function(propertyTree){var expFormat=this.hypercube.exportProperties(propertyTree),hypercube=expFormat.properties.qHyperCubeDef,numDimensions=hypercube.qDimensions.length,numMeasures=hypercube.qMeasures.length,interColSortOrder=hypercube.qInterColumnSortOrder;propertyResolver.setValue(expFormat,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",interColSortOrder.slice(0)),quarantineProperty("qHyperCubeDef.qNoOfLeftDims",expFormat,"noOfLeftDims");var hypercubeInterColSortOrder=propertyResolver.getValue(expFormat,"properties.qLayoutExclude.quarantine.interColSortOrder");hypercubeInterColSortOrder&&(interColSortOrder=hypercubeInterColSortOrder,propertyResolver.setValue(expFormat,"properties.qHyperCubeDef.qInterColumnSortOrder",interColSortOrder),delete expFormat.properties.qLayoutExclude.quarantine.interColSortOrder);var pseudoIdx=interColSortOrder.indexOf(-1);pseudoIdx>-1&&interColSortOrder.splice(pseudoIdx,1);for(var i=interColSortOrder.length;numDimensions+numMeasures>i;i++)interColSortOrder.length<=i&&interColSortOrder.push(i);return expFormat}},other={importProperties:function(exportedFmt,initialProperties){var key,newPropertyTree={qChildren:[]},newProperties={};newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={};for(key in exportedFmt.properties)"qLayoutExclude"!==key&&(initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key]);return newProperties=util.extend(!0,{},initialProperties,newProperties),importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree},exportProperties:function(propertyTree){var key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude||(properties.qLayoutExclude={}),properties.qLayoutExclude.disabled)for(key in properties.qLayoutExclude.disabled)propName=key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);return delete properties.qLayoutExclude,exportFmt}},{importCommonProperties:importCommonProperties,hypercube:hypercube,listbox:listbox,axisChart:axisChart,colorChart:colorChart,pivotChart:pivotChart,other:other,changeProperty:changeProperty}}),define("extensions.qliktech/barchart/barchart",["jquery","util","client.utils/state","core.utils/deferred","extensions.qliktech/barchart/bararea","extensions.qliktech/barchart/barchart-properties","extensions.qliktech/barchart/barchart-data","extensions.qliktech/barchart/barchart-explore-properties","objects.views/charts/scrollable-chart","objects.backend-api/stacked-api","text!./barchart.ng.html","objects.extension/object-conversion"],function($,util,State,Deferred,BarArea,barchartPropertiesDefinition,barchartData,softOptions,ScrollableChart,StackedApi,template,objectConversion){"use strict";function updateAxisSettings(dimensionAxis,dimensionAxisTitle,measureAxis,scroll,data,orientation){var temp,dimensionDock=["bottom","top"],measureDock=["left","right"];"horizontal"===orientation?(temp=dimensionDock,dimensionDock=measureDock,measureDock=temp,scroll.setDock("right")):scroll.setDock("bottom"),dimensionAxis.setDock("far"===data.dimensionAxis.dock?dimensionDock[1]:dimensionDock[0]),dimensionAxisTitle.setDock("far"===data.dimensionAxis.dock?dimensionDock[1]:dimensionDock[0]),measureAxis.setDock("far"===data.measureAxis.dock?measureDock[1]:measureDock[0])}var BarChart,UNDEF,INITIAL_FETCH=500,PAGING={NONE:0,ONE_DIM:1,TWO_DIM:2};return BarChart=ScrollableChart.extend("BarChart",{namespace:".barchart",init:function($scope,$element,options,backendApi){var miniChart,dummy=$.extend(!0,{},options);this.$scope=$scope,options=$.extend(!0,options||{},{components:{dataArea:{clazz:BarArea},miniChart:{components:{dataArea:{clazz:BarArea}}}}},dummy),this._super($scope,$element,options,backendApi),this._data={},this._tree=null,this.components.dimensionAxis.setMaxDiscreteUnitSize(64),miniChart=this.components.miniChart,this.components.miniChart&&(this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setUseMiniChart(!0),miniChart.components.measureAxis.setDock("left"),miniChart.components.dimensionAxis.setDock("bottom"),miniChart.components.dataArea.setMinorAxis(miniChart.components.measureAxis),miniChart.components.dataArea.setMajorAxis(miniChart.components.dimensionAxis),miniChart.components.dataArea.setShowDataPoints(!1),miniChart.setColorMap(this.providers.colorMap)),this._orientation="vertical"},initSelections:function(){this.options._disableSelections||this.selections.Select.bind(function(shapes,toggle){var dimensions=[0];this.selections._activeType.components.dataArea?dimensions=this.components.dataArea.getSelectionIndices()||[0]:this.selections._activeType.components.colorLegend&&(dimensions=this.components.colorLegend.getSelectionIndices()),this.onSelection.Select.apply(this,[shapes,toggle,dimensions,"L"])}.bind(this)),this._super()},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var key,data=this._data,scroll=this.components.scrollArea,storedData=this.getSnapshotStoredChartData(),s="vertical"===data.orientation?this.rect.height:this.rect.width,cutOffPad=0,dfds=[];this._cutMode?((this._cutMode.positive||this._cutMode.negative)&&(cutOffPad=this._layoutMode>=15?32:this._layoutMode>=7?16:8),"vertical"===data.orientation?this.components.measureAxis.setPadding(this._cutMode.positive?cutOffPad:0,0,this._cutMode.negative?cutOffPad:0,0):this.components.measureAxis.setPadding(0,this._cutMode.positive?cutOffPad:0,0,this._cutMode.negative?cutOffPad:0)):this.components.measureAxis.setPadding(0,0,0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(s/4))),this.components.dimensionAxisTitle.setFont(this.components.dimensionAxis._style.title.font),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(dfds.push(this.components.miniChart.setData(data)),this._dataForMiniChartChanged=!1),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(storedData.axisInnerOffset),this.components.scrollArea.setOffset(storedData.scrollOffset)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset));var page=this.checkPage();if(page)dfds.push(page);else{for(key in this.components)dfds.push(this.components[key].invalidateDisplay("BarChart.paint"));scroll.viewState.min+scroll.viewState.range>scroll.fullState.max&&scroll.setOffset(scroll.fullState.max-scroll.viewState.range)}return Deferred.all(dfds)},prePaint:function(){this._super()},_updateData:function(data){this._checkPage=!1,this._disablePagingTransitions.call(this),this._data=data,this._dataForMiniChartChanged=!0,this.isStacked="stacked"===data.barGrouping.grouping&&(data.qHyperCube.qDimensionInfo.length>1||data.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(!0),this.components.dataArea.setData(data),this.providers.colorMap.setData(data),this.components.colorLegend.setData(data),this.components.dimensionAxisTitle.setData(data),data.orientation&&this.components.miniChart?(this._orientation!==data.orientation&&(this.components.miniChart.clear(),this._orientation=data.orientation),this.components.miniChart.setOrientation(data.orientation),this.components.scrollArea.setMiniChart(this.components.miniChart)):this._orientation=data.orientation;var options={axes:{measureAxis:{component:this.components.measureAxis},dimensionAxis:{component:this.components.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle}},refLineLabels:{labels:{data:data.refLine.refLines,component:this.components.refLineLabels}},refLines:{component:this.components.refLines}},numDiscrete=null,storedData=this.getSnapshotStoredChartData();this.scrollMultiplicator=data.qHyperCube.qDimensionInfo.length<2&&"grouped"===data.barGrouping.grouping&&data.qHyperCube.qMeasureInfo.length>1?data.qHyperCube.qMeasureInfo.length+1:1,this._pagingMode=PAGING.NONE,this.components.dataArea._allowInnerSelection=!1,data.qHyperCube.qDimensionInfo.length<2&&data.qHyperCube.qSize.qcy>INITIAL_FETCH?(numDiscrete=data.qHyperCube.qSize.qcy,"grouped"===data.barGrouping.grouping&&data.qHyperCube.qMeasureInfo.length>1&&(this.scrollMultiplicator=data.qHyperCube.qMeasureInfo.length+1,numDiscrete*=this.scrollMultiplicator),this._pagingMode=PAGING.ONE_DIM):data.qHyperCube.qDimensionInfo.length>1&&"grouped"===data.barGrouping.grouping?(data.qHyperCube.qSize.qcy>INITIAL_FETCH&&(this._pagingMode=PAGING.TWO_DIM,numDiscrete=data.qHyperCube.qSize.qcy),this.components.dataArea._allowInnerSelection=data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1):data.qHyperCube.qDimensionInfo.length>1&&(this.components.dataArea._allowInnerSelection=data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1,numDiscrete=this.isStacked?data.qHyperCube.qStackedDataPages&&data.qHyperCube.qStackedDataPages.length&&data.qHyperCube.qStackedDataPages[0].qData&&data.qHyperCube.qStackedDataPages[0].qData.length?data.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+data.qHyperCube.qStackedDataPages[0].qData[0].qDown:data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected:data.qHyperCube.qDataPages[0].qMatrix.length+data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,this._pagingMode=PAGING.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=PAGING.NONE),this.components.dimensionAxis.setNumDiscreteUnits(numDiscrete),this._super(data,options),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(storedData.axisInnerOffset),this.components.scrollArea.setOffset(storedData.scrollOffset)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(data){this.components.dataArea.setShowDataPoints(data.dataPoint.showLabels),this.components.dataArea.setGroupingMode(data.barGrouping.grouping),this.components.miniChart&&this.components.miniChart.components.dataArea.setGroupingMode(data.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},updateAxis:function(data,options){var measureAxis,dimensionAxis,dimensionAxisTitle,axis,key,measureName,dimensionName,axisOptions,minMeasure,maxMeasure,min,max,eMaxMin,storedData=this.getSnapshotStoredChartData(),measures=data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return{min:v.qMin,max:v.qMax,index:data.qHyperCube.qMeasureInfo.indexOf(v)}});minMeasure=measures.reduce(function(prev,current){return prev.min<current.min?prev:current},measures[0]),maxMeasure=measures.reduce(function(prev,current){return prev.max>current.max?prev:current},measures[0]),min=minMeasure?minMeasure.min:UNDEF,max=maxMeasure?maxMeasure.max:UNDEF,util.isNumeric(min)||(min=0),util.isNumeric(max)||(max=1),measureAxis=this.components.measureAxis,dimensionAxis=this.components.dimensionAxis,dimensionAxisTitle=this.components.dimensionAxisTitle;var major=this.components.dataArea.getMajorAxisData(),minor=this.components.dataArea.getMinorAxisData();dimensionAxis.setDataRange(major.data,major.info),dimensionAxis.setGroupSize(major.groupSize),measureName=data.qHyperCube.qMeasureInfo.map(function(measure){return measure.qFallbackTitle}).join(", "),dimensionName=data.qHyperCube.qDimensionInfo.map(function(dim){return dim.qFallbackTitle}).join(", "),State.view!==State.Views.story?(dimensionAxisTitle.setTitle(dimensionName),dimensionAxisTitle.showComponent()):dimensionAxisTitle.hideComponent(),$.extend(options.axes.measureAxis,{data:$.extend(!0,{},data.measureAxis,{logarithmic:!1}),title:measureName,dataIndices:data.qHyperCube.qMeasureInfo.map(function(measure,idx){return idx})}),$.extend(options.axes.dimensionAxis,{data:data.dimensionAxis,title:State.view!==State.Views.story?"":dimensionName,dataIndices:data.qHyperCube.qDimensionInfo.map(function(dim,idx){return idx}),currentDataIndices:[0]}),$.extend(options.axisTitles.dimensionAxisTitle,{data:data.dimensionAxis,title:State.view!==State.Views.story?"":dimensionName}),axisOptions=options.axes.measureAxis,eMaxMin=this.getAxisOptions(axisOptions),options.refLineLabels.labels.axis=measureAxis,updateAxisSettings.apply(this,[dimensionAxis,dimensionAxisTitle,measureAxis,this.components.scrollArea,data,this._orientation]),this._super(data,options);for(key in options.axes)axis=options.axes[key],axis.component.setDataIndices(axis.dataIndices||[axis.dataIndex||0]),axis.component.setCurrentDataIndices(axis.currentDataIndices||axis.dataIndices||[axis.dataIndex||0]);min>max?(max=10,min=-10):min===max&&0===max&&(max=10,min=-10),max=Math.max(0,max),min=Math.min(0,min),minMeasure&&maxMeasure?(this._cutMode=this.getSpikeSettings(data,minMeasure,maxMeasure,min,max,eMaxMin),max=this._cutMode.max,min=this._cutMode.min):this._cutMode={positive:!1,negative:!1},this._readStoredData&&storedData.dataRanges&&storedData.dataRanges[0]?this.setAxisDataRange(measureAxis,storedData.dataRanges[0].max,storedData.dataRanges[0].min,eMaxMin.max,eMaxMin.min,1):minor?this.setAxisDataRange(measureAxis,minor.max,minor.min,eMaxMin.max,eMaxMin.min,1):this.setAxisDataRange(measureAxis,max,min,eMaxMin.max,eMaxMin.min,1),"none"===data.measureAxis.show?dimensionAxis.setUnitAlignment("center"):["near","far"].contains(data.measureAxis.dock)?dimensionAxis.setUnitAlignment(dimensionAxis.isHorizontal()?data.measureAxis.dock:"near"===data.measureAxis.dock?"far":"near"):dimensionAxis.isHorizontal()?dimensionAxis.setUnitAlignment("left"===data.measureAxis.dock?"near":"far"):dimensionAxis.setUnitAlignment("bottom"===data.measureAxis.dock?"far":"near")},getSpikeSettings:function(data,minMeasure,maxMeasure,min,max,eMinMax){for(var row,value,largestPositiveValue=0,largestNegativeValue=0,largestPositiveOtherValue=0,largestNegativeOtherValue=0,positive=!1,negative=!1,maxMeasureIndex=maxMeasure.index+data.qHyperCube.qDimensionInfo.length,minMeasureIndex=minMeasure.index+data.qHyperCube.qDimensionInfo.length,m=data.qHyperCube.qDataPages[0]?data.qHyperCube.qDataPages[0].qMatrix:[],i=0;i<m.length;i++)row=m[i],value=row[maxMeasureIndex].qNum,value>0&&!isNaN(value)&&(row[0].qIsOtherCell||row[1].qIsOtherCell?largestPositiveOtherValue=Math.max(value,largestPositiveOtherValue):largestPositiveValue=Math.max(value,largestPositiveValue)),
value=row[minMeasureIndex].qNum,0>value&&!isNaN(value)&&(row[0].qIsOtherCell||row[1].qIsOtherCell?largestNegativeOtherValue=Math.min(value,largestNegativeOtherValue):largestNegativeValue=Math.min(value,largestNegativeValue));return this.isStacked&&data.qHyperCube.qMeasureInfo.length+data.qHyperCube.qDimensionInfo.length>2||(null!==eMinMax.max&&eMinMax.max<max?positive=eMinMax.max>0:largestPositiveValue>0&&largestPositiveOtherValue/largestPositiveValue>5&&(max=largestPositiveValue,positive=max>=0),null!==eMinMax.min&&eMinMax.min>min?negative=eMinMax.min<0:0>largestNegativeValue&&largestNegativeOtherValue/largestNegativeValue>5&&(min=largestNegativeValue,negative=0>min)),{max:max,min:min,positive:positive,negative:negative}},setOrientation:function(value){this._orientation=value||"horizontal"},getOrientation:function(){return this._orientation}}),{type:"barchart",BackendApi:StackedApi,template:template,View:BarChart,definition:barchartPropertiesDefinition,softDefinition:softOptions,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:INITIAL_FETCH,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},data:barchartData,importProperties:function(exportedFmt,initialProperties,definition){var propTree=objectConversion.axisChart.importProperties.apply(objectConversion,[exportedFmt,initialProperties,definition]),props=propTree.qProperty;return props.qHyperCubeDef.qDimensions.length>1&&"stacked"===props.barGrouping.grouping&&(props.qHyperCubeDef.qMode="K"),propTree},exportProperties:objectConversion.axisChart.exportProperties.bind(objectConversion)}}),define("extensions.qliktech/piechart/piearea-helper",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/components/axis/radial-axis-helper","general.utils/color"],function(CanvasRenderer,RadialAxisHelper,Color){function getFormattedPercentageValue(value,precision){return Math.round(100*value*Math.pow(10,precision))/Math.pow(10,precision)}function getRadianOffset(rotation){return rotation/360*Math.PI*2%(2*Math.PI)}function updateNameLabel(renderShape,text,shape,radianOffset,font,color,rect,singleMode){if(singleMode)return updateSingleNameLabel(renderShape,text,shape,font,color);var textAlign,centerAligned,x,y,labelMeasures,arcLength=shape.end-shape.start,radius=shape.radius,bigSliceLimit=.4,arcCenter=(shape.arcCenter+radianOffset)%(2*Math.PI),testArcCenter=(arcCenter+Math.PI)%(2*Math.PI);return labelMeasures=renderShape.font===font&&renderShape.text===text?renderShape.pieLabelMeasures:CanvasRenderer.measureText(text,font),0>arcLength&&(arcLength+=2*Math.PI),textAlign=getTextAlign(arcLength>bigSliceLimit&&labelMeasures.width<arcLength*radius,testArcCenter),centerAligned="center"===textAlign,x=radius*Math.cos(arcCenter)+(centerAligned?Math.cos(arcCenter)*labelMeasures.width/2:0)+(centerAligned?-labelMeasures.width/2:"right"===textAlign?-labelMeasures.width:0),y=radius*Math.sin(arcCenter)+(centerAligned?Math.sin(arcCenter)*labelMeasures.height/2:0),renderShape.baseline="middle",renderShape.align="left",renderShape.fill=color,renderShape.font=font,renderShape.text=text,renderShape.textAlign=textAlign,renderShape.x=x,renderShape.y=y,renderShape.width=labelMeasures.width,renderShape.laHeight=labelMeasures.height,renderShape.arcCenter=testArcCenter,renderShape.arcLength=arcLength,renderShape.pieLabelMeasures=labelMeasures,renderShape}function updateSingleNameLabel(renderShape,text,shape,font,color){var radius=shape.radius,fontArray=font.split("px"),fontFamily=fontArray[1],labelMeasures=CanvasRenderer.measureText(text,font),scale=Math.min(2*radius/labelMeasures.width,8),minFontSize=11,bigFontSize=Math.min(100,Math.max(radius/10*scale*.3,minFontSize)),bigFont=bigFontSize+"px"+fontFamily;return renderShape.fill=color,renderShape.text=text,renderShape.font=bigFont,renderShape.align="center",renderShape.baseline="bottom",renderShape.x=0,renderShape.y=0,renderShape.maxWidth=1.3*radius,renderShape}function getTextAlign(isCenter,arcCenter){return isCenter?"center":arcCenter<Math.PI/2||arcCenter>1.5*Math.PI?"right":"left"}function updateValueLabel(renderShape,text,color,shape,radianOffset,donut,font,lm,singleMode,singleFont){if(singleMode)return createSingleValueLabel(renderShape,text,shape,singleFont,color);var isLeft,isBottom,x,y,radius,yAdjustment,arcCenter=(shape.arcCenter+radianOffset)%(2*Math.PI),testArcCenter=(arcCenter+Math.PI)%(2*Math.PI),labelMeasures=lm?lm:CanvasRenderer.measureText(text,font);return radius=donut?shape.innerRadius:shape.radius,isLeft=testArcCenter<Math.PI/2||testArcCenter>1.5*Math.PI,isBottom=testArcCenter>Math.PI,yAdjustment=.07*(isLeft?1:-1)*(isBottom?1:-1)*Math.abs(Math.sin(testArcCenter)),x=.95*radius*Math.cos(arcCenter)+shape.cx-(isLeft?-1:1)*(Math.abs(Math.cos(testArcCenter))*labelMeasures.width/2),y=.95*radius*Math.sin(arcCenter+yAdjustment)+shape.cy-(isBottom?1:-1)*(Math.abs(Math.sin(testArcCenter))*labelMeasures.height/2),renderShape.fill=color,renderShape.x=x,renderShape.y=y,renderShape.text=text,renderShape.font=font,renderShape.align="center",renderShape.baseline="middle",renderShape.maxWidth=1.4*labelMeasures.width,renderShape}function createSingleValueLabel(renderShape,text,shape,font,color){if(!font)return renderShape;var scale,radius=shape.radius,fontArray=font.split("px"),fontSize=fontArray[0],fontFamily=fontArray[1],singleFontSize=.8*fontSize,minFontSize=10,singleFont=singleFontSize+"px"+fontFamily,labelMeasures=CanvasRenderer.measureText(text,singleFont);return labelMeasures.width>1.2*radius&&(scale=1.2*radius/labelMeasures.width,singleFontSize=Math.max(singleFontSize*scale,minFontSize),singleFont=singleFontSize+"px"+fontFamily),renderShape.fill=color,renderShape.text=text,renderShape.font=singleFont,renderShape.align="center",renderShape.baseline="top",renderShape.maxWidth=1.3*radius,renderShape.x=shape.cx,renderShape.y=shape.cy,renderShape}function getLabelColor(lightColor,darkColor,donut,areaColor,bgIsDark){return donut||Color.useDarkLabel(areaColor,bgIsDark)?darkColor:lightColor}function improveNameLabelPositions(labels,lines,rect){if(labels.length<2)return[];var shape,labelObj,i,arcCenter,windowSizeMultiplier=Math.min(rect.width,rect.height),q1Labels=[],q2Labels=[],q3Labels=[],q4Labels=[],cwLabels=[],labelObjs=[];for(i=0;i<labels.length;i++)labelObjs.push({label:labels[i],line:lines[i]});for(labelObjs.sort(function(a,b){return a.label.arcCenter>b.label.arcCenter?1:-1}),i=0;i<labels.length;i++)switch(labelObj=labelObjs[i],shape=labelObj.label,arcCenter=shape.arcCenter,shape.quartile=checkQuartile(arcCenter),shape.quartile){case 1:q1Labels.push(labelObj);break;case 2:q2Labels.push(labelObj);break;case 3:q3Labels.push(labelObj);break;case 4:q4Labels.push(labelObj)}return cwLabels=q1Labels.concat(q2Labels.reverse()).concat(q3Labels).concat(q4Labels.reverse()),cwLabels=updateInterference(cwLabels,windowSizeMultiplier,rect)}function updateInterference(array,windowSizeMultiplier,rect){var shape1,shape2,polPos,isLeft,coords,x,y,y1,i,localY,interfere,dy,movedLabelPx,oldPosition,laHeight=array[0]?array[0].label.laHeight:20,movedTreshold=10,laDist=20;for(i=0;i<array.length;i++){shape1=array[i].label,x=shape1.x,y=shape1.y,polPos=RadialAxisHelper.getPolPos({x:x,y:y}),isLeft=shape1.arcCenter<Math.PI/2||shape1.arcCenter>3*Math.PI/2,laDist=Math.max(Math.min(laDist,polPos.r/15),5),coords=RadialAxisHelper.getCartPos({r:polPos.r+laDist,a:polPos.a}),x=coords.x,y=coords.y,0!==i&&(shape2=array[i-1].label,y1=shape2.y),shape2&&checkRelevantQuartile(shape1.quartile,shape2.quartile)?(dy=checkInterference(y,y1,shape1.quartile,shape2.quartile,isLeft,laHeight),movedLabelPx=Math.abs(dy),y1=y+dy+2*(dy>0?1:-1)):(interfere=shape1.arcLength*windowSizeMultiplier/3,movedLabelPx=laHeight-interfere,y1=y+(movedLabelPx>0?movedLabelPx*(1===shape1.quartile||2===shape1.quartile?1:-1):0)),movedLabelPx>movedTreshold?(oldPosition={x:shape1.x,y:shape1.y},updateLabel(array[i],oldPosition,{x:x,y:y1})):array[i].line.strokeWidth=0,shape1.x=x,shape1.y=y1,shape1=checkEllipsis(shape1,rect),shape1.maxWidth=shape1.width,shape1.width=null,"center"===array[i].label.textAlign&&movedLabelPx>movedTreshold&&(array[i].line.x1+=Math.cos(array[i].label.arcLength)*(isLeft?1:-1)*array[i].label.maxWidth/2,array[i].line.x2+=(isLeft?1:-1)*array[i].label.maxWidth/4,array[i].line.y1+=Math.sin(array[i].label.arcLength)*(isLeft?1:-1)*array[i].label.laHeight/2,array[i].line.y2+=(isLeft?1:-1)*array[i].label.laHeight/2,array[i].line.strokeWidth=1),localY=shape1.y+rect.height/2+laHeight*(isBottomQuartile(shape1.quartile)?.5:-.5);var outOfBounds=-localY>0||localY-rect.height>0;array[i].label.visible=!outOfBounds,array[i].line.visible=!outOfBounds}return array}function updateLabel(lo,pos1,pos2){var x1,y1,x2,y2,polPos1={r:Math.sqrt(pos1.x*pos1.x+pos1.y*pos1.y),a:Math.atan2(pos1.y,pos1.x)},polPos2={r:Math.sqrt(pos2.x*pos2.x+pos2.y*pos2.y),a:Math.atan2(pos2.y,pos2.x)},align=lo.label.textAlign,pd=2,ld=3;return x1=(polPos1.r+pd)*Math.cos(polPos1.a),y1=(polPos1.r+pd)*Math.sin(polPos1.a),x2=(polPos2.r-ld)*Math.cos(polPos2.a),y2=(polPos2.r-ld)*Math.sin(polPos2.a),lo.line.x1=x1+("right"===align?lo.label.width:0),lo.line.y1=y1,lo.line.x2=x2+("right"===align?lo.label.width:0),lo.line.y2=y2,lo}function checkEllipsis(s,rect){var c={x:rect.width/2,y:rect.height/2};switch(s.textAlign){case"left":s.x+s.width>rect.width-c.x&&(s.width-=s.x+s.width-(rect.width-c.x));break;case"right":s.x<-c.x&&(s.width+=s.x+c.x,s.x=-c.x);break;case"center":s.x<-c.x?(s.width+=s.x+c.x,s.x=-c.x):s.x+s.width>rect.width-c.x&&(s.width-=s.x+s.width-(rect.width-c.x))}return s}function checkInterference(y1,y2,q1,q2,left,height){var dy;return dy=height>(y1-y2)*(1===q2||2===q1?1:-1)?y2-y1+height*(left&&3===q1||!left&&4===q1?-1:1):0}function checkRelevantQuartile(q1,q2){return q1===q2||3===q1&&2===q2}function isBottomQuartile(q){return 1===q||2===q}function checkQuartile(center){var q=1;return center>=1.5*Math.PI?q=2:center<=Math.PI/2?q=3:center>Math.PI/2&&center<Math.PI&&(q=4),q}function updateDivider(divider,color,lastColor,style,shape){var pos1,pos2;return pos1=RadialAxisHelper.getCartPos({r:shape.radius-1,a:shape.start+shape.radianOffset},{x:shape.cx,y:shape.cy}),pos2=RadialAxisHelper.getCartPos({r:shape.innerRadius+1,a:shape.start+shape.radianOffset},{x:shape.cx,y:shape.cy}),divider.x1=pos1.x,divider.y1=pos1.y,divider.x2=pos2.x,divider.y2=pos2.y,divider.strokeWidth=1,lastColor&&Color.getContrast(color,lastColor)>1.2?divider.stroke=color.toHex():divider.stroke=color.isDark()?"#ccc":"#333",divider}return{getFormattedPercentageValue:getFormattedPercentageValue,getRadianOffset:getRadianOffset,updateNameLabel:updateNameLabel,updateValueLabel:updateValueLabel,getLabelColor:getLabelColor,improveNameLabelPositions:improveNameLabelPositions,updateLabel:updateLabel,checkQuartile:checkQuartile,isBottomQuartile:isBottomQuartile,checkRelevantQuartile:checkRelevantQuartile,checkInterference:checkInterference,checkEllipsis:checkEllipsis,updateDivider:updateDivider}}),define("extensions.qliktech/piechart/piearea",["objects.views/charts/components/chart-component","objects.views/charts/shapes/arc","objects.views/charts/shapes/circle","objects.views/charts/shapes/line","objects.views/charts/shapes/text","objects.views/charts/shapes/container","objects.views/charts/utils/tree-iterator","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/piechart/piearea-helper","translator","general.utils/color","core.utils/deferred"],function(ChartComponent,Arc,Circle,Line,Text,Container,treeIterator,Renderer,ChartStyleService,PieAreaHelper,Translator,Color,Deferred){"use strict";function updateStyles(styleService,fontSize){var localStyle={backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),dataPoint:{},dataValue:{},shape:{},line:{}};return localStyle.dataPoint.label={font:styleService.getFont(chartID,"item.name",fontSize),color:{dark:styleService.getValue(chartID,"item.name","color","dark"),light:styleService.getValue(chartID,"item.name","color","light")}},localStyle.dataValue.label={font:styleService.getFont(chartID,"item.value",fontSize),color:{dark:styleService.getValue(chartID,"item.value","color","dark"),light:styleService.getValue(chartID,"item.value","color","light")}},localStyle.shape={border:{width:styleService.getValue(chartID,"item.shape.border","width")},selected:{border:{width:styleService.getValue(chartID,"item.shape.border","width","selected"),color:styleService.getValue(chartID,"item.shape.border","color","selected")}}},localStyle.line={color:styleService.getValue(chartID,"item.line","color"),width:styleService.getValue(chartID,"item.line","width")},localStyle}function updateShapeStyles(selected,localStyles,arc,label,value,line){selected?(arc.strokeWidth=localStyles.shape.selected.border.width,arc.stroke=localStyles.shape.selected.border.color,arc.opacity=selectedAlpha,arc.zIndex=1,label.opacity=1,line.opacity=1,value.opacity=1):(arc.opacity=void 0,arc.strokeWidth=void 0,arc.stroke=void 0,arc.zIndex=void 0,label.opacity=void 0,line.opacity=void 0,value.opacity=void 0)}function updateLabelStyle(radius){radius>300?this._fontSize="large":radius>200?this._fontSize="medium":radius>100?this._fontSize="small":this._fontSize="tiny"}function updatePie(arc,angle,radians){return arc.set(0,0,this._showAsDonut?this._innerRadius:0,this._radius,angle,angle+radians,this._radianOffset),arc}function renderPie(){if(!this._data||!this._tree)return Deferred.resolve();var i,k,treenode,color,lastColor,pieShape,selected,name,value,valueText,shape,lineShape,divider,node,singleMode,start,end,shapeStyle,labelStyles,labelMeasures,testArcCenter,arcCenter,tree=this._tree,numItems=this._itemData.length,num=tree.children.length,angle=0,radians=0,namesToRender=[],linesToRender=[],localStyles=this._styles,self=this,bgIsDark=new Color(localStyles.backgroundColor).isDark();this.beforeRenderPie(this._tree,LabelMode),this._radianOffset=PieAreaHelper.getRadianOffset(this._currentProperties.rotation+90);var adjustedRadianOffset=(this._radianOffset<0?this._radianOffset+2*Math.PI:this._radianOffset)%(2*Math.PI);if(labelStyles={nameLabel:{font:localStyles.dataPoint.label.font,color:"#f00"},dataLabel:{font:localStyles.dataValue.label.font,color:"#f00"}},num){for(singleMode=1===this._numSlices,k=0;numItems>k;k++){if(treenode=this._itemData[k],!treenode.pieData||treenode.pieData.value<=0)return Deferred.resolve();radians=Math.min(2*Math.PI*treenode.pieData.share,2*Math.PI),pieShape=self._arcs[treenode.pieData.shpIndex],selected=treenode.parent.cacheItem.selected,updatePie.apply(self,[pieShape,angle-Math.PI,radians]),shapeStyle={border:{color:"white",width:0}},singleMode&&!self._showAsDonut?(shape=self._singleItemCircle,shape.set(0,0,pieShape.radius)):shape=pieShape,divider=self._dividers[treenode.pieData.shpIndex],divider.visible=!1,selected||singleMode||(divider=self._dividers[treenode.pieData.shpIndex],divider.visible=!0,PieAreaHelper.updateDivider.call(this,divider,treenode.pieData.color,lastColor,shapeStyle.border,shape),self.dividerAddedToRender(divider)),self.pieAddedToRender(treenode,shape),self._showDimensionValues&&(color=singleMode?PieAreaHelper.getLabelColor(localStyles.dataPoint.label.color.light,localStyles.dataPoint.label.color.dark,self._showAsDonut,treenode.pieData.color,bgIsDark):bgIsDark?localStyles.dataPoint.label.color.light:localStyles.dataPoint.label.color.dark,name=PieAreaHelper.updateNameLabel(self._nameLabels[treenode.pieData.shpIndex],treenode.pieData.title,pieShape,adjustedRadianOffset,labelStyles.nameLabel.font,color,self.rect,singleMode),namesToRender.push(name),lineShape=self._lines[treenode.pieData.shpIndex],lineShape.stroke=localStyles.line.color,lineShape.strokeWidth=localStyles.line.width,lineShape.x1=0,lineShape.y1=0,lineShape.x2=0,lineShape.y2=0,linesToRender.push(lineShape)),angle+=radians,lastColor=treenode.pieData.color}if(this._valueLabelContainer.removeChildren(),!this._data.dataPoint.auto||this._layoutMode>3)for(i=0;i<this._sortedIndices.length;i++){if(node=this._itemData[this._sortedIndices[i].idx],!node.pieData||node.pieData.value<=0)return Deferred.resolve();if(pieShape=self._arcs[node.pieData.shpIndex],start=pieShape.start,end=pieShape.end,end+=0>start*end?2*Math.PI:0,valueText=this._dataPointsLabelMode===LabelMode.SHARE?node.pieData.formattedShare.toString()+" %":node.pieData.label,value=self._valueLabels[node.pieData.shpIndex],labelMeasures=value.font===labelStyles.dataLabel.font&&value.text===valueText?value.pieLabelMeasures:Renderer.measureText(valueText,labelStyles.dataLabel.font),value.pieLabelMeasures=labelMeasures,arcCenter=(pieShape.arcCenter+pieShape.radianOffset)%(2*Math.PI),testArcCenter=(arcCenter+Math.PI)%(2*Math.PI),!(this._dataPointsLabelMode!==LabelMode.NONE&&pieShape.radius*(end===start?2*Math.PI:end>=start?end-start:start-end)>Math.abs(Math.cos(testArcCenter))*labelMeasures.height*2+Math.abs(Math.sin(testArcCenter))*labelMeasures.width*2))break;color=PieAreaHelper.getLabelColor(localStyles.dataValue.label.color.light,localStyles.dataValue.label.color.dark,this._showAsDonut,node.pieData.color,bgIsDark),value=PieAreaHelper.updateValueLabel(value,valueText,color,pieShape,adjustedRadianOffset,this._showAsDonut,labelStyles.dataLabel.font,labelMeasures,singleMode,name?name.font:null),value.maxWidth<(this._showAsDonut?pieShape.innerRadius:pieShape.radius)*(singleMode?2:1)&&this._valueLabelContainer.addChild(value)}}PieAreaHelper.improveNameLabelPositions(namesToRender.concat(),linesToRender,self.rect),this._nameLabelContainer.removeChildren(),this._lineContainer.removeChildren();var names=[],lines=[];for(i=0;i<namesToRender.length;i++)namesToRender[i].visible!==!1&&names.push(namesToRender[i]),linesToRender[i].visible!==!1&&lines.push(linesToRender[i]);return this._nameLabelContainer.addChildren(names),this._lineContainer.addChildren(lines),this._prevRect&&this._prevRect.w===this.rect.width&&this._prevRect.w===this.rect.height||(this._prevRect={w:this.rect.width,h:this.rect.height},this._renderRoot.clearTransform(),this._renderRoot.translate(this.rect.width/2,this.rect.height/2)),this.renderers.pie.render(!0)}var PieArea,LabelMode,precision=1,chartID="pieChart",selectedAlpha=1;return LabelMode={NONE:0,SHARE:1,VALUE:2},PieArea=ChartComponent.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._arcs=[],this._nameLabels=[],this._valueLabels=[],this._lines=[],this._dividers=[],this._itemData=[],this._labelRects=[],this._cacheItems=[],this.renderers={pie:new Renderer(this.container,{name:"pie"})},this.renderers.pie.setCompositingEnabled(!1),this._renderRoot=new Container,this._rotationContainer=new Container,this._arcContainer=new Container,this._dividerContainer=new Container,this._nameLabelContainer=new Container,this._valueLabelContainer=new Container,this._lineContainer=new Container,this._rowToShapeMapping={},this._dividerContainer.strokeWidth=1,this._arcContainer.lineJoin="round",this._rotationContainer.addChildren([this._arcContainer,this._dividerContainer]),this._renderRoot.addChildren([this._rotationContainer,this._nameLabelContainer,this._valueLabelContainer,this._lineContainer]),this.renderers.pie.stage.addChild(this._renderRoot),this._singleItemCircle=new Circle(0,0,0),this._singleItemCircle.type="circle",this._fontSize="large",this._styles={},this._styleService=ChartStyleService.getInstance(),this._transitionHelper.setTransitionCurve("easeout"),this._maxSizeRatio=.8,this._showValueTextInsideSlice=!1,this._showDimensionValues=!0,this._showAsDonut=!1,this._showLabels=!0,this._recalculcating=!1,this._currentProperties.rotation=0,this._transitionProperties.rotation=0,this._hasNegativeValues=!1,this._innerRadiusRatio=.7},beforeRenderPie:function(){},pieAddedToRender:function(){},dividerAddedToRender:function(){},afterPaint:function(){return Deferred.resolve()},setShowDimensionValues:function(b){this._showDimensionValues=b,this.invalidateDisplay("setShowDimensionValues")},getShowDimensionValues:function(){return this._showDimensionValues},setRotation:function(d){this._transitionProperties.rotation=d,this._transition()},getRotation:function(){return this._transitionProperties.rotation},setScaleRatio:function(b){this._maxSizeRatio=b,this.invalidateDisplay("setScaleRatio")},getScaleRatio:function(){return this._maxSizeRatio},setShowAsDonut:function(b){this._showAsDonut=b,this.invalidateDisplay("setShowAsDonut")},getShowAsDonut:function(){return this._showAsDonut},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setDataPointsLabelMode:function(l){switch(l){case"value":this._dataPointsLabelMode=LabelMode.VALUE;break;case"share":this._dataPointsLabelMode=LabelMode.SHARE;break;default:this._dataPointsLabelMode=LabelMode.NONE}this.invalidateDisplay("setDataPointsLabelMode")},getDataPointsLabelMode:function(){return this._dataPointsLabelMode},setDimensionTree:function(t){this._tree=t,this.invalidateProperties(),this.invalidateDisplay("setDimensionTree")},updateSize:function(){this._super()},_updateProperties:function(){if(this._data&&this._tree){this._itemData=[];var cacheItem,nodeDepth,value,color,title,label,cacheItems=[],numDimz=this._data.qHyperCube.qDimensionInfo.length,tree=this._tree,treeDepth=numDimz+1,numRequiredShapes=0,numAvailableShapes=this._arcs.length,num=tree.children.length,formatter=this.measureFormatters[0],self=this,selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._numSlices=0,this._arcContainer.removeChildren(),this._dividerContainer.removeChildren(),this._rowToShapeMapping={};var arc,nameLabel,valueLabel,line,divider,arcCont=this._arcContainer,dividerCont=this._dividerContainer;num&&(treeIterator.each.call(tree,function(node,idx){if(nodeDepth=treeIterator.getLevel.call(node),node.idx=idx,nodeDepth===treeDepth){if(value=node.data.qNum,isNaN(value)||0>=value)return void((1>=numDimz||0>=idx)&&(cacheItem=node.parent.cacheItem,cacheItems.push(cacheItem)));self._numSlices++,title=node.parent.data.qText,label="U"!==formatter.type?node.children[0].data.qText:formatter.formatValue(node.data.qNum),node.pieData={value:value,title:title,color:null,label:label},node.pieData.shpIndex=numRequiredShapes++,color=null!=self._colorMap?self._colorMap.getColor(node.parent.data.qElemNo,value,0,node.parent.idx):null,node.pieData.color=color,numRequiredShapes>numAvailableShapes?(arc=new Arc(0,0,0,0,0,0,0),divider=new Line(0,0,0,0),nameLabel=new Text,valueLabel=new Text,line=new Line(0,0,0,0),self._arcs.push(arc),self._nameLabels.push(nameLabel),self._valueLabels.push(valueLabel),self._lines.push(line),self._dividers.push(divider)):(arc=self._arcs[node.pieData.shpIndex],nameLabel=self._nameLabels[node.pieData.shpIndex],valueLabel=self._valueLabels[node.pieData.shpIndex],line=self._lines[node.pieData.shpIndex],divider=self._dividers[node.pieData.shpIndex]),self._rowToShapeMapping[node.data.rowIndex]=node.pieData.shpIndex,updateShapeStyles(!1,self._styles,arc,nameLabel,valueLabel,line),arc.fill=color.toRGBA(),arcCont.addChild(arc),dividerCont.addChild(divider),cacheItem=node.parent.cacheItem,num>1||self._showAsDonut?(cacheItem.addShape(selectionID,arc),cacheItem.addShape(selectionID,nameLabel)):cacheItem.addShape(selectionID,self._singleItemCircle),cacheItems.push(cacheItem),self._itemData.push(node)}}),this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white",1!==self._itemData.length||self._showAsDonut||(this._singleItemCircle.fill=self._itemData[0].pieData.color.toRGBA(),arcCont.removeChildren(),arcCont.addChild(this._singleItemCircle),dividerCont.removeChildren())),this.setSelectableShapes(cacheItems),this._sortedIndices=this._itemData.map(function(item,i){return{value:item.pieData.value,idx:i}}),this._sortedIndices.sort(function(a,b){return a.value<b.value?1:-1});var share,formattedShare,sum=0;this._numNonZero=0,this._itemData.forEach(function(node){sum+=node.pieData.value,self._numNonZero+=node.pieData.value>0?1:0}),this._itemData.forEach(function(node){share=node.pieData.value/sum,node.pieData.share=share,formattedShare=PieAreaHelper.getFormattedPercentageValue(share,self._data.dataPoint.sharePrecision?self._data.dataPoint.sharePrecision:precision),node.pieData.formattedShare=formattedShare,node.parent.cacheItem.addMeasure(Translator.get("properties.dataPoints.labelmode.share"),formattedShare+" %",formattedShare+" %")}),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree},_onAnimatitonEnd:function(){this._super(),this.getRotation()%360===0&&(this._currentProperties.rotation=this._transitionProperties.rotation=0)},paint:function(){return this._super(this._layoutMode,this._data),this._radius=this._maxSizeRatio*Math.min(this.rect.width,this.rect.height)/2,this.renderers.pie.stage.opacity=this._globalAlpha||1,this._dividerContainer.opacity=.4*this._globalAlpha,updateLabelStyle.apply(this,[this._radius]),this._styles=updateStyles(this._styleService,this._fontSize),this._innerRadius=this._innerRadiusRatio*this._radius,renderPie.call(this).then(function(){return this.afterPaint()}.bind(this))},toggleCacheItem:function(item){var isInSelectionMode=!0,localStyles=this._styles;this.renderers.pie.stage.opacity!==this._globalAlpha&&(isInSelectionMode=!1,this.renderers.pie.stage.opacity=this._globalAlpha);var index=this._rowToShapeMapping[item.row],cShape=this._arcs[index],lblShape=this._nameLabels[index],valShape=this._valueLabels[index],lineShape=this._lines[index];cShape&&(updateShapeStyles(item.selected,localStyles,cShape,lblShape,valShape,lineShape),isInSelectionMode&&(cShape.invalidate(),lblShape.invalidate(),lineShape.invalidate(),valShape.invalidate())),1===this._itemData.length&&(item.selected?(this._singleItemCircle.opacity=selectedAlpha,this._singleItemCircle.strokeWidth=localStyles.shape.selected.border.width,this._singleItemCircle.stroke=localStyles.shape.selected.border.color):(this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white"),isInSelectionMode&&this._singleItemCircle.invalidate()),isInSelectionMode||this.renderers.pie.render(!0)}})}),define("extensions.qliktech/piechart/piechart-properties",["general.utils/property-resolver","client.utils/default-property-logic"],function(propertyResolver,propertyLogicModule){var settings,sorting,propertyLogic=propertyLogicModule.getLogicFor("hard","piechart");settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",defaultValue:!1,horizontal:!0,items:[{icon:"∏",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"π",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labels:{type:"items",snapshot:{tid:"property-labels"},items:{dimensionTitle:{ref:"dimensionTitle",type:"boolean",component:"switch",translation:"properties.dataPoints.dimensionlabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},valuesAuto:{ref:"dataPoint.auto",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},labelMode:{ref:"dataPoint.labelMode",type:"string",component:"dropdown",options:[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}],defaultValue:"share",show:function(data){return!propertyResolver.getValue(data,"dataPoint.auto")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{colorMode:{defaultValue:"byDimension"}},legend:{items:{show:{show:propertyLogic.legend.show,snapshot:{tid:"property-legend"}},showTitle:{show:propertyLogic.legend.showTitle.show},dock:{show:propertyLogic.legend.dock.show}}}}}}};var data={uses:"data",items:{dimensions:{uses:"dimensions"},measures:{uses:"measures",items:{numberFormatting:{items:{percentOfPieMessage:{component:"text",translation:"properties.numberFormatting.pieMessage",show:function(data,handler){return handler&&(propertyResolver.getValue(handler,"properties.dataPoint.auto")||"share"===propertyResolver.getValue(handler,"properties.dataPoint.labelMode"))}}}}}}}};sorting={uses:"sorting"};var addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("extensions.qliktech/piechart/piechart-data",["general.utils/property-resolver"],function(propertyResolver){function setInitialSort(handler){1===handler.getDimensions().length&&1===handler.getMeasures().length&&(handler.getMeasures()[0].qSortBy.qSortByNumeric=-1,1!==handler.getSorting()[0]&&handler.changeSorting(1,0))}function setColorVars(data,handler){var measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");"byExpression"===mode&&0===measures.length&&propertyResolver.setValue(data,"color.mode","primary")}function setDimensionLimit(dimension,handler){dimension.qOtherTotalSpec.qOtherMode="OTHER_COUNTED",dimension.qOtherTotalSpec.qOtherCounted={qv:"10"},setInitialSort(handler)}return{dimensions:{add:function(dimension,data,handler){setDimensionLimit(dimension,handler)},replace:function(dimension,oldDimension,index,data,handler){setDimensionLimit(dimension,handler)},min:1,max:1},measures:{min:1,max:1,add:function(measure,data,handler){setInitialSort(handler)},remove:function(measure,data,handler){setColorVars(data,handler)}}}}),define("extensions.qliktech/piechart/piechart-explore-properties",[],function(){return{type:"items",component:"accordion",items:{sort:{uses:"sort"},color:{uses:"color"},presentation:{uses:"presentation",items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",horizontal:!0,items:[{icon:"∏",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"π",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labelMode:{type:"items",items:{labelMode:{type:"string",component:"radio-list",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.auto:false","dataPoint.labelMode"],options:function(){return[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}]},setPropertyValue:function(props,v){props.dataPoint.auto=!1,props.dataPoint.labelMode=v},getValue:function(props){return props.dataPoint.auto?"":props.dataPoint.labelMode}}}}}}}}}),define("text!extensions.qliktech/piechart/piechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("objects.views/charts/disclaimers/chart-utils",["util"],function(util){function hasDataRangeIncludingZero(measureAxis,measureInfo){var i,explicitMinOn,explicitMaxOn,min,max,len=measureInfo.length;
for(measureAxis&&(explicitMinOn=!(measureAxis.autoMinMax||"min"!==measureAxis.minMax&&"minMax"!==measureAxis.minMax||null===measureAxis.min||isNaN(measureAxis.min)),explicitMaxOn=!(measureAxis.autoMinMax||"max"!==measureAxis.minMax&&"minMax"!==measureAxis.minMax||null===measureAxis.max||isNaN(measureAxis.max))),min=Number.MAX_VALUE,max=-Number.MAX_VALUE,i=0;len>i;i++)if(min=Math.min(min,measureInfo[i].qMin),max=Math.max(max,measureInfo[i].qMax),0>=min&&max>=0)return!0;return min=explicitMinOn?measureAxis.min:min,max=explicitMaxOn?measureAxis.max:max,0>=min&&max>=0}var chartUtils={applyDisclaimerAttributes:function(options,dataAttributes,$element,$scope,State,data){return dataAttributes||(dataAttributes={}),util.extend(dataAttributes,{limitedData:!1,hasNegativeOrZeroData:!1,onlyNegativeOrZero:!1,onlyNanData:!1,hasDataRangeIncludingZero:!1}),dataAttributes.noDataExist=data.qHyperCube.qSize.qcy*data.qHyperCube.qSize.qcx===0,dataAttributes.noDataExist?($element.toggleClass("qv-viz-with-disclaimer",!1),dataAttributes):(options=options||{},options.overlay=options.overlay||!1,options.supportNegative=void 0===options.supportNegative?!0:options.supportNegative,options.supportRangeOverZero=void 0===options.supportRangeOverZero?!0:options.supportRangeOverZero,data.qHyperCube.qDataPages[0]?dataAttributes.limitedData=!options.paging&&data.qHyperCube.qSize.qcy>data.qHyperCube.qDataPages[0].qMatrix.length:dataAttributes.limitedData=options.explicitLimitedData===!0,dataAttributes.hasNegativeOrZeroData=!options.supportNegative&&data.qHyperCube.qMeasureInfo.some(function(measure){return measure.qMin<=0}),dataAttributes.onlyNegativeOrZero=!options.supportNegative&&data.qHyperCube.qMeasureInfo.every(function(measure){return measure.qMax<=0&&measure.qMax>=measure.qMin})||0===data.qHyperCube.qSize.qcy,dataAttributes.onlyNanData=data.qHyperCube.qMeasureInfo.every(function(measure){return measure.qMax<measure.qMin||"NaN"===measure.qMax}),dataAttributes.hasDataRangeIncludingZero=!options.supportRangeOverZero&&hasDataRangeIncludingZero(data.measureAxis,data.qHyperCube.qMeasureInfo,data.lineType),dataAttributes.onlyNegativeOrZero&&options.overlay||!(dataAttributes.limitedData||dataAttributes.hasNegativeOrZeroData&&!options.supportNegative||dataAttributes.hasDataRangeIncludingZero)?($element.toggleClass("qv-viz-with-disclaimer",!1),$scope.options.showDisclaimerStar=!1):($element.toggleClass("qv-viz-with-disclaimer",options.bottom),$scope.options.showDisclaimerStar=!0),dataAttributes)}};return chartUtils}),define("text!objects.views/charts/disclaimers/chart-disclaimer.ng.html",[],function(){return'<div class="qv-viz-disclaimer" ng-if="visible && (options.limitedData || options.hasNegativeOrZeroData || options.hasDataRangeIncludingZero) && !options.doesNotFit" ng-style="getDisclaimerStyle(options.chartScale)">\r\n	<span>*</span>\r\n	<span ng-if="options.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData"></span>\r\n	<span ng-if="options.hasNegativeOrZeroData" q-translation="Object.Disclaimer.NegativeOrZeroValues" q-title-translation="Object.Disclaimer.NegativeOrZeroValues"></span>\r\n	<span ng-if="options.hasDataRangeIncludingZero" q-translation="Object.Disclaimer.DataRangeIncludingZero" q-title-translation="Object.Disclaimer.DataRangeIncludingZero"></span>\r\n</div>\r\n'}),define("objects.views/charts/disclaimers/chart-disclaimer-directive",["qvangular","text!./chart-disclaimer.ng.html"],function(qvangular,template){qvangular.directive("qvaChartDisclaimer",function(){return{template:template,replace:!0,scope:{options:"=",visible:"="},link:function($scope){$scope.getDisclaimerStyle=function(v){return v=Math.min(1,v||1),{"font-size":1*v+"em"}}}}})}),define("extensions.qliktech/piechart/piechart",["jquery","core.utils/deferred","client.utils/state","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/axis-title","./piearea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/piechart/piechart-properties","extensions.qliktech/piechart/piechart-data","extensions.qliktech/piechart/piechart-explore-properties","text!./piechart.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function($,Deferred,State,Chart,ChartComponent,AxisTitle,PieArea,ColorMap,HypercubeApi,piechartPropertiesDefinition,piechartData,exploreOptions,template,EventUtils,ChartUtils,objectConversion){"use strict";function resetRotation(dataArea){var currentRotation=dataArea.getRotation(),distanceToZero=currentRotation%360,newRotation=distanceToZero>180?currentRotation+360-distanceToZero:currentRotation-distanceToZero;dataArea.setRotation(newRotation)}function updateLegendSettings(colorLegend,data){data.legend.show!==!1?colorLegend.showComponent():colorLegend.hideComponent()}function updateLegendDock(colorLegend,data){data&&"auto"!==data.legend.dock?colorLegend.setDock(data.legend.dock):colorLegend.outerRect.height/colorLegend.outerRect.width>1?colorLegend.setDock("right"):colorLegend.setDock("bottom")}function rotatePlot(rotation){if(void 0!==rotation){this.components.dataArea.setRotation(rotation);var tooltipType=this.selections.types.tooltip;tooltipType&&tooltipType.clearSelection()}}var PieChart,namespace=".piechart";return PieChart=Chart.extend("PieChart",{init:function($scope,$element,options,backendApi){var self=this,dummy=$.extend(!0,{},options);options=$.extend(!0,options||{},{debug:!0,providers:{colorMap:{clazz:ColorMap,colorBy:"dimension"}},components:{xAxisTitle:{show:!0,order:1,dock:"top",relevantSize:30,showFlag:ChartComponent.prototype.ShowFlags.SMALL,clazz:AxisTitle},dataArea:{sortKey:1e3,show:!0,dock:"center",clazz:PieArea,showFlag:ChartComponent.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:ChartComponent.prototype.ShowFlags.MEDIUM}}},dummy),this._super($scope,$element,options,backendApi),this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(ev,col,index){self.backendApi.drillUp(col,index)}),delete this.components.xAxisTitle,this._showLegend=!1,this._lastRotation=0},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},on:function(){this._super();var self=this;$(this.components.dataArea.container).on("mousewheel"+namespace+" DOMMouseScroll"+namespace,function(e){var event=EventUtils.getMouseWheelData(e.originalEvent);rotatePlot.apply(self,[self.components.dataArea.getRotation()+5*event.delta]),e.preventDefault()}),$(this.components.dataArea.container).on("mouseup"+namespace,function(e){2===e.which&&(e.preventDefault(),resetRotation(self.components.dataArea))}),Touche(this.container).rotate({id:namespace,start:function(){self._lastRotation=0,self.components.dataArea.setUseTransition(!1),Touche.preventGestures(this.gestureHandler)},update:function(e,data){rotatePlot.apply(self,[self.components.dataArea.getRotation()+data.rotation-self._lastRotation]),self._lastRotation=data.rotation,Touche.preventGestures(this.gestureHandler)},end:function(){self.components.dataArea.setUseTransition(!0),Touche.preventGestures(this.gestureHandler)}}),Touche(this.components.dataArea.container).tap({id:namespace,options:{touches:3},end:function(){resetRotation(self.components.dataArea),Touche.preventGestures(this.gestureHandler)}}),this._on=!0},off:function(){Touche(this.components.dataArea.container).off("*",namespace),Touche(this.container).off("*",namespace),$(this.components.dataArea.container).off(namespace),this._super(),this._on=!1},_postResize:function(){updateLegendDock.apply(this,[this.components.colorLegend,this._data])},getSnapshotChartData:function(){return $.extend(!0,this._super()||{},{rotation:this.components.dataArea._currentProperties.rotation})},getViewState:function(){return{rotation:this.components.dataArea._currentProperties.rotation}},_paint:function(){var key,dfds=[];if(!this.isValid(this._data))return this.clear();this._super(),this.layout(),this.components.dataArea.setShowDimensionValues(this._layoutMode>ChartComponent.prototype.ShowFlags.SPARK);for(key in this.components)dfds.push(this.components[key].invalidateDisplay("PieChart._paint"));return Deferred.all(dfds)},isValid:function(data){return this._super(data)&&!this.supressChartRendering},prePaint:function(data){this._super(),ChartUtils.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,State,data),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(data){this._data=data;var storedData=this.getSnapshotStoredChartData();this._super(data),this.isDataSelectable(data)&&(this.selections.on(),this._on||State.isInEditMode()||this.on()),this.providers.colorMap.setData(data),this.components.dataArea.setData(data),this.components.colorLegend.setData(data),this.components.dimensionAxisTitle.setData(data),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),data.dataPoint&&this.components.dataArea.setDataPointsLabelMode(data.dataPoint.auto?"share":data.dataPoint.labelMode),data.donut&&this.components.dataArea.setShowAsDonut(data.donut.showAsDonut),data.scale&&this.components.dataArea.setScaleRatio(data.scale),this._readStoredData&&storedData?this.components.dataArea.setRotation(storedData.rotation):this.options.viewState?this.components.dataArea.setRotation(this.options.viewState.rotation):data.rotation?this.components.dataArea.setRotation(data.rotation):resetRotation(this.components.dataArea),data.dimensionTitle!==!1?this.components.dimensionAxisTitle.showComponent():this.components.dimensionAxisTitle.hideComponent(),updateLegendSettings.apply(this,[this.components.colorLegend,data]),updateLegendDock.apply(this,[this.components.colorLegend,this._data])},setShowLegend:function(value){this._showLegend=value,value?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()},getShowLegend:function(){return this._showLegend},toggleCacheItem:function(item){this.components.dataArea.toggleCacheItem(item),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},destroy:function(){this._super(),this.components.dimensionAxisTitle&&this.components.dimensionAxisTitle.stopListen("drill-up")}}),{type:"piechart",BackendApi:HypercubeApi,template:template,View:PieChart,definition:piechartPropertiesDefinition,softDefinition:exploreOptions,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:500}],qSuppressZero:!1,qSuppressMissing:!0}},data:piechartData,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}},importProperties:objectConversion.colorChart.importProperties.bind(objectConversion),exportProperties:objectConversion.colorChart.exportProperties.bind(objectConversion)}}),define("extensions.qliktech/scatterplot/scatter-helper",["objects.utils/shapes/circle","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(Circle,Rect,Polygon){function createShape(type,args){var returnShape;switch(type){case"circle":returnShape=new Circle(args[0],args[1],args[2],args[3]);break;case"rect":returnShape=new Rect(args[0],args[1],args[2],args[3]);break;case"polygon":returnShape=new Polygon}return returnShape}function checkClearNodes(clearNodes,nodes){return clearNodes?[]:nodes}function checkNodeValid(node){return node.dotData&&"NaN"!==node.dotData.xValue&&"NaN"!==node.dotData.yValue?!0:!1}function checkSelected(node){return node&&node.cacheItem&&node.cacheItem.selected?!0:!1}function checkShouldRender(node,selectedOnly){return!selectedOnly||!!node.selected||!!node.highlighted}function getRadius(rValue,useSize,props,windowSizeMultiplier){var r;return r=useSize?getDotRadius(rValue,props.sizeDataMin,props.sizeDataMax,props._minDotSize,props._maxDotSize):props._minDotSize,r*windowSizeMultiplier}function getDotRadius(value,minValue,maxValue,minRadius,maxRadius){var scaledValue,radius;return isNaN(value)||null===value?NaN:minValue===maxValue?(minRadius+maxRadius)/2:minValue>=value?minRadius:value>=maxValue?maxRadius:(scaledValue=(value-minValue)/(maxValue-minValue),radius=minRadius+(maxRadius-minRadius)*Math.sqrt(scaledValue))}function outOfBounds(x,y,r,w,h){var rIsNan=isNaN(r)||void 0===r,rOrZero=rIsNan?0:r;return-rOrZero>x||x>w+rOrZero||-rOrZero>y||y>h+rOrZero}function outOfBoundsPosition(pos,dim,oobSize){return 0>pos?-10+oobSize:pos>dim?dim-oobSize+10:pos}function isSame(a,b,propertyArray){var i;for(i=0;i<propertyArray.length;i++)if(a[propertyArray[i]]!==b[propertyArray[i]])return!1;return!0}function updateCross(points,x,y,crossSize,crossWidth){return 13!==points.length?null:(points[0].x=x-crossSize+crossWidth/2,points[0].y=y-crossSize-crossWidth/2,points[1].x=x-crossSize-crossWidth/2,points[1].y=y-crossSize+crossWidth/2,points[2].x=x-crossWidth,points[2].y=y,points[3].x=x-crossSize-crossWidth/2,points[3].y=y+crossSize-crossWidth/2,points[4].x=x-crossSize+crossWidth/2,points[4].y=y+crossSize+crossWidth/2,points[5].x=x,points[5].y=y+crossWidth,points[6].x=x+crossSize-crossWidth/2,points[6].y=y+crossSize+crossWidth/2,points[7].x=x+crossSize+crossWidth/2,points[7].y=y+crossSize-crossWidth/2,points[8].x=x+crossWidth,points[8].y=y,points[9].x=x+crossSize+crossWidth/2,points[9].y=y-crossSize+crossWidth/2,points[10].x=x+crossSize-crossWidth/2,points[10].y=y-crossSize-crossWidth/2,points[11].x=x,points[11].y=y-crossWidth,points[12].x=x-crossSize+crossWidth/2,points[12].y=y-crossSize-crossWidth/2,points)}function checkOverlapping(shapes,shp){var shape,i,skipDot=!1;for(i=0;i<shapes.length;i++)if(shape=shapes[i],"circle"===shape.type){if(isSame(shape,shp,["cx","cy","r"])){skipDot=!0;break}}else if(isSame(shape,shp,["cx","cy"])){skipDot=!0;break}return skipDot}function sortObjectsForLabels(a1,b1){var a,b;return a=a1.cacheItem.getShapes("dataArea")[0],b=b1.cacheItem.getShapes("dataArea")[0],a.cy-a.r>b.cy-b.r?1:a.cy-a.r<b.cy-b.r?-1:a.cx-a.r>b.cx-b.r?1:a.cx-a.r<b.cx-b.r?-1:a.r>b.r?-1:a.r<b.r?1:a1.cacheItem.id<b1.cacheItem.id?-1:1}function getComparableObject(array,i){return 0===i?array[1]?array[1]:null:array[i-1]}function checkLabelInterference(label,label2,dot,dot2){var deltaY,deltaX,returnObj={x:!1,y:!1};return isNaN(dot2.cx)||isNaN(dot2.cy)?(returnObj.y=!0,returnObj):(deltaY=-(label2.y-label.y),0>deltaY?returnObj:(deltaY<2*label.height+dot2.r+dot.r&&(returnObj.y=!0,deltaX=Math.abs(label2.x-label.x),deltaX<label.width/2+label2.width/2&&(returnObj.x=!0)),returnObj))}function checkEllipsis(label,width){var diff=label.x-label.width/2;return label.maxWidth=label.width,0>diff&&(label.maxWidth+=2*diff,label.x=label.maxWidth/2),diff=label.x+label.width/2-width,diff>0&&(label.maxWidth-=2*diff),label.maxWidth=Math.max(label.maxWidth,0),label}function centerLabel(labelRect,label){return labelRect.x=label.x-label.width/2,labelRect.y=label.y-label.height,labelRect.width=label.maxWidth,labelRect.height=label.height,labelRect}return{createShape:createShape,checkClearNodes:checkClearNodes,checkNodeValid:checkNodeValid,checkSelected:checkSelected,checkShouldRender:checkShouldRender,getRadius:getRadius,getDotRadius:getDotRadius,outOfBounds:outOfBounds,outOfBoundsPosition:outOfBoundsPosition,isSame:isSame,updateCross:updateCross,checkOverlapping:checkOverlapping,sortObjectsForLabels:sortObjectsForLabels,getComparableObject:getComparableObject,checkLabelInterference:checkLabelInterference,checkEllipsis:checkEllipsis,centerLabel:centerLabel}}),define("extensions.qliktech/scatterplot/scatter-circle",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/polygon","objects.views/charts/shapes/circle"],function(CanvasRenderer,CanvasCircle,CanvasPolygon,Circle){function renderScatterCircle(g,doFill,doStroke){"saltire"===this.type?CanvasPolygon.render.apply(this,[g,doFill,doStroke]):CanvasCircle.render.apply(this,[g,doFill,doStroke])}function createPoints(nr){var i,points=[];for(i=0;nr>i;i++)points.push(getOrigoPoint());return points}function getOrigoPoint(){return{x:0,y:0}}function updateSaltire(points,x,y,saltireSize,saltireWidth){return 13!==points.length?null:(points[0].x=x-saltireSize+saltireWidth/2,points[0].y=y-saltireSize-saltireWidth/2,points[1].x=x-saltireSize-saltireWidth/2,points[1].y=y-saltireSize+saltireWidth/2,points[2].x=x-saltireWidth,points[2].y=y,points[3].x=x-saltireSize-saltireWidth/2,points[3].y=y+saltireSize-saltireWidth/2,points[4].x=x-saltireSize+saltireWidth/2,points[4].y=y+saltireSize+saltireWidth/2,points[5].x=x,points[5].y=y+saltireWidth,points[6].x=x+saltireSize-saltireWidth/2,points[6].y=y+saltireSize+saltireWidth/2,points[7].x=x+saltireSize+saltireWidth/2,points[7].y=y+saltireSize-saltireWidth/2,points[8].x=x+saltireWidth,points[8].y=y,points[9].x=x+saltireSize+saltireWidth/2,points[9].y=y-saltireSize+saltireWidth/2,points[10].x=x+saltireSize-saltireWidth/2,points[10].y=y-saltireSize-saltireWidth/2,points[11].x=x,points[11].y=y-saltireWidth,points[12].x=x-saltireSize+saltireWidth/2,points[12].y=y-saltireSize-saltireWidth/2,points)}var ScatterCircle=Circle.extend("ScatterCircle",{init:function(x,y,r,saltireSize,saltireWidth){this._super(x,y,r),this.type="circle",this.saltireSize=saltireSize,this.saltireWidth=saltireWidth},set:function(x,y,r,saltireSize,saltireWidth){this.saltireSize=this.saltireSize||saltireSize,this.saltireWidth=this.saltireWidth||saltireWidth,this._saltire=updateSaltire(this._saltire||createPoints(13),x,y,this.saltireSize,this.saltireWidth),this._polygons=[{points:this._saltire}],this._super(x,y,r)}});return CanvasRenderer._registerRenderFn(renderScatterCircle,ScatterCircle),ScatterCircle}),define("extensions.qliktech/scatterplot/heat-map-light",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/text","general.utils/color","objects.utils/number-formatter","objects.views/charts/renderers/canvas-renderer"],function(Class,Rect,Text,Color,NumberFormatter,CanvasRenderer){function drawRect(bin){var rect=new Rect(this._xAxis.getPositionOfValue(bin.qText[0])-1,this._yAxis.getPositionOfValue(bin.qText[1])-1,this._xAxis.getPositionOfValue(bin.qText[2])-this._xAxis.getPositionOfValue(bin.qText[0])+1,this._yAxis.getPositionOfValue(bin.qText[3])-this._yAxis.getPositionOfValue(bin.qText[1])+1),color=new Color(this._colorMapLight.getColor(bin.qNum/this._maxNrInBin));rect.fill=color.toRGBA(),this._renderer.stage.addChild(rect),rect.width>40&&rect.height>15&&addLabel.call(this,rect,bin.qNum,color.isDark())}function addLabel(rect,value,isDark){var label=new Text;label.x=rect.x+rect.width/2,label.y=rect.y+rect.height/2+4,label.text=this._numberFormatter.format(value,this._defaultPattern),label.align="center",label.fill=isDark?"#fff":"#444",label.font="11px 'QlikView Sans'",this._renderer.stage.addChild(label)}var HeatMapLight=Class.extend("HeatMapLight",{init:function(renderer,selectedRenderer){this._renderer=renderer,this._selectedRenderer=selectedRenderer,this._numberFormatter=new NumberFormatter,this._defaultPattern="#.#A"},setData:function(dataPage){this._data=dataPage[0].concat(),this._metaData=this._data.splice(0,1)[0],this._maxNrInBin=this._metaData.qNum},setColorMapLight:function(c){this._colorMapLight=c},getColorMapLight:function(){return this._colorMapLight},hasValidData:function(){return this._data&&this._metaData},setXAxis:function(ax){this._xAxis=ax},setYAxis:function(ax){this._yAxis=ax},draw:function(){if(this._data&&this._data.length&&!(this._data.length<1)){this._pixelRatio=CanvasRenderer.getDevicePixelToBackingStoreRatio(),this._renderer.stage.removeChildren(),this._renderer.clear(),this._selectedRenderer&&(this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear());var i;for(i=0;i<this._data.length;i++)drawRect.call(this,this._data[i]);return this._renderer.render()}},copyHeatMap:function(){return this._renderer._canvas.width&&this._renderer._canvas.height&&(this._imageData=this._renderer._canvas.getContext("2d").getImageData(0,0,this._renderer._canvas.width,this._renderer._canvas.height),this._selectedRenderer&&this._selectedRenderer._updateSize()),this._imageData},getHeatMapCanvas:function(){return this._renderer._canvas},clipSelected:function(rect){this._renderer._canvas.width&&this._renderer._canvas.height&&(this._selectedRenderer.clear(),this._selectedRenderer._canvas.getContext("2d").putImageData(this._imageData,0,0,rect.x*this._pixelRatio,rect.y*this._pixelRatio,rect.width*this._pixelRatio,rect.height*this._pixelRatio))},clearSelection:function(){this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear()}});return HeatMapLight}),define("extensions.qliktech/scatterplot/scatterarea",["objects.views/charts/components/chart-component","extensions.qliktech/scatterplot/scatter-helper","objects.views/charts/renderers/canvas-renderer","./scatter-circle","objects.views/charts/shapes/text","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/utils/tree-iterator","objects.views/charts/chart-style-service","general.utils/color","core.utils/deferred","extensions.qliktech/scatterplot/heat-map-light"],function(ChartComponent,ScatterHelper,Renderer,ScatterCircle,Text,Rect,Line,treeIterator,ChartStyleService,Color,Deferred,HeatMapLight){"use strict";function updateDot(circle,cx,cy,r){return circle.set(cx,cy,r),circle}function updateRendererVisibility(rendererInfos){var i,rILength=rendererInfos.length;for(i=0;rILength>i;i++)rendererInfos[i].renderer.setAttribute("style",{opacity:rendererInfos[i].visible?1:0});setTimeout(function(){for(i=0;rILength>i;i++)rendererInfos[i].renderer.setAttribute("style",{visibility:rendererInfos[i].visible?"":"hidden"})},500)}function updateStyles(styleService){var chartID="scatterPlot",localStyles={backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),dataPoint:{label:{color:styleService.getValue(chartID,"value","color"),font:styleService.getFont(chartID,"value"),background:styleService.getValue(chartID,"value","background")}},shape:{border:{width:styleService.getValue(chartID,"shape.border","width")},selected:{border:{color:styleService.getValue(chartID,"shape.border","color"),width:styleService.getValue(chartID,"shape.border","width","selected")}},outOfBounds:{opacity:styleService.getValue(chartID,"shape.outOfBounds","opacity")}},line:{color:styleService.getValue(chartID,"line","color"),width:styleService.getValue(chartID,"line","width")}};return localStyles}function renderDots(selectedOnly){var x,y,r,selected,highlighted,cacheItem,outOfBounds,rIsNan,isCross,strokeWidth,opacity,currentValues,canvasShape,shade,skipDot,tree=this._tree,num=this._tree.children.length,tempDot=ScatterHelper.createShape("circle",[0,0,0,0]),w=this.rect.width,h=this.rect.height,dots=this._dots,self=this,shapesToRender=[],oobToRender=[],crossSize=3,crossWidth=1,oobSize=3,canvasShapes=this._canvasShapes,useSize=this._data.qHyperCube.qMeasureInfo.length>2&&!this._data.qHyperCube.qDataPages[0].qIsReduced,wsm=Math.min(this.rect.height,this.rect.width)/300,selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea",localStyles=this._styles;if(!num)return void this.clear();if(this._renderedNodes=ScatterHelper.checkClearNodes(!selectedOnly,this._renderedNodes),tree.children.forEach(function(node){if(ScatterHelper.checkNodeValid(node)&&(outOfBounds=!1,selected=ScatterHelper.checkSelected(node),node.selected=selected,node.highlighted=node.cacheItem.highlighted,strokeWidth=selected?localStyles.shape.selected.border.width:localStyles.shape.border.width,opacity=selected?.9:void 0,"dimension"===node.data.type)){if(!ScatterHelper.checkShouldRender(node,selectedOnly)||!self._currentProperties.values)return;if(currentValues=self._currentProperties.values[node.data.qElemNo],!currentValues)return;if(x=self._xAxis.getPositionOfValue(currentValues.xValue),y=self._yAxis.getPositionOfValue(currentValues.yValue),r=ScatterHelper.getRadius(currentValues.rValue,useSize,self._currentProperties,wsm),isNaN(x)||isNaN(y))return;r=.5>r?.5:r,oobSize=oobSize>r?r:oobSize,rIsNan=isNaN(r)||void 0===r,node.dotData.outOfBounds=outOfBounds=ScatterHelper.outOfBounds(x,y,r,w,h),outOfBounds&&(r=oobSize,x=ScatterHelper.outOfBoundsPosition(x,w,r),y=ScatterHelper.outOfBoundsPosition(y,h,r)),isCross=rIsNan&&!outOfBounds,tempDot=updateDot(dots[node.dotData.dotIndex],x,y,isCross?2*crossSize:r),cacheItem=node.cacheItem,cacheItem.clearShapes(selectionID),cacheItem.addShape(selectionID,tempDot,!0),highlighted=cacheItem.highlighted,node.dotData.color=self._colorMap.getColor(node.data.qElemNo,node._children[0].data.qNum,0,node.data.rowIndex),shade=node.dotData.color.isDark()?"light":"dark",skipDot=!1,node.selected||(skipDot=ScatterHelper.checkOverlapping(outOfBounds?oobToRender:shapesToRender,tempDot,x,y,crossWidth)),skipDot||(canvasShape=canvasShapes[node.idx],canvasShape?canvasShape.fill=node.dotData.color.toRGBA():(canvasShape=new ScatterCircle(0,0,0,crossSize,crossWidth),canvasShape.fill=node.dotData.color.toRGBA(),canvasShape.strokeWidth=strokeWidth,canvasShape.opacity=opacity,canvasShape.stroke=highlighted?localStyles.shape.highlighted.border[shade].color:selected?localStyles.shape.selected.border.color:self._sheetBackgroundColor.toRGBA(),canvasShape.data.label=node.data.qText?node.data.qText.substr(0,128):"",canvasShapes[node.idx]=canvasShape),outOfBounds?self._isBigData||(canvasShape.set(tempDot.cx,tempDot.cy,tempDot.r),canvasShape.type="circle",oobToRender.push(canvasShape)):(canvasShape.set(tempDot.cx,tempDot.cy,tempDot.r),rIsNan?canvasShape.type="saltire":canvasShape.type="circle",selectedOnly||(shapesToRender.push(canvasShape),self._renderedNodes.push(node))))}}),!selectedOnly){var dfds=[];return this.renderers.dots.stage.removeChildren(),this.renderers.dots.stage.addChildren(shapesToRender),dfds.push(this.renderers.dots.render()),this._isBigData?updateRendererVisibility.call(this,[{renderer:this.renderers.oob,visible:!1}]):(updateRendererVisibility.call(this,[{renderer:this.renderers.oob,visible:!0}]),this.renderers.oob.stage.removeChildren(),this.renderers.oob.stage.addChildren(oobToRender),dfds.push(this.renderers.oob.render())),Deferred.all(dfds)}}function renderLabels(){var dot,label,label2,cacheItem,labelRect,dotObjects,prevNode,dot2,interference,prevIndex,renderText,renderRect,renderLine,num=this._renderedNodes.length,self=this,objectsToRender=[],labelShapes=this._labelShapes,renderer=this.renderers.labels,localStyles=this._styles,selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return num&&(dotObjects=this._renderedNodes.sort(ScatterHelper.sortObjectsForLabels),dotObjects.forEach(function(node,i){if(labelShapes[node.data.rowIndex]&&(labelShapes[node.data.rowIndex].visible=!1),cacheItem=node.cacheItem,label=node.dotData.label,dot=cacheItem.getShapes(selectionID)[0],labelRect=cacheItem.toggleShapes[0],prevIndex=i-1,prevNode=ScatterHelper.getComparableObject(dotObjects,i),label.x=dot.cx,label.y=dot.cy-dot.r-5,!label||node.dotData.outOfBounds)return void labelRect.set(0,0,0,0);if(self._labelMode===LabelMode.AUTO&&prevNode){if(dot2=prevNode.cacheItem.getShapes(selectionID)[0],label2=prevNode.dotData.label,interference=ScatterHelper.checkLabelInterference(label,label2,dot,dot2),interference.x&&interference.y)return void(labelRect.width=0);for(;interference.y&&prevIndex>0;)if(prevIndex--,prevNode=0!==i?dotObjects[prevIndex]:null,dot2=prevNode.cacheItem.getShapes(selectionID)[0],label2=prevNode.dotData.label,interference=ScatterHelper.checkLabelInterference(label,label2,dot,dot2),interference.x&&interference.y)return void(labelRect.width=0)}return label.y-label.height<0||label.y>self.rect.height?void labelRect.set(0,0,0,0):(label=ScatterHelper.checkEllipsis(label,self.rect.width),labelRect=ScatterHelper.centerLabel(labelRect,label),void(labelRect.width&&(labelShapes[node.data.rowIndex]?(renderRect=labelShapes[node.data.rowIndex].rect,renderText=labelShapes[node.data.rowIndex].text,renderLine=labelShapes[node.data.rowIndex].line,labelShapes[node.data.rowIndex].visible=!0):(renderRect=new Rect,renderText=new Text,renderLine=new Line,labelShapes[node.data.rowIndex]={visible:!0,rect:renderRect,text:renderText,line:renderLine},renderRect.fill=localStyles.dataPoint.label.background,renderText.fill=localStyles.dataPoint.label.color,renderText.align="center",renderText.font=localStyles.dataPoint.label.font,renderText.baseline="bottom",renderLine.stroke=localStyles.line.color),renderText.setText(label.text),renderText.x=label.x,renderText.y=label.y,renderText.maxWidth=label.maxWidth,renderRect.x=renderText.x-renderText.maxWidth/2-2,renderRect.y=labelRect.y,renderRect.width=labelRect.width+4,renderRect.height=labelRect.height,renderLine.set(label.x,label.y-2,label.x,label.y+3),objectsToRender.push(renderRect),objectsToRender.push(renderText),objectsToRender.push(renderLine))))})),renderer.stage.removeChildren(),renderer.stage.addChildren(objectsToRender),renderer.render()}var ScatterArea,LabelMode;return LabelMode={NONE:0,AUTO:1,ALL:2},ScatterArea=ChartComponent.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._dots=[],this._labelRects=[],this._cacheItems=[],this._renderedNodes=[],this._showDataPoints=!0,this._colorMap=null,this._navigationVisible=!1,this._globalAlpha=1,this._canvasShapes={},this._labelMode=LabelMode.AUTO,this._savedCacheItems={},this._transitionProperties._minDotSize=2,this._transitionProperties._maxDotSize=10,this._style={dataPoints:{color:"#666",font:"12px 'QlikView Sans'"}},this._styles={},this._styleService=ChartStyleService.getInstance(),this._styles=updateStyles(this._styleService),this._sheetBackgroundColor=new Color(this._styles.backgroundColor),this._sheetBackgroundColor.setAlpha(.3),this.renderers={heat:new Renderer(this.container,{name:"heat"}),selectedHeat:new Renderer(this.container,{name:"selectedHeat"}),dots:new Renderer(this.container,{name:"dots"}),labels:new Renderer(this.container,{name:"labels"}),oob:new Renderer(this.container,{name:"oob"})},this._heatMap=new HeatMapLight(this.renderers.heat,this.renderers.selectedHeat);var opacityTransition="opacity 0.5s linear";this.renderers.heat.setAttribute("style",{webkitTransition:opacityTransition,mozTransition:opacityTransition,transition:opacityTransition}),this.renderers.dots.setAttribute("style",{webkitTransition:opacityTransition,mozTransition:opacityTransition,transition:opacityTransition}),this.renderers.labels.setAttribute("style",{webkitTransition:opacityTransition,mozTransition:opacityTransition,transition:opacityTransition
}),this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10},this._transitionHelper.setTransitionTime(500,0)},setIsBigData:function(c){this._isBigData=c},getIsBigData:function(){return this._isBigData},setIsReduced:function(c){c!==this._isReduced&&(this._reducedModeChanged=!0,this._isReduced=c)},getIsReduced:function(){return this._isReduced},setHeatMap:function(dp){this._heatMap.setData(dp)},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setColorMapLight:function(c){this._colorMapLight=c,this._heatMap.setColorMapLight(this._colorMapLight)},getColorMapLight:function(){return this._colorMap},setXAxis:function(ax){this._xAxis=ax,this._heatMap.setXAxis(ax),this._xAxis.listen("changed",function(){this.invalidateDisplay()},this)},setYAxis:function(ax){this._yAxis=ax,this._heatMap.setYAxis(ax),this._yAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(t){this._tree=t,this.invalidateProperties(),this.invalidateDisplay()},setMinDotSize:function(s){this._transitionProperties._minDotSize=s,this.invalidateDisplay()},setMaxDotSize:function(s){this._transitionProperties._maxDotSize=s,this.invalidateDisplay()},setLabelMode:function(m){this._labelMode=m,this.invalidateDisplay()},setNavigation:function(v){this._navigationVisible=v,this.invalidateDisplay()},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10}},_updateSize:function(){this.invalidateDisplay()},setData:function(data){this._super(data)},_updateProperties:function(){if(this._data&&this._tree){this._canvasShapes={},this._labelShapes={};var dot,labelRect,cacheItem,xValue,yValue,rValue,nodeDepth,cacheItems=[],numDimz=this._data.qHyperCube.qDimensionInfo.length,numMeas=this._data.qHyperCube.qMeasureInfo.length,tree=this._tree,self=this,dots=this._dots,labelRects=this._labelRects,num=tree.children.length,numRequiredDots=0,numAvailableDots=this._dots.length,treeDepth=numDimz+1,renderer=this.renderers.dots,labelStyle=this._style.dataPoints,selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return this._onlySelected=!1,self._transitionProperties.values={},self._transitionProperties.nodes={},numMeas>2&&(self._transitionProperties.sizeDataMin=this._data.qHyperCube.qMeasureInfo[2].qMin,self._transitionProperties.sizeDataMax=this._data.qHyperCube.qMeasureInfo[2].qMax),num&&treeIterator.each.call(tree,function(node,idx){if(nodeDepth=treeIterator.getLevel.call(node),node.idx=idx,nodeDepth===treeDepth-1){if(numDimz>1&&idx>0)return;xValue=node.children[0].data.qNum,yValue=node.children[1].data.qNum,rValue=node.children.length>2?node.children[2].data.qNum:.5,node.dotData={color:null,label:null},1>=numDimz&&(node.dotData.dotIndex=numRequiredDots++,numRequiredDots>numAvailableDots?(dot=ScatterHelper.createShape("circle",[0,0,0,0]),labelRect=ScatterHelper.createShape("rect",[0,0,0,0]),dots.push(dot),labelRects.push(labelRect)):(dot=self._dots[node.dotData.dotIndex],dot.cx=NaN,dot.cy=NaN,labelRect=self._labelRects[node.dotData.dotIndex]),cacheItem=node.cacheItem,cacheItem.addShape(selectionID,dot,!0),cacheItem.toggleShapes=[labelRect],cacheItems.push(cacheItem),self._transitionProperties.values[node.data.qElemNo]={xValue:xValue,yValue:yValue,rValue:rValue}),node.dotData.label={x:0,y:0,width:0,height:0,text:node.data.qText},node.dotData.label.width=renderer.getTextWidth(node.dotData.label.text,labelStyle.font),node.dotData.label.height=renderer.getFontHeight(labelStyle.font)}}),this._dots.length>numRequiredDots&&(this._dots=this._dots.slice(0,numRequiredDots),this._labelRects=this._labelRects.slice(0,numRequiredDots)),this.setSelectableShapes(cacheItems),this._super()}},hasValidData:function(){return this._super()&&this._data&&(this._tree||this._isReduced&&this._heatMap.hasValidData())&&this._xAxis&&this._yAxis},paint:function(){var self=this;if(this._super(this._layoutMode,this._data),this._xAxis&&this._yAxis&&this._data){if(this._xAxis.updateNow(),this._yAxis.updateNow(),this.renderers.oob.edgeBleed={left:10,right:10,bottom:10,top:10},this._styles=updateStyles(this._styleService),!this._renderData)return this.clear();if(this.renderers.dots.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.heat.setAttribute("style",{opacity:this._globalAlpha||1}),this._isReduced)return this.renderers.heat.stage.removeChildren(),this.renderers.heat.clear(),this._reducedModeChanged?(this._reducedModeChanged=!1,this.setSelectableShapes([]),updateRendererVisibility.call(this,[{renderer:this.renderers.heat,visible:!0},{renderer:this.renderers.selectedHeat,visible:!0},{renderer:this.renderers.dots,visible:!1},{renderer:this.renderers.labels,visible:!1},{renderer:this.renderers.oob,visible:!1}]),this._heatMap.draw()):(this.renderers.labels.stage.removeChildren(),this.renderers.labels.clear(),this.renderers.dots.stage.removeChildren(),this.renderers.dots.clear(),this.renderers.oob.stage.removeChildren(),this.renderers.oob.clear(),this.setSelectableShapes([]),this._heatMap.draw());if(this._tree.children.length>0){var renderDotsFn=function(){var dotsPromise,labelsPromise,dfds=[];return dotsPromise=renderDots.apply(self,[self._onlySelected]),dotsPromise&&dfds.push(dotsPromise),self._onlySelected=!1,self._labelMode>LabelMode.NONE&&self._layoutMode>self.ShowFlags.XSMALL?(labelsPromise=renderLabels.apply(self,[]),labelsPromise&&dfds.push(labelsPromise)):(self.renderers.labels.stage.removeChildren(),dfds.push(self.renderers.labels.clear())),Deferred.all(dfds)};return this._reducedModeChanged?(this._reducedModeChanged=!1,updateRendererVisibility.call(this,[{renderer:this.renderers.heat,visible:!1},{renderer:this.renderers.selectedHeat,visible:!1},{renderer:this.renderers.dots,visible:!0},{renderer:this.renderers.labels,visible:!0}]),renderDotsFn()):(this.renderers.heat.clear(),this.renderers.heat.stage.removeChildren(),this.renderers.selectedHeat.clear(),this.renderers.selectedHeat.stage.removeChildren(),renderDotsFn())}}},clear:function(){return this._transitionHelper.clear(),this._super()},toggleCacheItem:function(item){var isInSelectionMode=!0,localStyles=this._styles,selectedAlpha=.9,self=this;this.renderers.dots.stage.opacity!==this._globalAlpha&&(isInSelectionMode=!1,this.renderers.dots.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha);var cShape=this._canvasShapes[item.row],lblShape=this._labelShapes[item.row];cShape&&(item.selected?(cShape.strokeWidth=localStyles.shape.selected.border.width,cShape.stroke=localStyles.shape.selected.border.color,cShape.opacity=selectedAlpha,cShape.zIndex=1,lblShape&&lblShape.visible&&(lblShape.text.opacity=1,lblShape.line.opacity=1,lblShape.zIndex=1)):(cShape.opacity=void 0,cShape.stroke=self._sheetBackgroundColor.toRGBA(),cShape.strokeWidth=localStyles.shape.border.width,cShape.zIndex=void 0,lblShape&&lblShape.visible&&(lblShape.text.opacity=void 0,lblShape.line.opacity=void 0,lblShape.zIndex=void 0)),isInSelectionMode&&(cShape.invalidate(),lblShape&&lblShape.visible&&lblShape.text.invalidate())),isInSelectionMode||(this.renderers.dots.render(),this.renderers.labels.render(),this.renderers.oob.render())},updateRangeSelection:function(rect){this._heatMap.copyHeatMap(rect),this._heatMap.clipSelected(rect)},startRangeSelection:function(rect){this._heatMap.copyHeatMap(rect)},copyHeatMap:function(){return this._heatMap.copyHeatMap()},getHeatMapCanvas:function(){return this._heatMap.getHeatMapCanvas()},clearSelection:function(){this._heatMap.clearSelection()},setRenderData:function(b){this._renderData=b}})}),define("client.property-panel/components/color-scale-creator/color-scale-creator-utils",["core.utils/theme","general.utils/color","jquery"],function(Theme,Color,$){function prepareSegmentInfo(segmentInfo,min,max){var seginfo;return seginfo=$.extend(!0,{},segmentInfo),seginfo&&seginfo.limits&&(seginfo.limits=seginfo.limits.concat().sort(function(a,b){return a.value-b.value}),seginfo.limits.forEach(function(limit){limit.value=(limit.value-min)/(max-min)})),seginfo&&seginfo.colors&&(seginfo.colors=seginfo.colors.concat().map(function(item){return{color:ColorScaleCreatorUtils.resolveColor(item.color)}})),seginfo}function shouldBlend(segmentInfo,colorIndex){if(0!==segmentInfo.limits.length){var returnBoolean;return returnBoolean=0===colorIndex?segmentInfo.limits[colorIndex].gradient:colorIndex===segmentInfo.colors.length-1?segmentInfo.limits[colorIndex-1].gradient:segmentInfo.limits[colorIndex].gradient||segmentInfo.limits[colorIndex-1].gradient}}function getSegmentIndex(segmentInfo,value,min){if(isNaN(value))return 0;var limit,i,lastLimit=min?Math.min(min,value):0,limits=segmentInfo.segments.limits.concat().sort(function(a,b){return a.value-b.value}),colors=segmentInfo.segments.colors;for(i=0;i<colors.length;i++){if(i===colors.length-1)return i;if(limit=limits[i].value,limit>value&&value>=lastLimit)return i;lastLimit=limit}return 0}function getBlendInfo(segmentInfo,colorIndex,nValue){var color,t,limits=segmentInfo.limits.concat().sort(function(a,b){return a.value-b.value}),lowerLimit=colorIndex>0?limits[colorIndex-1]:{value:0,gradient:!1},prevColor=segmentInfo.colors[colorIndex-(colorIndex>0?1:0)],upperLimit=limits[colorIndex]?limits[colorIndex]:{value:1,gradient:!1},nextColor=segmentInfo.colors[colorIndex+(colorIndex<segmentInfo.colors.length-1?1:0)],normValueInLimits=nValue===upperLimit.value?1:(nValue-lowerLimit.value)/(upperLimit.value-lowerLimit.value);return lowerLimit&&lowerLimit.gradient&&upperLimit&&upperLimit.gradient?nValue-lowerLimit.value<upperLimit.value-nValue?(color=prevColor.color,t=.5-normValueInLimits):(color=nextColor.color,t=normValueInLimits-.5):lowerLimit&&lowerLimit.gradient?(color=prevColor.color,t=1-(.5+normValueInLimits/2)):upperLimit&&upperLimit.gradient?(color=nextColor.color,t=normValueInLimits/2):(color=segmentInfo.colors[colorIndex].color,t=nValue),{color:color,t:t}}function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:"number"==typeof input?"#000":input}function blendValue(segInfo,normalizedMainValue,min,max){var blendInfo,upperLimit,i,color,lowerLimit=0,segmentInfo=prepareSegmentInfo.call(this,segInfo,min,max);if(0>=normalizedMainValue)return segmentInfo.colors[0].color;if(normalizedMainValue>=1)return segmentInfo.colors[segmentInfo.colors.length-1].color;for(i=0;i<segmentInfo.colors.length;i++){if(upperLimit=segmentInfo.limits[i]?segmentInfo.limits[i].value:1,normalizedMainValue>=lowerLimit&&upperLimit>normalizedMainValue){blendInfo=this.getBlendInfo(segmentInfo,i,normalizedMainValue,min,max),color=new Color(segmentInfo.colors[i].color).blend(new Color(blendInfo.color),blendInfo.t);break}lowerLimit=upperLimit}return color}var ColorScaleCreatorUtils={blendValue:blendValue,shouldBlend:shouldBlend,getBlendInfo:getBlendInfo,resolveColor:resolveColor,getSegmentIndex:getSegmentIndex};return ColorScaleCreatorUtils}),define("extensions.qliktech/scatterplot/color-map-light",["core.utils/class","client.property-panel/components/color-scale-creator/color-scale-creator-utils"],function(Class,ColorScaleCreatorUtils){function isValid(){return this._colors&&this._colors.length&&this._limits&&this._limits.length&&!isNaN(this._min)&&!isNaN(this._max)&&this._colors.length===this._limits.length+1}var ColorMapLight=Class.extend("ColorMapLight",{init:function(options){this._colors=options.colors,this._limits=options.limits,this._min=options.min,this._max=options.max,this._valid=isValid.call(this)},getColor:function(value){if(this._valid){var segments={colors:this._colors,limits:this._limits},normalizedValue=(value-this._min)/(this._max-this._min),color=ColorScaleCreatorUtils.blendValue(segments,normalizedValue,this._min,this._max);return color}},getColorMapping:function(){}});return ColorMapLight}),define("extensions.qliktech/scatterplot/scatterplot-properties",["translator","client.utils/default-property-logic"],function(translator,propertyLogicModule){var settings,addons,nonCompProp,propertyLogic=propertyLogicModule.getLogicFor("hard","scatterplot");nonCompProp={component:"text",translation:"properties.compression.willNotAffect",show:function(data,handler){return propertyLogic.helpers.showCompressionResolution(handler.layout)}},settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},bubbleSizeItems:{type:"items",items:{bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:5,show:function(data){return data.qHyperCubeDef.qMeasures.length<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:[2,8],show:function(data){return data.qHyperCubeDef.qMeasures.length>=3}},rangeBubbleCompressionNote:nonCompProp}},label:{type:"items",items:{labelMode:{ref:"labels.mode",translation:"properties.labels",type:"string",component:"dropdown",defaultValue:1,options:[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}],snapshot:{tid:"property-labels"}},labelModeCompressionNote:nonCompProp}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,defaultValue:5,show:function(data,handler){return propertyLogic.helpers.showCompressionResolution(handler.layout)}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(data){return!data.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{autoColor:{},colorsAnLegendCompressionNote:nonCompProp,colorMode:{defaultValue:"primary",options:propertyLogic.color.colorMode.options},persistentColors:{show:propertyLogic.color.persistentColors.show}}},legend:{items:{show:{show:propertyLogic.legend.show,snapshot:{tid:"property-legend"}},showTitle:{show:propertyLogic.legend.showTitle.show},dock:{show:propertyLogic.legend.dock.show}}}}},xAxis:{type:"items",uses:"measureAxis",label:function(properties,handler){var label,measure=handler.getMeasureLayouts()[0];return label=measure&&!measure.qError?translator.get("properties.xAxisWithInfo",[measure.qFallbackTitle]):translator.get("properties.xAxis")},items:{axis:{items:{show:{ref:"xAxis.show",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},dock:{ref:"xAxis.dock",show:function(data){return"none"!==data.xAxis.show},options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]},spacing:{ref:"xAxis.spacing",show:function(data){return"none"!==data.xAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"xAxis.autoMinMax"},minMax:{ref:"xAxis.minMax",show:function(data){return!data.xAxis.autoMinMax}},min:{ref:"xAxis.min",show:function(data){return["min","minMax"].contains(data.xAxis.minMax)&&!data.xAxis.autoMinMax},invalid:function(data){return"minMax"===data.xAxis.minMax?data.xAxis.min>=data.xAxis.max:!1}},max:{ref:"xAxis.max",show:function(data){return["max","minMax"].contains(data.xAxis.minMax)&&!data.xAxis.autoMinMax},invalid:function(data){return"minMax"===data.xAxis.minMax?data.xAxis.min>=data.xAxis.max:!1}}}}}},yAxis:{type:"items",uses:"measureAxis",label:function(properties,handler){var label,measure=handler.getMeasureLayouts()[1];return label=measure&&!measure.qError?translator.get("properties.yAxisWithInfo",[measure.qFallbackTitle]):translator.get("properties.yAxis")},items:{axis:{items:{show:{ref:"yAxis.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"yAxis.dock",show:function(data){return"none"!==data.yAxis.show}},spacing:{ref:"yAxis.spacing",show:function(data){return"none"!==data.yAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"yAxis.autoMinMax"},minMax:{ref:"yAxis.minMax",show:function(data){return!data.yAxis.autoMinMax}},min:{ref:"yAxis.min",show:function(data){return["min","minMax"].contains(data.yAxis.minMax)&&!data.yAxis.autoMinMax},invalid:function(data){return"minMax"===data.yAxis.minMax?data.yAxis.min>=data.yAxis.max:!1}},max:{ref:"yAxis.max",show:function(data){return["max","minMax"].contains(data.yAxis.minMax)&&!data.yAxis.autoMinMax},invalid:function(data){return"minMax"===data.yAxis.minMax?data.yAxis.min>=data.yAxis.max:!1}}}}}}}};var data={uses:"data"};return addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLinesX:{uses:"reflines",ref:"refLine.refLinesX",translation:"properties.referenceLinesX"},refLinesY:{uses:"reflines",ref:"refLine.refLinesY",translation:"properties.referenceLinesY"},dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:data,addons:addons,settings:settings}}}),define("extensions.qliktech/scatterplot/scatterplot-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(propertyLogicModule,hcHelper){var propertyLogic=propertyLogicModule.getLogicFor("explore","scatterplot");return{type:"items",component:"accordion",items:{color:{uses:"color",items:{mode:{options:propertyLogic.color.colorMode.options},dimension:{items:{colorScheme:{show:function(data,layout){var dim=hcHelper.getDimensionLayouts(layout)[0];return dim&&dim.qCardinal<=12?!1:!0}},persistentColors:{show:!0}}}}},presentation:{uses:"presentation",items:{showNavigation:{type:"boolean",translation:"Common.Navigation",component:"switch",ref:"navigation",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},showLabels:{component:"radio-list",translation:"properties.labels",type:"number",ref:"labels.mode",options:function(){return[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}]}},bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(data){return hcHelper.getNumMeasures(data)<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(data){return hcHelper.getNumMeasures(data)>2}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,show:function(data,layout){return propertyLogic.helpers.showCompressionResolution(layout)}}}}}}}),define("extensions.qliktech/scatterplot/scatterplot-data",["general.utils/property-resolver"],function(propertyResolver){function setInitialSort(handler){var meas=handler.getMeasures();2===meas.length?handler.setSorting([2,1,0]):3===meas.length&&handler.setSorting([3,2,1,0])}function setColorVars(data,handler){var measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");"byExpression"===mode&&0===measures.length&&propertyResolver.setValue(data,"color.mode","primary")}var data={dimensions:{min:1,max:1},measures:{min:2,max:3,add:function(measure,data,handler){setInitialSort(handler),measure.qSortBy.qSortByNumeric=-1},remove:function(measure,data,handler){setInitialSort(handler),setColorVars(data,handler)}}};return data}),define("text!extensions.qliktech/scatterplot/scatterplot.ng.html",[],function(){return'<div style="height: 100%; position: relative;">\r\n	<div qv-extension\r\n		 class="qv-viz"\r\n		 style="position: relative;">\r\n	</div>\r\n	<span class="qv-viz-disclaimer" ng-if="dataAttributes.reduceDataDisc  && dataAttributes.layoutMode > 2">{{ reducedDataNote }}</span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n	<div qva-scatter-navigation>\r\n		<!--on-navigation="onNavigation"\r\n		navigation-disabled="navigationDisabled"\r\n		navigation-home-only="navigationHomeOnly"\r\n		navigation-visible="navigationVisible"\r\n		navigation-style="navigationPosition"-->\r\n	</div>\r\n	<div qva-scatter-mini-map ng-show="showMiniMap" ng-style="miniMapStyle" colorMap="colorMap"></div>\r\n</div>'}),define("text!extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation.ng.html",[],function(){return'<div class="qv-scatter-nav" ng-style="navigationStyle">\r\n	<div ng-show="navigationHomeOnly && navigationVisible" class="qv-scatter-nav-homeonly">\r\n		<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="ü" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n	</div>\r\n	<div ng-show="!navigationHomeOnly && navigationVisible" class="qv-scatter-nav-fullnav">\r\n		<div class="qv-scatter-nav-top">\r\n			<button class="qv-scatter-nav-up qui-plainbuttonicon" data-icon="R" qva-activate="onNavigationPressed(\'navUp\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanUp" />\r\n		</div>\r\n		<div class="qv-scatter-nav-middle">\r\n			<button class="qv-scatter-nav-left qui-plainbuttonicon" data-icon="T" qva-activate="onNavigationPressed(\'navLeft\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanLeft" />\r\n			<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="ü" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n			<button class="qv-scatter-nav-right qui-plainbuttonicon" data-icon="U" qva-activate="onNavigationPressed(\'navRight\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanRight" />\r\n		</div>\r\n		<div class="qv-scatter-nav-bottom">\r\n			<button class="qv-scatter-nav-down qui-plainbuttonicon" data-icon="S" qva-activate="onNavigationPressed(\'navDown\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanDown" />\r\n			<button class="qv-scatter-nav-in qui-plainbuttonicon" data-icon="Y" qva-activate="onNavigationPressed(\'zoomIn\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomIn" />\r\n			<button class="qv-scatter-nav-out qui-plainbuttonicon" data-icon="Z" qva-activate="onNavigationPressed(\'zoomOut\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomOut" />\r\n		</div>\r\n	</div>\r\n</div>'}),define("extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation",["qvangular","text!./scatterplot-navigation.ng.html"],function(qvangular,navigationTemplate){qvangular.directive("qvaScatterNavigation",function(){return{template:navigationTemplate,replace:!0,link:function(scope){scope.onHomePressed=function(){scope.$broadcast("navigationPressed","resetZoom")},scope.onNavigationPressed=function(event){scope.$broadcast("navigationPressed",event)}}}})}),define("extensions.qliktech/scatterplot/axis-light",["core.utils/class"],function(Class){var AxisLight=Class.extend("AxisLight",{init:function(minValue,maxValue,minPos,maxPos){this._values={min:minValue,max:maxValue},this._positions={min:minPos,max:maxPos}},setValues:function(values){this._values=values},getValues:function(){return this._values},setPositions:function(positions){this._positions=positions},getPositions:function(){return this._positions},getPositionOfValue:function(value){var normValue=(value-this._values.min)/(this._values.max-this._values.min),posSpan=this._positions.max-this._positions.min;return this._positions.min+posSpan*normValue}});return AxisLight}),define("text!extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map.ng.html",[],function(){return'<div class="qv-scatter-mini-map">\r\n	<div class="scatter-mini-map"></div>\r\n	<div class="scatter-mini-map-focus" ng-style="focusStyle"></div>\r\n</div>'}),define("extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map",["qvangular","objects.views/charts/renderers/canvas-renderer","extensions.qliktech/scatterplot/axis-light","extensions.qliktech/scatterplot/heat-map-light","text!./scatterplot-mini-map.ng.html","touche"],function(qvangular,CanvasRenderer,AxisLight,HeatMap,minimapTemplate){qvangular.directive("qvaScatterMiniMap",function(){return{template:minimapTemplate,replace:!0,link:function(scope,element){var heatMap,dataAreaSize,focusInfo,offset,overviewElement=element.find(".scatter-mini-map"),namespace=".scatterplot-mini-map",xAxis=new AxisLight,yAxis=new AxisLight,updateFocusArea=function(container){if(focusInfo){var left=xAxis.getPositionOfValue(focusInfo.xMin),top=yAxis.getPositionOfValue(focusInfo.yMax),width=xAxis.getPositionOfValue(focusInfo.xMax)-xAxis.getPositionOfValue(focusInfo.xMin),height=yAxis.getPositionOfValue(focusInfo.yMin)-yAxis.getPositionOfValue(focusInfo.yMax),elementWidth=container.width,elementHeight=container.height;0>left?(width+=left,left=0):left>elementWidth&&(left=elementWidth,width=0),0>top?(height+=top,top=0):top>elementHeight&&(top=elementHeight,height=0),left+width>elementWidth&&(width=elementWidth-left),top+height>elementHeight&&(height=elementHeight-top),height=height>elementHeight?elementHeight:height,width=width>elementWidth?elementWidth:width,scope.focusStyle={left:left,top:top,width:width,height:height}}},jumpTo=function(e,data){offset||(offset=element.offset());var focusWidth=scope.focusStyle.width,focusHeight=scope.focusStyle.height,jumpPos={x:data.pagePoints[0].x-offset.left,y:data.pagePoints[0].y-offset.top},focusPos={x:scope.focusStyle.left+focusWidth/2,y:scope.focusStyle.top+focusHeight/2},dx=(jumpPos.x-focusPos.x)/(focusInfo.scale*element.width()),dy=(jumpPos.y-focusPos.y)/(focusInfo.scale*element.height());scope.$broadcast("navigationPressed","jumpTo",{x:-dx*dataAreaSize.width+dataAreaSize.width/2,y:-dy*dataAreaSize.height+dataAreaSize.height/2})};scope.renderers={overview:new CanvasRenderer(overviewElement[0],{name:"overview"})},heatMap=new HeatMap(scope.renderers.overview),heatMap.setXAxis(xAxis),heatMap.setYAxis(yAxis),heatMap.setColorMapLight(scope.colorMap),scope.$on("onUpdateMiniMapData",function(e,dataPages){heatMap.setData(dataPages)}),scope.$on("onResizeMiniMap",function(e,miniMapStyle,daSize){xAxis.setPositions({min:0,max:miniMapStyle.width}),yAxis.setPositions({min:miniMapStyle.height,max:0}),scope.renderers.overview.setDimensions(0,0,miniMapStyle.width,miniMapStyle.height),updateFocusArea({width:miniMapStyle.width,height:miniMapStyle.height}),element.is(":visible")&&(offset=element.offset()),dataAreaSize=daSize,heatMap.draw()}),scope.$on("onUpdateMiniMap",function(e,axisInfo){var elementWidth=element.width(),elementHeight=element.height();xAxis.setValues(axisInfo.x),xAxis.setPositions({min:0,max:elementWidth}),yAxis.setValues(axisInfo.y),yAxis.setPositions({min:elementHeight,max:0}),scope.renderers.overview.setDimensions(0,0,element.width(),element.height()),heatMap.draw()}),scope.$on("onUpdateMiniMapFocus",function(e,xMin,xMax,yMin,yMax){var xAxisValues=xAxis.getValues();focusInfo={xMin:xMin,yMin:yMin,xMax:xMax,yMax:yMax,scale:(xMax-xMin)/(xAxisValues.max-xAxisValues.min)},updateFocusArea({width:element.width(),height:element.height()})}),scope.$on("onResetMiniMapFocus",function(){scope.focusStyle={left:0,top:0,width:element.width(),height:element.height()}}),Touche(element[0]).tap({id:namespace,end:function(e,data){jumpTo(e,data)}});var tempFocusPos;Touche(element[0]).swipe({id:namespace,start:function(){offset||(offset=element.offset());var focusWidth=scope.focusStyle.width,focusHeight=scope.focusStyle.height;tempFocusPos={x:scope.focusStyle.left+focusWidth/2,y:scope.focusStyle.top+focusHeight/2},scope.$broadcast("navigationPressed","startAt",{x:dataAreaSize.width/2,y:dataAreaSize.height/2})},update:function(e,data){var jumpPos={x:data.pagePoints[0].x-offset.left,y:data.pagePoints[0].y-offset.top},dx=(jumpPos.x-tempFocusPos.x)/(focusInfo.scale*element.width()),dy=(jumpPos.y-tempFocusPos.y)/(focusInfo.scale*element.height());scope.$broadcast("navigationPressed","moveTo",{x:-dx*dataAreaSize.width+dataAreaSize.width/2,y:-dy*dataAreaSize.height+dataAreaSize.height/2})},end:function(){scope.$broadcast("navigationPressed","endAt")}})}}})}),define("extensions.qliktech/scatterplot/scatterplot",["jquery","core.utils/deferred","client.utils/state","translator","objects.views/charts/axis-chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-line-labels","objects.views/charts/utils/binding","./scatterarea","objects.views/charts/representation/combo-color-map","extensions.qliktech/scatterplot/color-map-light","objects.backend-api/hypercube-api","extensions.qliktech/scatterplot/scatterplot-properties","extensions.qliktech/scatterplot/scatterplot-explore-properties","extensions.qliktech/scatterplot/scatterplot-data","text!./scatterplot.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/utils/matrix","general.utils/property-resolver","objects.utils/number-formatter","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map","touche"],function($,Deferred,State,translator,AxisChart,ChartComponent,RefLineLabels,Binding,ScatterArea,ColorMap,ColorMapLight,HypercubeApi,scatterplotPropertiesDefinition,softOptions,scatterplotData,template,EventUtils,ChartUtils,objectConversion,Matrix,propResolver,NumberFormatter){"use strict";function preResize(){this._updateLayoutMode(this.rect.width,this.rect.height),updateMiniMapStyle.call(this)}function splitJSONDataPages(dp){var i,bins=[],matrix=dp[0].qMatrix;if(bins.push(matrix[0][0]),dp[0].reformatted)for(i=1;i<matrix.length;i++)try{bins.push(matrix[i][0])}catch(err){}else{for(i=1;i<matrix.length;i++)try{matrix[i][0].qText=JSON.parse(matrix[i][0].qText),bins.push(matrix[i][0])}catch(err){}dp[0].reformatted=!0}return[bins]}function updateLegendPosition(colorLegend,data){data&&"auto"!==propResolver.getValue(data,"legend.dock","auto")?colorLegend.setDock(data.legend.dock):colorLegend.outerRect.height/colorLegend.outerRect.width<1?colorLegend.setDock("right"):colorLegend.setDock("bottom")}function checkSelectionState(selections){var type=selections.getActiveType(),tooltipType=selections.types.tooltip;type&&"item"!==type.getActiveMode()&&type.clearSelection(),tooltipType&&tooltipType.clearSelection()}function updateNavigation(){var homeOnly=(this._layoutMode<31||!this._data.navigation)&&this._on&&!State.isInEditMode()&&this._layoutMode>3,visible=(!this._defaultZoomPan||!!this._data.navigation)&&this._on&&!State.isInEditMode()&&(this._layoutMode>3||homeOnly&&this._layoutMode>=3),self=this;this.$scope.navigationHomeOnly=homeOnly,this.$scope.navigationVisible=visible,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+5+"px"},setTimeout(function(){self.$scope.$digest()})}function resetZoom(){var dataArea=this.components.dataArea,xAxis=dataArea._xAxis,yAxis=dataArea._yAxis,self=this;
checkSelectionState(this.selections),xAxis.setUseTransition(this._allowTransitions),yAxis.setUseTransition(this._allowTransitions),this._axisInfo.x.min=!this._data.xAxis.autoMinMax&&["min","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.min):null,this._axisInfo.x.max=!this._data.xAxis.autoMinMax&&["max","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.max):null,this._axisInfo.y.min=!this._data.yAxis.autoMinMax&&["min","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.min):null,this._axisInfo.y.max=!this._data.yAxis.autoMinMax&&["max","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.max):null,xAxis.setPlotMin(this._axisInfo.x.min),xAxis.setPlotMax(this._axisInfo.x.max),yAxis.setPlotMin(this._axisInfo.y.min),yAxis.setPlotMax(this._axisInfo.y.max),this._defaultZoomPan=!0,this._zoomScale=1,preResize.call(this),this._paint(),setTimeout(function(){self._debouncedUpdateLayout.call(self),self.$scope.$emit("onResetMiniMapFocus"),self.$scope.showMiniMap=!1},1e3)}function panZoom(x,y,scale,swipeData){var key,xDelta,yDelta,self=this,matrix=this._transformMatrix.identity(),rect=this.components.dataArea.rect,xAxis=this.components.xAxis,yAxis=this.components.yAxis,minPoint={x:this._axisInfo.x.min,y:this._axisInfo.y.min},maxPoint={x:this._axisInfo.x.max,y:this._axisInfo.y.max},xSpan=maxPoint.x-minPoint.x,ySpan=maxPoint.y-minPoint.y,mouseValues={x:x/rect.width*xSpan+minPoint.x,y:maxPoint.y-y/rect.height*ySpan};xDelta=(this._panX-x)/rect.width*xSpan,yDelta=(this._panY-y)/rect.height*ySpan,matrix.translate(xDelta,-yDelta),scale&&(matrix.translate(mouseValues.x,mouseValues.y),matrix.scale(1/scale,1/scale),matrix.translate(-mouseValues.x,-mouseValues.y)),this._defaultZoomPan&&this._needUpdateMiniMap&&updateMiniMap.call(this),this._defaultZoomPan=!1,minPoint=matrix.transformPoint(minPoint),maxPoint=matrix.transformPoint(maxPoint);var shouldScaleX=minPoint.x>this._xZoomMin&&maxPoint.x<this._xZoomMax&&maxPoint.x-minPoint.x>1e-5*(xAxis.getDataMax()-xAxis.getDataMin()),shouldScaleY=minPoint.y>this._yZoomMin&&maxPoint.y<this._yZoomMax&&maxPoint.y-minPoint.y>1e-5*(yAxis.getDataMax()-yAxis.getDataMin());shouldScaleX&&(xAxis.setPlotMin(minPoint.x),xAxis.setPlotMax(maxPoint.x)),shouldScaleY&&(yAxis.setPlotMin(minPoint.y),yAxis.setPlotMax(maxPoint.y)),shouldScaleX&&shouldScaleY&&(this.components.dataArea.clearSelection(),swipeData&&(this._translateInfo.x=Math.round(swipeData.deltaX),this._translateInfo.y=Math.round(swipeData.deltaY),this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.translateScene(this._translateInfo.x-this._prevTranslateInfo.x,this._translateInfo.y-this._prevTranslateInfo.y),this._prevTranslateInfo.x=this._translateInfo.x,this._prevTranslateInfo.y=this._translateInfo.y),1!==scale&&this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.scaleScene(x,y,scale),self.$scope.$emit("onUpdateMiniMapFocus",minPoint.x,maxPoint.x,minPoint.y,maxPoint.y));for(key in this.components)"dataArea"===key&&this.components.dataArea.getIsReduced()||this.components[key].invalidateDisplay();updateNavigation.call(this)}function startPanZoom(panX,panY){this._panX=panX,this._panY=panY,this._axisInfo.x.min=this.components.xAxis.getPlotMin(),this._axisInfo.x.max=this.components.xAxis.getPlotMax(),this._axisInfo.y.min=this.components.yAxis.getPlotMin(),this._axisInfo.y.max=this.components.yAxis.getPlotMax(),this._prevTranslateInfo.x=this._translateInfo.x=0,this._prevTranslateInfo.y=this._translateInfo.y=0,this.components.xAxis.setUseTransition(!1),this.components.yAxis.setUseTransition(!1),checkSelectionState(this.selections)}function endPanZoom(){this._debouncedUpdateLayout()}function getBinnedData(left,top,width,height,zoomLevel){if(this._dataDfd=Deferred(),this._ready=this._dataDfd.promise,!this._data||isNaN(left)||isNaN(top)||isNaN(width)||isNaN(height))return this._fetchedData=!0,this.$scope.throbberApi.hide(),Deferred.resolve();var self=this,queryLevel=this._data.compressionResolution?this._data.compressionResolution:DefaultResolutionLevel,maxNrBins=1e3,heatMapLevelZoomChange=zoomLevel?zoomLevel-1:0,rePaint=function(){return self._fetchedData=!0,self.prePaint(self._data),Deferred.all([self._updateData(self._data)]).then(function(){self._dataDfd.resolve(),self.$scope.throbberApi.hide()})};return this.backendApi.getHyperCubeBinnedData(void 0===self._data?void 0:[{qTop:0,qLeft:0,qWidth:self._data.qHyperCube.qSize.qcx,qHeight:self._data.qHyperCube.qSize.qcy}],[{qLeft:left,qTop:top,qWidth:width,qHeight:height}],maxNrBins,Math.min(queryLevel+heatMapLevelZoomChange,MaxResolutionLevel)).then(function(dataPages){if(!self._data||!dataPages||self._destroyed)return self._fetchedData=!0,void self.$scope.throbberApi.hide();if(self.components.dataArea.setIsBigData(!0),dataPages[0].qMatrix.length>0){self._isReducedMode=!0,self._data.qHyperCube.isReduced=!0;var splittedDataPages=splitJSONDataPages([dataPages[0]]);return self.components.dataArea.setHeatMap(splittedDataPages),self.components.colorLegendLight&&self.components.colorLegendLight.setClusterDataPage(splittedDataPages),self._needUpdateMiniMap&&self.$scope.$emit("onUpdateMiniMapData",splittedDataPages),self.components.dataArea.setIsReduced(!0),self.$scope.reducedDataNote="*"+translator.get("properties.compression.providingOverviewOf",[self._numberFormatter.format(self._data.qHyperCube.qSize.qcy,self._defaultPattern)]),self._toggleLasso&&(self._oldToggleLasso=!0,self.toggleLasso(!1)),rePaint()}return self._isReducedMode=!1,self._data.qHyperCube.isReduced=!1,self._data.qHyperCube.qDataPages=[dataPages[1]],self.components.dataArea.setIsReduced(!1),!self._toggleLasso&&self._oldToggleLasso&&(self.toggleLasso(!0),self._oldToggleLasso=!1),rePaint()})}function getSelectedRows(){var selectedRows;if(this._dataUpdatedOnPanOrZoom&&!this._isReducedMode&&this._selectedElemNumbers){var i,qElemNumber,qMatrix=this._data&&this._data.qHyperCube&&this._data.qHyperCube.qDataPages&&this._data.qHyperCube.qDataPages[0]?this._data.qHyperCube.qDataPages[0].qMatrix:void 0,numItems=qMatrix?qMatrix.length:0,qElemNumberToRowIndex={},numSelectedElemNumbers=this._selectedElemNumbers.length;for(selectedRows=[],this._selectedElemNumbersWithoutRowIndex=[],i=0;numItems>i;i++)qElemNumber=qMatrix[i][0].qElemNumber,qElemNumberToRowIndex[qElemNumber]=i;for(i=0;numSelectedElemNumbers>i;i++)qElemNumber=this._selectedElemNumbers[i],void 0===qElemNumberToRowIndex[qElemNumber]?this._selectedElemNumbersWithoutRowIndex[this._selectedElemNumbersWithoutRowIndex.length]=qElemNumber:selectedRows[selectedRows.length]=qElemNumberToRowIndex[qElemNumber]}return selectedRows}function updateMiniMapStyle(){var daWidth=this.components.dataArea.rect.width,daHeight=this.components.dataArea.rect.height,miniMapSizeRatio=.15,padding=10;this._layoutMode<=3?this.$scope.miniMapStyle={display:"none"}:this.$scope.miniMapStyle={display:"block",left:this.components.dataArea.rect.x+this.components.dataArea.rect.width*(1-miniMapSizeRatio)-padding,top:this.components.dataArea.rect.y+this.components.dataArea.rect.height*(1-miniMapSizeRatio)-padding,width:this.components.dataArea.rect.width*miniMapSizeRatio,height:this.components.dataArea.rect.height*miniMapSizeRatio},!this._isBigData||this._defaultZoomPan||this.components.xAxis.getPlotMin()<=this._resettedAxisInfo.x.min&&this.components.xAxis.getPlotMax()>=this._resettedAxisInfo.x.max&&this.components.yAxis.getPlotMin()<=this._resettedAxisInfo.y.min&&this.components.yAxis.getPlotMax()>=this._resettedAxisInfo.y.max?this.$scope.showMiniMap=!1:this.$scope.showMiniMap=!0,this.$scope.$emit("onResizeMiniMap",this.$scope.miniMapStyle,{width:daWidth,height:daHeight})}function setColorMapLight(){var blueColorScheme={colors:[{color:"rgba(111,153,197,1.0)"},{color:"rgba(29,51,72,1.0)"}],limits:[{value:.5,gradient:!0}],min:0,max:1};this._colorMapLight=new ColorMapLight(blueColorScheme),this.components.dataArea&&this.components.dataArea.setColorMapLight(this._colorMapLight),this.components.colorLegendLight&&this.components.colorLegendLight.setColorMapLight(this._colorMapLight)}function updateMiniMap(){this._resettedAxisInfo.x.min=this.components.xAxis.getPlotMin(),this._resettedAxisInfo.x.max=this.components.xAxis.getPlotMax(),this._resettedAxisInfo.y.min=this.components.yAxis.getPlotMin(),this._resettedAxisInfo.y.max=this.components.yAxis.getPlotMax(),this.$scope.$emit("onUpdateMiniMap",this._resettedAxisInfo),this.$scope.showMiniMap=!1,this._needUpdateMiniMap=!1}var ScatterPlot,namespace=".scatterplot",MaxNrScatter=1e3,DefaultResolutionLevel=6,MaxResolutionLevel=8;return ScatterPlot=AxisChart.extend("ScatterPlot",{init:function($scope,$element,options,backendApi){var panZoomHelper,continuousPanHelper,self=this;options=$.extend(!0,options||{},{providers:{colorMap:{clazz:ColorMap,colorBy:"dimension",autoMode:"primary"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",clazz:ScatterArea,showFlag:ChartComponent.prototype.ShowFlags.SPARK},grid:{showFlag:ChartComponent.prototype.ShowFlags.XSMALL},colorLegendLight:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:ChartComponent.prototype.ShowFlags.MEDIUM},xAxis:{showFlag:ChartComponent.prototype.ShowFlags.SMALL},yAxis:{showFlag:ChartComponent.prototype.ShowFlags.SMALL},xAxisTitle:{show:!1},refLineLabelsX:{show:!0,dock:"top",order:3,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:RefLineLabels},refLineLabelsY:{show:!0,dock:"right",order:3,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:RefLineLabels}}}),this._resettedAxisInfo={x:{min:0,max:0},y:{min:0,max:0}},this._axisInfo={x:{min:null,max:null},y:{min:null,max:null}},this._prevTranslateInfo={x:0,y:0},this._translateInfo={x:0,y:0},this._super($scope,$element,options,backendApi),this.backendApi.setCacheOptions({enabled:!1}),this._numberFormatter=new NumberFormatter,this._defaultPattern="#.#A",this.components.xAxisTitle.hideComponent(),this._showLegend=!1,this.components.dataArea.setYAxis(this.components.yAxis),this.components.dataArea.setXAxis(this.components.xAxis),this.components.yAxis.setShowExplicitMinMax(!1),this.components.xAxis.setShowExplicitMinMax(!1),this._allowTransitions=State.view!==State.Views.story,this.components.yAxis.setUseTransition(this._allowTransitions),this.components.xAxis.setUseTransition(this._allowTransitions),this.components.grid.setAxes(this.components.xAxis,this.components.yAxis),this._transformMatrix=new Matrix;var legendProvider=this.providers.colorMap.getLegendDataProvider();legendProvider.setLegendMarker("circle"),setColorMapLight.call(this),$scope.colorMap=this._colorMapLight,this.components.xAxis.getTransitionHelper().setTransitionTime(700),this.components.yAxis.getTransitionHelper().setTransitionTime(700),this.components.dataArea.getTransitionHelper().setTransitionTime(700),this._changeWatchers.push(Binding.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(Binding.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._debouncedUpdateLayout=EventUtils.debounce(function(){var requestNewDataOnInteraction=self._data.qHyperCube.qSize.qcy>MaxNrScatter&&!this.backendApi.isSnapshot,xMin=self.components.xAxis.getPlotMin(),xMax=self.components.xAxis.getPlotMax(),yMin=self.components.yAxis.getPlotMin(),yMax=self.components.yAxis.getPlotMax(),zoomLevel=Math.floor(Math.sqrt((self._data.qHyperCube.qMeasureInfo[1].qMax-self._data.qHyperCube.qMeasureInfo[1].qMin)/(yMax-yMin)));requestNewDataOnInteraction?(self._dataUpdatedOnPanOrZoom=!0,getBinnedData.call(this,xMin,yMax,xMax-xMin,yMax-yMin,zoomLevel).then(function(){preResize.call(self),self._paint()})):(preResize.call(self),self._paint().then(function(){self.components.xAxis.setUseTransition(!0),self.components.yAxis.setUseTransition(!0)}))},400),panZoomHelper=function(x,y,z){if(!State.isInEditMode()){var startX=self.components.dataArea.rect.width/2,startY=self.components.dataArea.rect.height/2;startPanZoom.apply(self,[startX,startY]),panZoom.apply(self,[x,y,z,{deltaX:x-startX,deltaY:y-startY}]),endPanZoom.apply(self)}},continuousPanHelper=function(data,mode){if(!State.isInEditMode())switch(mode){case"start":startPanZoom.apply(self,[data.x,data.y]);break;case"move":panZoom.apply(self,[data.x,data.y,1,{deltaX:data.x-self._panX,deltaY:data.y-self._panY}]);break;case"end":endPanZoom.apply(self)}},this._zoomScale=1,this.onNavigationPressed=$scope.$on("navigationPressed",function(e,arg,data){switch(e.preventDefault(),arg){case"resetZoom":resetZoom.call(self);break;case"zoomIn":panZoomHelper(self.components.dataArea.rect.width/2,self.components.dataArea.rect.height/2,self._zoomScale+.2);break;case"zoomOut":panZoomHelper(self.components.dataArea.rect.width/2,self.components.dataArea.rect.height/2,self._zoomScale-.2);break;case"navUp":panZoomHelper(self.components.dataArea.rect.width/2,self.components.dataArea.rect.height/2+30,0);break;case"navDown":panZoomHelper(self.components.dataArea.rect.width/2,self.components.dataArea.rect.height/2-30,0);break;case"navLeft":panZoomHelper(self.components.dataArea.rect.width/2+30,self.components.dataArea.rect.height/2,0);break;case"navRight":panZoomHelper(self.components.dataArea.rect.width/2-30,self.components.dataArea.rect.height/2,0);break;case"jumpTo":panZoomHelper(data.x,data.y);break;case"startAt":continuousPanHelper(data,"start");break;case"moveTo":continuousPanHelper(data,"move");break;case"endAt":continuousPanHelper(data,"end")}}),this.$scope.navigationDisabled=!0},initSelections:function(){var self=this,dataArea=this.components.dataArea;this.selections._disableSelections=this.options._disableSelections,this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.Pan.bind(this.onPan.bind(this)),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("x",this.components.xAxis),this.selections.types.range.setComponent("y",this.components.yAxis),this.selections.Activated.bind(function(){dataArea.getIsReduced()&&dataArea.copyHeatMap(),self._inSelectionMode=!0,self.onSelection.Activated.call(self)}),this.selections.Deactivated.bind(function(){self._inSelectionMode=!1,self.onSelection.Deactivated.call(self)}),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(self.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)),this.selections.ResetSelections.bind(function(){dataArea.getIsReduced()&&dataArea.clearSelection()}))},Select:function(shapes,toggle,dimension,pivotType){var qMatrix,i,qRow,selectedElemNumberWithRowIndex=[];for(qMatrix=this._data.qHyperCube.qDataPages[0].qMatrix,i=0;i<this._selectedRows.length;i++)qRow=qMatrix[this._selectedRows[i]],void 0!==qRow&&(selectedElemNumberWithRowIndex[selectedElemNumberWithRowIndex.length]=qRow[0].qElemNumber);this._selectedElemNumbers=this._selectedElemNumbersWithoutRowIndex?this._selectedElemNumbersWithoutRowIndex.concat(selectedElemNumberWithRowIndex):selectedElemNumberWithRowIndex,this._data.qHyperCube.qSize.qcy>MaxNrScatter?this._selectedElemNumbers&&this._selectedElemNumbers.length?this.backendApi.selectValues(0,this._selectedElemNumbers,!1):this.backendApi.clearSelections():this.onSelection.Select.apply(this,[shapes,toggle,dimension,pivotType])},Clear:function(){this.onSelection.Clear.call(this),this._selectedElemNumbers=void 0,this.components.dataArea.getIsReduced()&&this.components.dataArea.clearSelection()},Confirm:function(){this.onSelection.Confirm.call(this),this._selectedElemNumbers=void 0},_postResize:function(){this._super(),updateLegendPosition.apply(this,[this.components.colorLegendLight,this._data])},updateLegend:function(){this.components.colorLegend&&(this._super(),updateLegendPosition.apply(this,[this.components.colorLegendLight,this._data]))},_paint:function(){var self=this;return this._super().then(function(o){return o&&o.invalid?void 0:self._ready.then(function(){var key,dfds=[];this.components.dataArea&&(this._offset=$(this.components.dataArea.container).offset()),this.layout();for(key in this.components)dfds.push(this.components[key].invalidateDisplay());return updateNavigation.call(this),Deferred.all(dfds)}.bind(this))}.bind(this))},onPan:function(when,e,data){var self=this;switch(when){case"update":self._panning||(self._panning=!0,startPanZoom.apply(self,[data.swipe.startPoint.x,data.swipe.startPoint.y])),self._panning&&panZoom.apply(self,[data.swipe.currentPoint.x,data.swipe.currentPoint.y,1,data.swipe]);break;case"end":endPanZoom.apply(self),self._panning=!1}},on:function(){var lastPanX,lastPanY,lastScale,self=this;if(!this._on){if(this.supressDotRendering)return void this.selections.off();var onWheelFn=function(e){var event=EventUtils.getMouseWheelData(e.originalEvent);startPanZoom.apply(self,[event.x-self._offset.left,event.y-self._offset.top]),panZoom.apply(self,[event.x-self._offset.left,event.y-self._offset.top,event.delta>0?1.2:.8]),endPanZoom.apply(self)};EventUtils.throttle(onWheelFn,20),$(this.components.dataArea.container).on("mousewheel"+namespace+" DOMMouseScroll"+namespace,function(e){onWheelFn(e),e.preventDefault()}),Touche(this.components.dataArea.container).wheelswipe({id:namespace,start:function(e){lastPanX=self._panX=e.pageX,lastPanY=self._panY=e.pageY},update:function(e){if(!self._panning&&(Math.abs(e.pageX-self._panX)>3||Math.abs(e.pageX-self._panX)>3)&&(self._panning=!0,startPanZoom.apply(self,[self._panX,self._panY])),self._panning){var swipeData={curDeltaX:e.pageX-lastPanX,curDeltaY:e.pageY-lastPanY};panZoom.apply(self,[e.pageX,e.pageY,1,swipeData]),lastPanX=e.pageX,lastPanY=e.pageY}},end:function(){self._panning||resetZoom.call(self),endPanZoom.apply(self),self._panning=!1}});var startDistance;Touche(this.components.dataArea.container).swipe({id:namespace,options:{touches:2},start:function(e,data){var xdist=data.points[1].x-data.points[0].x,ydist=data.points[1].y-data.points[0].y;lastScale=1,startDistance=Math.sqrt(xdist*xdist+ydist*ydist)},update:function(e,data){var x,y,centerPoint={x:(data.points[0].x+data.points[1].x)/2,y:(data.points[0].y+data.points[1].y)/2},xdist=data.points[1].x-data.points[0].x,ydist=data.points[1].y-data.points[0].y,currentDistance=Math.sqrt(xdist*xdist+ydist*ydist),scale=currentDistance/startDistance;self._panning||(self._panning=!0),x=centerPoint.x-self._offset.left,y=centerPoint.y-self._offset.top,startPanZoom.apply(self,[x,y]),panZoom.apply(self,[x,y,1+(scale-lastScale)]),lastScale=scale,Touche.preventGestures(this.gestureHandler)},end:function(){self._panning=!1,endPanZoom.apply(self)}}).tap({id:this.eventNS,options:{touches:2,preventDefault:!1},end:function(){self._isReducedMode&&Touche.preventGestures(this.gestureHandler)}}),Touche(this.components.dataArea.container).tap({id:namespace,options:{touches:3},end:function(){resetZoom.call(self),Touche.preventGestures(this.gestureHandler)}}),Touche(this.container).longtap({id:namespace}),this._super(),this.$scope.navigationDisabled=!1,this._on=!0}},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",namespace),Touche(this.container).off("*",namespace),$(this.components.dataArea.container).off(namespace),$(this.container).off(namespace),this._super(),this._on=!1)},isValid:function(data){return this._super(data)&&data.qHyperCube.qMeasureInfo.length>=2&&!this.supressChartRendering},prePaint:function(data){this._super(),this.$scope.dataAttributes.limitedData=data.qHyperCube.qSize.qcy>MaxNrScatter,this.$scope.dataAttributes.reduceDataDisc=this.$scope.dataAttributes.limitedData,ChartUtils.applyDisclaimerAttributes({title:!1,bottom:!0,overlay:!1,explicitLimitedData:this.$scope.dataAttributes.limitedData},this.$scope.dataAttributes,this.$element,this.$scope,State,data),this.$scope.dataAttributes.noDataExist||(this.$scope.dataAttributes.onlyNanData=data.qHyperCube.qMeasureInfo.slice(0,2).some(function(measure){return measure.qMax<measure.qMin||"NaN"===measure.qMax})),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist,this.supressDotRendering=this.supressChartRendering},toggleLasso:function(enabled){enabled&&this._isReducedMode||this._super(enabled)},isLassoDisabled:function(){return this._isReducedMode},isLassoing:function(){return this._toggleLasso&&!this._isReducedMode},_updateHyperCube:function(data){this._allowTransitions=State.view!==State.Views.story;var limit,span,max,min,storedData;this._dataUpdatedOnPanOrZoom||(this._defaultZoomPan=!0),this._transformMatrix.identity(),this._currentPanX=0,this.components.dataArea.setData(data),this.providers.colorMap.setData(data),this.components.colorLegend.setData(data),this.components.colorLegendLight&&this.components.colorLegendLight.setData(data),storedData=this.getSnapshotStoredChartData(),min=data.qHyperCube.qMeasureInfo[0].qMin,max=data.qHyperCube.qMeasureInfo[0].qMax,span=max-min,limit=min-10*(span>0?span:Math.abs(max)/20),["min","minMax"].contains(data.xAxis.minMax&&!data.xAxis.autoMinMax)?this._xZoomMin=data.xAxis.min<limit?data.xAxis.min:limit:this._xZoomMin=limit,limit=max+10*(span>0?span:Math.abs(max)/20),["max","minMax"].contains(data.xAxis.minMax&&!data.xAxis.autoMinMax)?this._xZoomMax=data.xAxis.max>limit?data.xAxis.max:limit:void 0!==data.xAxis.min?this._xZoomMax=data.xAxis.min>limit?data.xAxis.min+limit:limit:this._xZoomMax=limit,min=data.qHyperCube.qMeasureInfo[1].qMin,max=data.qHyperCube.qMeasureInfo[1].qMax,span=max-min,limit=min-10*(span>0?span:Math.abs(max)/20),["min","minMax"].contains(data.yAxis.minMax&&!data.yAxis.autoMinMax)?this._yZoomMin=data.yAxis.min<limit?data.yAxis.min:limit:this._yZoomMin=limit,limit=max+10*(span>0?span:Math.abs(max)/20),["max","minMax"].contains(data.yAxis.minMax&&!data.yAxis.autoMinMax)?this._yZoomMax=data.yAxis.max>limit?data.yAxis.max:limit:void 0!==data.yAxis.min?this._yZoomMax=data.yAxis.min>limit?data.yAxis.min+Math.abs(limit):limit:this._yZoomMax=limit,this._readStoredData&&storedData?(this.components.xAxis.setPlotMin(storedData.xAxisMin),this.components.xAxis.setPlotMax(storedData.xAxisMax),this.components.yAxis.setPlotMin(storedData.yAxisMin),this.components.yAxis.setPlotMax(storedData.yAxisMax)):this.options.viewState&&(this.components.xAxis.setPlotMin(this.options.viewState.xAxisMin),this.components.xAxis.setPlotMax(this.options.viewState.xAxisMax),this.components.yAxis.setPlotMin(this.options.viewState.yAxisMin),this.components.yAxis.setPlotMax(this.options.viewState.yAxisMax)),data.legend&&this.components.colorLegend[(this.supressDotRendering||!data.legend.auto&&!data.legend.show?"hide":"show")+"Component"](),this._zoomScale=1},_updateData:function(data){var options,self=this;this._data=data;var selectedRows=getSelectedRows.call(this);if(this._fetchedData)options={axes:{xAxis:{component:this.components.xAxis,data:data.xAxis,title:data.qHyperCube.qMeasureInfo[0].qFallbackTitle,dataIndices:[0]},yAxis:{component:this.components.yAxis,data:data.yAxis,title:data.qHyperCube.qMeasureInfo[1].qFallbackTitle,dataIndices:[1]}},refLineLabels:{x:{axis:this.components.xAxis,data:data.refLine?data.refLine.refLinesX:"",component:this.components.refLineLabelsX},y:{axis:this.components.yAxis,data:data.refLine?data.refLine.refLinesY:"",component:this.components.refLineLabelsY}},refLines:{component:this.components.refLines}},this._super(data,options),selectedRows&&(this._selectedRows=selectedRows),this._updateHyperCube(data),this._fetchedData=!1;else if(this._dataUpdatedOnPanOrZoom=!1,this._isBigData=data.qHyperCube.isBigData=data.qHyperCube.qSize.qcy>MaxNrScatter,this._needUpdateMiniMap=!0,this._isBigData){var xMin=data.xAxis.autoMinMax||"min"!==data.xAxis.minMax&&"minMax"!==data.xAxis.minMax?data.qHyperCube.qMeasureInfo[0].qMin:data.xAxis.min,xMax=data.xAxis.autoMinMax||"max"!==data.xAxis.minMax&&"minMax"!==data.xAxis.minMax?data.qHyperCube.qMeasureInfo[0].qMax:data.xAxis.max,yMin=data.yAxis.autoMinMax||"min"!==data.yAxis.minMax&&"minMax"!==data.yAxis.minMax?data.qHyperCube.qMeasureInfo[1].qMin:data.yAxis.min,yMax=data.yAxis.autoMinMax||"max"!==data.yAxis.minMax&&"minMax"!==data.yAxis.minMax?data.qHyperCube.qMeasureInfo[1].qMax:data.yAxis.max;this.$scope.throbberApi.show(),getBinnedData.call(this,xMin,yMax,xMax-xMin,yMax-yMin)}else this._dataDfd=Deferred(),this._ready=this._dataDfd.promise,this._isReducedMode=!1,data.qHyperCube.isReduced=!1,this._selectedElemNumbers=void 0,this._selectedElemNumbersWithoutRowIndex=void 0,this.backendApi.getData([{qTop:0,qLeft:0,qWidth:data.qHyperCube.qSize.qcx,qHeight:1e3}]).then(function(dataPages){self._data.qHyperCube.qDataPages=dataPages,self._fetchedData=!0,self.components.dataArea.setIsBigData(!1),self.components.dataArea.setIsReduced(!1),self.prePaint(self._data),Deferred.all([self._updateData(self._data)]).then(function(){self._dataDfd.resolve()})})},updateDataArea:function(data,options){this._super(data,options),data.qHyperCube.qMeasureInfo.length>2&&data.dataPoint.rangeBubbleSizes?data.dataPoint.rangeBubbleSizes.length>0&&(this.components.dataArea.setMinDotSize(data.dataPoint.rangeBubbleSizes[0]),data.dataPoint.rangeBubbleSizes.length>1&&this.components.dataArea.setMaxDotSize(data.dataPoint.rangeBubbleSizes[1])):data.dataPoint.bubbleSizes&&this.components.dataArea.setMinDotSize(data.dataPoint.bubbleSizes),null!==data.labels.mode&&this.components.dataArea.setLabelMode(data.labels.mode),this.components.dataArea.setRenderData(!this.supressDotRendering),this.supressDotRendering?(this.selections.off(),this._on&&this.off()):!this.supressDotRendering&&this.isDataSelectable(data)&&(this.selections.on(),this._on||State.isInEditMode()||this.on())},updateAxis:function(data,options){if(!this._dataUpdatedOnPanOrZoom){this._super(data,options);var axisObject,axis,index,key,min,max,emin,emax,dRange=0;for(key in options.axes)axisObject=options.axes[key],index=axisObject.dataIndices[0],axis=axisObject.component,min=data.qHyperCube.qMeasureInfo[index].qMin,max=data.qHyperCube.qMeasureInfo[index].qMax,emin=!axisObject.data.autoMinMax&&["min","minMax"].contains(axisObject.data.minMax)?Number(axisObject.data.min):null,emax=!axisObject.data.autoMinMax&&["max","minMax"].contains(axisObject.data.minMax)?Number(axisObject.data.max):null,min>max?(max=10,min=-10):min===max&&0===max||isNaN(min)&&isNaN(max)?(max=10,min=-10):dRange=Math.abs(max!==min?.02*(max-min):.1*max),this.setAxisDataRange(axis,Math.max(min,max+dRange),min-dRange,emax,emin,dRange)}},updateRefLines:function(data,options){this._super(data,options);for(var key in options.refLineLabels)options.refLineLabels[key].component.setLabelMargin(10)},toggleCacheItem:function(item){this.components.dataArea.toggleCacheItem(item),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},getSnapshotData:function(snapshotLayout,left,top,width,height,zoomLevel){var queryLevel=this._data&&this._data.compressionResolution?this._data.compressionResolution:DefaultResolutionLevel,maxNrBins=1e3,heatMapLevelZoomChange=zoomLevel?zoomLevel-1:0;return this.backendApi.getHyperCubeBinnedData([{qTop:0,qLeft:0,qWidth:snapshotLayout.qHyperCube.qSize.qcx,qHeight:snapshotLayout.qHyperCube.qSize.qcy}],[{qLeft:left,qTop:top,qWidth:width,qHeight:height}],maxNrBins,queryLevel+heatMapLevelZoomChange).then(function(dataPages){snapshotLayout.dataPages=dataPages,snapshotLayout.foo="custom"})},setSnapshotData:function(snapshotLayout){if(this._super(snapshotLayout),!(this._isReducedMode||snapshotLayout.qHyperCube.qSize.qcy>MaxNrScatter))return Deferred.resolve();var xMin=this.components.xAxis.getPlotMin(),xMax=this.components.xAxis.getPlotMax(),yMin=this.components.yAxis.getPlotMin(),yMax=this.components.yAxis.getPlotMax(),zoomLevel=Math.floor(Math.sqrt((this._data.qHyperCube.qMeasureInfo[1].qMax-this._data.qHyperCube.qMeasureInfo[1].qMin)/(yMax-yMin)));return this.getSnapshotData(snapshotLayout,xMin,yMax,xMax-xMin,yMax-yMin,zoomLevel)},getSnapshotChartData:function(){return $.extend(!0,this._super()||{},{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()})},getViewState:function(){return{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()}},clear:function(){this._super(),this.$scope.navigationVisible=!1},destroy:function(){this._super(),this.onNavigationPressed(),this._destroyed=!0}}),{type:"scatterplot",BackendApi:HypercubeApi,template:template,View:ScatterPlot,definition:scatterplotPropertiesDefinition,softDefinition:softOptions,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0}},data:scatterplotData,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},importProperties:objectConversion.colorChart.importProperties.bind(objectConversion),exportProperties:objectConversion.colorChart.exportProperties.bind(objectConversion)}}),define("extensions.qliktech/linechart/line-objects-model",["core.utils/class","util"],function(Class,util){var LineObjectsModel,lineType={LINE:"line",AREA:"area",STACKED:"stackedArea"},nullMode={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return LineObjectsModel=Class.extend("LineObjectsModel",{init:function(){this._lineObjectSettings=[]},update:function(polys,settings){this._updateLineObjectsSettings(polys,util.extend({selections:this._getSelected(polys,settings.numDimensions)},settings))},getLineObjectsSettings:function(){return this._lineObjectSettings},getPointsOutOfRange:function(){return this._outOfRange.points},_updateLineObjectsSettings:function(polysData,settings){var i,polyData,minorAxis,minorAxisSettings,colorSettings,points,lineObjectSettings,num=polysData?polysData.length:0;for(this._outOfRange={up:{},down:{},points:[]},this._lineObjectSettings=[],i=0;num>i;i++)polyData=polysData[i],minorAxis=settings.minorAxes[settings.measureToAxisIndex[polyData.measureIdx]],minorAxisSettings=settings.axesSettings[settings.measureToAxisIndex[polyData.measureIdx]],colorSettings=this._getColorSettings(settings.colorMap,minorAxisSettings),colorSettings.interpolatePointColors=colorSettings.isExpression,points=[],this._updateLinePoints(polysData[i].points,points,this._outOfRange,util.extend({majorAxis:settings.majorAxis,minorAxis:minorAxis,measureIdx:polyData.measureIdx,axisSettings:minorAxisSettings,isLineSelected:settings.selections.lines.indexOf(i)>=0},settings)),lineObjectSettings=util.extend({info:polysData.info,colors:colorSettings,clippings:this._getClippings(minorAxis,settings.rect),idx:polysData.idx,points:points},settings),this._lineObjectSettings.push(lineObjectSettings)},_updateLinePoints:function(pointsData,pointsContainer,outOfRangeContainers,data){var pData,j,idx,point,circle,nextX,prevX,nextIdx,selected,color,pointToRender,linePositionRounding=data.style.line.width%2===0?0:.5,len=pointsData?pointsData.length:0,isOnePointLine=1===len;for(nextX=data.majorAxis.getPositionOfValue(0,0),prevX=0,j=0;len>j;j++)if(pointsData[j]&&(pData=pointsData[j],idx=pData.idx,point={x:data.majorAxis.getPositionOfValue(idx,0),y:data.minorAxis.zeroPos},circle=pData.cacheCircle,circle.cx=point.x,circle.cy=point.y,!isOnePointLine||!(point.x<0||point.x>data.rect.width))){
if(pData.isNaN&&!pData.hasRightNeighbour&&"number"!=typeof pData.nearestRightNeighbour)break;if(pData.isNaN&&data.lineType===lineType.STACKED&&data.nullMode===nullMode.CONNECT&&pData.isInterpolationOffset!==!0);else if(pData.isNaN&&pData.isInterpolationOffset!==!0){nextX=data.majorAxis.getPositionOfValue(pData.hasRightNeighbour?j+1:pData.nearestRightNeighbour,0),pointsContainer.push(!1);continue}if(nextIdx=pData.hasRightNeighbour?pointsData[j+1].idx:pData.nearestRightNeighbour,nextX="undefined"!=typeof nextIdx?data.majorAxis.getPositionOfValue(nextIdx,0):NaN,0>nextX)pointsContainer.push(!1);else if(prevX>data.rect.width)pointsContainer.push(!1);else{selected=pData.cacheItem.selected;var selectedIndirectly=!selected&&data.isLineSelected&&data.selections.synqronize&&this._isSelectedIndirectly(idx,data.selections.lines,data.selections.points),yy=data.minorAxis.getPositionOfValue(pData.aggregated.end);point.y=Math.floor(yy)-linePositionRounding,point.y<-1e5&&(point.y=-1e5),point.y>data.rect.height+1e5&&(point.y=data.rect.height+1e5),circle.r=Math.max(data.style.dataPoints.size.normal/2,8),circle.cy=Math.max(data.axisSettings.topCutoff,Math.min(data.axisSettings.bottomCutoff,point.y)),pData.isNaN||(prevX=point.x),color=data.colorMap.getColor(pData.cacheItem.parent?[pData.cacheItem.parent.id,pData.cacheItem.id]:pData.cacheItem.id,pData.aggregated.end,data.measureIdx,pData.rowIndex).toRGBA(),pointToRender={size:selected?data.style.dataPoints.size.selected:data.style.dataPoints.size.normal,selected:selected||selectedIndirectly,selectedIndirectly:selectedIndirectly,text:pData.cacheItem.getDimensions()[0],measureIdx:pData.measureIdx,label:pData.label,value:pData.aggregated.end,isNaN:pData.isNaN,isInterpolationOffset:pData.isInterpolationOffset,color:color,outOfRangeUp:yy<data.axisSettings.topCutoff,outOfRangeDown:yy>data.axisSettings.bottomCutoff,outOfDimensionBounds:point.x<0||point.x>data.rect.width,outOfBounds:point.x<0||point.x>data.rect.width||pData.aggregated.end>data.axisSettings.plotMax||pData.aggregated.end<data.axisSettings.plotMin,dataIndex:idx,isSingle:!pData.hasLeftNeighbour&&!pData.hasRightNeighbour&&data.nullMode!==nullMode.CONNECT||isOnePointLine,x:point.x,y:point.y,y1:0===pData.aggregated.start?data.axisSettings.areaStartBase:data.minorAxis.getPositionOfValue(pData.aggregated.start),cacheItem:pData.cacheItem},(pointToRender.outOfRangeUp||pointToRender.outOfRangeDown)&&(pointToRender.outOfRangeUp&&!outOfRangeContainers.up[pointToRender.x]?(outOfRangeContainers.points.push(pointToRender),outOfRangeContainers.up[pointToRender.x]=!0):pointToRender.outOfRangeDown&&!outOfRangeContainers.down[pointToRender.x]&&(outOfRangeContainers.points.push(pointToRender),outOfRangeContainers.down[pointToRender.x]=!0)),pointsContainer[idx]=pointToRender}}},_getSelected:function(polysData,numDimensions){var i,j,polyData,selectedLines=[],selectedPoints=[],num=polysData.length;if(numDimensions)for(i=0;num>i;i++)for(polyData=polysData[i].points,j=0;j<polyData.length;j++)polyData[j]&&polyData[j].cacheItem.selected&&(-1===selectedLines.indexOf(i)?(selectedLines.push(i),selectedPoints[i]=[polyData[j].idx]):selectedPoints[i].push(polyData[j].idx));return{lines:selectedLines,points:selectedPoints,synqronize:selectedLines.length>1}},_isSelectedIndirectly:function(idx,selectedLines,selectedPoints){var k,p,selPoints,len=selectedLines?selectedLines.length:0,isSelected=!1;for(k=0;len>k;k++)for(selPoints=selectedPoints[selectedLines[k]],p=0;p<selPoints.length;p++)if(idx===selPoints[p]){isSelected=!0;break}return isSelected},_getMeasureGradient:function(axisDetails,colorMap){var plotMin=axisDetails.plotMin,plotRange=axisDetails.plotRange,measureGradient={gradient:{colors:[],limits:[],x0:0,x1:0,y0:axisDetails.posMin,y1:axisDetails.posMax}};return colorMap.getColorMapping().slice().reverse().forEach(function(obj){measureGradient.gradient.colors.push(obj.grad[0].toRGBA()),measureGradient.gradient.colors.push(obj.grad[1].toRGBA()),measureGradient.gradient.limits.push(Math.min(1,Math.max(0,(obj.id[0]-plotMin)/plotRange))),measureGradient.gradient.limits.push(Math.min(1,Math.max(0,(obj.id[1]-plotMin)/plotRange)))}),measureGradient},_getClippings:function(axis,rect){var axisPadding=axis.getPadding(),topCutoff=axisPadding.top-1,bottomCutoff=axis.rect.height-axisPadding.bottom;return{areaClip:{x:0,y:topCutoff,width:rect.width,height:bottomCutoff-topCutoff-.5},lineClip:{x:0,y:topCutoff,width:rect.width,height:bottomCutoff-topCutoff-.5}}},_getColorSettings:function(colorMap,axisDetails){var measureGradient,areaAlpha=.3;return colorMap.mode&&colorMap.mode===colorMap.MEASURE&&!isNaN(axisDetails.posMin)&&(areaAlpha=.6,measureGradient=this._getMeasureGradient(axisDetails,colorMap)),{isExpression:colorMap.mode&&colorMap.mode===colorMap.EXPRESSION,areaAlpha:areaAlpha,gradient:measureGradient}}})}),define("extensions.qliktech/linechart/layers/layer",["core.utils/class","objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(Class,Renderer,Deferred){var Layer;return Layer=Class.extend("layer",{init:function(container,options){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new Renderer(this.wrapper,options),this.minorAxis=null,this.majorAxis=null,container.appendChild(this.wrapper)},update:function(){},release:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.renderer.release(),this.minorAxis=null,this.majorAxis=null},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},render:function(){return"none"!==this.wrapper.style.display?this.renderer.render():Deferred.resolve()},clear:function(){this.renderer.clear()}})}),define("extensions.qliktech/linechart/layers/shapes/points",["objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect"],function(Container,Circle,Polygon,Rect){function createShape(type){switch(type){case"diamond":case"triangle":return new Polygon;case"circle":return new Circle;case"line":return new Rect;default:return new Rect}}function updateShape(shape,x,y,size,type){var s=size;switch(type){case"circle":shape.set(x,y,.5*s);break;case"diamond":shape.set([{x:x,y:y-s/2},{x:x-s/2,y:y},{x:x,y:y+s/2},{x:x+s/2,y:y}]);break;case"triangle":shape.set([{x:x,y:y-s/2},{x:x-s/2,y:y+s/2},{x:x+s/2,y:y+s/2}]);break;default:s=size,shape.set(x-s/2,y-s/2,s,s)}}var Points;return Points=Container.extend("Points",{init:function(symbol){this._super(),this._symbol=symbol||"circle"},update:function(data){var shape,i,p,points=data.points?data.points:[],validPoints=0,hasVisiblePoints=!1,num=points?points.length:0;for(i=0;num>i;i++)p=points[i],!p||p.outOfDimensionBounds||p.isNaN||(shape=this._children[validPoints++],shape||(shape=createShape(this._symbol),this.addChild(shape)),updateShape(shape,p.x,p.y,p.size,this._symbol),shape.fill=p.selectedIndirectly?"white":p.color,shape.stroke=p.selectedIndirectly?p.color:p.selected?"white":!1,shape.opacity=p.selected||p.selectedIndirectly?1:data.globalAlpha,shape.strokeWidth=1.5,shape.visible=!p.outOfBounds&&!p.isNaN&&(data.showDataPoints||p.isSingle||p.keep||p.selected),shape.visible&&!hasVisiblePoints&&(hasVisiblePoints=shape["true"]),shape.data.outOfBounds=p.outOfBounds,shape.data.value=p.value,shape.data.label=p.label,shape.data.dataIndex=p.dataIndex,shape.data.text=p.text);return validPoints<this._children.length&&this.removeChildren(this._children.slice(validPoints-this._children.length)),this.visible=hasVisiblePoints,this}})}),define("extensions.qliktech/linechart/layers/shapes/poly-line",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(Container,Polygon,Line){"use strict";function applySelection(lineSegments){var i,newSegments=[];for(i=0;i<lineSegments.length;i++)newSegments=newSegments.concat(getSegments(lineSegments[i]));return newSegments}function getSegments(segment){var poly,leftPoints,middlePoints,rightPoints,j,startIndex,endIndex,segments=[],points=segment._polygons[0].points;if(!points||points.length<2)return segments;for(segment.data.selected=points[0].selected&&points[1].selected,startIndex=null,endIndex=points.length-1,j=1;j<points.length;j++)if(points[j-1].selected&&points[j].selected){startIndex=j-1;break}if(null!==startIndex){for(j=startIndex;j<points.length;j++)if(!points[j].selected){endIndex=j-1;break}leftPoints=points.slice(0,startIndex+1),middlePoints=points.slice(startIndex,endIndex+1),rightPoints=points.slice(endIndex),leftPoints&&leftPoints.length>1&&(poly=createPolygon(leftPoints,segment),segments.push(poly)),middlePoints&&middlePoints.length>1&&(poly=createPolygon(middlePoints,segment),poly.data.selected=!0,segments.push(poly)),rightPoints&&rightPoints.length>1&&(poly=createPolygon(rightPoints,segment),segments=segments.concat(getSegments(poly)))}else segments.push(segment);return segments}function createPolygon(points,source){var p=new Polygon(points);return p.opacity=source.opacity,p.close=!1,p.stroke=source.stroke,p.strokeWidth=source.strokeWidth,p.lineJoin=source.lineJoin,p.lineCap=source.lineCap,p}function getPolyLines(data,points,mode,gradient){var i,polyLine,num,segments,point,polyPoints=[];for(num=points?points.length:0,segments=[],i=0;num>i;i++)point=points[i],!point||point.isNaN&&point.isInterpolationOffset!==!0?mode===nullMode.GAP&&polyLine&&polyPoints.length&&(polyLine.set(polyPoints),segments.push(polyLine),polyLine=null,polyPoints=[]):(polyLine||(polyLine=new Polygon,polyLine.close=!1,polyLine.stroke=gradient||point.color||"#333333",polyLine.lineJoin="round",polyLine.lineCap="round",polyLine.opacity=1,polyPoints=[]),polyPoints.push({x:point.x,y:point.y,selected:point.selected,dataIndex:point.dataIndex,y_:point.y1}));for(polyLine&&polyPoints.length>1&&(polyLine.set(polyPoints),segments.push(polyLine)),segments=applySelection(segments),num=segments.length,i=0;num>i;i++)segments[i].strokeWidth=data.style.line.width*(segments[i].data.selected?2:1),segments[i].opacity=segments[i].data.selected?1:data.globalAlpha;return segments}function getLines(data,points,mode){var i,point,prevPoint,numPoints=points?points.length:0,lines=[],line=null;for(i=0;numPoints>i;i++)point=points[i],!point||point.isNaN&&point.isInterpolationOffset!==!0?mode===nullMode.GAP&&(prevPoint=null):prevPoint?(line=new Line(prevPoint.x,prevPoint.y,point.x,point.y),line.data.selected=prevPoint.selected&&point.selected,line.data.y1_=prevPoint.y1,line.data.y2_=point.y1,line.stroke={gradient:{x0:prevPoint.x,y0:prevPoint.y,x1:point.x,y1:point.y,limits:[0,1],colors:[prevPoint.color||"#333333",point.color||"#333333"]}},line.opacity=line.data.selected?1:data.globalAlpha,line.strokeWidth=data.style.line.width*(line.data.selected?2:1),lines.push(line),prevPoint=point):prevPoint=point;return lines}var PartialLine,nullMode={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return PartialLine=Container.extend("PolyLine",{init:function(){this._super(),this.lineJoin="round",this.lineCap="round"},update:function(data){this.clip=data.clippings.lineClip,this.removeChildren(),data.colors.interpolatePointColors?this.addChildren(getLines.call(this,data,data.points,data.nullMode)):this.addChildren(getPolyLines.call(this,data,data.points,data.nullMode,data.colors.gradient))}})}),define("extensions.qliktech/linechart/layers/shapes/poly-area",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(Container,Polygon,Line){function pointMapping(p){return{x:p.x,y:p.y_}}var PartialArea;return PartialArea=Container.extend("PolyArea",{init:function(){this._super()},update:function(data,segments){var i,polygon,polygons,numSegments,polyPoints;for(this.clip=data.clippings.areaClip,this.removeChildren(),numSegments=segments?segments.length:0,polygons=[],i=0;numSegments>i;i++)segments[i]instanceof Polygon?(polyPoints=segments[i]._polygons[0].points,polygon=new Polygon(polyPoints.concat(polyPoints.map(pointMapping).reverse())),polygon.fill=data.colors.gradient||segments[i].stroke,polygon.opacity=data.colors.areaAlpha*(segments[i].data.selected?1:data.globalAlpha)):segments[i]instanceof Line&&(polyPoints=[{x:segments[i].x1,y:segments[i].y1},{x:segments[i].x1,y:segments[i].data.y1_},{x:segments[i].x2,y:segments[i].data.y2_},{x:segments[i].x2,y:segments[i].y2}],polygon=new Polygon(polyPoints),polygon.fill=data.colors.gradient||"#eeeeee",polygon.opacity=data.colors.areaAlpha*(segments[i].data.selected?1:data.globalAlpha)),polygon&&polygons.push(polygon);this.addChildren(polygons)}})}),define("extensions.qliktech/linechart/layers/shapes/line-object",["objects.views/charts/shapes/container","./points","./poly-line","./poly-area"],function(Container,PartialPoints,PartialLine,PartialArea){var LineObject;return LineObject=Container.extend("LineObject",{init:function(polyData,data){this._super(),this.data.label=polyData.info.label,data.showArea&&(this._areaLayer=new PartialArea,this.addChild(this._areaLayer)),this._lineLayer=new PartialLine,this.addChild(this._lineLayer),this._pointLayer=new PartialPoints("circle"),this.addChild(this._pointLayer)},update:function(data){this._pointLayer.update(data),this._lineLayer.update(data),this.visible=this._pointLayer.visible||this._lineLayer.visible,this._areaLayer&&(this._areaLayer.update(data,this._lineLayer.children),this._areaLayer.visible&&(this.visible=!0))}})}),define("extensions.qliktech/linechart/layers/line-objects-layer",["./layer","./shapes/line-object"],function(Layer,LineObject){var LineObjectsLayer;return LineObjectsLayer=Layer.extend("LineObjectLayer",{init:function(container){this._super(container,{name:"line-objects-layer"})},updateInstances:function(polys,data){var i,len=polys?polys.length:0,lineObjects=[];for(this.renderer.stage.removeChildren(),i=0;len>i;i++)lineObjects.push(new LineObject(polys[i],{showArea:data.showArea}));this.renderer.stage.addChildren(lineObjects),this._lineObjects=lineObjects},getLineObjects:function(){return this._lineObjects},update:function(linesSettings){var i,num=this._lineObjects?this._lineObjects.length:0;for(i=0;num>i;i++)this._lineObjects[i].update(linesSettings[i])}})}),define("extensions.qliktech/linechart/layers/oob-layer",["./layer","objects.views/charts/shapes/polygon"],function(Layer,Polygon){function getArrowPoints(x,y,baseSize,tipSize,direction){var points=[];return"left"===direction?(points.push({x:x,y:y+baseSize/2}),points.push({x:x,y:y-baseSize/2}),points.push({x:x-tipSize,y:y})):"right"===direction?(points.push({x:x,y:y+baseSize/2}),points.push({x:x,y:y-baseSize/2}),points.push({x:x+tipSize,y:y})):"up"===direction?(points.push({x:x-baseSize/2,y:y}),points.push({x:x+baseSize/2,y:y}),points.push({x:x,y:y-tipSize})):"down"===direction&&(points.push({x:x-baseSize/2,y:y}),points.push({x:x+baseSize/2,y:y}),points.push({x:x,y:y+tipSize})),points}var OutOfBoundsLayer;return OutOfBoundsLayer=Layer.extend("OutOfBoundsLayer",{init:function(container){this._super(container,{name:"out-of-bounds-layer"}),this._markerSize=8},update:function(points,settings){var shape,p,trianglePoints,pData,axisDetails,i,s=this.renderer.stage,shapes=s.children,size=settings.markerSize||this._markerSize,num=points?points.length:0;for(i=0;num>i;i++)shape=shapes[i],p=points[i],pData=p,p.data&&(pData=p.data),axisDetails=settings.axesSettings[settings.measureToAxisIndex[pData.measureIdx]],trianglePoints=getArrowPoints(pData.x,pData.outOfRangeUp?axisDetails.topCutoff+size:axisDetails.bottomCutoff-size,size,size,pData.outOfRangeUp?"up":"down"),shape?shape.set(trianglePoints):(shape=new Polygon(trianglePoints),s.addChild(shape)),shape.fill="#999999",shape.opacity=pData.selected?1:settings.globalAlpha;num<shapes.length&&s.removeChildren(shapes.slice(num-shapes.length))}})}),define("extensions.qliktech/linechart/layers/label-layer",["./layer","objects.views/charts/utils/canvas-renderer","objects.utils/shapes/geometry-math"],function(Layer,CanvasRenderer,GeometryMath){function createDataPointLabels(){var i,j,dataLineObjects,label,numDataPoints,points,pointBounds,x,y,labelPointId,sx=this.renderer.scaling.x,sy=this.renderer.scaling.y,existingLabels={},formatter=this.combinedMeasuresFormatter;for(this._allDataLineObjectsLength=this._allDataLineObjects?this._allDataLineObjects.length:0,this._dataLabelsOfLines=new Array(this._allDataLineObjectsLength),this._allDataPointLabels=[],i=0;i<this._allDataLineObjectsLength;i++)for(this._dataLabelsOfLines[i]=[],dataLineObjects=this._allDataLineObjects[i],points=dataLineObjects.find("Points [visible='true']"),numDataPoints=points?points.length:0,j=0;numDataPoints>j;j++)pointBounds=points[j].getBoundingRect(),x=pointBounds.x/sx+pointBounds.width/(2*sx),y=pointBounds.y/sy+pointBounds.height/(2*sy),labelPointId=x+";"+y,labelPointId in existingLabels||(existingLabels[labelPointId]=!0,label={text:this._lineType===lineType.STACKED&&this._allDataLineObjectsLength>1?formatter.formatValue(points[j].value):points[j].data.label,x0:x,y0:y,align:"center",font:this._style.dataPoints.font,maxWidth:512,maxNumLines:1,line:i},this._dataLabelsOfLines[i].push(label),this._allDataPointLabels.push(label));this._numAllDataPointLabels=this._allDataPointLabels.length}function measureDataPointLabelSizes(){var i;for(i=0;i<this._numAllDataPointLabels;i++)this._allDataPointLabels[i].size=CanvasRenderer.measureTextObject({type:"text",shape:this._allDataPointLabels[i]})}function calculateDataPointLabelsInfo(){measureDataPointLabelSizes.call(this);var i,j,numLabelsOfLine,dataLabelsOfLine,label,leftLabel,rightLabel,discreteSpacing05=this._discreteSpacing/2;for(i=0;i<this._allDataLineObjectsLength;i++)if(dataLabelsOfLine=this._dataLabelsOfLines[i],numLabelsOfLine=dataLabelsOfLine.length,0!==numLabelsOfLine)if(1!==numLabelsOfLine){for(label=dataLabelsOfLine[0],label.priority=6,rightLabel=dataLabelsOfLine[1],label.leftDx=discreteSpacing05,label.leftDy=0,label.rightDx=rightLabel.x0-label.x0,label.rightDy=label.y0-rightLabel.y0,j=1;numLabelsOfLine-1>j;j++)label=dataLabelsOfLine[j],leftLabel=dataLabelsOfLine[j-1],rightLabel=dataLabelsOfLine[j+1],label.leftDx=leftLabel.rightDx,label.leftDy=-leftLabel.rightDy,label.rightDx=rightLabel.x0-label.x0,label.rightDy=label.y0-rightLabel.y0,leftLabel.y0<label.y0?label.y0<rightLabel.y0?label.priority=1:label.y0===rightLabel.y0?label.priority=2:label.priority=3:leftLabel.y0===label.y0?label.y0<rightLabel.y0?label.priority=2:label.y0===rightLabel.y0?label.priority=0:label.priority=2:label.y0<rightLabel.y0?label.priority=4:label.y0===rightLabel.y0?label.priority=2:label.priority=1;label=dataLabelsOfLine[numLabelsOfLine-1],leftLabel=dataLabelsOfLine[numLabelsOfLine-2],label.leftDx=leftLabel.rightDx,label.leftDy=-leftLabel.rightDy,label.rightDx=discreteSpacing05,label.rightDy=0,label.priority=5}else label=dataLabelsOfLine[0],label.leftDx=discreteSpacing05,label.leftDy=0,label.rightDx=discreteSpacing05,label.rightDy=0}function sortDataPointLabels(){void 0!==this._usedDataMax&&this._usedDataMax===this._usedDataMin?this._allDataPointLabels.sort(function(label1,label2){return label1.x0<label2.x0?-1:1}):this._allDataPointLabels.sort(function(label1,label2){return label1.priority>label2.priority?-1:label1.priority===label2.priority?6===label1.priority?label1.x0===label2.x0?label1.y0>label2.y0?1:-1:label1.x0>label2.x0?1:-1:5===label1.priority?label1.x0===label2.x0?label1.y0>label2.y0?1:-1:label1.x0>label2.x0?-1:1:4===label1.priority?label1.y0>label2.y0?1:-1:3===label1.priority?label1.y0>label2.y0?-1:1:label1.y0===label2.y0?label1.x0>label2.x0?-1:1:label1.y0<label2.y0?-1:1:1})}function getPolylinesOfDataLines(){var i,j,dataLineObject,segments,numSegments,segment,numPoints,p,numPolylines,polyline,polylines=[],sx=this.renderer.scaling.x,sy=this.renderer.scaling.y;for(i=0;i<this._allDataLineObjectsLength;i++)for(dataLineObject=this._allDataLineObjects[i],segments=dataLineObject.find("PolyLine [stroke]"),numSegments=segments?segments.length:0,j=0;numSegments>j;j++)segment=segments[j],polylines.push(segment.getPoints());for(numPolylines=polylines.length,i=0;numPolylines>i;i++)for(polyline=polylines[i],numPoints=polyline?polyline.length:0,j=0;numPoints>j;j++)p=polyline[j],p.x=p.x/sx,p.y=p.y/sy;return polylines}function labelOverlapsLabel(label1,label2){return label1.minX2>label2.maxX2||label1.maxX2<label2.minX2||label1.minY2>label2.maxY2||label1.maxY2<label2.minY2?!1:!0}function checkNoOverlappingBoundaries(labelIndex){var label=this._allDataPointLabels[labelIndex],minX=0,maxX=this.rect.width,minY=1,maxY=this.rect.height-1;return label.x0>minX&&label.x0<maxX&&label.minX>=minX&&label.maxX<=maxX&&label.minY>=minY&&label.maxY<=maxY}function checkNoOverlappingDataLines(labelIndex){return!GeometryMath.checkPolylinesIntersectingRectDefinedByMaxMin(this._polylines,this._allDataPointLabels[labelIndex])}function checkNoCloseToNearbyPoints(labelIndex){var p,i,label=this._allDataPointLabels[labelIndex],x=(label.minX+label.maxX)/2,y=(label.minY+label.maxY)/2,d2=Math.pow(x-label.x0,2)+Math.pow(y-label.y0,2);for(i=0;i<this._numAllDataPointLabels;i++)if(p=this._allDataPointLabels[i],i!==labelIndex&&d2>=Math.pow(x-p.x0,2)+Math.pow(y-p.y0,2))return!1;return!0}function checkNoOverlappingOtherLabels(labelIndex){var j,label=this._allDataPointLabels[labelIndex];for(j=0;labelIndex>j;j++)if(this._allDataPointLabels[j].status&&labelOverlapsLabel(label,this._allDataPointLabels[j]))return!1;return!0}function checkNoOverlapping(labelIndex){return checkNoOverlappingBoundaries.call(this,labelIndex)&&checkNoCloseToNearbyPoints.call(this,labelIndex)&&checkNoOverlappingDataLines.call(this,labelIndex)?checkNoOverlappingOtherLabels.call(this,labelIndex):!1}function calculateLabelBoundary(label){var w05,w052,h,horizontalGap05=this._dataLabelHorizontalGap/2,verticalGap05=this._dataLabelVerticalGap/2;w05=label.size.width/2,w052=w05+horizontalGap05,label.minX=label.x-w05,label.maxX=label.x+w05,label.minX2=label.x-w052,label.maxX2=label.x+w052,h=label.size.height,"top"===label.baseline&&(label.minY=label.y,label.maxY=label.y+h,label.maxY2=label.maxY+verticalGap05,label.minY2=label.minY-verticalGap05),"bottom"===label.baseline&&(label.maxY=label.y,label.minY=label.y-h,label.maxY2=label.maxY+verticalGap05,label.minY2=label.minY-verticalGap05),"middle"===label.baseline&&(label.maxY=label.y+h/2,label.minY=label.y-h/2,label.maxY2=label.maxY+verticalGap05,label.minY2=label.minY-verticalGap05)}function treatSideMostLabel(label){6===label.priority&&label.x-label.size.width/2<0&&(label.x=label.size.width/2+1),5===label.priority&&label.x+label.size.width/2>this.rect.width&&(label.x=this.rect.width-label.size.width/2-1)}function positionLeftMostLabelToLeft(label){return label.baseline="middle",label.x=label.x0-label.size.width/2-this._dataLabelHorizontalGap,label.y=label.y0,!0}function positionRightMostLabelToRight(label){return label.baseline="middle",label.x=label.x0+label.size.width/2+this._dataLabelHorizontalGap,label.y=label.y0,!0}function positionLabel_Top(label){return label.baseline="bottom",label.x=label.x0,label.y=label.y0-this._dataLabelMargin,treatSideMostLabel.call(this,label),!0}function positionLabel_Bottom(label){return label.baseline="top",label.x=label.x0,label.y=label.y0+this._dataLabelMargin,treatSideMostLabel.call(this,label),!0}function positionLabel_Top2(label){var labelWidth,labelWidth05,h,w1,w2,leftDx=label.leftDx,rightDx=label.rightDx,leftDy=label.leftDy,rightDy=label.rightDy,epsilon=1e-9;return(leftDy>0||rightDy>0)&&(leftDy=Math.max(leftDy,epsilon),rightDy=Math.max(rightDy,epsilon),labelWidth=label.size.width+2*this._horizontalDistanceFromLine,h=labelWidth/(leftDx/leftDy+rightDx/rightDy),h<=this._maxDataLabelMargin)?(label.baseline="bottom",h=Math.max(h,this._dataLabelMargin),label.y=label.y0-h,w1=h*leftDx/leftDy,w2=h*rightDx/rightDy,labelWidth05=labelWidth/2,labelWidth05>w1?label.x=label.x0+(labelWidth05-w1):labelWidth05>w2&&(label.x=label.x0-(labelWidth05-w2)),!0):!1}function positionLabel_Bottom2(label){var labelWidth,labelWidth05,h,w1,w2,leftDx=label.leftDx,rightDx=label.rightDx,leftDy=-label.leftDy,rightDy=-label.rightDy,epsilon=1e-9;return(leftDy>0||rightDy>0)&&(leftDy=Math.max(leftDy,epsilon),rightDy=Math.max(rightDy,epsilon),labelWidth=label.size.width+2*this._horizontalDistanceFromLine,h=labelWidth/(leftDx/leftDy+rightDx/rightDy),h<=this._maxDataLabelMargin)?(label.baseline="top",h=Math.max(h,this._dataLabelMargin),label.y=label.y0+h,w1=h*leftDx/leftDy,w2=h*rightDx/rightDy,labelWidth05=labelWidth/2,labelWidth05>w1?label.x=label.x0+(labelWidth05-w1):labelWidth05>w2&&(label.x=label.x0-(labelWidth05-w2)),!0):!1}function positionLabel_Left(label){var labelHeight05,h,dx=label.leftDx,dy=label.leftDy;return label.baseline="middle",labelHeight05=label.size.height/2+this._horizontalDistanceFromLine,h=Math.abs(this._dataLabelHorizontalGap*dy/dx),label.x=label.x0-label.size.width/2-this._dataLabelHorizontalGap,label.y=label.y0+(h>=labelHeight05?0:dy>0?labelHeight05-h:h-labelHeight05),!0}function positionLabel_Right(label){var labelHeight05,h,dx=label.rightDx,dy=label.rightDy;return label.baseline="middle",labelHeight05=label.size.height/2+this._horizontalDistanceFromLine,h=Math.abs(this._dataLabelHorizontalGap*dy/dx),label.x=label.x0+label.size.width/2+this._dataLabelHorizontalGap,label.y=label.y0+(h>=labelHeight05?0:dy>0?labelHeight05-h:h-labelHeight05),!0}function positionLabel_Other(label){var leftTan,rightTan,dx,dy,minX=0,maxX=this.rect.width,pointLabelHorizontalDistance=9;return label.priority>3?(label.baseline="middle",label.x0-minX<=maxX-label.x0?(label.x=label.x0+pointLabelHorizontalDistance+label.size.width/2,label.y=label.y0):(label.x=label.x0-pointLabelHorizontalDistance-label.size.width/2,label.y=label.y0)):3===label.priority&&(leftTan=label.leftDy/label.leftDx,rightTan=label.rightDy/label.rightDx,rightTan>=leftTan?(dx=(label.size.height/2+1)/rightTan,2*pointLabelHorizontalDistance>=dx?(label.baseline="middle",label.y=label.y0,label.x=label.x0+Math.max(dx,pointLabelHorizontalDistance)+label.size.width/2):(dy=2*pointLabelHorizontalDistance*rightTan-1,label.baseline="top",label.y=label.y0-dy,label.x=label.x0+2*pointLabelHorizontalDistance+label.size.width/2)):(dx=(label.size.height/2+1)/leftTan,2*pointLabelHorizontalDistance>=dx?(label.baseline="middle",label.y=label.y0,label.x=label.x0-Math.max(dx,pointLabelHorizontalDistance)-label.size.width/2):(dy=2*pointLabelHorizontalDistance*leftTan-1,label.baseline="top",label.y=label.y0-dy,label.x=label.x0-2*pointLabelHorizontalDistance-label.size.width/2))),!0}function runPositionFnc(positionFnc,labelIndex){var label=this._allDataPointLabels[labelIndex];!label.status&&positionFnc.call(this,label)&&(calculateLabelBoundary.call(this,label),label.status=checkNoOverlapping.call(this,labelIndex))}function positionLabel(labelIndex){var label=this._allDataPointLabels[labelIndex];this._allDataLineObjectsLength>1?(6===label.priority&&runPositionFnc.apply(this,[positionLeftMostLabelToLeft,labelIndex]),5===label.priority&&runPositionFnc.apply(this,[positionRightMostLabelToRight,labelIndex]),runPositionFnc.apply(this,[positionLabel_Top,labelIndex]),runPositionFnc.apply(this,[positionLabel_Bottom,labelIndex])):(runPositionFnc.apply(this,[positionLabel_Top,labelIndex]),runPositionFnc.apply(this,[positionLabel_Bottom,labelIndex]),6===label.priority&&runPositionFnc.apply(this,[positionLeftMostLabelToLeft,labelIndex]),5===label.priority&&runPositionFnc.apply(this,[positionRightMostLabelToRight,labelIndex])),label.status||(label.rightDy+Math.abs(label.rightDx)*label.leftDy/Math.abs(label.leftDx)>=0?(runPositionFnc.apply(this,[positionLabel_Bottom2,labelIndex]),runPositionFnc.apply(this,[positionLabel_Top2,labelIndex])):(runPositionFnc.apply(this,[positionLabel_Top2,labelIndex]),runPositionFnc.apply(this,[positionLabel_Bottom2,labelIndex]))),label.status||(label.rightDy+Math.abs(label.rightDx)*label.leftDy/Math.abs(label.leftDx)>=0?(runPositionFnc.apply(this,[positionLabel_Left,labelIndex]),runPositionFnc.apply(this,[positionLabel_Right,labelIndex])):(runPositionFnc.apply(this,[positionLabel_Right,labelIndex]),runPositionFnc.apply(this,[positionLabel_Left,labelIndex]))),runPositionFnc.apply(this,[positionLabel_Other,labelIndex])}function positionDataPointLabels(){var i;for(i=0;i<this._numAllDataPointLabels;i++)positionLabel.call(this,i)}function renderDataPointLabels(){var i,label,shapeWrapper,shapeWrappers=[];for(i=0;i<this._numAllDataPointLabels;i++)label=this._allDataPointLabels[i],label.status&&(shapeWrapper={type:"text",fill:this._style.dataPoints.color,shape:label},shapeWrappers.push(shapeWrapper));this.renderer.shapes=shapeWrappers}var LabelLayer,lineType={LINE:"line",AREA:"area",STACKED:"stackedArea"};return LabelLayer=Layer.extend("LabelLayer",{init:function(container){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new CanvasRenderer(this.wrapper),this.minorAxis=null,this.majorAxis=null,container.appendChild(this.wrapper),this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2},update:function(lineObjects,settings){this.combinedMeasuresFormatter=settings.combinedMeasuresFormatter,this._allDataLineObjects=lineObjects,this._lineType=settings.lineType,this._discreteSpacing=settings.majorAxis.getDiscreteSpacing(),this._style=settings.style,this.rect=settings.rect,this.renderer.shapes=[],createDataPointLabels.call(this),calculateDataPointLabelsInfo.call(this),sortDataPointLabels.call(this),this._polylines=getPolylinesOfDataLines.call(this),positionDataPointLabels.call(this),renderDataPointLabels.call(this)}})}),define("extensions.qliktech/linechart/linearea",["objects.views/charts/components/chart-component","objects.utils/shapes/circle","./line-objects-model","./layers/line-objects-layer","./layers/oob-layer","./layers/label-layer","objects.views/charts/chart-style-service","core.utils/deferred"],function(ChartComponent,Circle,LineObjectsModel,LineObjectLayer,OOBLayer,LabelLayer,ChartStyleService,Deferred){"use strict";function removeUndefinedPoints(p){return!!p}function fillInMissingNeighbourInfo(polyLine){var i,k,n,diff,data,num=polyLine?polyLine.length:0;for(i=0;num>i;i++)if(data=polyLine[i],data&&!data.hasRightNeighbour){for(k=i+1;num>k;k++)if(polyLine[k]&&!polyLine[k].isNaN){data.nearestRightNeighbour=k;break}if(!data.isNaN){if(!isNaN(data.nearestRightNeighbour))for(diff=k-i,n=1;diff>n;n++)polyLine[i+n]&&(polyLine[i+n].nearestRightNeighbour=data.nearestRightNeighbour,polyLine[i+n].nearestLeftNeighbour=i);i=k-1}}}function fillInMissingValues(polyLine){var i,k,n,t,fromValue,toValue,diff,data,num=polyLine?polyLine.length:0;for(i=0;num>i;i++)if(data=polyLine[i],data&&!data.hasRightNeighbour&&!data.isNaN&&!isNaN(data.nearestRightNeighbour))for(k=data.nearestRightNeighbour,fromValue=data.value,toValue=polyLine[k].value,diff=k-i,n=1;diff>n;n++)t=n/diff,polyLine[i+n]&&(polyLine[i+n].interpolatedValue=fromValue*(1-t)+toValue*t)}function stackValues(values,separateStacking){var i,polyLine,value,data,idx,stacks=[],num=values?values.length:0;for(i=0;num>i;i++)polyLine=values[i].points,Object.keys(polyLine).forEach(function(key){var negStack=!1;idx=polyLine[key].idx,stacks[idx]||(stacks[idx]={pos:0,neg:0,total:0}),data=polyLine[key],data&&(value=data.isNaN?isNaN(data.interpolatedValue)?0:data.interpolatedValue:data.value,isNaN(value)||(separateStacking?(0===value?data.hasLeftNeighbour&&polyLine[key-1]?negStack=polyLine[key-1].aggregated.end<0:data.hasRightNeighbour&&polyLine[key+1]&&(negStack=polyLine[key+1].aggregated.end<0):negStack=0>value,negStack?(data.aggregated.start=stacks[idx].neg,stacks[idx].neg+=value,data.aggregated.end=stacks[idx].neg):(data.aggregated.start=stacks[idx].pos,stacks[idx].pos+=value,data.aggregated.end=stacks[idx].pos)):(data.aggregated.start=stacks[idx].total,stacks[idx].total+=value,
stacks[idx].pos=Math.max(stacks[idx].pos,stacks[idx].total),stacks[idx].neg=Math.min(stacks[idx].neg,stacks[idx].total),data.aggregated.end=stacks[idx].total),"number"==typeof data.interpolatedValue&&(data.interpolatedValue=data.aggregated.end,data.isInterpolationOffset=!0)))});return{pos:Math.max.apply(null,stacks.filter(function(stack){return!!stack}).map(function(stack){return stack.pos})),neg:Math.min.apply(null,stacks.filter(function(stack){return!!stack}).map(function(stack){return stack.neg}))}}function updateStyles(styleService,layoutMode){var mode=styleService.layoutMap[layoutMode]||"medium",style={dataPoints:{color:styleService.getValue(chartID,"item.value","color"),font:styleService.getFont(chartID,"item.value",mode),size:{normal:styleService.getValue(chartID,"item.shape","size"),selected:styleService.getValue(chartID,"item.shape","size","selected")}},outOfRange:{color:styleService.getValue(chartID,"item.outOfRange","color")},line:{width:styleService.getValue(chartID,"item.line","width",mode)}};return style}function createMajorAxisData(){if(!this._data||!this._tree)return[];var currentAxisLabel,dimInfo=this._data.qHyperCube.qDimensionInfo,numDimz=dimInfo.length,axisLabels=[],index=0;return this._tree.children.forEach(function(dimNode){dimNode.id=dimInfo[0].cId+"_"+dimNode.data.qElemNo,currentAxisLabel={label:dimNode.data.qText||"",cacheIndex:[],id:dimNode.id},axisLabels.push(currentAxisLabel),1===numDimz&&(currentAxisLabel.cacheIndex[0]=index++),numDimz>1&&dimNode.children.forEach(function(){currentAxisLabel.cacheIndex.push(index++)},this)},this),{data:axisLabels,info:[{qApprMaxGlyphCount:this._tree.data.qApprMaxGlyphCount}],groupSize:null}}var LineArea,chartID="lineChart",lineType={LINE:"line",AREA:"area",STACKED:"stackedArea"},nullMode={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return LineArea=ChartComponent.extend("LineArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._generatedCacheItems=[],this._showDataPoints=!0,this._colorMap=null,this._showDataPoints=!1,this._lineType=lineType.LINE,this._nullMode=nullMode.GAP,this._separateStacking=!0,this._globalAlpha=1,this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2,this._styleService=ChartStyleService.getInstance(),this._lineObjectsModel=new LineObjectsModel,this._lineLayer=new LineObjectLayer(this.container),this.layers=[this._lineLayer],this.isMini||(this._oobLayer=new OOBLayer(this.container),this.layers.push(this._oobLayer),this._labelLayer=new LabelLayer(this.container),this.layers.push(this._labelLayer))},preRender:function(){},afterPaint:function(){return Deferred.resolve()},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setShowDataPoints:function(b){this._showDataPoints=b},getShowDataPoints:function(){return this._showDataPoints},setMajorAxis:function(ax){this._majorAxis=ax,this._majorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setMinorAxis:function(ax){this._minorAxis=ax,this._minorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setSecondaryMinorAxis:function(ax){this._secondaryMinorAxis=ax,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(t){this._tree=t,this.invalidateProperties()},setLineType:function(type){this._lineType=type},setNullMode:function(mode){this._nullMode=mode},setSeparateStacking:function(b){this._separateStacking=b},setShowDataPointLabels:function(b){this._showDataPointLabels=b},getShowDataPointLabels:function(){return this._showDataPointLabels},freezeZOrdering:function(){this._zOrderFreezed=!0},unFreezeZOrdering:function(){this._zOrderFreezed=!1},setColorMappings:function(v){this._colorMappings=v},_updateSize:function(){this.invalidateDisplay()},getCacheItems:function(){return this._cacheItems},setCacheItems:function(v){this._cacheItems=v},getGeneratedCacheItems:function(){return this._generatedCacheItems||[]},setMeasureIndices:function(v){this._measureIndices=v},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},_updateProperties:function(){if(this._data&&this._tree){this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis),this._majorAxisData=createMajorAxisData.call(this),this._minorAxisData=null;var nodeId,value,valueNode,parent,isValueNaN,formatter,polyLine,cacheItems=[],dimInfo=this._data.qHyperCube.qDimensionInfo,numDimz=dimInfo.length,numMeasures=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,measures=this._data.qHyperCube.qMeasureInfo,tree=this._tree,shapes=this._shapes,num=tree.children.length,numRequiredShapes=0,numAvailableShapes=this._shapes.length,polysData={},formatters=this.measureFormatters,selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea",measureAxes=this._minorAxes,measureToAxis=[],measureIndices=[];if(this._measureIndices)measureIndices=this._measureIndices;else if(numMeasures>0&&20>numMeasures)for(;measureIndices.length<numMeasures;)measureIndices.push(measureIndices.slice(-1)[0]+1||0);if(measureIndices.forEach(function(v){measureToAxis[v]=measureAxes.filter(function(x){return x._dataIndices?x._dataIndices.indexOf(v)>=0:!0})[0]}),this._measureToAxis=measureToAxis,this._measureToAxisIndex=measureToAxis.map(function(axis){return measureAxes.indexOf(axis)}),this._polysData=[],num&&measureIndices||measureIndices.length){tree.children.forEach(function(dimNode,idx){dimNode.id=dimInfo[0].cId+"_"+dimNode.data.qElemNo,dimNode.children.forEach(function(node,i){if(numDimz>1)nodeId=dimNode.id+";"+dimInfo[1].cId+"_"+node.data.qElemNo,polyLine=polysData[node.data.qText],polyLine||(polysData[node.data.qText]={info:{label:node.data.qText},points:[],values:[],measureIdx:numDimz>1?0:i},polyLine=polysData[node.data.qText]),node=node.children[0],formatter=formatters[0];else{if(this._measureIndices&&this._measureIndices.indexOf(i)<0)return;nodeId=dimNode.id,polyLine=polysData[i],polyLine||(polysData[i]={info:{label:measures[i].qFallbackTitle},measureIdx:i,points:[],values:[]},polyLine=polysData[i]),formatter=formatters[i]}valueNode=node.children[0],valueNode&&(value=void 0!==valueNode.data.qValue?valueNode.data.qValue:valueNode.data.qNum,isValueNaN=isNaN(value),this._nullMode===nullMode.ZERO&&isValueNaN&&(value=0,isValueNaN=!1),node.chartData={value:value,isNaN:isValueNaN,idx:idx,measureIdx:numDimz>1?0:i,hasLeftNeighbour:!!polyLine.points[idx-1]&&!polyLine.points[idx-1].isNaN,hasRightNeighbour:!1,color:null,text:valueNode.data.qText,label:valueNode.data.qText?formatter&&("U"===formatter.type||isNaN(valueNode.data.qNum))?formatter.formatValue(value):valueNode.data.qText:"",rowIndex:node.data.rowIndex,dimValue:dimNode.data.qNum,id:nodeId,aggregated:{}},node.chartData.isNaN||(node.chartData.aggregated.start=0,node.chartData.aggregated.end=value,polyLine.values.push(value)),polyLine.points[idx]=node.chartData,polyLine.points[idx-1]&&(polyLine.points[idx-1].hasRightNeighbour=!node.chartData.isNaN),node.chartData.shapeIndex=numRequiredShapes++,numRequiredShapes>numAvailableShapes&&shapes.push(new Circle(NaN,NaN,NaN)),node.chartData.cacheCircle=shapes[node.chartData.shapeIndex],parent=node.parent,parent.cacheItem&&(cacheItems.indexOf(parent.cacheItem)<0&&cacheItems.push(parent.cacheItem),node.chartData.cacheItem=parent.cacheItem,parent.cacheItem.addShape(selectionID,node.chartData.cacheCircle,!0),parent.cacheItem.calculateTooltipPosition=!0))},this)},this);var dummy=[],fillInMissing=this._nullMode===nullMode.CONNECT&&this._lineType===lineType.STACKED&&(numMeasures>1||numDimz>1);if(Object.keys(polysData).forEach(function(key){this._nullMode!==nullMode.ZERO&&fillInMissingNeighbourInfo.call(this,polysData[key].points),fillInMissing&&fillInMissingValues.call(this,polysData[key].points),polysData[key].points=polysData[key].points.filter(removeUndefinedPoints),dummy.push(polysData[key])},this),this._polysData=dummy,this._zOrderFreezed){var sortedOrder=this._sortedOrder;this._polysData.forEach(function(obj,idx){obj.idx=idx}),this._polysData.sort(function(a,b){return sortedOrder.indexOf(a.idx)-sortedOrder.indexOf(b.idx)})}else this._lineType===lineType.AREA?(this._polysData.forEach(function(obj,idx){obj.idx=idx,obj.values.sort(function(a,b){return b-a}),obj.absMedian=Math.abs(obj.values[Math.floor(obj.values.length/2)])}),this._polysData.sort(function(a,b){return b.absMedian-a.absMedian})):this._polysData.forEach(function(obj,idx){obj.idx=idx}),this._sortedOrder=this._polysData.map(function(obj){return obj.idx});if(this._lineType===lineType.STACKED&&(numMeasures>1||numDimz>1)){var stacks=stackValues.apply(this,[dummy,this._separateStacking]);this._minorAxisData={min:stacks.neg>=0?0:stacks.neg,max:stacks.pos<0?0:stacks.pos}}}this._shapes.length>numRequiredShapes&&(this._shapes=this._shapes.slice(0,numRequiredShapes)),this.setSelectableShapes(cacheItems),this._lineLayer.updateInstances(this._polysData,{showArea:[lineType.AREA,lineType.STACKED].contains(this._lineType)})}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree},updateSize:function(){this._super(),this.layers.forEach(function(layer){layer.rect=this.rect,layer.renderer.setDimensions(0,-1,this.rect.width,this.rect.height+1),layer.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this),this._style=updateStyles(this._styleService,this._layoutMode)},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:1,left:0,right:0,bottom:0}},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},beforeLayerUpdates:function(){},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow();var settings={numDimensions:this._data.qHyperCube.qDimensionInfo.length,showDataPoints:this._showDataPoints&&this._layoutMode>this.ShowFlags.SPARK,nullMode:this._nullMode,globalAlpha:this._globalAlpha,majorAxis:this._majorAxis,minorAxes:this._minorAxes,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails),combinedMeasuresFormatter:this.combinedMeasuresFormatter,colorMap:this._colorMap,rect:this.rect,style:this._style,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)},self=this,dfds=[];return this._lineObjectsModel.update(this._polysData,settings),this.beforeLayerUpdates(this._lineObjectsModel.getLineObjectsSettings()),this._lineLayer.update(this._lineObjectsModel.getLineObjectsSettings()),this.preRender(this._lineLayer._lineObjects),dfds.push(this._lineLayer.render()),this._oobLayer&&(this._oobLayer.update(this._lineObjectsModel.getPointsOutOfRange(),settings),dfds.push(this._oobLayer.render())),this._labelLayer&&(this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPointLabels&&this._showDataPoints?(this._labelLayer.update(this._lineLayer.getLineObjects(),settings),this._labelLayer.show(),dfds.push(this._labelLayer.render())):this._labelLayer.hide()),Deferred.all(dfds).then(function(){return self.afterPaint(settings.axesSettings[0].topCutoff,settings.axesSettings[0].bottomCutoff)})},clear:function(){this._super(),this.layers.forEach(function(layer){layer.clear()})},_getAxisDetails:function(axis){var plotMin=axis.getPlotMin(),plotMax=axis.getPlotMax(),plotRange=plotMax-plotMin,axisPadding=axis.getPadding(),topCutoff=axisPadding.top,bottomCutoff=axis.rect.height-axisPadding.bottom,areaStartBase=0;return areaStartBase=plotMin>0?bottomCutoff:0>plotMax?topCutoff:Math.floor(axis.getPositionOfValue(0))-.5,{plotMin:plotMin,plotMax:plotMax,posMin:axis.getPositionOfValue(plotMin),posMax:axis.getPositionOfValue(plotMax),plotRange:plotRange,topCutoff:topCutoff,bottomCutoff:bottomCutoff,areaStartBase:areaStartBase,zeroPos:Math.floor(axis.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/linechart/linechart-properties",["translator","client.utils/default-property-logic"],function(translator,propertyLogicModule){function showStackedOptions(data,handler){var dims=handler.getDimensions(),meas=handler.getMeasures();return"area"===data.lineType&&dims.length+meas.length>2}function getMeasures(data,handler){return handler?handler.getMeasureLayouts():data.qHyperCubeDef.qMeasures.map(function(m){return m.qDef})}function getDimensions(data,handler){return handler?handler.getDimensionLayouts():data.qHyperCubeDef.qDimensions.map(function(m){return m.qDef})}var settings,sorting,addons,propertyLogic=propertyLogicModule.getLogicFor("hard","linechart");settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{lineType:{ref:"lineType",type:"string",component:"item-selection-list",defaultValue:"line",horizontal:!0,items:[{icon:"æ",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"ø",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},stackedProps:{type:"items",grouped:!1,items:{stackedArea:{ref:"stackedArea",translation:"properties.style.stackedArea",type:"boolean",defaultValue:!1,show:function(data,handler){return showStackedOptions(data,handler)}},separateStacking:{ref:"separateStacking",translation:"properties.separateStacking",type:"boolean",defaultValue:!0,readOnly:function(data){return!data.stackedArea},show:function(data,handler){return showStackedOptions(data,handler)}}}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap"},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showDataPointLabels:{ref:"dataPoint.showLabels",translation:"properties.dataPoints.labelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(data){return data.dataPoint&&data.dataPoint.show},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{type:"number",component:"dropdown",ref:"gridLine.spacing",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(data){return data.gridLine&&!data.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:propertyLogic.color.colorMode.options}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(properties,handler){var label,dimensions=getDimensions(properties,handler).map(function(d){return d.qFallbackTitle||""}).join(", ");return label=dimensions?translator.get("properties.xAxisWithInfo",[dimensions]):translator.get("properties.xAxis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(data){return data.dimensionAxis&&["all","labels"].contains(data.dimensionAxis.show)}},dock:{type:"string",component:"dropdown",ref:"dimensionAxis.dock",translation:"Common.Position",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(data){return data.dimensionAxis&&"none"!==data.dimensionAxis.show},defaultValue:"near"}}},measureAxis:{uses:"measureAxis",label:function(properties,handler){var label,measures=getMeasures(properties,handler).map(function(m){return m.qFallbackTitle}).join(", ");return label=measures?translator.get("properties.yAxisWithInfo",[measures]):translator.get("properties.yAxis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",tid:"property-yAxis"}}}},scale:{type:"items",items:{logScale:{ref:"measureAxis.logarithmic",translation:"properties.axis.logarithmicScale",type:"boolean"},label:{component:"text",translation:"properties.axis.logarithmicScaleNote",show:function(data){return data.measureAxis&&data.measureAxis.logarithmic}}}}}}}},sorting={uses:"sorting",items:{dimensions:{locked:function(index,data,handler){return 1===handler.getMeasures().length&&2===handler.getDimensions().length?0===index:!1}}}},addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var data={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("extensions.qliktech/linechart/linechart-data",["general.utils/property-resolver","general.utils/array-util"],function(propertyResolver,arrayUtils){function setInitialSort(handler){var dims=handler.getDimensions(),meas=handler.getMeasures();1===dims.length&&1===meas.length&&0!==handler.getSorting()[0]&&handler.changeSorting(1,0)}function setColorVars(data,handler){var dims=handler.getDimensions(),measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");dims.length>1&&propertyResolver.setValue(data,"color.persistent",!0),"byMeasure"===mode&&(dims.length>1||measures.length>1)?propertyResolver.setValue(data,"color.mode","byDimension"):"byDimension"===mode&&dims.length<=1&&measures.length<=1?propertyResolver.setValue(data,"color.mode","primary"):"byExpression"===mode&&0===measures.length&&propertyResolver.setValue(data,"color.mode","primary")}function maxMeasures(nDims){return nDims>=2?1:15}return{dimensions:{min:1,max:function(nMeasures){return nMeasures>=2?1:2},add:function(dimension,data,handler){handler.getDimensions().length>1&&(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0),setInitialSort(handler),setColorVars(data,handler)},remove:function(dimension,data,handler){var dimensions=handler.getDimensions(),measures=handler.getMeasures(),maxNumMeasures=maxMeasures(dimensions.length),disabledMeasures=handler.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===measures.length&&disabledMeasures&&disabledMeasures.length&&disabledMeasures.splice(0,maxNumMeasures-1).forEach(function(m){measures.push(m),handler.hcProperties.qInterColumnSortOrder.push(dimensions.length+measures.length-1)}),setColorVars(data,handler),1===dimensions.length&&(data.qHyperCubeDef.qMode="S")},autoSort:function(dimension,data,tags,sortCriterias){tags&&(tags.contains("$text")||tags.contains("$ascii")?sortCriterias.qSortByAscii=1:tags.contains("$numeric")&&(sortCriterias.qSortByNumeric=1))}},measures:{min:1,max:maxMeasures,add:function(dimension,data,handler){setInitialSort(handler),setColorVars(data,handler)},remove:function(dimension,data,handler){var dimensions=handler.getDimensions(),disabledDimensions=handler.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===dimensions.length&&disabledDimensions&&disabledDimensions.length&&(dimensions.push(disabledDimensions.splice(0,1)[0]),arrayUtils.indexAdded(handler.hcProperties.qInterColumnSortOrder,dimensions.length-1)),setColorVars(data,handler),dimensions.length>1?(data.qHyperCubeDef.qMode="K",data.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===dimensions.length&&(data.qHyperCubeDef.qMode="S")}}}}),define("extensions.qliktech/linechart/linechart-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(propertyLogicModule,hcHelper){var propertyLogic=propertyLogicModule.getLogicFor("explore","linechart");return{type:"items",component:"accordion",items:{sort:{uses:"sort",items:{dimensions:{locked:function(index,data){return 1===hcHelper.getNumMeasures(data)&&2===hcHelper.getNumDimensions(data)?0===index:!1}}}},color:{uses:"color",items:{mode:{options:propertyLogic.color.colorMode.options}}},presentation:{uses:"presentation",items:{valueLabels:{type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.show","dataPoint.showLabels"],options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],setPropertyValue:function(props,v){props.dataPoint.show=v,props.dataPoint.showLabels=v},getValue:function(props){return props.dataPoint.show&&props.dataPoint.showLabels}},lineType:{ref:"lineType",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"æ",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"ø",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},logarithmic:{type:"boolean",component:"switch",translation:"properties.axis.logarithmicScale",ref:"measureAxis.logarithmic",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}}}}}),define("text!extensions.qliktech/linechart/linechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("extensions.qliktech/linechart/linechart",["jquery","util","client.utils/state","core.utils/deferred","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","./linearea","extensions.qliktech/linechart/linechart-properties","extensions.qliktech/linechart/linechart-data","extensions.qliktech/linechart/linechart-explore-properties","objects.backend-api/stacked-api","text!./linechart.ng.html","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function($,util,State,Deferred,ScrollableChart,ChartComponent,LineArea,linechartPropertiesDefinition,linechartData,exploreOptions,StackedApi,template,ChartUtils,objectConversion){"use strict";function updatePadding(data){var measureAxis,fontHeight,paddingTop=0,paddingBottom=0;measureAxis=this.components.measureAxis,!data.dataPoint.show||this._layoutMode<=ChartComponent.prototype.ShowFlags.XSMALL?(paddingTop=0,paddingBottom=0):data.dataPoint.show&&(fontHeight=15,data.dataPoint.showLabels&&(paddingTop=fontHeight+7,paddingBottom=0)),["near","bottom"].contains(this.components.dimensionAxis.dock)?measureAxis.setPadding(paddingTop,0,paddingBottom,0):measureAxis.setPadding(paddingBottom,0,paddingTop,0)}function calculateLogScaleMaxMin(max,min,dRange){return max===min&&(max>0&&(max+=dRange),0>min&&(min-=dRange)),min>=1?min=1:min>0?min=Math.pow(10,Math.floor(Math.log(min)/Math.log(10))):-1>=max?max=-1:0>max&&(max=-Math.pow(10,Math.floor(Math.log(-max)/Math.log(10)))),{max:max,min:min}}var LineChart,PAGING={NONE:0,ONE_DIM:1,TWO_DIM:2};return LineChart=ScrollableChart.extend("LineChart",{namespace:".linechart",init:function($scope,$element,options,backendApi){var miniChart,dummy=$.extend(!0,{},options);options=$.extend(!0,options||{},{components:{dataArea:{clazz:LineArea},miniChart:{components:{dataArea:{clazz:LineArea}}}}},dummy),this._super($scope,$element,options,backendApi),this.components.miniChart&&(miniChart=this.components.miniChart,this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(miniChart),miniChart.setColorMap(this.providers.colorMap),miniChart.components.measureAxis.setDock("left"),miniChart.components.dimensionAxis.setDock("bottom"),miniChart.components.dataArea.setMinorAxis(miniChart.components.measureAxis),miniChart.components.dataArea.setMajorAxis(miniChart.components.dimensionAxis),miniChart.setOrientation("vertical"))},initSelections:function(){this.options._disableSelections||(this.selections.types.range.setComponent("x",this.components.dimensionAxis),this.selections.types.range.setComponent("y",this.components.measureAxis),this.selections.Select.bind(function(items,toggle){var dimensions,activeComponent=this.selections.getActiveType().activeComponent;dimensions=activeComponent instanceof LineArea?this.components.dimensionAxis.getType().current:activeComponent.getSelectionIndices(),this.onSelection.Select.apply(this,[items,toggle,dimensions,"L"])}.bind(this))),this._super()},_postResize:function(){this.components.measureAxis.setNiceNumberEnabled(this._layoutMode>ChartComponent.prototype.ShowFlags.XSMALL),this._super()},partialUpdate:function(){return this.components.dataArea.freezeZOrdering(),this._super.apply(this,[].slice.call(arguments))},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var key,scroll=this.components.scrollArea,dfds=[];updatePadding.call(this,this._data),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(dfds.push(this.components.miniChart.setData(this._data)),this._dataForMiniChartChanged=!1);var ret=this.checkPage();if(ret)dfds.push(ret);else{for(key in this.components)dfds.push(this.components[key].invalidateDisplay("LineChart.paint"));scroll.viewState.min+scroll.viewState.range>scroll.fullState.max&&scroll.setOffset(scroll.fullState.max-scroll.viewState.range)}return Deferred.all(dfds)},prePaint:function(data){this._super();var isLimited=!1;if(2===data.qHyperCube.qDimensionInfo.length&&data.qHyperCube.qStackedDataPages[0]){var root=data.qHyperCube.qStackedDataPages[0].qData[0];isLimited=0!==root.qSubNodes[0].qUp||0!==root.qSubNodes[root.qSubNodes.length-1].qDown}ChartUtils.applyDisclaimerAttributes({title:data.qHyperCube.qDimensionInfo.length>1,bottom:!0,supportRangeOverZero:!data.measureAxis.logarithmic,paging:1===data.qHyperCube.qDimensionInfo.length,explicitLimitedData:isLimited},this.$scope.dataAttributes,this.$element,this.$scope,State,data)},_updateData:function(data){this._checkPage=!1,this._data=data,this._dataForMiniChartChanged=!0,this._disablePagingTransitions(),this.components.dataArea.unFreezeZOrdering(),this.isStacked=("stackedArea"===data.lineType||"area"===data.lineType&&data.stackedArea)&&(data.qHyperCube.qDimensionInfo.length>1||data.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,data.qHyperCube.qDimensionInfo.length>1&&!this.isStacked?this.components.scrollArea.setUseMiniChart(!1):this.components.scrollArea.setUseMiniChart(!0);var numDiscrete=null;this._pagingMode=PAGING.NONE,data.qHyperCube.qDimensionInfo.length>1?(numDiscrete=data.qHyperCube.qStackedDataPages&&data.qHyperCube.qStackedDataPages.length?data.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+data.qHyperCube.qStackedDataPages[0].qData[0].qDown+data.qHyperCube.qStackedDataPages[0].qData[0].qUp:null,this.components.dimensionAxis.setSelectionIndices([0]),this.components.dataArea.setSelectionIndices([0,1]),this._pagingMode=PAGING.ONE_DIM,this.isStacked=!0):data.qHyperCube.qSize.qcy>data.qHyperCube.qDataPages[0].qArea.qHeight&&(numDiscrete=data.qHyperCube.qSize.qcy,this._pagingMode=PAGING.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=PAGING.NONE),this.components.dimensionAxis.setNumDiscreteUnits(numDiscrete);var storedData,measureName=data.qHyperCube.qMeasureInfo.map(function(measure){return measure.qFallbackTitle}).join(", "),dimensionName=data.qHyperCube.qDimensionInfo.map(function(dim){return dim.qFallbackTitle}).join(", "),options={axes:{measureAxis:{component:this.components.measureAxis,data:data.measureAxis,title:measureName,dataIndices:data.qHyperCube.qMeasureInfo.map(function(measure,idx){return idx})},dimensionAxis:{component:this.components.dimensionAxis,data:data.dimensionAxis,title:State.view!==State.Views.story?"":dimensionName,dataIndices:data.qHyperCube.qDimensionInfo.map(function(measure,idx){return idx})}},refLineLabels:{labels:{data:data.refLine.refLines,component:this.components.refLineLabels,axis:this.components.measureAxis}},refLines:{component:this.components.refLines},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:data.dimensionAxis}}},dimensionAxisTitle=this.components.dimensionAxisTitle;this.components.dataArea.setData(data),this.providers.colorMap.setData(data),this.components.colorLegend.setData(data);var legendProvider=this.providers.colorMap.getLegendDataProvider();legendProvider.setLegendMarker(data.dataPoint.show?["line","circle"]:["line"]),dimensionAxisTitle.setData(data),this._super(data,options),storedData=this.getSnapshotStoredChartData(),State.view!==State.Views.story?(dimensionAxisTitle.setTitle(dimensionName),dimensionAxisTitle.showComponent()):dimensionAxisTitle.hideComponent(),this._readStoredData&&storedData?(this.components.dimensionAxis.setInnerOffset(storedData.axisInnerOffset),this.components.scrollArea.setOffset(storedData.scrollOffset)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(data){var lt="stackedArea"===data.lineType||"area"===data.lineType&&data.stackedArea?"stackedArea":data.lineType;this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.setLineType(lt),this.components.miniChart&&(this.components.miniChart.components.dataArea.setLineType(lt),this.components.miniChart.components.dataArea.setNullMode(data.nullMode),this.components.miniChart.components.dataArea.setSeparateStacking(data.separateStacking),this.components.miniChart.setLogScale(data.measureAxis.logarithmic)),this.components.dataArea.setShowDataPoints(data.dataPoint.show),this.components.dataArea.setNullMode(data.nullMode),this.components.dataArea.setSeparateStacking(data.separateStacking),this.components.dataArea.setShowDataPointLabels(data.dataPoint.showLabels),this.components.dataArea.updateNow(["properties"])},updateAxis:function(data,options){this._super(data,options);var measureAxis,dRange,min,max,axisOptions,emin,emax,storedData=this.getSnapshotStoredChartData();min=Math.min.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return v.qMin})),max=Math.max.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMax)}).map(function(v){return v.qMax})),util.isNumeric(min)||(min=-1),util.isNumeric(max)||(max=1),axisOptions=options.axes.measureAxis,emin=!axisOptions.data.autoMinMax&&["min","minMax"].contains(axisOptions.data.minMax)?Number(axisOptions.data.min):null,emax=!axisOptions.data.autoMinMax&&["max","minMax"].contains(axisOptions.data.minMax)?Number(axisOptions.data.max):null,this._dataMaxPositive=max>0,this._dataMinNegative=0>min,measureAxis=this.components.measureAxis,measureAxis.setWhiteSpaceOptimizingEnabled(!0),measureAxis.setRealDataRange(void 0,void 0);var major=this.components.dataArea.getMajorAxisData(),minor=this.components.dataArea.getMinorAxisData();
if(this.components.dimensionAxis.setDataRange(major.data,major.info),dRange=0,min>max?(max=10,min=-10):max===min&&(max?dRange=Math.abs(max?.2*max:0):(max=10,min=-10)),this._readStoredData&&storedData&&storedData.dataRanges)this.setAxisDataRange(measureAxis,storedData.dataRanges[0].max,storedData.dataRanges[0].min,emax,emin,dRange);else if(minor&&("stackedArea"===data.lineType||"area"===data.lineType&&data.stackedArea)&&(data.qHyperCube.qMeasureInfo.length>1||data.qHyperCube.qDimensionInfo.length>1))this.setAxisDataRange(measureAxis,minor.max,minor.min,emax,emin,dRange);else if("line"!==data.lineType)if(this._data.measureAxis.logarithmic){var maxMin=calculateLogScaleMaxMin(max,min,dRange);this.setAxisDataRange(measureAxis,maxMin.max,maxMin.min,emax,emin,dRange)}else this.setAxisDataRange(measureAxis,max>0?max+dRange:0,0>min?min-dRange:0,emax,emin,dRange);else this.setAxisDataRange(measureAxis,max>0?max+dRange:Math.min(0,max+dRange),0>min?min-dRange:Math.max(0,min-dRange),emax,emin,dRange);updatePadding.call(this,data)}}),{type:"linechart",BackendApi:StackedApi,template:template,View:LineChart,definition:linechartPropertiesDefinition,softDefinition:exploreOptions,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:500,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},data:linechartData,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},importProperties:function(exportedFmt,initialProperties,definition){var propTree=objectConversion.axisChart.importProperties.apply(objectConversion,[exportedFmt,initialProperties,definition]),props=propTree.qProperty;return props.qHyperCubeDef.qDimensions.length>1&&(props.qHyperCubeDef.qMode="K"),props.color&&"byDimension"===props.color.mode&&props.qHyperCubeDef.qDimensions.length<=1&&props.qHyperCubeDef.qMeasures.length<=1&&objectConversion.changeProperty("color.mode","primary",propTree),propTree},exportProperties:objectConversion.axisChart.exportProperties.bind(objectConversion)}}),define("extensions.qliktech/treemap/treemap-node",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/rect","objects.views/charts/shapes/rect","objects.utils/shapes/rect"],function(Container,DisplayObject,CanvasRenderer,CanvasRect,Rect,GeometricalRect){var TreemapNode=Container.extend("TreemapNode",{init:function(label,value,valueLabel){this._super(),this.x=0,this.y=0,this.width=0,this.height=0,this.data.area=0,this.data.value=value||0,this.data.label=label||"",this.data.valueLabel=valueLabel||"",GeometricalRect.apply(this,[0,0,0,0])},pointInside:DisplayObject.prototype.pointInside,containsPoint:Rect.prototype.containsPoint,intersectsLocalLine:Rect.prototype.intersectsLocalLine,getLocalPoints:Rect.prototype.getLocalPoints,getLocalBoundingRect:Rect.prototype.getLocalBoundingRect,_calculateBounds:DisplayObject.prototype._calculateBounds});return Object.keys(Rect.prototype).forEach(function(key){!TreemapNode.prototype.hasOwnProperty(key)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(key)<0&&(TreemapNode.prototype[key]=Rect.prototype[key])}),CanvasRenderer._registerRenderFn(CanvasRect.render,TreemapNode),TreemapNode}),define("extensions.qliktech/treemap/treemap-layout",["core.utils/class","extensions.qliktech/treemap/treemap-node","translator"],function(Class,TreemapNode,Translator){var TreemapLayout,HEADERHEIGHT=24,COLLAPSED_HEADER_HEIGHT=4,MIN_AREA_FOR_HEADERS=8e3,MIN_AREA_FOR_LABELS=4e3,LABEL={NONE:0,NONE_COLLAPSED:.1,LEAF:1,HEADER:2,OVERLAY:3};return TreemapLayout=Class.extend("TreemapLayout",{init:function(){this.cellPadding=2,this.collapseHeadersOnSmallBranches=!0,this.labeling={},this.othersLabel=Translator.get("properties.dimensionLimits.others")},sort:function(){return this},weigh:function(items,supressOthersByDim,depth){if(!items||!items.length)return this;depth=depth||0;for(var total,othersNode,i=items.length,receivedDataTotal=0,accumulatedWeight=0,engineTotal=items[0].parent.data.value;i;)receivedDataTotal+=items[--i].data.value;for(i=items.length,total=Math.max(receivedDataTotal,engineTotal);i;)items[--i].data.weight=total?items[i].data.value/total:0,accumulatedWeight+=items[i].data.weight,items[i].isBranch&&this.weigh(items[i].children,supressOthersByDim,depth+1);return 1-accumulatedWeight>1e-5&&(othersNode=new TreemapNode,othersNode.data.label="",othersNode.data.weight=1-accumulatedWeight,othersNode.x=0,othersNode.y=0,othersNode.width=0,othersNode.height=0,othersNode.data.qElemNo=-3,othersNode.data.qType="O",othersNode.data.isFakeOthers=!0,othersNode.data.value=engineTotal-receivedDataTotal,othersNode.data.depth=(items[0].parent.data.depth||0)+1,items[0].parent.addChild(othersNode),items[0].parent.children!==items&&items.push(othersNode)),this},layout:function(){return this},arrange:function(nodes,width,height,x,y,level){if(!nodes||!nodes.length)return this;this.layout(nodes,width,height,x,y);var node,h,i,pad=this.cellPadding;for(i=0;i<nodes.length;i++)node=nodes[i],node.visible=node.width>0&&node.height>0,node.isBranch?(node.width=Math.max(0,node.width-pad),node.height=Math.max(0,node.height-pad),node.x+=.5*pad,node.y+=.5*pad,node.visible=node.width>0&&node.height>0,node.data.labelType=this._getLabelType(level,!0,node.data.area),h=node.data.labelType!==LABEL.HEADER?0:HEADERHEIGHT,node.data.labelType===LABEL.NONE_COLLAPSED&&(h=COLLAPSED_HEADER_HEIGHT,node.data.labelType=LABEL.NONE),this.arrange(node.children,node.width,node.height-h,node.x,node.y+h,level+1)):node.data.labelType=this._getLabelType(level,!1,node.data.area);return this},_getLabelType:function(level,isBranch,area){return isBranch?level>this.labeling.headers.numLevels?LABEL.NONE:level===this.labeling.headers.numLevels?this.labeling.overlay.show&&area>=MIN_AREA_FOR_LABELS?LABEL.OVERLAY:LABEL.NONE:this.collapseHeadersOnSmallBranches&&MIN_AREA_FOR_HEADERS>area?LABEL.NONE_COLLAPSED:MIN_AREA_FOR_LABELS>area?LABEL.NONE:LABEL.HEADER:MIN_AREA_FOR_LABELS>area||"none"===this.labeling.leaves.type?LABEL.NONE:LABEL.LEAF}}),TreemapLayout.LABEL=LABEL,TreemapLayout}),define("extensions.qliktech/treemap/treemap-squarified-layout",["extensions.qliktech/treemap/treemap-layout"],function(TreemapLayout){"use strict";function fixateRow(items,area,containerRect){var cellWidth,cellHeight,item,x=containerRect.x,y=containerRect.y,side=containerRect.shortSide,num=items.length,i=0;if(containerRect.direction===VERTICAL){for(;num>i;i++)item=items[i],item.data.area<=0?(cellHeight=0,cellWidth=side):(cellHeight=side*item.data.area/area,cellWidth=item.data.area/cellHeight),item.x=Number(x.toFixed(5)),item.y=Number(y.toFixed(5)),item.width=Number(cellWidth.toFixed(5)),item.height=Number(cellHeight.toFixed(5)),y+=cellHeight;containerRect.x+=cellWidth,containerRect.width-=cellWidth}else{for(;num>i;i++)item=items[i],item.data.area<=0?(cellWidth=0,cellHeight=side):(cellWidth=side*item.data.area/area,cellHeight=item.data.area/cellWidth),item.x=Number(x.toFixed(5)),item.y=Number(y.toFixed(5)),item.width=Number(cellWidth.toFixed(5)),item.height=Number(cellHeight.toFixed(5)),x+=cellWidth;containerRect.y+=cellHeight,containerRect.height-=cellHeight}}function isWorstRatioImproved(rects,side,area,item){for(var worstRatio,newWorstRatio,minArea=Number.MAX_VALUE,maxArea=0,sideSq=side*side,areaSq=area*area,i=rects.length;i;)rects[--i].data.area<minArea&&(minArea=rects[i].data.area),rects[i].data.area>maxArea&&(maxArea=rects[i].data.area);return worstRatio=Math.max(sideSq*maxArea/areaSq,areaSq/(sideSq*minArea)),item.data.area<minArea&&(minArea=item.data.area),item.data.area>maxArea&&(maxArea=item.data.area),areaSq=(area+item.data.area)*(area+item.data.area),newWorstRatio=Math.max(sideSq*maxArea/areaSq,areaSq/(sideSq*minArea)),worstRatio>=newWorstRatio}var SquarifiedLayout,VERTICAL=0,HORIZONTAL=1;return SquarifiedLayout=TreemapLayout.extend({init:function(){this._super()},sort:function(items){var i,num;if(!items||!items.length)return this;for(items.sort(function(a,b){return"O"===b.data.qType?-1:"O"===a.data.qType?1:b.data.weight-a.data.weight}),num=items.length,i=0;num>i;i++)items[i].isBranch&&this.sort(items[i].children);return this},layout:function(items,width,height,x,y){if(!items||!items.length)return this;var item,i,cellWidth,cellHeight,containerRect={x:x,y:y,width:width,height:height,direction:width>=height?VERTICAL:HORIZONTAL,shortSide:Math.min(height,width)},currentArea=0,currentRow=[],sizeOfArea=width*height;for(i=items.length;i;)items[--i].data.area=sizeOfArea*items[i].data.weight;for(i=0;i<items.length;)item=items[i],containerRect.direction===VERTICAL?(cellHeight=containerRect.height*item.data.area/(currentArea+item.data.area),cellWidth=item.data.area/cellHeight):(cellWidth=containerRect.width*item.data.area/(currentArea+item.data.area),cellHeight=item.data.area/cellWidth),!currentRow.length||isWorstRatioImproved(currentRow,containerRect.shortSide,currentArea,item)?(currentArea+=item.data.area,currentRow.push(item),i++):(fixateRow(currentRow,currentArea,containerRect),currentArea=0,currentRow=[],containerRect.shortSide=Math.min(containerRect.width,containerRect.height),containerRect.direction=containerRect.height<=containerRect.width?VERTICAL:HORIZONTAL);return currentRow.length&&fixateRow(currentRow,currentArea,containerRect),this}})}),define("extensions.qliktech/treemap/treemap-hierarchy",["core.utils/class","extensions.qliktech/treemap/treemap-node"],function(Class,TreemapNode){"use strict";function createTreeNodesFromTree(parentNode,dataNodes,pseudoDimPos,depth,measureLabels,formatter,measureIndex){var treeNode,dataChildren,dataNode,temp,i,num=dataNodes?dataNodes.length:0;for(depth=depth||0,measureIndex=measureIndex||0,i=0;num>i;i++)treeNode=null,dataNode=dataNodes[i],dataChildren=dataNode.children,dataNode.data.qType===TYPES.PSEUDO&&(measureIndex=i),dataNode.data.qType!==TYPES.TOTAL&&(dataChildren.length?1===dataChildren.length&&dataChildren[0].data.qType===TYPES._MEASURE?(temp=dataChildren[0].children,temp=temp?temp[0]:null,temp&&!isNaN(temp.data.qValue)&&temp.data.qValue>0&&(treeNode=new TreemapNode(dataNode.data.qText,temp.data.qValue,formatter?formatter.formatValue(temp.data.qValue):temp.data.qText),treeNode.data.row=dataNode.data.rowIndex,treeNode.data.qType=dataNode.data.qType,treeNode.data.qElemNo=dataNode.data.qElemNo,dataNode.cacheItem&&dataNode.cacheItem.addShape("dataArea",treeNode),treeNode.data.cacheItem=dataNode.cacheItem)):1===dataChildren.length&&dataChildren[0].data.qType===TYPES.VALUE?!isNaN(dataChildren[0].data.qValue)&&dataChildren[0].data.qValue>0&&(treeNode=new TreemapNode(dataNode.data.qText,dataChildren[0].data.qValue,formatter?formatter.formatValue(dataChildren[0].data.qValue):dataChildren[0].data.qText),treeNode.data.row=dataNode.data.rowIndex,treeNode.data.qType=dataNode.data.qType,treeNode.data.qElemNo=dataNode.data.qElemNo,dataNode.cacheItem&&dataNode.cacheItem.addShape("dataArea",treeNode),treeNode.data.cacheItem=dataNode.cacheItem):dataNode.data.qMaxPos>0&&(treeNode=new TreemapNode(dataNode.data.qText,dataNode.data.qMaxPos),treeNode.data.qElemNo=dataNode.data.qElemNo,treeNode.data.row=dataNode.data.rowIndex,treeNode.data.qType=dataNode.data.qType,treeNode.data.cacheItem=dataNode.cacheItem,treeNode.data.addMeasures=!0,dataNode.cacheItem&&dataNode.cacheItem.addShape("dataArea",treeNode),createTreeNodesFromTree(treeNode,dataChildren,pseudoDimPos,depth+1,measureLabels,formatter,measureIndex)):!isNaN(dataNode.data.qValue)&&dataNode.data.qValue>0&&(treeNode=new TreemapNode(dataNode.data.qText,dataNode.data.qValue,dataNode.data.qText),treeNode.data.qType=dataNode.data.qType,treeNode.data.qElemNo=dataNode.data.qElemNo,treeNode.data.row=dataNode.data.rowIndex,treeNode.data.isMeasure=depth===pseudoDimPos,dataNode.cacheItem&&dataNode.cacheItem.addShape("dataArea",treeNode),treeNode.data.cacheItem=dataNode.cacheItem),treeNode&&(treeNode.data.depth=depth,isNaN(measureIndex)||(treeNode.data.measureIndex=measureIndex),parentNode.addChild(treeNode)))}function getChildrenOf(nodes){var c=[];return nodes.forEach(function(node){c=c.concat(node.children)}),c}var TreemapHierarchy,TYPES={PSEUDO:"P",TOTAL:"T",VALUE:"V",NORMAL:"N",OTHERS:"O",ROOT:"R",_MEASURE:"_M"};return TreemapHierarchy=Class.extend("TreemapHierarchy",{init:function(root){this.root=root||new TreemapNode,this._pseudoDimPos=0,this.labeling={values:{show:!1}}},setData:function(d,chartContextTree){this._pseudoDimPos=d.pseudoDimPos||0,this._numMeasures=d.qHyperCube.qMeasureInfo.length,this._numDimensions=d.qHyperCube.qDimensionInfo.length,this._dimensionLocks=d.qHyperCube.qDimensionInfo.map(function(s){return s.qLocked}),this._selectionStates=d.qHyperCube.qDimensionInfo.map(function(s){return s.qStateCounts});var formatter=this.labeling.values.show&&this.measureFormatters&&this.measureFormatters[0]&&"U"===this.measureFormatters[0].type?this.measureFormatters[0]:null,qData=d.qHyperCube.qStackedDataPages[0].qData,measureLabels=d.qHyperCube.qMeasureInfo.map(function(m){return m.qFallbackTitle}),pseudoDimPos=d.qHyperCube.qMeasureInfo.length>1?this._pseudoDimPos:-1;this.root.removeChildren(),qData&&qData.length&&(this.root.data.value=qData[0].qMaxPos,this.root.data.qType=TYPES.ROOT,createTreeNodesFromTree(this.root,chartContextTree.children,pseudoDimPos,0,measureLabels,formatter))},getDimensionIndexFromNode:function(node){var p,pp,idx=0;if(!node)return-2;if(node.data.qType===TYPES.PSEUDO)return-1;for(p=node,pp=p.parent;p&&pp&&pp!==this.root;)p=pp,pp=p.parent,p.data.qType!==TYPES.PSEUDO&&idx++;return idx},getSelectableCacheItems:function(nodes){if(!nodes||!nodes.length)return[];var unique,node=nodes[0],children=node.children,dimIdx=this.getDimensionIndexFromNode(node);return node.data.qType===TYPES.PSEUDO?children.length?this.getSelectableCacheItems(getChildrenOf(nodes)):[]:this._dimensionLocks[dimIdx]?children.length?this.getSelectableCacheItems(getChildrenOf(nodes)):[]:(unique=this.getCacheItemsFromNodes(nodes),unique.length<=1&&this._selectionStates[dimIdx].qSelected&&!this._selectionStates[dimIdx].qOption&&children.length?this.getSelectableCacheItems(getChildrenOf(nodes)):unique)},getCacheItemsFromNodes:function(nodes){var i,num=nodes?nodes.length:0,items=[];for(i=0;num>i;i++)nodes[i].data.cacheItem&&items.indexOf(nodes[i].data.cacheItem)<0&&items.push(nodes[i].data.cacheItem);return items}})}),define("extensions.qliktech/treemap/treemap-area",["general.utils/color","./treemap-squarified-layout","./treemap-hierarchy","general.utils/property-resolver","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/text","objects.views/charts/components/chart-component","objects.views/charts/chart-style-service","core.utils/deferred"],function(Color,SquarifiedLayout,TreemapHierarchy,propertyResolver,Renderer,RectShape,ContainerShape,Text,ChartComponent,ChartStyleService,Deferred){"use strict";function getPattern(color,alpha){var ratio=1;return dummyCanvas.width=8*ratio,dummyCanvas.height=8*ratio,ctx.save(),ctx.fillStyle=Color.toRGBA(color),ctx.strokeStyle=Color.toRGBA(color,alpha),ctx.lineWidth=2,ctx.scale(ratio,ratio),ctx.beginPath(),ctx.moveTo(5,-1),ctx.lineTo(-1,5),ctx.moveTo(9,3),ctx.lineTo(3,9),ctx.stroke(),ctx.restore(),ctx.createPattern(dummyCanvas,"repeat")}function updateLabels(nodes,level){var i,node,fontSize,text,attrs,container,descendants,num=nodes?nodes.length:0,type="leaf",overlayLightColor=new Color(this._style.overlay.label.color.light),overlayDarkColor=new Color(this._style.overlay.label.color.dark),itemIsDark=function(total,item){return item.data.isColorDark?total+item.data.value:total};for(i=0;num>i;i++)if(node=nodes[i],type=node.data.labelType,node.isBranch?(updateLabels.apply(this,[nodes[i].children,level+1]),container=this._branchLabelContainer):container=this._leafLabelContainer,node.data.labelType){switch(text=node.data.label,text&&text.length>512&&(text=text.substr(0,256)),this.labeling.values.show&&1===type&&node.data.valueLabel&&(text=[text,node.data.valueLabel]),node.data.labelShape?node.data.labelShape.parent||container.addChild(node.data.labelShape):(node.data.labelShape=new Text,node.data.labelShape.setText(text),container.addChild(node.data.labelShape)),attrs={x:node.x,y:node.y,width:node.width,height:node.height,maxHeight:node.height-4,maxWidth:node.width-8,align:"left",baseline:"top"},type){case 3:node.data.labelFill||(descendants=node.descendants,node.data.labelFill=descendants.reduce(itemIsDark,0)>node.data.value/2?overlayLightColor:overlayDarkColor,node.data.labelStroke=node.data.labelFill===overlayLightColor?"rgba(33, 33, 33, 0.4)":"rgba(230, 230, 230, 0.4)",node.data.labelFill=node.data.labelFill.toRGBA(),node.data.labelShape.strokeFirst=!0),attrs.fill=node.data.labelFill,attrs.stroke=node.data.labelStroke,attrs.maxNumLines=/\s+/.test(node.data.label)?2:1,fontSize=Math.round(.1*Math.sqrt(2*node.data.area)),attrs.font=this._styleService.getFont(chartID,"overlay.label",null,null,fontSize),attrs.strokeWidth=fontSize>64?2:1,attrs.align="center",attrs.baseline="middle";break;case 2:attrs.fill=this._style.branch.label.color,attrs.stroke=void 0,attrs.x+=4,attrs.width-=4,attrs.font=this._style.branch.label.font,attrs.baseline="middle",attrs.maxNumLines=1,attrs.height=HEADERHEIGHT;break;default:attrs.fill=node.data.isColorDark?this._style.leaf.label.color.light:this._style.leaf.label.color.dark,attrs.x+=4,attrs.y+=4,attrs.width-=4,attrs.height-=4,attrs.font=this.labeling.leaves.type===LABELSIZE.DYNAMIC?this._styleService.getFont(chartID,"leaf.label",null,null,Math.round(.1*Math.sqrt(2*node.area))):this._style.leaf.label.font,attrs.baseline="top",attrs.maxNumLines=this.labeling.values.show?[-1,1]:[-1]}node.data.labelShape.attrs(attrs)}else node.data.labelShape&&node.data.labelShape.detach()}function updateCellShapes(cells){var i,tempColor,ids,num=cells?cells.length:0,cm=this._colorMap;for(i=0;num>i;i++)cells[i].isBranch?(cells[i].fill=this._style.branch.fill,cells[i].stroke=null,updateCellShapes.call(this,cells[i].children)):cells[i].data.isInitiated||(ids=[],"P"!==cells[i].data.qType&&"undefined"!=typeof cells[i].data.qElemNo&&ids.push(cells[i].data.qElemNo),cells[i].ancestors.forEach(function(n){["A","N"].contains(n.data.qType)&&ids.push(n.data.qElemNo)}),ids.reverse(),cells[i].data.isInitiated=!0,cells[i].data.color=cm.getColor(ids,cells[i].data.value,cells[i].data.measureIndex||0,cells[i].data.row),tempColor=cells[i].data.isFakeOthers?this._branchColorAtDepth[cells[i].data.depth]:cells[i].data.color,cells[i].data.isColorDark=Color.getBestContrast(tempColor,cTextBright,cTextDark)===cTextBright,cells[i].fill=cells[i].data.isFakeOthers?this._fakeOthersPatternAtDepth[cells[i].data.depth]:cells[i].data.color.toRGBA(),cells[i].stroke=this._sheetBackgroundStroke,cells[i].strokeWidth=1)}function updateStyles(styleService){var localStyle={backgroundColor:styleService.getValue(chartID,null,"backgroundColor"),branch:{fill:styleService.getValue(chartID,"branch","fill"),label:{color:styleService.getValue(chartID,"branch.label","color"),font:styleService.getFont(chartID,"branch.label")}},leaf:{border:{width:{"default":styleService.getValue(chartID,"leaf.border","width"),selected:styleService.getValue(chartID,"leaf.border","width","selected")},color:{"default":styleService.getValue(chartID,"leaf.border","color"),selected:styleService.getValue(chartID,"leaf.border","color","selected")}},label:{font:styleService.getFont(chartID,"leaf.label"),color:{light:styleService.getValue(chartID,"leaf.label","color","light"),dark:styleService.getValue(chartID,"leaf.label","color","dark")}}},overlay:{label:{color:{light:styleService.getValue(chartID,"overlay.label","color","light"),dark:styleService.getValue(chartID,"overlay.label","color","dark")}}}};return localStyle}function toRGB(c1,c2){var a=c1._a+c2._a*(1-c1._a),r=(c1._r*c1._a+c2._r*c2._a*(1-c1._a))/a,g=(c1._g*c1._a+c2._g*c2._a*(1-c1._a))/a,b=(c1._b*c1._a+c2._b*c2._a*(1-c1._a))/a;return 0===a&&(r=g=b=0),new Color(r,g,b,1)}var TreemapArea,chartID="treemap",HEADERHEIGHT=24,LABELSIZE={NONE:"none",STATIC:"static",DYNAMIC:"dynamic"},cTextBright=new Color("#eee"),cTextDark=new Color("#666"),dummyCanvas=document.createElement("canvas"),ctx=dummyCanvas.getContext("2d");return TreemapArea=ChartComponent.extend("TreeMapArea",{init:function(){this._super.apply(this,arguments),this.renderers={cells:new Renderer(this.container,{name:"cell-layer"}),labels:new Renderer(this.container,{name:"label-layer"}),selections:new Renderer(this.container,{name:"selection-layer"})},this._layout=new SquarifiedLayout,this._hierarchy=new TreemapHierarchy(this.renderers.cells.stage),this._pseudoDimPos=0,this._labelSettings={values:{show:!1},headers:{show:!0,numLevels:1},overlay:{show:!0},leaves:{show:!0,type:"static"}},this._styleService=ChartStyleService.getInstance(),this._style=updateStyles(this._styleService),this._sheetBackgroundColor=new Color(this._style.backgroundColor),this._sheetBackgroundStroke=Color.toRGBA(this._sheetBackgroundColor,.5),this.labeling=this._labelSettings},cellPadding:2,setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setPseudoDimPos:function(v){this._pseudoDimPos=v},setDimensionTree:function(t){this._tree=t,this.invalidateProperties(),this.invalidateDisplay()},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data){propertyResolver.getValue(this._data,"labels.auto")?(this.labeling.overlay.show=!0,this.labeling.headers.numLevels=0,this.labeling.leaves.type=LABELSIZE.STATIC):(this.labeling.overlay.show=propertyResolver.getValue(this._data,"labels.overlay",!0),this.labeling.headers.numLevels=propertyResolver.getValue(this._data,"labels.headers")&&this._layoutMode>3?1:0,this.labeling.leaves.type=propertyResolver.getValue(this._data,"labels.leaves")?LABELSIZE.STATIC:LABELSIZE.NONE),this.labeling.values.show=propertyResolver.getValue(this._data,"labels.values",!1),this._layout.labeling=this.labeling,this._hierarchy.measureFormatters=this.measureFormatters;var rootChildren=this._hierarchy.root.children;this._hierarchy.labeling=this.labeling,this._hierarchy.setData(this._data,this._tree),this._dimension=0;var labelStage=this.renderers.labels.stage;labelStage.removeChildren();var leafLabelContainer=new ContainerShape;labelStage.addChild(leafLabelContainer);var branchLabelContainer=new ContainerShape;labelStage.addChild(branchLabelContainer);var supressOthersByDimension=this._data.qHyperCube.qDimensionInfo.map(function(el){return el.supressOthers});this._layout.othersLabelByDimension=this._data.qHyperCube.qDimensionInfo.map(function(el){return el.othersLabel}),this._layout.weigh(rootChildren,supressOthersByDimension).sort(rootChildren),this._leafLabelContainer=leafLabelContainer,this._branchLabelContainer=branchLabelContainer;var cacheItems=this._hierarchy.getSelectableCacheItems(rootChildren),selectionID=this.selectionIdentifier?this.selectionIdentifier:"dataArea",selectionIndex=0,depth=0,shape=cacheItems[0]?cacheItems[0].getShapes(selectionID)[0]:null;shape&&shape.ancestors.forEach(function(n){n.parent&&("N"===n.data.qType&&selectionIndex++,depth++)}),this.setSelectionIndices([selectionIndex]),this._dimension=depth,this.setSelectableShapes(cacheItems);var branchColor=new Color(this._style.branch.fill),treeDepth=this._data.qHyperCube.qDimensionInfo.length+1;this._branchColorAtDepth=[toRGB(branchColor,this._sheetBackgroundColor)],this._fakeOthersPatternAtDepth=[];for(var i=1;treeDepth>i;i++)this._branchColorAtDepth.push(toRGB(branchColor,this._branchColorAtDepth[i-1]));for(i=0;treeDepth>i;i++)this._fakeOthersPatternAtDepth.push(getPattern(this._colorMap.getColor([-3]),.1));this._dataChanged=!0,updateCellShapes.call(this,rootChildren),this.renderers.selections.stage.doInvalidate=!1,this.renderers.selections.stage.removeChildren()}},hasValidData:function(){return this._super()&&this._data},paint:function(){this._super(this._layoutMode,this._data);var rootChildren=this._hierarchy.root.children;return this.renderers.cells.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.selections.stage.opacity=1,this._layout.cellPadding=this.cellPadding*Math.sqrt(this.rect.width*this.rect.height)/500,this.labeling.headers.numLevels=(propertyResolver.getValue(this._data,"labels.auto",!0)||propertyResolver.getValue(this._data,"labels.headers"))&&this._layoutMode>3?1:0,rootChildren.length&&(this._dataChanged||this._oldW!==this.rect.width||this._oldH!==this.rect.height)&&(this._layout.arrange(rootChildren,this.rect.width-4,this.rect.height-4,this.rect.x,this.rect.y,0),updateLabels.apply(this,[rootChildren,0])),this._dataChanged=!1,this._oldW=this.rect.width,this._oldH=this.rect.height,Deferred.all([this.renderers.cells.render(!0),this.renderers.labels.render(!0),this.renderers.selections.render(!0)])},release:function(){for(var r in this.renderers)this.renderers[r].release();this._selectableShapes=[],this.renderers={},this._hierarchy=null,this._layout=null,this._super()},toggleCacheItem:function(item){var isInSelectionMode=!0;this.renderers.cells.stage.opacity!==this._globalAlpha?(isInSelectionMode=!1,this.renderers.cells.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha,this.renderers.selections.stage.doInvalidate=!1):this.renderers.selections.stage.doInvalidate=!0,item.getShapes(this.selectionIdentifier?this.selectionIdentifier:"dataArea").forEach(function(shape){item.selected?(shape.data.borderShape||(shape.data.borderShape=new RectShape(shape.x,shape.y,shape.width,shape.height),shape.data.borderShape.strokeWidth=this._style.leaf.border.width.selected,shape.data.borderShape.stroke=this._style.leaf.border.color.selected,this.renderers.selections.stage.addChild(shape.data.borderShape)),shape.opacity=1,shape.find("[data.labelShape]").forEach(function(shape){shape.data.labelShape.opacity=1,isInSelectionMode&&shape.data.labelShape.invalidate()}),shape.data.labelShape&&(shape.data.labelShape.opacity=1,isInSelectionMode&&shape.data.labelShape.invalidate())):(shape.data.borderShape&&(shape.data.borderShape.detach(),shape.data.borderShape=null),shape.opacity=void 0,shape.data.labelShape&&(shape.data.labelShape.opacity=void 0,isInSelectionMode&&shape.data.labelShape.invalidate()),shape.find("[data.labelShape]").forEach(function(shape){shape.data.labelShape.opacity=void 0,isInSelectionMode&&shape.data.labelShape.invalidate()})),isInSelectionMode&&shape.invalidate()},this),isInSelectionMode||(this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render())}})}),define("text!extensions.qliktech/treemap/treemap.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("extensions.qliktech/treemap/treemap-properties",["general.utils/property-resolver","client.utils/default-property-logic"],function(propertyResolver,propertyLogicModule){function hasDepth(data,handler){var dims=handler.getDimensions(),measures=handler.getMeasures();return measures.length+dims.length>2}var settings,propertyLogic=propertyLogicModule.getLogicFor("hard","treemap");settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],snapshot:{tid:"property-dataPoints"}},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(itemData,handler){return!propertyResolver.getValue(itemData,"labels.auto")&&hasDepth(itemData,handler)}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(data,handler){return!propertyResolver.getValue(data,"labels.auto")&&handler.getDimensions().length-(propertyResolver.getValue(data,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(itemData){return!propertyResolver.getValue(itemData,"labels.auto")},snapshot:{tid:"property-leafLabels"}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(data){return propertyResolver.getValue(data,"labels.auto")||propertyResolver.getValue(data,"labels.leaves")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",translation:"properties.colors",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:propertyLogic.helpers.showDimensionIdOption}}},legend:{show:!1}}}}};var data={uses:"data",items:{dimensions:{},measures:{}}},addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:data,addons:addons,settings:settings}}}),define("extensions.qliktech/treemap/treemap-data",["general.utils/property-resolver"],function(propertyResolver){function setColorVars(data,handler){var dims=handler.getDimensions(),measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");dims.length>1&&data.color&&(data.color.persistent=!0),"byMeasure"===mode&&measures.length>1?propertyResolver.setValue(data,"color.mode","byDimension"):"byExpression"===mode&&0===measures.length&&propertyResolver.setValue(data,"color.mode","primary")}function updateDimensionId(dimension,data){propertyResolver.setValue(data,"color.dimensionId",void 0)}var data={dimensions:{min:1,max:15,add:function(dimension,data,handler){setColorVars(data,handler)},remove:function(dimension,data,handler){updateDimensionId(dimension,data,handler),setColorVars(data,handler)},replace:function(dimension,oldDimension,index,data){propertyResolver.getValue(data,"color.dimensionId")===oldDimension.qDef.cId&&propertyResolver.setValue(data,"color.dimensionId",dimension.qDef.cId)}},measures:{min:1,max:1,add:function(dimension,data,handler){setColorVars(data,handler)},remove:function(dimension,data,handler){setColorVars(data,handler)}}};return data}),define("extensions.qliktech/treemap/treemap",["jquery","./treemap-area","client.utils/state","text!./treemap.ng.html","objects.views/charts/chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","extensions.qliktech/treemap/treemap-properties","extensions.qliktech/treemap/treemap-data","objects.views/charts/components/chart-component","objects.views/charts/components/axis/axis-title","objects.views/charts/representation/combo-color-map","core.utils/deferred","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive","touche"],function($,TreemapArea,State,template,Chart,StackedApi,ChartUtils,treemapPropertiesDefinition,treemapData,ChartComponent,AxisTitle,ColorMap,Deferred,objectConversion){
"use strict";var Treemap,namespace=".treemap";return Treemap=Chart.extend("Treemap",{init:function($scope,$element,options,backendApi){this._data={},options=$.extend(!0,options||{},{debug:!0,providers:{colorMap:{clazz:ColorMap,multiDimScheme:"first"}},components:{dataArea:{clazz:TreemapArea,show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.SPARK},xAxisTitle:{show:!1,order:1,dock:"top",relevantSize:30,showFlag:ChartComponent.prototype.ShowFlags.SMALL,clazz:AxisTitle}}}),this._super($scope,$element,options,backendApi)},off:function(){Touche(this.container).off("*",namespace),this._super()},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(function(shapes){var dimension=this.components.dataArea._dimension;this._selectedRows.length?this.onSelection.Select.apply(this,[shapes,!0,dimension,"L"]):shapes.length&&shapes.every(function(item){return!item.selected})&&this.backendApi.clearSelections()}.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},_paint:function(){var self=this;return this._super().then(function(o){if(!o||!o.invalid){self.layout();var key,dfds=[];for(key in self.components)dfds.push(self.components[key].invalidateDisplay("Treemap.paint"));return Deferred.all(dfds)}})},isValid:function(data){return this._super(data)&&!this.supressChartRendering},prePaint:function(data){this._super(),ChartUtils.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,State,data),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(data){this._data=data,this._super(data),this.providers.colorMap.setData(data),this.components.dataArea.setData(data),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.cellPadding=2,this.components.dataArea.setPseudoDimPos(0)},toggleCacheItem:function(item){for(var c in this.components)this.components[c].toggleCacheItem?this.components[c].toggleCacheItem(item):this.components[c].invalidateDisplay("Treemap#toggleCacheItem")}}),{type:"treemap",BackendApi:StackedApi,template:template,View:Treemap,definition:treemapPropertiesDefinition,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qNoOfLeftDims:-1,qMaxStackedCells:3e3,qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:3e3,qLeft:0,qWidth:30}],qSuppressZero:!1,qSuppressMissing:!0}},data:treemapData,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}},importProperties:objectConversion.colorChart.importProperties.bind(objectConversion),exportProperties:objectConversion.colorChart.exportProperties.bind(objectConversion)}}),define("objects.utils/font-manager",["core.utils/class"],function(Class){function getNValue(value,min,max){return min>value?0:value>max?1:(value-min)/(max-min)}var FontManager;return FontManager=Class.extend("FontManager",{init:function(){this._minFontSize=10,this._maxFontSize=20,this._minRectSize=100,this._maxRectSize=900,this._fontWeight="normal",this._fontFamily="QlikView Sans",this._fontSize=10},setFontWeight:function(fw){this._fontWeight=fw},setFontFamily:function(ff){this._fontFamily=ff},setRectLimits:function(min,max){this._minRectSize=min,this._maxRectSize=max},getFont:function(rect,settings){var size=Math.min(rect.height,rect.width),minFS=settings&&settings.minFontSize?settings.minFontSize:this._minFontSize,maxFS=settings&&settings.maxFontSize?settings.maxFontSize:this._maxFontSize,nValue=getNValue(size,this._minRectSize,this._maxRectSize);return this._fontSize=minFS+Math.round(nValue*(maxFS-minFS)),this._fontWeight+" "+this._fontSize+"px "+this._fontFamily},getFontSize:function(rect,settings){var size=Math.min(rect.height,rect.width),minFS=settings&&settings.minFontSize?settings.minFontSize:this._minFontSize,maxFS=settings&&settings.maxFontSize?settings.maxFontSize:this._maxFontSize,nValue=getNValue(size,this._minRectSize,this._maxRectSize);return minFS+Math.round(nValue*(maxFS-minFS))}})}),define("extensions.qliktech/gauge/gauge-helper",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/shapes/arc","objects.views/charts/shapes/polygon","objects.views/charts/shapes/text","general.utils/color","objects.views/charts/components/axis/radial-axis-helper","objects.utils/font-manager"],function(Class,Rect,Line,Arc,Polygon,Text,Color,RadialAxisHelper,FontManager){function getArcGradientFill(shape,limits,colors){return{x0:shape.x0,y0:shape.y0,x1:shape.x1,y1:shape.y1,limits:limits,colors:colors}}var GaugeHelper,twoGradientLimits=[0,1],threeGradientLimits=[0,.5,1];return GaugeHelper=Class.extend("GaugeHelper",{init:function(){this._padding=0,this._colorWidth=50,this._maxWidth=50,this._labelPadding=10,this._fontManager=new FontManager,this._fontManager.setRectLimits(100,1e3),this._bigValuesSettings={minFontSize:12,maxFontSize:60}},createBarSegments:function(segmentInfo,axis,isVertical,rect,nValue){if(!segmentInfo||0===segmentInfo.colors.length)return{shapes:[]};var i,shape,value,lastValue,fill,firstColor,secondColor,limit,valuePos,pointerScaledPos,lastLimitPos,gradientShape,shapes=[],colors=segmentInfo.colors,limits=segmentInfo.limits,width=this._colorWidth,cls={},inBounds=!1,lastLimit={value:0,gradient:!1},bgColor=new Color;for(nValue=Math.min(Math.max(nValue,0),1),limits=limits.map(function(item){return{value:(item.value-axis.getPlotMin())/(axis.getPlotMax()-axis.getPlotMin()),gradient:item.gradient}}),i=0;i<colors.length;i++)limit=limits[i]?limits[i]:{value:1,gradient:!1},value=limit.value,lastValue=0===i?0:limits[i-1].value,valuePos=axis.getPositionOfNormalizedValue(value),lastLimitPos=axis.getPositionOfNormalizedValue(lastValue),cls.current=new Color(colors[i].color),cls.next=new Color(colors[i+1]?colors[i+1].color:colors[i].color),pointerScaledPos=(nValue-lastValue)/(value-lastValue),inBounds=pointerScaledPos>=0&&1>=pointerScaledPos,isVertical?(width=rect.width<10?rect.width:this._colorWidth,shape=new Rect(this._relevantPos,valuePos,width,lastLimitPos-valuePos)):(width=this._colorWidth,shape=new Rect(lastLimitPos,this._relevantPos,valuePos-lastLimitPos,width)),gradientShape={x0:shape.x,y0:shape.y+(isVertical?shape.height:0),x1:shape.x+(isVertical?0:shape.width),y1:shape.y},lastLimit&&lastLimit.gradient&&!limit.gradient?(cls.last=Color.getBlend(cls.current,cls.last,.5),fill={gradient:getArcGradientFill(gradientShape,twoGradientLimits,[cls.last.toRGBA(),cls.current.toRGBA()])},firstColor=cls.last,secondColor=cls.current):limit.gradient?(cls.next=Color.getBlend(cls.current,cls.next,.5),lastLimit.gradient?(cls.last=Color.getBlend(cls.current,cls.last,.5),fill={gradient:getArcGradientFill(gradientShape,threeGradientLimits,[cls.last.toRGBA(),cls.current.toRGBA(),cls.next.toRGBA()])},pointerScaledPos>.5?(pointerScaledPos=(pointerScaledPos-.5)/.5,firstColor=cls.last,secondColor=cls.current):(pointerScaledPos/=.5,firstColor=cls.current,secondColor=cls.next)):(fill={gradient:getArcGradientFill(gradientShape,twoGradientLimits,[cls.current,cls.next])},firstColor=cls.current,secondColor=cls.next)):fill=cls.current.toRGBA(),inBounds&&(bgColor=fill.gradient?Color.getBlend(firstColor,secondColor,pointerScaledPos):cls.current),shape.opacity=1,shape.fill=fill,shape.stroke=fill,shapes.push(shape),cls.last=cls.current,lastLimit=limit;return{shapes:shapes,pointerBgColor:bgColor}},createBarProgress:function(nValue,axis,c,isVertical,rect){var shape,pos,width,nPos,array=[],color=new Color(c),areaColor=new Color(this.style.area.color);return nValue=isNaN(nValue)?0:nValue>1?1:0>nValue?0:nValue,pos=axis.getPositionOfValue((axis.getPlotMax()-axis.getPlotMin())*nValue+axis.getPlotMin()),this._labelPadding=this._colorWidth/2,width=this._colorWidth,nPos=this._relevantPos,shape=isVertical?new Rect(nPos,pos,width,rect.height):new Rect(0,nPos,pos,width),shape.opacity=1,shape.fill=color.toHex(),shape.stroke=color.createShiftedColor().toHex(),shape.strokeWidth=1,array.push(shape),shape=isVertical?new Rect(nPos,0,width,pos):new Rect(pos,nPos,rect.width,width),shape.opacity=1,shape.fill=areaColor.toHex(),shape.stroke=areaColor.createShiftedColor(.1).toHex(),shape.strokeWidth=1,array.push(shape),array},createGaugeMeterValue:function(pos,text,textWidth,isVertical,rect,fontHeight,font){var shape=new Text;return shape.text=text,shape.ColorWidth=200,shape.font=font,shape.opacity=1,shape.fill=this.style.value.color,isVertical?(pos+fontHeight/2>rect.height?(shape.baseline="bottom",pos=rect.height):fontHeight/2>pos?(shape.baseline="top",pos=0):shape.baseline="middle",shape.x=this._relevantPos+this._colorWidth+this._labelPadding,shape.maxWidth=rect.width-shape.x,shape.y=pos,shape.align="left"):(shape.y=this._relevantPos+this._colorWidth+this._labelPadding+fontHeight,shape.x=Math.max(Math.min(rect.width-textWidth/2,pos),textWidth/2),shape.align="center",shape.baseline="bottom"),shape},createGaugeMeterPointer:function(nValue,axis,isVertical,bgColor){var pos,outside=nValue>1?1:0>nValue?-1:0,canvasElements=[],nPos=this._relevantPos,strokeWidth=Math.max(Math.round(this._colorWidth/25),2),sparkSizeLimit=50,width=sparkSizeLimit>nPos?10:this._colorWidth,pointerWidth=Math.max(width,10)/6,fillColor=bgColor.isDark()?this.style.pointer.color.light:this.style.pointer.color.dark,outsidePointer=new Polygon,gaugePointer=new Line;return gaugePointer.opacity=1,gaugePointer.stroke=fillColor,gaugePointer.strokeWidth=strokeWidth,outsidePointer.opacity=1,outsidePointer.fill=fillColor,outsidePointer.strokeWidth=strokeWidth,nValue=nValue>1?1:0>nValue?0:nValue,pos=axis.getPositionOfValue((axis.getPlotMax()-axis.getPlotMin())*nValue+axis.getPlotMin()),isVertical?(0!==outside&&(outsidePointer.set([{x:nPos+width/2,y:pos},{x:nPos-pointerWidth+width/2,y:outside*pointerWidth*2+pos},{x:nPos+pointerWidth+width/2,y:outside*pointerWidth*2+pos}]),canvasElements.push(outsidePointer)),gaugePointer.set(nPos,pos,nPos+width,pos)):(0!==outside&&(outsidePointer.set([{y:nPos+width/2,x:pos},{y:nPos-pointerWidth+width/2,x:-outside*pointerWidth*2+pos},{y:nPos+pointerWidth+width/2,x:-outside*pointerWidth*2+pos}]),canvasElements.push(outsidePointer)),gaugePointer.set(pos,nPos,pos,nPos+width)),canvasElements.push(gaugePointer),canvasElements},updateLabelStyle:function(style,rect,styleService,chartID,path){this._bigValuesSettings={minFontSize:this.style.value.minFontSize,maxFontSize:this.style.value.maxFontSize},style.value.font=styleService.getFont(chartID,path,null,null,this._fontManager.getFontSize(rect,this._bigValuesSettings))},createRadialSegments:function(segmentInfo,axis){if(!segmentInfo||segmentInfo.colors.length<1)return[];var i,color,limit,shape,valueAngle,nextColor,fill,gradientShape,shapes=[],limits=segmentInfo.limits,colors=segmentInfo.colors,width=this._colorWidth,lastColor=colors[0].color,lastLimit={value:0,gradient:!1},lastAngle=axis._radialOptions.start,paddingToAxis=this._paddingToAxis;if(limits=limits.map(function(item){return{value:(item.value-axis.getPlotMin())/(axis.getPlotMax()-axis.getPlotMin()),gradient:item.gradient}}),width=this._colorWidth*(axis._relevantAngle>Math.PI?1:Math.sin(axis._relevantAngle/4)),this._colorWidth=width,axis._radius-width-paddingToAxis<0)return shapes;for(i=0;i<segmentInfo.colors.length;i++)limit=limits[i]?limits[i]:{value:1,gradient:!1},nextColor=colors[i+1]?colors[i+1].color:colors[i].color,color=colors[i].color,valueAngle=axis.getAngleOfNormalizedValue(limit.value),shape=new Arc(axis._centerPoint.x,axis._centerPoint.y,axis._radius-width-paddingToAxis,axis._radius-paddingToAxis,lastAngle,valueAngle,0),gradientShape={x0:shape.x3,y0:shape.y3,x1:shape.x4,y1:shape.y4},lastLimit&&lastLimit.gradient&&!limit.gradient?(nextColor=new Color(color).blend(new Color(lastColor),.5),fill={gradient:getArcGradientFill(gradientShape,twoGradientLimits,[nextColor,color])}):limit.gradient?(nextColor=new Color(color).blend(new Color(nextColor),.5),lastLimit.gradient?(lastColor=new Color(color).blend(new Color(lastColor),.5),fill={gradient:getArcGradientFill(gradientShape,threeGradientLimits,[lastColor,color,nextColor])}):fill={gradient:getArcGradientFill(gradientShape,twoGradientLimits,[color,nextColor])}):fill=color,shape.opacity=1,shape.fill=fill,shape.stroke=fill,shapes.push(shape),lastAngle=valueAngle,lastLimit=limit,lastColor=color;return shapes},createRadialGaugeMeter:function(nValue,axis){var offset,width,gaugeMeter,angle=RadialAxisHelper.getAngleOfNormalizedValue(nValue,axis),pointerWidth=Math.max(this._colorWidth,10)/6,padding=2,sign=nValue>1?-1:1;return nValue>1||0>nValue?(width=this._colorWidth*(axis._relevantAngle>Math.PI?1:Math.sin(axis._relevantAngle/4)),this._colorWidth=width,offset=-width*sign/2,gaugeMeter=new Polygon([{x:2*pointerWidth+padding,y:offset},{x:padding,y:pointerWidth+offset},{x:padding,y:-pointerWidth+offset}])):gaugeMeter=new Polygon([{x:.5*-pointerWidth+4,y:0},{x:8*-pointerWidth,y:pointerWidth},{x:8*-pointerWidth,y:-pointerWidth}]),gaugeMeter.opacity=1,gaugeMeter.translate(axis._centerPoint.x+Math.cos(angle)*axis._radius,axis._centerPoint.y+Math.sin(angle)*axis._radius),gaugeMeter.rotate(angle),(nValue>1||0>nValue)&&gaugeMeter.rotate(-sign*Math.PI/2),gaugeMeter.fill=this.style.pointer.color.dark,gaugeMeter},createRadialProgress:function(nValue,color,axis,rect){var gaugeProgress,width,offset,sign,startAngle=axis._radialOptions.start,valueAngle=isNaN(nValue)?startAngle:RadialAxisHelper.getAngleOfNormalizedValue(nValue,axis),endAngle=axis._radialOptions.end,minDim=Math.min(rect.width,rect.height),array=[],pointerWidth=(minDim>500?this._maxWidth:Math.max(minDim/500*this._maxWidth,10))/6,padding=2,paddingToAxis=this._paddingToAxis,areaColor=new Color(this.style.area.color);return color=new Color(color),width=this._colorWidth*(axis._relevantAngle>Math.PI?1:Math.sin(axis._relevantAngle/4)),this._colorWidth=width,axis._radius-width-paddingToAxis<0?array:((nValue>1||0>nValue)&&(sign=nValue>1?-1:1,offset=-width*sign/2,gaugeProgress=new Polygon([{x:2*pointerWidth+padding,y:offset},{x:padding,y:pointerWidth+offset},{x:padding,y:-pointerWidth+offset}]),gaugeProgress.opacity=1,gaugeProgress.translate(axis._centerPoint.x+Math.cos(valueAngle)*axis._radius,axis._centerPoint.y+Math.sin(valueAngle)*axis._radius),gaugeProgress.rotate(valueAngle-sign*Math.PI/2),gaugeProgress.fill=color.toHex(),array.push(gaugeProgress)),valueAngle>startAngle&&(gaugeProgress=new Arc(0,0,axis._radius-width-paddingToAxis,axis._radius-paddingToAxis,startAngle,valueAngle,0),gaugeProgress.opacity=1,gaugeProgress.translate(axis._centerPoint.x,axis._centerPoint.y),gaugeProgress.fill=color.toHex(),gaugeProgress.stroke=color.createShiftedColor().toHex(),array.push(gaugeProgress)),endAngle>valueAngle&&(gaugeProgress=new Arc(0,0,axis._radius-width-paddingToAxis,axis._radius-paddingToAxis,valueAngle,endAngle,0),gaugeProgress.opacity=1,gaugeProgress.translate(axis._centerPoint.x,axis._centerPoint.y),gaugeProgress.fill=areaColor.toHex(),gaugeProgress.stroke=areaColor.createShiftedColor(.1).toHex(),array.push(gaugeProgress)),array)},createRadialGaugeValue:function(value,text,axis,rect,font,fontHeight){var gaugeMeter=new Text;return gaugeMeter.text=text,gaugeMeter.x=rect.width/2,gaugeMeter.y=.5*rect.height-fontHeight/2+.05*Math.min(rect.width,rect.height),gaugeMeter.align="center",gaugeMeter.font=font,gaugeMeter.baseline="middle",gaugeMeter.maxWidth=1.4*axis._radius,gaugeMeter.opacity=1,gaugeMeter.fill=this.style.value.color,[gaugeMeter]},createRadialSpark:function(nValue,options,axis,rect){var i,upperLimit,base=.4*Math.min(rect.width,rect.height),angle=RadialAxisHelper.getAngleOfNormalizedValue(nValue,axis)+Math.PI/2,lowerLimit=0,gauge=new Polygon;if(gauge.opacity=1,"string"!=typeof options)if(1===options.colors.length)gauge.fill=options.colors[0].color;else for(i=0;i<options.colors.length;i++){if(upperLimit=options.limits[i]?(options.limits[i].value-axis.getPlotMin())/(axis.getPlotMax()-axis.getPlotMin()):1,nValue>=lowerLimit&&upperLimit>nValue){gauge.fill=options.colors[i].color;break}lowerLimit=upperLimit}else gauge.fill=options;return rect.width<rect.height?gauge.set([{x:0,y:-base},{x:-base/2,y:+base/2},{x:base/2,y:+base/2},{x:0,y:-base}]):gauge.set([{x:-base/2,y:base/2},{x:0,y:-base},{x:+base/2,y:base/2},{x:-base/2,y:base/2}]),gauge.translate(axis._centerPoint.x,axis._centerPoint.y),gauge.rotate(angle),[gauge]},getGaugeWidth:function(rect,isVertical){var dim;return rect&&(dim=isVertical?"width":"height",this._colorWidth=rect[dim]>500?this._maxWidth:Math.max(rect[dim]/500*this._maxWidth,10)),this._colorWidth},updateSize:function(rect,isVertical,isRadial){var relevantDimensionSize,minDim=Math.min(rect.width,rect.height);relevantDimensionSize=isRadial?minDim:isVertical?rect.width:rect.height,this._colorWidth=relevantDimensionSize>500?this._maxWidth:Math.max(relevantDimensionSize/500*this._maxWidth,10),this._relevantPos=(relevantDimensionSize-this._colorWidth)/2,this._paddingToAxis=Math.min(6,minDim/200)},getPaddingToAxis:function(){return this._paddingToAxis},getRelevantPos:function(){return this._relevantPos},getPadding:function(){return this._padding}})}),define("extensions.qliktech/gauge/gaugearea",["jquery","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/gauge/gauge-helper","core.utils/theme","general.utils/color","core.utils/deferred"],function($,ChartComponent,Renderer,ChartStyleService,GaugeHelper,Theme,Color,Deferred){"use strict";function paintBarGauge(text,value){if(!this._axis||!this._segmentInfo||void 0===this._axis.getPlotMin()||void 0===this._axis.getPlotMax())return Deferred.resolve();var helperOutput,axis=this._axis,bigFont=this._style.value.font,isVertical=axis.isVertical(),fontHeight=Renderer.getFontHeight(bigFont),textWidth=this.renderers.gauge.getTextWidth(text,bigFont),gaugePos=this._axis.getPositionOfValue(value),nValue=(value-axis.getPlotMin())/(axis.getPlotMax()-axis.getPlotMin()),canvasShapes=[];return this._data.useSegments?(helperOutput=this._gaugeHelper.createBarSegments(this._segmentInfo,axis,isVertical,this.rect,nValue),canvasShapes=helperOutput.shapes,canvasShapes=canvasShapes.concat(this._gaugeHelper.createGaugeMeterPointer(nValue,axis,isVertical,helperOutput.pointerBgColor))):(canvasShapes=this._gaugeHelper.createBarProgress(nValue,axis,this._progressColor,isVertical,this.rect),(nValue>1||0>nValue)&&(canvasShapes=canvasShapes.concat(this._gaugeHelper.createGaugeMeterPointer(nValue,axis,isVertical,new Color(nValue>1?this._progressColor:this._style.area.color))))),!isNaN(nValue)&&(isVertical&&this.rect.width>100||!isVertical&&this.rect.height>100)&&canvasShapes.push(this._gaugeHelper.createGaugeMeterValue(gaugePos,text,textWidth,isVertical,this.rect,fontHeight,bigFont)),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(canvasShapes),this.renderers.gauge.render()}function paintRadialGauge(text,value){if(!this._axis||!this._segmentInfo&&this._data.useSegments||this._axis._radius<=0)return Deferred.resolve();var axis=this._axis,bigFont=this._style.value.font,fontHeight=Renderer.getFontHeight(bigFont),minDim=Math.min(this.rect.height,this.rect.width),nValue=(value-axis.getPlotMin())/(axis.getPlotMax()-axis.getPlotMin()),canvasShapes=[];return 50>minDim?canvasShapes=this._gaugeHelper.createRadialSpark(nValue,this._data.useSegments?this._segmentInfo:this._progressColor,axis,this.rect):(this._data.useSegments?(canvasShapes=this._gaugeHelper.createRadialSegments(this._segmentInfo,axis),isNaN(nValue)||canvasShapes.push(this._gaugeHelper.createRadialGaugeMeter(nValue,axis))):canvasShapes=this._gaugeHelper.createRadialProgress(nValue,this._progressColor,axis,this.rect),canvasShapes=canvasShapes.concat(this._gaugeHelper.createRadialGaugeValue(value,text,axis,this.rect,bigFont,fontHeight))),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(canvasShapes),this.renderers.gauge.render()}function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:"number"==typeof input?"#000":input}function updateStyles(styleService){var localStyle={value:{color:styleService.getValue(chartID,"value","color"),font:styleService.getFont(chartID,"value"),minFontSize:styleService.getValue(chartID,"value","minFontSize"),maxFontSize:styleService.getValue(chartID,"value","maxFontSize")},area:{color:styleService.getValue(chartID,"area","backgroundColor")},pointer:{color:{light:styleService.getValue(chartID,"pointer","color","light"),dark:styleService.getValue(chartID,"pointer","color","dark")}}};return localStyle}var GaugeArea,chartID="gauge";return GaugeArea=ChartComponent.extend({init:function(){this._super.apply(this,arguments),this._gaugeHelper=new GaugeHelper,this._type="bar",this._currentProperties={},this._transitionProperties={},this._inTransition=!1,this._cacheItems=[],this.renderers={gauge:new Renderer(this.container)},this._styleService=ChartStyleService.getInstance(),this._style=updateStyles(this._styleService),this._gaugeHelper.style=this._style},_updateSize:function(){this.invalidateDisplay("Gauge._updateSize")},_updateProperties:function(){if(this._data){var data=this._data;this._segmentInfo=$.extend(!0,{},data.segmentInfo),this._segmentInfo&&this._segmentInfo.limits&&(this._segmentInfo.limits=this._segmentInfo.limits.concat().sort(function(a,b){return a.value-b.value})),this._segmentInfo&&this._segmentInfo.colors&&(this._segmentInfo.colors=this._segmentInfo.colors.concat().map(function(item){return{color:resolveColor(item.color)}})),this._progressColor=resolveColor(this._data.progressColor),this._orientation=data.orientation,this._type=data.gaugetype,this._transitionProperties={value:data.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,text:data.qHyperCube.qDataPages[0].qMatrix[0][0].qText},this._super()}},hasValidData:function(){return this._super()&&this._data},setAxis:function(ax){this._axis=ax,this._axis.listen("changed",function(){this.invalidateDisplay()},this)},setRefLines:function(r){this._refLines=r},setRefLineLabels:function(r){this._refLineLabels=r},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},paint:function(){if(!this._axis)return Deferred.resolve();var dfds=[];this._gaugeHelper.updateSize(this.rect,this._axis.isVertical(),this._axis.isRadial()),this._refLines&&(this._refLines.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLines.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._refLineLabels&&(this._refLineLabels.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLineLabels.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._gaugeHelper.updateLabelStyle(this._style,this.rect,this._styleService,chartID,"value");var node=this._data.qHyperCube.qDataPages[0].qMatrix[0][0],formatter=this.measureFormatters[0],text="U"!==formatter.type?node.qText:formatter.formatValue(node.qNum),value=this._currentProperties.value;return this._inTransition&&(text=formatter.format(value)),this._axis.isRadial()?dfds.push(paintRadialGauge.apply(this,[text,value])):dfds.push(paintBarGauge.apply(this,[text,value])),this._currentValue=value,this._refLines&&this._refLineLabels&&(this._refLines.setGaugeWidth(this._gaugeHelper.getGaugeWidth()),this._refLineLabels.setGaugeWidth(this._gaugeHelper.getGaugeWidth())),Deferred.all(dfds)},afterPaint:function(){},clear:function(){},getGaugeWidth:function(rect,isVertical){return this._gaugeHelper.getGaugeWidth(rect,isVertical)}}),Object.defineProperty(GaugeArea.prototype,"className",{value:"GaugeArea"}),GaugeArea}),define("extensions.qliktech/gauge/gauge-ref-lines",["objects.views/charts/components/ref-lines","core.utils/theme"],function(RefLines,Theme){"use strict";function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:input}var GaugeRefLines;return GaugeRefLines=RefLines.extend("GaugeRefLines",{namespace:".gaugereflines",init:function(){this._super.apply(this,arguments),this._width=50},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),this._hasVisibleRefLines){var i,j,axisRefLinesData,axis,axisPlotMinValue,axisPlotMaxValue,refValue,position,x1,y1,x2,y2,color,radius,angle,shapeWrappers=[],paddingToAxis=this._paddingToAxis,relevantPos=this._relevantPos;for(i=0;i<this._numRefLinesDataAxes;i+=1)for(axisRefLinesData=this._data[i],axis=this._axes[i],axisPlotMinValue=this._axisPlotMinValues[i],axisPlotMaxValue=this._axisPlotMaxValues[i],j=0;j<axisRefLinesData.length;j+=1)axisRefLinesData[j].show&&void 0!==axisRefLinesData[j].refLineExpr&&(refValue=this._currentProperties["value"+i+j],refValue>axisPlotMaxValue||axisPlotMinValue>refValue||(axis.isRadial()?(radius=axis._radius,angle=axis.getAngleOfValue(refValue),x1=axis._centerPoint.x+Math.cos(angle)*(radius-paddingToAxis),y1=axis._centerPoint.y+Math.sin(angle)*(radius-paddingToAxis),x2=axis._centerPoint.x+Math.cos(angle)*(radius-paddingToAxis-this._width),y2=axis._centerPoint.y+Math.sin(angle)*(radius-paddingToAxis-this._width)):(position=axis.getPositionOfValue(refValue),position=Math.floor(position)-.5,axis.isVertical()?(x1=relevantPos,y1=position,x2=relevantPos+this._width,y2=position):(x1=position,y1=relevantPos,x2=position,y2=relevantPos+this._width)),color=void 0!==axisRefLinesData[j].color?resolveColor(axisRefLinesData[j].color):"#000000",shapeWrappers.push({type:"line",stroke:color,strokeWidth:1,shape:{x1:x1,y1:y1,x2:x2,y2:y2}})));this.renderer.shapes=shapeWrappers,this.renderer.render()}},setGaugeWidth:function(w){this._width=w,this.updateSize(),this.invalidateDisplay()},setPaddingToAxis:function(p){this._paddingToAxis=p},setRelevantPos:function(p){this._relevantPos=p}})}),define("extensions.qliktech/gauge/gauge-ref-line-labels",["objects.views/charts/components/ref-line-labels","objects.views/charts/utils/canvas-renderer","core.utils/theme"],function(RefLineLabels,CanvasRenderer,Theme){"use strict";function getRefLabel(ref){return String(void 0!==ref.label?ref.label:ref)}function resolveColor(input){return Theme.palette[input]?Theme.palette[input]:input}var GaugeRefLineLabels;return GaugeRefLineLabels=RefLineLabels.extend("GaugeRefLineLabels",{init:function(){this._super.apply(this,arguments)},paint:function(){if(!this._axis)return void this._clearLabels();if(this._axis.updateNow(["properties"]),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues.call(this)),!this._hasVisibleRefLines)return void this._clearLabels();var i,refValue,refLabel,position,x,y,text,color,shapeWrapper,numLabels,formattedValueString,engineFormattedString,align,radius,angle,shape,shapeWidth,labelDimension,halfLabelWidth,halfLabelHeight,baseline="bottom",relevantPos=this._relevantPos,labelObjects=[],shapeWrappers=[],axis=this._axis;for(i=0;i<this._data.length;i+=1)this._data[i].show&&void 0!==this._data[i].refLineExpr&&(refValue=this._currentProperties["value"+i],refLabel=getRefLabel(this._data[i].refLineExpr),void 0===refValue||isNaN(refValue)||refValue<this._axis.getPlotMin()||refValue>this._axis.getPlotMax()||(shape={font:this._font,maxWidth:this._labelMaxWidthForYAxis,maxNumLines:3},engineFormattedString=refLabel,formattedValueString=engineFormattedString.replace(/[0-9]|\.|\-|\+|e/g,""),formattedValueString=formattedValueString.length?engineFormattedString:axis.format(refValue),text=this._data[i].label+" ("+formattedValueString+")",color=void 0!==this._data[i].color?resolveColor(this._data[i].color):"#000000",shape.text=text,labelDimension=CanvasRenderer.measureTextObject({shape:shape}),axis.isRadial()?(radius=axis._radius,angle=axis.getAngleOfValue(refValue),x=axis._centerPoint.x+Math.cos(angle)*radius,y=axis._centerPoint.y+Math.sin(angle)*radius,align=angle>Math.PI/2&&angle<3*Math.PI/2?"right":"left",baseline=angle>Math.PI&&angle<2*Math.PI?"bottom":"top",shapeWidth=labelDimension.width,0>x-shapeWidth?(shape.maxWidth+=x-shapeWidth,x=shape.maxWidth):x+shapeWidth>this.rect.width&&(shape.maxWidth=shapeWidth+(this.rect.width-(x+shapeWidth)))):(position=axis.getPositionOfValue(refValue),position=Math.floor(position)-.5,halfLabelHeight=labelDimension.height/2,axis.isVertical()?(align="left",baseline="middle",x=relevantPos+this._width+4,y=halfLabelHeight>position?position+(halfLabelHeight-position+4):position>this.rect.height-halfLabelHeight?position-(position-(this.rect.height-halfLabelHeight-4)):position):(align="center",y=relevantPos+this._width,baseline="top",halfLabelWidth=labelDimension.width/2,x=halfLabelWidth>position?position+(halfLabelWidth-position+4):position>this.rect.width-halfLabelWidth?position-(position-(this.rect.width-halfLabelWidth-4)):position)),shape.x=x,shape.y=y,shape.align=align,shape.baseline=baseline,shapeWrapper={type:"text",fill:color,shape:shape},shapeWrappers.push(shapeWrapper),labelObjects.push({position:position,shapeWrapper:shapeWrapper})));return numLabels=labelObjects?labelObjects.length:0,0===numLabels?void this._clearLabels():(this.renderer.shapes=shapeWrappers,void this.renderer.render())},setGaugeWidth:function(w){this._width=w,this.invalidateDisplay()},setPaddingToAxis:function(p){this._paddingToAxis=p},setRelevantPos:function(p){this._relevantPos=p},_clearLabels:function(){this.renderer.shapes&&this.renderer.shapes.length&&(this.renderer.shapes=[],this.renderer.render())}})}),define("text!extensions.qliktech/gauge/gauge.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-popup-disclaimer ng-if="!!dataAttributes.popupDisclaimer.show" pop-close="dataAttributes.popupDisclaimer.onPopClose" pop-message="dataAttributes.popupDisclaimer.message" pop-title="dataAttributes.popupDisclaimer.title" />\r\n'}),define("extensions.qliktech/gauge/gauge-properties",["translator","general.utils/property-resolver"],function(translator,propertyResolver){var data,settings,oldOrientation;data={uses:"data"},settings={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(data){return data.measureAxis&&data.measureAxis.min>=data.measureAxis.max},change:function(data){propertyResolver.setValue(data,"disclaimerClosed",!0)}},max:{ref:"measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(data){return data.measureAxis&&data.measureAxis.min>=data.measureAxis.max},change:function(data){propertyResolver.setValue(data,"disclaimerClosed",!0)}}}},type:{ref:"gaugetype",type:"string",component:"item-selection-list",defaultValue:"radial",horizontal:!0,items:[{icon:"¬",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.radial",value:"radial"},{icon:"¡",component:"icon-item",labelPlacement:"bottom",
translation:"properties.gauge.bar",value:"bar"}],change:function(data){"radial"===data.gaugetype?(oldOrientation=data.orientation,data.orientation="horizontal"):data.orientation=oldOrientation}},autoOrientation:{ref:"autoOrientation",translation:"properties.orientation",type:"boolean",defaultValue:!0,component:"switch",undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(data){return"bar"===data.gaugetype}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"ƒ",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"√",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(data){return"bar"===data.gaugetype&&!data.autoOrientation}},angle:{ref:"angle",translation:"properties.gauge.angle",type:"number",component:"slider",min:.2,max:.98,step:.1,defaultValue:.7,show:function(){return!1}},segments:{type:"items",items:{useSegments:{ref:"useSegments",type:"boolean",defaultValue:!1,translation:"properties.gauge.useSegments",change:function(data){data.useSegments&&1===data.segmentInfo.colors.length?data.segmentInfo.colors=[{color:data.progressColor}]:data.progressColor=data.segmentInfo.colors[0].color}},progressColor:{component:"color-picker",translation:"properties.color",ref:"progressColor",type:"integer",defaultValue:3,show:function(data){return!data.useSegments}},valueMode:{ref:"valueMode",translation:"properties.value",type:"string",component:"dropdown",options:[{value:"absolute",translation:"properties.gauge.absolute"},{value:"relative",translation:"properties.gauge.relative"}],show:function(){return!1},defaultValue:"absolute"},maxSegments:{ref:"maxSegments",type:"number",defaultValue:6,show:!1},segmentInfo:{ref:"segments",type:"items",component:"color-scale-creator",show:function(data){return data.useSegments},items:{limits:{ref:"segmentInfo.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(data,properties){return"number"==typeof data.value&&(data.value<properties.measureAxis.min||data.value>properties.measureAxis.max)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:3}},type:"array",ref:"segmentInfo.colors"}}}}},disclaimerClosed:{ref:"disclaimerClosed",type:"boolean",defaultValue:!1,show:!1}}},measureAxis:{type:"items",label:function(properties,handler){var label,measure=handler.getMeasureLayouts()[0];return label=measure?translator.get("properties.measureAxisWithInfo",[measure.qFallbackTitle]):translator.get("properties.measureAxis")},grouped:!0,items:{axis:{type:"items",snapshot:{title:"properties.measureAxis",tid:"property-yAxis"},items:{show:{ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",type:"string",component:"dropdown",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,show:function(data){return data.measureAxis&&"none"!==data.measureAxis.show&&"title"!==data.measureAxis.show},options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}]}}}}}}};var addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}},refLines:{uses:"reflines"}}};return{type:"items",component:"accordion",items:{data:data,addons:addons,settings:settings}}}),define("text!extensions.qliktech/gauge/popup-disclaimer.ng.html",[],function(){return'<div class="qv-popup-disclaimer">\r\n	<div class="icon-close-button" qva-activate="onClose()"></div>\r\n	<header class="dm-header">{{popTitle}}</header>\r\n	<main class="dm-main">\r\n		<p class="dm-p">{{popMessage}}</p>\r\n	</main>\r\n</div>'}),define("extensions.qliktech/gauge/popup-disclaimer",["assets/qvangular/qvangular-core","text!extensions.qliktech/gauge/popup-disclaimer.ng.html"],function(qvangular,template){qvangular.directive("qvaPopupDisclaimer",function(){return{template:template,replace:!0,scope:{popMessage:"=",popTitle:"=",popClose:"="},link:function($scope){$scope.onClose=function(){$scope.popClose()}}}})}),define("extensions.qliktech/gauge/gauge",["jquery","translator","objects.views/charts/chart","core.utils/deferred","extensions.qliktech/gauge/gaugearea","extensions.qliktech/gauge/gauge-ref-lines","extensions.qliktech/gauge/gauge-ref-line-labels","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","client.utils/state","objects.backend-api/hypercube-api","text!./gauge.ng.html","extensions.qliktech/gauge/gauge-properties","objects.extension/object-conversion","extensions.qliktech/gauge/popup-disclaimer"],function($,translator,Chart,Deferred,GaugeArea,GaugeRefLines,GaugeRefLineLabels,ChartComponent,ContinuousAxis,State,HypercubeApi,template,gaugePropertiesDefinition,objectConversion){"use strict";function updateAxisRect(){var gaugeArea=this.components.dataArea,rect=gaugeArea.rect,limit=80,axisRect=$.extend({},rect),axis=this.components.axis,axisSize=axis.relevantSize;"vertical"===this._orientation?(axisRect.x=rect.width/2-gaugeArea.getGaugeWidth(gaugeArea.rect,"vertical"===this._orientation)/2-axisSize,axisRect.x<0?(axisRect.width=axisSize+axisRect.x,axisRect.x=0):axisRect.width=axisSize):(axisRect.y=rect.height/2-gaugeArea.getGaugeWidth(gaugeArea.rect,"vertical"===this._orientation)/2-axisSize,axisRect.y<0?(axisRect.height=axisSize+axisRect.y,axisRect.y=0):axisRect.height=axisSize),(rect.width<limit||rect.height<limit)&&(axisRect["vertical"===this._orientation?"width":"height"]=0),axis.rect=axisRect}var Gauge;return Gauge=Chart.extend("Gauge",{namespace:".gauge",init:function($scope,$element,options,backendApi){var self=this;options=$.extend(!0,options||{},{providers:{},components:{axis:{show:!0,order:0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.SPARK,clazz:ContinuousAxis},dataArea:{show:!0,order:1,dock:"center",clazz:GaugeArea,showFlag:ChartComponent.prototype.ShowFlags.SPARK},gaugeRefLines:{sortKey:5,show:!0,dock:"center",showFlag:ChartComponent.prototype.ShowFlags.XSMALL},gaugeRefLineLabels:{show:!0,dock:"center",order:3,showFlag:ChartComponent.prototype.ShowFlags.XSMALL}}}),this._type="vertical",this._orientation="horizontal",this._super($scope,$element,options,backendApi),this.components.dataArea.setAxis(this.components.axis),this.components.axis.setAlignment("near"),this.components.axis.setDataRangeTransition(!0),this.components.axis.setShowLine(!1),this.components.gaugeRefLines=new GaugeRefLines(this.container),this.components.gaugeRefLines.showFlag=ChartComponent.prototype.ShowFlags.XSMALL,this.components.gaugeRefLines.setUseTransition(!0),this.components.dataArea.setRefLines(this.components.gaugeRefLines),this.layoutEngine.addComponent(this.components.gaugeRefLines),this.components.gaugeRefLineLabels=new GaugeRefLineLabels(this.container),this.components.gaugeRefLineLabels.showFlag=ChartComponent.prototype.ShowFlags.SMALL,this.components.gaugeRefLineLabels.setUseTransition(!0),this.components.dataArea.setRefLineLabels(this.components.gaugeRefLineLabels),this.layoutEngine.addComponent(this.components.gaugeRefLineLabels),this.$scope.dataAttributes.popupDisclaimer={show:!1,message:translator.get("Object.Gauge.RangeIsDefault"),title:translator.get("Object.Gauge.RangeIsDefaultTitle"),onPopClose:function(){self.$scope.backendApi.model.getProperties().then(function(properties){properties.disclaimerClosed=!0,self.$scope.backendApi.model.save()})}}},_updateData:function(data){if(this._type=data.gaugetype,this._orientation=data.autoOrientation&&"bar"===data.gaugetype?this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal":data.orientation,data.refLine){var options={axes:{axis:{component:this.components.axis,data:data.axis,dataIndices:data.qHyperCube.qMeasureInfo.map(function(measure,idx){return idx})}},refLineLabels:{labels:{data:data.refLine.refLines,component:this.components.gaugeRefLineLabels,axis:this.components.axis}},refLines:{component:this.components.gaugeRefLines}};this._super(data,options),this.components.dataArea.setData(data),this.updateAxis(data,this.options),this.updateRefLines(data,options)}else this.components.dataArea.setData(data),this.updateAxis(data,this.options),this._super(data)},updateRefLines:function(data,options){var key,refLineLabels=options.refLineLabels,axesData=[],axes=[];for(key in refLineLabels)refLineLabels[key].component&&(refLineLabels[key].component.setData(refLineLabels[key].data),refLineLabels[key].component.setAxis(refLineLabels[key].axis),refLineLabels[key].component.setDock(refLineLabels[key].axis.getOppositeDock()),axes.push(refLineLabels[key].axis),axesData.push(refLineLabels[key].data));options.refLines&&options.refLines.component&&(options.refLines.component.setAxes([options.axes.axis.component]),options.refLines.component.setData([data.refLine.refLines]))},isValid:function(data){var component,valid=!1;valid=!!data&&!!data.qHyperCube&&data.qHyperCube.qMeasureInfo.length&&!data.qHyperCube.qMeasureInfo.some(function(m){return!!m.qError});for(component in this.components)this.components[component].setHasValidData(valid);return valid},updateAxis:function(data){var min,max,start,end,measureName,minMax,axisData=data.measureAxis,axis=this.components.axis;min=Math.min.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return v.qMin})),max=Math.max.apply(this,data.qHyperCube.qMeasureInfo.filter(function(v){return!isNaN(v.qMax)}).map(function(v){return v.qMax})),measureName=data.qHyperCube.qMeasureInfo.map(function(measure){return measure.qFallbackTitle}).join(", "),axis.setData(data),axis.setTitle(measureName),axis.setShowStrategy(axisData.show),axis.setLabelMode(axisData.label),axis.setOrientation("bar"===this._type?this._orientation:"horizontal"),axis.setPlotMin&&(minMax=this.getAxisOptions(axisData),axis.setPlotMin(minMax.min),axis.setPlotMax(minMax.max),axis.setTickMultiplier(axisData.spacing),axis.setLogScale(axisData.logarithmic)),min===max&&0===max&&(max=1,min=0),max=Math.max(0,max),min=Math.min(0,min),this.setAxisDataRange(axis,max,min,minMax.max,minMax.min,1),start=-Math.PI*(data.angle+.5),end=Math.PI*(data.angle-.5),end+=0>start?2*Math.PI:0,start+=0>start?2*Math.PI:0,this.components.axis.setRadial("radial"===this._type,{start:start,end:end})},getAxisOptions:function(axisData){return axisData?{min:Number(axisData.min),max:Number(axisData.max)}:void 0},setAxisDataRange:function(axis,max,min,emax,emin,shift){null!==emax&&null!==emin||null===emax&&null===emin?axis.setDataRange(min,max):null!==emax&&min>=emax?axis.setDataRange(emax-shift,max):null!==emin&&emin>=max?axis.setDataRange(min,emin+shift):axis.setDataRange(min,max)},_paint:function(){var key,dfds=[];if(!this.isValid(this._data))return this.clear();if(this._super(),this.layout(),this.$scope.dataAttributes.popupDisclaimer){var disclaimerClosed=this._data.disclaimerClosed||this._data.maxMinChanged;!State.isInEditMode()||this._layoutMode<7||disclaimerClosed?this.$scope.dataAttributes.popupDisclaimer.show=!1:this.$scope.dataAttributes.popupDisclaimer.show=!0}for(key in this.components)dfds.push(this.components[key].invalidateDisplay());return Deferred.all(dfds)},layout:function(){var axis=this.components.axis,foo=axis.updateSize;axis.updateSize=function(){},this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect),axis.updateSize=foo,this._data&&this._data.autoOrientation&&"bar"===this._data.gaugetype&&(this._orientation=this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal",this.components.axis.setOrientation(this._orientation)),axis.preRelevantSizeCalculation(),axis.calculatePreliminaryRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),axis.calculateRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),this.components.axis.isRadial()||updateAxisRect.call(this),axis.updateSize()}}),{type:"gauge",BackendApi:HypercubeApi,template:template,View:Gauge,definition:gaugePropertiesDefinition,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:1}],qSuppressMissing:!0},segmentInfo:{limits:[],colors:[{color:3}]}},data:{measures:{min:1,max:1}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(builder,propertyHandler,model,showMenu,object){builder.AddFieldAsMeasure(model,propertyHandler,object),showMenu()},getDropDimensionOptions:function(builder,propertyHandler,model,showMenu){showMenu()},importProperties:objectConversion.axisChart.importProperties.bind(objectConversion),exportProperties:objectConversion.axisChart.exportProperties.bind(objectConversion)}}),define("text!extensions.qliktech/kpi/kpi.ng.html",[],function(){return'<div qv-extension class="kpi qv-viz" qva-activate="onShowVerifyDialog()" ng-class="{link : linkInteractionOn && interactionOn}">\r\n	<div ng-show="baseLayoutInfo.components[0].show" class="measure-wrapper" ng-class="textAlign" ng-style="measureTitleStyle">\r\n		<div class="measure-title ellips-text" title="{{measureTitle}}">\r\n			<span ng-bind="measureTitle"></span>\r\n			<i class="icon-info" ng-if="linkInteractionOn" title="{{sheetLinkTitle}}"></i>\r\n		</div>\r\n	</div>\r\n	<div class="value-wrapper" ng-class="textAlign">\r\n		<div class="ellips-text">\r\n			<qv-kpi-value value="mainValue.value" formatted-value="mainValue.formattedValue" value-style="mainValue.style" formatter="mainValue.formatter" glyph="mainValue.glyph" show-glyph="mainValue.showGlyph" />\r\n		</div>\r\n		<div ng-show="baseLayoutInfo.components[1].components[1].components[0].show" class="secondary-wrapper ellips-text" ng-repeat="secondaryValue in secondaryValues">\r\n			<qv-kpi-value value="secondaryValue.value" formatted-value="secondaryValue.formattedValue" value-style="secondaryValue.style" title-style="secondaryValue.titleStyle" formatter="secondaryValue.formatter" glyph="secondaryValue.glyph" show-glyph="secondaryValue.showGlyph" measure-title="secondaryValue.measureTitle" />\r\n		</div>\r\n	</div>\r\n	<!--\r\n	<div ng-show="useViz" class="visualization">\r\n		<qv-object class="cell-content" model="viz.model" options="viz.options"></qv-object>\r\n	</div>\r\n	-->\r\n\r\n	<div class="click-again-overlay" ng-class="{show : showVerifyDialog}" ng-style="verifyDialogStyle" qva-activate="linkToSheet()">\r\n		<span q-translation="properties.kpi.verifyToGoSheet"></span>\r\n		<span class="sheetLinkTitle ellips-text" ng-bind="sheetLinkTitle"></span>\r\n	</div>\r\n\r\n</div>\r\n'}),define("extensions.qliktech/kpi/kpi-properties",[],function(){var data,settings;data={uses:"data",addTranslation:"Visualization.Requirements.AddMeasure",items:{measures:{items:{conditionalColoringContainer:{type:"items",grouped:!0,items:{conditionalColoring:{type:"items",ref:"qDef.conditionalColoring",show:function(){return!0},items:{useConditionalColoring:{ref:"qDef.conditionalColoring.useConditionalColoring",component:"switch",type:"boolean",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],translation:"properties.kpi.conditionalColoring",defaultValue:!1,change:function(data){data.qDef.conditionalColoring&&data.qDef.conditionalColoring.useConditionalColoring&&1===data.qDef.conditionalColoring.segments.colors.length?data.qDef.conditionalColoring.segments.colors[0].color=data.qDef.conditionalColoring.singleColor:data.qDef.conditionalColoring.singleColor=data.qDef.conditionalColoring.segments.colors[0].color}},singleColorColoring:{component:"color-picker",translation:"properties.color",ref:"qDef.conditionalColoring.singleColor",type:"integer",defaultValue:3,show:function(data){return data.qDef.conditionalColoring&&!data.qDef.conditionalColoring.useConditionalColoring}},rangeLimits:{type:"items",items:{min:{ref:"qDef.measureAxis.min",translation:"properties.axis.min",type:"number"},max:{ref:"qDef.measureAxis.max",translation:"Common.Max",type:"number",defaultValue:100}},show:function(){return!1}},segmentInfo:{ref:"qDef.conditionalColoring.segments",type:"items",component:"color-scale-creator",conditionalColoringRef:{props:"qHyperCubeDef.qMeasures",layout:"qHyperCube.qMeasureInfo"},useGlyph:!0,useAutoMinMax:!0,show:function(data){return data.qDef.conditionalColoring.useConditionalColoring},items:{limits:{ref:"qDef.conditionalColoring.segments.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(data){return isNaN(data.value)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{type:"array",ref:"qDef.conditionalColoring.segments.colors",defaultValue:[{color:2}],items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:2},icon:{ref:"icon",type:"string",defaultValue:"",show:!1}}}}}}}}}}}}},settings={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{showMeasureTitle:{ref:"showMeasureTitle",component:"checkbox",translation:"properties.ShowTitle",defaultValue:!0},textAlign:{ref:"textAlign",type:"string",component:"dropdown",translation:"properties.Alignment",options:[{value:"left",translation:"properties.dock.left"},{value:"center",translation:"Common.Center"},{value:"right",translation:"properties.dock.right"}],defaultValue:"center"},fontSize:{ref:"fontSize",type:"string",component:"dropdown",translation:"MediaTool.Toolbar.FontSize",options:[{value:"S",translation:"Common.Small"},{value:"M",translation:"Common.Medium"},{value:"L",translation:"Common.Large"}],defaultValue:"M"},linkToSheet:{type:"items",items:{useLink:{ref:"useLink",type:"boolean",component:"switch",translation:"properties.kpi.linkToSheet",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},kpiLink:{ref:"kpiLink",type:"items",component:"sheet-dropdown",items:{id:{ref:"kpiLink.id",type:"string"},title:{ref:"kpiLink.title",type:"string"}},show:function(data){return data.useLink}}}}}}}};var addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:data,addons:addons,settings:settings}}}),define("core.models/generic-object",["core.models/base-object","core.utils/deferred","util"],function(BaseObject,Deferred,util){"use strict";var GenericObject;return GenericObject=BaseObject.extend("GenericObject",{createChild:function(props,propForThis,Model){var session=this.session,params=[props];return Model=Model||GenericObject,propForThis&&params.push(propForThis),props.qInfo.qId=props.qInfo.qId||util.generateId(),this.rpc("CreateChild",null,params).then(function(result){return Model.getModel(result.qInfo.qId,session,function(){return Deferred.resolve(result.qReturn)})})},removeChild:function(id,propForThis){return GenericObject.remove(id,"DestroyChild",this,propForThis)},setChildArrayOrder:function(childIds){var params=[childIds];return this.rpc("SetChildArrayOrder",null,params)},removeAllChildren:function(propForThis){var params=[];return propForThis&&params.push(propForThis),this.rpc("DestroyAllChildren",null,params)},copyFrom:function(fromId){return this.rpc("CopyFrom",null,[fromId])},applyPatches:function(qPatches,qSoftPatch){return this.rpc("ApplyPatches",null,[qPatches,qSoftPatch])},clearSoftPatches:function(){return this.rpc("ClearSoftPatches")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])},exportData:function(fileType,path,filename,exportState){fileType=fileType||"OOXML",path=path||"",filename=filename||"",exportState=exportState||"P";var params=[fileType,path,filename,exportState];return this.rpc("ExportData",null,params,{raw:!0})},cancelRequest:function(requestId){var that=this,pendingRequest=that.session.getRequest(requestId);return that.session.rpc({method:"CancelRequest",handle:-1,params:[requestId]}).then(function(){pendingRequest&&"GetLayout"===pendingRequest.method&&that.setState(GenericObject.States.CANCELLED)})}})}),define("objects.models/visualization-object",["core.models/app","core.models/generic-object"],function(App,GenericObject){"use strict";var VisualizationObject;return VisualizationObject=GenericObject.extend("VisualizationObject",{init:function(){this._super.apply(this,Array.prototype.slice.apply(arguments))}}),VisualizationObject.create=function(props,parent,propsForParent){return parent=parent||App.current,parent.createChild?parent.createChild(props,propsForParent,this):GenericObject.create.call(this,props)},VisualizationObject.createTransient=function(props,app){app=app||App.current;var Model=this;return app.createSessionObject(props).then(function(result){return new Model({id:null,handle:result.qHandle,session:app.session})})},VisualizationObject.remove=function(id,parent,propsForParent){var method=null;parent&&parent.removeChild&&(method="DestroyChild"),GenericObject.remove.call(this,id,method,parent,propsForParent)},VisualizationObject.extend=function(){var ctor=GenericObject.extend.apply(this,arguments);return ctor.extend=VisualizationObject.extend,ctor.create=VisualizationObject.create,ctor.createTransient=VisualizationObject.createTransient,ctor.remove=VisualizationObject.remove,ctor},VisualizationObject}),define("extensions.qliktech/kpi/kpi-layout",["objects.views/charts/utils/canvas-renderer"],function(CanvasRenderer){function getDirection(layoutInfo,parentHeight,parentWidth){var direction,layoutRatio=layoutInfo.ratio?layoutInfo.ratio:1,ratio=parentHeight/parentWidth;return direction=layoutInfo.direction===Direction.ROW?layoutRatio>ratio?Direction.COLUMN:Direction.ROW:layoutRatio>ratio?Direction.ROW:Direction.COLUMN}function checkLayout(layoutInfo){if(!layoutInfo.components||0===layoutInfo.components.length)return layoutInfo;var size,sizeValue,i,component,componentBoundingBox,accumulatedSize=0,parentHeight=layoutInfo.boundingBox.height,parentWidth=layoutInfo.boundingBox.width,parentDirection=layoutInfo.direction,direction=getDirection(layoutInfo,parentHeight,parentWidth);for(layoutInfo.components.forEach(function(component){component.direction=component.direction?component.direction:direction,size=component.size.min?component.size.min:component.size?component.size:0,"function"==typeof component.isVisible&&!component.isVisible()||size*parentHeight<(component.size.treshold&&component.size.treshold.height?component.size.treshold.height:10)||parentWidth<(component.size.treshold&&component.size.treshold.width?component.size.treshold.width:10)?component.show=!1:(accumulatedSize+=size,component.show=!0)}),i=layoutInfo.components.length-1;i>=0;i--)component=layoutInfo.components[i],1>accumulatedSize?component.size.stretch&&(component.size.value=component.size.min+(1-accumulatedSize)):component.size.value=null;return layoutInfo.components.forEach(function(component){sizeValue=component.size.value?component.size.value:component.size.min?component.size.min:component.size,componentBoundingBox={},parentDirection===Direction.ROW?(componentBoundingBox.height=parentHeight,componentBoundingBox.width=parentWidth*sizeValue):(componentBoundingBox.width=parentWidth,componentBoundingBox.height=parentHeight*sizeValue),component.boundingBox=componentBoundingBox}),layoutInfo.components.forEach(function(component){checkLayout(component)}),layoutInfo}function sizeComponent(componentLayoutInfo,parentLayoutInfo,pWidth,pHeight,textScaleMode,elementScaleMode){var scaledTextInfo,w,h;w=componentLayoutInfo.boundingBox.width,h=componentLayoutInfo.boundingBox.height,componentLayoutInfo.components&&componentLayoutInfo.components.forEach(function(component){sizeComponent(component,componentLayoutInfo,w,h,textScaleMode,elementScaleMode)}),"function"==typeof componentLayoutInfo.getText&&(textScaleMode===TextScaleMode.MAX?scaledTextInfo=maxText(componentLayoutInfo.getText(),w,h):textScaleMode===TextScaleMode.SCALE&&(scaledTextInfo=scaleText(componentLayoutInfo,w,h)),elementScaleMode===ElementScaleMode.ADJUSTTOTEXT&&(componentLayoutInfo.boundingBox={height:scaledTextInfo.height,width:scaledTextInfo.width}),componentLayoutInfo.fontSizes||(componentLayoutInfo.fontSizes={}),componentLayoutInfo.fontSizes.fontSize=10*scaledTextInfo.fontSize+"%")}function scaleText(layoutInfo,width,height){if(!layoutInfo.fontSizes)return{fontSize:"10px"};var text=layoutInfo.getText(),min=layoutInfo.fontSizes.min,max=layoutInfo.fontSizes.max,maxNrChars=layoutInfo.fontSizes.maxNrChars,maxFontSizeInfo=maxText(text,width,height,maxNrChars),scale=Math.min((height-min.height)/(max.height-min.height),1),preferredFontSize=min.fontSize+scale*(max.fontSize-min.fontSize),fontSize=Math.max(Math.min(maxFontSizeInfo.fontSize,preferredFontSize),min.fontSize);return{fontSize:fontSize}}function maxText(text,width,height,maxNumChars){var mainValueWidth=maxNumChars?maxNumChars*_testTextWidth:_renderer.getTextWidth(text,_font),mainValueHeight=1.2*_testTextHeight,scale=Math.min(width/mainValueWidth,height/mainValueHeight);return{fontSize:9*scale}}var _renderer=new CanvasRenderer,_font="10px 'QlikView Sans'",_testTextHeight=_renderer.getFontHeight(_font)+1,_testTextWidth=_renderer.getTextWidth("M",_font),ElementScaleMode={NONE:0,ADJUSTTOTEXT:1},TextScaleMode={NONE:0,SCALE:1,MAX:2},Direction={ROW:"row",COLUMN:"column"},KPILayout={checkLayout:checkLayout,getDirection:getDirection,sizeComponent:sizeComponent,TextScaleMode:TextScaleMode,ElementScaleMode:ElementScaleMode,Direction:Direction};return KPILayout}),define("client.utils/routing",["general.controllers/route-controller","util"],function(RouteController,Util){"use strict";var Routing={getUrlForSheet:function(id,state,absolute){var defaults=["sheet",id,"state",state];return absolute&&defaults.splice(0,0,!0,"sense","app",Util.getParameterByName("app")),RouteController.buildUrl.apply(RouteController,defaults)},goToOverview:function(){RouteController.setUrl(RouteController.buildUrl())},goToDataSpace:function(){RouteController.setUrl(RouteController.buildUrl("data"))},goToSheet:function(id,state){RouteController.setUrl(Routing.getUrlForSheet(id,state,!1))},goToStory:function(id,state,slideId){var parts=["story",id,"state",state];slideId&&parts.push("slide",slideId),RouteController.setUrl(RouteController.buildUrl.apply(RouteController,parts))}};return Routing}),define("general.utils/visualizations",[],function(){function getType(name){return types[name]}function registerType(name,impl){types[name]=impl}var types={};return{getType:getType,getRegisteredNames:function(){return Object.keys(types)},getLibraryInfo:function(type){return types[type]?types[type].getLibraryInfo():null},getTemplateIconClassName:function(type){return types[type]?types[type].getTemplateIconClassName():null},getIconChar:function(type){return types[type]?types[type].getIconChar():null},registerType:registerType}}),define("client.models/sheet",["jquery","core.models/generic-object","general.utils/visualizations","util","core.utils/deferred"],function($,GenericObject,Visualizations,util,Deferred){"use strict";function objIndex(sheet,pos){var i,child;for(i=0;i<sheet.cells.length;++i)if(child=sheet.cells[i],child.col===pos.col&&child.row===pos.row)return i;return-1}function getObject(sheet,pos,allowMissing){var index=objIndex(sheet,pos);if(-1===index){if(allowMissing)return null;throw new Error("invalid pos")}return sheet.cells[index]}function moveObject(obj,newPos){obj.col=newPos.col,obj.row=newPos.row,obj.colspan=newPos.colspan,obj.rowspan=newPos.rowspan}function setObject(sheet,pos,id,type){var obj=getObject(sheet,pos,!0),oldId=obj?obj.name:null;return obj?(obj.name=id,obj.type=type):sheet.cells.push({name:id,type:type,col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan}),oldId}function splitPos(pos,direction){var pos1={col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan},pos2={col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan};if("left"===direction||"right"===direction){var colspan=Math.ceil(pos.colspan/2);pos1.colspan-=colspan,pos2.col+=pos.colspan-colspan,pos2.colspan=colspan}if("top"===direction||"bottom"===direction){var rowspan=Math.ceil(pos.rowspan/2);pos1.rowspan-=rowspan,pos2.row+=pos.rowspan-rowspan,pos2.rowspan=rowspan}if("top"===direction||"left"===direction){var temp=pos1;pos1=pos2,pos2=temp}return{pos1:pos1,pos2:pos2}}function splitCell(props,pos,direction){var cell=getObject(props,pos,!1);if(!cell||cell.colspan!==pos.colspan||cell.rowspan!==pos.rowspan)return!1;var split=splitPos(cell,direction);return moveObject(cell,split.pos1),split.pos2}function findCellForId(id,cells){return cells.filter(function(cell){return cell.name===id})[0]}function addChildrenToObject(obj,children){for(var i=0;i<children.length;i++){var childProps=children[i];childProps.qInfo.qId=util.generateId(),obj.qChildren.push({qChildren:[],qProperty:childProps})}}var Sheet;return Sheet=GenericObject.extend("Sheet",{edit:function(modify){var that=this;return that.getProperties().then(function(props){return modify(props),that.save()})},getObject:function(pos,allowMissing){return this.getLayout().then(function(layout){return getObject(layout,pos,allowMissing)})},moveObject:function(originalPos,newPos){return this.edit(function(props){var obj=getObject(props,originalPos);return newPos.split&&(newPos=splitCell(props,newPos.pos,newPos.split),!newPos)?Deferred.reject():void moveObject(obj,newPos)})},swapObjects:function(srcPos,targetPos){return this.edit(function(props){var srcObj=getObject(props,srcPos),targetObj=getObject(props,targetPos,!0);moveObject(srcObj,targetPos),targetObj&&moveObject(targetObj,srcPos)})},addObject:function(args){var initProps,that=this,type=args.template,pos=args.cell.pos,vis=Visualizations.getType(type),init=args.init,children=args.children||[];return initProps=init.qExtendsId?Deferred.resolve(util.extend({qInfo:{qType:type}},init)):vis.getInitialProperties(init),Deferred.all({initProps:initProps,props:that.getFullPropertyTree()}).then(function(args){var visProps=args.initProps,sheetPropTree=args.props;if(pos.split&&(pos=splitCell(sheetPropTree.qProperty,pos.pos,pos.split),!pos))return Deferred.reject();visProps.qInfo.qId=util.generateId();var oldId=setObject(sheetPropTree.qProperty,pos,visProps.qInfo.qId,visProps.qInfo.qType);if(oldId){for(var i=0;i<sheetPropTree.qChildren.length;i++)if(sheetPropTree.qChildren[i].qProperty.qInfo.qId===oldId){sheetPropTree.qChildren[i].qProperty=visProps,sheetPropTree.qChildren[i].qChildren=[],addChildrenToObject(sheetPropTree.qChildren[i],children);break}}else{var len=sheetPropTree.qChildren.push({qChildren:[],qProperty:visProps});addChildrenToObject(sheetPropTree.qChildren[len-1],children)}return that.saveTree()})},getObjectById:function(objId){var i,child,cells=this.layout.cells;for(i=0;i<cells.length;++i)if(child=cells[i],objId===child.name)return child;return null},removeObject:function(pos){var that=this;return that.getProperties().then(function(props){var index=objIndex(props,pos),id=props.cells[index].name;if(-1===index)throw new Error("invalid pos");props.cells.splice(index,1),that.removeChild(id,props)})},setCloneChildrenInfos:function(newSheet){var oldSheet=this;return Deferred.all([oldSheet.getChildInfos(),newSheet.getChildInfos(),newSheet.getProperties()]).then(function(args){
var oldChilds=args[0],newChilds=args[1],newProperties=args[2];return oldChilds.forEach(function(child,i){var cell=findCellForId(child.qId,newProperties.cells);cell&&(cell.name=newChilds[i].qId)}),newSheet.save().then(function(){return newSheet})})},clone:function(){var oldSheet=this;return this._super().then(function(newSheet){return oldSheet.setCloneChildrenInfos(newSheet)})},draft:function(app){var oldSheet=this;return app.rpc("CreateDraft","qDraftId",[this.id]).then(function(draftId){return Sheet.get(draftId).then(function(newSheet){return oldSheet.setCloneChildrenInfos(newSheet)})})}},{listProperties:{qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}}}),Sheet.create=function(opts,app){var data={qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},columns:24,rows:12,cells:[]};return GenericObject.create.call(Sheet,$.extend(!0,data,opts),app)},Sheet.splitPos=splitPos,Sheet}),define("text!extensions.qliktech/kpi/value.ng.html",[],function(){return'<div class="ellips-text">\r\n	<div class="kpi-value" ng-style="valueStyle">\r\n		<div class="ellips-text">\r\n			<span ng-bind="currentFormattedValue" title="{{currentFormattedValue}}"></span>\r\n		</div>\r\n		<div class="glyph-wrapper">\r\n			<span class="kpi-icon" ng-bind="glyph" ng-if="showGlyph"></span>\r\n		</div>\r\n	</div>\r\n	<div class="kpi-title ellips-text" ng-style="titleStyle" ng-bind="measureTitle"></div>\r\n</div>'}),define("extensions.qliktech/kpi/value",["qvangular","text!./value.ng.html","util","objects.views/charts/utils/tween"],function(qvangular,template,util,Tween){qvangular.directive("qvKpiValue",[function(){return{replace:!0,template:template,restrict:"E",scope:{value:"=",formattedValue:"=",valueStyle:"=",formatter:"=",glyph:"=",showGlyph:"=",measureTitle:"=",titleStyle:"="},link:function($scope){var tweenNumericText=function(src,num,text,formatter){new Tween(src,{currentValue:num},400).progress(function(){src.currentFormattedValue=formatter?formatter.formatValue(src.currentValue):src.currentValue,$scope.$digest()}).then(function(){src.currentFormattedValue="U"!==formatter.type?text:formatter.formatValue(src.currentValue)})},updateCurrentModel=function(){$scope.formattedValue&&("U"===$scope.formatter.type?($scope.tweenFormatter||($scope.tweenFormatter=$scope.formatter.clone()),$scope.tweenFormatter.pattern=adjustDecimals($scope.formattedValue,!0),$scope.tweenFormatter.prepare(),tweenNumericText($scope,$scope.value,$scope.formattedValue,$scope.tweenFormatter)):tweenNumericText($scope,$scope.value,$scope.formattedValue,$scope.formatter))},adjustDecimals=function(formattedValue,abbreviate){var i,reg,p="0",m=formattedValue.match(/(?:-?\d+)([^\d](?=\d))/),dec=m?m[1]:"",nDecimals=0;if(dec&&(reg=new RegExp("(?:"+util.escapeRegExp(dec)+")(\\d+)"),m=formattedValue.match(reg),nDecimals=m?m[1].length:0),nDecimals)for(p+=dec,i=0;nDecimals>i;i++)p+="0";return abbreviate&&(p+="A"),p};$scope.$watchCollection("[formattedValue,formatter]",function(){updateCurrentModel()})}}}])}),define("extensions.qliktech/kpi/kpi",["jquery","qvangular","translator","objects.extension/default-view","objects.backend-api/hypercube-api","text!./kpi.ng.html","extensions.qliktech/kpi/kpi-properties","objects.views/charts/utils/chart-formatting","client.property-panel/components/color-scale-creator/color-scale-creator-utils","core.utils/deferred","objects.models/visualization-object","extensions.qliktech/kpi/kpi-layout","client.utils/routing","client.models/sheet","objects.extension/object-conversion","extensions.qliktech/kpi/value"],function($,qvangular,translator,DefaultView,HypercubeApi,template,kpiPropertiesDefinition,ChartFormatter,ColorScaleCreatorUtils,Deferred,VisualizationObject,KPILayout,Routing,Sheet,objectConversion){"use strict";var kpi,$timeout=qvangular.getService("$timeout");return kpi=DefaultView.extend("kpi",{namespace:".kpi",init:function($scope,$element,options,backendApi){this._super($scope,$element,options,backendApi),this._$element=$element,this.$scope.mainValueStyle={},this.$scope.measureTitleStyle={},this.$scope.viz={},this.$scope.secondaryValues=[],this.$scope.secondaryLayouts=[],this.$scope.showSecondaryValues=!1,this.$scope.mainValue={formattedValue:"",value:null,style:null},$scope.showVerifyDialog=!1,$scope.onShowVerifyDialog=function(){$scope.linkInteractionOn&&(qvangular.$apply($scope,function(){$scope.showVerifyDialog=!0,$scope.updateVerifyDialogFontSize()}),$timeout(function(){qvangular.$apply($scope,function(){$scope.showVerifyDialog=!1})},2500))},$scope.linkToSheet=function(){$scope.linkInteractionOn&&window.open(Routing.getUrlForSheet($scope.layout.kpiLink.id,"analysis"))},$scope.updateVerifyDialogFontSize=function(){if($scope.showVerifyDialog){var layoutInfo=$scope.verifyDialogLayoutInfo.components[0];KPILayout.checkLayout($scope.verifyDialogLayoutInfo),KPILayout.sizeComponent(layoutInfo,$scope.verifyDialogLayoutInfo,$scope.verifyDialogLayoutInfo.boundingBox.width,$scope.verifyDialogLayoutInfo.boundingBox.height,KPILayout.TextScaleMode.SCALE,KPILayout.ElementScaleMode.NONE),$scope.verifyDialogStyle={fontSize:layoutInfo.fontSizes.fontSize}}};var self=this;this.$scope.baseLayoutInfo={direction:KPILayout.Direction.COLUMN,ratio:1e9,boundingBox:{width:$element.width(),height:$element.height()},components:[{size:{min:.2,treshold:{width:150,height:12}},getText:function(){return $scope.measureTitle},fontSizes:{maxNrChars:15,min:{fontSize:10,height:15},max:{fontSize:40,height:80}},isVisible:function(){return $scope.showMeasureTitle}},{size:{min:.8,stretch:!0},ratio:1,components:[{size:{min:.5,stretch:!0},getText:function(){return self.$scope.mainValue.formattedValue+(self.$scope.mainValue.glyph?self.$scope.mainValue.glyph:"")},fontSizes:{maxNrChars:4,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:.5,components:this.$scope.secondaryLayouts,isVisible:function(){return self.$scope.secondaryLayouts.length>0}}]}]},this.$scope.secondaryLayoutInfo={size:{min:1,treshold:{width:100,height:30}},direction:KPILayout.Direction.COLUMN,components:[{size:{min:.6,stretch:!0},fontSizes:{maxNrChars:8,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:{min:.4},fontSizes:{maxNrChars:15,min:{fontSize:10,height:20},max:{fontSize:30,height:500}}}]},this.$scope.verifyDialogLayoutInfo={size:{min:1,width:20,height:20},boundingBox:{width:0,height:0},components:[{size:{min:.2,treshold:{width:100,height:100}},getText:function(){return translator.get("properties.kpi.verifyToGoSheet")},fontSizes:{maxNrChars:16,min:{fontSize:10,height:20},max:{fontSize:13,height:50}}}]}},isValid:function(data){return!!data&&!!data.qHyperCube&&data.qHyperCube.qMeasureInfo.length&&!data.qHyperCube.qMeasureInfo.some(function(m){return!!m.qError})},updateData:function(data){if(this.isValid(data)){this._data=data;var secValue,secInfo,secText,secFormText,secNum,secTitle,i,dataPage=data.qHyperCube.qDataPages[0].qMatrix[0],numMeasures=data.qHyperCube.qMeasureInfo.length,numSecMeasures=numMeasures-1,formatters=this.getFormatterForMeasures(data.qHyperCube.qMeasureInfo.length),secondaryValues=this.$scope.secondaryValues,secondaryLayouts=this.$scope.secondaryLayouts,self=this,getSecondaryText=function(){return secFormText},getSecondaryTitle=function(){return secTitle};for(this.$scope.useViz=data.useViz,this.$scope.showMeasureTitle=data.showMeasureTitle,this.$scope.textAlign=data.textAlign,this.$scope.baseLayoutInfo.components[1].components[0].fontSizes.maxNrChars="S"===data.fontSize?7:"L"===data.fontSize?3:4,this.$scope.useLink=data.useLink,data.useLink&&data.kpiLink&&Sheet.get(data.kpiLink.id).then(function(sheet){sheet.getLayout().then(function(layout){data.kpiLink.title=layout&&layout.qMeta?layout.qMeta.title:"",self.$scope.sheetLinkTitle=data.kpiLink?data.kpiLink.title:""})}),this.$scope.mainValue.value=data.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,this.$scope.mainValue.formattedValue="U"!==formatters[0].type?data.qHyperCube.qDataPages[0].qMatrix[0][0].qText:formatters[0].formatValue(this.$scope.mainValue.value),this.$scope.mainValue.formatter=formatters[0],i=0;numSecMeasures>i;i++)secText=dataPage[i+1].qText,secNum=dataPage[i+1].qNum,secFormText="U"!==formatters[i+1].type?secText:formatters[i+1].formatValue(secNum),secTitle=data.qHyperCube.qMeasureInfo[i+1].qFallbackTitle,secondaryValues[i]||(secInfo=this.createSecondaryValue(getSecondaryText,getSecondaryTitle),secValue={style:secInfo.layoutInfo.components[0].fontSizes.value,titleStyle:secInfo.layoutInfo.components[1].fontSizes.value},secondaryValues.push(secValue),secondaryLayouts.push(secInfo.layoutInfo)),secValue=secondaryValues[i],secValue.value=secNum,secValue.formattedValue=secFormText,secValue.formatter=formatters[i+1],secValue.measureTitle=secTitle,secondaryLayouts[i].components[0].fontSizes.maxNrChars="S"===data.fontSize?14:"L"===data.fontSize?6:8;secondaryValues.length>numSecMeasures&&(secondaryLayouts.splice(numSecMeasures,secondaryValues.length-numSecMeasures),secondaryValues.splice(numSecMeasures,secondaryValues.length-numSecMeasures)),this.$scope.measureTitle=data.qHyperCube.qMeasureInfo[0].qFallbackTitle,this.$scope.showSecondaryValues=secondaryValues.length>0,data.useViz&&(this._vizCreated?!this._vizBound&&data.qChildList&&data.qChildList.qItems&&(this.bindVisualization(data.qChildList.qItems[0]),this._vizBound=!0):(this.createVisualization(data.vizType),this._vizCreated=!0))}},updateStyles:function(){if(this._data){var layoutInfo,valueInfo,self=this,data=this._data,getValueInfo=function(value,index){var condColoring=data.qHyperCube.qMeasureInfo[index].conditionalColoring,measureAxis=data.qHyperCube.qMeasureInfo[index].measureAxis,normalizedValue=(value-measureAxis.min)/(measureAxis.max-measureAxis.min),segmentIndex=ColorScaleCreatorUtils.getSegmentIndex(condColoring,value,measureAxis.min),icon=condColoring.segments.colors[segmentIndex]?condColoring.segments.colors[segmentIndex].icon:"",color=condColoring.useConditionalColoring?ColorScaleCreatorUtils.shouldBlend(condColoring.segments,segmentIndex)?ColorScaleCreatorUtils.blendValue(condColoring.segments,normalizedValue,measureAxis.min,measureAxis.max):ColorScaleCreatorUtils.resolveColor(condColoring.segments.colors[segmentIndex].color):ColorScaleCreatorUtils.resolveColor(condColoring.singleColor);return{color:color,icon:icon,useCondColor:condColoring.useConditionalColoring}};this.$scope.linkInteractionOn=this.$scope.interactionOn&&this.$scope.layout.useLink&&this.$scope.layout.kpiLink&&this.$scope.layout.kpiLink.id,this.$scope.verifyDialogLayoutInfo.boundingBox.width=this._$element.width(),this.$scope.verifyDialogLayoutInfo.boundingBox.height=this._$element.height(),this.$scope.baseLayoutInfo.boundingBox=this.getBoundingBox(),KPILayout.checkLayout(this.$scope.baseLayoutInfo),this.$scope.baseLayoutInfo.components.forEach(function(component){var isSnapshotLockedMode=self.backendApi.isSnapshot&&self._data&&!self._data.snapshotData.object.freeResize,fontSizeMode=isSnapshotLockedMode?self._data.snapshotData.isZoomed:self.options.isZoomed;KPILayout.sizeComponent(component,self.$scope.baseLayoutInfo,self.$scope.baseLayoutInfo.boundingBox.width,self.$scope.baseLayoutInfo.boundingBox.height,0===self.$scope.secondaryValues.length&&fontSizeMode?KPILayout.TextScaleMode.MAX:KPILayout.TextScaleMode.SCALE,0===self.$scope.secondaryValues.length&&fontSizeMode?KPILayout.ElementScaleMode.ADJUSTTOTEXT:KPILayout.ElementScaleMode.NONE)}),valueInfo=getValueInfo(this.$scope.mainValue.value,0),this.$scope.mainValue.glyph=valueInfo.icon,this.$scope.mainValue.showGlyph=valueInfo.useCondColor&&valueInfo.icon&&""!==valueInfo.icon,layoutInfo=this.$scope.baseLayoutInfo.components[1].components[0],this.$scope.mainValue.style={color:valueInfo.color,fontSize:layoutInfo.fontSizes.fontSize},layoutInfo=this.$scope.baseLayoutInfo.components[0],this.$scope.measureTitleStyle={fontSize:layoutInfo.fontSizes.fontSize};for(var i=1;i<data.qHyperCube.qMeasureInfo.length;i++)layoutInfo=this.$scope.baseLayoutInfo.components[1].components[1].components[i-1].components[0],valueInfo=getValueInfo(this.$scope.secondaryValues[i-1].value,i),this.$scope.secondaryValues[i-1].style={color:valueInfo.color,fontSize:layoutInfo.fontSizes.fontSize},layoutInfo=this.$scope.baseLayoutInfo.components[1].components[1].components[i-1].components[1],this.$scope.secondaryValues[i-1].titleStyle={fontSize:layoutInfo.fontSizes.fontSize},this.$scope.secondaryValues[i-1].glyph=valueInfo.icon,this.$scope.secondaryValues[i-1].showGlyph=valueInfo.useCondColor&&valueInfo.icon&&""!==valueInfo.icon;this.$scope.updateVerifyDialogFontSize();var dfd=Deferred();return $timeout(function(){dfd.resolve()},0,!1),dfd.promise}},bindVisualization:function(item){var self=this;VisualizationObject.get(item.qInfo.qId).then(function(model){self.$scope.viz.model=model})},createSecondaryValue:function(getText,getTitle){var secondaryLayoutInfo=$.extend({},this.$scope.secondaryLayoutInfo);return secondaryLayoutInfo.components[0].getText=getText,secondaryLayoutInfo.components[1].getText=getTitle,{layoutInfo:secondaryLayoutInfo,text:getText()}},paint:function(){return this.updateStyles()},resize:function($element,layout){this.paint($element,layout)},getFormatterForMeasures:function(nrMeasures){for(var measure,f,data=this._data,chartFormatter=new ChartFormatter(this.backendApi.localeInfo,data.qHyperCube.qMeasureInfo),formatters=[],i=0;nrMeasures>i;i++)measure=data.qHyperCube.qMeasureInfo[i],f=chartFormatter.getMeasureFormatter(i),"U"===f.type&&(f.pattern=f.createPatternFromRange(measure.qMax,measure.qMax,!0),Math.floor(Math.log(Math.abs(measure.qMax))/Math.log(10))%3===2&&(f.pattern=f.pattern.substr(0,f.pattern.length-2),f.pattern+="A")),f.prepare(),formatters.push(f);return formatters},on:function(){this.$scope.interactionOn=!0,this._super(),this.updateStyles()},off:function(){this.$scope.interactionOn=!1,this._super(),this.updateStyles()},getBoundingBox:function(){var isSnapshotLockedMode=this.backendApi.isSnapshot&&this._data&&!this._data.snapshotData.object.freeResize;return isSnapshotLockedMode&&this._data.snapshotData.elementRatio?{width:this._data.snapshotData.object.size.w,height:this._data.snapshotData.object.size.w*this._data.snapshotData.elementRatio}:{width:this._$element.width(),height:this._$element.height()}},setSnapshotData:function(snapshotLayout){this._super(),snapshotLayout.snapshotData.isZoomed=this.options.isZoomed,snapshotLayout.snapshotData.elementRatio=this._$element.height()/this._$element.width()}}),{type:"kpi",BackendApi:HypercubeApi,template:template,View:kpi,definition:kpiPropertiesDefinition,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:500,qHeight:10}],qSuppressMissing:!0},showTitles:!1},data:{measures:{min:1,max:2}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(builder,propertyHandler,model,showMenu,object){builder.AddFieldAsMeasure(model,propertyHandler,object),showMenu()},getDropDimensionOptions:function(builder,propertyHandler,model,showMenu){showMenu()},importProperties:function(exportedFmt,initialProperties,ext){var n,i,qDef,propTree=objectConversion.hypercube.importProperties.apply(objectConversion,[exportedFmt,initialProperties,ext]),qProperty=propTree.qProperty,qHyperCubeDef=qProperty.qHyperCubeDef,qMeasures=qHyperCubeDef.qMeasures,qLayoutExclude=qHyperCubeDef.qLayoutExclude,qExcludedHyperCubeDef=qLayoutExclude?qLayoutExclude.qHyperCubeDef:void 0,qExcludedMeasures=qExcludedHyperCubeDef?qExcludedHyperCubeDef.qMeasures:void 0,allMeasures=[];for(qMeasures&&(allMeasures=allMeasures.concat(qMeasures)),qExcludedMeasures&&(allMeasures=allMeasures.concat(qExcludedMeasures)),n=allMeasures.length,i=0;n>i;i++)qDef=allMeasures[i].qDef,qDef.measureAxis||(qDef.measureAxis={min:0,max:100}),qDef.conditionalColoring||(qDef.conditionalColoring={useConditionalColoring:!1,singleColor:3,segments:{limits:[],colors:[{color:2}]}});return propTree},exportProperties:objectConversion.hypercube.exportProperties.bind(objectConversion)}}),define("objects.backend-api/map-api",["./backend-api","core.models/app"],function(BackendApi,App){"use strict";var MapApi;return MapApi=BackendApi.extend("MapApi",{init:function(model){this._super(model)},select:function(method,path,values,toggleMode){return path?this.model.rpc(method,null,[path,values,toggleMode]):void 0},select2:function(method,path,rowIndices,colIndices){return path?this.model.rpc(method,null,[path,rowIndices,colIndices]):void 0},selectRange:function(ranges,orMode,columnsToSelect){if(!(this.path.indexOf("qHyperCubeDef")<0)){var params,path=this.path.replace("/geodata","");return orMode=!!orMode,columnsToSelect=columnsToSelect||[0],params=ranges.map(function(o){return{qMeasureIx:o.measure,qRange:{qMin:o.range.min,qMax:o.range.max,qMinInclEq:o.range.minInclEq!==!1,qMaxInclEq:o.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[path,params,columnsToSelect,orMode])}},updateCache:function(){},setInitialData:function(){},getData:function(method,path,pages){return this.model.rpc(method,null,[path,pages])},evaluateExpression:function(expr){return App.current.evaluateExpression(expr)},getSize:function(){var layout=this.model.layout,qListObject=layout.qListObject?layout.qListObject:layout.layers[0].qListObject;return qListObject.qSize},isLocked:function(){var layout=this.model.layout,qListObject=layout&&layout.layers&&layout.layers[0]&&layout.layers[0].qListObject?layout.layers[0].qListObject:null;return qListObject&&qListObject.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){var layout=this.model.layout,qListObject=layout.qListObject?layout.qListObject:layout.layers[0].qListObject;return[qListObject.qDimensionInfo]},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},beginSelections:function(){var i,path,geopath,model=this.model,paths=[];for(i=0;i<model.layout.layers.length;++i)if(path="/layers/"+i+"/","polygon"===model.layout.layers[i].type&&"3"===model.layout.layers[i].version)geopath=path+"geodata/",path+="qHyperCubeDef",geopath+="qHyperCubeDef",paths.push(path),paths.push(geopath);else{if(model.layout.layers[i].qHyperCube)path+="qHyperCubeDef";else{if(!model.layout.layers[i].qListObject)continue;path+="qListObjectDef"}paths.push(path)}return App.current.switchModal(model,paths)}})}),define("text!extensions.qliktech/map/map.ng.html",[],function(){return'	<div qv-extension\r\n        class="qv-viz">\r\n	</div>\r\n<div qva-scatter-navigation>\r\n	</div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("text!general.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\r\n	<form class="qv-st-form">\r\n		<textarea class="qv-st-instance">{{data}}</textarea>\r\n	</form>\r\n</div>'}),define("general.services/media-tool/theme",[],function(){var palette=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],fontSizes={1:"XS",2:"S",3:"M",4:"L",5:"XL"},fontSizesPx={10:"1",13:"2",16:"3",22:"4",32:"5"},htmlSizeToMarkdownSize={1:1,2:2,3:3,4:4,5:5,6:5},markdownSizeToHtmlSize={1:1,2:2,3:3,4:4,5:5};return{palette:palette,fontSizes:fontSizes,fontSizesPx:fontSizesPx,htmlSizeToMarkdownSize:htmlSizeToMarkdownSize,markdownSizeToHtmlSize:markdownSizeToHtmlSize}}),define("text!general.services/media-tool/toolbar.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" height="48" class="qui-immidiateContextual qv-texttool-toolbar"\r\n					  on-close-view="closeToolbar(event)" ondragstart="return false">\r\n\r\n	<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\r\n\r\n	<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\r\n		<div qv-color-picker-button on-close="closecolorpickerfoldout(event)" ng-model="color" ng-show="buttons.color" ng-disabled="!haveSelection()"></div>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-fontsize" qva-activate="setActiveFoldout(\'fontSizes\',$event)" ng-show="buttons.fontSize" tid="fontSize" ng-disabled="!haveSelection()"\r\n			ng-class="{\'qui-active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="qui-button">\r\n		{{shortFontSize(textTool.fontSize)}}\r\n		<i class="text-size-arrow icon-triangle-bottom"></i>\r\n	</button>\r\n	<immidiate-contextual ng-if="foldouts.fontSizes" width="48" align-to="\'#qv-toolbar-fontsize\'" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFontsizeFoldout(event)">\r\n		<ul class="qui-icontextlist qv-media-tool-fontsize">\r\n			<li ng-repeat="size in fontSizes" qva-activate="setFontSize($event, size)" ng-class="{\'active\':textTool.fontSize == size}"><span class="qui-textlist-text">{{shortFontSize(size)}}</span></li>\r\n		</ul>\r\n	</immidiate-contextual>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup1">\r\n		<div ng-class="{\'qui-active\':textTool.states.bold}" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Bold" class="qui-button" data-icon="toolbar-bold" qva-press="exec($event,\'bold\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.italic}"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Italic" class="qui-button" data-icon="toolbar-cursive" qva-press="exec($event,\'italic\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.underline}"  ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Underline" class="qui-button" data-icon="toolbar-underline" qva-press="exec($event,\'underline\')"></div>\r\n	</div>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup2">\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\r\n				class="qui-button" q-title-translation="Common.Text.AlignLeft" data-icon="toolbar-left" qva-activate="exec($event,\'justifyLeft\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\r\n				class="qui-button" q-title-translation="Common.Text.AlignCenter" data-icon="toolbar-center" qva-activate="exec($event,\'justifyCenter\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\r\n				class="qui-button" q-title-translation="Common.Text.AlignRight" data-icon="toolbar-right" qva-activate="exec($event,\'justifyRight\')"></button>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" ng-show="buttons.link" tid="link"\r\n			ng-class="{\'qui-active\':foldouts.link}" class="qui-button" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\r\n			ng-disabled="linkDisabled()">\r\n		<i class="icon-link" ng-class="{\'active\':textTool.states.link}"></i>\r\n		<i class="icon-triangle-bottom"></i>\r\n	</button>\r\n\r\n	<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'qui-active\':foldouts.mediaLibrary}" ng-show="buttons.image" tid="image"\r\n			class="qui-button" q-title-translation="MediaTool.Toolbar.InsertImage" data-icon="image"></button>\r\n\r\n</immidiate-contextual>'}),define("general.services/media-tool/text-selection",[],function(){function getSelection(){return window.getSelection()}var Selection={};return Selection.createRange=function(elem,start,end){var range=document.createRange();return start=start||0,end="undefined"==typeof end?elem.childNodes.length:end,range.setStart(elem,start),range.setEnd(elem,end),range},Selection.createRangeForElement=function(elem){var range=document.createRange();return range.selectNode(elem),range},Selection.addRange=function(range,exclusive){var sel=getSelection();exclusive&&sel.removeAllRanges(),sel.addRange(range)},Selection.getRange=function(idx){var selection=window.getSelection();return idx=idx||0,selection.rangeCount>idx?getSelection().getRangeAt(idx):null},Selection.rangeEquals=function(range1,range2){return null===range1&&null===range2?!0:null===range1||null===range2?!1:0===range1.compareBoundaryPoints(window.Range.START_TO_START,range2)&&0===range1.compareBoundaryPoints(window.Range.END_TO_END,range2)},Selection}),define("text!general.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\r\n					  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\r\n\r\n	<div class="link-header">\r\n		<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\r\n		<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\r\n		<div class="link-submenu" ng-if="inStorytelling()">\r\n			<ul>\r\n				<li class="qui-outlinebutton" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\r\n				<li class="qui-outlinebutton" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="link-content" ng-if="linkActive">\r\n		<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\r\n		<input class="link-input qui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\r\n		<div class="link-remove-container" ng-if="showRemove">\r\n			<button class="link-remove qui-button" data-icon="bin" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink"></button>\r\n		</div>\r\n	</div>\r\n	<div class="bookmark-content" ng-if="!linkActive">\r\n		<ul>\r\n			<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\r\n				<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\r\n			</li>\r\n			<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\r\n				<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n<!--</div>-->\r\n</immidiate-contextual>'}),define("client.models/bookmark",["jquery","core.models/base-object","core.models/app"],function($,BaseObject,App){"use strict";var Bookmark;return Bookmark=BaseObject.extend("Bookmark",{clone:function(){return this._super("CloneBookmark")},apply:function(){return Bookmark.apply(this.id,this.app)}},{listProperties:{qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}}),Bookmark.get=function(id,app){function getHandle(){return app.rpc("GetBookmark","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Bookmark.apply=function(id,app){app=app||App.current;var retval=app.rpc("ApplyBookmark","qSuccess",[id]);return retval},Bookmark.create=function(opts,app){var data={qMetaDef:{title:"",description:""},sheetId:opts.sheetId||null,selectionFields:opts.selectionFields,creationDate:(new Date).toISOString()};return BaseObject.create.call(this,$.extend(!0,{},data,opts),"CreateBookmark",app)},Bookmark.remove=function(id,app){return BaseObject.remove(id,"DestroyBookmark",app)},Bookmark.extend=function(name,proto,opts){var ctor=BaseObject.extend.call(this,name,proto,opts);return ctor.extend=Bookmark.extend,ctor.create=Bookmark.create,ctor.remove=Bookmark.remove,ctor.get=Bookmark.get,ctor},Bookmark}),define("general.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function($,template,State,BookmarkModel){var component={template:template,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function($scope,$timeout,$element){function setInitState(){!$scope.link.url&&$scope.link.bookmark?($scope.toggleLink(!1),getBookmarks()):$scope.toggleLink(!0)}function getBookmarks(){BookmarkModel.getList().then(function(list){list.getLayout().then(function(layout){$scope.bookmarks=layout,highlightActiveBookmark()})})}function highlightActiveBookmark(){$scope.bookmarks.forEach(function(item){item.qInfo.qId===$scope.link.bookmark?item.active=!0:item.active=!1})}$scope.link=$scope.options.link,$scope.link.url&&"#"!==$scope.link.url||($scope.link.url=""),$scope.link.url=decodeURIComponent($scope.link.url);var orgUrl=$scope.link.url;$scope.alignTo=$scope.options.alignTo,$scope.linkActive=!0,$scope.closeFoldout=function(e){var url=encodeURI($scope.link.url),$node=$scope.link.$node;return $scope.closed=!0,url===orgUrl?void $scope.options.onCancel(e):void(url&&url.length>0&&-1===url.indexOf("javascript:")?(0!==url.search("[a-zA-Z0-9]+:")&&(url="http://"+url),$scope.options.onSave(e,url,$node,{cmd:"createLink",formatter:"link"})):$scope.options.onCancel(e))},$scope.onEnter=function(e){$scope.closeFoldout(e)},$scope.showRemove=!!orgUrl,$scope.removeLink=function(evt){$scope.options.onRemove(evt,$scope.link.$node)},$scope.inStorytelling=function(){return State.state===State.States.editstory},$scope.insertBookmark=function(e,id){$scope.options.onSave(e,id,$scope.link.$node,{cmd:"createLink",formatter:"bookmark"})},$scope.toggleLink=function(active){$scope.linkActive=active,active&&setTimeout(function(){$(".link-input").focus()})},$scope.exposedApi.closing=function(){$scope.closed||$scope.closeFoldout()},$scope.$on("$destroy",function(){$scope.closed||$scope.closeFoldout()}),setInitState(),$scope.$watch("linkActive",function(){$scope.linkActive&&getBookmarks()}),$timeout(function(){$element.find(".link-input").focus()})}]};return component}),define("general.models/media-library",["core.models/base-object","util"],function(BaseObject,util){"use strict";function createDirectoryEntry(name,type,paths){var entry={name:name,type:type};return paths&&(entry.path=paths.qUrl,entry.pathDef=paths.qUrlDef),"folder"===type&&(entry.children=[]),entry}function getDirectoryEntry(path,root){path=path.substring(1).split("/").reverse().slice(1).reverse();var parent=root;return path.forEach(function(part){var found=!1;if(parent.children.forEach(function(child){return child.name===part?(parent=child,void(found=!0)):void 0}),!found){var child=createDirectoryEntry(part,"folder");parent.children.push(child),parent=child}}),parent}function sortTree(children){children.sort(function(a,b){return a.name.localeCompare(b.name)}).reverse(),children.sort(function(a,b){return"folder"===a.type&&"folder"!==b.type?-1:"folder"===a.type&&"folder"===b.type?a.name.localeCompare(b.name):"folder"!==a.type&&"folder"!==b.type?a.name.localeCompare(b.name):1}),children.forEach(function(child){"undefined"!=typeof child.children&&sortTree(child.children)})}var MediaLibrary;return MediaLibrary=BaseObject.extend("MediaLibrary",{},{listProperties:{qMediaListDef:{}}}),MediaLibrary.addBasePath=function(path){return util.baseURI+".."+path},MediaLibrary.stripBasePath=function(path){return path=path.replace(util.baseURI,"").replace(/^\.\.\//i,"/"),path=path.replace(location.protocol+"//"+location.host,"")},MediaLibrary.createTree=function(files,fileTypes,flat){fileTypes=(fileTypes||[]).join("|")||".+?";var root=createDirectoryEntry("/","folder"),fileTypeRegex=new RegExp("\\.("+fileTypes+")$","i");return files.forEach(function(obj){var name,paths=obj,path=paths.qUrl;if(path=MediaLibrary.stripBasePath(path),
name=decodeURIComponent((path+"").replace(/\+/g,"%20")),name=name.split("/").splice(-1)[0],name.match(fileTypeRegex)){var pathName,parent=root;flat||(pathName=decodeURIComponent(path).replace(/^(\/content\/default)|(\/content\/Default)/,"").replace(/^(^\/media\/([a-z0-9-])+\/([a-z0-9-])+\/)/,"/media/"),parent=getDirectoryEntry(pathName,root)),parent.children.push(createDirectoryEntry(name,"file",paths))}}),sortTree(root.children),root},MediaLibrary.filterList=function(listItem){var i,itm,filtered=[],sortedList=listItem.sort(function(a,b){var aName=a.qName.toLowerCase(),bName=b.qName.toLowerCase();return aName.localeCompare(bName)});for(i=0;i<listItem.length;i++)if(itm=listItem[i],itm.qAppSpecific){filtered.push(itm),itm.qMeta&&-1!==itm.qMeta.privileges.indexOf("update")&&(MediaLibrary.canUpdate=!0);break}for(i=0;i<sortedList.length;i++)itm=listItem[i],itm.qAppSpecific||filtered.push(itm);return filtered},MediaLibrary.getRemainingSpace=function(listItem){for(var remainingSpace=0,i=0;i<listItem.length;i++)if(listItem[i].qAppSpecific){remainingSpace=parseInt(listItem[i].qMeta.remainingLibrarySpace||0,10);break}return remainingSpace},MediaLibrary}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<qv-modal-dialog qv-id="media-library-modal" tid="media-library" qv-cancel="cancel()" qv-confirm="confirm()" qva-stop-prop>\r\n	<header class="dm-head">\r\n		<span class="dm-title" q-translation="MediaLibrary.Header"></span>\r\n	</header>\r\n	<main class="dm-main medialib">\r\n		<div class="q-section-list" ng-if="lists.length">\r\n			<ul class="qui-menu" tid="menu-list">\r\n				<li ng-repeat="list in lists track by list.qName"\r\n					ng-class="{\'qui-menu-item\': true, \'selected\': !isUpload && view === list.qName}"\r\n					qva-activate="goTo(list.qName, false)">\r\n					<span ng-if="list.qAppSpecific" q-translation="MediaLibrary.InApp" tid="goto-inapp"></span>\r\n					<span ng-if="!list.qAppSpecific" tid="goto-library">{{ list.qName }}</span>\r\n				</li>\r\n			</ul>\r\n			<div class="q-section-upload qui-menu-item"\r\n				ng-if="canUpdate"\r\n				ng-class="{\'selected\': isUpload}"\r\n				tid="goto-upload"\r\n				qva-activate="goTo(\'\', true)"\r\n				q-translation="MediaLibrary.UploadMedia">\r\n			</div>\r\n		</div>\r\n		<div class="q-empty" ng-if="!hasFiles && !isUpload">\r\n			<p q-translation="MediaLibrary.NoFilesFound" class="nff"></p>\r\n		</div>\r\n		<qve-media-list ng-if="hasFiles && !isUpload" ng-class="{\'q-image-library\': !isUpload}" class="q-images-cont" tid="media-lib-items-list"></qve-media-list>\r\n		<div class="q-media-preview" ng-if="selectedFile && !isUpload">\r\n			<div class="q-media-preview-toolbar" ng-if="canDeleteInView()">\r\n				<qui-button-outline-round\r\n					tid="delete"\r\n					class-icon="icon-bin"\r\n					data-name="delete"\r\n					q-title-translation="Common.Delete"\r\n					qva-activate="onDelete($event)">\r\n				</qui-button-outline-round>\r\n			</div>\r\n			<div class="q-media-preview-img-wrapper">\r\n				<img ng-src="{{ getSrc(selectedFile) }}" class="q-media-img-list"/>\r\n			</div>\r\n		</div>\r\n		<div class="q-images-cont" ng-if="canUpdate" ng-show="isUpload">\r\n			<qv-media-update update-exp="updateExp" select-file="selectFile" selected-file="selectedFile"></qv-media-update>\r\n		</div>\r\n	</main>\r\n	<div class="q-media-zoomed" ng-if="inZoom" qva-stop-prop>\r\n		<div class="q-media-z-wrapper">\r\n			<div class="q-media-z-cont">\r\n				<img class="q-media-z-img" ng-src="{{ getSrc(zoomSrc) }}">\r\n			</div>\r\n\r\n			<div class="q-media-zoom-footer">\r\n				<qv-confirm-cancel-footer light qv-confirm="confirm()" qv-cancel="closeZoom()" qv-confirm-label="Common.Apply" qv-confirm-disabled="updateExp.isUploading"></qv-confirm-cancel-footer>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()"\r\n							  qv-cancel="cancel()"\r\n							  qv-cancel-disabled="updateExp.isUploading"\r\n							  qv-confirm-label="MediaLibrary.Insert"\r\n							  qv-confirm-disabled="!selectedFile || updateExp.isUploading">\r\n	</qv-confirm-cancel-footer>\r\n</qv-modal-dialog>'}),define("text!general.components/media-library/media-library-grid.ng.html",[],function(){return'<div>\r\n	<qv-bouncy-grid min-width="140" padding="15" selector=".q-media-grid" list-len="rootEntry.children.length">\r\n		<div ng-repeat="entry in rootEntry.children"\r\n			 title="{{entry.name}}"\r\n			 tid="media-item"\r\n			 ng-class="{\'q-media-grid\': true, \'selected-img\': isSelectedImg(entry, $last, \'.q-media-inuse\')}"\r\n			 qva-activate="selectFile($event, entry.path, entry.pathDef)">\r\n			<div class="q-media-wrap-img">\r\n				<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\r\n\r\n				<div class="overlay"></div>\r\n				<div class="q-media-inuse" ng-if="input.selectedFile === entry.path">\r\n					<i class="icon-tick"></i>\r\n				</div>\r\n				<div class="q-media-buttons" ng-if="selectedFile === entry.path">\r\n					<qui-button-outline-round small\r\n											  tid="media-view"\r\n											  class-icon="icon-hub-view"\r\n											  data-name="view"\r\n											  q-title-translation="Common.View"\r\n											  qva-activate="zoomImage($event, entry)"\r\n							></qui-button-outline-round>\r\n				</div>\r\n			</div>\r\n			<div class="q-media-name">{{entry.name}}</div>\r\n		</div>\r\n	</qv-bouncy-grid>\r\n</div>'}),define("text!general.components/media-library/media-library-list.ng.html",[],function(){return'<div>\r\n	<!--\r\n		<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\r\n	-->\r\n	<div class="q-media-list-cont" qva-context-menu="onContextMenu($event)">\r\n		<div ng-repeat="entry in rootEntry.children"\r\n			 ng-class="{\'qui-menu-item\': true, \'selected\': isSelectedImg(entry, $last, \'.selected\')}"\r\n			 tid="media-item" title="{{entry.name}}"\r\n			 qva-activate="selectFile($event, entry.path, entry.pathDef)">\r\n			<div class="list-name">{{entry.name}}</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("general.views/bouncy-grid/bouncy-grid",["jquery","qvangular","core.utils/resize"],function($,qvangular,Resize){function parse(string){return parseInt(string||0,10)}qvangular.directive("qvBouncyGrid",[function(){return{restrict:"E",template:'<div class="qv-bouncy" ng-transclude></div>',transclude:!0,replace:!0,scope:{minWidth:"@",maxWidth:"@",padding:"@",selector:"@",listLen:"="},controller:["$scope","$element",function($scope,$element){function timerReCalc(time){clearTimeout(attempsTimer),attempsTimer=setTimeout(calculateBouncyItemDimensions,time||50)}function calculateBouncyItemDimensions(){var width,itemPerRow,itemWidth,bouncyDimension,padding=parse($scope.padding);maxWidth?(width=maxWidth,itemPerRow=Math.ceil($element.width()/width),itemWidth=Math.floor($element.width()/itemPerRow),bouncyDimension=(itemPerRow>$scope.listLen?width:itemWidth)-padding+"px!important;"):(width=minWidth,itemPerRow=Math.floor($element.width()/width),itemWidth=Math.ceil($element.width()/itemPerRow),bouncyDimension=(itemPerRow>$scope.listLen?width:itemWidth)-padding+"px!important;"),isNaN(itemWidth-padding)&&20>attemps?(attemps++,timerReCalc()):style&&style.length&&style.text($scope.selector+" { width: "+bouncyDimension+"height: "+bouncyDimension+"}")}var attempsTimer,style=$("<style></style>").appendTo("body"),attemps=0,minWidth=parse($scope.minWidth),maxWidth=parse($scope.maxWidth);Resize.on("end",timerReCalc),timerReCalc(0),$scope.$watch("listLen",timerReCalc),$scope.$on("$destroy",function(){clearTimeout(attempsTimer),style&&style.remove(),attempsTimer=null,style=null,Resize.off("end",timerReCalc)})}]}}])}),define("text!general.components/media-library/update/media-update.ng.html",[],function(){return'<div id="media-library-upload">\r\n	<div class="bouncy-wrap" ng-class="{\'empty\' : isEmpty}">\r\n		<qv-bouncy-grid min-width="140" padding="15" selector=".preview-media-grid" list-len="previewCounter">\r\n			<div class="media-library-preview-container" ng-hide="isEmpty"></div>\r\n		</qv-bouncy-grid>\r\n	</div>\r\n	<div id="media-library-dropzone" class="dropzone" ng-class="{\'empty\' : isEmpty}">\r\n		<div class="dz-message">\r\n			<div class="upload-drop-text" q-translation="MediaLibrary.ClickOrDropHere"></div>\r\n			<div class="upload-drop-icon" data-icon="upload"></div>\r\n			<div class="upload-drop-quota">{{quotaInfo}}</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!general.components/media-library/update/preview-item.ng.html",[],function(){return'<div tid="preview-item" class="q-media-grid preview-media-grid" ng-class="{\'selected-img\': selectedFile === file.qUrl}" qva-activate="onSelectImage( $event, file )">\r\n	<div class="q-media-wrap-img">\r\n		<img class="q-media-img" width="100%" height="100%" data-dz-thumbnail />\r\n		<div class="overlay"></div>\r\n		<div class="preview-edit-area">\r\n			<div class="touch-area cancel-upload-area" q-title-translation="Common.Cancel" data-dz-remove qva-activate="onCancelUpload( $event, file )">\r\n				<button class="qui-btn-overlay-action-small cancel-upload" data-icon="abort"></button>\r\n			</div>\r\n			<div ng-if="selectedFile === file.qUrl" class="touch-area delete-image-area" q-title-translation="Common.Delete" qva-activate="onDelete( $event, file, file.name, file.qUrl )">\r\n				<button class="qui-btn-overlay-action-small delete-image" data-icon="bin"></button>\r\n			</div>\r\n		</div>\r\n		<div class="error-wrapper" ng-if="showError">\r\n			<div class="error-icon" data-icon="warning-triangle"></div>\r\n			<div class="error-text">{{errorMsg}}</div>\r\n		</div>\r\n		<div class="preview-progress">\r\n			<div class="preview-progressbar-wrapper">\r\n				<span class="preview-progressbar" data-dz-uploadprogress></span>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="q-media-name" q-title-translation="{{file.name}}">{{file.name}}</div>\r\n</div>'}),function(){"use strict";define("xsrfplugin",["jquery"],function($){function getRandomString(keyLength){var i,j,result="";for(i=0;keyLength>i;i++)j=Math.floor(62*Math.random()),result+=10>j?j:j>9&&36>j?String.fromCharCode(j+55):String.fromCharCode(j+61);return result}function setupXsrfPlugin(){var xsrfKey,oldajax;hasBeenSetup||(hasBeenSetup=!0,xsrfKey=getRandomString(16),oldajax=$.ajax,$.extend({ajax:function(o){if(o.headers||(o.headers={}),o.headers["X-Qlik-XrfKey"]=xsrfKey,"GET"===o.type)void 0===o.data&&(o.data={}),o.data.xrfkey=xsrfKey;else if(o.url){var separator=-1===o.url.indexOf("?")?"?":"&";o.url+=separator+"xrfkey="+xsrfKey}return oldajax.call(this,o)}}))}function resetHasBeenSetup(){hasBeenSetup=!1}var hasBeenSetup=!1;return{getRandomString:getRandomString,setupXsrfPlugin:setupXsrfPlugin,resetHasBeenSetup:resetHasBeenSetup}})}(),function(){var Dropzone,Emitter,camelize,contentLoaded,detectVerticalSquash,drawImageIOSFix,noop,without,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};noop=function(){},Emitter=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(event,fn){return this._callbacks=this._callbacks||{},this._callbacks[event]||(this._callbacks[event]=[]),this._callbacks[event].push(fn),this},Emitter.prototype.emit=function(){var args,callback,callbacks,event,_i,_len;if(event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],this._callbacks=this._callbacks||{},callbacks=this._callbacks[event])for(_i=0,_len=callbacks.length;_len>_i;_i++)callback=callbacks[_i],callback.apply(this,args);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(event,fn){var callback,callbacks,i,_i,_len;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(callbacks=this._callbacks[event],!callbacks)return this;if(1===arguments.length)return delete this._callbacks[event],this;for(i=_i=0,_len=callbacks.length;_len>_i;i=++_i)if(callback=callbacks[i],callback===fn){callbacks.splice(i,1);break}return this},Emitter}(),Dropzone=function(_super){function Dropzone(element,options){var elementOptions,fallback,_ref;if(this.element=element,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,elementOptions=null!=(_ref=Dropzone.optionsForElement(this.element))?_ref:{},this.options=extend({},this.defaultOptions,elementOptions,null!=options?options:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(fallback=this.getExistingFallback())&&fallback.parentNode&&fallback.parentNode.removeChild(fallback),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}var extend,resolveOption;return __extends(Dropzone,_super),Dropzone.prototype.Emitter=Emitter,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(file,done){return done()},init:function(){return noop},forceFallback:!1,fallback:function(){var child,messageElement,span,_i,_len,_ref;for(this.element.className=""+this.element.className+" dz-browser-not-supported",_ref=this.element.getElementsByTagName("div"),_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],/(^| )dz-message($| )/.test(child.className)&&(messageElement=child,child.className="dz-message");return messageElement||(messageElement=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(messageElement)),span=messageElement.getElementsByTagName("span")[0],span&&(span.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(file){var info,srcRatio,trgRatio;return info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height},srcRatio=file.width/file.height,info.optWidth=this.options.thumbnailWidth,info.optHeight=this.options.thumbnailHeight,null==info.optWidth&&null==info.optHeight?(info.optWidth=info.srcWidth,info.optHeight=info.srcHeight):null==info.optWidth?info.optWidth=srcRatio*info.optHeight:null==info.optHeight&&(info.optHeight=1/srcRatio*info.optWidth),trgRatio=info.optWidth/info.optHeight,file.height<info.optHeight||file.width<info.optWidth?(info.trgHeight=info.srcHeight,info.trgWidth=info.srcWidth):srcRatio>trgRatio?(info.srcHeight=file.height,info.srcWidth=info.srcHeight*trgRatio):(info.srcWidth=file.width,info.srcHeight=info.srcWidth/trgRatio),info.srcX=(file.width-info.srcWidth)/2,info.srcY=(file.height-info.srcHeight)/2,info},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:noop,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:noop,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(file){var node,removeFileEvent,removeLink,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_results;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(file.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),file.previewTemplate=file.previewElement,this.previewsContainer.appendChild(file.previewElement),_ref=file.previewElement.querySelectorAll("[data-dz-name]"),_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],node.textContent=file.name;for(_ref1=file.previewElement.querySelectorAll("[data-dz-size]"),_j=0,_len1=_ref1.length;_len1>_j;_j++)node=_ref1[_j],node.innerHTML=this.filesize(file.size);for(this.options.addRemoveLinks&&(file._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),file.previewElement.appendChild(file._removeLink)),removeFileEvent=function(_this){return function(e){return e.preventDefault(),e.stopPropagation(),file.status===Dropzone.UPLOADING?Dropzone.confirm(_this.options.dictCancelUploadConfirmation,function(){return _this.removeFile(file)}):_this.options.dictRemoveFileConfirmation?Dropzone.confirm(_this.options.dictRemoveFileConfirmation,function(){return _this.removeFile(file)}):_this.removeFile(file)}}(this),_ref2=file.previewElement.querySelectorAll("[data-dz-remove]"),_results=[],_k=0,_len2=_ref2.length;_len2>_k;_k++)removeLink=_ref2[_k],_results.push(removeLink.addEventListener("click",removeFileEvent));return _results}},removedfile:function(file){var _ref;return file.previewElement&&null!=(_ref=file.previewElement)&&_ref.parentNode.removeChild(file.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(file,dataUrl){var thumbnailElement,_i,_len,_ref;if(file.previewElement){for(file.previewElement.classList.remove("dz-file-preview"),_ref=file.previewElement.querySelectorAll("[data-dz-thumbnail]"),_i=0,_len=_ref.length;_len>_i;_i++)thumbnailElement=_ref[_i],thumbnailElement.alt=file.name,thumbnailElement.src=dataUrl;return setTimeout(function(_this){return function(){return file.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(file,message){var node,_i,_len,_ref,_results;if(file.previewElement){for(file.previewElement.classList.add("dz-error"),"String"!=typeof message&&message.error&&(message=message.error),_ref=file.previewElement.querySelectorAll("[data-dz-errormessage]"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],_results.push(node.textContent=message);return _results}},errormultiple:noop,processing:function(file){return file.previewElement&&(file.previewElement.classList.add("dz-processing"),file._removeLink)?file._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:noop,uploadprogress:function(file,progress,bytesSent){var node,_i,_len,_ref,_results;if(file.previewElement){for(_ref=file.previewElement.querySelectorAll("[data-dz-uploadprogress]"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],"PROGRESS"===node.nodeName?_results.push(node.value=progress):_results.push(node.style.width=""+progress+"%");return _results}},totaluploadprogress:noop,sending:noop,sendingmultiple:noop,success:function(file){return file.previewElement?file.previewElement.classList.add("dz-success"):void 0},successmultiple:noop,canceled:function(file){return this.emit("error",file,"Upload canceled.")},canceledmultiple:noop,complete:function(file){return file._removeLink&&(file._removeLink.textContent=this.options.dictRemoveFile),file.previewElement?file.previewElement.classList.add("dz-complete"):void 0},completemultiple:noop,maxfilesexceeded:noop,maxfilesreached:noop,queuecomplete:noop,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},extend=function(){var key,object,objects,target,val,_i,_len;for(target=arguments[0],objects=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=objects.length;_len>_i;_i++){object=objects[_i];for(key in object)val=object[key],target[key]=val}return target},Dropzone.prototype.getAcceptedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.accepted&&_results.push(file);return _results},Dropzone.prototype.getRejectedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.accepted||_results.push(file);return _results},Dropzone.prototype.getFilesWithStatus=function(status){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.status===status&&_results.push(file);return _results},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getActiveFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],(file.status===Dropzone.UPLOADING||file.status===Dropzone.QUEUED)&&_results.push(file);return _results},Dropzone.prototype.init=function(){var eventName,noPropagation,setupHiddenFileInput,_i,_len,_ref,_ref1;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(setupHiddenFileInput=function(_this){return function(){return _this.hiddenFileInput&&document.body.removeChild(_this.hiddenFileInput),_this.hiddenFileInput=document.createElement("input"),_this.hiddenFileInput.setAttribute("type","file"),(null==_this.options.maxFiles||_this.options.maxFiles>1)&&_this.hiddenFileInput.setAttribute("multiple","multiple"),_this.hiddenFileInput.className="dz-hidden-input",null!=_this.options.acceptedFiles&&_this.hiddenFileInput.setAttribute("accept",_this.options.acceptedFiles),null!=_this.options.capture&&_this.hiddenFileInput.setAttribute("capture",_this.options.capture),_this.hiddenFileInput.style.visibility="hidden",_this.hiddenFileInput.style.position="absolute",_this.hiddenFileInput.style.top="0",_this.hiddenFileInput.style.left="0",_this.hiddenFileInput.style.height="0",_this.hiddenFileInput.style.width="0",document.body.appendChild(_this.hiddenFileInput),_this.hiddenFileInput.addEventListener("change",function(){var file,files,_i,_len;if(files=_this.hiddenFileInput.files,files.length)for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],_this.addFile(file);return setupHiddenFileInput()})}}(this))(),this.URL=null!=(_ref=window.URL)?_ref:window.webkitURL,_ref1=this.events,_i=0,_len=_ref1.length;_len>_i;_i++)eventName=_ref1[_i],this.on(eventName,this.options[eventName]);return this.on("uploadprogress",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("canceled",function(_this){return function(file){return _this.emit("complete",file)}}(this)),this.on("complete",function(_this){return function(file){return 0===_this.getUploadingFiles().length&&0===_this.getQueuedFiles().length?setTimeout(function(){return _this.emit("queuecomplete")},0):void 0}}(this)),noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(_this){return function(e){return _this.emit("dragstart",e)}}(this),dragenter:function(_this){return function(e){return noPropagation(e),_this.emit("dragenter",e)}}(this),dragover:function(_this){return function(e){var efct;try{efct=e.dataTransfer.effectAllowed}catch(_error){}return e.dataTransfer.dropEffect="move"===efct||"linkMove"===efct?"move":"copy",noPropagation(e),_this.emit("dragover",e)}}(this),dragleave:function(_this){return function(e){return _this.emit("dragleave",e)}}(this),drop:function(_this){return function(e){return noPropagation(e),_this.drop(e)}}(this),dragend:function(_this){return function(e){return _this.emit("dragend",e)}}(this)}}],this.clickableElements.forEach(function(_this){return function(clickableElement){return _this.listeners.push({element:clickableElement,events:{click:function(evt){return clickableElement!==_this.element||evt.target===_this.element||Dropzone.elementInside(evt.target,_this.element.querySelector(".dz-message"))?_this.hiddenFileInput.click():void 0}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var _ref;return this.disable(),this.removeAllFiles(!0),(null!=(_ref=this.hiddenFileInput)?_ref.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var activeFiles,file,totalBytes,totalBytesSent,totalUploadProgress,_i,_len,_ref;if(totalBytesSent=0,totalBytes=0,activeFiles=this.getActiveFiles(),activeFiles.length){for(_ref=this.getActiveFiles(),_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],totalBytesSent+=file.upload.bytesSent,totalBytes+=file.upload.total;totalUploadProgress=100*totalBytesSent/totalBytes}else totalUploadProgress=100;return this.emit("totaluploadprogress",totalUploadProgress,totalBytes,totalBytesSent)},Dropzone.prototype._getParamName=function(n){return"function"==typeof this.options.paramName?this.options.paramName(n):""+this.options.paramName+(this.options.uploadMultiple?"["+n+"]":"")},Dropzone.prototype.getFallbackForm=function(){var existingFallback,fields,fieldsString,form;return(existingFallback=this.getExistingFallback())?existingFallback:(fieldsString='<div class="dz-fallback">',this.options.dictFallbackText&&(fieldsString+="<p>"+this.options.dictFallbackText+"</p>"),fieldsString+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',fields=Dropzone.createElement(fieldsString),"FORM"!==this.element.tagName?(form=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),form.appendChild(fields)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=form?form:fields)},Dropzone.prototype.getExistingFallback=function(){var fallback,getFallback,tagName,_i,_len,_ref;for(getFallback=function(elements){var el,_i,_len;for(_i=0,_len=elements.length;_len>_i;_i++)if(el=elements[_i],/(^| )fallback($| )/.test(el.className))return el},_ref=["div","form"],_i=0,_len=_ref.length;_len>_i;_i++)if(tagName=_ref[_i],fallback=getFallback(this.element.getElementsByTagName(tagName)))return fallback;
},Dropzone.prototype.setupEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.addEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.removeEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.removeEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.disable=function(){var file,_i,_len,_ref,_results;for(this.clickableElements.forEach(function(element){return element.classList.remove("dz-clickable")}),this.removeEventListeners(),_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],_results.push(this.cancelUpload(file));return _results},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(element){return element.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(size){var cutoff,i,selectedSize,selectedUnit,unit,units,_i,_len;for(units=["TB","GB","MB","KB","b"],selectedSize=selectedUnit=null,i=_i=0,_len=units.length;_len>_i;i=++_i)if(unit=units[i],cutoff=Math.pow(this.options.filesizeBase,4-i)/10,size>=cutoff){selectedSize=size/Math.pow(this.options.filesizeBase,4-i),selectedUnit=unit;break}return selectedSize=Math.round(10*selectedSize)/10,"<strong>"+selectedSize+"</strong> "+selectedUnit},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var files,items;e.dataTransfer&&(this.emit("drop",e),files=e.dataTransfer.files,files.length&&(items=e.dataTransfer.items,items&&items.length&&null!=items[0].webkitGetAsEntry?this._addFilesFromItems(items):this.handleFiles(files)))},Dropzone.prototype.paste=function(e){var items,_ref;if(null!=(null!=e&&null!=(_ref=e.clipboardData)?_ref.items:void 0))return this.emit("paste",e),items=e.clipboardData.items,items.length?this._addFilesFromItems(items):void 0},Dropzone.prototype.handleFiles=function(files){var file,_i,_len,_results;for(_results=[],_i=0,_len=files.length;_len>_i;_i++)file=files[_i],_results.push(this.addFile(file));return _results},Dropzone.prototype._addFilesFromItems=function(items){var entry,item,_i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],null!=item.webkitGetAsEntry&&(entry=item.webkitGetAsEntry())?entry.isFile?_results.push(this.addFile(item.getAsFile())):entry.isDirectory?_results.push(this._addFilesFromDirectory(entry,entry.name)):_results.push(void 0):null!=item.getAsFile&&(null==item.kind||"file"===item.kind)?_results.push(this.addFile(item.getAsFile())):_results.push(void 0);return _results},Dropzone.prototype._addFilesFromDirectory=function(directory,path){var dirReader,entriesReader;return dirReader=directory.createReader(),entriesReader=function(_this){return function(entries){var entry,_i,_len;for(_i=0,_len=entries.length;_len>_i;_i++)entry=entries[_i],entry.isFile?entry.file(function(file){return _this.options.ignoreHiddenFiles&&"."===file.name.substring(0,1)?void 0:(file.fullPath=""+path+"/"+file.name,_this.addFile(file))}):entry.isDirectory&&_this._addFilesFromDirectory(entry,""+path+"/"+entry.name)}}(this),dirReader.readEntries(entriesReader,function(error){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(error):void 0})},Dropzone.prototype.accept=function(file,done){return file.size>1024*this.options.maxFilesize*1024?done(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(file.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(file,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",file)):this.options.accept.call(this,file,done):done(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(file){return file.upload={progress:0,total:file.size,bytesSent:0},this.files.push(file),file.status=Dropzone.ADDED,this.emit("addedfile",file),this._enqueueThumbnail(file),this.accept(file,function(_this){return function(error){return error?(file.accepted=!1,_this._errorProcessing([file],error)):(file.accepted=!0,_this.options.autoQueue&&_this.enqueueFile(file)),_this._updateMaxFilesReachedClass()}}(this))},Dropzone.prototype.enqueueFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],this.enqueueFile(file);return null},Dropzone.prototype.enqueueFile=function(file){if(file.status!==Dropzone.ADDED||file.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return file.status=Dropzone.QUEUED,this.options.autoProcessQueue?setTimeout(function(_this){return function(){return _this.processQueue()}}(this),0):void 0},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(file){return this.options.createImageThumbnails&&file.type.match(/image.*/)&&file.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(file),setTimeout(function(_this){return function(){return _this._processThumbnailQueue()}}(this),0)):void 0},Dropzone.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(_this){return function(){return _this._processingThumbnail=!1,_this._processThumbnailQueue()}}(this)))},Dropzone.prototype.removeFile=function(file){return file.status===Dropzone.UPLOADING&&this.cancelUpload(file),this.files=without(this.files,file),this.emit("removedfile",file),0===this.files.length?this.emit("reset"):void 0},Dropzone.prototype.removeAllFiles=function(cancelIfNecessary){var file,_i,_len,_ref;for(null==cancelIfNecessary&&(cancelIfNecessary=!1),_ref=this.files.slice(),_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],(file.status!==Dropzone.UPLOADING||cancelIfNecessary)&&this.removeFile(file);return null},Dropzone.prototype.createThumbnail=function(file,callback){var fileReader;return fileReader=new FileReader,fileReader.onload=function(_this){return function(){return"image/svg+xml"===file.type?(_this.emit("thumbnail",file,fileReader.result),void(null!=callback&&callback())):_this.createThumbnailFromUrl(file,fileReader.result,callback)}}(this),fileReader.readAsDataURL(file)},Dropzone.prototype.createThumbnailFromUrl=function(file,imageUrl,callback){var img;return img=document.createElement("img"),img.onload=function(_this){return function(){var canvas,ctx,resizeInfo,thumbnail,_ref,_ref1,_ref2,_ref3;return file.width=img.width,file.height=img.height,resizeInfo=_this.options.resize.call(_this,file),null==resizeInfo.trgWidth&&(resizeInfo.trgWidth=resizeInfo.optWidth),null==resizeInfo.trgHeight&&(resizeInfo.trgHeight=resizeInfo.optHeight),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=resizeInfo.trgWidth,canvas.height=resizeInfo.trgHeight,drawImageIOSFix(ctx,img,null!=(_ref=resizeInfo.srcX)?_ref:0,null!=(_ref1=resizeInfo.srcY)?_ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,null!=(_ref2=resizeInfo.trgX)?_ref2:0,null!=(_ref3=resizeInfo.trgY)?_ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight),thumbnail=canvas.toDataURL("image/png"),_this.emit("thumbnail",file,thumbnail),null!=callback?callback():void 0}}(this),null!=callback&&(img.onerror=callback),img.src=imageUrl},Dropzone.prototype.processQueue=function(){var i,parallelUploads,processingLength,queuedFiles;if(parallelUploads=this.options.parallelUploads,processingLength=this.getUploadingFiles().length,i=processingLength,!(processingLength>=parallelUploads)&&(queuedFiles=this.getQueuedFiles(),queuedFiles.length>0)){if(this.options.uploadMultiple)return this.processFiles(queuedFiles.slice(0,parallelUploads-processingLength));for(;parallelUploads>i;){if(!queuedFiles.length)return;this.processFile(queuedFiles.shift()),i++}}},Dropzone.prototype.processFile=function(file){return this.processFiles([file])},Dropzone.prototype.processFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.processing=!0,file.status=Dropzone.UPLOADING,this.emit("processing",file);return this.options.uploadMultiple&&this.emit("processingmultiple",files),this.uploadFiles(files)},Dropzone.prototype._getFilesWithXhr=function(xhr){var file,files;return files=function(){var _i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.xhr===xhr&&_results.push(file);return _results}.call(this)},Dropzone.prototype.cancelUpload=function(file){var groupedFile,groupedFiles,_i,_j,_len,_len1,_ref;if(file.status===Dropzone.UPLOADING){for(groupedFiles=this._getFilesWithXhr(file.xhr),_i=0,_len=groupedFiles.length;_len>_i;_i++)groupedFile=groupedFiles[_i],groupedFile.status=Dropzone.CANCELED;for(file.xhr.abort(),_j=0,_len1=groupedFiles.length;_len1>_j;_j++)groupedFile=groupedFiles[_j],this.emit("canceled",groupedFile);this.options.uploadMultiple&&this.emit("canceledmultiple",groupedFiles)}else((_ref=file.status)===Dropzone.ADDED||_ref===Dropzone.QUEUED)&&(file.status=Dropzone.CANCELED,this.emit("canceled",file),this.options.uploadMultiple&&this.emit("canceledmultiple",[file]));return this.options.autoProcessQueue?this.processQueue():void 0},resolveOption=function(){var args,option;return option=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],"function"==typeof option?option.apply(this,args):option},Dropzone.prototype.uploadFile=function(file){return this.uploadFiles([file])},Dropzone.prototype.uploadFiles=function(files){var file,formData,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,method,option,progressObj,response,updateProgress,url,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;for(xhr=new XMLHttpRequest,_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.xhr=xhr;method=resolveOption(this.options.method,files),url=resolveOption(this.options.url,files),xhr.open(method,url,!0),xhr.withCredentials=!!this.options.withCredentials,response=null,handleError=function(_this){return function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],_results.push(_this._errorProcessing(files,response||_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr));return _results}}(this),updateProgress=function(_this){return function(e){var allFilesFinished,progress,_j,_k,_l,_len1,_len2,_len3,_results;if(null!=e)for(progress=100*e.loaded/e.total,_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],file.upload={progress:progress,total:e.total,bytesSent:e.loaded};else{for(allFilesFinished=!0,progress=100,_k=0,_len2=files.length;_len2>_k;_k++)file=files[_k],(100!==file.upload.progress||file.upload.bytesSent!==file.upload.total)&&(allFilesFinished=!1),file.upload.progress=progress,file.upload.bytesSent=file.upload.total;if(allFilesFinished)return}for(_results=[],_l=0,_len3=files.length;_len3>_l;_l++)file=files[_l],_results.push(_this.emit("uploadprogress",file,progress,file.upload.bytesSent));return _results}}(this),xhr.onload=function(_this){return function(e){var _ref;if(files[0].status!==Dropzone.CANCELED&&4===xhr.readyState){if(response=xhr.responseText,xhr.getResponseHeader("content-type")&&~xhr.getResponseHeader("content-type").indexOf("application/json"))try{response=JSON.parse(response)}catch(_error){e=_error,response="Invalid JSON response from server."}return updateProgress(),200<=(_ref=xhr.status)&&300>_ref?_this._finished(files,response,e):handleError()}}}(this),xhr.onerror=function(_this){return function(){return files[0].status!==Dropzone.CANCELED?handleError():void 0}}(this),progressObj=null!=(_ref=xhr.upload)?_ref:xhr,progressObj.onprogress=updateProgress,headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&extend(headers,this.options.headers);for(headerName in headers)headerValue=headers[headerName],xhr.setRequestHeader(headerName,headerValue);if(formData=new FormData,this.options.params){_ref1=this.options.params;for(key in _ref1)value=_ref1[key],formData.append(key,value)}for(_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],this.emit("sending",file,xhr,formData);if(this.options.uploadMultiple&&this.emit("sendingmultiple",files,xhr,formData),"FORM"===this.element.tagName)for(_ref2=this.element.querySelectorAll("input, textarea, select, button"),_k=0,_len2=_ref2.length;_len2>_k;_k++)if(input=_ref2[_k],inputName=input.getAttribute("name"),inputType=input.getAttribute("type"),"SELECT"===input.tagName&&input.hasAttribute("multiple"))for(_ref3=input.options,_l=0,_len3=_ref3.length;_len3>_l;_l++)option=_ref3[_l],option.selected&&formData.append(inputName,option.value);else(!inputType||"checkbox"!==(_ref4=inputType.toLowerCase())&&"radio"!==_ref4||input.checked)&&formData.append(inputName,input.value);for(i=_m=0,_ref5=files.length-1;_ref5>=0?_ref5>=_m:_m>=_ref5;i=_ref5>=0?++_m:--_m)formData.append(this._getParamName(i),files[i],files[i].name);return xhr.send(formData)},Dropzone.prototype._finished=function(files,responseText,e){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.status=Dropzone.SUCCESS,this.emit("success",file,responseText,e),this.emit("complete",file);return this.options.uploadMultiple&&(this.emit("successmultiple",files,responseText,e),this.emit("completemultiple",files)),this.options.autoProcessQueue?this.processQueue():void 0},Dropzone.prototype._errorProcessing=function(files,message,xhr){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.status=Dropzone.ERROR,this.emit("error",file,message,xhr),this.emit("complete",file);return this.options.uploadMultiple&&(this.emit("errormultiple",files,message,xhr),this.emit("completemultiple",files)),this.options.autoProcessQueue?this.processQueue():void 0},Dropzone}(Emitter),Dropzone.version="4.0.1",Dropzone.options={},Dropzone.optionsForElement=function(element){return element.getAttribute("id")?Dropzone.options[camelize(element.getAttribute("id"))]:void 0},Dropzone.instances=[],Dropzone.forElement=function(element){if("string"==typeof element&&(element=document.querySelector(element)),null==(null!=element?element.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return element.dropzone},Dropzone.autoDiscover=!0,Dropzone.discover=function(){var checkElements,dropzone,dropzones,_i,_len,_results;for(document.querySelectorAll?dropzones=document.querySelectorAll(".dropzone"):(dropzones=[],checkElements=function(elements){var el,_i,_len,_results;for(_results=[],_i=0,_len=elements.length;_len>_i;_i++)el=elements[_i],/(^| )dropzone($| )/.test(el.className)?_results.push(dropzones.push(el)):_results.push(void 0);return _results},checkElements(document.getElementsByTagName("div")),checkElements(document.getElementsByTagName("form"))),_results=[],_i=0,_len=dropzones.length;_len>_i;_i++)dropzone=dropzones[_i],Dropzone.optionsForElement(dropzone)!==!1?_results.push(new Dropzone(dropzone)):_results.push(void 0);return _results},Dropzone.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],Dropzone.isBrowserSupported=function(){var capableBrowser,regex,_i,_len,_ref;if(capableBrowser=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(_ref=Dropzone.blacklistedBrowsers,_i=0,_len=_ref.length;_len>_i;_i++)regex=_ref[_i],regex.test(navigator.userAgent)&&(capableBrowser=!1);else capableBrowser=!1;else capableBrowser=!1;return capableBrowser},without=function(list,rejectedItem){var item,_i,_len,_results;for(_results=[],_i=0,_len=list.length;_len>_i;_i++)item=list[_i],item!==rejectedItem&&_results.push(item);return _results},camelize=function(str){return str.replace(/[\-_](\w)/g,function(match){return match.charAt(1).toUpperCase()})},Dropzone.createElement=function(string){var div;return div=document.createElement("div"),div.innerHTML=string,div.childNodes[0]},Dropzone.elementInside=function(element,container){if(element===container)return!0;for(;element=element.parentNode;)if(element===container)return!0;return!1},Dropzone.getElement=function(el,name){var element;if("string"==typeof el?element=document.querySelector(el):null!=el.nodeType&&(element=el),null==element)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector or a plain HTML element.");return element},Dropzone.getElements=function(els,name){var e,el,elements,_i,_j,_len,_len1,_ref;if(els instanceof Array){elements=[];try{for(_i=0,_len=els.length;_len>_i;_i++)el=els[_i],elements.push(this.getElement(el,name))}catch(_error){e=_error,elements=null}}else if("string"==typeof els)for(elements=[],_ref=document.querySelectorAll(els),_j=0,_len1=_ref.length;_len1>_j;_j++)el=_ref[_j],elements.push(el);else null!=els.nodeType&&(elements=[els]);if(null==elements||!elements.length)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return elements},Dropzone.confirm=function(question,accepted,rejected){return window.confirm(question)?accepted():null!=rejected?rejected():void 0},Dropzone.isValidFile=function(file,acceptedFiles){var baseMimeType,mimeType,validType,_i,_len;if(!acceptedFiles)return!0;for(acceptedFiles=acceptedFiles.split(","),mimeType=file.type,baseMimeType=mimeType.replace(/\/.*$/,""),_i=0,_len=acceptedFiles.length;_len>_i;_i++)if(validType=acceptedFiles[_i],validType=validType.trim(),"."===validType.charAt(0)){if(-1!==file.name.toLowerCase().indexOf(validType.toLowerCase(),file.name.length-validType.length))return!0}else if(/\/\*$/.test(validType)){if(baseMimeType===validType.replace(/\/.*$/,""))return!0}else if(mimeType===validType)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(options){return this.each(function(){return new Dropzone(this,options)})}),"undefined"!=typeof module&&null!==module?module.exports=Dropzone:window.Dropzone=Dropzone,Dropzone.ADDED="added",Dropzone.QUEUED="queued",Dropzone.ACCEPTED=Dropzone.QUEUED,Dropzone.UPLOADING="uploading",Dropzone.PROCESSING=Dropzone.UPLOADING,Dropzone.CANCELED="canceled",Dropzone.ERROR="error",Dropzone.SUCCESS="success",detectVerticalSquash=function(img){var alpha,canvas,ctx,data,ey,ih,iw,py,ratio,sy;for(iw=img.naturalWidth,ih=img.naturalHeight,canvas=document.createElement("canvas"),canvas.width=1,canvas.height=ih,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0),data=ctx.getImageData(0,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;)alpha=data[4*(py-1)+3],0===alpha?ey=py:sy=py,py=ey+sy>>1;return ratio=py/ih,0===ratio?1:ratio},drawImageIOSFix=function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;return vertSquashRatio=detectVerticalSquash(img),ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio)},contentLoaded=function(win,fn){var add,doc,done,init,poll,pre,rem,root,top;if(done=!1,top=!0,doc=win.document,root=doc.documentElement,add=doc.addEventListener?"addEventListener":"attachEvent",rem=doc.addEventListener?"removeEventListener":"detachEvent",pre=doc.addEventListener?"":"on",init=function(e){return"readystatechange"!==e.type||"complete"===doc.readyState?(("load"===e.type?win:doc)[rem](pre+e.type,init,!1),!done&&(done=!0)?fn.call(win,e.type||e):void 0):void 0},poll=function(){var e;try{root.doScroll("left")}catch(_error){return e=_error,void setTimeout(poll,50)}return init("poll")},"complete"!==doc.readyState){if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(_error){}top&&poll()}return doc[add](pre+"DOMContentLoaded",init,!1),doc[add](pre+"readystatechange",init,!1),win[add](pre+"load",init,!1)}},Dropzone._autoDiscoverFunction=function(){return Dropzone.autoDiscover?Dropzone.discover():void 0},contentLoaded(window,Dropzone._autoDiscoverFunction)}.call(this),define("dropzone",function(global){return function(){var ret;return ret||global.Dropzone}}(this)),define("general.components/media-library/update/media-update",["jquery","qvangular","translator","text!general.components/media-library/update/media-update.ng.html","text!general.components/media-library/update/preview-item.ng.html","general.models/media-library","core.models/app","xsrfplugin","general.utils/dom-util","client.controllers/error-handler-controller","dropzone","core.utils/deferred","util"],function($,qvangular,translator,template,previewItemTemplate,MediaLibrary,App,xsrfplugin,domUtil,ErrorHandler,Dropzone,Deferred,Util){"use strict";function updateQuotaInfo($scope,app){app.getContentLibraries().then(function(list){var quotaLeft=MediaLibrary.getRemainingSpace(list)/1024/1024;quotaLeft=quotaLeft.toString().split("e"),quotaLeft=Math.floor(+(quotaLeft[0]+"e"+(quotaLeft[1]?+quotaLeft[1]+1:1))),quotaLeft=quotaLeft.toString().split("e"),quotaLeft=+(quotaLeft[0]+"e"+(quotaLeft[1]?+quotaLeft[1]-1:-1)),$scope.quotaInfo=translator.get("MediaLibrary.QuotaInfo",[quotaLeft])})}function deleteFileInServer($scope,$http,filename){return App.get().then(function(app){var config={params:{externalpath:filename,xrfkey:xrfKey},headers:{"X-Qlik-XrfKey":xrfKey}},url=Util.basePath+"qrs/appcontent/"+app.id+"/deletecontent";return $http["delete"](url,config).success(function(){updateQuotaInfo($scope,app)}).error(function(data,status){var statusCode=status;0===status&&(statusCode=500),ErrorHandler.showDialog({code:statusCode})})})}var xrfKey=xsrfplugin.getRandomString(16);qvangular.directive("qvMediaUpdate",function(){return{restrict:"E",replace:!0,scope:{updateExp:"=",selectedFile:"=",selectFile:"&"},template:template,controller:["$scope","$element","$compile","$timeout","$http","$delayedModal",function($scope,$element,$compile,$timeout,$http,$delayedModal){function createChildScope(elem,file){var childScope=$scope.$new();childScope.file=file,$compile($(elem))(childScope)}function deleteFile(file,filename,filepath){var deferred=new Deferred;return $scope.updateExp.deleteDialogShown=!0,$delayedModal.open({title:"MediaLibrary.Confirm.Delete.Title",content:translator.get("MediaLibrary.Confirm.Delete.Description",[filename]),buttons:[{name:"Common.Cancel",callback:function(){$scope.updateExp.deleteDialogShown=!1,deferred.reject()}},{name:"Common.Delete",defaultButton:!0,callback:function(){deleteFileInServer($scope,$http,filename).then(function(){$scope.selectedFile===filepath&&$scope.selectFile()(event,null,null),file&&dropzone.removeFile(file),deferred.resolve()},function(){deferred.reject()}),$scope.updateExp.deleteDialogShown=!1}}]}),deferred.promise}var dropzone;$scope.isEmpty=!0,$scope.previewCounter=0,Dropzone.autoDiscover=!1,Dropzone.confirm=function(question,accepted,rejected){return null!=rejected?rejected():void 0},$scope.updateExp.deleteFile=function(filename,filepath){for(var list=dropzone.getFilesWithStatus(Dropzone.SUCCESS),file=null,i=0;i<list.length;i++)if(filename===list[i].name){file=list[i];break}return deleteFile(file,filename,filepath)},$scope.onCancelUpload=function(event,file){event.preventDefault(),event.stopPropagation(),dropzone.cancelUpload(file)},$scope.onDelete=function(event,file,filename,filepath){event.preventDefault(),event.stopPropagation(),deleteFile(file,filename,filepath)},$scope.onSelectImage=function(event,file){return domUtil.scrollElmentIntoView($(file.previewElement),".media-library-preview-container",!1,!0),$(event.currentTarget).hasClass("dz-success")?void $scope.selectFile()(event,file.qUrl,file.qUrlDef):(event.preventDefault(),void event.stopPropagation())},App.get().then(function(app){var url=Util.basePath+"qrs/appcontent/"+app.id+"/uploadfile?",appcontentDefaultUrl="/appcontent/"+app.id+"/";updateQuotaInfo($scope,app),dropzone=new Dropzone("#media-library-dropzone",{url:url,headers:{"X-Qlik-XrfKey":xrfKey},acceptedFiles:".png,.gif,.jpg,.jpeg",maxFilesize:5,parallelUploads:4,filesizeBase:1024,thumbnailWidth:200,thumbnailHeight:200,previewTemplate:previewItemTemplate,previewsContainer:".media-library-preview-container",dictInvalidFileType:translator.get("ErrorCode.3004"),dictFileTooBig:translator.get("MediaLibrary.Error.MaxFileSizeExceeded"),dictResponseError:translator.get("ErrorCode.500")}),dropzone.on("processing",function(file){this.options.url=url+"externalpath="+encodeURIComponent(file.name)+"&overwrite=false&xrfkey="+xrfKey}),dropzone.on("addedfile",function(file){createChildScope(file.previewElement,file),$timeout(function(){$scope.isEmpty=!1,$scope.previewCounter++,$scope.updateExp.isUploading=!0,domUtil.scrollElmentIntoView($(file.previewElement),".media-library-preview-container",!1,!0)})}),dropzone.on("removedfile",function(){$timeout(function(){$scope.previewCounter--,0===$scope.previewCounter&&($scope.isEmpty=!0)})}),dropzone.on("success",function(file){file.qUrl=appcontentDefaultUrl+encodeURIComponent(file.name).replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16).toUpperCase()}),file.qUrlDef=appcontentDefaultUrl+file.name,updateQuotaInfo($scope,app)}),dropzone.on("queuecomplete",function(){$timeout(function(){$scope.updateExp.isUploading=!1})}),dropzone.on("error",function(file,errorMessage,xhr){var elemScope=$(file.previewElement).scope();elemScope.showError=!0,xhr&&xhr.status?409===xhr.status?elemScope.errorMsg=translator.get("MediaLibrary.Error.FileAlreadyExists"):413===xhr.status?elemScope.errorMsg=translator.get("MediaLibrary.Error.MaxFileSizeExceeded"):elemScope.errorMsg=translator.get("ErrorCode."+xhr.status):elemScope.errorMsg=translator.get(errorMessage)})}),$scope.$on("$destroy",function(){dropzone.destroy(),$scope.updateExp.deleteDialogShown&&$delayedModal.close()})}]}})}),define("text!general.components/context-menu/context-menu.ng.html",[],function(){return'<div class="qui-immidiateContextual qv-contextmenu" tid="context-menu" qva-outside="close($event)">\r\n	<div class="content">\r\n		<ul class="qui-textlist">\r\n			<li ng-if="levels.length" class="qv-contextmenu-item-container back">\r\n				<div class="qv-contextmenu-item" qva-activate="goBack();" tcl="context-menu-item">\r\n					<i class="icon-triangle-left back-icon"></i>\r\n					<span class="qui-textlist-text" q-translation="Common.Back" tid="context-menu-back"></span>\r\n				</div>\r\n			</li>\r\n			<li ng-repeat="item in currentItems" class="qv-contextmenu-item-container">\r\n				<div class="qv-contextmenu-item" ng-class="{ \'qv-contextmenu-has-submenu\': item.hasSubmenu(), \'has-icon\': item.hasIcon() }"\r\n					 qva-activate="selectItem($event,item)" tcl="context-menu-item">\r\n					<i class="item-icon {{item.icon}}" ng-if="item.hasIcon()"></i>\r\n					<span class="qui-textlist-text" title="{{item.getLabel()}}" tid="{{item.tid}}">{{item.getLabel()}}</span>\r\n					<i ng-show="item.hasSubmenu()" class="icon-triangle-right"></i>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("general.components/context-menu/context-menu",["jquery","general.utils/window-positioner","core.utils/resize","text!./context-menu.ng.html"],function($,windowPositioner,Resize,template){"use strict";function dock(element,docking,x,y){switch(docking){case"BottomLeft":x-=element.outerWidth();break;case"Bottom":x-=element.outerWidth()/2;break;case"BottomRight":break;case"Left":x-=element.outerWidth(),y-=element.outerHeight()/2;break;case"Center":x-=element.outerWidth()/2,y-=element.outerHeight()/2;break;case"Right":y-=element.outerHeight()/2;break;case"Top":y-=element.outerHeight(),x-=element.outerWidth()/2;break;case"TopRight":default:y-=element.outerHeight()}return{left:x,top:y}}function limit(element,offset){var win=$(window),padding=10,min_x=padding,max_x=win.outerWidth()-element.outerWidth()-padding,x=Math.max(min_x,Math.min(max_x,offset.left)),min_y=padding,max_y=win.outerHeight()-element.outerHeight()-padding,y=Math.max(min_y,Math.min(max_y,offset.top));return{left:x,top:y}}function position(element,docking,position){var offset=dock(element,docking,position.x,position.y);return offset=limit(element,offset),element.offset(offset),offset}function reposition(element,offset){return offset=limit(element,offset),element.offset(offset),offset}function afterDOMUpdate($scope,callback){$scope.$$postDigest(function(){$scope.$$postDigest(callback)})}var contextMenuComponent={template:template,scope:{menu:"=",options:"="},controller:["$scope","$element","$timeout",function($scope,$element){function refreshPosition(offset){afterDOMUpdate($scope,function(){$scope.options.alignTo?windowPositioner.align(getElement(),$scope.options.alignTo,{collision:$scope.options.collision||"flip",position:$scope.options.docking||"top"}):(offset=offset||currentOffset,currentOffset=offset?reposition(getElement(),offset):position(getElement(),$scope.options.docking,$scope.options.position))})}function stepOut(){if($scope.levels.length){var level=$scope.levels.pop();$scope.currentItems=level.items,refreshPosition(level.offset)}}function stepInto(item){var items=item.items;$scope.levels.push({items:$scope.currentItems,offset:currentOffset}),$scope.currentItems=items,refreshPosition()}function getElement(){return $element.children().first()}var currentOffset=null;$scope.levels=[],$scope.currentItems=$scope.menu.items,$scope.goBack=function(){stepOut()},$scope.selectItem=function(event,item){event.stopPropagation(),item.hasSubmenu()?stepInto(item):(item.select(item.args),$scope.close())},$scope.close=function(){"function"==typeof $scope.menu.onClosing&&$scope.menu.onClosing.call(null),$scope.destroyComponent(),Resize.off("start",$scope.close)},Resize.on("start",$scope.close),$element.find(".content").css("max-height",$(window).outerHeight()-40),refreshPosition(),"function"==typeof $scope.menu.onOpen&&$scope.menu.onOpen.call(null)}]};return contextMenuComponent}),define("general.components/context-menu/context-menu-service",["qvangular","general.components/context-menu/context-menu","general.services/show-service/show-service","translator"],function(qvangular,contextMenuComponent,showService,translator){"use strict";var Item=function(item){var self=this;Object.keys(item||{}).forEach(function(key){self[key]=item[key]}),this.items=[]};Item.prototype.addItem=function(options){var item=new Item(options);return this.items.push(item),item},Item.prototype.hasSubmenu=function(){return this.items.length>0},Item.prototype.hasIcon=function(){return!!this.icon},Item.prototype.getLabel=function(){function getTranslationString(value){return Array.isArray(value)?translator.get(value[0],value.slice(1).join(",")):translator.get(value)}return"function"==typeof this.translation?getTranslationString(this.translation()):this.translation?getTranslationString(this.translation):"function"==typeof this.label?this.label():this.label?this.label:"Missing translation/label"},qvangular.service("qvContextMenu",function(){var currentComponent,service={};return service.show=function(menu,options){if(service.close(),
0!==menu.items.length){var component=options.component||contextMenuComponent;return currentComponent=showService.show(component,{menu:menu,options:options})}},service.close=function(){currentComponent&&(currentComponent.destroy(),currentComponent=null)},service.menu=function(){var root=new Item,menu={addItem:function(item){return root.addItem(item)}};return Object.defineProperty(menu,"items",{get:function(){return root.items}}),menu},service})}),define("general.components/media-library/media-library",["jquery","qvangular","require","core.models/app","general.models/media-library","text!./media-library.ng.html","text!./media-library-grid.ng.html","text!./media-library-list.ng.html","general.services/show-service/show-service","general.utils/dom-util","general.views/bouncy-grid/bouncy-grid","general.components/media-library/update/media-update","general.components/context-menu/context-menu-service"],function($,qvangular,require,App,MediaLibrary,template,templateGrid,templateList,showService,domUtil){function show(opts){var input={onCancel:opts.onCancel,onConfirm:opts.onConfirm,selectedFile:opts.selectedFile,filter:["png","gif","jpg","jpeg"]};showService.show(component,input),state.isShown=!0}function hide(){if(state.isShown){var $mediaLibElem=$('[qv-id="media-library-modal"]');$mediaLibElem.length&&$mediaLibElem.scope().cancel(!0)}}function isShown(){return state.isShown}var state={isShown:!1};qvangular.directive("qveMediaList",function(){return{replace:!0,restrict:"E",template:templateList}}),qvangular.directive("qveMediaGrid",function(){return{replace:!0,restrict:"E",template:templateGrid}});var component={template:template,controller:["$scope","$element","qvContextMenu",function($scope,$element,$qvContextMenu){function setSelected(file,fileDef){file=file||null,fileDef=fileDef||null,$scope.selectedFile=file,$scope.selectedFileDef=fileDef}function getLibraryItems(){App.get().then(function(app){app.getLibraryContent($scope.view).then(function(list){var tree=MediaLibrary.createTree(list,$scope.input.filter,!0);$scope.rootEntry=tree,$scope.hasFiles=tree.children.length>0})})}function updateAfterDelete(deletedFile){getLibraryItems(),$scope.input.selectedFile&&deletedFile===$scope.input.selectedFile&&(inUseFileDeleted=!0)}var link=require.toUrl("img/medialibrary/thumb.png"),inUseFileDeleted=!1;$scope.inZoom=!1,$scope.firstTimeRenderCheck=!0,$scope.lists=[],$scope.selectedFile=null,$scope.hasFiles=!1,$scope.view=null,link=MediaLibrary.stripBasePath(link),link=MediaLibrary.addBasePath(link),$scope.staticSrc=link,$scope.updateExp={isUploading:!1,deleteDialogShown:!1,deleteFile:null},$scope.getSrc=function(url){return url=MediaLibrary.stripBasePath(url),url=MediaLibrary.addBasePath(url)},$scope.zoomImage=function(e,item){e.preventDefault(),e.stopPropagation(),$scope.zoomSrc=item.path,$scope.inZoom=!0},$scope.closeZoom=function(){$scope.inZoom=!1,$scope.zoomSrc=null},$scope.goTo=function(newView,isUpload){var topScroll;$scope.view!==newView&&(setSelected(null,null),$scope.isUpload=isUpload,$scope.view=newView,isUpload||(topScroll=$element.find(".q-images-cont"),topScroll.length&&(topScroll[0].scrollTop=0),getLibraryItems(),$scope.firstTimeRenderCheck=!0,topScroll=null))},$scope.isSelectedImg=function(file,last,selector){return last&&$scope.firstTimeRenderCheck&&selector&&setTimeout(function(){var selectedImg=$element.find(selector);$scope.firstTimeRenderCheck=!1,selectedImg.length&&domUtil.scrollElmentIntoView(selectedImg,".q-images-cont",!0),selectedImg=null},250),$scope.selectedFile===file.path},$scope.selectFile=function(evt,file,fileDef){var selectedImg=$(evt.target).closest(".q-media-grid, .qui-menu-item");evt.preventDefault(),evt.stopPropagation(),domUtil.scrollElmentIntoView(selectedImg,".q-images-cont",!1),$scope.selectedFile===file&&(file=null,fileDef=null),selectedImg=null,setSelected(file,fileDef)},$scope.confirm=function(){$scope.selectedFile&&!$scope.updateExp.isUploading&&($scope.input.onConfirm($scope.selectedFile,$scope.selectedFileDef),$scope.destroyComponent())},$scope.canDeleteInView=function(){return $scope.view===$scope.lists[0].qName&&$scope.canUpdate},$scope.onDelete=function(evt){var fileToDelete=$scope.selectedFile;evt.preventDefault(),evt.stopPropagation();var name=$scope.selectedFileDef.split("/").splice(-1)[0];$scope.updateExp.deleteFile(name,$scope.selectedFile).then(function(){updateAfterDelete(fileToDelete)})},$scope.onContextMenu=function(evt){if(evt.preventDefault(),evt.stopPropagation(),$scope.canDeleteInView()){var menu=$qvContextMenu.menu();menu.addItem({translation:"Common.Delete",tid:"delete",select:function(){var entry=$(evt.target).closest(".qui-menu-item").scope().entry,fileToDelete=entry.path;$scope.updateExp.deleteFile(entry.name,entry.path).then(function(){updateAfterDelete(fileToDelete)})}}),$qvContextMenu.show(menu,{position:{x:evt.pageX,y:evt.pageY},docking:"BottomRight"})}},$scope.cancel=function(force){if(!force){if($scope.inZoom)return void $scope.closeZoom();if($scope.updateExp.deleteDialogShown)return void($scope.updateExp.deleteDialogShown=!1)}(force||!$scope.updateExp.isUploading)&&($scope.input.onCancel(inUseFileDeleted),$scope.destroyComponent())},App.get().then(function(app){app.getContentLibraries().then(function(list){$scope.lists=MediaLibrary.filterList(list),!$scope.view&&$scope.lists.length&&($scope.view=$scope.lists[0].qName,getLibraryItems()),$scope.canUpdate=!$scope.$root.isPersonalMode&&!!MediaLibrary.canUpdate})}),$scope.$on("$destroy",function(){state.isShown=!1,$scope.closeZoom()})}]};return{show:show,hide:hide,isShown:isShown}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(mediaLibraryComponent){function show(opts){mediaLibraryComponent.show(opts)}function hide(){mediaLibraryComponent.hide()}function isShown(){return mediaLibraryComponent.isShown()}return{show:show,hide:hide,isShown:isShown}}),define("general.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","general.services/media-tool/theme","general.services/media-tool/text-selection","general.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service"],function($,Touche,template,theme,Selection,linkFoldoutComponent,MediaLibraryService,showService){var palette=theme.palette,fontSizes=theme.fontSizes,foldouts={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},buttons={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0},component={template:template,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout",function($scope,$timeout){$scope.palette=palette,$scope.fontSizes=Object.keys(fontSizes),$scope.foldouts=foldouts,"all"===$scope.options.buttons?($scope.buttons=buttons,$scope.buttonGroup1=!0,$scope.buttonGroup2=!0):"object"==typeof $scope.options.buttons&&($scope.buttons=$scope.options.buttons,$scope.buttonGroup1=$scope.buttons.bold||$scope.buttons.italic||$scope.buttons.underline,$scope.buttonGroup2=$scope.buttons.justifyLeft||$scope.buttons.justifyCenter||$scope.buttons.justifyRight),$scope.exec=function(evt,cmd){evt.preventDefault(),evt.stopPropagation(),Touche.preventGestures(),0===cmd.indexOf("justify")?$scope.textTool.setJustify(cmd):$scope.haveSelection()&&$scope.textTool.setBIU(cmd)},$scope.setActiveFoldout=function(name){Object.keys($scope.foldouts).forEach(function(foldout){foldout===name&&$scope.foldouts[foldout]?$scope.foldouts[foldout]=!1:$scope.foldouts[foldout]=foldout===name})},$scope.shortFontSize=function(size){return fontSizes[size]||size},$scope.openMediaLibrary=function(){$scope.textTool.saveRange(),$scope.setActiveFoldout("mediaLibrary"),MediaLibraryService.show({onCancel:function(){$scope.setActiveFoldout(),$scope.textTool.restoreRange(),$scope.textTool.focus()},onConfirm:function(img,imgDef){$scope.setActiveFoldout(),$timeout(function(){imgDef?$scope.textTool.insertImage(img,imgDef):($scope.textTool.restoreRange(),$scope.textTool.focus())},100)},selectedFile:null})},$scope.closeColorpickerFoldout=function(evt){$(evt.target).closest("#qv-toolbar-colorpicker").length&&Touche.preventGestures(),$scope.setActiveFoldout()},$scope.closeFontsizeFoldout=function(evt){$(evt.target).closest("#qv-toolbar-fontsize").length&&Touche.preventGestures(),$scope.setActiveFoldout()};var linkFoldout=null;$scope.openLinkFoldout=function(){var $node,range=$scope.textTool.currentRange,link={};range&&($node=$(range.commonAncestorContainer).closest("a"),$node.length&&(link.url=$node.attr("href"),link.bookmark=$node.attr("data-bookmark-id"),link.$node=$node),$scope.textTool.saveRange(),linkFoldout=showService.show(linkFoldoutComponent,{options:{toolbarScope:$scope,alignTo:$("#qv-toolbar-link"),link:link,onSave:function(e,url,$node,props){var range;$node?(range=document.createRange(),range.setStartBefore($node[0]),range.setEndAfter($node[0]),$scope.textTool.insertLink(url,range,props)):$scope.textTool.insertLink(url,null,props),$scope.closeLinkFoldout(e)},onCancel:function(e){$scope.closeLinkFoldout(e)},onRemove:function(e,$node){if($node){var range=Selection.createRangeForElement($node[0]);$scope.textTool.removeLink(range)}$scope.closeLinkFoldout(e)}}}),$scope.setActiveFoldout("link"))},$scope.setFontSize=function(evt,size){evt.preventDefault(),$scope.setActiveFoldout(),$scope.textTool.setFontSize(size)},$scope.closeLinkFoldout=function(evt){evt&&$(evt.target).closest("#qv-toolbar-link").length&&Touche.preventGestures(),$scope.setActiveFoldout(),linkFoldout&&(linkFoldout.destroy(),linkFoldout=null)},$scope.linkDisabled=function(){var range=$scope.textTool.currentRange,isLink=!!$scope.textTool.states.link;return!isLink&&(!range||range.collapsed)},$scope.haveSelection=function(){var range=$scope.textTool.currentRange;return!(!range||range.collapsed)},Object.defineProperty($scope,"color",{get:function(){var unselectedColor=10;return $scope.haveSelection()?theme.palette.indexOf($scope.textTool.color):theme.palette[unselectedColor]},set:function(color){$scope.textTool.setColor(theme.palette[color])}}),$scope.exposedApi.closing=function(){linkFoldout&&linkFoldout.closing()},$scope.$on("$destroy",function(){$scope.setActiveFoldout(),linkFoldout&&(linkFoldout.destroy(),linkFoldout=null)}),$timeout(function(){$scope.textTool.refreshState()})}]};return component}),define("general.services/media-tool/command-queue",[],function(){var CommandQueue=function(){this.queue=[]};return CommandQueue.prototype.push=function(item){this.queue.push(item)},CommandQueue.prototype.execAll=function(fn){this.queue.forEach(fn)},CommandQueue.prototype.remove=function(cmd){var i,item,isRemoved=!1;for(i=this.queue.length-1;i>=0;i--)item=this.queue[i],item.cmd===cmd&&(isRemoved=!0,this.queue.splice(i,1));return isRemoved},CommandQueue.prototype.clear=function(){this.queue=[]},CommandQueue}),define("general.utils/string-limits",[],function(){"use strict";var exports={};return Object.defineProperties(exports,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),exports}),define("general.services/media-tool/markdown-html-parser",["util"],function(util){function compileRegex(){var charactersRegexes=Parser.formatters.map(function(formatter){return formatter.character?util.escapeRegExp(formatter.character):""}),prefixGroup="("+charactersRegexes.join("|")+"){1}\\[",suffixGroup="\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)",parseGroup="((?![\\s\\S]*?"+prefixGroup+"[\\s\\S]*?)[\\s\\S]*?)";Parser.markdownRegex=new RegExp(prefixGroup+parseGroup+suffixGroup,"mg")}function execRegex(regex,str,callback){for(var m=regex.exec(str),matched=[];m&&!(matched.indexOf(m.index)>-1);)matched.push(m.index),str=callback(str,m),m=regex.exec(str);return matched.length?execRegex(regex,str,callback):str}function reverse(str){return str.split("").reverse().join("")}function getHTMLFormatters(){var formatters=Parser.formatters.filter(function(formatter){return!!formatter.toHTML});return formatters.sort(function(f1,f2){var p1=f1.toHTML.priority||0,p2=f2.toHTML.priority||0;return p2-p1}),formatters}function getMarkdownFormatters(){var formatters=Parser.formatters.filter(function(formatter){return!!formatter.toMarkdown});return formatters.sort(function(f1,f2){var p1=f1.toMarkdown.priority||0,p2=f2.toMarkdown.priority||0;return p2-p1}),formatters}var Parser={};return Parser.register=function(options){Parser.formatters.push(options),compileRegex()},Parser.toHTML=function(str,char){var formatters=char||getHTMLFormatters(),needLoopAgain=!1;return str=str.replace(/\$\&amp;/g,"&#36;&amp;"),str=execRegex(Parser.markdownRegex,str,function(str,m){return str.replace(m[0],function(){return Parser.getFormatter(m[1]).toHTML.callback(m[2],m[4])})}),formatters.forEach(function(formatter){formatter.toHTML&&formatter.toHTML.regex&&(formatter.toHTML.reverse&&(str=reverse(str)),str=execRegex(formatter.toHTML.regex,str,function(str,m){var matching=m.splice(0,1)[0];return needLoopAgain=!0,str.replace(matching,formatter.toHTML.callback.apply(formatter.toHTML.callback,m))}),formatter.toHTML.reverse&&(str=reverse(str)))}),needLoopAgain?Parser.toHTML(str,char):str},Parser.toMarkdown=function(str,char){var formatters=char||getMarkdownFormatters(),opt=new Option;return opt.innerHTML=str,formatters.forEach(function(formatter){formatter.toMarkdown.tags.forEach(function(tag){var nodes=Array.prototype.slice.call(opt.getElementsByTagName(tag.name)).reverse();nodes.forEach(function(node){var match,hasAttribute=!tag.attr.length||tag.attr.some(function(attr){return node.hasAttribute(attr)}),ignoreAttribute=tag.dontMatchAttr&&tag.dontMatchAttr.some(function(attr){return node.hasAttribute(attr)});if(match=formatter.toMarkdown.regex?hasAttribute&&!ignoreAttribute&&formatter.toMarkdown.regex.exec(node.outerHTML.trim()):[node.outerHTML.trim()],!ignoreAttribute&&hasAttribute&&match){var span=document.createElement("span");span.innerHTML=formatter.toMarkdown.callback.apply(node,match.slice(1)),node.parentNode.replaceChild(span,node)}})})}),opt.innerHTML.replace(/<(\/)?span>/g,"")},Parser.getFormatter=function(char){var i,formatters=Parser.formatters;for(i=0;i<formatters.length;i++)if(formatters[i].character===char)return formatters[i];return null},Parser.escapeMarkdown=function(markdown){return markdown.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-")},Parser.unescapeMarkdown=function(markdown){return markdown.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},Parser.reset=function(){Parser.formatters=[],Parser.markdownRegex=null},Parser.reset(),Parser}),define("general.services/media-tool/formatters/font-color",["sirtrevor","core.utils/theme","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(SirTrevor,theme,Theme,Parser){var palette=theme.palette;return Parser.register({name:"font-color",character:"#",toHTML:{callback:function(text,colorIndex){return'<font color="'+palette[colorIndex]+'">'+text+"</font>"}},toMarkdown:{regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(sizeBefore,color,sizeAfter,text){if(""===text)return"";var size=sizeBefore||sizeAfter;return null!==size&&void 0!==size&&(size=Theme.htmlSizeToMarkdownSize[size],text="%["+text+"]("+size+")"),-1===palette.indexOf(color)?text:"#["+text+"]("+palette.indexOf(color)+")"},tags:[{name:"font",attr:["color"]}]}}),SirTrevor.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(props){document.execCommand(props.cmd,!1,props.param)}})}),define("general.services/media-tool/formatters/font-size",["sirtrevor","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Theme,Parser){return Parser.register({name:"font-size",character:"%",toHTML:{callback:function(text,size){return"<font size='"+Theme.markdownSizeToHtmlSize[size]+"'>"+text+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(size,text){return""===text?"":(size>7&&(size=Theme.fontSizesPx[size]),null!==size&&void 0!==size?(size=Theme.htmlSizeToMarkdownSize[size],"%["+text+"]("+size+")"):text)},tags:[{name:"font",attr:["size"]}]}}),SirTrevor.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("general.services/media-tool/feature-detection",["angular","general.services/media-tool/text-selection"],function(angular,Selection){function testCommand(cmd,val){var activeElem=document.activeElement;return document.body.appendChild(pseudoElem),pseudoElem.innerHTML="Feature detection.",pseudoElem.focus(),Selection.addRange(Selection.createRange(pseudoElem),!0),document.execCommand(cmd,!1,val),document.activeElement=activeElem,document.body.removeChild(pseudoElem),pseudoElem.innerHTML}var pseudoElem=angular.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0],usesAlign=testCommand("justifyCenter").indexOf(" align=")>-1;return{usesAlign:usesAlign}}),define("general.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","general.services/media-tool/markdown-html-parser","general.services/media-tool/feature-detection"],function(SirTrevor,qvangular,encoder,Parser,featureDetection){var usesAlign=featureDetection.usesAlign;Parser.register({name:"justify",character:"^",toHTML:{callback:function(text,align){return text||(text="&nbsp;"),usesAlign?'<div align="'+encoder.encodeForAttr2(align)+'">'+text+"</div>":'<div style="text-align: '+encoder.encodeForAttr2(align)+';">'+text+"</div>"}},toMarkdown:{regex:/^<(?:div|p) (?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified)(?:"|;").*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(align,text){return"^["+text+"]("+align+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var JustifyLeft=SirTrevor.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",onClick:function(){var style=qvangular.getService("qvMediaTool").getParagraph().el.style,oldDir=style.direction;"ltr"!==oldDir&&oldDir||(oldDir="ltr",style.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===oldDir&&(style.direction="ltr")}}),JustifyCenter=SirTrevor.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}}),JustifyRight=SirTrevor.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",toMarkdown:function(html){return Parser.toMarkdown(html)},toHTML:function(markdown){return Parser.toHTML(markdown)},onClick:function(){var style=qvangular.getService("qvMediaTool").getParagraph().el.style,oldDir=style.direction;"rtl"===oldDir&&(style.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===oldDir&&(style.direction="rtl")}});return{Left:JustifyLeft,Right:JustifyRight,Center:JustifyCenter}}),define("general.services/media-tool/formatters/bold",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(text){return">b/<"+text+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(text){return""===text?"":"**"+text+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),SirTrevor.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag(["b","strong"])||opts.hasEndAncestorTag(["b","strong"]):opts.hasStartAncestorTag(["b","strong"])&&opts.hasEndAncestorTag(["b","strong"])},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/italic",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(text){return">i/<"+text+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(text){return""===text?"":"_"+text+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),SirTrevor.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag(["i","em"])||opts.hasEndAncestorTag(["i","em"]):opts.hasStartAncestorTag(["i","em"])&&opts.hasEndAncestorTag(["i","em"])},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/underline",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(text){return">u/<"+text+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(text){return""===text?"":"~"+text+"~"},tags:[{name:"u",attr:[]}]}}),SirTrevor.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("u")||opts.hasEndAncestorTag("u"):opts.hasStartAncestorTag("u")&&opts.hasEndAncestorTag("u")},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","general.services/media-tool/markdown-html-parser"],function($,qvangular,SirTrevor,encoder,Parser){function findAnchor(target,url){var mediaToolService=qvangular.getService("qvMediaTool"),ancestor=mediaToolService.getRange().commonAncestorContainer,elems=$(ancestor).find("a[href="+url+"]");return"#text"===ancestor.nodeName&&(elems="A"!==target.nodeName?$(target).find("a[href="+url+"]"):$(target)),0===elems.length&&(elems=$(ancestor).find("a:not([href])")),elems}return Parser.register({name:"bookmark",character:"$",toHTML:{callback:function(text,id){return'<a href="#" class="bookmark-link" data-bookmark-id="'+encoder.encodeForAttr2(id)+'">'+text+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(id,text){return"$["+text+"]("+id+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),SirTrevor.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("a")||opts.hasEndAncestorTag("a"):opts.hasStartAncestorTag("a")&&opts.hasEndAncestorTag("a")},onClick:function(props){var url=props.url;$(document).on("DOMNodeInserted.bookmark",function(e){var elems=findAnchor(e.target,url);$.each(elems,function(i,elem){$(elem).hasClass("bookmark-link")||(elem.setAttribute("href","#"),elem.removeAttribute("_moz_dirty"),elem.className+="bookmark-link",elem.setAttribute("data-bookmark-id",url))}),setTimeout(function(){$(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand(this.cmd,!1,url)}})}),define("general.services/media-tool/formatters/link",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"link",character:"@",toHTML:{callback:function(text,url){return 0===url.indexOf("javascript:")&&(url=""),0!==url.search("[a-zA-Z0-9]+:")&&(url="http://"+url),url=url.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<a href='"+decodeURI(url)+"' target='\\_blank'>"+text+"</a>"}},toMarkdown:{regex:/^<a href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(url,text){return"@["+text+"]("+url+")"},tags:[{name:"a",attr:["href"]}]}}),SirTrevor.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("a")||opts.hasEndAncestorTag("a"):opts.hasStartAncestorTag("a")&&opts.hasEndAncestorTag("a")},onClick:function(props){var url=props.url;document.execCommand(this.cmd,!1,url)}})}),define("general.services/media-tool/formatters/unlink",["sirtrevor"],function(SirTrevor){return SirTrevor.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(props){var url=props.url;document.execCommand(this.cmd,!1,url)}})}),define("lz-string",[],function(){var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(input){if(null==input)return"";var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=LZString.compress(input);i<2*input.length;)i%2==0?(chr1=input.charCodeAt(i/2)>>8,chr2=255&input.charCodeAt(i/2),chr3=i/2+1<input.length?input.charCodeAt(i/2+1)>>8:NaN):(chr1=255&input.charCodeAt((i-1)/2),(i+1)/2<input.length?(chr2=input.charCodeAt((i+1)/2)>>8,chr3=255&input.charCodeAt((i+1)/2)):chr2=chr3=NaN),i+=3,enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+LZString._keyStr.charAt(enc1)+LZString._keyStr.charAt(enc2)+LZString._keyStr.charAt(enc3)+LZString._keyStr.charAt(enc4);return output},decompressFromBase64:function(input){if(null==input)return"";var output_,chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",ol=0,i=0,f=LZString._f;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=LZString._keyStr.indexOf(input.charAt(i++)),enc2=LZString._keyStr.indexOf(input.charAt(i++)),enc3=LZString._keyStr.indexOf(input.charAt(i++)),enc4=LZString._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,ol%2==0?(output_=chr1<<8,64!=enc3&&(output+=f(output_|chr2)),64!=enc4&&(output_=chr3<<8)):(output+=f(output_|chr1),64!=enc3&&(output_=chr2<<8),64!=enc4&&(output+=f(output_|chr3))),ol+=3;return LZString.decompress(output)},compressToUTF16:function(input){if(null==input)return"";var i,c,current,output="",status=0,f=LZString._f;for(input=LZString.compress(input),i=0;i<input.length;i++)switch(c=input.charCodeAt(i),status++){case 0:output+=f((c>>1)+32),current=(1&c)<<14;break;case 1:output+=f(current+(c>>2)+32),current=(3&c)<<13;break;case 2:output+=f(current+(c>>3)+32),current=(7&c)<<12;break;case 3:output+=f(current+(c>>4)+32),current=(15&c)<<11;break;case 4:output+=f(current+(c>>5)+32),current=(31&c)<<10;break;case 5:output+=f(current+(c>>6)+32),current=(63&c)<<9;break;case 6:output+=f(current+(c>>7)+32),current=(127&c)<<8;break;case 7:output+=f(current+(c>>8)+32),current=(255&c)<<7;break;case 8:output+=f(current+(c>>9)+32),current=(511&c)<<6;break;case 9:output+=f(current+(c>>10)+32),current=(1023&c)<<5;break;case 10:output+=f(current+(c>>11)+32),current=(2047&c)<<4;break;case 11:output+=f(current+(c>>12)+32),current=(4095&c)<<3;break;case 12:output+=f(current+(c>>13)+32),current=(8191&c)<<2;break;case 13:output+=f(current+(c>>14)+32),current=(16383&c)<<1;break;case 14:output+=f(current+(c>>15)+32,(32767&c)+32),status=0}return output+f(current+32)},decompressFromUTF16:function(input){if(null==input)return"";for(var current,c,output="",status=0,i=0,f=LZString._f;i<input.length;){switch(c=input.charCodeAt(i)-32,status++){case 0:current=c<<1;break;case 1:output+=f(current|c>>14),current=(16383&c)<<2;break;case 2:output+=f(current|c>>13),current=(8191&c)<<3;break;case 3:output+=f(current|c>>12),current=(4095&c)<<4;break;case 4:output+=f(current|c>>11),current=(2047&c)<<5;break;case 5:output+=f(current|c>>10),current=(1023&c)<<6;break;case 6:output+=f(current|c>>9),current=(511&c)<<7;break;case 7:output+=f(current|c>>8),current=(255&c)<<8;break;case 8:output+=f(current|c>>7),current=(127&c)<<9;break;case 9:output+=f(current|c>>6),current=(63&c)<<10;break;case 10:output+=f(current|c>>5),current=(31&c)<<11;break;case 11:output+=f(current|c>>4),current=(15&c)<<12;break;case 12:output+=f(current|c>>3),current=(7&c)<<13;break;case 13:output+=f(current|c>>2),current=(3&c)<<14;break;case 14:output+=f(current|c>>1),current=(1&c)<<15;break;case 15:output+=f(current|c),status=0}i++}return LZString.decompress(output)},compress:function(uncompressed){if(null==uncompressed)return"";var i,value,ii,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data_string="",context_data_val=0,context_data_position=0,f=LZString._f;for(ii=0;ii<uncompressed.length;ii+=1)if(context_c=uncompressed.charAt(ii),Object.prototype.hasOwnProperty.call(context_dictionary,context_c)||(context_dictionary[context_c]=context_dictSize++,context_dictionaryToCreate[context_c]=!0),context_wc=context_w+context_c,Object.prototype.hasOwnProperty.call(context_dictionary,context_wc))context_w=context_wc;else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;context_numBits>i;i++)context_data_val<<=1,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;8>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;16>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1;context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),context_dictionary[context_wc]=context_dictSize++,context_w=String(context_c)}if(""!==context_w){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;context_numBits>i;i++)context_data_val<<=1,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;8>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;16>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),
context_data_val=0):context_data_position++,value>>=1;context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++)}for(value=2,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1;for(;;){if(context_data_val<<=1,15==context_data_position){context_data_string+=f(context_data_val);break}context_data_position++}return context_data_string},decompress:function(compressed){if(null==compressed)return"";if(""==compressed)return null;var next,i,w,bits,resb,maxpower,power,c,dictionary=[],enlargeIn=4,dictSize=4,numBits=3,entry="",result="",f=LZString._f,data={string:compressed,val:compressed.charCodeAt(0),position:32768,index:1};for(i=0;3>i;i+=1)dictionary[i]=i;for(bits=0,maxpower=Math.pow(2,2),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(next=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 2:return""}for(dictionary[3]=c,w=result=c;;){if(data.index>data.string.length)return"";for(bits=0,maxpower=Math.pow(2,numBits),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(c=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 2:return result}if(0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++),dictionary[c])entry=dictionary[c];else{if(c!==dictSize)return null;entry=w+w.charAt(0)}result+=entry,dictionary[dictSize++]=w+entry.charAt(0),enlargeIn--,w=entry,0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++)}}};return LZString}),define("general.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","translator","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","general.services/media-tool/markdown-html-parser"],function(qvangular,SirTrevor,util,translator,lzString,arrayUtils,CanvasRenderer,Parser){function getMeasure(layout,id){var i,measureList=layout.qHyperCube.qMeasureInfo;for(i=0;i<measureList.length;++i)if(measureList[i].cId===id)return measureList[i];return null}function getMeasureValue(layout,id){var i,totalRow,measureList=layout.qHyperCube.qMeasureInfo;for(i=0;i<measureList.length;++i)if(measureList[i].cId===id)return totalRow=layout.qHyperCube.qGrandTotalRow[i],!totalRow||"NaN"===totalRow.qNum&&"-"===totalRow.qText?"":totalRow.qText;return""}function createTokenizedMeasure(text){var width,height=30,pixelRatio=CanvasRenderer.getDevicePixelToBackingStoreRatio(),maxWidth=150,iconAlpha=.35,font="13px 'QlikView Sans'",ctx=canvas.getContext("2d"),measuredText=CanvasRenderer.measureTextObject({shape:{text:text,width:112,font:font}});width=Math.ceil(Math.min(measuredText.width+50,maxWidth)),canvas.height=height*pixelRatio,canvas.width=width*pixelRatio,canvas.style.height=height+"px",canvas.style.width=width+"px",ctx.clearRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.scale(pixelRatio,pixelRatio),ctx.font="24px 'QlikView Icons'",ctx.globalAlpha=iconAlpha,ctx.fillText("3",2,height/2+8),ctx.globalAlpha=1,ctx.font="13px 'QlikView Sans'",ctx.fillText(measuredText.lines[0],32,height/2+5),ctx.restore();var dataUrl=canvas.toDataURL("image/png"),img=document.createElement("img");return img.setAttribute("src",dataUrl),img.setAttribute("class","tokenized-measure"),img.setAttribute("width",width+"px"),img.setAttribute("height",height+"px"),img}var canvas=document.createElement("canvas");return Parser.register({name:"measure",character:"=",toHTML:{callback:function(text,measureId){var layout,elem,mediaToolService=qvangular.getService("qvMediaTool");if(mediaToolService.isActive()){var options=mediaToolService.getOptions();if(!options.useMeasures)return"";var name,measureProps=options.propertyHandler.getMeasure(measureId),isInvalid=!1;if(measureProps){var measureLayout=getMeasure(options.layout,measureId);!measureLayout||measureLayout.qError?(isInvalid=!0,name=translator.get("Object.ErrorMessage.MissingMeasure")):name=measureLayout.qFallbackTitle}else name=options.copiedMeasures[measureId];var measureStr=JSON.stringify(measureProps);elem=createTokenizedMeasure(name),elem.setAttribute("data-measure-id",measureId),elem.setAttribute("data-measure-name",lzString.compressToBase64(name)),elem.setAttribute("data-measure",lzString.compressToBase64(measureStr)),elem.setAttribute("data-tid","ti-measure"),isInvalid&&elem.classList.add("invalid-measure")}else{layout=mediaToolService.getCurrentLayout();var measureValue=getMeasureValue(layout,measureId);if(null===measureValue)return"";elem=document.createElement("span"),elem.setAttribute("data-tid","ti-measure"),elem.appendChild(document.createTextNode(measureValue))}return elem.outerHTML}},toMarkdown:{callback:function(){var text="",measureId=this.getAttribute("data\\-measure\\-id"),options=qvangular.getService("qvMediaTool").getOptions();if(!getMeasure(options.layout,measureId)&&!options.copiedMeasures[measureId]){var measureStr=lzString.decompressFromBase64(this.getAttribute("data\\-measure")),measure=JSON.parse(measureStr);measureId=util.generateId(),measure.qDef.cId=measureId;var properties=options.properties;properties.qHyperCubeDef.qMeasures.push(measure),arrayUtils.indexAdded(properties.qHyperCubeDef.qInterColumnSortOrder,properties.qHyperCubeDef.qDimensions.length+properties.qHyperCubeDef.qMeasures.length-1);var measureName=lzString.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));options.copiedMeasures[measureId]=measureName}return"=["+text+"]("+measureId+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),SirTrevor.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/image",["qvangular","sirtrevor","general.services/media-tool/markdown-html-parser","general.models/media-library"],function(qvangular,SirTrevor,Parser,MediaLibraryModel){function findImageUrl(id,images,isLayout){for(var prop=isLayout?"qStaticContentUrl":"qStaticContentUrlDef",i=0;i<images.length;i++)if(images[i].id===id)return images[i].url[prop].qUrl;return""}function escape(str){return str.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24")}return Parser.register({name:"image",character:"!",toHTML:{callback:function(id,imgUrl){var mediaToolService=qvangular.getService("qvMediaTool");if(mediaToolService.useImageArray()){var srcUrl=imgUrl,layout=mediaToolService.getCurrentLayout();imgUrl=findImageUrl(id,layout.images,!0),imgUrl=imgUrl?Parser.escapeMarkdown(imgUrl):srcUrl}return imgUrl=MediaLibraryModel.stripBasePath(imgUrl),imgUrl=escape(imgUrl),imgUrl=MediaLibraryModel.addBasePath(imgUrl),id||(id="image"),id=escape(id),"<img src='"+imgUrl+"' data-image-id='"+id+"'>"}},toMarkdown:{regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(imgUrl){var imgId=this.getAttribute("data\\-image\\-id")||"";return imgId||(imgId=""),imgUrl=Parser.unescapeMarkdown(imgUrl),imgUrl=MediaLibraryModel.stripBasePath(imgUrl),imgUrl=Parser.escapeMarkdown(imgUrl),"!["+imgId+"]("+imgUrl+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),SirTrevor.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(props){document.execCommand(props.cmd,!1,props.param)}})}),define("general.services/media-tool/formatters/paste",["general.services/media-tool/markdown-html-parser","util"],function(Parser,Util){var re_color=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,re_size=/font\\\-size: (\d+)px/i,re_underline=/text\\\-decoration: underline/i,re_bold=/font\\\-weight: bold/i;Parser.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(tag,style,content){var match;return re_color.test(style)&&(style=style.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),content=Parser.getFormatter("#").toMarkdown.callback(null,Util.normalizeToHex(style),null,content)),match=re_size.exec(style),match&&(content=Parser.getFormatter("%").toMarkdown.callback(match[1],content)),match=re_underline.exec(style),match&&(content=Parser.getFormatter("~").toMarkdown.callback(content)),match=re_bold.exec(style),match&&(content=Parser.getFormatter("**").toMarkdown.callback(content)),this.innerHTML=content,this.removeAttribute("style"),Parser.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),Parser.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("general.services/media-tool/sir-trevor-extensions",["jquery","sirtrevor","underscore","general.services/media-tool/text-selection","general.services/media-tool/formatters/font-color","general.services/media-tool/formatters/font-size","general.services/media-tool/formatters/justify","general.services/media-tool/formatters/bold","general.services/media-tool/formatters/italic","general.services/media-tool/formatters/underline","general.services/media-tool/formatters/bookmark","general.services/media-tool/formatters/link","general.services/media-tool/formatters/unlink","general.services/media-tool/formatters/measure","general.services/media-tool/formatters/image","general.utils/string-limits","general.services/media-tool/formatters/paste"],function($,SirTrevor,_,Selection,FontColor,FontSize,Justify,Bold,Italic,Underline,Bookmark,Link,Unlink,Measure,MediaImage,StringLimits){function findTextNodes(elem){for(var nodes=[],i=0;i<elem.childNodes.length;i++)3===elem.childNodes[i].nodeType?nodes.push(elem.childNodes[i]):nodes.push.apply(nodes,findTextNodes(elem.childNodes[i]));return nodes}function capMaxLength(){var elem=this,overflow=elem.textContent.length-StringLimits.textImage;if(overflow>0){var range=Selection.getRange(),node=range.commonAncestorContainer;if(3===node.nodeType){var nodes=findTextNodes(document.activeElement),idx=nodes.indexOf(node);nodes=nodes.splice(0,idx+1),nodes.reverse().forEach(function(node){return 0>=overflow?!1:(node.nodeValue.length>overflow?(node.splitText(node.nodeValue.length-overflow),node.parentNode.removeChild(node.nextSibling),Selection.addRange(range,!0)):node.parentNode.removeChild(node),void(overflow-=node.nodeValue.length))})}}}delete SirTrevor.Formatters.Bold,delete SirTrevor.Formatters.Italic,delete SirTrevor.Formatters.Link,delete SirTrevor.Formatters.Unlink,SirTrevor.Formatters.bold=new Bold,SirTrevor.Formatters.italic=new Italic,SirTrevor.Formatters.underline=new Underline,SirTrevor.Formatters.justifyLeft=new Justify.Left,SirTrevor.Formatters.justifyCenter=new Justify.Center,SirTrevor.Formatters.justifyRight=new Justify.Right,SirTrevor.Formatters.fontSize=new FontSize,SirTrevor.Formatters.foreColor=new FontColor,SirTrevor.Formatters.bookmark=new Bookmark,SirTrevor.Formatters.link=new Link,SirTrevor.Formatters.unlink=new Unlink,SirTrevor.Formatters.measure=new Measure,SirTrevor.Formatters.insertImage=new MediaImage,SirTrevor.Blocks.Paragraph=function(){return SirTrevor.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return _.extend(SirTrevor.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(data){this.getTextBlock().html(SirTrevor.toHTML(data.text,this.type))},focus:function(){var contentEditableElement=this.getTextBlock();contentEditableElement.focus()},_initTextBlocks:function(){var block=this.getTextBlock();block.bind("input",capMaxLength).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){SirTrevor.log("toData for "+this.blockID);var block=this.getTextBlock();block.find("div,p").each(function(){var $this=$(this);$this.is("[align],[style]")||$this.attr("align","left")});var content=block.html();this.setData({text:SirTrevor.toMarkdown(content,this.type)})}})}(),SirTrevor.FloatingBlockControls=function(){return SirTrevor.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}})}(),SirTrevor.BlockControls=function(){return SirTrevor.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}})}(),SirTrevor.FormatBar=function(){return SirTrevor.FormatBar.extend({className:"",initialize:function(){}})}()}),define("general.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","general.services/media-tool/theme","general.services/media-tool/toolbar","general.services/media-tool/command-queue","general.services/media-tool/text-selection","general.utils/string-limits","general.models/media-library","general.services/show-service/show-service","general.utils/support","./sir-trevor-extensions"],function($,_,util,DOMUtil,qvangular,SirTrevor,template,theme,toolbarComponent,CommandQueue,Selection,StringLimits,MediaLibraryModel,showService,support){var textToolComponent,$sce=qvangular.getService("$sce"),states={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return textToolComponent={controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function showToolbar(){hideToolbar(),toolbar=showService.show(toolbarComponent,{textTool:$scope,options:$scope.options.toolbar||{},alignTo:$scope.options.alignTo||$element})}function hideToolbar(){toolbar&&($scope.editor.formatBar.$el.remove(),toolbar.destroy(),toolbar=null)}function buildActiveArgs(){function isEditorElement(element){return $scope.getEditorElement()===element}function hasAncestorTag(tags,ancestors){return Array.isArray(tags)?tags.some(function(tag){return hasAncestorTag(tag,ancestors)}):ancestors.some(function(ancestor){return ancestor.nodeName.toLowerCase()===tags})}var startAncestors=DOMUtil.getAncestorsUntil($scope.currentRange.startContainer,isEditorElement),endAncestors=DOMUtil.getAncestorsUntil($scope.currentRange.endContainer,isEditorElement);return{rangeCollapsed:$scope.currentRange.collapsed,hasStartAncestorTag:function(tags){return hasAncestorTag(tags,startAncestors)},hasEndAncestorTag:function(tags){return hasAncestorTag(tags,endAncestors)}}}function bindEvents(element){function setEditorState(refresh){$scope.saveRange(),$scope.cmdQueue.clear(),refresh&&$scope.refreshState()}var isTouch=!support.treatAsDesktop();$("body").on("mouseup.texttool",function(e){var target=$(e.target);target.closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered").length?DOMUtil.isInput(document.activeElement)||($scope.focus(),$scope.restoreRange()):isTouch||document.activeElement===$scope.getEditorElement()[0]&&$timeout(function(){setEditorState(!0),$scope.$apply()})}),isTouch&&$(document).on("selectionchange.texttool",function(){if(document.activeElement===$scope.getEditorElement()[0]){var newRange=Selection.getRange();newRange&&!Selection.rangeEquals(newRange,$scope.currentRange)&&setEditorState(!0)}}),element.on("qv-activate","img",function(e){var range=Selection.createRangeForElement(e.target);$scope.focus(),Selection.addRange(range,!0),$scope.saveRange(),$scope.refreshState()}),element.on("scroll",function(){$scope.saveScroll()}),element.on("keydown input",function(event){13!==event.which&&($scope.cmdQueue.execAll(function(item){$scope.execCustom(item)}),$scope.cmdQueue.clear()),$timeout(function(){$scope.$apply()})}),isTouch||element.on("keyup",function(){setEditorState(!0)})}var html=$sce.getTrustedHtml(SirTrevor.toHTML($scope.options.markdown));$scope.data={data:[{type:"paragraph",data:{text:SirTrevor.toMarkdown(html)}}]},$scope.states=states,$scope.cmdQueue=new CommandQueue;var toolbar;this.scope=function(){return $scope},this.closing=function(){toolbar&&(toolbar.closing(),toolbar.destroy())},$scope.getParagraph=function(){return $scope.editor.blocks[0]},$scope.getEditorElement=function(){return $scope.getParagraph().getTextBlock()},$scope.destroy=function(){hideToolbar(),$scope.destroyComponent()},$scope.calculateUsage=function(){var editorElement=$scope.getEditorElement()[0];$scope.usage=Math.min(100,(editorElement.textContent.length/StringLimits.textImage*100).toFixed(0)),$scope.showUsage=$scope.usage>=90},$scope.refreshState=function(){$scope.currentRange&&qvangular.$apply($scope,function(){$scope.calculateUsage();var args=buildActiveArgs();Object.keys($scope.states).forEach(function(state){$scope.states[state]=SirTrevor.Formatters[state].isActive(args)});var color;$scope.currentRange&&(color=document.queryCommandValue("foreColor"),"undefined"!=typeof color&&(color=util.normalizeToHex(color))),$scope.color=color||"#545352";var fontSize,element;$scope.currentRange&&(element=DOMUtil.getParentElementWithAttribute($scope.currentRange.endContainer,"font","size"),element&&(fontSize=element.getAttribute("size"),fontSize=theme.htmlSizeToMarkdownSize[fontSize],fontSize=theme.markdownSizeToHtmlSize[fontSize]),"undefined"===fontSize&&(fontSize=null)),$scope.fontSize=fontSize||3})},$scope.saveRange=function(){var range=Selection.getRange();range?$scope.currentRange=range.cloneRange():$scope.currentRange=null},$scope.restoreRange=function(){if($scope.currentRange){var range=Selection.getRange();range?range&&(Selection.rangeEquals(range,$scope.currentRange)||Selection.addRange($scope.currentRange,!0)):Selection.addRange($scope.currentRange,!0)}},$scope.saveScroll=function(){$scope.currentScrollTop=$scope.getEditorElement()[0].scrollTop},$scope.restoreScroll=function(){$scope.currentScrollTop&&($scope.getEditorElement()[0].scrollTop=$scope.currentScrollTop)},$scope.setJustify=function(cmd){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.execCustom({cmd:cmd}),$scope.saveRange(),$scope.refreshState()},$scope.setBIU=function(cmd){if($scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.states[cmd]=!$scope.states[cmd],$scope.currentRange.collapsed){var hasRemovedCmd=$scope.cmdQueue.remove(cmd);hasRemovedCmd||$scope.cmdQueue.push({cmd:cmd})}else $scope.execCustom({cmd:cmd});$scope.saveRange()},$scope.setFontSize=function(size){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.currentRange.collapsed?($scope.cmdQueue.remove("fontSize"),$scope.cmdQueue.push({param:size,cmd:"fontSize"})):$scope.execCustom({param:size,cmd:"fontSize"}),$scope.saveRange(),$scope.fontSize=size},$scope.setColor=function(color){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.currentRange.collapsed?($scope.cmdQueue.remove("foreColor"),$scope.cmdQueue.push({param:color,cmd:"foreColor"})):$scope.execCustom({param:color,cmd:"foreColor"}),$scope.saveRange(),$scope.color=color},$scope.insertImage=function(img,imgDef){img=MediaLibraryModel.addBasePath(img),imgDef=MediaLibraryModel.addBasePath(imgDef),$scope.focus(),$scope.restoreRange(),$scope.execCustom({param:img,cmd:"insertImage"}),$scope.options.insertedImages.push({url:img,urlDef:imgDef}),$scope.saveRange(),$scope.focus()},$scope.insertLink=function(url,range,props){range?Selection.addRange(range,!0):$scope.restoreRange(),$scope.focus(),$scope.execCustom({url:url,cmd:props.cmd,formatter:props.formatter}),$scope.saveRange(),$scope.refreshState()},$scope.removeLink=function(range){Selection.addRange(range,!0),$scope.execCustom({cmd:"unlink",range:range}),$scope.saveRange(),$scope.refreshState(),$scope.focus()},$scope.execCustom=function(props){var format=SirTrevor.Formatters[props.formatter||props.cmd];_.isUndefined(format)||(!_.isUndefined(format.onClick)&&_.isFunction(format.onClick)?format.onClick(props):document.execCommand(props.cmd,!1,props.param))},$scope.focus=function(){$scope.getEditorElement().focus()},$timeout(function(){$scope.editor=new SirTrevor.Editor({el:$element.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var textBlock=$element.find(".st-text-block");bindEvents(textBlock),"function"==typeof $scope.options.onOpen&&$scope.options.onOpen($scope),$scope.options.toolbar&&showToolbar(),$timeout(function(){$scope.refreshState()})}})}),$scope.$on("$destroy",function(){hideToolbar(),$("body").off(".texttool"),$(document).off(".texttool")})}],template:template}}),define("general.services/media-tool/media-tool-service",["qvangular","sirtrevor","general.services/media-tool/media-tool"],function(qvangular,SirTrevor,textToolComponent){var $sce=qvangular.getService("$sce"),mediaToolService=qvangular.service("qvMediaTool",[function(){var editorComponent,currentLayout,useImageArray,opts,service={};return service.show=function(element,options){opts=options,editorComponent=element.showComponent(textToolComponent,{options:options})},service.hide=function(){editorComponent&&(editorComponent.scope().destroy(),editorComponent=null,opts=null)},service.closing=function(){editorComponent&&editorComponent.closing()},service.isActive=function(){return opts&&"function"==typeof opts.isActive?opts.isActive():!!editorComponent},service.getCurrentLayout=function(){return currentLayout},service.useImageArray=function(){return useImageArray},service.getOptions=function(){return opts||{}},service.getMarkdown=function(){var paragraphData,paragraph=editorComponent.scope().getParagraph();return paragraph&&(paragraphData=paragraph.saveAndGetData())?paragraphData.text:null},service.hasContent=function(markdown){return markdown&&"^[\n](left)"!==markdown},service.getParagraph=function(){return editorComponent.scope().getParagraph()},service.getEditorElement=function(){return editorComponent.scope().getEditorElement()},service.getRange=function(){return editorComponent.scope().currentRange},service.toHTML=function(markdown,layout,shouldUseImageArray){if(currentLayout=layout,useImageArray=shouldUseImageArray,markdown){var html=SirTrevor.toHTML(markdown);return markdown=SirTrevor.toMarkdown(html),$sce.getTrustedHtml(SirTrevor.toHTML(markdown))}return""},service.toMarkdown=function(html){return html?SirTrevor.toMarkdown(html):""},service}]);return mediaToolService}),define("core.utils/help-url",["core.utils/external-urls"],function(externalUrls){function adaptUrl(){var part=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("/workbench/")>-1?part="workbench":location.pathname.toLowerCase().indexOf("/dev-hub/")>-1?part="dev-hub":"qmc"!==part.toLowerCase()&&(part="client"),baseUrl+=part+"/"}var HelpUrl={},baseUrl=externalUrls.serverHelpBaseUrl;return HelpUrl.setBaseUrl=function(isPersonalMode){baseUrl=isPersonalMode?externalUrls.personalHelpBaseUrl:externalUrls.serverHelpBaseUrl,adaptUrl()},Object.defineProperty(HelpUrl,"path",{get:function(){return baseUrl}}),adaptUrl(),HelpUrl}),define("extensions.qliktech/map/map-properties",["general.utils/property-resolver","general.services/media-tool/media-tool-service","translator","core.utils/help-url"],function(propertyResolver,mediaToolService,translator,HelpUrl){function showGeoComponent(dimension){if(!dimension||dimension.qLibraryId)return!1;var field=dimension.qDef.qFieldDefs[0];return field&&field.length&&"="===field[0]}function legendReadOnly(data){var auto=propertyResolver.getValue(data,"color.auto"),mode=propertyResolver.getValue(data,"color.mode"),expressionIsColor=propertyResolver.getValue(data,"color.expressionIsColor");return auto||"primary"===mode||"byExpression"===mode&&(expressionIsColor||void 0===expressionIsColor)}function isExpressionValue(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!1}function isExpressionColor(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!0}var MAX_NUM_LAYERS=1,colorModes1=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],colorModes2=colorModes1.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),colorModes3=colorModes2.concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),data={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"layers",allowMove:!0,max:MAX_NUM_LAYERS,items:{polygonLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{ref:"qListObjectDef.qDef.qFieldDefs.0",type:"string",translation:"Common.Field",component:"expression",expressionType:"dimension",show:function(layer){var dim=layer.qListObjectDef;return dim&&!dim.qLibraryId},readOnly:!0},libraryDimension:{ref:"qListObjectDef.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(layer){var dim=layer.qListObjectDef;return dim&&dim.qLibraryId}},geodata:{ref:"qListObjectDef.qExpressions.1.qExpr",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(layer){return layer&&showGeoComponent(layer.qListObjectDef)}}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qListObjectDef.qExpressions.0.qExpr",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(layer,handler,data,args){var expr=layer.qListObjectDef.qExpressions[0].qExpr;if(expr=expr.trim(),""===expr)"byMeasure"===propertyResolver.getValue(data,"color.mode")&&(propertyResolver.setValue(data,"color.mode","primary"),propertyResolver.getValue(data,"color.auto")===!1&&propertyResolver.setValue(data,"color.auto",!0));else{var layerIdx=data.layers.indexOf(layer),layerLayout=args.layout.layers[layerIdx],lastExpr=layerLayout.qListObject.qExpressions&&layerLayout.qListObject.qExpressions[0]?layerLayout.qListObject.qExpressions[0].qExpr:"";lastExpr=void 0!==lastExpr?lastExpr.trim():"",data.color.auto&&"primary"===data.color.mode&&""===lastExpr&&(data.color.auto=!1,data.color.mode="byMeasure")}},show:function(layer){return!propertyResolver.getValue(layer,"qListObjectDef.qExpressions.0.qLibraryId")}},libraryMeasure:{ref:"qListObjectDef.qExpressions.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(layer){return propertyResolver.getValue(layer,"qListObjectDef.qExpressions.0.qLibraryId")}},label:{ref:"qListObjectDef.qExpressions.0.qLabel",type:"string",translation:"Common.Label",show:function(layer){return!propertyResolver.getValue(layer,"qListObjectDef.qExpressions.0.qLibraryId")}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",defaultValue:!0,show:function(layer,handler,args){return propertyResolver.getValue(args.properties,"background.show",!1)}}}}}},polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",translation:"Common.Field",show:function(layer){var dim=layer.qHyperCubeDef.qDimensions[0];return!dim||!dim.qLibraryId},readOnly:!0},libraryDimension:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",translation:"Common.Dimension",show:function(layer){var dim=layer.qHyperCubeDef.qDimensions[0];return dim&&dim.qLibraryId}},geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(layer){return layer&&layer.qHyperCubeDef&&layer.qHyperCubeDef.qDimensions&&showGeoComponent(layer.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,change:function(itemData){var b=propertyResolver.getValue(itemData,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");propertyResolver.setValue(itemData,"qHyperCubeDef.qDimensions.0.qNullSuppression",b)}},showExcluded:{type:"boolean",ref:"showExcluded",defaultValue:!0,translation:"properties.dimensions.showExcluded"}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(layer,handler,data){var meas=layer.qHyperCubeDef.qMeasures[0],layerIdx=data.layers.indexOf(layer);if(meas&&""===meas.qDef.qDef)("byMeasure"===propertyResolver.getValue(data,"color.mode")||"byExpression"===propertyResolver.getValue(data,"color.mode"))&&(propertyResolver.setValue(data,"color.mode","primary"),propertyResolver.getValue(data,"color.auto")===!1&&propertyResolver.setValue(data,"color.auto",!0));else{meas.qSortBy={qSortByLoadOrder:1};var lastMeasureDef=data.layers[layerIdx].measureDef;lastMeasureDef=void 0!==lastMeasureDef?lastMeasureDef.trim():"",data.color.auto&&"primary"===data.color.mode&&""===lastMeasureDef&&(data.color.auto=!1,data.color.mode="byMeasure")}data.layers[layerIdx].measureDef=layer.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!meas||!meas.qLibraryId}},libraryMeasure:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",translation:"Common.Measure",show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&meas.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!meas||!meas.qLibraryId}},suppressZero:{type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!!meas}}}},appearance:{type:"items",
items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(layer,handler,args){return propertyResolver.getValue(args.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(layer){var dim=layer.qHyperCubeDef.qDimensions[0];return!dim||!dim.qLibraryId},readOnly:!0},libraryDimension:{ref:"qHyperCubeDef.qDimensions.0.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(layer){var dim=layer.qHyperCubeDef.qDimensions[0];return dim&&dim.qLibraryId}},geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(layer){var def=layer.qHyperCubeDef.qDimensions[1].qDef;def.qFieldLabels||(def.qFieldLabels=[]),def.qFieldLabels[0]=def.qFieldDefs[0]},show:function(layer){return layer&&layer.qHyperCubeDef&&layer.qHyperCubeDef.qDimensions&&showGeoComponent(layer.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(layer,handler,data,args){var meas=layer.qHyperCubeDef.qMeasures[0];if(meas&&""===meas.qDef.qDef)layer.qHyperCubeDef.qMeasures.length=0,2===layer.qHyperCubeDef.qInterColumnSortOrder[0]&&layer.qHyperCubeDef.qInterColumnSortOrder.splice(0,1),("byMeasure"===propertyResolver.getValue(data,"color.mode")||"byExpression"===propertyResolver.getValue(data,"color.mode"))&&(propertyResolver.setValue(data,"color.mode","primary"),propertyResolver.getValue(data,"color.auto")===!1&&propertyResolver.setValue(data,"color.auto",!0));else{meas.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==layer.qHyperCubeDef.qInterColumnSortOrder[0]&&layer.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2);var layerIdx=data.layers.indexOf(layer),layerLayout=args.layout.layers[layerIdx],lastNumMeasures=layerLayout.qHyperCube.qMeasureInfo?layerLayout.qHyperCube.qMeasureInfo.length:0;data.color.auto&&"primary"===data.color.mode&&0===lastNumMeasures&&(data.color.auto=!1,data.color.mode="byMeasure")}},show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!meas||!meas.qLibraryId}},libraryMeasure:{ref:"qHyperCubeDef.qMeasures.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&meas.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!meas||!meas.qLibraryId}},suppressZero:{type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!!meas}},useSize:{ref:"useSize",type:"boolean",translation:"properties.map.useSize",defaultValue:!0,show:function(layer){return layer.qHyperCubeDef.qMeasures[0]}},bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return!(meas&&layer.useSize)}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&layer.useSize}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&layer.useSize}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&layer.useSize&&layer.autoMinMax===!1},invalid:function(layer){return"minMax"===propertyResolver.getValue(layer,"minMax")?propertyResolver.getValue(layer,"customMin")>=propertyResolver.getValue(layer,"customMax"):!1}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(layer){var meas=layer.qHyperCubeDef.qMeasures[0];return meas&&layer.useSize&&layer.autoMinMax===!1},invalid:function(layer){return"minMax"===propertyResolver.getValue(layer,"minMax")?propertyResolver.getValue(layer,"customMin")>=propertyResolver.getValue(layer,"customMax"):!1}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(layer,handler,args){return propertyResolver.getValue(args.properties,"background.show",!1)}}}}}}}},background={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(properties){properties.layers.length&&!properties.background.show&&(properties.layers[0].show=!0),properties.background&&properties.background.show&&void 0===properties.background.defaultMapService&&propertyResolver.setValue(properties,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(data){return propertyResolver.getValue(data,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{type:"items",items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,resolveFunctions:{get:function(getter,definition){var markdown=getter(definition.type);return mediaToolService.toHTML(markdown)},set:function(value,setter,definition){var markdown=mediaToolService.toMarkdown(value);setter(definition.type,markdown)}}},helpLink:{component:"link",url:function(){return HelpUrl.path+"#"+translator.language+"|map.htm"},translation:"properties.background.help"}},show:function(data){var defaultMapService=propertyResolver.getValue(data,"background.defaultMapService");return!defaultMapService}}}}}},settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(data){return data&&data.layers&&data.layers[0]&&"point"===data.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(data,handler){var meas=handler.getMeasures(),numMeas=meas?meas.length:0,layerTypeAndVersion=handler.getLayerTypeAndVersion();switch(layerTypeAndVersion[0]){case"point":return numMeas>0?colorModes3:colorModes1;case"polygon":return"2"===layerTypeAndVersion[1]||"3"===layerTypeAndVersion[1]?numMeas>0?colorModes3:colorModes1:numMeas>0?colorModes2:colorModes1}return colorModes1}},persistentColors:{show:function(data){return!(propertyResolver.getValue(data,"color.auto")||"byDimension"!==propertyResolver.getValue(data,"color.mode")||"point"===data.layers[0].type||"polygon"===data.layers[0].type&&"2"===data.layers[0].version)}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.type="colorByExpression",colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},globalChange:function(data){var i,index,currentAttribs,measures=propertyResolver.getValue(data,"layers.0.qHyperCubeDef.qMeasures",[]),disabledMeasures=propertyResolver.getValue(data,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),colorByAttrib=null,elTypeFunc=function(element,j){"colorByExpression"===element.type&&(index=j)};if(measures.length+disabledMeasures.length>1){for(i=disabledMeasures.length-1;i>=0;--i)currentAttribs=disabledMeasures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);for(i=measures.length-1;i>=0;--i)currentAttribs=measures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);!measures[0].qAttributeExpressions&&colorByAttrib&&(measures[0].qAttributeExpressions=[]),colorByAttrib&&measures[0].qAttributeExpressions.splice(0,0,colorByAttrib)}var exps=propertyResolver.getValue(data,"color.colorExpression");1!==measures.length||measures[0].qAttributeExpressions&&0!==measures[0].qAttributeExpressions.length||!exps||(measures[0].qAttributeExpressions=[{qExpression:exps,type:"colorByExpression"}])},show:function(data,handler){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&handler.getMeasures().length>0}},expressionIsColor:{show:function(data,handler){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&handler.getMeasures().length>0}},expressionLabel:{change:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.label=propertyResolver.getValue(itemData,"color.expressionLabel"),colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},show:function(data,handler){return!propertyResolver.getValue(data,"color.auto")&&isExpressionValue(data)&&handler.getMeasures().length>0}}}},legend:{items:{show:{show:function(data){return!legendReadOnly(data)}},showTitle:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&!legendReadOnly(data)&&!isExpressionColor(data)}},dock:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&!legendReadOnly(data)}}}}}}}},addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{items:{expr:{ref:"calcCond",expressionType:"measure",change:function(properties,handler){handler.rippleToHyperCubes("qCalcCond",properties.calcCond)}},customErrorMessage:{ref:"customErrorMessage.calcCond",show:function(data){return""!==propertyResolver.getValue(data,"calcCond")},change:function(properties,handler){handler.rippleToHyperCubes("customErrorMessage.calcCond",properties.customErrorMessage.calcCond)}}}},suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:data,background:background,addons:addons,settings:settings}}}),define("extensions.qliktech/map/projection/unit-projection",["core.utils/class"],function(Class){var UnitProjection;return UnitProjection=Class.extend("UnitProjection",{init:function(){},getProjectionType:function(){return"Unit"},project:function(p){return p},invProject:function(p){return p}})}),define("extensions.qliktech/map/projection/mercator-projection",["core.utils/class","objects.utils/shapes/point"],function(Class,Point){var MercatorProjection,pi=Math.PI,halfPI=pi/2,quarterPI=pi/4,deg2rad=pi/180,max=Math.max,min=Math.min,clipping=85.0511287798059*deg2rad,rad2deg=180/pi;return MercatorProjection=Class.extend("MercatorProjection",{init:function(){},getProjectionType:function(){return"Mercator"},project:function(p){if(p){var lat=max(min(p.y*deg2rad,clipping),-clipping),lng=p.x*deg2rad,lng_0=0,x=lng-lng_0,y=Math.log(Math.tan(quarterPI+lat/2));return x*=rad2deg,y*=rad2deg,new Point(x,y)}},invProject:function(p){if(p){var x=p.x*deg2rad,y=p.y*deg2rad,lng_0=0,lng=x+lng_0,lat=2*Math.atan(Math.pow(Math.E,y))-halfPI;return lng*=rad2deg,lat*=rad2deg,new Point(lng,lat)}}})}),define("extensions.qliktech/map/projection/viewport-projection",["objects.views/charts/events/event-launcher","objects.utils/shapes/point","objects.utils/shapes/rect","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/projection/mercator-projection","objects.views/charts/utils/matrix"],function(EventLauncher,Point,Rect,UnitProjection,MercatorProjection,Matrix){function translateS2MapCenterToZeroPoint(p){return this._originalS2CenterIsZeroPoint?p:new Point(p.x-this._originalS2Center.x,p.y-this._originalS2Center.y)}function invTranslateS2MapCenterToZeroPoint(p){return this._originalS2CenterIsZeroPoint?p:new Point(p.x+this._originalS2Center.x,p.y+this._originalS2Center.y)}function scaleS2MapToZoomLevel(p,level){var scale=Math.pow(2,level+8)/this._S2Size;return new Point(p.x*scale,p.y*scale)}function invScaleS2MapToZoomLevel(p,level){var scale=Math.pow(2,level+8)/this._S2Size;return new Point(p.x/scale,p.y/scale)}function calculateSuportingData(){if(this._projection&&this._S2BoundingBox){var scale,originalCenter,newCenter,dx,dy;(!this._currentS2MapCenter||this._projectionChanged||this._currentS1MapCenterChanged)&&(this._currentS2MapCenter=void 0===this._currentS1MapCenter?this._originalS2Center:this._projection.project(this._currentS1MapCenter)),this._transformMatrixForZoomLevel.identity(),this._transformMatrixForZoomLevel.translate(this._viewportSize.x/2,this._viewportSize.y/2),this._transformMatrixForZoomLevel.scale(1,-1),scale=Math.pow(2,this._zoomLevel+8)/this._S2Size,this._transformMatrixForZoomLevel.scale(scale,scale),this._transformMatrixForZoomLevel.translate(-this._originalS2Center.x,-this._originalS2Center.y),originalCenter=this._transformMatrixForZoomLevel.transformPoint(this._originalS2Center),newCenter=this._transformMatrixForZoomLevel.transformPoint(this._currentS2MapCenter),dx=originalCenter.x-newCenter.x,dy=originalCenter.y-newCenter.y,this._transformMatrix.identity(),this._transformMatrix.translate(dx,dy),this._transformMatrix.multiply(this._transformMatrixForZoomLevel.elements),this._invTransformMatrix=this._transformMatrix.clone(),this._invTransformMatrix.invert(),this._projectionChanged=!1,this._currentS1MapCenterChanged=!1,this.enabledChangeEvent&&this.fire("changed")}}function updateS2BoundingBox(){var p1,p2,q1,q2,x,y;p1={x:this._S1BoundingBox.x,y:this._S1BoundingBox.y},p2={x:this._S1BoundingBox.x+this._S1BoundingBox.width,y:this._S1BoundingBox.y+this._S1BoundingBox.height},q1=this._projection.project(p1),q2=this._projection.project(p2),x=Math.min(q1.x,q2.x),y=Math.min(q1.y,q2.y),this._S2BoundingBox=new Rect(x,y,Math.abs(q2.x-q1.x),Math.abs(q2.y-q1.y)),this._S2Size=Math.max(this._S2BoundingBox.width,this._S2BoundingBox.height),this._originalS2Center=this._S2BoundingBox.getCenterPoint(),this._originalS2CenterIsZeroPoint=0===this._originalS2Center.x&&0===this._originalS2Center.y}var ViewportProjection,maxZoomLevel=19,instances=0,epsilon=1e-9,topLeftPoint=new Point(0,0),log2=Math.log(2);return ViewportProjection=EventLauncher.extend("ViewportProjection",{init:function(){this._super(),instances++,this._fractionalZoomMode=!0,this._viewportSize=new Point(256,256),this._zoomLevel=0,this._maxZoomLevel=maxZoomLevel,this._minZoomLevel=0,this._translation=new Point(0,0),this._unitProjection=new UnitProjection,this._mercatorProjection=new MercatorProjection,this._projection=this._unitProjection,this._originalS2Center=new Point(0,0),this._S1BoundingBox=new Rect(-180,-180,360,360),updateS2BoundingBox.call(this),this._originalS2CenterIsZeroPoint=!0,this._transformMatrixForZoomLevel=new Matrix,this._transformMatrix=new Matrix,this._invTransformMatrix=new Matrix,this.enabledChangeEvent=!0},setProjection:function(projection){return this._projection&&projection&&this._projection.getProjectionType()===projection.getProjectionType()?!1:(this._projection=projection,this._projection||(this._projection=this._unitProjection),updateS2BoundingBox.call(this),this._projectionChanged=!0,calculateSuportingData.call(this),!0)},getProjection:function(){return this._projection},getUnitProjection:function(){return this._unitProjection},getMercatorProjection:function(){return this._mercatorProjection},setS1BoundingBox:function(rect){this._S1BoundingBox&&this._S1BoundingBox.equal&&this._S1BoundingBox.equal(rect)||(this._S1BoundingBox=new Rect(rect.x,rect.y,rect.width,rect.height),updateS2BoundingBox.call(this),calculateSuportingData.call(this))},getS1BoundingBox:function(){return this._S1BoundingBox},setSize:function(s){return this._viewportSize&&this._viewportSize.equal&&this._viewportSize.equal(s)?!1:(this._viewportSize=new Point(s.x,s.y),calculateSuportingData.call(this),!0)},getSize:function(){return this._viewportSize},setZoomLevel:function(z){return isNaN(z)?!1:(this._fractionalZoomMode||(z=Math.round(z)),z=Math.max(Math.min(z,this._maxZoomLevel),this._minZoomLevel),Math.abs(this._zoomLevel-z)<.001?!1:(this._zoomLevel=z,calculateSuportingData.call(this),!0))},getZoomLevel:function(){return this._zoomLevel},setMapCenter:function(c){return c?this._currentS1MapCenter&&this._currentS1MapCenter.closeTo&&this._currentS1MapCenter.closeTo(c,epsilon)?!1:(this._currentS1MapCenterChanged=!0,this._currentS1MapCenter=new Point(c.x,c.y),calculateSuportingData.call(this),!0):!1},getMapCenter:function(){return this._currentS1MapCenter},setMapCenterInLonLat:function(c){if(!c)return!1;var p1,p2;return p1=this._mercatorProjection.project(c),p2=this._projection.invProject(p1),this.setMapCenter(p2)},getMapCenterInLonLat:function(){var p1,p2;return p1=this._projection.project(this._currentS1MapCenter),p2=this._mercatorProjection.invProject(p1)},setFractionalZoomMode:function(b){this._fractionalZoomMode=b},getFractionalZoomMode:function(){return this._fractionalZoomMode},project:function(p){var p1,p2;return p1=this._projection.project(p),p2=this.transform(p1)},fromMapRectToViewportRect:function(rect){var p1,p2,rect2;return p1=this.project(new Point(rect.x,rect.y)),p2=this.project(new Point(rect.x+rect.width,rect.y+rect.height)),rect2=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)},invProject:function(p){var p1,p2;return p1=this.invTransform(p),p2=this._projection.invProject(p1)},fromViewportRectToMapRect:function(rect){var p1,p2,rect2;return p1=this.invProject(new Point(rect.x,rect.y)),p2=this.invProject(new Point(rect.x+rect.width,rect.y+rect.height)),rect2=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)},getMapRectOfViewport:function(){var p1,p2,rect;return p1=this.invProject(topLeftPoint),p2=this.invProject(this._viewportSize),rect=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)},getMapRectOfViewportIfZoomOnAMapRect:function(rect){var b=this.enabledChangeEvent;this.enabledChangeEvent=!1;var z=this.getZoomLevel(),c=this.getMapCenter();this.zoomOnMapRectangle(rect);var mapRect=this.getMapRectOfViewport();return this.setZoomLevel(z),this.setMapCenter(c),this.enabledChangeEvent=b,mapRect},fromLonLatToViewport:function(p){var p1,p2;return p1=this._mercatorProjection.project(p),p2=this.transform(p1)},fromLonLatRectToViewportRect:function(rect){var p1,p2,rect2;return p1=this.fromLonLatToViewport(new Point(rect.x,rect.y)),p2=this.fromLonLatToViewport(new Point(rect.x+rect.width,rect.y+rect.height)),rect2=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)},fromViewportToLonLat:function(p){var p1,p2;return p1=this.invTransform(p),p2=this._mercatorProjection.invProject(p1)},fromViewportRectToLonLatRect:function(rect){var p1,p2,rect2;return p1=this.fromViewportToLonLat(new Point(rect.x,rect.y)),p2=this.fromViewportToLonLat(new Point(rect.x+rect.width,rect.y+rect.height)),rect2=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)},transform:function(p){var p1=this._transformMatrix.transformPoint(p);return new Point(p1.x,p1.y)},invTransform:function(p){var p1=this._invTransformMatrix.transformPoint(p);return new Point(p1.x,p1.y)},fromMapPointToPixel:function(p,zoomLevel){var p1,p2,p3,p4,halfS3MapSizeAtZoomLevel=Math.pow(2,zoomLevel+7);return p1=this._projection.project(p),p2=translateS2MapCenterToZeroPoint.call(this,p1),p3=scaleS2MapToZoomLevel.apply(this,[p2,zoomLevel]),p4=new Point(p3.x+halfS3MapSizeAtZoomLevel,halfS3MapSizeAtZoomLevel-p3.y)},fromPixelToMapPoint:function(p,zoomLevel){var p1,p2,p3,p4,halfS3MapSizeAtZoomLevel=Math.pow(2,zoomLevel+7);return p4=new Point(p.x-halfS3MapSizeAtZoomLevel,halfS3MapSizeAtZoomLevel-p.y),p3=invScaleS2MapToZoomLevel.apply(this,[p4,zoomLevel]),p2=invTranslateS2MapCenterToZeroPoint.call(this,p3),p1=this._projection.invProject(p2)},fromLonLatToPixel:function(p,zoomLevel){var p1,p2,p3,p4,halfS3MapSizeAtZoomLevel=Math.pow(2,zoomLevel+7);return p1=this._mercatorProjection.project(p),p2=translateS2MapCenterToZeroPoint.call(this,p1),p3=scaleS2MapToZoomLevel.apply(this,[p2,zoomLevel]),p4=new Point(p3.x+halfS3MapSizeAtZoomLevel,halfS3MapSizeAtZoomLevel-p3.y)},fromPixelToLonLat:function(p,zoomLevel){var p1,p2,p3,p4,halfS3MapSizeAtZoomLevel=Math.pow(2,zoomLevel+7);return p4=new Point(p.x-halfS3MapSizeAtZoomLevel,halfS3MapSizeAtZoomLevel-p.y),p3=invScaleS2MapToZoomLevel.apply(this,[p4,zoomLevel]),p2=invTranslateS2MapCenterToZeroPoint.call(this,p3),p1=this._mercatorProjection.invProject(p2)},calculateZoomLevelForMapRectangle:function(rect){if(rect){var p1,p2,q1,q2,w,h,s1,s2,s,z;return p1=new Point(rect.x,rect.y),p2=new Point(rect.x+rect.width,rect.y+rect.height),q1=this.fromMapPointToPixel(p1,0),q2=this.fromMapPointToPixel(p2,0),w=Math.abs(q1.x-q2.x),h=Math.abs(q1.y-q2.y),s1=0===w?Number.MAX_VALUE:this._viewportSize.x/w,s2=0===h?Number.MAX_VALUE:this._viewportSize.y/h,s=Math.min(s1,s2),s===Number.MAX_VALUE?20:z=Math.log(s)/Math.LN2}},calculateCenterPointForMapRectangle:function(rect){if(rect){var p1,p2,q1,q2,c1,c2;return p1=new Point(rect.x,rect.y),p2=new Point(rect.x+rect.width,rect.y+rect.height),q1=this.fromMapPointToPixel(p1,0),q2=this.fromMapPointToPixel(p2,0),c1=new Point((q1.x+q2.x)/2,(q1.y+q2.y)/2),c2=this.fromPixelToMapPoint(c1,0)}},moveViewport:function(dx,dy){this.setMapCenter(this.invProject(new Point(this._viewportSize.x/2-dx,this._viewportSize.y/2-dy)))},zoom:function(scale){scale>0&&this.setZoomLevel(this.getZoomLevel()+Math.log(scale)/Math.LN2)},zoomOnPixel:function(p,scale){if(scale>0){var q,p2,dz;q=this.invTransform(p),dz=Math.log(scale)/Math.LN2,this.setZoomLevel(this.getZoomLevel()+dz),p2=this.transform(q),this.moveViewport(p.x-p2.x,p.y-p2.y)}},zoomOnMapRectangle:function(rect,rounding){if(rect){var z,c;z=this.calculateZoomLevelForMapRectangle(rect),this._fractionalZoomMode||(z=rounding?Math.round(z):Math.floor(z)),this.setZoomLevel(z),c=this.calculateCenterPointForMapRectangle(rect),this.setMapCenter(c)}},setMaxZoomLevel:function(z){this._maxZoomLevel=z},setMinZoomLevel:function(z){this._minZoomLevel=z},getViewRectangleInLonLat:function(){var p1,p2;return p1=this.fromViewportToLonLat(topLeftPoint),p2=this.fromViewportToLonLat(this._viewportSize),new Rect(Math.min(p1.x,p2.x),Math.min(p1.y,p2.y),Math.abs(p1.x-p2.x),Math.abs(p1.y-p2.y))},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(mt){var scale,z,c;this._invTransformMatrix=mt.clone().invert(),scale=Math.abs(mt.elements[0][0]),z=Math.log(scale*this._S2Size)/log2-8,c=this.invProject(new Point(this._viewportSize.x/2,this._viewportSize.y/2)),this.setZoomLevel(z),this.setMapCenter(c)},getInvTransformMatrix:function(){return this._invTransformMatrix}})}),define("extensions.qliktech/map/map-layer",["objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer"],function(ChartComponent,CanvasRenderer){"use strict";function onViewportProjectionChanged(){this._viewportProjectionChanged=!0,this._shouldPaintOnDataChanged||this.invalidateDisplay("onViewportProjectionChanged")}function onViewportProjectionChangedByInteraction(){this._viewportProjectionChanged=!0,this.paint()}function setOpacity(){void 0!==this._layerData.opacity&&(this.container.style.opacity=this._layerData.opacity,this.container.style.filter="alpha(opacity="+100*this._layerData.opacity+")")}function clearToggledOnCacheItems(){this._toggledOnCacheItems.forEach(function(cacheItem){cacheItem.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function select(dimensions){var self=this,selectedRows=this._toggledOnCacheItems.map(function(cacheItem){return cacheItem.row});this.updateBackendApi(),this.backendApi.select2("SelectHyperCubeCells",this._layerPath,selectedRows,dimensions).then(function(result){self._selectionFailed=!result.qSuccess,self._selectionFailed&&clearToggledOnCacheItems.call(self)})}var MapLayer;return MapLayer=ChartComponent.extend("MapLayer",{init:function(){this._super.apply(this,arguments),this._viewportProjectionChanged=!1,this._data=void 0,this._layerData=void 0,this._qData=void 0,this._qMatrix=void 0,this._qSelectionInfo=void 0,this._numItems=0,this._layoutMode=void 0,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=void 0,this._layerS2Bounds=void 0,this._cacheItems=null,this._renderer=new CanvasRenderer(this.container),this._firstAutoZoomed=!1,this._numPoints=0,this._toggledOnCacheItems=[],this._selectedRows=[]},setData:function(data,layerData){var visible;this._skipInvalidateOnGlobalOpacityChange=!0,this._data=data,this._layerData=layerData,this._toggledOnCacheItems=[],this._selectedRows=[],visible=this._layerData?this._layerData.show:!1,visible?this.showComponent():this.hideComponent(),this._qSelectionInfo=this._data?this._data.qSelectionInfo:void 0,setOpacity.call(this)},getData:function(){return this._data},getLayerData:function(){return this._layerData},setLayerIndex:function(idx){this._layerIndex=idx},getLayerIndex:function(){return this._layerIndex},setLayerType:function(t){this._layerType=t},getLayerType:function(){return this._layerType},setVersion:function(v){this._version=v},getVersion:function(){return this._version},setFirstAutoZoomed:function(b){this._firstAutoZoomed=b},getFirstAutoZoomed:function(){return this._firstAutoZoomed},getLayerPath:function(){return this._layerPath},getNumPoints:function(){return this._numPoints},getLayerBounds:function(){return this._layerS2Bounds},setViewportProjection:function(viewportProjection){this._viewportProjection!==viewportProjection&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",onViewportProjectionChanged,this),this._viewportProjection.stopListen("changedByInteraction",onViewportProjectionChangedByInteraction,this)),this._viewportProjection=viewportProjection,this._viewportProjection&&(this._viewportProjection.listen("changed",onViewportProjectionChanged,this),this._viewportProjection.listen("changedByInteraction",onViewportProjectionChangedByInteraction,this)))},setBackendApi:function(backendApi){this.backendApi=backendApi},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},getLayerOutputData:function(){return this._layerData?this._layerData.qHyperCube?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:this._layerData.qHyperCube}:this._layerData.qListObject?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qListObject:this._layerData.qListObject}:void 0:void 0},getMeasureInfo:function(){return this._layerData?this._layerData.qHyperCube?this._layerData.qHyperCube.qMeasureInfo:this._layerData.qListObject?this._layerData.qListObject.qMeasureInfo:void 0:void 0},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(cacheItem){return cacheItem.row}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},setGlobalOpacity:function(x,skipInvalidation){var self=this;this._skipInvalidateOnGlobalOpacityChange=!1,this._globalAlpha=x,skipInvalidation||setTimeout(function(){self._skipInvalidateOnGlobalOpacityChange||(clearToggledOnCacheItems.call(self),self.invalidateDisplay("MapLayer.setGlobalOpacity"),self._skipInvalidateOnGlobalOpacityChange=!0)},100)},setPreselectionMode:function(b){this._preselectionMode=b},toggleShapes:function(cacheItems){var i,j,cacheItem,n=cacheItems?cacheItems.length:0;if(this.isVisible()&&0!==n)for(this._skipInvalidateOnGlobalOpacityChange=!0,i=0;n>i;i++)cacheItem=cacheItems[i],(-3===cacheItem.id||cacheItem.id>=0)&&(cacheItem.selected&&this._toggledOnCacheItems.indexOf(cacheItem)<0?(this._toggledOnCacheItems[this._toggledOnCacheItems.length]=cacheItem,this._toggleOnCacheItemsChanged=!0):cacheItem.selected||(j=this._toggledOnCacheItems.indexOf(cacheItem),j>=0&&(this._toggledOnCacheItems.splice(j,1),this._toggleOnCacheItemsChanged=!0)))},selectOnLayer:function(cacheItems,dimensions){this.isVisible()&&(this._toggledOnCacheItems.length?select.call(this,dimensions):cacheItems&&cacheItems.length&&cacheItems.every(function(item){return!item.selected})&&this.clearSelections())},clearSelections:function(){this.updateBackendApi(),this.backendApi.clearSelections()},updateBackendApi:function(){this.backendApi&&this.backendApi.path!==this._layerPath&&(this.backendApi.path=this._layerPath,this.backendApi.path&&(this.backendApi.dataPath=this.backendApi.path.slice(1,-3)))},afterPaint:function(){},clear:function(){this._renderer&&this._renderer.shapes&&this._renderer.shapes.length&&(this._renderer.shapes=[],this._renderer.render(),this.afterPaint())},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var r in this.renderers)this.renderers[r].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[r].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},release:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this._viewportProjection=null,this.backendApi=null}})}),define("extensions.qliktech/map/geo-region",["objects.utils/shapes/rect","objects.utils/shapes/geometry-math"],function(Rect,GeometryMath){"use strict";function GeoRegion(data,id){var numGeoPolygons=data?data.length:0,geopolygons=[];return this._id=id,0===numGeoPolygons?void this.setGeoPolygons(geopolygons):void this.setGeoPolygons(data)}return GeoRegion.prototype={setId:function(id){this._id=id},getId:function(){return this._id},setGeoPolygons:function(geopolygons){
this.geopolygons!==geopolygons&&(this.geopolygons=geopolygons,this._numGeoPolygons=this.geopolygons?this.geopolygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validateGeoPolygons:function(){var i;for(i=0;i<this._numGeoPolygons;i++)this.geopolygons[i].validatePolygons()},getGeoPolygons:function(){return this.geopolygons},getNumGeoPolygons:function(){return this._numGeoPolygons},getNumPoints:function(){if(this._numPointsNeedToUpdate){var i,numPoints=0;for(i=0;i<this._numGeoPolygons;i++)numPoints+=this.geopolygons[i].getNumPoints();this._numPoints=numPoints,this._numPointsNeedToUpdate=!1}return this._numPoints},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var i;for(i=0;i<this._numGeoPolygons;i++)this.geopolygons[i]&&(this.points=this.points.concat(this.geopolygons[i].getPoints()))}return this.points},pointInside:function(x,y){if(this.calculateBounds(),void 0===this._bounds||x<=this._bounds.x||x>=this._bounds.x+this._bounds.width||y<=this._bounds.y||y>=this._bounds.y+this._bounds.height)return!1;var i;for(i=0;i<this._numGeoPolygons;i++)if(this.geopolygons[i].pointInside(x,y))return!0;return!1},intersectsLine:function(line){if(!line)return!1;var i;for(i=0;i<this._numGeoPolygons;i++)if(this.geopolygons[i].intersectsLine(line))return!0;return!1},intersectsRect:function(rect){if(!rect)return!1;var i;for(i=0;i<this._numGeoPolygons;i++)if(this.geopolygons[i].intersectsRect(rect))return!0;return!1},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numGeoPolygons)return null;var bb=GeometryMath.calculateBounds(this.geopolygons);this._bounds=new Rect(bb.x,bb.y,bb.width,bb.height)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var i,s="";for(i=0;i<this._numGeoPolygons-1;i++)s+=this.geopolygons[i].toString()+";";return s+=this.geopolygons[this._numGeoPolygons-1].toString()}},GeoRegion}),define("extensions.qliktech/map/geo-regions-data",["core.utils/class","objects.utils/shapes/point","objects.utils/shapes/rect","objects.utils/shapes/geometry-math","extensions.qliktech/map/projection/unit-projection"],function(Class,Point,Rect,GeometryMath,UnitProjection){function updateProjectedGeoRegions(){var i,j,k,l,geopolygons,numGeoPolygons,polygons,numPolygons,points,numPoints;for(this._projectedGeoRegions&&this._projectedGeoRegions.length===this._numGeoRegions||(this._projectedGeoRegions=new Array(this._numGeoRegions)),i=0;i<this._numGeoRegions;i++)for(geopolygons=this._geoRegions[i].getGeoPolygons(),numGeoPolygons=geopolygons?geopolygons.length:0,this._projectedGeoRegions[i]&&this._projectedGeoRegions[i].length===numGeoPolygons||(this._projectedGeoRegions[i]=new Array(numGeoPolygons)),j=0;numGeoPolygons>j;j++)for(polygons=geopolygons[j].getPolygons(),numPolygons=polygons?polygons.length:0,this._projectedGeoRegions[i][j]&&this._projectedGeoRegions[i][j].length===numPolygons||(this._projectedGeoRegions[i][j]=new Array(numPolygons)),k=0;numPolygons>k;k++)for(points=polygons[k].points,numPoints=points?points.length:0,this._projectedGeoRegions[i][j][k]&&this._projectedGeoRegions[i][j][k].length===numPoints||(this._projectedGeoRegions[i][j][k]=new Array(numPoints)),l=0;numPoints>l;l++)this._projectedGeoRegions[i][j][k][l]=this._projection.project(points[l])}function updateRegionIdToRegionIndexMapping(){var i;for(this._regionIdToRegionIndexMapping={},i=0;i<this._numGeoRegions;i++)this._regionIdToRegionIndexMapping[this._geoRegions[i].getId()]=i}var GeoRegionsData;return GeoRegionsData=Class.extend("GeoRegionsData",{init:function(){this._numGeoRegions=0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0,this._projectedGeoRegionsNeedToUpdate=!1,this._projection=new UnitProjection,this._numPointsNeedToUpdate=!0},getNumGeoRegions:function(){return this._numGeoRegions},getNumPoints:function(){if(this._numPointsNeedToUpdate){var i,numPoints=0;for(i=0;i<this._numGeoRegions;i++)numPoints+=this._geoRegions[i].getNumPoints();this._numPoints=numPoints,this._numPointsNeedToUpdate=!1}return this._numPoints},setGeoRegions:function(geoRegions){this._geoRegions=geoRegions,this._numGeoRegions=this._geoRegions?this._geoRegions.length:0,this._projectedGeoRegionsNeedToUpdate=!0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0},getGeoRegions:function(){return this._geoRegions},getGeoRegionById:function(regionId){this._regionIdToRegionIndexMappingNeedToUpdate&&(updateRegionIdToRegionIndexMapping.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1);var idx=this._regionIdToRegionIndexMapping[regionId];return this._geoRegions[idx]},setProjection:function(projection){this._projection&&projection&&this._projection.getProjectionType()===projection.getProjectionType()||(this._projection=projection,this._projectedGeoRegionsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0)},getProjection:function(){return this._projection},getProjectedGeoRegions:function(){return this._projectedGeoRegionsNeedToUpdate&&this._projection&&(updateProjectedGeoRegions.call(this),this._projectedGeoRegionsNeedToUpdate=!1),this._projectedGeoRegions},getProjectedGeoRegionById:function(regionId){this._regionIdToRegionIndexMappingNeedToUpdate&&(updateRegionIdToRegionIndexMapping.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1),this._projectedGeoRegionsNeedToUpdate&&this._projection&&(updateProjectedGeoRegions.call(this),this._projectedGeoRegionsNeedToUpdate=!1);var idx=this._regionIdToRegionIndexMapping[regionId];return this._projectedGeoRegions[idx]},calculateBounds:function(){if(this._mapBoundsNeedToUpdate){this._mapBoundsNeedToUpdate=!1;var bb=GeometryMath.calculateBounds(this._geoRegions);bb?this._mapBounds=new Rect(bb.x,bb.y,bb.width,bb.height):this._mapBounds=null}return this._mapBounds},calculateProjectedBounds:function(){if(this._projectedMapBoundsNeedToUpdate){this._projectedMapBoundsNeedToUpdate=!1;var p1,p2,bb=this.calculateBounds();bb?(p1=this._projection.project(new Point(bb.x,bb.y)),p2=this._projection.project(new Point(bb.x+bb.width,bb.y+bb.height)),this._projectedMapBounds=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)):this._projectedMapBounds=null}return this._projectedMapBounds},calculateBoundsOfRegionIds:function(regionIds){var i,bb,bounds,numRegions=regionIds?regionIds.length:0,geoRegions=new Array(numRegions);for(i=0;numRegions>i;i++)geoRegions[i]=this.getGeoRegionById(regionIds[i]);return bb=GeometryMath.calculateBounds(geoRegions),bounds=bb?new Rect(bb.x,bb.y,bb.width,bb.height):null},calculateProjectedBoundsOfRegionIds:function(regionIds){var p1,p2,projectedBounds,bb=this.calculateBoundsOfRegionIds(regionIds);return bb?(p1=this._projection.project(new Point(bb.x,bb.y)),p2=this._projection.project(new Point(bb.x+bb.width,bb.y+bb.height)),projectedBounds=new Rect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y)):projectedBounds=null,projectedBounds}})}),define("extensions.qliktech/map/geo-polygon",["objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","objects.utils/shapes/point","objects.utils/shapes/geometry-math"],function(Polygon,Rect,Line,Point,GeometryMath){"use strict";function convertXYsToPoints(xys){var i,len=xys?xys.length:0,len05=Math.floor(len/2),points=new Array(len05);for(i=0;len05>i;i++)points[i]=new Point(xys[2*i],xys[2*i+1]);return points}function findW180Edge(points,numPoints){var i,numEdges=numPoints-1;if(0===numPoints)return-1;for(i=0;numEdges>i;)if(points[i].x+180<epsilon){if(points[i+1].x+180<epsilon)return i;i+=2}else i++;return-1}function is180Edge(points,numPoints,idx){var p1,p2;return p1=points[idx],p2=points[idx+1],180-Math.abs(p1.x)<epsilon&&180-Math.abs(p2.x)<epsilon?!0:!1}function getEdgeIndex(numEdges,idx){return 0>idx?idx+numEdges:idx>=numEdges?idx-numEdges:idx}function doesW180EdgeNeedToAdjust(points,numPoints,idx){var numEdges=numPoints-1;if(is180Edge(points,numPoints,getEdgeIndex(numEdges,idx+2))){if(0===idx){if(points[numPoints-2].x>=0)return!0}else if(idx===numPoints-2){if(points[numPoints-3].x>=0)return!0}else if(points[idx-1].x>=0)return!0}else if(is180Edge(points,numPoints,getEdgeIndex(numEdges,idx-2))){if(0===idx){if(points[2].x>=0)return!0}else if(idx===numPoints-2){if(points[1].x>=0)return!0}else if(points[idx+2].x>=0)return!0}else if(0===idx){if(points[numPoints-2].x>=0&&points[2].x>=0)return!0}else if(idx===numPoints-2){if(points[numPoints-3].x>=0&&points[1].x>=0)return!0}else if(points[idx-1].x>=0&&points[idx+2].x>=0)return!0;return!1}function adjustW180Edge(points,numPoints,idx){0===idx?(points[idx].x=180,points[idx+1].x=180,points[numPoints-1].x=180):idx===numPoints-2?(points[idx].x=180,points[idx+1].x=180,points[0].x=180):(points[idx].x=180,points[idx+1].x=180)}function validatePolygon(polygon){var idx,points=polygon?polygon.points:null,numPoints=points?points.length:0;idx=findW180Edge(points,numPoints),0>idx||doesW180EdgeNeedToAdjust(points,numPoints,idx)&&adjustW180Edge(points,numPoints,idx)}function validatePolygons(polygons){var i,numPolygons=polygons?polygons.length:0;for(i=0;numPolygons>i;i++)validatePolygon(polygons[i])}function GeoPolygon(data){var i,numPolygons=data?data.length:0,polygons=[];if(0===numPolygons)return void this.setPolygons(polygons);if(data[0].getPoints)this.setPolygons(data);else{for(i=0;numPolygons>i;i++)data[i]&&data[i].length&&polygons.push(new Polygon(convertXYsToPoints(data[i])));this.setPolygons(polygons)}}var epsilon=1e-5;return GeoPolygon.prototype={setPolygons:function(polygons){this.polygons!==polygons&&(this.polygons=polygons,this._numPolygons=this.polygons?this.polygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validatePolygons:function(){validatePolygons(this.polygons)},getPolygons:function(){return this.polygons},getNumPolygons:function(){return this._numPolygons},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var i;for(i=0;i<this._numPolygons;i++)this.polygons[i]&&(this.points=this.points.concat(this.polygons[i].getPoints()))}return this.points},getNumPoints:function(){if(this._numPointsNeedToUpdate){var i,numPoints=0;for(i=0;i<this._numPolygons;i++)numPoints+=this.polygons[i].getNumPoints();this._numPoints=numPoints,this._numPointsNeedToUpdate=!1}return this._numPoints},pointInside:function(x,y){if(this.calculateBounds(),void 0===this._bounds||x<=this._bounds.x||x>=this._bounds.x+this._bounds.width||y<=this._bounds.y||y>=this._bounds.y+this._bounds.height)return!1;var i,numInnerPolygons,numOuterPolygons;if(0===this._numPolygons)return!1;if(this.polygons[0].pointInside(x,y)){for(numInnerPolygons=this._innerPolygons?this._innerPolygons.length:0,i=0;numInnerPolygons>i;i++)if(this.polygons[this._innerPolygons[i]].pointInside(x,y))return!1;return!0}for(numOuterPolygons=this._outerPolygons?this._outerPolygons.length:0,i=0;numOuterPolygons>i;i++)if(this.polygons[this._outerPolygons[i]].pointInside(x,y))return!0;return!1},intersectsLine:function(line){if(!line)return!1;if(this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2))return!0;var i;for(i=0;i<this._numPolygons;i++)if(this.polygons[i].intersectsLine(line))return!0;return!1},intersectsLines:function(lines){var i,numLines=lines?lines.length:0;for(i=0;numLines>i;i++)if(this.intersectsLine(lines[i]))return!0;return!1},intersectsRect:function(rect){if(!rect)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(rect.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(rect))return!1;var x1,x2,y1,y2,lines;return x1=rect.x,x2=rect.getRight(),y1=rect.y,y2=rect.getBottom(),this.pointInside(x1,y1)||this.pointInside(x2,y1)||this.pointInside(x2,y2)||this.pointInside(x1,y2)?!0:(lines=[new Line(x1,y1,x2,y1),new Line(x1,y2,x2,y2),new Line(x1,y1,x1,y2),new Line(x2,y1,x2,y2)],this.intersectsLines(lines))},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numPolygons)return null;var b0,b,i,bb=GeometryMath.calculateBounds(this.polygons);for(this._bounds=new Rect(bb.x,bb.y,bb.width,bb.height),b0=this.polygons[0].calculateBounds(),this._innerPolygons=[],this._outerPolygons=[],i=1;i<this._numPolygons;i++)b=this.polygons[i].calculateBounds(),b0.rectInside(b)&&this.polygons[0].pointInside(this.polygons[i].points[0].x,this.polygons[i].points[0].y)?this._innerPolygons.push(i):this._outerPolygons.push(i)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var i,s="";for(i=0;i<this._numPolygons-1;i++)s+=this.polygons[i].toString()+";";return s+=this.polygons[this._numPolygons-1].toString()}},GeoPolygon}),define("extensions.qliktech/map/map-polygon-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon","core.utils/deferred"],function(MapLayer,CacheItem,Color,Point,Polygon,GeoRegion,GeoRegionsData,GeoPolygon,Deferred){"use strict";function isDimensionChanged(){return this._dimensionTitle!==this._qData.qDimensionInfo.qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo.qFallbackTitle,!0):!1}function isGeometryMeasureChanged(){var num=this._qData.qExpressions.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._qData.qExpressions[num-1])?(this._geometryMeasureInfo=this._qData.qExpressions[num-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function createPolygon(points){var i,numPoints=points?points.length:0;for(i=0;numPoints>i;i++)points[i]=new Point(points[i][0],points[i][1]);return new Polygon(points)}function createGeoPolygon(coordinatesOfGeoPolygon){var i,numPolygons=coordinatesOfGeoPolygon?coordinatesOfGeoPolygon.length:0,polygons=new Array(numPolygons);for(i=0;numPolygons>i;i++)polygons[i]=createPolygon(coordinatesOfGeoPolygon[i]);return new GeoPolygon(polygons)}function createGeoRegion(regionId,coordinatesOfRegion){var i,geoRegion,geopolygons="-"===coordinatesOfRegion?[]:JSON.parse(coordinatesOfRegion),numGeoPolygons=geopolygons.length;for(i=0;numGeoPolygons>i;i++)geopolygons[i]=createGeoPolygon(geopolygons[i]);return geoRegion=new GeoRegion(geopolygons,regionId)}function setRawGeoRegions(rawGeoRegions){this._rawGeoRegions=rawGeoRegions,this._geoRegionsData.setGeoRegions(rawGeoRegions),"$mercator"!==this._qExpressions[1].projection&&this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._layerS2Bounds=this._geoRegionsData.calculateProjectedBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function getGeometryDataFromEngine(){var self=this,layerIndex=this._layerIndex,dfd=Deferred(),h=Math.min(this._qData.qSize.qcy||MaxNumberOfPolygons,MaxNumberOfPolygons);return this._loadingGeometryData=!0,this.backendApi.getData("GetListObjectData","/layers/"+layerIndex+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:h}]).then(function(pages){if(!self.backendApi||!self._viewportProjection)return void dfd.resolve();self._loadingGeometryData=!1,self._rawGeoRegions={};var i,regionCoordinates,rawGeoRegions,regionId,numRegions,numPoints=0,qDataPages=pages?pages.qDataPages:void 0,qMatrix=qDataPages?qDataPages instanceof Array&&qDataPages[0]?qDataPages[0].qMatrix:qDataPages.qMatrix:void 0;if(!qMatrix||0===qMatrix.length)return void dfd.resolve();for(self._geometryDimensionIdx=2,numRegions=qMatrix?qMatrix.length:0,rawGeoRegions=new Array(numRegions),i=0;numRegions>i;i++)regionId=qMatrix[i][0].qText,regionCoordinates=qMatrix[i][self._geometryDimensionIdx].qText,rawGeoRegions[i]=createGeoRegion(regionId,regionCoordinates),rawGeoRegions[i].validateGeoPolygons(),numPoints+=rawGeoRegions[i].getNumPoints();setRawGeoRegions.call(self,rawGeoRegions),self._dataChanged=!0,self.fire("dataChanged"),self._numPoints!==numPoints&&(self._numPoints=numPoints,self.fire("numPointsChanged",[self])),Deferred.all([self.invalidateProperties("MapPolygonLayer.setGeoRegionsData"),self.invalidateDisplay("MapPolygonLayer.setGeoRegionsData")]).then(function(){dfd.resolve()})}),dfd.promise}function createMeasureInfo(qListObject){var measureInfo,i,qRow,qState,selected,val,qExpressions=qListObject.qExpressions,qDimensionInfo=qListObject.qDimensionInfo,qMatrix=qListObject.qDataPages[0]?qListObject.qDataPages[0].qMatrix:void 0,numItems=qMatrix?qMatrix.length:0,max=-Number.MAX_VALUE,min=Number.MAX_VALUE;if(!this._hasMeasure)return void(qListObject.qMeasureInfo=[]);for(measureInfo={qFallbackTitle:void 0===qExpressions[0].qLabel?qExpressions[0].qExpr:qExpressions[0].qLabel},i=0;numItems>i;i++)qRow=qMatrix[i],qState=qRow[0].qState,selected="S"===qState||"O"===qState||"L"===qState,selected?(val=qRow[1].qNum,val>max&&(max=val),min>val&&(min=val)):qRow[1].qNum=NaN;measureInfo.qMax=max===-Number.MAX_VALUE?NaN:max,measureInfo.qMin=min===Number.MAX_VALUE?NaN:min,measureInfo.qNumFormat=qDimensionInfo.qNumFormat,measureInfo.qIsAutoFormat=qDimensionInfo.qIsAutoFormat,qListObject.qMeasureInfo=[measureInfo]}function projectToViewport(geopolygons,geoRegion){var geopolygon,numPolygons,polygon,points,numPoints,i,j,k,transformedPolygons,numGeoPolygons=geopolygons?geopolygons.length:0,transformedGeoPolygons=new Array(numGeoPolygons);for(i=0;numGeoPolygons>i;i++){for(geopolygon=geopolygons[i],numPolygons=geopolygon?geopolygon.length:0,transformedPolygons=new Array(numPolygons),j=0;numPolygons>j;j++){for(polygon=geopolygon[j],numPoints=polygon?polygon.length:0,points=new Array(numPoints),k=0;numPoints>k;k++)points[k]=this._viewportProjection.project(polygon[k]);transformedPolygons[j]=new Polygon(points)}transformedGeoPolygons[i]=new GeoPolygon(transformedPolygons)}geoRegion.setGeoPolygons(transformedGeoPolygons)}function clearToggledOnCacheItems(){this._toggledOnCacheItems.forEach(function(cacheItem){cacheItem.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function select(){var self=this,selectedRows=this.getSelectedRows();this.updateBackendApi(),this.backendApi.select("SelectListObjectValues",this._layerPath,selectedRows,!1).then(function(result){self._selectionFailed=!result.qSuccess,self._selectionFailed&&clearToggledOnCacheItems.call(self)})}var MapPolygonLayer,MaxNumberOfPolygons=3333,defaultFillColor="#ddd",defaultFillColorObject=new Color(defaultFillColor),defaultStrokeColor="#333",selectedStrokeColor="#333";return MapPolygonLayer=MapLayer.extend("MapPolygonLayer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new GeoRegionsData,this.renderers={polygonlayer:this._renderer}},setLayerIndex:function(idx){this._layerIndex=idx,this._layerPath="/layers/"+this._layerIndex+"/qListObjectDef"},getDataType:function(){return"listObject"},setData:function(data,layerData){return this._super(data,layerData),this._qData=this._layerData?this._layerData.qListObject:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qExpressions=this._qData?this._qData.qExpressions:void 0,this._hasMeasure=this._qExpressions&&this._qExpressions[0]&&this._qExpressions[0].qExpr?!0:!1,createMeasureInfo.call(this,this._qData),this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this.show&&this._qExpressions&&this._qExpressions[1]&&this._qExpressions[1].qExpr&&(isDimensionChanged.call(this)||isGeometryMeasureChanged.call(this))?getGeometryDataFromEngine.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygonLayer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(cacheItem){return cacheItem.id}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},selectOnLayer:function(cacheItems){if(this.isVisible()){var row,item,qState,selected;if(this._singleSelectedItemClicked=!1,this._toggledOnCacheItems.length){if(1===this._toggledOnCacheItems.length&&1===this._numSelectedItems&&0===this._numSelectedExcludedItems&&this._selectedCacheItem===this._toggledOnCacheItems[0])return void(this._singleSelectedItemClicked=!0);select.call(this)}else{if(cacheItems&&1===cacheItems.length&&!cacheItems[0].selected&&(row=cacheItems[0].row,item=this._qMatrix[row],qState=item[0].qState,selected="S"===qState||"L"===qState))return;cacheItems&&cacheItems.length&&cacheItems.every(function(item){return!item.selected})&&this.clearSelections()}}},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||0===this._qExpressions.length||""===this._qExpressions[1].qExpr||void 0===this._qExpressions[1].qExpr||null===this._qExpressions[1].qExpr)return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numItems){var i,qRow,qDimCell,qState,regionId,node,shapeWrapper,shape,projectedGeoPolygons,cacheItem,lastSelectionState,selected,value,color,qMatrix=this._qMatrix,measureIndex=this._hasMeasure?0:-1,nonselectedShapes=[],selectedShapes=[],numNonSelectedShapes=0,numSelectedShapes=0;for(this._skipInvalidateOnGlobalOpacityChange=!0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections,this._selectionByLayer||this._nodes.some(function(node){return node.cacheItem.selected})&&(this._singleSelectedItemClicked?(this._nodes.forEach(function(node){node.cacheItem.selected=!1}),this._singleSelectedItemClicked=!1):this._selectionByLayer=!0),i=0;i<this._numItems;i++)qRow=qMatrix[i],qDimCell=qRow[0],qState=qDimCell.qState,regionId=qDimCell.qText,node=this._nodes[i],shapeWrapper=node.shapeWrapper,shape=shapeWrapper.shape,projectedGeoPolygons=this._geoRegionsData.getProjectedGeoRegionById(regionId),projectToViewport.apply(this,[projectedGeoPolygons,shape]),cacheItem=node.cacheItem,lastSelectionState="S"===qState||"O"===qState||"L"===qState,color=node.color,!lastSelectionState&&cacheItem.selected&&(value=this._hasMeasure?qRow[1].qNum:null,color=this._colorMap.getColor(qDimCell.qElemNumber,value,measureIndex,i)),shapeWrapper.fill=color.toRGBA(),this._selectionByLayer?(selected=cacheItem.selected,shapeWrapper.stroke=selected?selectedStrokeColor:defaultStrokeColor,shapeWrapper.strokeWidth=selected?2:1):(selected=lastSelectionState,shapeWrapper.stroke=defaultStrokeColor,shapeWrapper.strokeWidth=1),selected?(shapeWrapper.opacity=1,selectedShapes[numSelectedShapes++]=shapeWrapper):(shapeWrapper.opacity=this._globalAlpha,nonselectedShapes[numNonSelectedShapes++]=shapeWrapper);this._rendererShapes=0===this._numItems?[]:nonselectedShapes.concat(selectedShapes),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this._selectionFailed=!1}}},getSnapshotLayerData:function(layerData){var h=Math.min(this._qData.qSize.qcy||MaxNumberOfPolygons,MaxNumberOfPolygons);return this.backendApi.getData("GetListObjectData","/layers/"+this._layerIndex+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:h}]).then(function(pages){layerData.qListObject.qDataPages=pages.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var i,qRow,qDimCell,qMeasCell,qState,regionId,index,shape,shapeWrapper,cacheItem,cacheItems,selected,value,color,qMatrix=this._qMatrix,measureIndex=this._hasMeasure?0:-1,measureTitle=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";for(this._singleSelectedItemClicked=!1,this._regionsChanged=!0,this._numSelectedItems=0,this._numSelectedExcludedItems=0,this._nodes=new Array(this._numItems),cacheItems=new Array(this._numItems),i=0;i<this._numItems;i++)qRow=qMatrix[i],qDimCell=qRow[0],qMeasCell=qRow[1],qState=qDimCell.qState,regionId=qDimCell.qText,index=qDimCell.qElemNumber||0,shape=new GeoRegion(void 0,regionId),shape.rowIndex=i,cacheItem=new CacheItem([regionId],[],[],[],i,0,index),cacheItem.selected=!1,cacheItem.layerIndex=this._layerIndex,cacheItem.addShape("dataArea",shape,!0),selected="S"===qState||"O"===qState||"L"===qState,value=this._hasMeasure?qMeasCell.qNum:null,color=selected?this._colorMap.getColor(qDimCell.qElemNumber,value,measureIndex,i):defaultFillColorObject,this._hasMeasure&&selected&&cacheItem.addMeasure(measureTitle,value,qMeasCell.qText),cacheItems[i]=cacheItem,shapeWrapper={type:"multipolygon",shape:shape},this._nodes[i]={shapeWrapper:shapeWrapper,cacheItem:cacheItem,color:color},"S"===qState&&(this._numSelectedItems++,this._selectedCacheItem=cacheItem),"XS"===qState&&this._numSelectedExcludedItems++;this.setSelectableShapes(cacheItems),this.fire("selectableShapesChanged"),this._dataChanged=!1}}})}),define("extensions.qliktech/map/map-polygon3-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon","core.utils/deferred"],function(MapLayer,CacheItem,Color,Point,Polygon,GeoRegion,GeoRegionsData,GeoPolygon,Deferred){"use strict";function calculateLayerS2Bounds(){return this._showExcluded?this._allItemsS2Bounds:calculateSelectedItemsS2Bounds.call(this)}function calculateSelectedItemsS2Bounds(){var i,regionIds=new Array(this._numItems);for(i=0;i<this._numItems;i++)regionIds[i]=this._qMatrix[i][0].qText;return"$mercator"!==this._geoData.qMeasureInfo[0].projection?this._geoRegionsData.calculateProjectedBoundsOfRegionIds(regionIds):this._geoRegionsData.calculateBoundsOfRegionIds(regionIds)}function isDimensionChanged(){return this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0]?this._dimensionTitle!==this._qData.qDimensionInfo[0].qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo[0].qFallbackTitle,!0):!1:void 0!==this._dimensionTitle?(this._dimensionTitle=void 0,!0):!1}function isGeometryMeasureChanged(){var num=this._geoData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._geoData.qMeasureInfo[num-1])?(this._geometryMeasureInfo=this._geoData.qMeasureInfo[num-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function createPolygon(points){var i,numPoints=points?points.length:0;for(i=0;numPoints>i;i++)points[i]=new Point(points[i][0],points[i][1]);return new Polygon(points)}function createGeoPolygon(coordinatesOfGeoPolygon){var i,numPolygons=coordinatesOfGeoPolygon?coordinatesOfGeoPolygon.length:0,polygons=new Array(numPolygons);for(i=0;numPolygons>i;i++)polygons[i]=createPolygon(coordinatesOfGeoPolygon[i]);return new GeoPolygon(polygons)}function createGeoRegion(regionId,coordinatesOfRegion){var i,geoRegion,geopolygons="-"===coordinatesOfRegion?[]:JSON.parse(coordinatesOfRegion),numGeoPolygons=geopolygons.length;for(i=0;numGeoPolygons>i;i++)geopolygons[i]=createGeoPolygon(geopolygons[i]);return geoRegion=new GeoRegion(geopolygons,regionId)}function setRawGeoRegions(rawGeoRegions){this._rawGeoRegions=rawGeoRegions,this._geoRegionsData.setGeoRegions(rawGeoRegions),"$mercator"!==this._geoData.qMeasureInfo[0].projection&&this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._allItemsS2Bounds=this._geoRegionsData.calculateProjectedBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function getGeometryDataFromEngine(){var self=this,layerIndex=this._layerIndex,h=Math.min(this._geoData.qSize.qcy||MaxNumberOfPolygons,MaxNumberOfPolygons),params=[{qTop:0,qLeft:0,qWidth:2,qHeight:h}];this._loadingGeometryData=!0;var dfd=Deferred();return this.backendApi.getData("GetHyperCubeData","/layers/"+layerIndex+"/geodata/qHyperCubeDef",params).then(function(pages){if(!self.backendApi||!self._viewportProjection)return void dfd.resolve();self._loadingGeometryData=!1,self._rawGeoRegions={};var i,regionCoordinates,rawGeoRegions,regionId,numRegions,numPoints=0,qDataPages=pages?pages.qDataPages:void 0,qMatrix=qDataPages?qDataPages instanceof Array&&qDataPages[0]?qDataPages[0].qMatrix:qDataPages.qMatrix:void 0;for(numRegions=qMatrix?qMatrix.length:0,self._qMatrix2=qMatrix,self._numRegions=numRegions,self._geometryDimensionIdx=1,rawGeoRegions=new Array(numRegions),i=0;numRegions>i;i++)regionId=qMatrix[i][0].qText,regionCoordinates=qMatrix[i][self._geometryDimensionIdx].qText,rawGeoRegions[i]=createGeoRegion(regionId,regionCoordinates),rawGeoRegions[i].validateGeoPolygons(),numPoints+=rawGeoRegions[i].getNumPoints();setRawGeoRegions.call(self,rawGeoRegions),self._dataChanged=!0,self.fire("dataChanged"),self._numPoints!==numPoints&&(self._numPoints=numPoints,self.fire("numPointsChanged",[self])),Deferred.all([self.invalidateProperties("MapPolygon3Layer.setGeoRegionsData"),self.invalidateDisplay("MapPolygon3Layer.setGeoRegionsData")]).then(function(){dfd.resolve()})}),dfd.promise}function projectToViewport(geopolygons,geoRegion){var geopolygon,numPolygons,polygon,points,numPoints,i,j,k,transformedPolygons,numGeoPolygons=geopolygons?geopolygons.length:0,transformedGeoPolygons=new Array(numGeoPolygons);for(i=0;numGeoPolygons>i;i++){for(geopolygon=geopolygons[i],numPolygons=geopolygon?geopolygon.length:0,transformedPolygons=new Array(numPolygons),j=0;numPolygons>j;j++){for(polygon=geopolygon[j],numPoints=polygon?polygon.length:0,points=new Array(numPoints),k=0;numPoints>k;k++)points[k]=this._viewportProjection.project(polygon[k]);transformedPolygons[j]=new Polygon(points)}transformedGeoPolygons[i]=new GeoPolygon(transformedPolygons)}geoRegion.setGeoPolygons(transformedGeoPolygons)}function isEmptyString(s){return void 0===s||null===s||""===s}var MapPolygon3Layer,MaxNumberOfPolygons=3333,defaultFillColor="#ddd",defaultFillColorObject=new Color(defaultFillColor),defaultStrokeColor="#333",selectedStrokeColor="#333";return MapPolygon3Layer=MapLayer.extend("MapPolygon3Layer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new GeoRegionsData,this.renderers={polygonlayer:this._renderer},this._numRegions=0},setLayerIndex:function(idx){this._layerIndex=idx,this._layerPath="/layers/"+this._layerIndex+"/geodata/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(data,layerData){return this._super(data,layerData),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._geoData=this._layerData?this._layerData.geodata.qHyperCube:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._hasMeasure=this._qMeasureInfo&&this._qMeasureInfo.length>0,this._geoDataHeight=this._geoData&&this._geoData.qSize?this._geoData.qSize.qcy:0,this._showExcluded=void 0===layerData.showExcluded?!0:layerData.showExcluded,this.show&&(this._geoDataHeight!==this._numRegions||isDimensionChanged.call(this)||isGeometryMeasureChanged.call(this))?getGeometryDataFromEngine.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygon3Layer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||!this._geoData||!this._geoData.qMeasureInfo||0===this._geoData.qMeasureInfo.length||isEmptyString(this._geoData.qMeasureInfo[0].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),
0!==this._numRegions){var k,i,qRow,qDimCell,regionId,node,shapeWrapper,shape,projectedGeoPolygons,cacheItem,lastSelectionState,selected,color,numRenderedRegions,qMatrix=this._qMatrix2,measureIndex=this._hasMeasure?0:-1,nonselectedShapes=[],selectedShapes=[],numNonSelectedShapes=0,numSelectedShapes=0;for(numRenderedRegions=this._rowIndexList?this._rowIndexList.length:0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(node){return node.cacheItem.selected}),k=0;numRenderedRegions>k;k++)i=this._rowIndexList[k],qRow=qMatrix[i],qDimCell=qRow[0],regionId=qDimCell.qText,node=this._nodeMap[regionId],shapeWrapper=node.shapeWrapper,shape=shapeWrapper.shape,projectedGeoPolygons=this._geoRegionsData.getProjectedGeoRegionById(regionId),projectToViewport.apply(this,[projectedGeoPolygons,shape]),cacheItem=node.cacheItem,lastSelectionState=-1!==node.index,color=node.color,!lastSelectionState&&cacheItem.selected&&(color=this._colorMap.getColor(qDimCell.qElemNumber,NaN,measureIndex,i)),shapeWrapper.fill=color.toRGBA(),this._selectionByLayer?(selected=cacheItem.selected,shapeWrapper.stroke=selected?selectedStrokeColor:defaultStrokeColor,shapeWrapper.strokeWidth=selected?2:1):(selected=lastSelectionState,shapeWrapper.stroke=defaultStrokeColor,shapeWrapper.strokeWidth=1),selected?(shapeWrapper.opacity=1,selectedShapes[numSelectedShapes++]=shapeWrapper):(shapeWrapper.opacity=this._globalAlpha,nonselectedShapes[numNonSelectedShapes++]=shapeWrapper);this._rendererShapes=nonselectedShapes.concat(selectedShapes),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1}}},getSnapshotLayerData:function(layerData){var h=Math.min(this._geoData.qSize.qcy||MaxNumberOfPolygons,MaxNumberOfPolygons);return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/geodata/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:2,qHeight:h}]).then(function(pages){layerData.geodata.qHyperCube.qDataPages=pages.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var i,k,qRow,qDimCell,qMeasCell,regionId,index,shape,shapeWrapper,cacheItem,cacheItems,value,node,layerS2Bounds,qMatrix=this._qMatrix2,measureIndex=this._hasMeasure?0:-1,measureTitle=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";if(this._regionsChanged=!0,this._numSelectedItems=0,this._regionIdDictionary={},this._nodeMap={},this._showExcluded)for(this._nodes=new Array(this._numRegions),cacheItems=new Array(this._numRegions),this._rowIndexList=new Array(this._numRegions),i=0;i<this._numRegions;i++)qRow=qMatrix[i],qDimCell=qRow[0],regionId=qDimCell.qText,index=qDimCell.qElemNumber||0,shape=new GeoRegion(void 0,regionId),shape.rowIndex=i,cacheItem=new CacheItem([regionId],[],[],[],i,0,index),cacheItem.selected=!1,cacheItem.layerIndex=this._layerIndex,cacheItem.addShape("dataArea",shape,!0),cacheItems[i]=cacheItem,shapeWrapper={type:"multipolygon",shape:shape},this._nodeMap[regionId]=this._nodes[i]={shapeWrapper:shapeWrapper,cacheItem:cacheItem,color:defaultFillColorObject,index:-1},this._rowIndexList[i]=i;else{for(qMatrix=this._qMatrix,i=0;i<this._numItems;i++)regionId=qMatrix[i][0].qText,this._regionIdDictionary[regionId]=!0;for(this._nodes=new Array(this._numItems),cacheItems=new Array(this._numItems),this._rowIndexList=new Array(this._numItems),k=0,qMatrix=this._qMatrix2,i=0;i<this._numRegions;i++)qRow=qMatrix[i],qDimCell=qRow[0],regionId=qDimCell.qText,this._regionIdDictionary[regionId]&&(index=qDimCell.qElemNumber||0,shape=new GeoRegion(void 0,regionId),shape.rowIndex=i,cacheItem=new CacheItem([regionId],[],[],[],i,0,index),cacheItem.selected=!1,cacheItem.layerIndex=this._layerIndex,cacheItem.addShape("dataArea",shape,!0),cacheItems[k]=cacheItem,shapeWrapper={type:"multipolygon",shape:shape},this._nodeMap[regionId]=this._nodes[k]={shapeWrapper:shapeWrapper,cacheItem:cacheItem,color:defaultFillColorObject,index:-1},this._rowIndexList[k]=i,k++)}for(qMatrix=this._qMatrix,i=0;i<this._numItems;i++)qRow=qMatrix[i],qDimCell=qRow[0],qMeasCell=qRow[1],regionId=qDimCell.qText,node=this._nodeMap[regionId],node&&(cacheItem=node.cacheItem,value=this._hasMeasure?qMeasCell.qNum:null,node.color=this._colorMap.getColor(qDimCell.qElemNumber,value,measureIndex,i),this._hasMeasure&&cacheItem.addMeasure(measureTitle,value,qMeasCell.qText),node.index=i,this._selectedCacheItem=cacheItem);this._numSelectedItems=this._numItems,this.setSelectableShapes(cacheItems),this.fire("selectableShapesChanged"),this._dataChanged=!1,layerS2Bounds=calculateLayerS2Bounds.call(this),layerS2Bounds&&layerS2Bounds.equal(this._layerS2Bounds)||(this._layerS2Bounds=layerS2Bounds,!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this]))}}})}),define("core.models/session-object",["core.models/generic-object","core.models/app"],function(GenericObject,App){"use strict";var SessionObject;return SessionObject=GenericObject.extend("SessionObject",{remove:function(){return SessionObject.remove(this.id,App.current)}}),SessionObject.get=function(props,app){function getHandle(){return app.createSessionObject(props)}var id=props.qInfo.qId||props.qInfo.qType;if(!id)throw new Error("no id");return props.qInfo.qId=id,app=app||App.current,this.getModel(id,app.session,getHandle)},SessionObject.remove=function(id,parent){return GenericObject.remove(id,"DestroySessionObject",parent)},SessionObject.extend=function(){var ctor=GenericObject.extend.apply(this,arguments);return ctor.get=SessionObject.get,ctor.remove=SessionObject.remove,ctor},SessionObject}),define("extensions.qliktech/map/map-glyph-layer",["extensions.qliktech/map/map-layer","extensions.qliktech/scatterplot/scatter-helper","objects.views/selections/cache-item-combo","objects.utils/shapes/rect","core.models/session-object"],function(MapLayer,ScatterHelper,CacheItem,Rect,SessionObject){"use strict";function calculateLayerS2Bounds(){var i,shape,p,w,h,minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=-Number.MAX_VALUE,maxY=-Number.MAX_VALUE;for(i=0;i<this._numItems;i++)shape=this._nodes[i].shapeWrapper.shape,p=shape.position,!p||isNaN(p.x)||isNaN(p.y)||(minX=Math.min(minX,p.x),minY=Math.min(minY,p.y),maxX=Math.max(maxX,p.x),maxY=Math.max(maxY,p.y));return minX===Number.MAX_VALUE||minY===Number.MAX_VALUE||maxX===-Number.MAX_VALUE||maxY===-Number.MAX_VALUE?void 0:(w=maxX-minX,h=maxY-minY,0===w&&this._wholeBoundingBox&&this._totalNumPoints&&(w=Math.abs(this._wholeBoundingBox.qRight-this._wholeBoundingBox.qLeft)/this._totalNumPoints,minX-=w/2),0===h&&this._wholeBoundingBox&&this._totalNumPoints&&(h=Math.abs(this._wholeBoundingBox.qTop-this._wholeBoundingBox.qBottom)/this._totalNumPoints,minY-=h/2),new Rect(minX,minY,w,h))}function updateGlyphsPosition(){var i,j,shape,p,points,crossSize=3,crossWidth=1;for(i=0;i<this._numItems;i++)if(shape=this._nodes[i].shapeWrapper.shape)if(0===shape.type)shape.position?(p=this._viewportProjection.project(shape.position),shape.setPosition(p.x,p.y)):shape.setPosition(NaN,NaN);else if(shape.position){if(p=this._viewportProjection.project(shape.position),points=shape.points,!points||13!==points.length)for(points=new Array(13),j=0;13>j;j++)points[j]={};points=ScatterHelper.updateCross(points,p.x,p.y,crossSize,crossWidth),shape.set(points)}else shape.set([])}function getMinMax(){this._hasMeasure?void 0===this._layerData.autoMinMax||this._layerData.autoMinMax===!0?(this._qMin=this._qMeasureInfo[0].qMin,this._qMax=this._qMeasureInfo[0].qMax):(this._qMin=this._layerData.customMin,this._qMax=this._layerData.customMax):(this._qMin=void 0,this._qMax=void 0)}function isMinMaxValid(){return isNaN(this._qMin)||void 0===this._qMin||null===this._qMin?!1:isNaN(this._qMax)||void 0===this._qMax||null===this._qMax?!1:this._qMax<this._qMin?!1:!0}function findGoodBounds(){var self=this,x=self._layerS2Bounds.x,y=self._layerS2Bounds.y,w=self._layerS2Bounds.width,h=self._layerS2Bounds.height;if(w>0||h>0)return w>0?(h=w/2,y-=h/2):h>0&&(w=h/2,x-=w/2),self._layerS2Bounds=new Rect(x,y,w,h),void self.fire("boundsChanged",[self]);var fieldName=this._qDimensionInfo[1].qFallbackTitle;"="===fieldName.substr(0,1)&&(fieldName=fieldName.substr(1)),"geomakepoint"!==fieldName.substr(0,12).toLowerCase()&&(fieldName="["+fieldName+"]"),SessionObject.get({qInfo:{qId:fieldName,qType:"PointStats"},pointsStatistic:{boundingBox:{qStringExpression:"GeoBoundingBox({1}"+fieldName+")"},numPoints:{qValueExpression:"Count({1}"+fieldName+")"}}}).then(function(model){return model.getLayout().then(function(layout){var rect=JSON.parse(layout.pointsStatistic.boundingBox);if(!self._geoDataIsProjectedToS2){var projection,p1,p2;projection=self._viewportProjection.getMercatorProjection(),p1=projection.project({x:rect.qLeft,y:rect.qBottom}),p2=projection.project({x:rect.qRight,y:rect.qTop}),rect.qLeft=p1.x,rect.qRight=p2.x,rect.qBottom=p1.y,rect.qTop=p2.y}if(self._wholeBoundingBox=rect,self._totalNumPoints=layout.pointsStatistic.numPoints,self._layerS2Bounds&&(0===self._layerS2Bounds.width||0===self._layerS2Bounds.height)){var x,y,w,h;w=Math.abs(self._wholeBoundingBox.qRight-self._wholeBoundingBox.qLeft)/self._totalNumPoints,x=self._layerS2Bounds.x-w/2,h=Math.abs(self._wholeBoundingBox.qTop-self._wholeBoundingBox.qBottom)/self._totalNumPoints,y=self._layerS2Bounds.y-h/2,self._layerS2Bounds=new Rect(x,y,w,h),self.fire("boundsChanged",[self])}})})}var MapPointLayer,MaxNumberOfPoints=3333,defaultStrokeColor="#333";return MapPointLayer=MapLayer.extend("MapPointLayer",{init:function(){this._super.apply(this,arguments),this.renderers={pointlayer:this._renderer},this._layerS2Bounds=void 0,this._useSize=!0},setLayerIndex:function(idx){this._layerIndex=idx,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(data,layerData){return this._super(data,layerData),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qMatrix=this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._numMeasures=this._qMeasureInfo?this._qMeasureInfo.length:0,this._hasMeasure=this._numMeasures>0&&this._qMeasureInfo[0].qFallbackTitle?!0:!1,this._data&&this._data.color&&!this._data.color.persistent&&(this._data.color.persistent=!0),getMinMax.call(this),this._isValidMinMax=isMinMaxValid.call(this),this._qRange=this._qMax-this._qMin,this._numItems=this._qMatrix?this._qMatrix.length:0,this._needUpdateProperties=!0,this._needPaint=!0,this._hasMeasure&&this._useSize?this._maxDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32:this._maxDotSize=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this.fire("dataChanged"),this.invalidateProperties("MapPointLayer.setData")},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle},getNumSelectedItems:function(){return this._numItems},getLayerBounds:function(){var vp,s,x,y,d;return vp=this._viewportProjection.getSize(),this._layerS2Bounds?(this._layerS2Bounds2=this._layerS2Bounds.clone(),vp&&(d=2*(this._maxDotSize+1),x=vp.x-d,y=vp.y-d,s=Math.min(x/this._layerS2Bounds.width,y/this._layerS2Bounds.height),x=s*this._layerS2Bounds.width,y=s*this._layerS2Bounds2.height,s=Math.min(vp.x/x,vp.y/y),this._layerS2Bounds2.scale(s)),this._layerS2Bounds2):this._layerS2Bounds},paint:function(){if(this._super(this._layoutMode,this._data),!(this.show&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle&&this._viewportProjection&&0!==this._qMatrix.length&&void 0!==this._qMatrix[0][1]))return this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.clear();if(void 0===this._nodes&&this._updateProperties(),void 0!==this._nodes){var i,node,color,selected,strokeColor,strokeWidth,opacity,shapeWrapper,shape,nonselectedShapes=[],selectedShapes=[],numNonSelectedShapes=0,numSelectedShapes=0;for((this._glyphsChanged||this._viewportProjectionChanged)&&updateGlyphsPosition.call(this),i=0;i<this._numItems;i++)node=this._nodes[i],shapeWrapper=node.shapeWrapper,shape=shapeWrapper.shape,shape&&shape.position&&(color=node.color,selected=node.cacheItem.selected,selected?(strokeColor=defaultStrokeColor,strokeWidth=2,opacity=1,selectedShapes[numSelectedShapes++]=shapeWrapper):(strokeColor=color.createShiftedColor().toRGBA(),strokeWidth=1,opacity=this._globalAlpha,nonselectedShapes[numNonSelectedShapes++]=shapeWrapper),shapeWrapper.stroke=strokeColor,shapeWrapper.strokeWidth=strokeWidth,shapeWrapper.opacity=opacity);this._rendererShapes=0===this._numItems?[]:nonselectedShapes.concat(selectedShapes),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.afterPaint()}},setRect:function(x,y,w,h){this._super(x,y,w,h),this.rect&&this.rect.x===x&&this.rect.y===y&&this.rect.width===w&&this.rect.height===h||!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this])},getSnapshotLayerData:function(layerData){var h=Math.min(this._qData.qSize.qcy||MaxNumberOfPoints,MaxNumberOfPoints);return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:h}]).then(function(pages){layerData.qHyperCube.qDataPages=pages.qDataPages})},_updateProperties:function(){if(this.show&&this._needUpdateProperties&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle){var i,p,pointName,index,value,shape,shapeType,cacheItem,cacheItems,cacheMap,numCaches,shapeWrapper,color,mercatorProjection,radius,dotSize,minDotSize,maxDotSize,hasMeasureAndUseSize,layerS2Bounds,qMatrix=this._qMatrix,measureIndex=this._hasMeasure?0:-1,polygonType="polygon",circleType="circle";for(minDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[0]?this._layerData.rangeBubbleSizes[0]:2,maxDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32,dotSize=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this._useSize=this._layerData.useSize,this._glyphsChanged=!0,this._nodes=new Array(this._numItems),cacheItems=[],cacheMap={},numCaches=0,this._geoDataIsProjectedToS2=this._qDimensionInfo&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qTags&&this._qDimensionInfo[1].qTags.indexOf("$mercator")>-1,mercatorProjection=this._viewportProjection.getMercatorProjection(),hasMeasureAndUseSize=this._hasMeasure&&this._useSize,i=0;i<this._numItems;i++)pointName=qMatrix[i][0].qText,index=qMatrix[i][0].qElemNumber||0,value=qMatrix[i][2]?qMatrix[i][2].qNum:void 0,hasMeasureAndUseSize?this._isValidMinMax?(radius=ScatterHelper.getDotRadius(value,this._qMin,this._qMax,minDotSize,maxDotSize),isNaN(radius)?(shape=ScatterHelper.createShape(polygonType),shape.type=1,shapeType=polygonType):(shape=ScatterHelper.createShape(circleType,[0,0,radius,0]),shape.type=0,shapeType=circleType)):(shape=ScatterHelper.createShape(polygonType),shape.type=1,shapeType=polygonType):(shape=ScatterHelper.createShape(circleType,[0,0,dotSize,0]),shape.type=0,shapeType=circleType),"-"===qMatrix[i][1].qText?shape.position=void 0:(p=qMatrix[i][1].qText.replace(/^\[|\]$/g,"").split(","),shape.position=this._geoDataIsProjectedToS2?{x:p[0],y:p[1]}:mercatorProjection.project({x:Number(p[0]),y:Number(p[1])})),shape.rowIndex=i,cacheMap[pointName]?cacheItem=cacheMap[pointName].cacheItem:(cacheItem=new CacheItem([pointName],[],[],[],i,0,index),cacheItem.selected=!1,cacheItem.layerIndex=this._layerIndex,cacheMap[pointName]={cacheItem:cacheItem,numShapes:0},cacheItems[numCaches++]=cacheItem),cacheItem.addShape("dataArea",shape,!0,[cacheMap[pointName].numShapes]),cacheMap[pointName].numShapes++,this._hasMeasure&&cacheItem.addMeasure(this._qMeasureInfo[0].qFallbackTitle,qMatrix[i][2].qNum,qMatrix[i][2].qText),color=this._colorMap.getColor([qMatrix[i][0].qElemNumber,qMatrix[i][1].qElemNumber],value,measureIndex,i),shapeWrapper={type:shapeType,fill:color.toRGBA(),shape:shape},this._nodes[i]={shapeWrapper:shapeWrapper,cacheItem:cacheItem,color:color};this.setSelectableShapes(cacheItems),this.fire("selectableShapesChanged"),this._geofieldName!==this._qDimensionInfo[1].qFallbackTitle&&(this._geofieldName=this._qDimensionInfo[1].qFallbackTitle,this._wholeBoundingBox=void 0,this._totalNumPoints=void 0),this._dimensionTitle=this._qDimensionInfo[0].qFallbackTitle,this._needUpdateProperties=!1,layerS2Bounds=calculateLayerS2Bounds.call(this),layerS2Bounds&&layerS2Bounds.equal(this._layerS2Bounds)||(this._layerS2Bounds=layerS2Bounds,!this._layerS2Bounds||0!==this._layerS2Bounds.width&&0!==this._layerS2Bounds.height||this._wholeBoundingBox?this.fire("boundsChanged",[this]):findGoodBounds.call(this))}}})}),define("extensions.qliktech/map/base-map-layer",["jquery","angular","objects.views/charts/components/chart-component","objects.utils/shapes/rect","objects.utils/shapes/point","client.utils/state","openlayers","general.services/media-tool/media-tool-service","core.utils/deferred"],function($,angular,ChartComponent,Rect,Point,State,OpenLayers,mediaToolService,Deferred){"use strict";function zoomToViewRectangle(){var rect,point1,point2,bounds;rect=this._viewportProjection?this._viewportProjection.getViewRectangleInLonLat():void 0,rect&&(point1=new OpenLayers.Geometry.Point(rect.x,rect.y),point1.transform(wgs84,mercator),point2=new OpenLayers.Geometry.Point(rect.x+rect.width,rect.y+rect.height),point2.transform(wgs84,mercator),bounds=new OpenLayers.Bounds,bounds.extend(point1),bounds.extend(point2),bounds.toBBOX(),this._openLayers.zoomToExtent(bounds))}function onOpenLayersAPILoaded(){OpenLayers.Map.prototype.adjustZoom=function(z){return z};var hasClassFnc=OpenLayers.Element.hasClass;OpenLayers.Element.hasClass=function(element,name){return element&&hasClassFnc(element,name)};var observeFnc=OpenLayers.Event.observe;OpenLayers.Event.observe=function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);element&&observeFnc.apply(this,[elementParam,name,observer,useCapture])},mercator=new OpenLayers.Projection("EPSG:900913"),wgs84=new OpenLayers.Projection("EPSG:4326")}function setAttribution(s){this._attribution=mediaToolService.toHTML(s),this.fire("attributionChanged",[s])}function onViewportProjectionChanged(){var zoomLevel,mapCenter;zoomLevel=this._viewportProjection.getZoomLevel(),mapCenter=this._viewportProjection.getMapCenterInLonLat(),this.setMapCenter(mapCenter),this.setZoomLevel(zoomLevel)}function onLoadEnd(){if(this._viewportProjection&&this.show){var z,c,z0,c0,b=!1;z=this.getZoomLevel(),c=this.getMapCenter(),z0=this._viewportProjection.getZoomLevel(),c0=this._viewportProjection.getMapCenterInLonLat(),c||(c=c0),Math.abs(z-z0)<.001&&(!c0||c0.closeTo(c,1e-6))||(this._viewportProjection.enabledChangeEvent=!1,b=b||this._viewportProjection.setZoomLevel(z),b=b||this._viewportProjection.setMapCenterInLonLat(c),this._viewportProjection.inResetZoomMode&&(this._viewportProjection.inResetZoomMode=!1,this._viewportProjection.fire("resetZoomFinished")),b&&this._viewportProjection.fire("changed"),this._viewportProjection.enabledChangeEvent=!0)}}function resolveMe(){this._dfd&&this._dfd.resolve(),this._dfdPaint&&this._dfdPaint.resolve()}function onBaseLayerLoadStart(){clearTimeout(this._safeGuardTimer)}function onBaseLayerLoadEnd(){if(this._openLayers&&this._openLayers.tileManager){var queue=this._openLayers.tileManager.tileQueue[this._openLayers.id];if(queue&&queue.length)return}resolveMe.call(this)}function onBaseLayerMoveEnd(){clearTimeout(this._safeGuardTimer);var that=this;this._safeGuardTimer=setTimeout(function(){resolveMe.call(that)},500)}function onOpenLayerUpdateSize(){clearTimeout(this._safeGuardTimer);var that=this;this._safeGuardTimer=setTimeout(function(){resolveMe.call(that)},500)}function addBaseLayer(baseLayer){removeBaseLayer.call(this),baseLayer.events.register("loadend",this,onLoadEnd),baseLayer.events.register("loadstart",this,onBaseLayerLoadStart),baseLayer.events.register("loadend",this,onBaseLayerLoadEnd),baseLayer.events.register("moveend",this,onBaseLayerMoveEnd),this._openLayers.events.register("updatesize",this,onOpenLayerUpdateSize),this._openLayers.addLayer(baseLayer),this._openLayers.setBaseLayer(baseLayer),this._baseLayer=baseLayer}function removeBaseLayer(){this._baseLayer&&(this._openLayers.removeLayer(this._baseLayer),this._baseLayer.events.unregister("loadend",this,onLoadEnd),this._baseLayer.events.unregister("loadstart",this,onBaseLayerLoadStart),this._baseLayer.events.unregister("loadend",this,onBaseLayerLoadEnd),this._baseLayer.events.unregister("moveend",this,onBaseLayerMoveEnd)),this._openLayers.events.unregister("updatesize",this,onOpenLayerUpdateSize),this._baseLayer=void 0}function addXYZBaseLayer(layerData,numZoomLevels){var baseLayer,urls=layerData.urls,attribution=layerData.attribution||"";(this._urls!==urls||this._attribution!==attribution)&&(angular.equals(this._urls,urls)||(this._urls=urls,this._urls&&this._urls.some(function(url){return url&&url.trim()})?(baseLayer=new OpenLayers.Layer.XYZ("XYZ",this._urls,{numZoomLevels:numZoomLevels,wrapDateLine:!0}),addBaseLayer.call(this,baseLayer)):removeBaseLayer.call(this)),this._attribution!==attribution&&setAttribution.call(this,attribution))}function addWMSBaseLayer(layerData){var baseLayer,urls=layerData.urls,params=layerData.params||"";try{params=JSON.parse(params)}catch(e){return}(this._urls!==urls||this._params!==params)&&(this._params=params,angular.equals(this._urls,urls)||(this._urls=urls,this._urls?(baseLayer=new OpenLayers.Layer.WMS("WMS",this._urls,this._params),addBaseLayer.call(this,baseLayer)):removeBaseLayer.call(this)))}function addTMSBaseLayer(layerData){var baseLayer,urls=layerData.urls,params=layerData.params||"";try{params=JSON.parse(params)}catch(e){return}angular.equals(this._urls,urls)||(this._params=params,this._urls!==urls&&(this._urls=urls,this._urls?(baseLayer=new OpenLayers.Layer.TMS("TMS",this._urls?this._urls:"blank",this._params),addBaseLayer.call(this,baseLayer)):removeBaseLayer.call(this)))}var BaseMapLayer,mercator,wgs84,touchControls,centerEpsilon=1e-9,zoomEpsilon=1e-4,maxZoomLevel=19,minZoomLevel=0;return onOpenLayersAPILoaded(),BaseMapLayer=ChartComponent.extend("BaseMapLayer",{init:function(){function initialize(){touchControls=new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),self._openLayers=new OpenLayers.Map({div:self.container,transitionEffect:null,zoomMethod:null,controls:[touchControls],projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),displayOutsideMaxExtent:!0,numZoomLevels:maxZoomLevel+1,wrapDateLine:!0}),self._viewState!==State.States.analysis&&self._openLayers.controls.length&&touchControls.deactivate(),self._minZoomLevel=0,self._maxZoomLevel=maxZoomLevel,zoomToViewRectangle.call(self),self._zoomCenterInitialized=!1,self._viewportProjection&&(self.updateViewportToBaseMap(!1),self._zoomCenterInitialized=!0),self._ready=!0}this._super.apply(this,arguments),this._attribution=null,this._mapCenter=null,this._zoomLevel=null,this._layerNames=["OSM","MQ-OSM","MQSatellite"],this._selectedLayerName="OSM",this._googleMapLayersAdded=!1,this._isBingMapUsed=!1,this._needToSetBackgroundMapType=!1;var self=this;$(this.container).css({width:"100%",height:"100%"}),initialize()},getAttribution:function(){return void 0===this._attribution?"":this._attribution},setViewportProjection:function(viewportProjection){this._viewportProjection!==viewportProjection&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",onViewportProjectionChanged,this),this._viewportProjection.stopListen("changedByInteraction",onViewportProjectionChanged,this)),this._viewportProjection=viewportProjection,this._viewportProjection&&(this._viewportProjection.listen("changed",onViewportProjectionChanged,this),this._viewportProjection.listen("changedByInteraction",onViewportProjectionChanged,this)),this.updateViewportToBaseMap(!0))},setRect:function(x,y,w,h){this._super(x,y,w,h),this._viewport=new Rect(x,y,w,h)},getViewport:function(){return this._viewport},setFirstAutoZoomed:function(b){this._firstAutoZoomed=b},getFirstAutoZoomed:function(){return this._firstAutoZoomed},hasValidSize:function(){if(!this._openLayers)return!1;var s=this._openLayers.getSize();return s&&s.w>0&&s.h>0},isReady:function(){return this._ready&&this._openLayers&&this._openLayers.layers&&this._openLayers.layers.length>0&&this._baseLayer},setAppViewState:function(state){this._viewState=state,this._openLayers&&0!==this._openLayers.controls.length&&this._viewState!==State.States.analysis&&touchControls.deactivate()},showComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!0),this.updateViewportToBaseMap(!0)},hideComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!1)},getMapCenter:function(){if(this.show&&this.isReady()&&this.hasValidSize()){var mapCenter=this._openLayers.getCenter();if(mapCenter)return mapCenter.transform(this._openLayers.getProjectionObject(),wgs84),new Point(mapCenter.lon,mapCenter.lat)}},setMapCenter:function(p){if(!(p&&this.show&&this.isReady()&&this.hasValidSize()))return!1;var mapCenter,lonlat;return mapCenter=this.getMapCenter(),mapCenter&&mapCenter.closeTo(p,centerEpsilon)?!1:(this._mapCenter=p,lonlat=new OpenLayers.LonLat(p.x,p.y),lonlat.transform(wgs84,this._openLayers.getProjectionObject()),this._openLayers.setCenter(lonlat),!0)},getZoomLevel:function(){return this.show&&this.isReady()&&this.hasValidSize()?this._openLayers.zoom:0},setZoomLevel:function(z){return this.show&&this._openLayers&&this.hasValidSize()&&!(Math.abs(this.getZoomLevel()-z)<zoomEpsilon)&&this.isReady()?(this._zoomLevel=z,this._openLayers.zoomTo(z),!0):!1},panBy:function(dx,dy){return this.show&&this.isReady()&&this.hasValidSize()?(this._openLayers.moveByPx(dx,dy),!0):!1},fromLonLatToViewport:function(lonLatPoint){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var lonLat,pixel;return lonLat=new OpenLayers.LonLat(lonLatPoint.x,lonLatPoint.y),lonLat.transform(wgs84,this._openLayers.getProjectionObject()),pixel=this._openLayers.getViewPortPxFromLonLat(lonLat),new Point(pixel.x,pixel.y)},fromViewportToLonLat:function(p){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var pixel,lonLat,projectionObject;return pixel=new OpenLayers.Pixel(p.x,p.y),lonLat=this._openLayers.getLonLatFromViewPortPx(pixel),projectionObject=this._openLayers.getProjectionObject(),lonLat.transform(projectionObject,wgs84),new Point(lonLat.lon,lonLat.lat)},updateViewportToBaseMap:function(updateBack){var c1,z1,c2,z2,b=!1;return this._viewportProjection&&this.isReady()?(z1=this._viewportProjection.getZoomLevel(),c1=this._viewportProjection.getMapCenterInLonLat(),c1=c1?c1:{x:0,y:0},z1=Math.min(maxZoomLevel,Math.max(minZoomLevel,z1)),this.setMapCenter(c1),this.setZoomLevel(z1),updateBack&&(c2=this.getMapCenter(),z2=this.getZoomLevel(),this._viewportProjection.enabledChangeEvent=!1,Math.abs(z2-z1)>zoomEpsilon&&(b=b||this._viewportProjection.setZoomLevel(z2)),c2&&c1&&!c2.closeTo(c1)&&(b=b||this._viewportProjection.setMapCenterInLonLat(c2)),b&&this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0),b):b},setData:function(data){this._super(data),this._dfd&&this._dfd.reject(),this._dfd=Deferred();var baseLayerData,baseLayerType,defaultMapService,visible;if(defaultMapService=this._data.background.defaultMapService,defaultMapService?(baseLayerData={urls:["http://a.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://b.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://c.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://d.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ"],type:"XYZ",attribution:"<a href='https://www.mapbox.com/about/maps/'>&copy; Mapbox &copy; OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a>"},baseLayerType="XYZ"):(baseLayerData=this._data.background.layers?this._data.background.layers[0]:{},baseLayerType=baseLayerData.type||"XYZ"),baseLayerData&&(this._urls||baseLayerData.urls))switch(baseLayerType){case"XYZ":addXYZBaseLayer.call(this,baseLayerData,defaultMapService?23:maxZoomLevel+1);break;case"WMS":addWMSBaseLayer.call(this,baseLayerData);break;case"TMS":addTMSBaseLayer.call(this,baseLayerData)}if(this._openLayers&&this._baseLayer&&(minZoomLevel=this._openLayers.getMinZoom(),maxZoomLevel=this._openLayers.getNumZoomLevels()+minZoomLevel-1,(this._minZoomLevel!==minZoomLevel||this._maxZoomLevel!==maxZoomLevel)&&(this._minZoomLevel=minZoomLevel,this._maxZoomLevel=maxZoomLevel,this.fire("maxMinZoomLevelChanged",[maxZoomLevel,minZoomLevel]))),visible=this._data&&this._data.background&&this._data.background.show&&(defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(url){return url&&url.trim()}))){this.showComponent();var self=this;clearTimeout(this._safeGuardTimer),this._safeGuardTimer=setTimeout(function(){self._dfd.resolve(),self._dfdPaint&&self._dfdPaint.resolve()},500)}else this.hideComponent(),this._dfd.resolve();return this.fire("baseLayerChanged"),this.invalidateProperties("BaseMapLayer.setData"),this._dfd.promise},hasValidData:function(){return!0},paint:function(){this._super(this._layoutMode);var s,w,h;return this._openLayers&&(s=this._openLayers.getSize(),w=s.w,h=s.h,w!==this.rect.width||h!==this.rect.height)?(this._dfdPaint=Deferred(),this._openLayers.updateSize(),this._dfdPaint.promise):Deferred.resolve()},afterPaint:function(){},release:function(){this._super(),clearTimeout(this._safeGuardTimer),removeBaseLayer.call(this),touchControls.destroy(),this._openLayers.destroy()}})}),define("extensions.qliktech/map/layer-dependency",["objects.views/charts/events/event-launcher"],function(EventLauncher){"use strict";function onLayerDataChanged(){this._layer&&(this._colorMapData=this._layer.getLayerOutputData(),this.fire("changed"))}var LayerDependency;return LayerDependency=EventLauncher.extend("LayerDependency",{init:function(){this._super()},setLayer:function(layer){this._layer!==layer&&(this._layer&&this._layer.stopListen("dataChanged",onLayerDataChanged,this),this._layer=layer,this._layer&&this._layer.listen("dataChanged",onLayerDataChanged,this))},getColorMapData:function(){return this._colorMapData},release:function(){this._layer&&this._layer.stopListen("dataChanged",onLayerDataChanged,this),this._layer=null}})}),define("extensions.qliktech/map/map-area",["jquery","objects.views/charts/components/chart-component","objects.utils/shapes/rect","core.utils/deferred","extensions.qliktech/map/map-polygon-layer","extensions.qliktech/map/map-polygon3-layer","extensions.qliktech/map/map-glyph-layer","extensions.qliktech/map/base-map-layer","extensions.qliktech/map/layer-dependency","objects.views/charts/utils/chart-formatting","touche"],function($,ChartComponent,Rect,Deferred,MapPolygonLayer,MapPolygon3Layer,MapPointLayer,BaseMapLayer,LayerDependency,ChartFormatting){
"use strict";function getLayerClass(dataLayer){switch(dataLayer.type){case"polygon":return"3"===dataLayer.version?MapPolygon3Layer:MapPolygonLayer;case"point":return MapPointLayer}return null}function updateLayerRect(layer){var rect;layer.setLayoutMode(this._layoutMode),rect=this.rect,layer.setRect(rect.x,rect.y,rect.width,rect.height),rect=this.outerRect,layer.setOuterRect(rect.x,rect.y,rect.width,rect.height),rect=this.containerRect,layer.setContainerRect(rect.x,rect.y,rect.width,rect.height),rect=this.layoutToContainerRatios,layer.setLayoutToContainerRatios(rect.x,rect.y),layer.setViewportProjection(this._viewportProjection)}function createLayer(klass,layerType,version,layerIndex){var layerId="layer."+layerIndex+"."+layerType+(void 0===version?"":version),layer=new klass(this.layersContainer,{clazz:klass},layerId);return layer.setLayerType(layerType),layer.setVersion(version),layer}function updateLayers(){var i,dataLayers,dataLayer,n,layer,layerType,version,klass;for(dataLayers=this._data?this._data.layers:null,n=dataLayers?dataLayers.length:0,n=Math.min(n,this._maxNumLayers),!this.baseMapLayer&&this._data&&this._data.background&&this._data.background.show&&(this._data.background.defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(url){return url&&url.trim()}))&&(this.addBaseMapLayer(new BaseMapLayer(this.layersContainer,{clazz:BaseMapLayer},"BaseMapLayer")),this.addAttributionLayer(document.createElement("div"))),i=0;n>i;i++)dataLayer=dataLayers[i],layerType=dataLayer.type,version=dataLayer.version,klass=getLayerClass(dataLayer),klass&&(layer=this.layers[i],layer?(layer.getLayerType()!==layerType||layer.getVersion()!==version)&&this.removeLayer(layer,!0):(layer=createLayer.apply(this,[klass,layerType,version,i]),this.addLayer(layer,i)));if(this._numLayers>n)for(i=n;i<this._numLayers;i++)layer=this._layers[i],layer&&this.removeLayer(layer);this._numLayers=n,this.attributionLayer&&this.container.appendChild(this.attributionLayer)}function setLayersData(){for(var dfds=[],i=0;i<this._numLayers;i++)dfds.push(this.layers[i].setData(this._data,this._data.layers[i]));return this.baseMapLayer&&(dfds.push(this.baseMapLayer.setData(this._data)),onBaseMapAttributionChange.call(this)),Deferred.all(dfds)}function updateBackendApi(){this._numLayers<1||this.layers[this._numLayers-1].updateBackendApi()}function validateBounds(bounds,totalBounds){var minX,maxX,minY,maxY,minX1,maxX1,minY1,maxY1;bounds&&(minX=bounds.x,maxX=bounds.x+bounds.width,minY=bounds.y,maxY=bounds.y+bounds.height,minX1=totalBounds.x,maxX1=totalBounds.x+totalBounds.width,minY1=totalBounds.y,maxY1=totalBounds.y+totalBounds.height,minX1>minX&&(minX=minX1),maxX>maxX1&&(maxX=maxX1),minY1>minY&&(minY=minY1),maxY>maxY1&&(maxY=maxY1),bounds.set(minX,minY,maxX-minX,maxY-minY))}function clearInvalidLayers(){var i,layer;for(i=0;i<this._numLayers;i++)layer=this.layers[i],layer&&!layer.hasValidData()&&layer.clear()}function getFirstValidLayer(){var i,dataLayer,numLayers=Math.min(this._numLayers,this._maxNumLayers);for(i=0;numLayers>i;i++){if(dataLayer=this._data.layers[i],dataLayer&&dataLayer.qHyperCube&&dataLayer.qHyperCube.qDimensionInfo&&dataLayer.qHyperCube.qDimensionInfo.length>0)return this.layers[i];if(dataLayer&&dataLayer.qListObject&&dataLayer.qListObject.qDimensionInfo&&dataLayer.qListObject.qDimensionInfo.qFallbackTitle)return this.layers[i]}}function setLegendMarker(){var legendProvider=this._colorMap.getLegendDataProvider();legendProvider.setLegendMarker("point"===this.coloredLayer.getLayerData().type?"circle":"rect")}function onBaseMapMaxMinZoomLevelChange(maxZoomLevel,minZoomLevel){this._interactionController.setMaxZoomLevel(maxZoomLevel),this._interactionController.setMinZoomLevel(minZoomLevel)}function onBaseMapAttributionChange(){this.attributionLayer.innerHTML=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady()?this.baseMapLayer.getAttribution():""}function onBaseMapLayerChange(){var b=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady();this.map.setFractionalZoomMode(!b)}function onLayerSelectableShapesChanged(){this.updateSelectableShapes()}function updateMapBounds(){var layer,i,rect,unionBounds,snapshotMapRect,snapshotMapRectIsValid,mapBoundsNeedToUpdate=!1,zoomOnMapBounds=!1,numChangedLayers=this._changedBoundsLayers?this._changedBoundsLayers.length:0;if(this.layersReady&&0!==numChangedLayers){for(i=0;i<this._numLayers;i++)this.layers[i].isVisible()&&(rect=this.layers[i].getLayerBounds(),rect&&(unionBounds=unionBounds?unionBounds.union(rect):rect.clone()));if(validateBounds.apply(this,[unionBounds,this._worldBounds]),void 0===unionBounds&&void 0===this._unionBounds?this._unionBounds=this._worldBounds:this._unionBounds=unionBounds,this._unionBounds&&this._unionBounds.hasNaN()&&(this._unionBounds=this._worldBounds),this.map.isSnapshot()||this.map.options.viewState)try{snapshotMapRect=(this.map.options.viewState||this.map.getSnapshotStoredChartData()).mapRect}catch(e){}if(snapshotMapRectIsValid=snapshotMapRect&&void 0!==snapshotMapRect.width&&void 0!==snapshotMapRect.height&&void 0!==snapshotMapRect.x&&void 0!==snapshotMapRect.y,this._unionBounds&&void 0!==unionBounds){for(i=0;numChangedLayers>i;i++)layer=this._changedBoundsLayers[i],layer&&(mapBoundsNeedToUpdate=!0,(!layer.getFirstAutoZoomed()||this.map.getAutoZoomOnDataChange())&&(this._unionBounds.width||this._unionBounds.height)&&(zoomOnMapBounds=!0,layer.setFirstAutoZoomed(!0)));mapBoundsNeedToUpdate&&this.map.setMapBounds(this._unionBounds),zoomOnMapBounds&&!snapshotMapRectIsValid&&this.map.zoomOnMapBounds()}else 0===numChangedLayers&&this.baseMapLayer&&void 0===unionBounds&&!this.baseMapLayer.getFirstAutoZoomed()&&((void 0===this._unionBounds||this._unionBounds.hasNaN())&&(this._unionBounds=this._worldBounds),this.map.setMapBounds(this._unionBounds),!this._unionBounds.width||!this._unionBounds.height||this.map.isSnapshot()&&snapshotMapRectIsValid||(this.map.zoomOnMapBounds(),this.baseMapLayer.setFirstAutoZoomed(!0)));this._changedBoundsLayers=[]}}function onLayerBoundsChanged(layer){-1===this._changedBoundsLayers.indexOf(layer)&&(this._changedBoundsLayers.push(layer),updateMapBounds.call(this))}function onLayerNumPointsChanged(){var i,layer,numPoints,totalNumPoints=0;for(i=0;i<this._numLayers;i++)layer=this.layers[i],numPoints=layer&&layer.getNumPoints?layer.getNumPoints():0,totalNumPoints+=numPoints;this.map.setZoomPanByWebkitTransform(totalNumPoints>LIMIT_NUM_POINTS)}function onLayerDependencyChange(){var colorMapData=this._layerDependency.getColorMapData();this._colorMap.setData(colorMapData),this._legend.setData(colorMapData),this._chartContext.refresh(colorMapData),setLegendMarker.call(this),this.layersReady=!0,this.map.layersReadyDfd.resolve(),updateMapBounds.call(this)}var MapArea,namespace=".maparea",LIMIT_NUM_POINTS=3e4,id=0;return MapArea=ChartComponent.extend("MapArea",{init:function(container,options){this._super.apply(this,Array.prototype.slice.call(arguments)),this.id="MapArea"+id++,this.layers=[],this._maxNumLayers=1,this._numLayers=0,this.options=options,this._unionBounds=void 0,this._worldBounds=new Rect(-180,-180,360,360),this._changedBoundsLayers=[],this._layerDependency=new LayerDependency,this._layerDependency.listen("changed",onLayerDependencyChange,this)},setMaxNumLayers:function(n){isNaN(n)&&(n=0),this._maxNumLayers=n},getMaxNumLayers:function(){return this._maxNumLayers},setData:function(data){var dfds=[];return this.layersReady=!1,this._data=data,updateLayers.call(this),updateBackendApi.call(this),this.coloredLayer=getFirstValidLayer.call(this),this._layerDependency.setLayer(this.coloredLayer),dfds.push(setLayersData.call(this)),clearInvalidLayers.call(this),this.map.setFormatter(new ChartFormatting(this.backendApi.localeInfo,this.coloredLayer.getMeasureInfo())),Deferred.all(dfds)},addLayer:function(layer,index){layer&&(layer.setLayerIndex(index),layer.setBackendApi(this.backendApi),layer.listen("selectableShapesChanged",onLayerSelectableShapesChanged,this),layer.listen("boundsChanged",onLayerBoundsChanged,this),layer.listen("numPointsChanged",onLayerNumPointsChanged,this),layer.setColorMap(this._colorMap),updateLayerRect.call(this,layer),this.layers[index]=layer)},removeLayer:function(layer,keep){if(layer){var layerContainer,layerParent,index=this.layers.indexOf(layer);layer.stopListen("selectableShapesChanged",onLayerSelectableShapesChanged,this),layer.stopListen("boundsChanged",onLayerBoundsChanged,this),layer.stopListen("numPointsChanged",onLayerNumPointsChanged,this),layer.clear(),layer.release(),layer.off(),layer.container&&layer.container.parentElement&&(layerContainer=layer.container,layerParent=layerContainer.parentElement,layerParent.removeChild(layerContainer)),!keep&&index>-1&&this.layers.splice(index,1)}},addBaseMapLayer:function(baseMapLayer){this.baseMapLayer||(this.baseMapLayer=baseMapLayer,this.layersContainer.insertBefore(baseMapLayer.container,this.layersContainer.firstChild),updateLayerRect.call(this,baseMapLayer),baseMapLayer.listen("maxMinZoomLevelChanged",onBaseMapMaxMinZoomLevelChange,this),baseMapLayer.listen("attributionChanged",onBaseMapAttributionChange,this),baseMapLayer.listen("baseLayerChanged",onBaseMapLayerChange,this),baseMapLayer.setAppViewState(this.map.getAppViewState()))},removeBaseMapLayer:function(){if(this.baseMapLayer){var layerContainer,layerParent;this.baseMapLayer.stopListen("maxMinZoomLevelChanged",onBaseMapMaxMinZoomLevelChange,this),this.baseMapLayer.stopListen("attributionChanged",onBaseMapAttributionChange,this),this.baseMapLayer.stopListen("baseLayerChanged",onBaseMapLayerChange,this),this.baseMapLayer.container&&this.baseMapLayer.container.parentElement&&(layerContainer=this.baseMapLayer.container,layerParent=layerContainer.parentElement,layerParent.removeChild(layerContainer))}},addAttributionLayer:function(attributionLayer){this.attributionLayer||(this.attributionLayer=attributionLayer,attributionLayer.style.position="absolute",attributionLayer.style.bottom="0",attributionLayer.style.right="0",Touche(attributionLayer).tap({id:namespace,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),this.container.appendChild(attributionLayer))},removeAttributionLayer:function(){this.attributionLayer&&this.container.removeChild(this.attributionLayer)},setBackendApi:function(backendApi){this.backendApi=backendApi;for(var i=0;i<this._numLayers;i++)this.layers[i].setBackendApi(backendApi)},setMap:function(map){this.map=map},getMap:function(){return this.map},setViewportProjection:function(viewportProjection){if(this._viewportProjection!==viewportProjection){this._viewportProjection=viewportProjection;for(var i=0;i<this._numLayers;i++)this.layers[i].setViewportProjection(this._viewportProjection);this.baseMapLayer&&this.baseMapLayer.setViewportProjection(this._viewportProjection)}},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},setLegend:function(legend){this._legend=legend},setChartContext:function(chartContext){this._chartContext=chartContext},setInteractionController:function(controller){this._interactionController=controller},setHasValidData:function(b){this._super(b);for(var i=0;i<this._numLayers;i++)this.layers[i].setHasValidData(b)},hasValidData:function(){return this._super()&&this._data},setLayoutMode:function(l){this._super(l);for(var i=0;i<this._numLayers;i++)this.layers[i].setLayoutMode(l);this.baseMapLayer&&this.baseMapLayer.setLayoutMode(l)},setRect:function(x,y,w,h){this._super(x,y,w,h);for(var i=0;i<this._numLayers;i++)this.layers[i].setRect(0,0,w,h);this.baseMapLayer&&this.baseMapLayer.setRect(0,0,w,h)},setOuterRect:function(x,y,w,h){this._super(x,y,w,h);for(var i=0;i<this._numLayers;i++)this.layers[i].setOuterRect(0,0,w,h);this.baseMapLayer&&this.baseMapLayer.setOuterRect(0,0,w,h)},setLayoutToContainerRatios:function(x,y){this._super(x,y);for(var i=0;i<this._numLayers;i++)this.layers[i].setLayoutToContainerRatios(x,y);this.baseMapLayer&&this.baseMapLayer.setLayoutToContainerRatios(x,y)},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var r in this.renderers)this.renderers[r].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[r].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1);for(var i=0;i<this._numLayers;i++)this.layers[i].updateSize()},setContainerRect:function(x,y,w,h){this._super(x,y,w,h);for(var i=0;i<this._numLayers;i++)this.layers[i].setContainerRect(0,0,w,h);this.baseMapLayer&&this.baseMapLayer.setContainerRect(0,0,w,h)},showComponent:function(){this._super();var i,j;for(i=0;i<this._numLayers;i++)for(j=0;j<this.layers[i].renderers.length;j++)this.layers[i].renderers[j].show();this.baseMapLayer&&(this.baseMapLayer.showComponent(),onBaseMapAttributionChange.call(this))},hideComponent:function(){this._super();var i,j;for(i=0;i<this._numLayers;i++)for(j=0;j<this.layers[i].renderers.length;j++)this.layers[i].renderers[j].hide();this.baseMapLayer&&(this.baseMapLayer.hideComponent(),onBaseMapAttributionChange.call(this))},hasVisibleLayer:function(){for(var i=0;i<this._numLayers;i++)if(this.layers[i].show)return!0;return!1},hasVisibleBaseLayer:function(){return this.baseMapLayer&&this.baseMapLayer.show},isVisible:function(layoutMode){return this._super(layoutMode)&&this.rect&&this.rect.width>0&&this.rect.height>0},clear:function(){for(var i=0;i<this._numLayers;i++)this.layers[i].clear()},release:function(){for(var i=0;i<this._numLayers;i++)this.layers[i].release();this.baseMapLayer&&(this.baseMapLayer.release(),this.baseMapLayer.stopListen("attributionChanged"),this.baseMapLayer.stopListen("baseLayerChanged")),this.map=null,this.baseMapLayer=null,this.backendApi=null},setGlobalOpacity:function(x,skipInvalidation){this._globalAlpha=x;for(var i=0;i<this._numLayers;i++)this.layers[i].setGlobalOpacity(x,skipInvalidation)},updateSelectableShapes:function(){if(0!==this._numLayers){var i,shapes,result;for(result=this.layers[0].getSelectableShapes(),i=1;i<this._numLayers;i++)shapes=this.layers[i].getSelectableShapes(),shapes&&shapes.length>0&&(result=result.concat(shapes));this.setSelectableShapes(result)}},paint:function(layoutMode,data){var dfds=[];if(!this.layersReady||!data)return Deferred.resolve();this._super(layoutMode,data);for(var i=0;i<this._numLayers;i++)this.layers[i].invalidateProperties("MapArea.paint"),dfds.push(this.layers[i].invalidateDisplay("MapArea.paint"));return this.baseMapLayer&&dfds.push(this.baseMapLayer.invalidateDisplay("MapArea.paint")),Deferred.all(dfds)},setPreselectionMode:function(b){this._preselectionMode=b;for(var i=0;i<this._numLayers;i++)this.layers[i].setPreselectionMode(b)},_updateProperties:function(){this._data&&this.invalidateDisplay("MapArea._updateProperties")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=$(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute",overflow:"hidden"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container),this.layersContainer=document.createElement("div"),this._$layersContainerWrap=$(this.layersContainer),this._$layersContainerWrap.css({position:"absolute",width:"100%",height:"100%"}),this.container.appendChild(this.layersContainer))}}),Object.defineProperty(MapArea.prototype,"className",{value:"MapArea"}),MapArea}),define("client.property-panel/default-sorting-properties",["general.utils/property-resolver"],function(propertyResolver){var sortEnumerationOptions=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData,handler){return itemData.qDef.autoSort?handler.autoSortDimension(itemData).then(function(){}):void 0}},dimension:{component:"sorting-dimension",type:"items",ref:"",items:{dimensionDefinition:{type:"items",grouped:!0,items:{expression:{type:"items",items:{expressionToggled:{type:"boolean",ref:"qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qSortByExpression",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByExpression",0)}}}},frequency:{type:"items",show:!1,items:{frequencyToggled:{type:"boolean",ref:"qSortByFrequency",translation:"properties.sorting.sortByFrequency",resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qSortByFrequency",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByFrequency",0)}}}},numeric:{type:"items",items:{numericToggled:{type:"boolean",ref:"qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortByNumeric",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByNumeric",0)}}}},ascii:{type:"items",items:{asciiToggled:{type:"boolean",ref:"qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortByAscii",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(itemData){return!(itemData.qSortByAscii||itemData.qSortByNumeric||itemData.qSortByExpression||itemData.qSortByFrequency)}}}}}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData,handler){return itemData.qDef.autoSort?handler.autoSortMeasure(itemData).then(function(){}):void 0}},numeric:{type:"items",show:function(itemData){return!itemData.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qSortBy.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByNumeric",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortBy.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(itemData){return!itemData.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qSortBy.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByAscii",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortBy.qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(itemData){var sortings;return itemData.qDef.autoSort?!1:(sortings=propertyResolver.getValue(itemData,"qSortBy",{}),sortings.qSortByAscii||sortings.qSortByNumeric||sortings.qSortByFrequency?!1:!0)}}}}}}}),define("general.utils/number-formatting",["util"],function(util){function getnDecPattern(type,nDec,decimalSep,thousandSep,localeInfo){void 0===decimalSep&&(decimalSep=localeInfo.qDecimalSep),void 0===thousandSep&&(thousandSep=localeInfo.qThousandSep);var start,end,i,n,fmt="";if("F"===type)if(0===nDec)fmt="#"+thousandSep+"##0";else for(fmt="#"+thousandSep+"##0"+decimalSep,i=0;nDec>i;++i)fmt+="0";else{for(i=0;nDec>i;++i)fmt+="#";nDec>3&&(n=fmt.length,start=fmt.substring(0,n-3),end=fmt.substr(n-3),fmt=start+thousandSep+end)}return fmt}var UNDEF;return{setNumFmtPattern:function(ref,numFormat,localeInfo){var separators,attr={type:numFormat.qType||"U",nDec:"qType"===ref?("F"===numFormat.qType,2):"R"===numFormat.qType?numFormat.qnDec||10:"number"==typeof numFormat.qnDec?Math.max(0,numFormat.qnDec):2,thousandSep:numFormat.qThou,decimalSep:numFormat.qDec};separators=this._getSeparators(ref,"M"===numFormat.qType,attr.decimalSep,attr.thousandSep,localeInfo),separators.decimal!==UNDEF&&(attr.decimalSep=separators.decimal),separators.thousand!==UNDEF&&(attr.thousandSep=separators.thousand),numFormat.qType=attr.type,numFormat.qnDec=attr.nDec,numFormat.qDec=attr.decimalSep,numFormat.qThou=attr.thousandSep,numFormat.qFmt=this._getPattern(attr.type,attr.nDec,attr.decimalSep,attr.thousandSep,localeInfo),["D","T","TS","IV"].indexOf(attr.type)>=0&&(numFormat.qDec="",numFormat.qThou="")},_getSeparators:function(ref,isMoney,decimalSep,thousandSep,localeInfo){var dec=decimalSep,thou=thousandSep,sepType="q"+(isMoney?"Money":"");return"qType"===ref?(thou=localeInfo[sepType+"ThousandSep"]||"",dec=localeInfo[sepType+"DecimalSep"]||"."):"qThou"===ref&&void 0===thousandSep?(thou=localeInfo[sepType+"ThousandSep"]||"",dec=decimalSep||"."):"qDec"!==ref||void 0!==decimalSep&&""!==decimalSep||(dec=localeInfo[sepType+"DecimalSep"]||".",thou=thousandSep||""),{decimal:dec||".",thousand:thou||""}},_getPattern:function(type,nDec,decimalSep,thousandSep,localeInfo){var f;switch(type){case"U":return"";case"I":return"#"+thousandSep+"##0";case"R":case"F":return this.getNDecPattern("F",nDec,decimalSep,thousandSep,localeInfo);case"M":return f=localeInfo.qMoneyFmt,localeInfo.qMoneyDecimalSep&&(f=f.replace(new RegExp(util.escapeRegExp(localeInfo.qMoneyDecimalSep),"g"),decimalSep)),localeInfo.qMoneyThousandSep&&(f=f.replace(new RegExp(util.escapeRegExp(localeInfo.qMoneyThousandSep),"g"),thousandSep)),f;case"D":return localeInfo.qDateFmt;case"T":return localeInfo.qTimeFmt;case"TS":return localeInfo.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(fmt,localeInfo){return getnDecPattern("F",2,fmt.qDec,fmt.qThou||"",localeInfo)},getNDecPattern:getnDecPattern,getNormalizedFormat:function(numFormatObject,pattern){var temp=numFormatObject.qDec+numFormatObject.qThou;return/\u00a0/.test(temp)&&!/\u0020/.test(temp)?pattern.replace(/\u0020/g," "):pattern}}}),define("client.property-panel/default-properties",["general.utils/property-resolver","client.property-panel/default-sorting-properties","general.utils/number-formatting","translator","core.utils/theme","general.utils/string-limits","util","client.utils/default-property-logic"],function(propertyResolver,defaultSortingProperties,numberFormat,translator,theme,stringLimits,util,propertyLogicModule){function isDefaultFormatPattern(itemData,options){return propertyResolver.getValue(itemData,"qDef.qNumFormat.qFmt")===numberFormat.getDefaultNumericFormat(itemData.qDef.qNumFormat,options?options.localeInfo:"")}function isFormatPatternInputVisible(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return["R","M","IV"].contains(type)||"U"!==type&&propertyResolver.getValue(itemData,"qDef.numFormatFromTemplate",!0)===!1}var defaults={sorting:defaultSortingProperties,"dimensions-sorting":defaultSortingProperties.items.dimensions,"measures-sorting":defaultSortingProperties.items.measures},propertyLogic=propertyLogicModule.getLogicFor("hard","default");return defaults.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(data){return data.showTitles!==!1},items:{title:{translation:"Common.Title",type:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}}}},defaults.metadata={type:"items",translation:"properties.metadata",schemaIgnore:!0,show:function(data){return"masterobject"===data.qInfo.qType},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"qMetaDef.title",minlength:1,rollbackInvalid:!0,show:function(data){return data.qMetaDef}},description:{translation:"Common.Description",type:"string",component:"textarea",ref:"qMetaDef.description",maxlength:stringLimits.description,show:function(data){return data.qMetaDef}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"qMetaDef.tags",show:function(data){return data.qMetaDef}}}},defaults.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:defaults.metadata,general:defaults.general}},defaults.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},defaults.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(itemData){return itemData.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(itemData){return!itemData.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",readOnly:function(itemData,handler){return 0===handler.getMeasures().length},change:function(itemData){var limit,otherMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===otherMode?(limit=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherLimit.qv","0"),limit.length&&"%"!==limit[limit.length-1]&&util.isNumeric(limit)&&(itemData.qOtherTotalSpec.qOtherLimit||propertyResolver.setValue(itemData,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),itemData.qOtherTotalSpec.qOtherLimit.qv=limit+"%")):"OTHER_ABS_LIMITED"===otherMode&&(limit=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherLimit.qv","0"),limit.length&&"%"===limit[limit.length-1]&&(itemData.qOtherTotalSpec.qOtherLimit||propertyResolver.setValue(itemData,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),itemData.qOtherTotalSpec.qOtherLimit.qv=limit.substr(0,limit.length-1)))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"Common.Top"},{value:"OTHER_SORT_ASCENDING",translation:"Common.Bottom"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(itemData,handler){return"OTHER_COUNTED"===propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(itemData,handler){return"OTHER_COUNTED"===propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(itemData,handler){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===limitMode||"OTHER_REL_LIMITED"===limitMode)&&handler.getMeasures().length>0}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(itemData,handler){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===limitMode||"OTHER_REL_LIMITED"===limitMode)&&handler.getMeasures().length>0}},calculatedAgainstMessage:{component:"text",label:function(itemData,handler){var measure=handler.getMeasureLayouts()[0];return measure?translator.get("Properties.DimensionLimits.CalculatedAgainst",measure.qFallbackTitle):translator.get("Properties.DimensionLimits.NoMeasure")},show:function(itemData){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return"OTHER_OFF"!==limitMode}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(itemData,handler){return"OTHER_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return translator.get("properties.dimensionLimits.others")},show:function(itemData,handler){return!propertyResolver.getValue(itemData,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}}}}}},defaults.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(itemData){return itemData.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(itemData){return!itemData.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",
type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"}],change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qType",itemData.qDef.qNumFormat,options.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(data){return["F","D","TS","T"].contains(propertyResolver.getValue(data,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(type)&&propertyResolver.getValue(itemData,"qDef.numFormatFromTemplate",!0)===!0}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"R"===type},change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qDec",itemData.qDef.qNumFormat,options.localeInfo)},invalid:function(itemData){return propertyResolver.getValue(itemData,"qDef.qNumFormat.qDec")===propertyResolver.getValue(itemData,"qDef.qNumFormat.qThou")},readOnly:function(itemData,handler,properties,options){return!isDefaultFormatPattern(itemData,options)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"R"===type},change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qThou",itemData.qDef.qNumFormat,options.localeInfo)},invalid:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"I"===type?!1:propertyResolver.getValue(itemData,"qDef.qNumFormat.qDec")===propertyResolver.getValue(itemData,"qDef.qNumFormat.qThou")},readOnly:function(itemData,handler,properties,options){return!isDefaultFormatPattern(itemData,options)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",show:function(itemData){return isFormatPatternInputVisible(itemData)},change:function(itemData){itemData.qDef.qNumFormat.qFmt=numberFormat.getNormalizedFormat(itemData.qDef.qNumFormat,itemData.qDef.qNumFormat.qFmt)},invalid:function(itemData,props,options){if(["D","T","TS","IV"].contains(itemData.qDef.qNumFormat.qType))return!1;var decimalDelimiter="R"===itemData.qDef.qNumFormat.qType?itemData.qDef.qNumFormat.qDec:options.localeInfo["q"+("M"===itemData.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],r=new RegExp("(0|#)"+util.escapeRegExp(decimalDelimiter)+"0*#*"),fmt=(itemData.qDef.qNumFormat.qFmt||"").split(";"),posMatch=fmt[0].match(r),posNum=posMatch&&posMatch[0]?posMatch[0].length-2:0,negMatch=fmt[1]?fmt[1].match(r):null,negNum=negMatch&&negMatch[0]?negMatch[0].length-2:0;return posNum>15||negNum>15}}}}}},defaults.measureAxis={type:"items",label:translator.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},dock:{type:"string",component:"dropdown",ref:"measureAxis.dock",translation:"Common.Position",defaultValue:"near",options:function(data){var nearStr,farStr;return"horizontal"===data.orientation?(nearStr="Common.Bottom",farStr="Common.Top"):(nearStr="properties.dock.left",farStr="properties.dock.right"),[{value:"near",translation:nearStr},{value:"far",translation:farStr}]},show:function(data){return data.measureAxis&&"none"!==data.measureAxis.show}},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],show:function(data){return data.measureAxis&&"none"!==data.measureAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(data){return data.measureAxis&&!data.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(data){return data.measureAxis&&["min","minMax"].contains(data.measureAxis.minMax)&&!data.measureAxis.autoMinMax},invalid:function(data){return data.measureAxis&&"minMax"===data.measureAxis.minMax?data.measureAxis.min>=data.measureAxis.max:!1}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(data){return data.measureAxis&&["max","minMax"].contains(data.measureAxis.minMax)&&!data.measureAxis.autoMinMax},invalid:function(data){return data.measureAxis&&"minMax"===data.measureAxis.minMax?data.measureAxis.min>=data.measureAxis.max:!1}}}}}},defaults.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},color:{ref:"color",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:2},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:0,change:function(itemData){var refLine=itemData.refLineExpr;"object"==typeof refLine.value?refLine.label={qStringExpression:{qExpr:refLine.value.qValueExpression.qExpr}}:refLine.label=""+refLine.value}},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",expressionType:"StringExpression",defaultValue:"0",show:!1}}},defaults.dataHandling={type:"items",translation:"properties.dataHandling",grouped:!0,items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},calcCond:{type:"items",items:{expr:{ref:"qHyperCubeDef.qCalcCond",type:"string",component:"expression",expressionType:"ValueExpr",translation:"properties.hyperCube.calcCond"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",translation:"properties.hyperCube.calcCondMessage",show:function(data){var val=propertyResolver.getValue(data,"qHyperCubeDef.qCalcCond");return val.qv&&""!==val.qv}}}}}},defaults.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:propertyLogic.color.colorMode.options,defaultValue:"primary",show:propertyLogic.color.colorMode.show},singleColor:{ref:"color.singleColor",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:3,show:propertyLogic.color.singleColor.show},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:propertyLogic.color.persistentColors.show,readOnly:propertyLogic.color.persistentColors.readOnly},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:propertyLogic.color.attributeExpression.change,globalChange:propertyLogic.color.attributeExpression.globalChange,translation:"Common.Expression",show:propertyLogic.color.attributeExpression.show},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:propertyLogic.color.expressionIsColor.show},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:propertyLogic.color.expressionLabel.change,show:propertyLogic.color.expressionLabel.show},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"sg",items:[{colors:theme.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[0].translation||theme.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:theme.colorSchemes.ordinalScales[1].scale[theme.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[1].translation||theme.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:theme.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[2].translation||theme.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:theme.colorSchemes.ordinalScales[3].scale[theme.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[3].translation||theme.colorSchemes.ordinalScales[3].name,value:"dc"}],show:propertyLogic.color.colorSchemeMeasure.show},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:propertyLogic.color.reverseScheme.show},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"12",items:[{colors:theme.colorSchemes.qualitativeScales[0].scale[theme.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[0].translation||theme.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:theme.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[1].translation||theme.colorSchemes.qualitativeScales[1].name,value:"100"}],show:propertyLogic.color.colorSchemeDimension.show},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:propertyLogic.color.customRange.autoMinMax.show},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:propertyLogic.color.customRange.min.show,invalid:propertyLogic.color.customRange.min.invalid},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:propertyLogic.color.customRange.max.show,invalid:propertyLogic.color.customRange.max.invalid}},show:propertyLogic.color.customRange.show}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:propertyLogic.legend.show},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:propertyLogic.legend.dock.show},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:propertyLogic.legend.showTitle.show}}}}},defaults.data={type:"items",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:defaults.dimensions,measures:defaults.measures}},defaults}),define("general.utils/property-mapper",["client.property-panel/default-properties","general.utils/property-resolver","util"],function(defaultDefinition,propertyResolver,util){function findDefinition(definition,ref,deep){var keys,item,i,subdefinition=null;if(definition.ref===ref)return definition;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;++i){if(item=definition.items[keys[i]],item.ref===ref){subdefinition=item;break}if(deep&&(subdefinition=findDefinition(item,ref,deep),null!==subdefinition))break}return subdefinition}function mapDefinition(definition,type,usesDefinition){var mappedDefinition,items,defaults;if(usesDefinition=usesDefinition||defaultDefinition,definition||(definition=nonExistingDefinition),type&&definitionCache[type])return definitionCache[type];if(definition.uses){if(defaults=usesDefinition[definition.uses],!defaults)throw"No defaults found for: "+definition.uses;definition=util.extend(!0,{},defaults,definition)}return propertyResolver.isHierarchical(definition)?(items={},Object.keys(definition.items).forEach(function(key){definition.items[key]&&(items[key]=mapDefinition(definition.items[key],null,usesDefinition))}),mappedDefinition=util.extend({},definition,{items:items})):"array"===definition.type&&definition.items?(items={},Object.keys(definition.items).forEach(function(key){definition.items[key]&&(items[key]=mapDefinition(definition.items[key],null,usesDefinition))}),mappedDefinition=util.extend({},definition,{items:items})):mappedDefinition=util.extend({},definition),type&&!definitionCache[type]&&(definitionCache[type]=mappedDefinition),mappedDefinition}function mapProperties(definition,properties,type){var mappedDefinition=mapDefinition(definition,type);return properties?util.extend(!0,propertyResolver.getDefaults(mappedDefinition),properties):propertyResolver.getDefaults(mappedDefinition)}function getPropertyHierarchy(mappedDefinition){function getHierarchy(definition){function isArrayRef(ref){return-1!==ref.search(/\.\d/g)}function getLeafDescription(d){var description={type:d.type,defaultValue:propertyResolver.getDefaultValue(d.type,d)};return d.maxlength&&(description.maxlength=d.maxlength),d.min&&(description.min=d.min),d.max&&(description.max=d.max),d.expression&&(description.expression=d.expression),d.options&&"boolean"!==d.type&&(description["enum"]=d.options.map(function(option){return option.value})),description}function traverse(definition){var keys,key,item,listHierarchy,i,description;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;i++)key=keys[i],item=definition.items[key],traverse(item);else definition.ref&&"array"===definition.type&&definition.items?(listHierarchy=getHierarchy({type:"items",items:definition.items}),description={type:"array",items:listHierarchy},isArrayRef(definition.ref)||propertyResolver.setValue(hierarchy,definition.ref,description)):definition.ref&&(description=getLeafDescription(definition),isArrayRef(definition.ref)||propertyResolver.setValue(hierarchy,definition.ref,description))}var hierarchy={};return traverse(definition),hierarchy}return getHierarchy(mappedDefinition)}function findSnapshotProperties(mappedDefinition){function find(definition){var keys,item,i;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;++i)item=definition.items[keys[i]],item.snapshot&&result.push(item),find(item)}var result=[];return find(mappedDefinition),result}function findGlobalListeners(definition,type){function find(def){def.globalChange&&result.push(def.globalChange),"items"!==def.type&&"array"!==def.type||!def.items||Object.keys(def.items).forEach(function(key){def.items[key]&&find(def.items[key])})}if(type&&listenerCache[type])return listenerCache[type];var result=[];return find(definition),type&&!listenerCache[type]&&(listenerCache[type]=result),result}var nonExistingDefinition,definitionCache={},listenerCache={};return nonExistingDefinition={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:findDefinition,findSnapshotProperties:findSnapshotProperties,findGlobalListeners:findGlobalListeners,mapDefinition:mapDefinition,mapProperties:mapProperties,getPropertyHierarchy:getPropertyHierarchy}}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util"],function(Class,util){"use strict";var DataPropertyHandler,notSupported;return notSupported="Not supported in this object, need to implement in subclass.",DataPropertyHandler=Class.extend({init:function(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties){this.dimensionDefinition=dimensionDefinition||{max:0},this.measureDefinition=measureDefinition||{max:0},dimensionDefinition&&(this.dimensionProperties=dimensionProperties||{}),measureDefinition&&(this.measureProperties=measureProperties||{})},setProperties:function(properties){this.properties=properties},setLayout:function(layout){this.layout=layout},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(id){var dimensions=this.getDimensions(),i=0;for(i;i<dimensions.length;++i)if(dimensions[i].qDef.cId===id)return dimensions[i];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0},maxMeasures:function(){return"function"==typeof this.measureDefinition.max?this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},getMeasures:function(){return[]},getMeasure:function(id){var measures=this.getMeasures(),i=0;for(i;i<measures.length;++i)if(measures[i].qDef.cId===id)return measures[i];return null},addDimension:function(){throw notSupported},getSorting:function(){throw notSupported},addFieldDimension:function(field,label,defaults){var dimension=this.createFieldDimension(field,label,defaults);return this.addDimension(dimension)},addLibraryDimension:function(id,defaults){var dimension=this.createLibraryDimension(id,defaults);return this.addDimension(dimension)},addMeasure:function(){throw notSupported},addExpressionMeasure:function(expression,label,defaults){var measure=this.createExpressionMeasure(expression,label,defaults);return this.addMeasure(measure)},addLibraryMeasure:function(id,defaults){var measure=this.createLibraryMeasure(id,defaults);return this.addMeasure(measure)},replaceDimension:function(){throw notSupported},replaceMeasure:function(){throw notSupported},autoSortDimension:function(){throw notSupported},autoSortMeasure:function(){throw notSupported},createFieldDimension:function(field,label,defaults){var dimension=util.extend(!0,{},this.dimensionProperties||{},defaults||{});return dimension.qDef||(dimension.qDef={}),dimension.qOtherTotalSpec||(dimension.qOtherTotalSpec={}),field?(dimension.qDef.qFieldDefs=[field],label?dimension.qDef.qFieldLabels=[label]:dimension.qDef.qFieldLabels=[""],dimension.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(dimension.qDef.qFieldDefs=[],dimension.qDef.qFieldLabels=[],dimension.qDef.qSortCriterias=[]),dimension.qDef.autoSort=!0,dimension},createLibraryDimension:function(id,defaults){var dimension=util.extend(!0,{},this.dimensionProperties||{},defaults||{});return dimension.qDef||(dimension.qDef={}),dimension.qOtherTotalSpec||(dimension.qOtherTotalSpec={}),dimension.qLibraryId=id,dimension.qDef.qSortCriterias=[{qSortByLoadOrder:1}],dimension.qDef.autoSort=!0,delete dimension.qDef.qFieldDefs,delete dimension.qDef.qFieldLabels,dimension},createExpressionMeasure:function(expression,label,defaults){var measure=util.extend(!0,{},this.measureProperties||{},defaults||{});return measure.qDef||(measure.qDef={}),measure.qDef.qNumFormat||(measure.qDef.qNumFormat={}),measure.qDef.qDef=expression,measure.qDef.qLabel=label,measure.qDef.autoSort=!0,measure},createLibraryMeasure:function(id,defaults){var measure=util.extend(!0,{},this.measureProperties||{},defaults||{});return measure.qDef||(measure.qDef={}),measure.qDef.qNumFormat||(measure.qDef.qNumFormat={}),measure.qLibraryId=id,measure.qDef.autoSort=!0,delete measure.qDef.qDef,delete measure.qDef.qLabel,measure},getDimensionLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(cId){return this.getDimensionLayouts().filter(function(item){return cId===item.cId})[0]},getMeasureLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(cId){return this.getMeasureLayouts().filter(function(item){return cId===item.cId})[0]},removeDimension:function(){throw notSupported},removeMeasure:function(){throw notSupported},moveDimension:function(){throw notSupported},moveMeasure:function(){throw notSupported},changeSorting:function(){throw notSupported}})}),define("extensions.qliktech/map/map-handler",["objects.utils/data-properties/data-property-handler","core.utils/deferred","general.utils/array-util","util"],function(DataPropertyHandler,Deferred,arrayUtils,util){"use strict";function addPolygon1Layer(){var cId=util.generateId(),polygonLayer={type:"polygon",cId:cId,show:!0,opacity:1,qListObjectDef:{qDef:{qGrouping:"N",qFieldDefs:[],qFieldLabels:[],qSortCriterias:[],qNumberPresentations:[]},qFrequencyMode:"N",qShowAlternatives:!0,qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:maxNumberOfItems}],qExpressions:[{qExpr:""},{qExpr:"",geoType:"polygon"}]}};return this.properties.layers.push(polygonLayer),polygonLayer}function addPolygon3Layer(){var cId=util.generateId(),polygonLayer={type:"polygon",version:"3",cId:cId,show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[{qDef:{qDef:""}}],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:maxNumberOfItems}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},geodata:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage}},measureDef:""};return this.properties.layers.push(polygonLayer),polygonLayer}function getFirstValidLayer(layers){var i,layer,numLayers=layers?layers.length:0;for(i=0;numLayers>i;i++){if(layer=layers[i],layer.qHyperCubeDef&&layer.qHyperCubeDef.qDimensions&&1===layer.qHyperCubeDef.qDimensions.length&&layer.qHyperCubeDef.qDimensions[0].qDef&&(layer.qHyperCubeDef.qDimensions[0].qLibraryId||layer.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0]))return layer;if(layer.qHyperCubeDef&&layer.qHyperCubeDef.qDimensions&&2===layer.qHyperCubeDef.qDimensions.length&&layer.qHyperCubeDef.qDimensions[0].qDef&&(layer.qHyperCubeDef.qDimensions[0].qLibraryId||layer.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0])&&layer.qHyperCubeDef.qDimensions[1].qDef&&layer.qHyperCubeDef.qDimensions[1].qDef.qFieldDefs[0])return layer;if(layer.qListObjectDef&&(layer.qListObjectDef.qLibraryId||layer.qListObjectDef.qDef&&layer.qListObjectDef.qDef.qFieldDefs&&layer.qListObjectDef.qDef.qFieldDefs.length&&layer.qListObjectDef.qDef.qFieldDefs[0]))return layer}}function switchToColorByMeasure(){var color=this.properties.color;color.auto&&"primary"===color.mode&&(color.auto=!1,color.mode="byMeasure")}function createPolygonExpression(field){var tags,name,projection="";return tags=void 0===field.tags?field.qTags:field.tags,name=void 0===field.name?field.qName:field.name,name="["+name+"]",tags&&tags.indexOf("$mercator")>-1&&(projection="$mercator"),{qExpr:"GeoReduceGeometry({1}"+name+")",geoType:"polygon",projection:projection}}function createMeasureFromField(field){var expression=createPolygonExpression(field),expr=expression.qExpr,measure=this.createExpressionMeasure(expr,expr);return measure.qDef.projection=expression.projection,measure.qDef.qAggrFunc="None",measure.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},measure}function setSubProperty(sub,splits,prop){var i,p;for(i=0;i<splits.length&&(p=splits[i],i!==splits.length-1);++i)sub&&(sub[p]||(sub[p]={}),sub=sub[p]);sub&&(sub[p]=prop)}var MapHandler,defaultDimensionProperties,autoSortCriterias,maxNumberOfItems=3333;return autoSortCriterias=[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}],defaultDimensionProperties={qDef:{qFieldDefs:[],qFieldLabels:[],qSortCriterias:[]}},MapHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,dimensionListLayout){this._super(dimensionDefinition,null,dimensionListLayout,null),this.dimensionProperties=this.autoSortDimension(defaultDimensionProperties)},rippleToHyperCubes:function(propPath,prop){var j,layer,splits=propPath.split(".");for(j=0;j<this.properties.layers.length;++j)layer=this.properties.layers[j],setSubProperty(layer.qHyperCubeDef,splits,prop),layer.geodata&&setSubProperty(layer.geodata.qHyperCubeDef,splits,prop)},setProperties:function(properties){properties&&properties.layers&&properties.layers[0]&&"point"===properties.layers[0].type&&properties.color&&properties.color.persistent===!1&&(properties.color.persistent=!0),this._super(properties)},getDimensions:function(layer){if(layer||(layer=getFirstValidLayer(this.properties.layers)),!layer)return[];if(layer.qHyperCubeDef)return layer.qHyperCubeDef.qDimensions;if(layer.qListObjectDef){var def=layer.qListObjectDef.qDef;return def&&def.qFieldDefs&&def.qFieldDefs.length||layer.qListObjectDef.qLibraryId?[layer.qListObjectDef]:[]}return[]},getMeasures:function(layer){if(layer||(layer=getFirstValidLayer(this.properties.layers)),!layer)return[];if(layer.qHyperCubeDef){if("polygon"!==layer.type)return layer.qHyperCubeDef.qMeasures;var qMeasures=layer.qHyperCubeDef.qMeasures;if(qMeasures&&qMeasures[0]&&(qMeasures[0].qLibraryId||qMeasures[0].qDef&&void 0!==qMeasures[0].qDef.qDef&&""!==qMeasures[0].qDef.qDef.trim()))return[qMeasures[0]]}return layer.qListObjectDef&&layer.qListObjectDef.qExpressions&&layer.qListObjectDef.qExpressions[0]&&(layer.qListObjectDef.qExpressions[0].qExpr||layer.qListObjectDef.qExpressions[0].qLibraryId)?[layer.qListObjectDef.qExpressions[0]]:[]},getLayerType:function(layer){return layer||(layer=getFirstValidLayer(this.properties.layers)),layer?layer.type:void 0},getLayerTypeAndVersion:function(layer){return layer||(layer=getFirstValidLayer(this.properties.layers)),layer?[layer.type,layer.version]:[void 0,void 0]},addPointLayer:function(){var cId=util.generateId(),pointLayer={type:"point",cId:cId,show:!0,opacity:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:3,qHeight:maxNumberOfItems}],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},useSize:!0,bubbleSizes:8,rangeBubbleSizes:[2,32],autoMinMax:!0,customMin:0,customMax:10};return this.properties.layers.push(pointLayer),void 0===this.properties.background&&(this.properties.background={}),this.properties.background.show=!0,void 0===this.properties.color&&(this.properties.color={}),this.properties.color.persistent=!0,pointLayer},addPolygonLayer:function(version){return version&&""!==version?addPolygon3Layer.call(this):addPolygon1Layer.call(this)},autoSortDimension:function(dimension){return Deferred.resolve(MapHandler.autoSortDimension(dimension))},createFieldDimension:function(field){var dimension=util.extend(!0,{},defaultDimensionProperties);return dimension.qDef.qFieldDefs[0]=field,dimension.qDef.qFieldLabels[0]="",dimension},getLayers:function(){return this.properties.layers},getLayersWithoutMeasure:function(){return this.properties.layers.filter(function(layer){switch(layer.type){case"polygon":if(layer.qHyperCubeDef){var qMeasures=qMeasures;return!(qMeasures&&qMeasures[0]&&(qMeasures[0].qDef&&qMeasures[0].qDef.qDef||qMeasures[0].qLibraryId))}return!layer.qListObjectDef.qExpressions[0].qExpr&&!layer.qListObjectDef.qExpressions[0].qLibraryId;case"point":return!layer.qHyperCubeDef.qMeasures.length}return!1})},addHypercubeDimension:function(dimension,layer){var dimensions=this.getDimensions(layer);return dimension.qDef.cId||(dimension.qDef.cId=util.generateId()),dimensions.length<2&&(dimensions.push(dimension),arrayUtils.indexAdded(layer.qHyperCubeDef.qInterColumnSortOrder,dimensions.length-1)),"polygon"===layer.type&&"3"===layer.version&&(dimensions=layer.geodata.qHyperCubeDef.qDimensions,dimension=util.extend(!0,{},dimension),dimension.qDef.cId=util.generateId(),dimensions.length<2&&dimensions.push(dimension)),Deferred.resolve(dimension)},addListObjectDimension:function(dimension,layer){return layer.qListObjectDef=util.extend(!0,layer.qListObjectDef,dimension),dimension},addDimension:function(dimension){var layer,n=this.properties.layers.length;if(n>0){if(layer=this.properties.layers[n-1],layer.qListObjectDef)return this.addListObjectDimension(dimension,layer);if(layer.qHyperCubeDef)return this.addHypercubeDimension(dimension,layer)}return Deferred.resolve(dimension)},replaceDimension:function(index,dimension){var layer,dimensions,oldDimension,newDef,n=this.properties.layers.length;return n>0&&(layer=this.properties.layers[n-1],layer.qListObjectDef?(newDef=util.extend(!0,layer.qListObjectDef,dimension),dimension.qLibraryId?(delete newDef.qDef.qFieldDefs,delete newDef.qDef.qFieldLabels):delete newDef.qLibraryId,this.properties.layers[n-1].qListObjectDef=newDef):layer.qHyperCubeDef&&(dimensions=this.getDimensions(layer),
oldDimension=dimensions[index],dimension.qDef.cId=util.generateId(),dimensions[index]=dimension,"function"==typeof this.dimensionDefinition.replace&&this.dimensionDefinition.replace.call(null,dimension,oldDimension,index,this.properties,this))),Deferred.resolve(dimension)},removeDimension:function(){},getDimensionLayout:function(){var layers=this.layout?this.layout.layers:void 0;return layers&&1===layers.length&&layers[0].qListObject&&layers[0].qListObject.qDimensionInfo?layers[0].qListObject.qDimensionInfo:""},hasPolygonData:function(){var i,qExpressions=this.properties.layers[0].qListObjectDef.qExpressions;for(i=0;i<qExpressions.length;++i)if("polygon"===qExpressions[i].geoType.toLowerCase())return!0;return!1},addFieldAsGeoPolygonField:function(field){var layer=this.properties.layers[this.properties.layers.length-1];layer.qListObjectDef?layer.qListObjectDef.qExpressions[1]=createPolygonExpression(field):layer.geodata.qHyperCubeDef.qMeasures[0]=createMeasureFromField.call(this,field)},addMeasureToPolygonLayer:function(layer,measure){layer.qListObjectDef?layer.qListObjectDef.qExpressions[0]=measure:(measure.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},measure.qDef.qAggrFunc="None",layer.qHyperCubeDef.qMeasures[0]=measure,layer.measureDef=measure.qDef.qDef),switchToColorByMeasure.call(this)},addMeasureToPointLayer:function(layer,measure){measure.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},layer.qHyperCubeDef.qMeasures.length?layer.qHyperCubeDef.qMeasures[0]=measure:(layer.qHyperCubeDef.qMeasures.push(measure),layer.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2)),switchToColorByMeasure.call(this)},addMeasure:function(measure){var expr={qExpr:measure.qDef.qDef},qExpressions=this.properties.layers[0].qListObjectDef.qExpressions;return this.hasPolygonData()?qExpressions[0]&&"polygon"!==qExpressions[0].geoType.toLowerCase()?qExpressions[0]=expr:qExpressions.splice(qExpressions.length-2,0,expr):0===qExpressions.length?qExpressions.push(expr):qExpressions[0]=expr,Deferred.resolve(measure)}}),MapHandler.autoSortDimension=function(dimension){return dimension.qDef.qSortCriterias=util.extend(!0,[],autoSortCriterias),dimension},MapHandler}),define("extensions.qliktech/map/map-util",["general.utils/array-util"],function(arrayUtil){function getAndRemoveFieldsInsideSquareBrackets(str){var tokens1,tokens2,i,fields=[],rest=[];if(tokens1=str.split("["),tokens1.length>1){for(i=0;i<tokens1.length;i++)tokens2=tokens1[i].split("]"),tokens2.length>1&&(fields=fields.concat(tokens2.splice(0,1))),rest=rest.concat(tokens2);rest=rest.join(" ")}else rest=str;return{fields:fields,rest:rest}}function extendArchipelagos(a1,a2){for(var fieldName in a2)(!a1[fieldName]||a1[fieldName].distance>a2[fieldName].distance)&&(a1[fieldName]=a2[fieldName])}var mapUtil={extract2FieldNamesOfGeoMakePoint:function(exp){var result,tokens1,rest,str,tokens2,i,separators,tokens,token,c;for(result=getAndRemoveFieldsInsideSquareBrackets(exp),tokens1=result.fields,rest=result.rest,str=rest.replace("("," ( "),tokens2=str.split(" "),i=0;i<tokens2.length;)""===tokens2[i]?tokens2.splice(i,1):i++;for(i=0;i<tokens2.length-1;)"("===tokens2[i+1]?tokens2.splice(i,1):i++;for(str=tokens2.join(""),separators=[",","\\+","-","\\(","\\)","\\*","/","=","\\>","\\<"],separators.join("|"),tokens2=str.split(new RegExp(separators.join("|"),"g")),i=0;i<tokens2.length;)""===tokens2[i]?tokens2.splice(i,1):i++;for(tokens=tokens1.concat(tokens2),i=0;i<tokens.length;i++)token=tokens[i],c=token.substring(0,1),('"'===c||"'"===c)&&(token=token.substring(1)),c=token.substring(token.length-1),('"'===c||"'"===c)&&(token=token.substring(0,token.length-1)),tokens[i]=token;return tokens},findFieldsInGeoMakePointFunction:function(exp,fieldList){var i,terms=this.extract2FieldNamesOfGeoMakePoint(exp),n=fieldList?fieldList.length:0,m=terms?terms.length:0,fields=[],dic={};for(i=0;n>i;i++)dic[fieldList[i].qName]=i;for(i=0;m>i;i++)void 0!==dic[terms[i]]&&(fields[fields.length]=fieldList[dic[terms[i]]]);return fields},isGeoMakePointField:function(field){return this.isGeoMakePointExpression(field.qName)},isGeoMakePointExpression:function(exp){var tokens,k,str=exp.split("(")[0],separators=["="," "];for(separators.join("|"),tokens=str.split(new RegExp(separators.join("|"),"g")),k=0;k<tokens.length;)""===tokens[k]?tokens.splice(k,1):k++;return tokens&&1===tokens.length&&"geomakepoint"===tokens[0].toLowerCase()},isNormalGeoField:function(field){return mapUtil.isNormalGeoPointField(field)||mapUtil.isGeoPolygonField(field)},isNormalGeoPointField:function(field){return field.qTags.indexOf("$geopoint")>-1},isGeoField:function(field){return mapUtil.isGeoPointField(field)||mapUtil.isGeoPolygonField(field)},isGeoPointField:function(field){return this.isNormalGeoPointField(field)||this.isGeoMakePointField(field)},isGeoPolygonField:function(field){return field.qTags.indexOf("$geomultipolygon")>-1||field.qTags.indexOf("$geopolygon")>-1},getFieldsInTable:function(table,fieldList){var i,field,result=[];for(i=0;i<fieldList.length;i++)field=fieldList[i],arrayUtil.contains(field.qSrcTables,table)&&result.push(field);return result},simplifyGeoMakePointExpression:function(str){var fieldNames,fieldName1,fieldName2,idx1,idx2,str1,str2,str3;return fieldNames=mapUtil.extract2FieldNamesOfGeoMakePoint(str),fieldName1=fieldNames[0],fieldName2=fieldNames[1],idx1=str.indexOf(fieldName1),idx2=str.indexOf(fieldName2),str1=str.substring(0,idx1),str2=str.substring(idx1+fieldName1.length,idx2),str3=str.substring(idx2+fieldName2.length),str1.trim()+fieldName1+str2.trim()+fieldName2+str3.trim()},getFieldsInArchipelagoForGeoMakePointField:function(field,fieldList){var i,subFields=this.findFieldsInGeoMakePointFunction(field.qName,fieldList),n=subFields?subFields.length:0,archipelago={};for(i=0;n>i;i++)extendArchipelagos(archipelago,this.getFieldsInArchipelago(subFields[i],fieldList));return archipelago},getFieldsInArchipelago:function(field,fieldList){function recursiveScanTables(tables,distance){var i,k,table,tableFields,tableField;for(i=0;i<tables.length;i++)if(table=tables[i],!scannedTables[table])for(scannedTables[table]=!0,tableFields=mapUtil.getFieldsInTable(table,fieldList),k=0;k<tableFields.length;k++)tableField=tableFields[k],result[tableField.qName]||(result[tableField.qName]={field:tableField,distance:distance},recursiveScanTables(tableField.qSrcTables,++distance))}var result={},scannedTables={};return recursiveScanTables(field.qSrcTables,0),result},filterFields:function(fieldList,tags){function hasTag(item,tag){return Array.isArray(tag)?tag.some(function(t){return hasTag(item,t)}):item.qTags.indexOf(tag)>-1}var i,field,n=fieldList?fieldList.length:0,result=[];for(i=0;n>i;i++)field=fieldList[i],hasTag(field,tags)&&result.push(field);return result},findGeoAssociatedFields:function(fieldList,geoFields){var i,k,geoField,keys,key,archipelagoFields,archipelagoField,result={};for(i=0;i<geoFields.length;i++)for(geoField=geoFields[i],archipelagoFields=mapUtil.getFieldsInArchipelago(geoField,fieldList),keys=Object.keys(archipelagoFields),k=0;k<keys.length;k++)key=keys[k],archipelagoField=archipelagoFields[key].field,result[key]?result[key].geoFields.push(geoField):result[key]={field:archipelagoField,geoFields:[geoField],distance:archipelagoFields[key]};return Object.keys(result).map(function(key){return result[key]})},addLayer:function(item,properties,handler){var layer,dimension,geoField=item.geoField;return dimension="field"===item.type?handler.createFieldDimension(item.value):handler.createLibraryDimension(item.libraryId),mapUtil.isGeoPointField(geoField)?(layer=handler.addPointLayer(),handler.addDimension(dimension),handler.addDimension(handler.createFieldDimension(geoField.qName))):(layer=handler.addPolygonLayer("3"),handler.addDimension(dimension),handler.addFieldAsGeoPolygonField(geoField)),layer}};return mapUtil}),define("extensions.qliktech/map/map-autocomplete",["extensions.qliktech/map/map-util","translator"],function(mapUtil,translator){function sortOnDistance(arr){return arr.sort(function(a,b){var x;return x=a.distance<b.distance?-1e3:a.distance>b.distance?1e3:0,a.value<b.value?x-=10:a.value>b.value&&(x+=10),x})}return{getFieldSuggestions:function(fields,associatedFields){var fieldCategory=translator.get("Common.Fields"),suggestions=associatedFields.map(function(associatedField){var label=associatedField.field.qName,suggestion={label:label,value:label,field:associatedField.field,geoFields:associatedField.geoFields,associatedFields:[],distance:associatedField.distance,category:fieldCategory,type:"field"};if(mapUtil.isGeoField(associatedField.field)){var archipelagoFields=mapUtil.getFieldsInArchipelago(associatedField.field,fields),isGeoPointField=mapUtil.isGeoPointField(associatedField.field),nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&(!mapUtil.isGeoField(f)||isGeoPointField&&name===associatedField.field.qName)});suggestion.associatedFields=nonGeoFields,suggestion.hasAlternatives=nonGeoFields.length>1}else suggestion.hasAlternatives=associatedField.geoFields.length>1;return suggestion});return sortOnDistance(suggestions)},getDimensionSuggestions:function(dimensions,fields,associatedFields){function findAssociatedField(arr,fieldName,dimension){var isGeoMakePoint,i,item;if(isGeoMakePoint=mapUtil.isGeoMakePointExpression(fieldName),isGeoMakePoint&&(fieldName=mapUtil.simplifyGeoMakePointExpression(fieldName)),arr&&fieldName)for(i=0;i<arr.length;i++)if(item=arr[i],item.field.qName===fieldName)return item;return isGeoMakePoint&&dimension?{geoFields:[dimension.qData.info[0]],field:dimension.qData.info[0],distance:{distance:Math.MAX_VALUE,field:dimension.qData.info[0]}}:void 0}var dimensionCategory=translator.get("Common.Dimensions"),associatedDimensions=dimensions.map(function(dimension){var fieldName=dimension&&dimension.qData&&dimension.qData.info&&dimension.qData.info[0]?dimension.qData.info[0].qName:"",associatedField=""===fieldName?null:findAssociatedField(associatedFields,fieldName,dimension);return associatedField?{dimension:dimension,associatedField:associatedField}:void 0}).filter(function(obj){return!!obj}),suggestions=associatedDimensions.map(function(associatedDim){var archipelagoFields,nonGeoFields,label=associatedDim.dimension.qData.title,associatedField=associatedDim.associatedField,suggestion={label:label,value:label,field:associatedField.field,libraryId:associatedDim.dimension.qInfo.qId,geoFields:associatedField.geoFields,associatedFields:[],distance:associatedDim.distance,category:dimensionCategory,type:"dimension"},isGeoMakePointField=mapUtil.isGeoMakePointField(associatedField.field);if(isGeoMakePointField)archipelagoFields=mapUtil.getFieldsInArchipelagoForGeoMakePointField(associatedField.field,fields),nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&(!mapUtil.isGeoField(f)||name===associatedField.field.qName)}),suggestion.associatedFields=nonGeoFields,suggestion.hasAlternatives=nonGeoFields.length>1;else{var isNormalGeoPointField=mapUtil.isNormalGeoPointField(associatedField.field),isPolygonField=mapUtil.isGeoPolygonField(associatedField.field);isNormalGeoPointField||isPolygonField?(archipelagoFields=mapUtil.getFieldsInArchipelago(associatedField.field,fields),nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&(!mapUtil.isGeoField(f)||isNormalGeoPointField&&name===associatedField.field.qName)}),suggestion.associatedFields=nonGeoFields,suggestion.hasAlternatives=nonGeoFields.length>1):suggestion.hasAlternatives=associatedField.geoFields.length>1}return suggestion});return sortOnDistance(suggestions)}}}),define("general.models/field-on-fly",["general.models/field"],function(Field){"use strict";var FieldOnFly;return FieldOnFly=Field.extend("FieldOnFly",{},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}}})}),define("text!extensions.qliktech/map/add-popover/add-layer-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n						   object-add-typeahead-input on-escape="onEscape($event)" maxlength="255"/>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="dimension in dimensions"  tid="dimension-item"\r\n							object-add-typeahead-item="dimension" on-select="selectItem(dimension)">\r\n						<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right" ng-if="dimension.hasAlternatives"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="selectItem(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<span qve-highlight text="{{field.label}}" title="{{field.label}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right" ng-if="field.hasAlternatives"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header">{{headerLabel}}</div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="suggestedItem in suggestedItems"\r\n					qva-activate="selectItem(suggestedItem)" tid="from-field-item">\r\n					<span class="qui-list-text" title="{{getSuggestionLabel(suggestedItem)}}">{{getSuggestionLabel(suggestedItem)}}</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function Aligner(args){this.container=args.container,this.body=args.body,this.alignAgainst=args.alignAgainst}return Aligner.prototype.showTranscluded=function($transclude){$transclude(function(clone){this.container.appendTo(this.body).append(clone)}.bind(this))},Aligner.prototype.showContent=function(content){this.container.appendTo(this.body).append(content)},Aligner.prototype.update=function(){var offset=this.alignAgainst.offset();this.container.css({top:offset.top,left:offset.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},Aligner.prototype.hide=function(){this.container.remove()},Aligner}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(qvangular,template){qvangular.directive("objectAddTypeahead",[function(){return{template:template,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function($scope){function scrollIntoView(){var menu=$scope.menu;if($scope.activeItem){var item=$scope.activeItem,position=item.getPosition();position.top<0?menu.setScrollTop(item.getOffsetTop()):position.top+item.getHeight()>menu.getHeight()&&item.scrollIntoView(!1)}else menu.setScrollTop(0)}var controller=this;$scope.items=[],this.activate=function(item){$scope.activeItem=item},this.nextItem=function(steps){var index=$scope.items.indexOf($scope.activeItem);"undefined"!=typeof steps&&(index=(index+steps)%$scope.items.length),index===$scope.items.length-1?controller.activate(null):-1===index?controller.activate($scope.items[0]):controller.activate($scope.items[index+1]),scrollIntoView()},this.prevItem=function(steps){var index=$scope.items.indexOf($scope.activeItem);"undefined"!=typeof steps&&(index=(index-steps+$scope.items.length)%$scope.items.length),0===index?controller.activate(null):-1===index?controller.activate($scope.items[$scope.items.length-1]):controller.activate($scope.items[index-1]),scrollIntoView()},this.getActiveItem=function(){return $scope.activeItem},this.selectActiveItem=function(){$scope.activeItem&&$scope.activeItem.select()},this.select=function(item){$scope.select({item:item}),$scope.activeItem=null},this.setMenu=function(menu){$scope.menu=menu},this.addItem=function(item){$scope.items.push(item)},this.removeItem=function(item){var idx=$scope.items.indexOf(item);idx>=0&&$scope.items.splice(idx,1)}}]}}]),qvangular.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(scope,element,attrs,ctrls){var autocompleteController=ctrls[0],modelController=ctrls[1];element.on("keydown",function(e){e.stopPropagation(),13===e.which||9===e.which?(e.preventDefault(),autocompleteController.getActiveItem()?scope.$apply(function(){autocompleteController.selectActiveItem()}):scope.$apply(function(){scope.$eval(attrs.onEnter,{$event:e})})):33===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.prevItem(10)})):34===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.nextItem(10)})):40===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.nextItem()})):38===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.prevItem()})):27===e.which&&(e.preventDefault(),scope.$apply(function(){scope.$eval(attrs.onEscape,{$event:e})}))}),scope.$watch(autocompleteController.getActiveItem,function(activeItem){activeItem?activeItem.item.label&&element.val(activeItem.item.label):element.val(modelController.$modelValue)}),scope.$watch(modelController.$modelValue,function(val){val||autocompleteController.activate(null)})}}}]),qvangular.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(scope,element,attrs,controller){scope.controller=controller,controller.setMenu({getHeight:function(){return element.height()},setScrollTop:function(top){element[0].scrollTop=top}})}}}]),qvangular.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(scope,element,attrs,controller){function selectItem(){scope.$eval(attrs.onSelect,{item:item})}var item=scope.$eval(attrs.objectAddTypeaheadItem),itemDescr={item:item,getOffsetTop:function(){return element[0].offsetTop},scrollIntoView:function(start){element[0].scrollIntoView(start)},getPosition:function(){return element.position()},getHeight:function(){return element.height()},select:function(){selectItem()}};controller.addItem(itemDescr),scope.$on("$destroy",function(){controller.removeItem(itemDescr)}),scope.$watch(function(){var active=controller.getActiveItem();return active?active.item===item:!1},function(active){active?element.addClass("object-add-typeahead-active"):element.removeClass("object-add-typeahead-active")}),element.on("mouseenter",function(){element.addClass("object-add-typeahead-hover")}),element.on("mouseleave",function(){element.removeClass("object-add-typeahead-hover")}),element.on("qv-activate",function(event){event.preventDefault(),scope.$apply(function(){selectItem()})})}}}])}),define("extensions.qliktech/map/add-popover/add-layer-popover",["core.utils/deferred","general.utils/string-normalization","translator","general.utils/array-util","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/map-autocomplete","general.models/field-on-fly","general.models/library/dimension","text!./add-layer-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(Deferred,StringNormalization,translator,arrayUtil,support,mapUtil,mapAutocomplete,FieldModel,DimensionModel,template,directDiscoveryService){"use strict";function filter(data,term){return""===term?data:data.filter(function(entity){return"undefined"==typeof entity.value?!1:StringNormalization.string(entity.value.toLowerCase()).indexOf(StringNormalization.string(term.toLowerCase()))>-1})}var ITEM_LIMIT=100,component={template:template,controller:["$scope",function($scope){$scope.search={term:""},$scope.isDirectDiscoveryField=directDiscoveryService.isDirectDiscoveryField,$scope.getDirectDiscoveryTypeTranslationKey=directDiscoveryService.getTypeTranslationKey,$scope.autoFocus=support.treatAsDesktop(),$scope.suggestedItems=[],$scope.position||($scope.position="right"),$scope.getSuggestionLabel=function(item){return mapUtil.isGeoPointField(item.geoFields[0])?translator.get("properties.layers.autocomplete.pointSuggestion",[item.label]):translator.get("properties.layers.autocomplete.regionSuggestion",[item.label])},$scope.selectItem=function(item){1!==item.geoFields.length||item.field&&mapUtil.isGeoField(item.field)?mapUtil.isGeoField(item.field)?($scope.headerLabel=mapUtil.isGeoPointField(item.field)?translator.get("Visualization.Requirements.SelectFieldForPointLayer"):translator.get("Visualization.Requirements.SelectFieldForAreaLayer"),$scope.suggestedItems=item.associatedFields.map(function(nonGeoField){return{label:nonGeoField.qName,value:nonGeoField.qName,type:"field",geoFields:[item.field]}}),$scope.step2=!0):($scope.headerLabel=translator.get("Visualization.Requirements.SelectGeoFieldForLayer"),$scope.suggestedItems=item.geoFields.map(function(geoField){return{label:geoField.qName,value:item.value,libraryId:item.libraryId,type:item.type,geoFields:[geoField]}}),$scope.step2=!0):"dimension"===item.type?$scope.addLibraryDimension({libraryId:item.libraryId,type:item.type,geoField:item.geoFields[0]}):$scope.addFieldDimension({value:item.value,type:item.type,geoField:item.geoFields[0]})},$scope.onEscape=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.search.term=""):$scope.closeAddPopover()},$scope.goBack=function(event){event.preventDefault(),$scope.suggestedItems=[],$scope.step2=!1};var cache=null;$scope.$watch("search.term",function(term){function setItems(){var fields=filter(cache.fields,term),dimensions=filter(cache.dimensions,term);dimensions.length>ITEM_LIMIT?(dimensions=arrayUtil.limit(dimensions,ITEM_LIMIT),fields=[]):fields.length+dimensions.length>ITEM_LIMIT&&(fields=arrayUtil.limit(fields,ITEM_LIMIT-dimensions.length)),$scope.fields=fields,$scope.dimensions=dimensions}cache?setItems():Deferred.all({fields:FieldModel.getListLayout(),dimensions:DimensionModel.getListLayout()}).then(function(args){var geoFields=mapUtil.filterFields(args.fields,["$geomultipolygon","$geopolygon","$geopoint"]),associatedFields=mapUtil.findGeoAssociatedFields(args.fields,geoFields),normalAssociatedFields=associatedFields.filter(function(associatedField){return!associatedField.field.qIsDefinitionOnly});cache={fields:mapAutocomplete.getFieldSuggestions(args.fields,normalAssociatedFields),dimensions:mapAutocomplete.getDimensionSuggestions(args.dimensions,args.fields,associatedFields)},setItems()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return component}),define("extensions.qliktech/map/map-layer-creation",["translator","qvangular","core.models/app","extensions.qliktech/map/map-util","general.models/field","util"],function(translator,qvangular,App,mapUtil,FieldModel,util){"use strict";function addPolygonLayer(dimension,geoPolygonField,mapHandler,model){mapHandler.addPolygonLayer("3"),mapHandler.addDimension(dimension),mapHandler.addFieldAsGeoPolygonField(geoPolygonField),model.save()}function addPointLayer(dimension,geoPointDimension,mapHandler,model){mapHandler.addPointLayer(),mapHandler.addDimension(dimension),mapHandler.addDimension(geoPointDimension),model.save()}function addPolygonLayerMenuItem(geoPolygonField,menu,translation,dimension,mapHandler,model){menu.addItem({translation:translation,tid:"add-as-polygon-layer",select:function(){addPolygonLayer(dimension,geoPolygonField,mapHandler,model),qvangular.$rootScope.$broadcast("pp-open-path","data."+mapHandler.properties.layers[0].cId)}})}function addPointLayerMenuItem(geoPointField,menu,translation,dimension,mapHandler,model){menu.addItem({translation:translation,tid:"add-as-point-layer",select:function(){var geoPointDimension=mapHandler.createFieldDimension(geoPointField.qName);addPointLayer(dimension,geoPointDimension,mapHandler,model),qvangular.$rootScope.$broadcast("pp-open-path","data."+mapHandler.properties.layers[0].cId)}})}function addFieldMenuItemsForPointLayer(geoField,items,builder,mapHandler,model){var submenu;1===items.length?addPointLayerMenuItem(geoField,builder.menu,"Object.Map.DropActions.AddAsPointLayer",items[0].dimension,mapHandler,model):items.length>1&&(submenu=builder.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),items.forEach(function(item){addPointLayerMenuItem(geoField,submenu,["properties.layers.autocomplete.pointSuggestion",item.name],item.dimension,mapHandler,model)}))}function addFieldMenuItemsForPolygonLayer(geoField,items,builder,mapHandler,model){var submenu;1===items.length?addPolygonLayerMenuItem(geoField,builder.menu,"Object.Map.DropActions.AddAsRegionLayer",items[0].dimension,mapHandler,model):items.length>1&&(submenu=builder.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),items.forEach(function(item){addPolygonLayerMenuItem(geoField,submenu,["properties.layers.autocomplete.regionSuggestion",item.name],item.dimension,mapHandler,model)}))}function addFieldMenuItems(geoField,items,builder,mapHandler,model){mapUtil.isGeoPointField(geoField)?addFieldMenuItemsForPointLayer(geoField,items,builder,mapHandler,model):addFieldMenuItemsForPolygonLayer(geoField,items,builder,mapHandler,model)}function addGeoFieldsMenuItems(dimension,geoFields,builder,mapHandler,model){var geoPointFields=[],geoPolygonFields=[];geoFields.forEach(function(geoField){mapUtil.isGeoPointField(geoField)?geoPointFields.push(geoField):geoPolygonFields.push(geoField)});var submenu;1===geoPolygonFields.length?addPolygonLayerMenuItem(geoPolygonFields[0],builder.menu,"Object.Map.DropActions.AddAsRegionLayer",dimension,mapHandler,model):geoPolygonFields.length>1&&(submenu=builder.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),geoPolygonFields.forEach(function(geoPolygonField){addPolygonLayerMenuItem(geoPolygonField,submenu,["properties.layers.autocomplete.regionSuggestion",geoPolygonField.qName],dimension,mapHandler,model)})),1===geoPointFields.length?addPointLayerMenuItem(geoPointFields[0],builder.menu,"Object.Map.DropActions.AddAsPointLayer",dimension,mapHandler,model):geoPointFields.length>1&&(submenu=builder.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),geoPointFields.forEach(function(geoPointField){addPointLayerMenuItem(geoPointField,submenu,["properties.layers.autocomplete.pointSuggestion",geoPointField.qName],dimension,mapHandler,model)}))}function addMeasureFieldOption(layersWithoutMeasure,mapHandler,builder,model){layersWithoutMeasure.forEach(function(layer){var index=mapHandler.properties.layers.indexOf(layer),translation=MAX_NUM_LAYERS>1?"Add as measure in layer "+(index+1):translator.get("contextMenu.addFieldAsMeasure"),fieldValue=util.escapeField(builder.item.name),menu=builder.menu.addItem({translation:translation,tid:"add-as-measure"});["Sum","Count","Avg","Min","Max"].forEach(function(fnName){var expr=fnName+"("+fieldValue+")";menu.addItem({label:expr,tid:fnName.toLowerCase(),select:function(){var measure;switch(layer.type){case"polygon":measure=layer.qHyperCubeDef?mapHandler.createExpressionMeasure(expr,expr):{qExpr:expr,qLabel:expr},mapHandler.addMeasureToPolygonLayer(layer,measure);break;case"point":measure=mapHandler.createExpressionMeasure(expr,expr),mapHandler.addMeasureToPointLayer(layer,measure);break;default:return}model.save()}})})})}var MAX_NUM_LAYERS=1;return{getDropFieldOptions:function(builder,mapHandler,model,showMenu){var item=builder.item,layers=mapHandler.getLayers(),layersWithoutMeasure=mapHandler.getLayersWithoutMeasure(),field={qTags:item.tags,qSrcTables:item.srcTables,qName:item.name},isGeoPointField=mapUtil.isGeoPointField(field),isGeoPolygonField=mapUtil.isGeoPolygonField(field),isGeoField=isGeoPointField||isGeoPolygonField;isGeoField?layersWithoutMeasure.length?(addMeasureFieldOption(layersWithoutMeasure,mapHandler,builder,model),showMenu()):layers.length>=MAX_NUM_LAYERS?showMenu():FieldModel.getListLayout().then(function(fields){var archipelagoFields=mapUtil.getFieldsInArchipelago(field,fields),nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&(!mapUtil.isGeoField(f)||isGeoPointField&&name===field.qName)}),dimensions=nonGeoFields.map(function(nonGeoField){var dimension=mapHandler.createFieldDimension(nonGeoField.qName);return{name:nonGeoField.qName,dimension:dimension}});addFieldMenuItems(field,dimensions,builder,mapHandler,model),showMenu()}):App.current.findMatchingFields(builder.item.name,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(fields){var dimension,geoPointDimension,geoFields=fields.qFieldNames;layersWithoutMeasure.length?(addMeasureFieldOption(layersWithoutMeasure,mapHandler,builder,model),showMenu()):layers.length>=MAX_NUM_LAYERS||0===geoFields.length?showMenu():1===geoFields.length?(dimension=mapHandler.createFieldDimension(item.name),mapUtil.isGeoPointField(geoFields[0])?(geoPointDimension=mapHandler.createFieldDimension(geoFields[0].qName),addPointLayer(dimension,geoPointDimension,mapHandler,model)):addPolygonLayer(dimension,geoFields[0],mapHandler,model)):(dimension=mapHandler.createFieldDimension(item.name),addGeoFieldsMenuItems(dimension,geoFields,builder,mapHandler,model),showMenu())})},getDropDimensionOptions:function(builder,mapHandler,model,showMenu){if(mapHandler.getLayers().length>0)return void showMenu();var item=builder.item;mapUtil.isGeoMakePointField(item.info[0])?FieldModel.getListLayout().then(function(fields){var archipelagoFields=mapUtil.getFieldsInArchipelagoForGeoMakePointField(item.info[0],fields);if(archipelagoFields){var nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&!mapUtil.isGeoField(f)}),dimensions=nonGeoFields.map(function(nonGeoField){var dimension=mapHandler.createFieldDimension(nonGeoField.qName);return{name:nonGeoField.qName,dimension:dimension}});addFieldMenuItemsForPointLayer(item.info[0],dimensions,builder,mapHandler,model)}showMenu()}):mapUtil.isGeoField(item.info[0])?FieldModel.getListLayout().then(function(fields){for(var field,i=0;i<fields.length;i++)if(fields[i].qName===item.info[0].qName){field=fields[i];break}if(field){var archipelagoFields=mapUtil.getFieldsInArchipelago(field,fields),isGeoPointField=mapUtil.isGeoPointField(field),nonGeoFields=fields.filter(function(f){var name=f.qName;return archipelagoFields[name]&&(!mapUtil.isGeoField(f)||isGeoPointField&&name===field.qName);
}),dimensions=nonGeoFields.map(function(nonGeoField){var dimension=mapHandler.createFieldDimension(nonGeoField.qName);return{name:nonGeoField.qName,dimension:dimension}});addFieldMenuItems(field,dimensions,builder,mapHandler,model)}showMenu()}):App.current.findMatchingFields(item.info[0].qName,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(fields){var dimension,geoPointDimension,item=builder.item,geoFields=fields.qFieldNames;0===geoFields.length?showMenu():1===geoFields.length?(dimension=mapHandler.createLibraryDimension(item.id),mapUtil.isGeoPointField(geoFields[0])?(geoPointDimension=mapHandler.createFieldDimension(geoFields[0].qName),addPointLayer(dimension,geoPointDimension,mapHandler,model)):addPolygonLayer(dimension,geoFields[0],mapHandler,model)):(dimension=mapHandler.createLibraryDimension(item.id),addGeoFieldsMenuItems(dimension,geoFields,builder,mapHandler,model),showMenu())})},getDropMeasureOptions:function(builder,mapHandler,model,showMenu){var item=builder.item,layersWithoutMeasure=mapHandler.getLayersWithoutMeasure();layersWithoutMeasure.length&&layersWithoutMeasure.forEach(function(layer){builder.menu.addItem({translation:["contextMenu.add",item.name],tid:"add",select:function(){var measure;switch(layer.type){case"polygon":measure=layer.qHyperCubeDef?mapHandler.createLibraryMeasure(item.id):{qLibraryId:item.id},mapHandler.addMeasureToPolygonLayer(layer,measure);break;case"point":measure=mapHandler.createLibraryMeasure(item.id),mapHandler.addMeasureToPointLayer(layer,measure);break;default:return}model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+layer.cId)}})}),showMenu()},addFieldDimension:function(item,object){return object.model.getProperties().then(function(properties){if(!(properties.layers.length>=MAX_NUM_LAYERS)){var handler=object.ext.getCreatePropertyHandler();handler.setProperties(properties),mapUtil.addLayer(item,properties,handler),qvangular.$rootScope.$broadcast("pp-open-path","data."+properties.layers[0].cId)}})},addLibraryDimension:function(item,object){return object.model.getProperties().then(function(properties){if(!(properties.layers.length>=MAX_NUM_LAYERS)){var handler=object.ext.getCreatePropertyHandler();handler.setProperties(properties),mapUtil.addLayer(item,properties,handler),qvangular.$rootScope.$broadcast("pp-open-path","data."+properties.layers[0].cId)}})}}}),define("extensions.qliktech/map/interaction-controller",["jquery","general.utils/support","objects.utils/event-utils","objects.utils/shapes/point","objects.views/charts/utils/matrix","touche"],function($,support,EventUtils,Point,Matrix){"use strict";function checkSelectionState(selections){if(selections){var type=selections.getActiveType?selections.getActiveType():void 0,tooltipType=selections.types?selections.types.tooltip:void 0;type&&type.clearSelection&&type.getActiveMode&&"item"!==type.getActiveMode()&&type.clearSelection(),tooltipType&&tooltipType.clearSelection&&this.chart&&this.chart.components&&this.chart.components.dataArea.id===tooltipType.tooltipComponentId&&tooltipType.clearSelection()}}function moveMapIntoViewport(){var p1,p2,q1,q2,maxX,minX,s,p3,p4,dLong,n,c;p1={x:this._mapBounds.x,y:this._mapBounds.y},p2={x:this._mapBounds.x+this._mapBounds.width,y:this._mapBounds.y+this._mapBounds.height},q1=this._viewportProjection.project(p1),q2=this._viewportProjection.project(p2),maxX=Math.max(q1.x,q2.x),minX=Math.min(q1.x,q2.x),s=this._viewportProjection.getSize(),(0>maxX||minX>s.x)&&(p3=this._viewportProjection.invProject({x:0,y:0}),p4=this._viewportProjection.invProject({x:s.x,y:0}),dLong=Math.abs(p4.x-p3.x),c=this._viewportProjection.getMapCenterInLonLat(),dLong>=360?(n=Math.floor(dLong/360),c.x=c.x+360*n*(c.x<0?1:-1),this._viewportProjection.setMapCenterInLonLat(c)):Math.abs(c.x)>180&&(c.x=c.x%360,c.x>180?c.x-=360:c.x<-180&&(c.x+=360),this._viewportProjection.setMapCenterInLonLat(c)))}function zoomToLevel(z){checkSelectionState.call(this,this.chart.selections),z=Math.min(Math.max(z,this._minZoomLevel),this._maxZoomLevel),this._viewportProjection.setZoomLevel(z)}function pinch(fromPoint,toPoint,scale,lastScale){var p1,p2,dx,dy,m,mt=new Matrix,s=scale/lastScale;dx=toPoint.x-fromPoint.x,dy=toPoint.y-fromPoint.y,p1=this._localMatrix.clone().invert().transformPoint(fromPoint),mt.translate(p1.x,p1.y),mt.scale(s,s),mt.translate(-p1.x,-p1.y),this._localMatrix=this._localMatrix.multiply(mt),m=this._localMatrix.elements,this._localMatrix.translate(dx/m[0][0],dy/m[1][1]),applyTransform.call(this),mt.identity(),p2=this._globalMatrix.clone().invert().transformPoint(fromPoint),mt.translate(p2.x,p2.y),mt.scale(s,s),mt.translate(-p2.x,-p2.y),this._globalMatrix=this._globalMatrix.multiply(mt),m=this._globalMatrix.elements,this._globalMatrix.translate(dx/m[0][0],dy/m[1][1])}function setTransform(trans){var cont=this.dataArea.layersContainer;cont.style["-webkit-transform"]=trans,cont.style["-moz-transform"]=trans,cont.style["-o-transform"]=trans,cont.style["-ms-transform"]=trans,cont.style.transform=trans}function setTransformOrigin(){if(!this._setTransformOrigin){var cont=this.dataArea.layersContainer,tl="top left";cont.style["-webkit-transform-origin"]=tl,cont.style["-moz-transform-origin"]=tl,cont.style["-o-transform-origin"]=tl,cont.style["-ms-transform-origin"]=tl,cont.style["transform-origin"]=tl,this._setTransformOrigin=!0}}function applyTransform(){var m=this._localMatrix.elements,trans="matrix("+m[0][0]+",0,0,"+m[1][1]+","+m[0][2]+","+m[1][2]+")";setTransform.call(this,trans)}function onInteractionStart(){this._interactionStarted||(checkSelectionState.call(this,this.chart.selections),this._localMatrix.identity(),this._globalMatrix=this._viewportProjection.getTransformMatrix().clone(),this._interactionStarted=!0)}function onInteractionEnd(){if(!(this._zooming||this._panning||this._pinching)){var b=!1;setTransform.call(this,"matrix(1,0,0,1,0,0)"),this._viewportProjection.enabledChangeEvent=!1,this._viewportProjection.setTransformMatrix(this._globalMatrix),this.dataArea.hasVisibleBaseLayer()&&(moveMapIntoViewport.call(this),b=this.dataArea.baseMapLayer.updateViewportToBaseMap(!0)),b||this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0,this._interactionStarted=!1}}function onZoomStart(p,s){onZoomUpdate.apply(this,[p,s])}function onZoomUpdate(p,s){if(!this._disableZoomOnMouseWheel){this._disableZoomOnMouseWheel=!0;var self=this;if(setTimeout(function(){self._disableZoomOnMouseWheel=!1},self._mouseWheelTimeoutPeriod),!this._zoomPanByWebkitTransform&&support.treatAsDesktop())return void zoomAt.apply(this,[p,s]);var p1,p2,mt=new Matrix;this._zooming=!0,onInteractionStart.call(this),p1=this._localMatrix.clone().invert().transformPoint(p),mt.translate(p1.x,p1.y),mt.scale(s,s),mt.translate(-p1.x,-p1.y),this._localMatrix=this._localMatrix.multiply(mt),applyTransform.call(this),mt.identity(),p2=this._globalMatrix.clone().invert().transformPoint(p),mt.translate(p2.x,p2.y),mt.scale(s,s),mt.translate(-p2.x,-p2.y),this._globalMatrix=this._globalMatrix.multiply(mt)}}function onZoomEnd(){this._zooming=!1,(this._zoomPanByWebkitTransform||!support.treatAsDesktop())&&onInteractionEnd.call(this)}function onPanStart(dx,dy){onPanUpdate.apply(this,[dx,dy])}function onPanUpdate(dx,dy){if(!this._zoomPanByWebkitTransform&&support.treatAsDesktop())return void pan.apply(this,[dx,dy]);this._panning=!0,onInteractionStart.call(this);var m=this._localMatrix.elements;this._localMatrix.translate(dx/m[0][0],dy/m[1][1]),applyTransform.call(this),m=this._globalMatrix.elements,this._globalMatrix.translate(dx/m[0][0],dy/m[1][1])}function onPanEnd(){this._panning=!1,(this._zoomPanByWebkitTransform||!support.treatAsDesktop())&&onInteractionEnd.call(this)}function pan(dx,dy){this._viewportProjection.enabledChangeEvent=!1,this.moveViewport(dx,dy),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function zoomAt(p,s){this._viewportProjection.enabledChangeEvent=!1,this.zoomOnPixel(p,s),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function InteractionController(chart,viewportProjection){this.chart=chart,this.dataArea=this.chart.components.dataArea,this._minZoomLevel=0,this._maxZoomLevel=maxZoomLevel,this._interactionStarted=!1,this._zoomPanByWebkitTransform=!1,this._fractionalZoomMode=!0,this._defaultScale=Math.pow(2,.5),this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=50,this._viewportProjection=viewportProjection,this._viewportProjection.setMinZoomLevel(this._minZoomLevel),this._viewportProjection.setMaxZoomLevel(this._maxZoomLevel),this._localMatrix=new Matrix}var maxZoomLevel=19,moveStep=200,epsilon=1e-6;return InteractionController.prototype={setOffset:function(offset){this._offset=offset},navigate:function(arg){var z,self=this;switch(arg){case"resetZoom":self.zoomOnMapBounds();break;case"zoomIn":if(z=self.getZoomLevel(),void 0===z||null===z||z===self._maxZoomLevel)return;self.zoom(self._defaultScale);break;case"zoomOut":if(z=self.getZoomLevel(),void 0===z||null===z||z===self._minZoomLevel)return;self.zoom(self._invDefaultScale);break;case"navUp":pan.apply(self,[0,moveStep]);break;case"navDown":pan.apply(self,[0,-moveStep]);break;case"navLeft":pan.apply(self,[moveStep,0]);break;case"navRight":pan.apply(self,[-moveStep,0])}},onPan:function(when,e,data){var self=this;switch(when){case"start":onPanStart.apply(self,[data.swipe.deltaX,data.swipe.deltaY]);break;case"update":onPanUpdate.apply(self,[data.swipe.curDeltaX,data.swipe.curDeltaY]);break;case"end":onPanEnd.apply(self)}},on:function(namespace,container){var lastScale,lastCenterPoint,currentCenterPoint,zoomTimer,self=this,panningByMiddleMouseButton=!1,zoomingByMouseWheel=!1;setTransformOrigin.call(this);var onWheelFn=function(e){var mouseX,mouseY,p,s,event=EventUtils.getMouseWheelData(e.originalEvent);mouseX=event.x-self._offset.left,mouseY=event.y-self._offset.top,p=new Point(mouseX,mouseY),s=event.delta>0?self._defaultScale:self._invDefaultScale,zoomingByMouseWheel?onZoomUpdate.apply(self,[p,s]):onZoomStart.apply(self,[p,s]),zoomingByMouseWheel=!0,null!==zoomTimer&&clearTimeout(zoomTimer),zoomTimer=setTimeout(function(){zoomTimer=null,onZoomEnd.call(self),zoomingByMouseWheel=!1},250)};EventUtils.throttle(onWheelFn,20),$(container).on("mousewheel"+namespace+" DOMMouseScroll"+namespace,function(e){onWheelFn(e),e.preventDefault()}),Touche(container).wheelswipe({id:namespace,start:function(e){self._panX=e.pageX,self._panY=e.pageY,panningByMiddleMouseButton=!1},update:function(e){var panX,panY,dx,dy,oldPanning;panX=e.pageX,panY=e.pageY,dx=panX-self._panX,dy=panY-self._panY,oldPanning=panningByMiddleMouseButton,!panningByMiddleMouseButton&&(Math.abs(dx)>3||Math.abs(dy)>3)&&(panningByMiddleMouseButton=!0),panningByMiddleMouseButton&&(self._panX=panX,self._panY=panY,oldPanning?onPanUpdate.apply(self,[dx,dy]):onPanStart.apply(self,[dx,dy]))},end:function(){panningByMiddleMouseButton?onPanEnd.call(self):self.zoomOnMapBounds(),panningByMiddleMouseButton=!1}}),Touche(container).pinch({id:namespace,options:{useMomentum:!0,inertia:.7},start:function(e,data){lastCenterPoint={},lastCenterPoint.x=(this.pinch.start.point1.x+this.pinch.start.point2.x)/2-self._offset.left,lastCenterPoint.y=(this.pinch.start.point1.y+this.pinch.start.point2.y)/2-self._offset.top,currentCenterPoint={x:data.centerPoint.x-self._offset.left,y:data.centerPoint.y-self._offset.top},self._pinching=!0,onInteractionStart.call(self),pinch.apply(self,[lastCenterPoint,currentCenterPoint,data.scale,data.scale]),lastScale=data.scale,lastCenterPoint=currentCenterPoint,Touche.preventGestures(this.gestureHandler)},update:function(e,data){currentCenterPoint={x:data.centerPoint.x-self._offset.left,y:data.centerPoint.y-self._offset.top},self._pinching=!0,onInteractionStart.call(self),pinch.apply(self,[lastCenterPoint,currentCenterPoint,data.scale,lastScale]),lastScale=data.scale,lastCenterPoint=currentCenterPoint,Touche.preventGestures(this.gestureHandler)},end:function(){self._pinching=!1,onInteractionEnd.call(self)}}),Touche(container).swipe({id:namespace,options:{useMomentum:!0,touches:2,inertia:.7},start:function(e,data){self.onPan("start",e,data),Touche.preventGestures(this.gestureHandler)},update:function(e,data){self.onPan("update",e,data)},end:function(e,data){self.onPan("end",e,data)}}),Touche(container).tap({id:namespace,options:{touches:3},end:function(){self.zoomOnMapBounds(),Touche.preventGestures(this.gestureHandler)}})},setMaxZoomLevel:function(z){this._maxZoomLevel=z,this._viewportProjection&&this._viewportProjection.setMaxZoomLevel(z)},setMinZoomLevel:function(z){this._minZoomLevel=z,this._viewportProjection&&this._viewportProjection.setMinZoomLevel(z)},setMapCenter:function(c,isLonLat){checkSelectionState.call(this,this.chart.selections),this._viewportProjection&&(isLonLat?this._viewportProjection.setMapCenterInLonLat(c):this._viewportProjection.setMapCenter(c))},getMapCenter:function(){return this._viewportProjection?this._viewportProjection.getMapCenter():null},setZoomLevel:function(z){!isNaN(z)&&isFinite(z)&&(Math.abs(z-Math.round(z))<epsilon&&(z=Math.round(z)),zoomToLevel.call(this,z))},getZoomLevel:function(){return this._viewportProjection?this._viewportProjection.getZoomLevel():0},moveViewport:function(dx,dy){var p1,p2,p3,p4,q1,q2,maxX,minX,s,c,dLong,a,n;p1={x:this._mapBounds.x,y:this._mapBounds.y},p2={x:this._mapBounds.x+this._mapBounds.width,y:this._mapBounds.y+this._mapBounds.height},q1=this._viewportProjection.project(p1),q2=this._viewportProjection.project(p2),maxX=Math.max(q1.x,q2.x),minX=Math.min(q1.x,q2.x),s=this._viewportProjection.getSize(),dx>0&&minX+dx<=s.x||0>dx&&maxX+dx>=0||!(this.dataArea.baseMapLayer&&this.dataArea.baseMapLayer.isReady()&&this.dataArea.baseMapLayer.show)?this.setMapCenter(this._viewportProjection.invProject(new Point(s.x/2-dx,s.y/2-dy))):(p3=this._viewportProjection.invProject({x:0,y:0}),p4=this._viewportProjection.invProject({x:s.x,y:0}),dLong=Math.abs(p4.x-p3.x),dLong>=360?(a=s.x/dLong*360,n=Math.floor(dLong/360),dx>0&&minX+dx>s.x?dx-=a*n:0>dx&&0>maxX+dx&&(dx=a*n-dx),this.setMapCenter(this._viewportProjection.invProject(new Point(s.x/2-dx,s.y/2-dy)))):(this.dataArea.baseMapLayer.panBy(-dx,-dy),c=this.dataArea.baseMapLayer.getMapCenter(),this.setMapCenter(c,!0)))},zoom:function(scale){if(scale>0){var z=Math.log(scale)/Math.LN2;Math.abs(z-Math.round(z))<epsilon&&(z=Math.round(z)),this.setZoomLevel(this.getZoomLevel()+z)}},zoomOnPixel:function(p,scale){var s1,s2,z=this.getZoomLevel();z<=this._minZoomLevel&&1>=scale||z>=this._maxZoomLevel&&scale>=1||(checkSelectionState.call(this,this.chart.selections),s1=Math.pow(2,this._minZoomLevel-z),s2=Math.pow(2,this._maxZoomLevel-z),scale=Math.min(Math.max(scale,s1),s2),this._viewportProjection.zoomOnPixel(p,scale),this.dataArea.hasVisibleBaseLayer()&&moveMapIntoViewport.call(this))},zoomOnMapRectangle:function(rect,rounding){checkSelectionState.call(this,this.chart.selections),this._viewportProjection.zoomOnMapRectangle(rect,rounding)},zoomOnViewportRectangle:function(rect,rounding){var rect2=this._viewportProjection.fromViewportRectToMapRect(rect);this.zoomOnMapRectangle(rect2,rounding)},setMapBounds:function(rect){!rect||this._mapBounds&&this._mapBounds.equal(rect)||(this._mapBounds=rect.clone())},zoomOnMapBounds:function(){var rect=this._mapBounds&&!this._mapBounds.hasNaN()?this._mapBounds:this._worldBounds;return rect?(this.zoomOnMapRectangle(rect,!1),this.dataArea.hasVisibleBaseLayer()&&(this._viewportProjection.inResetZoomMode=!0),this._viewportProjection.fire("resetZoomFinished"),!0):void 0},setFractionalZoomMode:function(b){this._fractionalZoomMode=b,this._defaultScale=this._fractionalZoomMode?Math.pow(2,.5):2,this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=this._fractionalZoomMode?50:100,this._viewportProjection&&this._viewportProjection.setFractionalZoomMode(b)},getFractionalZoomMode:function(){return this._fractionalZoomMode},setZoomPanByWebkitTransform:function(b){this._zoomPanByWebkitTransform=b},getZoomPanByWebkitTransform:function(){return this._zoomPanByWebkitTransform}},InteractionController}),define("extensions.qliktech/map/map",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","client.utils/state","objects.backend-api/map-api","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","text!./map.ng.html","extensions.qliktech/map/map-properties","extensions.qliktech/map/projection/viewport-projection","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/map-area","objects.utils/shapes/rect","objects.utils/event-utils","general.utils/property-mapper","extensions.qliktech/map/map-handler","objects.views/charts/components/axis/axis","objects.views/charts/components/legend/color-legend","extensions.qliktech/map/add-popover/add-layer-popover","extensions.qliktech/map/map-layer-creation","extensions.qliktech/map/interaction-controller","core.utils/deferred","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","touche","objects.views/charts/disclaimers/chart-disclaimer-directive"],function($,Chart,ChartComponent,State,MapApi,ColorMap,Binding,template,mapPropertiesDefinition,ViewportProjection,UnitProjection,MapArea,Rect,EventUtils,propertyMapper,MapHandler,Axis,Legend,addLayerPopoverComponent,mapLayerCreation,InteractionController,Deferred){"use strict";function isListObjectValid(qListObject){var valid=qListObject&&qListObject.qDimensionInfo&&!qListObject.qDimensionInfo.qError;return valid}function isHyperCubeValid(qHyperCube){var valid=qHyperCube&&qHyperCube.qDimensionInfo.length&&!qHyperCube.qDimensionInfo.some(function(d){return!!d.qError});return qHyperCube.qMeasureInfo&&qHyperCube.qMeasureInfo.length&&(valid=valid&&!qHyperCube.qMeasureInfo.some(function(m){return!!m.qError})),valid}function isDataValid(data){if(!(data&&(data.layers&&0!==data.layers.length||data.background&&data.background.show)))return!1;var i,layer,n=Math.min(data.layers.length,MAX_NUM_LAYERS);for(i=0;n>i;i++)if(layer=data.layers[i],layer.qListObject){if(isListObjectValid(layer.qListObject))return!0}else{if(!layer.qHyperCube)return!1;if(isHyperCubeValid(layer.qHyperCube))return!0}return data.background&&data.background.show}function isHyperCubeSelectable(qHyperCube){var selectable=qHyperCube&&qHyperCube.qDimensionInfo.every(function(dim){return dim.qLocked!==!0});return selectable}function isListObjectSelectable(qListObject){var selectable=qListObject&&qListObject.qDimensionInfo.qLocked!==!0;return selectable}function setProjection(projection){this._projection&&projection&&this._projection.getProjectionType()===projection.getProjectionType()||(this._projection=projection,this._projection||(this._projection=this._unitProjection),this._viewportProjection.setProjection(this._projection))}function setViewportSize(s){this._viewportProjection.setSize(s)}function onViewportProjectionChanged(){this._resizing||this._layouting||(this._mapRect=this._viewportProjection.getMapRectOfViewport()),this.updateNavigation()}function updateSelectionCache(){if(this.selections){var shapes=this.components.dataArea.getSelectableShapes(),layers=this.components.dataArea.layers,active=this.selections.getActiveType?this.selections.getActiveType():!1,isActive=!!active;this.selections.cache&&(this.selections.cache.clear(),shapes.forEach(function(cacheItem){this.selections.cache.add(cacheItem)},this),isActive&&("item"===active.getActiveMode()?shapes.forEach(function(cacheItem){var selectedRows=layers[cacheItem.layerIndex].getSelectedRows();cacheItem.selected=selectedRows&&selectedRows.indexOf(cacheItem.rowIndex)>=0}):(active.activeComponent instanceof Axis&&!active.activeComponent.isDiscrete()||active.activeComponent instanceof Legend&&"range"===active.getActiveMode())&&active.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(shapes)),Object.keys(this.components).forEach(function(key){["colorLegend","xAxis","dimensionAxis"].contains(key)&&this.components[key].setSelectableShapes(shapes)},this)}}function groupCacheItemsByLayer(cacheItems){var i,item,layerIndex,n=cacheItems?cacheItems.length:0,result=[];for(i=0;n>i;i++)item=cacheItems[i],layerIndex=item.layerIndex,void 0===result[layerIndex]&&(result[layerIndex]=[]),result[layerIndex][result[layerIndex].length]=item;return result}function deselectCacheItemsOfBottomLayers(cacheItems,cacheItemsByLayerArray,fromLayerIndex){var layerIndex,cacheItemsByLayer,n,i,cacheItem;for(layerIndex=fromLayerIndex;layerIndex>-1;layerIndex--)for(cacheItemsByLayer=cacheItemsByLayerArray[layerIndex],n=cacheItemsByLayer?cacheItemsByLayer.length:0,i=0;n>i;i++)cacheItem=cacheItemsByLayer[i],cacheItem.selected=!1}function updateLegendPosition(colorLegend,data){!data||data.legend&&"auto"===data.legend.dock?colorLegend.outerRect.height/colorLegend.outerRect.width<1?colorLegend.setDock("right"):colorLegend.setDock("bottom"):colorLegend.setDock(data.legend.dock)}function onResetZoomFinished(){this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getMapRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone(),this.updateNavigation()}function isInZoomOnMapBoundsMode(){if(!this._mapRectInZoomOnMapBoundsMode)return!0;var dx=this._mapRectInZoomOnMapBoundsMode.x-this._mapRect.x,dy=this._mapRectInZoomOnMapBoundsMode.y-this._mapRect.y,dw=this._mapRect.width-this._mapRectInZoomOnMapBoundsMode.width,dh=this._mapRect.height-this._mapRectInZoomOnMapBoundsMode.height;return Math.abs(dx)<epsilon&&Math.abs(dw)<epsilon&&dy>-epsilon&&dh>-epsilon||Math.abs(dy)<epsilon&&Math.abs(dh)<epsilon&&dx>-epsilon&&dw>-epsilon?!0:!1}function setNavigation(visible,homeOnly){var self=this;this.$scope.navigationVisible=visible,this.$scope.navigationHomeOnly=void 0===homeOnly?(this.rect.width<400||this.rect.height<400||!this._data.navigation)&&!this.backendApi.isSnapshot&&this._layoutMode>3:homeOnly,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+13+"px"},void 0===this._timeoutID&&(this._timeoutID=setTimeout(function(){self._timeoutID=void 0,self.$scope.$digest()}))}var Map,namespace=".map",epsilon=1e-9,MAX_NUM_LAYERS=1;return Map=Chart.extend("Map",{namespace:namespace,init:function($scope,$element,options,backendApi){var self=this;options=$.extend(!0,options||{},{providers:{colorMap:{clazz:ColorMap,multiDimScheme:"first",colorBy:"primary",autoMode:"primary"}},components:{dataArea:{show:!0,dock:"center",clazz:MapArea,showFlag:ChartComponent.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:ChartComponent.prototype.ShowFlags.MEDIUM}}}),this._super($scope,$element,options,backendApi),this.backendApi=backendApi,this.components.colorLegend.hideComponent(),this._autoZoomOnDataChange=!0,this._worldBounds=new Rect(-180,-180,360,360),this._unitProjection=new UnitProjection,this.setViewportProjection(new ViewportProjection),setProjection.call(this,this._unitProjection),this.interactionController=new InteractionController(this,this._viewportProjection),this.components.dataArea.setMaxNumLayers(MAX_NUM_LAYERS),this.components.dataArea.setMap(this),this.components.dataArea.setBackendApi(this.backendApi),this.components.dataArea.setLegend(this.components.colorLegend),this.components.dataArea.setChartContext(this._chartContext),this.components.dataArea.setInteractionController(this.interactionController),this._changeWatchers=this._changeWatchers||[],this._changeWatchers.push(Binding.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(Binding.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this.onNavigationPressed=$scope.$on("navigationPressed",function(e,arg){e.preventDefault(),self.interactionController.navigate(arg)}),this.$scope.navigationDisabled=!0,this._scaleMapOnResize=!0},setFormatter:function(formatter){var component;if(this.chartFormatter=formatter,this.chartFormatter){for(component in this.components)this.components[component].chartFormatter=this.chartFormatter,this.components[component].measureFormatters=this.chartFormatter.getFormatters(),this.components[component].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter();this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters())}},setViewportProjection:function(vp){this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished",onResetZoomFinished,this),this._viewportProjection.stopListen("changed",onViewportProjectionChanged,this),this._viewportProjection.stopListen("changedByInteraction",onViewportProjectionChanged,this)),this._viewportProjection=vp,this.components.dataArea.setViewportProjection(this._viewportProjection),this._viewportProjection&&(this._viewportProjection.listen("resetZoomFinished",onResetZoomFinished,this),this._viewportProjection.listen("changed",onViewportProjectionChanged,this),this._viewportProjection.listen("changedByInteraction",onViewportProjectionChanged,this))},getViewportProjection:function(){return this._viewportProjection},suppressOnPaint:function(data){var ret;return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,ret=!1):ret=data.qSelectionInfo&&data.qSelectionInfo.qInSelections,ret&&this.prePaint(data),ret},prePaint:function(data){this._super();var self=this,showingDisclaimer=!1;data.layers.forEach(function(layer){var dataObject=layer.qHyperCube?layer.qHyperCube:layer.qListObject,numItems=dataObject&&dataObject.qDataPages&&dataObject.qDataPages[0]&&dataObject.qDataPages[0].qMatrix?dataObject.qDataPages[0].qMatrix.length:0;self.$scope.dataAttributes.limitedData=numItems>0&&dataObject.qSize.qcy>numItems,self.$scope.dataAttributes.limitedData&&(showingDisclaimer=!0)}),this.$scope.options.showDisclaimerStar=showingDisclaimer,this.$element.toggleClass("qv-viz-with-disclaimer",showingDisclaimer)},_updateData:function(data,options){var dfds=[];this.layersReadyDfd=Deferred(),this.layersReady=this.layersReadyDfd.promise,this._data=data,this._readStoredData=data&&data.snapshotData&&data.snapshotData.content&&!this.isEffect&&this.backendApi.isSnapshot,this.setAutoZoomOnDataChange(this._data.autoZoomOnSelection||void 0===this._data.autoZoomOnSelection),this.updateSelectableState(data),dfds.push(this.components.dataArea.setData(data)),this.selections&&this.selections.types&&this.selections.types.tooltip&&(this.selections.types.tooltip.enabled=this.components.dataArea.hasVisibleLayer(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this.updateLegend(data,options);var dfd=Deferred.all(dfds);this._dfdUpdatingData=dfd},_postResize:function(){this._super(),updateLegendPosition.apply(this,[this.components.colorLegend,this._data])},updateLegend:function(data){if(this.components.colorLegend){updateLegendPosition.apply(this,[this.components.colorLegend,data]);var b=data&&data.legend&&data.legend.show;b=b&&this.components.dataArea.hasVisibleLayer(),b?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()}},updateSelectableState:function(data){this.selections&&(this.isDataSelectable(data||this._data)?(this.selections.setLocked(!1),this.components.colorLegend.setLocked(!1),"byMeasure"===this._data.color.mode&&this._data.layers[0].qListObject?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):(this.selections.setLocked(!0),this.components.colorLegend.setLocked(!0)))},isValid:function(data){var component,valid=isDataValid(data);for(component in this.components)this.components[component].setHasValidData(valid);return valid},isDataSelectable:function(data){if(!this.isValid(data)||!this.allowInteraction(State))return!1;var i,numLayers=Math.min(data.layers.length,MAX_NUM_LAYERS);for(i=0;numLayers>i;i++){if(data.layers[i].qListObject&&isListObjectSelectable(data.layers[i].qListObject))return!0;if(data.layers[i].qHyperCube&&isHyperCubeSelectable(data.layers[i].qHyperCube))return!0}return!1},setAutoZoomOnDataChange:function(b){this._autoZoomOnDataChange=!!b},getAutoZoomOnDataChange:function(){return this._autoZoomOnDataChange},setScaleMapOnResize:function(b){this._scaleMapOnResize=b},getScaleMapOnResize:function(){return this._scaleMapOnResize},setMapCenter:function(c){this.interactionController.setMapCenter(c)},getMapCenter:function(){return this.interactionController.getMapCenter()},setZoomLevel:function(z){this.interactionController.setZoomLevel(z)},getZoomLevel:function(){return this.interactionController.getZoomLevel()},setMapBounds:function(rect){this._mapBounds=rect.clone(),this.interactionController.setMapBounds(rect),this._autoZoomOnDataChange||(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getMapRectOfViewportIfZoomOnAMapRect(this._mapBounds),this.updateNavigation())},zoomOnMapBounds:function(){return this.interactionController.zoomOnMapBounds()},setFractionalZoomMode:function(b){this.interactionController.setFractionalZoomMode(b)},getFractionalZoomMode:function(){return this.interactionController.getFractionalZoomMode()},setZoomPanByWebkitTransform:function(b){this.interactionController.setZoomPanByWebkitTransform(b)},getZoomPanByWebkitTransform:function(){return this.interactionController.getZoomPanByWebkitTransform()},on:function(){return this._on?void this._super():(this.interactionController.on(namespace,this.components.dataArea.container),Touche(this.container).longtap({id:namespace}),this._super(),this.$scope.navigationDisabled=!1,void(this._on=!0))},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",namespace),Touche(this.container).off("*",namespace),$(this.components.dataArea.container).off(namespace),$(this.container).off(namespace),this._super(),this._on=!1)},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.Pan.bind(this.interactionController.onPan.bind(this.interactionController)),this.options._disableSelections||(this.selections.Activated.bind(this.Activated.bind(this)),this.selections.Deactivated.bind(this.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShapes.bind(this.ToggleShapes.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},selectWhileLocked:function(){var data,dimensions=[];this._data.layers.forEach(function(element){data=element.qHyperCube?element.qHyperCube:element.qListObject,dimensions.push(data.qDimensionInfo instanceof Array?data.qDimensionInfo[0]:data.qDimensionInfo)}),EventUtils.showLockedFeedback(dimensions)},ToggleShapes:function(cacheItems,toggleFlag){if(cacheItems&&0!==cacheItems.length){var layer,cacheItemsByLayerArray,numLayers,layerIndex,cacheItemsByLayer,autoMode,n,self=this;for(this._haveToggledShapes=!1,
this._renderOnToggleShapes=!0,setTimeout(function(){self._renderOnToggleShapes&&self.onSelection.scheduleInvalidation.call(self,!0),self._renderOnToggleShapes=!1},50),numLayers=this._data&&this._data.layers?Math.min(this._data.layers.length,MAX_NUM_LAYERS):0,cacheItemsByLayerArray=groupCacheItemsByLayer(cacheItems),autoMode=4===(4&toggleFlag)?!0:!1,this._layerIndexOfClick=-1,layerIndex=numLayers-1;layerIndex>-1;layerIndex--)if(layer=this.components.dataArea.layers[layerIndex],cacheItemsByLayer=cacheItemsByLayerArray[layerIndex],n=cacheItemsByLayer?cacheItemsByLayer.length:0,layer.isVisible()&&0!==n&&(layer.toggleShapes(cacheItemsByLayer),autoMode))return this._layerIndexOfClick=layerIndex,void deselectCacheItemsOfBottomLayers(cacheItems,cacheItemsByLayerArray,layerIndex-1)}},Activated:function(){this.onSelection.Activated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!0)},Deactivated:function(){this._renderOnToggleShapes=!1,this.onSelection.Deactivated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Cancel:function(){this.onSelection.Cancel.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Clear:function(){this.onSelection.Clear.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Select:function(cacheItems,toggle,dimension){var i,cacheItemsByLayerArray=groupCacheItemsByLayer(cacheItems),dimensions=Array.isArray(dimension)?dimension:[dimension||0],layers=this.components.dataArea.layers,n=layers?layers.length:0;if(-1===this._layerIndexOfClick){for(i=0;n>i;i++)"hyperCube"===layers[i].getDataType()&&layers[i].selectOnLayer(cacheItemsByLayerArray[i],dimensions);for(i=0;n>i;i++)"listObject"===layers[i].getDataType()&&layers[i].selectOnLayer(cacheItemsByLayerArray[i],dimensions)}else i=this._layerIndexOfClick,layers[i].selectOnLayer(cacheItemsByLayerArray[i],dimensions)},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var component;for(component in this.components)this._changeWatchers.push(Binding.bindProperty(this.components[component],"layoutMode",this,"layoutMode"));this.components.dataArea&&this._changeWatchers.push(Binding.bindSetter(updateSelectionCache.bind(this),this.components.dataArea,"selectableShapes"))},resize:function(){return this._resizing=!0,this._super().then(function(){this._resizing=!1}.bind(this))},layout:function(){this._super();var vp=this.components.dataArea?this.components.dataArea.rect:this.rect;setViewportSize.call(this,{x:vp.width,y:vp.height}),this.components.dataArea.setRect(vp.x,vp.y,vp.width,vp.height),this.components.dataArea.updateSize(),this.components.dataArea&&this.interactionController.setOffset($(this.components.dataArea.container).offset())},setPreselectionMode:function(b){this._preselectionMode=b,this.components.dataArea.setPreselectionMode(b)},_paint:function(){var zup=this._super.bind(this);return this.layersReady.then(function(){return zup().then(function(o){if(!o||!o.invalid){var key,dfds=[];if(this._layouting=!0,this.layout(),this._layouting=!1,this.options.viewState||this.backendApi.isSnapshot&&this._readStoredData){var storedData=this.options.viewState||this.getSnapshotStoredChartData(),mapRect=storedData.mapRect;mapRect&&void 0!==mapRect.width&&void 0!==mapRect.height&&void 0!==mapRect.x&&void 0!==mapRect.y?this._viewportProjection.zoomOnMapRectangle(mapRect,!0):this.zoomOnMapBounds()}else!this._inZoomOnMapBoundsMode||this._firstTimeZoomOnMapBound&&!this._autoZoomOnDataChange?this._scaleMapOnResize&&this._mapRect&&this._viewportProjection.zoomOnMapRectangle(this._mapRect,!0):this._firstTimeZoomOnMapBound=this.zoomOnMapBounds();for(key in this.components)dfds.push(this.components[key].invalidateDisplay("Map._paint"));return this._dfdUpdatingData&&dfds.push(this._dfdUpdatingData),this.updateNavigation(),this._dataChanged=!1,Deferred.all(dfds)}}.bind(this))}.bind(this))},updateNavigation:function(hideNavigation){var homeOnly,visible;this._data&&this.rect&&this._mapRect&&(homeOnly=(this.rect.width<400||this.rect.height<400||!this._data.navigation)&&this._on&&!State.isInEditMode()&&this._layoutMode>3,this._inZoomOnMapBoundsMode=isInZoomOnMapBoundsMode.call(this),visible=void 0===hideNavigation?(!this._inZoomOnMapBoundsMode||!!this._data.navigation)&&this._on&&!State.isInEditMode()&&(this._layoutMode>3||homeOnly&&this._layoutMode>=3):!hideNavigation,setNavigation.apply(this,[visible,homeOnly]))},getContextMenu:function(obj,menu){var object=obj,model=object.model,persistingUpdate=State.isInEditMode(),layout=model.layout;object.isReadonly&&persistingUpdate||menu.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(persistingUpdate)model.getProperties().then(function(properties){properties.navigation=!properties.navigation,model.save()});else{var params=[[],!0];params[0][0]={qPath:"/navigation",qOp:void 0===layout.navigation?"add":"replace",qValue:layout.navigation?"false":"true"},object.backendApi.applyPatches(params)}}})},destroy:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished"),this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this.onNavigationPressed()},getAppViewState:function(){return State.state},setSnapshotData:function(snapshotLayout){var promises=[];if(this._super(snapshotLayout),this.isSnapshot())return Deferred.resolve();for(var i=0;i<this._data.layers.length;i++)promises[i]=this.components.dataArea.layers[i].getSnapshotLayerData(snapshotLayout.layers[i]);return Deferred.all(promises)},getSnapshotChartData:function(){return $.extend(!0,this._super()||{},{mapRect:this._viewportProjection.getMapRectOfViewport()})},getViewState:function(){return{mapRect:this._viewportProjection.getMapRectOfViewport()}},isSnapshot:function(){return this.backendApi&&this.backendApi.isSnapshot}}),{type:"map",BackendApi:MapApi,template:template,View:Map,definition:mapPropertiesDefinition,initialProperties:{layers:[]},exportProperties:null,importProperties:null,getDimensionInfo:function(){return[]},getMeasureInfo:function(){return[]},onStateChanged:function(state){this.components.dataArea.baseMapLayer&&this.components.dataArea.baseMapLayer.setAppViewState(state)},mapProperties:function(){this.mappedDefinition=propertyMapper.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1,max:1,ppPath:"data"}},addFieldDimension:mapLayerCreation.addFieldDimension,addLibraryDimension:mapLayerCreation.addLibraryDimension,addDimensionPopoverComponent:addLayerPopoverComponent,getDropFieldOptions:mapLayerCreation.getDropFieldOptions,getDropDimensionOptions:mapLayerCreation.getDropDimensionOptions,getDropMeasureOptions:mapLayerCreation.getDropMeasureOptions,getCreatePropertyHandler:function(){return new MapHandler(this.dimensionDefinition)},hasError:function(args){var i,layer,layout=args.layout;for(i=0;i<layout.layers.length;++i){if(layer=layout.layers[i],layer.qHyperCube&&layer.qHyperCube.qError)return layer.qHyperCube.qError;if(layer.geodata&&layer.geodata.qHyperCube&&layer.geodata.qHyperCube.qError)return layer.geodata.qHyperCube.qError}return!1},showRequirements:function(args){var layout=args.layout;return!layout.layers||!layout.layers.length},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}}}}),define("extensions.qliktech/combochart/markerarea",["core.utils/deferred","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","extensions.qliktech/linechart/layers/oob-layer"],function(Deferred,ChartComponent,CanvasRenderer,Container,Circle,Polygon,Rect,OOBLayer){function createShape(type){switch(type){case"diamond":case"triangle":return new Polygon;case"circle":return new Circle;case"line":return new Rect;default:return new Rect}}function updateShape(shape,x,y,size,data,selected){var s,type=data.type,color=data.rgb,shiftedColor=data.shiftedRgb,halfStrokeWidth=.5,isFilled=data.isFilled,fillable=!0;switch(type){case"circle":shape.set(x,y,Math.max(2,Math.min(6,.125*size)));break;case"diamond":s=Math.max(2,Math.min(12,.25*size)),shape.set([{x:x,y:y-s/2},{x:x-s/2,y:y},{x:x,y:y+s/2},{x:x+s/2,y:y}]);break;case"triangle":s=Math.max(2,Math.min(12,.25*size)),shape.set([{x:x,y:y-s/2},{x:x-s/2,y:y+s/2},{x:x+s/2,y:y+s/2}]);break;case"line":s=Math.max(2,.5*size),24>s?shape.set(x-s/2,Math.floor(y)-halfStrokeWidth,s,Math.min(3,Math.max(2,Math.round(s/4)))):shape.set(Math.floor(x-s/2)-halfStrokeWidth,Math.floor(y)-halfStrokeWidth,Math.ceil(s),Math.min(3,Math.max(2,Math.round(s/4)))),isFilled=!0;break;default:s=Math.max(2,Math.min(12,.25*size)),shape.set(x-s/2,y-s/2,s,s)}fillable&&isFilled!==!1?(shape.fill=color,shape.stroke=shiftedColor):(shape.stroke=color,delete shape.fill),selected&&(shape.stroke="#000000")}function updateMarkers(axesSettings){var i,x,y,minor,minorSettings,size,shape,num=this._shapes?this._shapes.length:0,rw=this.rect.width,major=this._majorAxis;for(this._outOfRange={up:{},down:{},points:[]},i=0;num>i;i++)shape=this._shapes[i],minor=this._minorAxes[shape.data.axisIdx],minorSettings=axesSettings[this._measureToAxisIndex[shape.data.measureIdx]],size=major.getWidthOfId(shape.data.axisId),x=major.getPositionOfId(shape.data.axisId),y=minor.getPositionOfValue(shape.data.end),shape.data.x=x,shape.data.y=y,shape.data.outOfRangeUp=y<minorSettings.topCutoff,shape.data.outOfRangeDown=y>minorSettings.bottomCutoff,shape.data.selected=shape.data.cacheItem&&shape.data.cacheItem.selected,shape.opacity=shape.data.outOfRangeUp||shape.data.outOfRangeDown?0:shape.data.selected?1:this._globalAlpha,y=shape.data.outOfRangeUp?minorSettings.topCutoff+4:shape.data.outOfRangeDown?minorSettings.bottomCutoff-4:Math.floor(y),updateShape(shape,x,y,size,shape.data,shape.data.cacheItem&&shape.data.cacheItem.selected),shape.data.isVisible=x>0&&rw>x,shape.data.isVisible&&(shape.data.outOfRangeUp||shape.data.outOfRangeDown)&&(shape.data.outOfRangeUp&&!this._outOfRange.up[x]?(this._outOfRange.points.push(shape),this._outOfRange.up[x]=!0):shape.data.outOfRangeDown&&!this._outOfRange.down[x]&&(this._outOfRange.points.push(shape),this._outOfRange.down[x]=!0))}var MarkerArea;return MarkerArea=ChartComponent.extend("MarkerArea",{init:function(){this._super.apply(this,arguments),this.renderers={markers:new CanvasRenderer(this.container,{name:"marker-layer"})},this._oobLayer=new OOBLayer(this.container),this.layers=[this._oobLayer],this._markerRenderer=this.renderers.markers},setColorMap:function(c){this._colorMap=c},getColorMap:function(){return this._colorMap},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(v){this._measureIndices=v},setMajorAxis:function(ax){this._majorAxis=ax,this._majorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMajorAxis")},this)},setMinorAxis:function(ax){this._minorAxis=ax,this._minorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMinorAxis")},this)},setSecondaryMinorAxis:function(ax){this._secondaryMinorAxis=ax,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setSecondaryMinorAxis")},this)},setDimensionTree:function(t){this._tree=t,this.invalidateProperties()},hasValidData:function(){return this._super()&&this._data},getMajorAxisData:function(){return this._majorAxisData},createAxisData:function(data,staticProps,dynamicProps,level){level||(this._cacheIndex=0);var dataChildren=data.children;return dataChildren.map(function(d){var obj;return"dimension"===staticProps.types[level]&&(obj={label:d.data.qText,group:!1,id:d.data.id,cacheIndex:[]},"measure"===staticProps.types[level+1]&&obj.cacheIndex.push(this._cacheIndex++)),obj},this)},_createMeasureDisplayNode:function(dataNode,measureIndex,type,isFilled){var c=createShape(type),valueNode=dataNode.children[0].data,cacheItem=dataNode.parent.cacheItem,formatter=this.measureFormatters[measureIndex],value="undefined"!=typeof valueNode.qValue?valueNode.qValue:valueNode.qNum,ids=dataNode.ancestors.filter(function(d){return"qElemNo"in d.data}).map(function(d){return d.data.qElemNo}).reverse();return c.data={qText:dataNode.data.qText,qNum:value,start:0,end:value,valueLabel:formatter&&"U"===formatter.type?formatter.formatValue(value):dataNode.data.qText,cacheItem:cacheItem,type:type,isFilled:isFilled,measureIdx:measureIndex,color:this._colorMap.getColor(ids,value,measureIndex,dataNode.data.rowIndex)},cacheItem.addShape("dataArea",c,!0),c.fill=c.data.color.toHex(),c.data.rgb=c.data.color.toRGBA(),c.data.shiftedRgb=c.data.color.createShiftedColor().toRGBA(),c},_createDimensionDisplayNode:function(dataNode){var c=new Container;return c.data={qText:dataNode.data.qText},c},_applyIds:function(data,cols,types,level){var temp;data.children.forEach(function(d,idx){temp=data.data.id?data.data.id+";"||"":"","dimension"===types[level]?(d.data.id=temp+cols[level]+":"+d.data.qElemNo,this._applyIds(d,cols,types,level+1)):"measure"===types[level]&&(d.data.id=temp+cols[level+idx])},this)},getRenderTree:function(data,staticProps,dynamicProps,level){var children,dataChildren,measureIndex;return dataChildren=data.children,"measure"===staticProps.types[level]&&this._measureIndices&&(dataChildren=dataChildren.filter(function(c,idx){return this._measureIndices.indexOf(idx)>=0},this)),dataChildren.map(function(d,idx){var cntnr;return"dimension"===staticProps.types[level]?(cntnr=this._createDimensionDisplayNode(d),children=this.getRenderTree(d,staticProps,dynamicProps,level+1),children.forEach(function(child){cntnr.addChild(child)})):"measure"===staticProps.types[level]&&(measureIndex=this._measureIndices?this._measureIndices[idx]:idx,cntnr=this._createMeasureDisplayNode(d,measureIndex,this._data.qHyperCube.qMeasureInfo[measureIndex].series.marker||"circle",this._data.qHyperCube.qMeasureInfo[measureIndex].series.markerFill),cntnr.data.axisId=d.parent.data.id,cntnr.data.axisIdx=staticProps.measureToAxisIndex[measureIndex],dynamicProps.shapes.push(cntnr)),cntnr},this)},_updateProperties:function(){if(this._markerRenderer.stage.removeChildren(),this._data&&this._tree){var dynamicProps,staticProps,numDimensions=this._data.qHyperCube.qDimensionInfo.length,numMeasures=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,numLevels=numDimensions+1,levelTypes=new Array(numDimensions).join(",").split(",").map(function(){return"dimension"}),colIds=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(o){return o.cId}),qApprMaxGlyphCount=this._data.qHyperCube.qDimensionInfo.map(function(d){return d.qApprMaxGlyphCount});qApprMaxGlyphCount.push(this._data.qHyperCube.qMeasureInfo.reduce(function(prev,current){return Math.max(prev,current.qApprMaxGlyphCount)},0)),this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis);var measureAxes=this._minorAxes,measureToAxis=[],measureIndices=[];if(this._measureIndices)measureIndices=this._measureIndices;else if(numMeasures>0&&20>numMeasures)for(;measureIndices.length<numMeasures;)measureIndices.push(measureIndices.slice(-1)[0]+1||0);measureIndices.forEach(function(v){measureToAxis[v]=measureAxes.filter(function(x){return x._dataIndices?x._dataIndices.indexOf(v)>=0:!0})[0]}),this._measureToAxis=measureToAxis,this._measureToAxisIndex=measureToAxis.map(function(axis){return measureAxes.indexOf(axis)}),levelTypes.push("measure"),dynamicProps={shapes:[],shapesToLabel:[],globalPositiveSum:0,globalNegativeSum:0},staticProps={colIds:colIds,types:levelTypes,numLevels:numLevels,numMeasures:numMeasures,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails)},this._applyIds(this._tree,colIds,levelTypes,0);var objects=this.getRenderTree(this._tree,staticProps,dynamicProps,0);this._objects=objects,this._shapes=dynamicProps.shapes,objects.forEach(function(o){this._markerRenderer.stage.addChild(o)},this);var axisDataArray=this.createAxisData(this._tree,staticProps,dynamicProps,0),axisLabelLevelsDetails=levelTypes.map(function(v,idx){return{qApprMaxGlyphCount:qApprMaxGlyphCount[idx],show:idx<levelTypes.length-1}});this._majorAxisData={data:axisDataArray,info:axisLabelLevelsDetails},this.setSelectableShapes(dynamicProps.shapes.map(function(s){return s.data.cacheItem}))}},paint:function(){this._super(this._layoutMode,this._data);var axesSettings=this._minorAxes.map(this._getAxisDetails),dfds=[];return updateMarkers.call(this,axesSettings),this._oobLayer&&(this._oobLayer.update(this._outOfRange.points,{measureToAxisIndex:this._measureToAxisIndex,axesSettings:axesSettings,globalAlpha:this._globalAlpha,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)}),dfds.push(this._oobLayer.render())),dfds.push(this._markerRenderer.render()),Deferred.all(dfds)},updateSize:function(){this._super(),this.renderers.markers.setDimensions(0,-1,this.rect.width,this.rect.height),this.layers.forEach(function(layer){layer.rect=this.rect,layer.renderer.setDimensions(0,0,this.rect.width,this.rect.height),layer.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this)},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},clear:function(){this._super(),this.layers.forEach(function(layer){layer.clear()})},_getAxisDetails:function(axis){var plotMin=axis.getPlotMin(),plotMax=axis.getPlotMax(),plotRange=plotMax-plotMin,axisPadding=axis.getPadding(),topCutoff=axisPadding.top-1,bottomCutoff=axis.rect.height-axisPadding.bottom,areaStartBase=0;return areaStartBase=plotMin>0?bottomCutoff:0>plotMax?topCutoff:Math.floor(axis.getPositionOfValue(0))-.5,{plotMin:plotMin,plotMax:plotMax,posMin:axis.getPositionOfValue(plotMin),posMax:axis.getPositionOfValue(plotMax),plotRange:plotRange,topCutoff:topCutoff,bottomCutoff:bottomCutoff,areaStartBase:areaStartBase,zeroPos:Math.floor(axis.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/combochart/comboarea",["objects.views/charts/components/chart-component","extensions.qliktech/linechart/linearea","extensions.qliktech/barchart/bararea","extensions.qliktech/combochart/markerarea","core.utils/deferred"],function(ChartComponent,LineArea,BarArea,MarkerArea,Deferred){"use strict";var ComboArea;return ComboArea=ChartComponent.extend("ComboArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=null;var bararea=new(Function.prototype.bind.apply(BarArea,[null].concat([].slice.call(arguments)))),linearea=new(Function.prototype.bind.apply(LineArea,[null].concat([].slice.call(arguments)))),markerarea=new(Function.prototype.bind.apply(MarkerArea,[null].concat([].slice.call(arguments))));linearea.setShowDataPoints(!0),linearea.setShowDataPointLabels(!1),bararea.setShowDataPoints(!1),this.subComponents=[bararea,linearea,markerarea],this.lineArea=linearea,this.barArea=bararea,this.markerArea=markerarea},setColorMap:function(v){this._colorMap=v,this.subComponents.forEach(function(c){c.setColorMap(v)})},getColorMap:function(){return this._colorMap},setShowDataPoints:function(){},setMajorAxis:function(ax){this.subComponents.forEach(function(c){c.setMajorAxis(ax)}),this._majorAxis=ax},setMinorAxis:function(ax){this._minorAxis=ax,this.subComponents[0].setMinorAxis(this._minorAxis),this.subComponents[2].setMinorAxis(this._minorAxis)},setSecondaryMinorAxis:function(ax){this._secondaryMinorAxis=ax},setDimensionTree:function(t){this._tree=t,this.subComponents.forEach(function(c){c.setDimensionTree(t)})},setData:function(v){this._super(v);for(var lineSeries=[],barSeries=[],markerSeries=[],i=0;i<v.qHyperCube.qMeasureInfo.length;i++)v.qHyperCube.qMeasureInfo[i].series&&"line"===v.qHyperCube.qMeasureInfo[i].series.type?lineSeries.push(i):v.qHyperCube.qMeasureInfo[i].series&&"marker"===v.qHyperCube.qMeasureInfo[i].series.type?markerSeries.push(i):barSeries.push(i);this.subComponents[0].setHasValidData(barSeries.length>0),this.subComponents[1].setHasValidData(lineSeries.length>0),this.subComponents[2].setHasValidData(markerSeries.length>0),this.lineArea.setMeasureIndices(lineSeries),this.barArea.setMeasureIndices(barSeries),this.markerArea.setMeasureIndices(markerSeries),this.subComponents.forEach(function(c){c.setData(v)}),this.barArea.setMinorAxis(this._minorAxis),this.lineArea.setMinorAxis(this._secondaryMinorAxis),this.lineArea.setSecondaryMinorAxis(this._minorAxis),this.markerArea.setMinorAxis(this._minorAxis),this.markerArea.setSecondaryMinorAxis(this._secondaryMinorAxis),this.invalidateProperties()},setHasValidData:function(v){this.subComponents.forEach(function(c){c.setHasValidData(v)})},setLayoutMode:function(v){this._super(v),this.subComponents.forEach(function(c){c.setLayoutMode(v)})},setRect:function(x,y,w,h){this._super(x,y,w,h),this.subComponents.forEach(function(c){c.setRect(x,y,w,h)})},setOuterRect:function(x,y,w,h){this._super(x,y,w,h),this.subComponents.forEach(function(c){c.setOuterRect(x,y,w,h)})},setLayoutToContainerRatios:function(x,y){this._super(x,y),this.subComponents.forEach(function(c){c.setLayoutToContainerRatios(x,y)})},setContainerRect:function(x,y,w,h){this._super(x,y,w,h),this.subComponents.forEach(function(c){c.setContainerRect(x,y,w,h)})},insertAdjacentTo:function(){this._super.apply(this,[].slice.call(arguments)),this.subComponents.forEach(function(c){c.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},this)},setGlobalOpacity:function(x,skipInvalidation){this._super(x,skipInvalidation),this.subComponents.forEach(function(c){c.setGlobalOpacity(x,skipInvalidation)},this)},setLineType:function(){},updateSize:function(){this._super(),this.subComponents.forEach(function(layer){layer.updateSize()},this)},_updateDisplay:function(){var dfds=[];return this.subComponents.forEach(function(c){dfds.push(c.invalidateDisplay())}),Deferred.all(dfds)},_updateSize:function(){},_updateProperties:function(){if(this._data&&this._tree){this.subComponents[0].updateNow(["properties"]),this.subComponents[1].updateNow(["properties"]),this.subComponents[2].updateNow(["properties"]);var cacheItems=this.subComponents[0].getSelectableShapes();cacheItems&&cacheItems.length||(cacheItems=this.subComponents[1].getSelectableShapes()),cacheItems&&cacheItems.length||(cacheItems=this.subComponents[2].getSelectableShapes()),this.setSelectableShapes(cacheItems)}},invalidateProperties:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this.subComponents.forEach(function(c){c.invalidateProperties("ComboArea.invalidateProperties")})},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow()},release:function(){this.subComponents.forEach(function(comp){comp.release()})}})}),define("extensions.qliktech/combochart/combochart-properties",["translator","general.utils/property-resolver"],function(translator,propertyResolver){function getMeasures(data,handler,axisIndex){var measureInfo,axIdx=axisIndex||0;measureInfo=handler?handler.getMeasureLayouts():propertyResolver.getValue(data,"qHyperCubeDef.qMeasures",[]).map(function(m){return m.qDef});var measures=measureInfo.filter(function(measure){return propertyResolver.getValue(measure,"series.axis",0)===axIdx||0===axIdx&&"bar"===propertyResolver.getValue(measure,"series.type","bar")});return measures}function getDimensions(data,handler){return handler?handler.getDimensionLayouts():data.qHyperCubeDef.qDimensions.map(function(m){return m.qDef})}function showLineChartSettings(data,handler){return handler.getMeasures().filter(function(m){return m.qDef.series&&"line"===m.qDef.series.type}).length>0}function showBarChartSettings(data,handler){return handler.getMeasures().filter(function(m){return!m.qDef.series||"bar"===m.qDef.series.type}).length>1}var settings,data,addons,sorting;return settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,show:function(data,handler){return showLineChartSettings(data,handler)||showBarChartSettings(data,handler)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"ª",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(data,handler){return showBarChartSettings(data,handler)}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,show:!1,items:[{component:"icon-item",icon:"º",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"Ω",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap",show:function(data,handler){return showLineChartSettings(data,handler)&&handler.getMeasures().length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1,show:function(data,handler){return showLineChartSettings(data,handler)}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(properties,handler){var label,direction="x",dimensions=getDimensions(properties,handler).map(function(d){return d.qFallbackTitle||""}).join(", ");return label=dimensions?translator.get("properties."+direction+"AxisWithInfo",[dimensions]):translator.get("properties."+direction+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(data){return["all","labels"].contains(data.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(data){return"none"!==data.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(properties,handler){var label,measures=getMeasures(properties,handler,0).map(function(m){return m.qFallbackTitle});return label=measures.length?translator.get("properties.yAxisWithInfo",[measures.join(",")]):translator.get("properties.yAxis")},show:function(properties){return getMeasures(properties,null,0).length>0},items:{axis:{items:{show:{ref:"measureAxes.0.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"measureAxes.0.dock",show:function(data){return"none"!==data.measureAxes[0].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.0.spacing",show:function(data){return data.measureAxes[0]&&"none"!==data.measureAxes[0].show}}}},minMax:{items:{autoMinMax:{ref:"measureAxes.0.autoMinMax"},minMax:{ref:"measureAxes.0.minMax",defaultValue:"min",show:function(data){return!data.measureAxes[0].autoMinMax}},min:{ref:"measureAxes.0.min",show:function(data){return["min","minMax"].contains(data.measureAxes[0].minMax)&&!data.measureAxes[0].autoMinMax},invalid:function(data){return"minMax"===data.measureAxes[0].minMax?data.measureAxes[0].min>=data.measureAxes[0].max:!1}},max:{ref:"measureAxes.0.max",show:function(data){return["max","minMax"].contains(data.measureAxes[0].minMax)&&!data.measureAxes[0].autoMinMax},invalid:function(data){return"minMax"===data.measureAxes[0].minMax?data.measureAxes[0].min>=data.measureAxes[0].max:!1}}}}}},secondaryMeasureAxis:{uses:"measureAxis",label:function(properties,handler){var label,measures=getMeasures(properties,handler,1).map(function(m){return m.qFallbackTitle});return label=measures.length?translator.get("properties.yAxisWithInfo",[measures.join(",")]):translator.get("properties.yAxis")},show:function(properties){return getMeasures(properties,null,1).length>0},items:{axis:{items:{show:{ref:"measureAxes.1.show"},dock:{ref:"measureAxes.1.dock",defaultValue:"far",show:function(data){return"none"!==data.measureAxes[1].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.1.spacing",show:function(data){return data.measureAxes[1]&&"none"!==data.measureAxes[1].show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxes.1.autoMinMax"},minMax:{ref:"measureAxes.1.minMax",defaultValue:"min",show:function(data){return!data.measureAxes[1].autoMinMax}},min:{ref:"measureAxes.1.min",show:function(data){return["min","minMax"].contains(data.measureAxes[1].minMax)&&!data.measureAxes[1].autoMinMax},invalid:function(data){return"minMax"===data.measureAxes[1].minMax?data.measureAxes[1].min>=data.measureAxes[1].max:!1}},max:{ref:"measureAxes.1.max",show:function(data){return["max","minMax"].contains(data.measureAxes[1].minMax)&&!data.measureAxes[1].autoMinMax},invalid:function(data){return"minMax"===data.measureAxes[1].minMax?data.measureAxes[1].min>=data.measureAxes[1].max:!1}}}}}}}},data={uses:"data",items:{dimensions:{},measures:{items:{series:{type:"items",items:{seriesType:{ref:"qDef.series.type",type:"string",component:"item-selection-list",defaultValue:"bar",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.bar",value:"bar"},{icon:"æ",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"É",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.marker",value:"marker"}],change:function(){}},seriesAxis:{ref:"qDef.series.axis",type:"integer",component:"dropdown",defaultValue:0,options:[{translation:"properties.axis.primary",value:0},{translation:"properties.axis.secondary",value:1}],show:function(data){return data.qDef.series&&data.qDef.series.type&&"bar"!==data.qDef.series.type}},seriesMarker:{ref:"qDef.series.marker",type:"string",component:"dropdown",defaultValue:"circle",options:[{translation:"properties.marker.circle",value:"circle"},{translation:"properties.marker.rect",value:"rect"},{translation:"properties.marker.diamond",value:"diamond"},{translation:"properties.marker.triangle",value:"triangle"},{translation:"properties.marker.line",value:"line"}],show:function(data){return data.qDef.series&&"marker"===data.qDef.series.type}},seriesMarkerFill:{ref:"qDef.series.markerFill",translation:"properties.series.fill",type:"boolean",defaultValue:!0,show:function(data){return data.qDef.series&&"marker"===data.qDef.series.type&&!["line"].contains(data.qDef.series.marker)}}}}}}}},sorting={uses:"sorting"},addons={type:"items",component:"expandable-items",translation:"properties.addons",
items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("extensions.qliktech/combochart/combochart-data",["general.utils/property-resolver"],function(propertyResolver){function setColorVars(data,handler){var measures=handler.getMeasures(),mode=propertyResolver.getValue(data,"color.mode");"byMeasure"===mode&&measures.length>1?propertyResolver.setValue(data,"color.mode","byDimension"):"byDimension"===mode&&1===measures.length&&"line"===propertyResolver.getValue(measures[0].qDef,"series.type")&&propertyResolver.setValue(data,"color.mode","primary")}return{dimensions:{min:1,max:1,add:function(dimension,data,handler){setColorVars(data,handler)}},measures:{min:1,max:15,add:function(measure,data,handler){setColorVars(data,handler)},replace:function(newMeasure,oldMeasure){oldMeasure.qDef.series&&(newMeasure.qDef.series.type=oldMeasure.qDef.series.type||"bar")}}}}),define("objects.backend-api/generic-api",["./backend-api"],function(BackendApi){"use strict";function getDataPath(layout,path){if(path){if(layout[path]){if(layout[path].qHyperCube)return path+".qHyperCube";if(layout[path].qListObject)return path+".qListObject"}return-1!==path.indexOf("Def",path.length-3)?path.slice(0,path.length-3):path}return layout.qHyperCube?"qHyperCube":"qListObject"}var GenericApi;return GenericApi=BackendApi.extend("GenericApi",{init:function(model,path){var dataPath=getDataPath(model.layout,path);this._super(model,"/"+dataPath+"Def"),this.isHyperCube=-1!==this.dataPath.indexOf("qHyperCube"),this.cacheCube.setMethodName(this.isHyperCube?"GetHyperCubeData":"GetListObjectData")},getBackendApi:function(path){return new GenericApi(this.model,path)},getProperties:function(){return this.model.getProperties()},setProperties:function(props){return this.model.setProperties(props)},applyPatches:function(qPatches,softPatch){return this.model.applyPatches(qPatches,softPatch)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.save()},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},updateCache:function(layout){layout&&layout[this.dataPath]?(this.cacheCube.set(layout[this.dataPath].qDataPages),this.cacheCube.setCubeSize(layout[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(pages){var dfd=this.cacheCube.getData(pages),self=this;return dfd.then(function(dataPages){self.model.layout[self.dataPath].qDataPages.push(dataPages[0])}),dfd},getDataRow:function(rownum){var myData=this.model.layout[this.dataPath];if(myData)for(var len=myData.qDataPages.length,i=0;len>i;i++){var page=myData.qDataPages[i];if(rownum>=page.qArea.qTop&&rownum<page.qArea.qTop+page.qArea.qHeight)return page.qMatrix[rownum-page.qArea.qTop]}return null},selectValues:function(dimNo,values,toggleMode){return this.isHyperCube?this.model.rpc("SelectHyperCubeValues",null,[this.path,dimNo,values,toggleMode]):this.model.rpc("SelectListObjectValues",null,[this.path,values,toggleMode])},select:function(values,dimNo,toggleMode){return this.selectValues(dimNo,values,toggleMode)},getReducedData:function(pages,zoomFactor,reductionMode){return this.isHyperCube?this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,pages,zoomFactor,reductionMode||"D1"]):null},selectRange:function(qRanges,qOrMode,qColumnsToSelect){return qOrMode=!!qOrMode,qColumnsToSelect=qColumnsToSelect||[],this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,qRanges,qColumnsToSelect,qOrMode])},search:function(term){return this.isHyperCube?null:this.model.rpc("SearchListObjectFor",null,[this.path,term])},abortSearch:function(){return this.isHyperCube?null:this.model.rpc("AbortListObjectSearch",null,[this.path])},acceptSearch:function(toggleMode){return this.isHyperCube?null:this.model.rpc("AcceptListObjectSearch",null,[this.path,toggleMode])},getPivotData:function(qPages){return this.isHyperCube?this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,qPages]):null},getStackData:function(qPages,qMaxNbrCells){return this.isHyperCube?this.model.rpc("GetHyperCubeStackData","qDataPages",[this.path,qPages,qMaxNbrCells||1e3]):null},expandTop:function(qRow,qCol,qAll){return this.model.rpc("ExpandTop",null,[this.path,qRow,qCol,qAll||!1])},expandLeft:function(qRow,qCol,qAll){return this.model.rpc("ExpandLeft",null,[this.path,qRow,qCol,qAll||!1])},collapseTop:function(qRow,qCol,qAll){return this.model.rpc("CollapseTop",null,[this.path,qRow,qCol,qAll])},collapseLeft:function(qRow,qCol,qAll){return this.model.rpc("CollapseLeft",null,[this.path,qRow,qCol,qAll])}})}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util"],function(DataPropertyHandler,Deferred,libraryUtils,arrayUtils,util){"use strict";var HyperCubeHandler,TOTAL_MAX_DIMENSIONS=1e3,TOTAL_MAX_MEASURES=1e3;return HyperCubeHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties){this._super(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties)},setProperties:function(properties){properties.qHyperCubeDef&&(this._super(properties),this.hcProperties=properties.qHyperCubeDef,this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(dimension){void 0!==dimension.autoSort&&(dimension.qDef.autoSort=dimension.autoSort,delete dimension.autoSort)}),this.hcProperties.qMeasures.forEach(function(measure){void 0!==measure.autoSort&&(measure.qDef.autoSort=measure.autoSort,delete measure.autoSort)}))},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(dimension){var dimensions=this.getDimensions(),self=this;return dimension.qDef.cId||(dimension.qDef.cId=util.generateId()),dimensions.length<this.maxDimensions()?(dimensions.push(dimension),this.autoSortDimension(dimension).then(function(){return arrayUtils.indexAdded(self.hcProperties.qInterColumnSortOrder,dimensions.length-1),"function"==typeof self.dimensionDefinition.add?Deferred.when(self.dimensionDefinition.add.call(self,dimension,self.properties,self)).then(function(){return dimension}):dimension})):dimensions.length<TOTAL_MAX_DIMENSIONS?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.push(dimension),Deferred.resolve(dimension)):void 0},addMeasure:function(measure){var measures=this.getMeasures(),self=this;return measure.qDef.cId||(measure.qDef.cId=util.generateId()),delete measure.qDef.qNumFormat,measures.length<this.maxMeasures()?(measures.push(measure),this.autoSortMeasure(measure).then(function(){return arrayUtils.indexAdded(self.hcProperties.qInterColumnSortOrder,self.getDimensions().length+measures.length-1),"function"==typeof self.measureDefinition.add?Deferred.when(self.measureDefinition.add.call(null,measure,self.properties,self)).then(function(){return measure}):measure})):measures.length<TOTAL_MAX_MEASURES?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(measure),Deferred.resolve(measure)):void 0},replaceDimension:function(index,dimension){var dimensions=this.getDimensions(),oldDimension=dimensions[index],self=this;return this.autoSortDimension(dimension).then(function(){return dimension.qDef.cId=util.generateId(),dimensions[index]=dimension,"function"==typeof self.dimensionDefinition.replace&&self.dimensionDefinition.replace.call(null,dimension,oldDimension,index,self.properties,self),dimension})},replaceMeasure:function(index,measure){var measures=this.getMeasures(),oldMeasure=measures[index],self=this;return this.autoSortMeasure(measure).then(function(){return measure.qDef.cId=util.generateId(),measures[index]=measure,"function"==typeof self.measureDefinition.replace&&self.measureDefinition.replace.call(null,measure,oldMeasure,index,self.properties,self),measure})},autoSortDimension:function(dimension){function setAutoSort(fields){fields.forEach(function(field,index){var tags=field.qTags,sortCriterias={qSortByLoadOrder:1};"function"==typeof self.dimensionDefinition.autoSort?self.dimensionDefinition.autoSort(dimension,self.properties,tags,sortCriterias,self):tags&&(tags.contains("$numeric")?sortCriterias.qSortByNumeric=1:(tags.contains("$text")||tags.contains("$ascii"))&&(sortCriterias.qSortByAscii=1)),dimension.qDef.qSortCriterias[index]=sortCriterias})}var self=this;return dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libDim){return libDim&&setAutoSort(libDim.qData.info),dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){return field&&setAutoSort([field]),dimension})},autoSortMeasure:function(measure){return measure.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},Deferred.resolve(measure)},removeDimension:function(idx){var dimension,dimensions=this.getDimensions();if(idx<dimensions.length){if(dimension=this.hcProperties.qDimensions.splice(idx,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length?dimensions.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(0,1)[0]):arrayUtils.indexRemoved(this.hcProperties.qInterColumnSortOrder,idx),"function"==typeof this.dimensionDefinition.remove)return Deferred.when(this.dimensionDefinition.remove.call(null,dimension,this.properties,this,idx))}else dimension=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(idx-dimensions.length,1);return Deferred.resolve(dimension)},removeMeasure:function(idx){var measure,measures=this.getMeasures();if(idx<measures.length){if(measure=this.hcProperties.qMeasures.splice(idx,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length?measures.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]):arrayUtils.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+idx),"function"==typeof this.measureDefinition.remove)return Deferred.when(this.measureDefinition.remove.call(null,measure,this.properties,this,idx))}else measure=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(idx-measures.length,1)[0];return Deferred.resolve(measure)},moveDimension:function(fromIndex,toIndex){var disabledFromIdx,disabledToIdx,dimension,dimensions=this.getDimensions(),disabledDimensions=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return fromIndex<dimensions.length&&toIndex<dimensions.length?arrayUtils.move(dimensions,fromIndex,toIndex):fromIndex<dimensions.length&&toIndex>=dimensions.length?(disabledToIdx=toIndex-dimensions.length,dimension=disabledDimensions.splice(0,1)[0],dimensions.push(dimension),dimension=dimensions.splice(fromIndex,1)[0],disabledDimensions.splice(disabledToIdx,0,dimension)):fromIndex>=dimensions.length&&toIndex<dimensions.length?(disabledFromIdx=fromIndex-dimensions.length,dimension=dimensions.splice(dimensions.length-1,1)[0],disabledDimensions.splice(0,0,dimension),dimension=disabledDimensions.splice(disabledFromIdx+1,1)[0],dimensions.splice(toIndex,0,dimension)):(disabledFromIdx=fromIndex-dimensions.length,disabledToIdx=toIndex-dimensions.length,arrayUtils.move(disabledDimensions,disabledFromIdx,disabledToIdx)),Deferred.resolve(dimension)},moveMeasure:function(fromIndex,toIndex){var disabledFromIdx,disabledToIdx,measure,measures=this.getMeasures(),disabledMeasures=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return fromIndex<measures.length&&toIndex<measures.length?arrayUtils.move(measures,fromIndex,toIndex):fromIndex<measures.length&&toIndex>=measures.length?(disabledToIdx=toIndex-measures.length,measure=disabledMeasures.splice(0,1)[0],measures.push(measure),measure=measures.splice(fromIndex,1)[0],disabledMeasures.splice(disabledToIdx,0,measure)):fromIndex>=measures.length&&toIndex<measures.length?(disabledFromIdx=fromIndex-measures.length,measure=measures.splice(measures.length-1,1)[0],disabledMeasures.splice(0,0,measure),measure=disabledMeasures.splice(disabledFromIdx+1,1)[0],measures.splice(toIndex,0,measure)):(disabledFromIdx=fromIndex-measures.length,disabledToIdx=toIndex-measures.length,arrayUtils.move(disabledMeasures,disabledFromIdx,disabledToIdx)),Deferred.resolve(measure)},changeSorting:function(fromIdx,toIdx){arrayUtils.move(this.hcProperties.qInterColumnSortOrder,fromIdx,toIdx)},setSorting:function(ar){ar&&ar.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=ar)}})}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(Deferred,DataPropertyHandler,listObjectUtil,libraryUtils,util){"use strict";var ListObjectHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,dimensionProperties){this._super(dimensionDefinition,null,dimensionProperties,null)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(dimension){return listObjectUtil.autoSortDimension(dimension)},getDimensions:function(){var def=this.properties.qListObjectDef.qDef;return def&&def.qFieldDefs&&def.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(dimension){function setDimension(){self.properties.qListObjectDef=util.extend(!0,self.properties.qListObjectDef,dimension),"function"==typeof self.dimensionDefinition.add&&self.dimensionDefinition.add.call(null,dimension,self.properties,self)}var self=this;return dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libDim){return libDim&&listObjectUtil.autoSortDimension(dimension,libDim.qData.info),setDimension(),dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){return field&&listObjectUtil.autoSortDimension(dimension,[field]),setDimension(),dimension})},replaceDimension:function(index,dimension){var self=this,newDef=util.extend(!0,this.properties.qListObjectDef,dimension);return listObjectUtil.autoSortDimension(dimension),dimension.qLibraryId?(delete newDef.qDef.qFieldDefs,delete newDef.qDef.qFieldLabels):delete newDef.qLibraryId,self.properties.qListObjectDef=newDef,Deferred.resolve(dimension)},removeDimension:function(){},getDimensionLayouts:function(){return[this.getDimensionLayout()]},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}});return ListObjectHandler}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div qv-extension style="height: 100%; position: relative;"></div>\r\n'}),define("client.models/snapshot",["client.models/bookmark","core.utils/deferred"],function(Bookmark,Deferred){"use strict";var Snapshot,maxLimit=500;return Snapshot=Bookmark.extend("Snapshot",{applyEmbeddedSnapshot:function(){return this.rpc("Apply")}},{listProperties:{qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}}}),Snapshot.getLibraryContent=function(objectId,update){var filteredSnapshots,deferred=new Deferred;return this.getList().then(function(snapshotModel){snapshotModel.getLayout().then(function(snapshots){filteredSnapshots=snapshots.filter(function(snapshot){var includeInList=!0;return objectId&&(includeInList=objectId===snapshot.qData.sourceObjectId),!snapshot.qData.isClone&&includeInList}),deferred.resolve(filteredSnapshots)}),snapshotModel.Invalidated&&snapshotModel.Invalidated.unbind(),snapshotModel.Invalidated.bind(update)}),deferred.promise},Snapshot.unbindList=function(){this.getList().then(function(snapshotModel){snapshotModel.Invalidated.unbind()})},Snapshot.getSnapshotCount=function(objectId){var i,deferred=new Deferred,snapshotCount=0;return this.getListLayout().then(function(snapshots){for(i=0;i<snapshots.length;i++)snapshots[i].qData.isClone||snapshots[i].qData.sourceObjectId!==objectId||snapshotCount++;deferred.resolve(snapshotCount)}),deferred.promise},Snapshot.create=function(opts,app){var i,belowLimit,deferred=new Deferred,totalCount=0;return this.getListLayout().then(function(snapshots){for(i=0;i<snapshots.length;i++)snapshots[i].qData.isClone||totalCount++;belowLimit=maxLimit>totalCount,belowLimit?Bookmark.create.call(Snapshot,opts,app).then(function(){deferred.resolve(belowLimit)}):deferred.resolve(belowLimit)}),deferred.promise},Snapshot.getEmbedded=function(id,parent){function getHandle(){return parent.rpc("GetSnapshotObject","qReturn",[])}return this.getModel(id,parent.session,getHandle)},{Snapshot:Snapshot}}),define("client.models/undo-info",["core.models/session-object","core.utils/deferred","core.models/app"],function(SessionObject,Deferred,App){"use strict";var UndoInfo;return UndoInfo=SessionObject.extend("UndoInfo",{getLayout:function(){return this._super().then(function(layout){return layout.qUndoInfo})},undo:function(){return this.layout.qUndoInfo.qUndoCount>0?App.current.rpc("Undo"):Deferred.resolve()},redo:function(){return this.layout.qUndoInfo.qRedoCount>0?App.current.rpc("Redo"):Deferred.resolve()},reset:function(){return this.getLayout().then(function(layout){return layout.qUndoCount||layout.qRedoCount?App.current.rpc("ClearUndoBuffer"):Deferred.resolve()})}}),UndoInfo.get=function(app){return app=app||App.current,SessionObject.get.call(this,{qInfo:{qType:"UndoInfo"},qUndoInfoDef:{}},app).then(function(ui){return ui.app=app,ui})},UndoInfo}),define("objects.snapshot/snapshot-helper",["jquery","util","qvangular","client.models/snapshot","core.utils/deferred","client.utils/state","client.models/undo-info"],function($,util,qvangular,SnapshotModel,Deferred,State,UndoInfoModel){function showLimitReachedDialog(){var dialog=qvangular.getService("$delayedModal"),options=util.extend(!0,{},{},{title:"Storytelling.Snapshot.MaxLimitReached.Title",html:'<p class="dm-p" q-translation="Storytelling.Snapshot.MaxLimitReached.Text"></p>'});dialog.open(options)}function allowSnapshot(objectId){var allowed=!lastSnapshottedObject||lastSnapshottedObject!==objectId;return allowed&&(lastSnapshottedObject=objectId,setTimeout(function(){lastSnapshottedObject=null},snapshotSpeedLimit)),allowed}function createSnapshot($scope,object,event,options){var layout=object.layout,objectId=layout.qInfo.qId;if(allowSnapshot(objectId)){var objectElem=$(event.target).parents(".qv-object");prepSnapshotData(layout,object,!0,options).then(function(snapshotLayout){saveSnapshot($scope,object,objectElem,snapshotLayout)})}}function prepSnapshotData(layout,object,creatingNewSnapshot,options){var def=new Deferred,date=new Date,snapshotLayout=creatingNewSnapshot?util.extend(!0,{},layout):layout;return prepareStaticContent(object,snapshotLayout).then(function(){snapshotLayout.snapshotData={object:{size:object.objectSize}},object.setSnapshotData(snapshotLayout,options||{}).then(function(){if(creatingNewSnapshot){delete snapshotLayout.qInfo,snapshotLayout.visualizationType=layout.qInfo.qType,snapshotLayout.sourceObjectId=layout.qInfo.qId,snapshotLayout.sheetId=State.model.id,snapshotLayout.timestamp=date.getTime(),snapshotLayout.isClone=!1,snapshotLayout.qMetaDef={title:layout.title};var sheetPanel=$(".qv-panel-sheet");snapshotLayout.snapshotData.parent={h:sheetPanel.height(),w:sheetPanel.width()}}else snapshotLayout.snapshotData.object.origDataPages=object.model.layout.snapshotData.object.origDataPages,snapshotLayout.snapshotData.content&&(snapshotLayout.snapshotData.content.chartData=util.extend(!0,{},object.model.layout.snapshotData.content.chartData));def.resolve(snapshotLayout)})}),def.promise}function saveSnapshot($scope,object,objectElem,layout){var snapshotObj=object.ext.snapshot;SnapshotModel.Snapshot.create(layout).then(function(belowLimit){belowLimit?(snapshotObj.animate(objectElem),$scope&&snapshotObj.updateCount($scope)):showLimitReachedDialog(),UndoInfoModel.get().then(function(ui){ui.reset()})})}function prepareStaticContent(object,snapshotLayout){function replaceStaticContentUrls(){layoutUrls.forEach(function(prop,index){util.extend(!0,prop,propertiesUrls[index])})}function prepArray(urlArray,matchProp,obj,removeAndInsert){for(var prop in obj)obj.hasOwnProperty(prop)&&"qHyperCube"!==prop&&"qHyperCubeDef"!==prop&&(prop===matchProp?(removeAndInsert&&(delete obj[prop],obj.qStaticContentUrlDef={}),urlArray.push(obj.qStaticContentUrlDef)):"object"==typeof obj[prop]&&prepArray(urlArray,matchProp,obj[prop],removeAndInsert))}var layoutUrls=[],propertiesUrls=[],def=new Deferred;return object.model.getProperties().then(function(props){prepArray(layoutUrls,"qStaticContentUrl",snapshotLayout,!0),prepArray(propertiesUrls,"qStaticContentUrlDef",props),replaceStaticContentUrls(),def.resolve(snapshotLayout)}),def.promise}var snapshotSpeedLimit=1e3,lastSnapshottedObject=null;return{createSnapshot:createSnapshot,prepSnapshotData:prepSnapshotData,prepareStaticContent:prepareStaticContent}}),define("client.soft-property-panel/default-explore-properties",["core.utils/theme","general.utils/property-resolver","client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(theme,propertyResolver,propertyLogicModule,hcHelper){var sort,color,colorsAndLegend,presentation,propertyLogic=propertyLogicModule.getLogicFor("explore","default");return sort={translation:"properties.sorting",type:"items",component:"sort",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",icon:"icon-selection-toolbar-selectAlternative",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",type:"items",items:{sortOptions:{component:"radio-list",type:"number",diffs:["qDef.qSortCriterias.0.qSortByExpression","qDef.qSortCriterias.0.qSortByNumeric","qDef.qSortCriterias.0.qSortByAscii"],options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]},setPropertyValue:function(data,value){propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByExpression",0),propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByNumeric",0),propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByAscii",value)},getValue:function(data){return 0===propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByExpression",0)&&0===propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByNumeric",0)?propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByAscii",0):0}}}},measures:{ref:"qHyperCubeDef.qMeasures",type:"items",items:{sortOptions:{component:"radio-list",type:"number",ref:"qSortBy.qSortByNumeric",options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]}}}}}},color={component:"items",translation:"properties.colors",icon:"icon-spray",grouped:!0,items:{mode:{component:"radio-list",type:"string",options:propertyLogic.color.colorMode.options,diffs:["color.mode","color.auto"],setPropertyValue:function(data,v){"auto"===v?data.color.auto=!0:(data.color.auto=!1,data.color.mode=v)},getValue:function(data){return data.color.auto?"auto":data.color.mode}},dimension:{type:"items",show:function(data){return!data.color.auto&&"byDimension"===data.color.mode},items:{colorScheme:{translation:"properties.colorScheme",type:"string",component:"item-selection-list",horizontal:!0,showLabels:!1,ref:"color.dimensionScheme",items:[{colors:theme.colorSchemes.qualitativeScales[0].scale[theme.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[0].translation||theme.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:theme.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[1].translation||theme.colorSchemes.qualitativeScales[1].name,value:"100"}],show:function(data,layout){if(1===hcHelper.getNumDimensions(data)&&hcHelper.getNumMeasures(data)<=1){var dim=hcHelper.getDimensionLayouts(layout)[0];return dim&&dim.qCardinal<=12?!1:!0}return hcHelper.getNumMeasures(data)<=1||hcHelper.getNumMeasures(data)>12}},dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:!1},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",show:function(data){return hcHelper.getNumMeasures(data)<=1&&hcHelper.getNumDimensions(data)<=1},readOnly:propertyLogic.color.persistentColors.readOnly}}},measure:{type:"items",show:function(data){return!data.color.auto&&"byMeasure"===data.color.mode},items:{sequential:{component:"item-selection-list",translation:"properties.colorScheme",horizontal:!0,showLabels:!1,type:"string",ref:"color.measureScheme",items:[{colors:theme.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[0].translation||theme.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:theme.colorSchemes.ordinalScales[1].scale[theme.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[1].translation||theme.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:theme.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[2].translation||theme.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:theme.colorSchemes.ordinalScales[3].scale[theme.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[3].translation||theme.colorSchemes.ordinalScales[3].name,value:"dc"}]}}},legend:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(data,layout){return!data.color.auto&&propertyLogic.legend.show(data,layout)}}}},presentation={translation:"properties.presentation",type:"items",grouped:!0,items:{}},{sort:sort,color:color,colorsAndLegend:colorsAndLegend,presentation:presentation}}),define("objects.extension/default-extension",["jquery","qvangular","core.utils/deferred","objects.backend-api/generic-api","general.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","client.models/snapshot","objects.snapshot/snapshot-helper","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion","client.soft-property-panel/default-explore-properties"],function($,qvangular,Deferred,GenericApi,propertyMapper,HyperCubeHandler,ListObjectHandler,defaultTemplate,SnapshotModel,SnapshotHelper,visualizations,libraryUtils,objectConversion,defaultSoftProperties){function getDimensionInfo(layout){if(layout.qHyperCube)return layout.qHyperCube.qDimensionInfo||[];if(layout.qChildList){var children=layout.qChildList.qItems||[];return children.map(function(){return{}})}var hasError=!layout.qListObject||!layout.qListObject.qDimensionInfo||layout.qListObject.qDimensionInfo.qError;return hasError?[]:[layout.qListObject.qDimensionInfo]}function getMeasureInfo(layout){return layout.qHyperCube?layout.qHyperCube.qMeasureInfo||[]:[]}function _checkLibraryObjects(exportFormat){var i,j,dim,meas,dfd=Deferred(),dfds=[],changes=[];for(i=0;i<exportFormat.data.length;++i){for(j=0;j<exportFormat.data[i].dimensions.length;++j)dim=exportFormat.data[i].dimensions[j],dim.qLibraryId&&(dfds.push(libraryUtils.findLibraryDimension(dim.qLibraryId)),changes.push(dim));for(j=0;j<exportFormat.data[i].measures.length;++j)meas=exportFormat.data[i].measures[j],meas.qLibraryId&&(dfds.push(libraryUtils.findLibraryDimension(meas.qLibraryId)),changes.push(meas))}return Deferred.all(dfds).then(function(infoArray){for(i=0;i<infoArray.length;++i)infoArray[i]&&(changes[i].title=infoArray[i].qData.title);dfd.resolve()}),dfd.promise}return{BackendApi:GenericApi,template:defaultTemplate,mapProperties:function(){this.mappedDefinition=propertyMapper.mapDefinition(this.definition,this.type),this.globalChangeListeners=propertyMapper.findGlobalListeners(this.mappedDefinition);var dimensionDefinition=this.data&&this.data.dimensions;dimensionDefinition?(dimensionDefinition.min="undefined"!=typeof dimensionDefinition.min?dimensionDefinition.min:1,dimensionDefinition.max="undefined"!=typeof dimensionDefinition.max?dimensionDefinition.max:1e3):this.data||(dimensionDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0),dimensionDefinition||(dimensionDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),dimensionDefinition&&(dimensionDefinition.obsolete=!0)),this.dimensionDefinition=dimensionDefinition;var measureDefinition=this.data&&this.data.measures;measureDefinition?(measureDefinition.min="undefined"!=typeof measureDefinition.min?measureDefinition.min:1,measureDefinition.max="undefined"!=typeof measureDefinition.max?measureDefinition.max:1):this.data||(measureDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0),measureDefinition&&(measureDefinition.obsolete=!0)),this.measureDefinition=measureDefinition},getCreatePropertyHandler:function(){var dimensionProperties,measureProperties,mappedDefinition=this.mappedDefinition;return this.model.layout.qListObject?(dimensionProperties=propertyMapper.mapProperties(this.dimensionDefinition),new ListObjectHandler(this.dimensionDefinition,dimensionProperties)):(this.dimensionDefinition&&this.dimensionDefinition.obsolete?dimensionProperties=propertyMapper.mapProperties(this.dimensionDefinition):this.dimensionDefinition&&(dimensionProperties=propertyMapper.mapProperties(mappedDefinition.items.data.items.dimensions)),this.measureDefinition&&this.measureDefinition.obsolete?measureProperties=propertyMapper.mapProperties(this.measureDefinition):this.measureDefinition&&(measureProperties=propertyMapper.mapProperties(mappedDefinition.items.data.items.measures)),new HyperCubeHandler(this.dimensionDefinition,this.measureDefinition,dimensionProperties,measureProperties))},mapSoftProperties:function(){function collectDiffs(definition){var diffs=[{diffs:definition.ref||definition.sortIndexRef?[definition.ref||definition.sortIndexRef]:definition.diffs||[]}];return definition.items&&Object.keys(definition.items).forEach(function(key){
diffs.push({diffs:collectDiffs(definition.items[key])})}),definition._diffs=diffs,diffs}if(this.softDefinition){var mappedDefinition=propertyMapper.mapDefinition(this.softDefinition,null,defaultSoftProperties);collectDiffs(mappedDefinition),this.mappedSoftDefinition=mappedDefinition}},hasError:function(args){var layout=args.layout;return layout.qHyperCube?!!layout.qHyperCube.qError:layout.qListObject?!!layout.qListObject.qError:!1},showRequirements:function(args){var i,minDimensions=args.ext.dimensionDefinition?args.ext.dimensionDefinition.min:0,minMeasures=args.ext.measureDefinition?args.ext.measureDefinition.min:0,dimensions=getDimensionInfo(args.layout),measures=getMeasureInfo(args.layout);if(minDimensions>0&&dimensions.length<minDimensions)return!0;for(i=0;i<dimensions.length;++i)if(dimensions[i].qError)return!0;if(minMeasures>0&&measures.length<minMeasures)return!0;for(i=0;i<measures.length;++i)if(measures[i].qError)return!0;return!1},addFieldDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addFieldDimension(item.value,"").then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},addLibraryDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addLibraryDimension(item.libraryId).then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},addLibraryMeasure:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addLibraryMeasure(item.libraryId).then(function(measure){qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})})},addExpressionMeasure:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addExpressionMeasure(item.value,"").then(function(measure){qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})})},getDropFieldOptions:function(builder,propertyHandler,model,showMenu,object){builder.Add(model,propertyHandler,object),builder.ReplaceDimensions(model,propertyHandler,object),builder.AddFieldAsMeasure(model,propertyHandler,object),showMenu()},getDropDimensionOptions:function(builder,propertyHandler,model,showMenu,object){propertyHandler.getDimensions().length<propertyHandler.minDimensions()?propertyHandler.addLibraryDimension(builder.item.id).then(function(dimension){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)}):(builder.Add(model,propertyHandler,object),builder.ReplaceDimensions(model,propertyHandler,object),showMenu())},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu,object){propertyHandler.getMeasures().length<propertyHandler.minMeasures()?"expression"===builder.item.type?propertyHandler.addExpressionMeasure(builder.item.name,"").then(function(measure){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)}):propertyHandler.addLibraryMeasure(builder.item.id).then(function(measure){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)}):(builder.Add(model,propertyHandler,object),builder.ReplaceMeasures(model,propertyHandler,object),showMenu())},getDropTemplateOptions:function(builder,propertyHandler,model,showMenu,object){var that=this,newType=visualizations.getType(builder.item.template),text=["contextMenu.convertTo",builder.item.name];that.type!==newType.type?newType.getExtensionType().then(function(extensionType){!object.isReadonly&&that.exportProperties&&extensionType.importProperties&&builder.menu.addItem({translation:text,tid:"convert",select:function(){that._convert(newType,extensionType,builder.item)}}),showMenu()},function(){showMenu()}):showMenu()},getDropOptions:function(object,builder,showMenu){var item_type,nameMap,fnName,model=object.model,ext=this;return nameMap={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},item_type=builder.item.type,(fnName=nameMap[item_type])?model.getProperties().then(function(props){var propertyHandler=ext.getCreatePropertyHandler();return propertyHandler.setProperties(props),ext[fnName](builder,propertyHandler,model,showMenu,object)}):void showMenu()},_convert:function(newType,extensionType,item){var exported,imported,self=this;Deferred.all({initialProperties:newType.getInitialProperties(item.init),propertyTree:self.model.getFullPropertyTree()}).then(function(args){try{exported=self.exportProperties(args.propertyTree),_checkLibraryObjects(exported).then(function(){imported=extensionType.importProperties(exported,args.initialProperties,extensionType),self.model.getLayout().then(function(layout){layout.qHasSoftPatches?(self.model.markAsCancelled(),self.model.clearSoftPatches().then(function(){self.model.propertyTree=imported,self.model.saveTree().then(function(){self.model.markAsInvalid()})})):(self.model.propertyTree=imported,self.model.saveTree())})})}catch(e){}})},exportProperties:function(propertyTree){return propertyTree.qProperty.qHyperCubeDef?objectConversion.hypercube.exportProperties(propertyTree):propertyTree.qProperty.qListObjectDef?objectConversion.listbox.exportProperties(propertyTree):objectConversion.other.exportProperties(propertyTree)},importProperties:function(exportedFmt,initialProperties,ext){return initialProperties.qHyperCubeDef?objectConversion.hypercube.importProperties(exportedFmt,initialProperties,ext):initialProperties.qListObjectDef?objectConversion.listbox.importProperties(exportedFmt,initialProperties,ext):objectConversion.other.importProperties(exportedFmt,initialProperties,ext)},snapshot:{canTakeSnapshot:!1,animate:function(elem){elem.append($('<div class="qv-snapshot-tool-flash" />').bind("oanimationend animationend webkitAnimationEnd",function(){$(this).remove()}))},take:function($scope,object,event,options){SnapshotHelper.createSnapshot($scope,object,event,options)},updateCount:function($scope){return SnapshotModel.Snapshot.getSnapshotCount($scope.options.id).then(function(count){return $scope.snapshotCount=count,count})}},options:{},controller:function(){}}}),define("text!extensions.qliktech/combochart/combochart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>'}),define("extensions.qliktech/combochart/combochart",["jquery","util","qvangular","core.utils/deferred","client.utils/state","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","extensions.qliktech/combochart/comboarea","extensions.qliktech/combochart/combochart-properties","extensions.qliktech/combochart/combochart-data","objects.backend-api/hypercube-api","objects.extension/default-extension","objects.extension/object-conversion","text!./combochart.ng.html"],function($,util,qvangular,Deferred,State,ScrollableChart,ChartComponent,ContinuousAxis,ComboArea,ComboChartPropertiesDefinition,combochartData,HypercubeApi,defaultExtension,objectConversion,template){"use strict";function updateAxisMinMax(axis,measures,axisOptions,useZeroAsBase,dataMinMax,cutSettings){if(measures.length){var min,max,eMinMax;dataMinMax?(min=dataMinMax.min,max=dataMinMax.max):(min=Math.min.apply(this,measures.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return v.qMin})),max=Math.max.apply(this,measures.filter(function(v){return!isNaN(v.qMax)}).map(function(v){return v.qMax}))),util.isNumeric(min)||(min=-1),util.isNumeric(max)||(max=1),eMinMax=this.getAxisOptions(axisOptions),useZeroAsBase&&(max=Math.max(0,max),min=Math.min(0,min)),cutSettings&&(cutSettings.min=min,cutSettings.max=max,cutSettings.minMeasure&&cutSettings.maxMeasure?(this._cutMode=this.getSpikeSettings(cutSettings,eMinMax),min=this._cutMode.min,max=this._cutMode.max):this._cutMode={positive:!1,negative:!1}),axis.setRealDataRange(void 0,void 0),this.setAxisDataRange(axis,max,min,eMinMax.max,eMinMax.min,1)}}function builderAddMeasureAs(model,propertyHandler){var menu,item=this.item,text=["contextMenu.add",item.name];propertyHandler.canAddMeasure()&&(menu=this.menu.addItem({translation:text,tid:"add-as"}),menu.addItem({translation:"contextMenu.asBar",tid:"as-bar",icon:"icon-bar-chart-vertical",select:function(){propertyHandler.addLibraryMeasure(item.id).then(function(measure){measure.qDef.series.type="bar",model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})}}),menu.addItem({translation:"contextMenu.asLine",tid:"as-line",icon:"icon-line-chart",select:function(){propertyHandler.addLibraryMeasure(item.id).then(function(measure){measure.qDef.series.type="line",measure.qDef.series.axis=1,model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})}}),menu.addItem({translation:"contextMenu.asMarker",tid:"as-marker",icon:"icon-shapes",select:function(){propertyHandler.addLibraryMeasure(item.id).then(function(obj){obj.qDef.series.type="marker",obj.qDef.series.axis=1,model.save()})}}))}var ComboChart,PAGING={NONE:0,ONE_DIM:1,TWO_DIM:2};return ComboChart=ScrollableChart.extend("ComboChart",{namespace:".combochart",init:function($scope,$element,options,backendApi){options=$.extend(!0,{components:{dataArea:{clazz:ComboArea},axis:{show:!0,order:1.1,reductionOrder:2.1,dock:"right",relevantSize:90,showFlag:ChartComponent.prototype.ShowFlags.XSMALL,clazz:ContinuousAxis}}},options||{}),this._super($scope,$element,options,backendApi),this.components.scrollArea.setUseMiniChart(!1),this.components.axis.setShowStrategy("all"),this.components.dataArea.setSecondaryMinorAxis(this.components.axis)},partialUpdate:function(data){var key,top,major,dfds=[];this._enablePagingTransitions(),this._chartContext.refresh(data),this.providers.colorMap.setData(data),top=data.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:data.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(top*this.scrollMultiplicator);for(key in this.components)"miniChart"!==key&&this.components[key].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),major=this.components.dataArea.barArea.getMeasureIndices().length?this.components.dataArea.barArea.getMajorAxisData():this.components.dataArea.markerArea.getMeasureIndices().length?this.components.dataArea.markerArea.getMajorAxisData():this.components.dataArea.lineArea.getMajorAxisData(),this.components.dimensionAxis.setDataRange(major.data,major.info);var minorData=this.components.dataArea.barArea.getMinorAxisData();return minorData&&this._dataOptions.primary.forEach(function(m){this._dataOptions.barSeries.indexOf(m)<0&&!isNaN(m.qMin)&&(minorData.min=Math.min(m.qMin,minorData.min),minorData.max=Math.max(m.qMax,minorData.max))},this),updateAxisMinMax.apply(this,[this.components.measureAxis,this._dataOptions.primary,this._dataOptions.axes.measureAxis,!!minorData,minorData,minorData?this.getPrimaryMeasureSettings(data,this._dataOptions):null]),this.components.dimensionAxis.updateNow(["properties"]),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),dfds.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),dfds.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),dfds.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),Deferred.all(dfds)},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var key,scroll=this.components.scrollArea,s=this.rect.height,storedData=this.getSnapshotStoredChartData(),cutOffPad=0,dfds=[];(this._cutMode.positive||this._cutMode.negative)&&(this._layoutMode>=31&&(cutOffPad=48),cutOffPad=this._layoutMode>=15?32:this._layoutMode>=7?16:8),this.components.measureAxis.setPadding(this._cutMode.positive?cutOffPad:0,0,this._cutMode.negative?cutOffPad:0,0),this.components.axis.setPadding(this._cutMode.positive?cutOffPad:0,0,this._cutMode.negative?cutOffPad:0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(s/4))),this.components.dataArea.updateNow(["properties"]),this.components.dimensionAxis.updateNow(["properties"]),this.layout(),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(storedData.axisInnerOffset),this.components.scrollArea.setOffset(storedData.scrollOffset)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset));var page=this.checkPage();if(page)dfds.push(page);else{for(key in this.components)dfds.push(this.components[key].invalidateDisplay("ComboChart.paint"));scroll.viewState.min+scroll.viewState.range>scroll.fullState.max&&scroll.setOffset(scroll.fullState.max-scroll.viewState.range)}return Deferred.all(dfds)},_updateData:function(data){this._checkPage=!1;var lineSeries,barSeries,markerSeries,primaryMeasures,secondaryMeasures,primaryAxisTitle,discreteAxisTitle,secondaryAxisTitle,options,dimensionAxisTitleComponent,storedData=this.getSnapshotStoredChartData();if(lineSeries=data.qHyperCube.qMeasureInfo.filter(function(measure){return measure.series&&"line"===measure.series.type}),barSeries=data.qHyperCube.qMeasureInfo.filter(function(measure){return!measure.series||"bar"===measure.series.type}),markerSeries=data.qHyperCube.qMeasureInfo.filter(function(measure){return measure.series&&"marker"===measure.series.type}),primaryMeasures=[],secondaryMeasures=[],data.qHyperCube.qMeasureInfo.forEach(function(measure){measure.series&&"bar"!==measure.series.type&&1===measure.series.axis?secondaryMeasures.push(measure):primaryMeasures.push(measure)}),this.isStacked=!1,this.components.measureAxis.isStacked="stacked"===data.barGrouping.grouping&&barSeries.length>1,this.components.axis.isStacked=!1,this._pagingMode=PAGING.NONE,this.scrollMultiplicator="grouped"===data.barGrouping.grouping&&barSeries.length>1?barSeries.length+1:1,data.qHyperCube.qSize.qcy>data.qHyperCube.qDataPages[0].qArea.qHeight){this._pagingMode=PAGING.ONE_DIM;var numDiscrete=data.qHyperCube.qSize.qcy;"grouped"===data.barGrouping.grouping&&barSeries.length>1&&(this.scrollMultiplicator=barSeries.length+1,numDiscrete*=this.scrollMultiplicator),this.components.dimensionAxis.setNumDiscreteUnits(numDiscrete)}else this.components.dimensionAxis.setNumDiscreteUnits(null);this.components.dimensionAxis.isDiscrete()||(this._pagingMode=PAGING.NONE),primaryAxisTitle=primaryMeasures.map(function(measure){return measure.qFallbackTitle}).join(", "),discreteAxisTitle=data.qHyperCube.qDimensionInfo.map(function(dim){return dim.qFallbackTitle}).join(", "),secondaryAxisTitle=secondaryMeasures.map(function(measure){return measure.qFallbackTitle}).join(", "),options={primary:primaryMeasures,secondary:secondaryMeasures,lineSeries:lineSeries,markerSeries:markerSeries,barSeries:barSeries,axes:{measureAxis:{component:this.components.measureAxis,data:$.extend(!0,{},data.measureAxes[0],{show:primaryMeasures.length?data.measureAxes[0].show:"none"}),title:data.measureAxes[0].title||primaryAxisTitle,dataIndices:primaryMeasures.map(function(measure){return data.qHyperCube.qMeasureInfo.indexOf(measure)})},secondaryMeasureAxis:{component:this.components.axis,data:$.extend(!0,{},data.measureAxes[1],{show:secondaryMeasures.length?data.measureAxes[1].show:"none",dock_:["near","far"].contains(data.measureAxes[0].dock)?"near"===data.measureAxes[0].dock?"far":"near":ChartComponent.prototype.getOppositeDock.call({options:{dock:data.measureAxes[0].dock}})}),title:data.measureAxes[1].title||secondaryAxisTitle,dataIndices:secondaryMeasures.map(function(measure){return data.qHyperCube.qMeasureInfo.indexOf(measure)})},dimensionAxis:{component:this.components.dimensionAxis,data:data.dimensionAxis,title:State.view!==State.Views.story?"":discreteAxisTitle,dataIndices:data.qHyperCube.qDimensionInfo.map(function(measure,idx){return idx})}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:data.dimensionAxis,title:State.view!==State.Views.story?"":discreteAxisTitle}}},dimensionAxisTitleComponent=this.components.dimensionAxisTitle,this._dataOptions=options,this._data=data,dimensionAxisTitleComponent.setData(data),this.components.dataArea.setData(data),this.providers.colorMap.setData(data),this.components.colorLegend.setData(data);var legendProvider=this.providers.colorMap.getLegendDataProvider();legendProvider.setMeasureLegendTypes(data.qHyperCube.qMeasureInfo.map(function(measure){return measure.series&&measure.series.type?"line"===measure.series.type?data.dataPoint.show?["line","circle"]:["line"]:"marker"===measure.series.type?[(measure.series.markerFill===!1?"!":"")+(measure.series.marker||"circle")]:["rect"]:["rect"]})),this._super(data,options),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(storedData.axisInnerOffset),this.components.scrollArea.setOffset(storedData.scrollOffset)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},initSelections:function(){this._super(),this.options._disableSelections||(this.selections.types.range.addComponent("y",this.components.axis),this.selections.Select.bind(function(items,toggle){var dimensions,activeComponent=this.selections.getActiveType().activeComponent;dimensions=activeComponent.subComponents?this.components.dimensionAxis.getType().current:activeComponent.getSelectionIndices(),this.onSelection.Select.apply(this,[items,toggle,dimensions])}.bind(this)))},updateDataArea:function(data){this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.lineArea.setShowDataPoints(data.dataPoint.show),this.components.dataArea.lineArea.setLineType("area"===data.lineType&&data.stackedArea?"stackedArea":data.lineType),this.components.dataArea.lineArea.setNullMode(data.nullMode),this.components.dataArea.barArea.setGroupingMode(data.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},getMinDiscreteUnitSize:function(){return this._minDiscreteUnitSize},updateAxis:function(data,options){var major,primaryFormatters,secondaryFormatters,primaryHasBars=options.primary.indexOf(options.barSeries[0])>=0,storedData=this.getSnapshotStoredChartData();this._super(data,options),this._cutMode={positive:!1,negative:!1};var minorData=this.components.dataArea.barArea.getMinorAxisData();minorData&&options.primary.forEach(function(m){options.barSeries.indexOf(m)<0&&!isNaN(m.qMin)&&(minorData.min=Math.min(m.qMin,minorData.min),minorData.max=Math.max(m.qMax,minorData.max))}),this._readStoredData&&storedData.dataRanges&&(minorData.min=storedData.dataRanges[0].min,minorData.max=storedData.dataRanges[0].max),updateAxisMinMax.apply(this,[this.components.measureAxis,options.primary,options.axes.measureAxis,primaryHasBars,minorData,primaryHasBars?this.getPrimaryMeasureSettings(data,options):null]),updateAxisMinMax.apply(this,[this.components.axis,options.secondary,options.axes.secondaryMeasureAxis,"zero"===data.nullMode,null]),primaryFormatters=this.chartFormatter.getFormattersForMeasures(data.qHyperCube.qMeasureInfo,options.primary.map(function(measure){return data.qHyperCube.qMeasureInfo.indexOf(measure)})),secondaryFormatters=this.chartFormatter.getFormattersForMeasures(data.qHyperCube.qMeasureInfo,options.secondary.map(function(measure){return data.qHyperCube.qMeasureInfo.indexOf(measure)})),this.components.measureAxis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(primaryFormatters),this.components.axis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(secondaryFormatters),major=options.barSeries.length?this.components.dataArea.barArea.getMajorAxisData():options.markerSeries.length?this.components.dataArea.markerArea.getMajorAxisData():options.lineSeries.length?this.components.dataArea.lineArea.getMajorAxisData():{data:[],info:[],groupSize:null},this.components.dimensionAxis.setDataRange(major.data,major.info),this.components.dimensionAxis.setGroupSize(major.groupSize,major.info),this._updateMinDiscreteUnitSize(this.components.dimensionAxis),!options.primary.length&&options.secondary.length||["all","labels"].indexOf(options.axes.measureAxis.data.show)<0&&options.secondary.length&&["all","labels"].indexOf(options.axes.secondaryMeasureAxis.data.show)>=0?this.components.grid.setAxes(this.components.dimensionAxis,this.components.axis):this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis);var dimensionAxisTitle=this.components.dimensionAxisTitle;dimensionAxisTitle.setDock("far"===data.dimensionAxis.dock?"top":"bottom"),State.view===State.Views.story&&dimensionAxisTitle.hideComponent()},_updateMinDiscreteUnitSize:function(axis){this._super(axis)},getPrimaryMeasureSettings:function(data,options){var minMeasure,maxMeasure,min,max,validPrimaryMeasures=options.primary.filter(function(v){return!isNaN(v.qMin)}).map(function(v){return{min:v.qMin,max:v.qMax,index:data.qHyperCube.qMeasureInfo.indexOf(v),isBarSeries:options.barSeries.indexOf(v)>=0}}),nonBarSeriesMeasures=options.primary.filter(function(v){return!isNaN(v.qMin)&&options.barSeries.indexOf(v)<0});return validPrimaryMeasures.length&&(minMeasure=validPrimaryMeasures.reduce(function(prev,current){return prev.min<current.min?prev:current},validPrimaryMeasures[0]),maxMeasure=validPrimaryMeasures.reduce(function(prev,current){return prev.max>current.max?prev:current},validPrimaryMeasures[0]),maxMeasure&&(max=minMeasure.max),minMeasure&&(min=minMeasure.min),util.isNumeric(min)||(min=0),util.isNumeric(max)||(max=1)),{minMeasure:minMeasure,maxMeasure:maxMeasure,nonBarSeriesMax:Math.max.apply(null,nonBarSeriesMeasures.map(function(v){return v.qMax})),nonBarSeriesMin:Math.min.apply(null,nonBarSeriesMeasures.map(function(v){return v.qMin})),min:min,max:max,data:data,options:options}},getSpikeSettings:function(settings,eMinMax){var row,value,data=settings.data,minMeasure=settings.minMeasure,maxMeasure=settings.maxMeasure,min=settings.min,max=settings.max,largestPositiveValue=0,largestNegativeValue=0,largestPositiveOtherValue=0,largestNegativeOtherValue=0,positive=!1,negative=!1,maxMeasureIndex=maxMeasure.index+data.qHyperCube.qDimensionInfo.length,minMeasureIndex=minMeasure.index+data.qHyperCube.qDimensionInfo.length,m=data.qHyperCube.qDataPages[0]?data.qHyperCube.qDataPages[0].qMatrix:[];if(!isNaN(settings.nonBarSeriesMax)&&settings.nonBarSeriesMax>0&&(largestPositiveValue=settings.nonBarSeriesMax),!isNaN(settings.nonBarSeriesMin)&&settings.nonBarSeriesMin<0&&(largestNegativeValue=settings.nonBarSeriesMin),!this.components.measureAxis.isStacked){for(var i=0;i<m.length;i++)row=m[i],value=row[maxMeasureIndex].qNum,value>0&&!isNaN(value)&&(row[0].qIsOtherCell||row[1].qIsOtherCell?largestPositiveOtherValue=Math.max(value,largestPositiveOtherValue):largestPositiveValue=Math.max(value,largestPositiveValue)),value=row[minMeasureIndex].qNum,0>value&&!isNaN(value)&&(row[0].qIsOtherCell||row[1].qIsOtherCell?largestNegativeOtherValue=Math.min(value,largestNegativeOtherValue):largestNegativeValue=Math.min(value,largestNegativeValue));null!==eMinMax.max&&eMinMax.max<maxMeasure.max?positive=eMinMax.max>0:largestPositiveValue>0&&largestPositiveOtherValue/largestPositiveValue>5&&(max=largestPositiveValue,positive=max>=0),null!==eMinMax.min&&eMinMax.min>minMeasure.min?negative=eMinMax.min<0:0>largestNegativeValue&&largestNegativeOtherValue/largestNegativeValue>5&&(min=largestNegativeValue,negative=0>min)}return{max:max,min:min,positive:positive,negative:negative}}}),{type:"ComboChart",BackendApi:HypercubeApi,template:template,View:ComboChart,definition:ComboChartPropertiesDefinition,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:17,qHeight:500}],qSuppressMissing:!0},measureAxes:[{autoMinMax:!0,dock:"near",max:10,min:0,minMax:"min",show:"all",spacing:1},{autoMinMax:!0,dock:"far",max:10,min:0,minMax:"min",show:"all",spacing:1}]},data:combochartData,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},range:{},colorLegend:{},tooltip:{}}},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu,object){"measure"===builder.item.type?(builderAddMeasureAs.call(builder,model,propertyHandler,object),propertyHandler.getMeasures().length>=propertyHandler.minMeasures()&&builder.ReplaceMeasures(model,propertyHandler,object),showMenu()):defaultExtension.getDropMeasureOptions(builder,propertyHandler,model,showMenu,object)},importProperties:function(exportedFmt,initialProperties,definition){var firstUsedMeasureAxis,propTree=objectConversion.axisChart.importProperties.apply(objectConversion,[exportedFmt,initialProperties,definition]),fromLineChart="linechart"===exportedFmt.properties.visualization,usedAxis=[];return propTree.qProperty.qHyperCubeDef.qMeasures.forEach(function(m){m.qDef.series||(m.qDef.series={type:fromLineChart?"line":"bar",axis:0,marker:"circle",markerFill:!0}),usedAxis.indexOf(m.qDef.series.axis)<0&&usedAxis.push(m.qDef.series.axis)}),firstUsedMeasureAxis=usedAxis.sort().shift(),propTree.qProperty.measureAxes[firstUsedMeasureAxis]&&exportedFmt.properties.measureAxis&&"undefined"!=typeof exportedFmt.properties.measureAxis.autoMinMax&&util.extend(!0,propTree.qProperty.measureAxes[firstUsedMeasureAxis],exportedFmt.properties.measureAxis,{logarithmic:!1}),propTree},exportProperties:objectConversion.axisChart.exportProperties.bind(objectConversion)}}),define("apis/qglobal",["qvangular","core.models/app","client.models/rpc-session"],function(qvangular,App,RPCSession){function doIt(me,func,params,callback){return me.session.rpc({method:func,handle:-1,params:params||[]}).then(function(data){return callback&&callback(data.result),data.result})}function QGlobal(param){"function"==typeof param.rpc?this.session=param:(this.session=RPCSession.get("?transient=",param),this.session.open())}return QGlobal.prototype.getAppList=function(callback){var session=this.session;qvangular.$apply(qvangular.$rootScope,function(){App.getList(session).then(function(list){callback(list)})})},QGlobal.prototype.getAuthenticatedUser=function(callback){return doIt(this,"GetAuthenticatedUser",[],callback)},QGlobal.prototype.isPersonalMode=function(callback){return doIt(this,"IsPersonalMode",[],callback)},QGlobal.prototype.getQTProduct=function(callback){return doIt(this,"QTProduct",[],callback)},QGlobal.prototype.getProductVersion=function(callback){return doIt(this,"ProductVersion",[],callback)},QGlobal.prototype.getQvVersion=function(callback){return this.getProductVersion(callback)},QGlobal.prototype.cancelReload=function(){return doIt(this,"CancelReload",[])},QGlobal.prototype.getProgress=function(qRequestId,callback){return doIt(this,"GetProgress",[qRequestId],callback)},QGlobal.prototype.GetProgress=function(qRequestId,callback){return this.getProgress(qRequestId,callback)},QGlobal}),define("client.models/current-selections",["core.models/session-object","core.models/app","general.models/field"],function(SessionObject,App,Field){"use strict";function modifyField(app,fieldName,fnName){Field.get(fieldName,void 0,app).then(function(field){field[fnName]()})}var CurrentSelections;return CurrentSelections=SessionObject.extend("CurrentSelections",{clearField:function(fieldName){modifyField(this.app,fieldName,"clear")},lockField:function(fieldName){modifyField(this.app,fieldName,"lock")},unlockField:function(fieldName){modifyField(this.app,fieldName,"unlock")},clearAll:function(){return this.app.rpc("ClearAll",null)},back:function(){return this.app.rpc("Back",null)},forward:function(){return this.app.rpc("Forward",null)}}),CurrentSelections.get=function(app){return app=app||App.current,SessionObject.get.call(this,{qInfo:{qType:"CurrentSelection"},qSelectionObjectDef:{}},app).then(function(currentSelection){return currentSelection.app=app,currentSelection})},CurrentSelections}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(BackendApi,Deferred,CubeSlicer,PivotCubeSlicer){"use strict";function sliceDataPages(slicer,layout,rects,responseProperty){if(slicer){layout.snapshotData.object.origDataPages||(layout.snapshotData.object.origDataPages=layout.qHyperCube[responseProperty]);for(var i=0;i<rects.length;i++)rects[i].qHeight=Math.min(layout.qHyperCube.qSize.qcy,rects[i].qHeight),rects[i].qTop=layout.snapshotData.object.origDataPages[i].qArea.qTop;layout.qHyperCube[responseProperty]=slicer.get(rects)}}function prepareCubeSlicer(layout){if("pivot-table"===layout.visualization)this.responseProperty="qPivotDataPages",this.slicer=new PivotCubeSlicer;else{if("table"!==layout.visualization)return;this.slicer=new CubeSlicer}layout.snapshotData.object.origDataPages?this.slicer.store(layout.snapshotData.object.origDataPages):this.slicer.store(layout.qHyperCube[this.responseProperty])}var SnapshotApi;return SnapshotApi=BackendApi.extend("SnapshotAPI",{init:function(model){this.responseProperty="qDataPages",prepareCubeSlicer.call(this,model.layout),this._super(model,model.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(rects){var defer=Deferred();if("map"===this.model.layout.visualization){var layerIndex=this.dataPath.split("/")[1],arr=this.dataPath.split("/"),dataType=arr[arr.length-1];"polygon"===this.model.layout.layers[layerIndex].type&&"3"===this.model.layout.layers[layerIndex].version?defer.resolve({qDataPages:this.model.layout.layers[layerIndex].geodata.qHyperCube[this.responseProperty]}):defer.resolve({qDataPages:this.model.layout.layers[layerIndex][dataType][this.responseProperty]})}else sliceDataPages(this.slicer,this.model.layout,rects,this.responseProperty),defer.resolve(this.model.layout[this.dataPath][this.responseProperty]);return defer.promise},getHyperCubeBinnedData:function(){return Deferred.resolve(this.model.layout.dataPages)},getSize:function(){return this.model.layout[this.dataPath].qSize},beginSelections:function(){},endSelections:function(){},clearSelections:function(){},isSnapshot:!0})}),define("apis/qfieldvalue",[],function(){function QFieldValue(cell,parent){Object.defineProperties(this,{qText:{value:cell.qText},qElemNumber:{value:cell.qElemNumber},qState:{value:cell.qState},field:{value:parent}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}}),cell.qFrequency&&Object.defineProperties(this,{qFrequency:{value:cell.qFrequency}})}return QFieldValue.prototype.select=function(toggle,softlock){return this.field.select([this.qElemNumber],toggle||!1,softlock||!1)},QFieldValue}),define("apis/qfield",["qvangular","core.utils/deferred","general.models/field","core.utils/notification","apis/qfieldvalue"],function(qvangular,Deferred,Field,Notification,QFieldValue){function doIt(me,func,arg1,arg2,arg3,arg4,arg5){var dfd=new Deferred;return me.waitFor.then(function(){me.field[func](arg1,arg2,arg3,arg4,arg5).then(function(){dfd.resolve()},function(){dfd.reject()})}),dfd.promise}function QField(qapp,fldname,statename){var me=this,dfd=new Deferred;return me.qapp=qapp,me.waitFor=dfd.promise,me.fldname=fldname,me.rows=[],Notification.create(me,"OnData"),"function"==typeof qapp.isMock?(me.field=qapp,void dfd.resolve()):void qvangular.$apply(qvangular.$rootScope,function(){Field.get(fldname,statename||"$",qapp.model).then(function(field){me.field=field,dfd.resolve()},function(){dfd.reject()})})}return QField.prototype.clear=function(){
return doIt(this,"clear")},QField.prototype.lock=function(){return doIt(this,"lock")},QField.prototype.unlock=function(){return doIt(this,"unlock")},QField.prototype.clearOther=function(softlock){return doIt(this,"clearOther",softlock||!1)},QField.prototype.selectAll=function(softlock){return doIt(this,"selectAll",softlock||!1)},QField.prototype.selectExcluded=function(softlock){return doIt(this,"selectExcluded",softlock||!1)},QField.prototype.selectAlternative=function(softlock){return doIt(this,"selectAlternative",softlock||!1)},QField.prototype.selectPossible=function(softlock){return doIt(this,"selectPossible",softlock||!1)},QField.prototype.toggleSelect=function(match,softlock){return doIt(this,"toggleSelect",match,softlock||!1)},QField.prototype.selectMatch=function(match,softlock){return doIt(this,"selectMatch",match,softlock||!1)},QField.prototype.select=function(values,toggle,softlock){return doIt(this,"select",values,toggle||!1,softlock||!1)},QField.prototype.selectValues=function(values,toggle,softlock){var val=[];return values.forEach(function(item){"number"==typeof item?val.push({qIsNumeric:!0,qNumber:item}):"string"==typeof item?val.push({qText:item}):val.push(item)}),doIt(this,"selectValues",val,toggle||!1,softlock||!1)},QField.prototype.getData=function(options){if(!this.requestActive){this.requestActive=!0,this.genericObject&&(this.genericObject.close(),delete this.genericObject);var me=this;return this.qapp.createGenericObject({qListObjectDef:{qDef:{qFieldDefs:[this.fldname]},qFrequencyMode:options&&options.rows||"V",qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:options&&options.rows||200,qWidth:1}]}},function(reply){me.rows.length=0,reply.qListObject.qDataPages.forEach(function(page){page.qMatrix.forEach(function(row){me.rows.push(new QFieldValue(row[0],me))})}),me.rowCount=reply.qListObject.qDimensionInfo.qCardinal,me.stateCounts=reply.qListObject.qDimensionInfo.qStateCounts,me.requestActive=!1,me.OnData.emit()}).then(function(go){me.genericObject=go}),this}},QField.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var me=this,requestPage={qTop:this.rows.length,qLeft:0,qWidth:1,qHeight:50};return me.genericObject.rpc("GetListObjectData",null,["/qListObjectDef",[requestPage]]).then(function(reply){reply.qDataPages[0].qMatrix.forEach(function(row){me.rows.push(new QFieldValue(row[0],me))}),me.requestActive=!1,me.OnData.emit()}),this}},QField}),define("apis/qbookmark",["client.models/bookmark"],function(Bookmark){function QBookmark(app){this.app=app}return QBookmark.prototype.create=function(title,description){return Bookmark.create({qMetaDef:{title:title,description:description}},this.app)},QBookmark.prototype.apply=function(id){return Bookmark.apply(id,this.app)},QBookmark.prototype.remove=function(id){return Bookmark.remove(id,this.app)},QBookmark}),define("core.models/variable",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Variable=BaseObject.extend("Variable",{setStringValue:function(content){return this.rpc("SetStringValue",null,[content])},setNumValue:function(content){return this.rpc("SetNumValue",null,[content])},setDualValue:function(text,num){return this.rpc("SetDualValue",null,[text,num])}},{listProperties:{qVariableListDef:{qType:"variable",qShowReserved:!0,qShowConfig:!0,qData:{tags:"/tags"}}}});return Variable.get=function(id,app){function getHandle(){return app.rpc("GetVariableById","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Variable.getByName=function(name,app){function getHandle(){return app.rpc("GetVariableByName","qReturn",[name])}return app=app||App.current,this.getModel(name,app.session,getHandle)},Variable.create=function(props,app){return app=app||App.current,BaseObject.create.call(Variable,props,"CreateVariableEx",app)},Variable.createTransient=function(props,app){app=app||App.current,props.qInfo=props.qInfo||{},props.qInfo.qType=props.qInfo.qType||this.name.toLowerCase();var Model=this;return app.createSessionVariable(props).then(function(result){return new Model({id:null,handle:result.qHandle,session:app.session})})},Variable.remove=function(id,app){return BaseObject.remove(id,"DestroyVariableById",app)},Variable}),define("apis/qvariable",["core.utils/deferred","core.models/variable"],function(Deferred,Variable){function QVariable(app,qapp){this.app=app,this.qapp=qapp}return QVariable.prototype.create=function(qProp){var props;return props="string"==typeof qProp?{qName:qProp}:qProp,Variable.create(props,this.app)},QVariable.prototype.createSessionVariable=function(qProp){return Variable.createTransient(qProp,this.app)},QVariable.prototype.get=function(qId){return Variable.get(qId,this.app)},QVariable.prototype.getByName=function(qName){return Variable.getByName(qName,this.app)},QVariable.prototype.setStringValue=function(qName,qVal){var dfd=new Deferred;return Variable.getByName(qName,this.app).then(function(model){model.setStringValue(qVal).then(function(reply){dfd.resolve(reply)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable.prototype.setNumValue=function(qName,qVal){var dfd=new Deferred;return Variable.getByName(qName,this.app).then(function(model){model.setNumValue(qVal).then(function(reply){dfd.resolve(reply)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable.prototype.setContent=function(name,content){return this.setStringValue(name,content+"")},QVariable.prototype.getContent=function(name,callback){var dfd=new Deferred,wrapper=this.qapp,okFunc=callback?function(data){callback(data,wrapper)}:function(){};return Variable.getByName(name,this.app).then(function(model){model.getLayout().then(function(layout){var data={qContent:{qString:layout.qText,qIsNum:!isNaN(layout.qNum)}};okFunc(data,wrapper),dfd.resolve(data)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable}),define("apis/qtable",["core.utils/notification"],function(Notification){function QHeader(cell,col,parent){Object.defineProperties(this,{qFallbackTitle:{value:cell.qFallbackTitle},qSortIndicator:{value:cell.qSortIndicator},qReverseSort:{value:cell.qReverseSort||!1},col:{value:col},isOrderedBy:{value:col===parent.qHyperCube.qEffectiveInterColumnSortOrder[0]},isDimension:{value:col<parent.qHyperCube.qDimensionInfo.length},selections:{value:[]},parent:{value:parent}}),cell.qCardinal>0&&Object.defineProperties(this,{qCardinal:{value:cell.qCardinal},qStateCounts:{value:cell.qStateCounts}}),cell.qMax&&Object.defineProperties(this,{qMax:{value:cell.qMax},qMin:{value:cell.qMin}}),cell.qGroupFieldDefs&&cell.qGroupFieldDefs.length>0&&Object.defineProperties(this,{field:{value:parent.app.field(cell.qGroupFieldDefs[cell.qGroupPos])}})}function QDimensionCell(cell,qDimensionInfo,col,parent){Object.defineProperties(this,{qDimensionInfo:{value:qDimensionInfo},qText:{value:cell.qIsOtherCell?qDimensionInfo.othersLabel:cell.qText},qElemNumber:{value:cell.qElemNumber},qState:{value:cell.qState},col:{value:col},selected:{get:function(){return this.header.isSelected(this.qElemNumber)}},header:{get:function(){return this.parent.headers[this.col]}},parent:{value:parent}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}})}function QMeasureCell(cell,qMeasureInfo,qGrandTotal){Object.defineProperties(this,{qMeasureInfo:{value:qMeasureInfo},qGrandTotal:{value:qGrandTotal},qText:{value:cell.qText}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}})}function QRow(row,qHyperCube,parent){var dimensions=[],measures=[],dimcnt=qHyperCube.qDimensionInfo.length;row.forEach(function(cell,col){dimcnt>col?dimensions.push(new QDimensionCell(cell,qHyperCube.qDimensionInfo[col],col,parent)):measures.push(new QMeasureCell(cell,qHyperCube.qMeasureInfo[col-dimcnt],qHyperCube.qGrandTotalRow[col-dimcnt]))}),Object.defineProperties(this,{dimensions:{value:dimensions},measures:{value:measures},cells:{value:dimensions.concat(measures)}})}function QTable(app,obj,path){if(Notification.create(this,"OnData"),Object.defineProperties(this,{app:{value:app},path:{value:path||"qHyperCube"},defPath:{get:function(){return this.path+"Def"}},rows:{value:[]},headers:{value:[]},totals:{value:[]},rowCount:{get:function(){return this.qHyperCube.qSize.qcy}},colCount:{get:function(){return this.qHyperCube.qSize.qcx}}}),"function"==typeof obj.then){var me=this;obj.then(function(model){setModelView(me,model)})}else{var model=obj.backendApi?obj.backendApi.model:obj;setModelView(this,model,obj.backendApi?obj:void 0)}}function setModelView(me,model,view){Object.defineProperties(me,{model:{value:model},view:{value:view}}),refresh(me),me.model.Validated.bind(function(){refresh(me)})}function refresh(me){if(!me.qHyperCube&&me.model.layout&&(me.qHyperCube=me.model.layout[me.path]),!(me.model&&me.model.layout&&me.model.layout.qSelectionInfo&&me.model.layout.qSelectionInfo.qInSelections)){if(me.headers.length=0,me.totals.length=0,me.rows.length=0,me.qHyperCube){var dimcnt=me.qHyperCube.qDimensionInfo?me.qHyperCube.qDimensionInfo.length:0;me.qHyperCube.qDimensionInfo&&me.qHyperCube.qDimensionInfo.forEach(function(dim,col){me.headers.push(new QHeader(dim,col,me))}),me.qHyperCube.qMeasureInfo&&me.qHyperCube.qMeasureInfo.forEach(function(meas,col){me.headers.push(new QHeader(meas,col+dimcnt,me))}),me.qHyperCube.qGrandTotalRow&&me.qHyperCube.qGrandTotalRow.forEach(function(total,col){me.totals.push(new QMeasureCell(total,me.qHyperCube.qMeasureInfo[col]))}),addDataRows(me,me.qHyperCube.qDataPages)}me.OnData.emit()}}function addDataRows(me,pages){pages&&pages.forEach(function(page){page.qMatrix.forEach(function(row){me.rows.push(new QRow(row,me.qHyperCube,me))})})}return QHeader.prototype.orderBy=function(){var sortOrder=[this.col];this.parent.qHyperCube.qEffectiveInterColumnSortOrder.forEach(function(val){val!==sortOrder[0]&&sortOrder.push(val)});var patches=[{qPath:"/"+this.parent.defPath+"/qInterColumnSortOrder",qOp:"replace",qValue:"["+sortOrder.join(",")+"]"}];this.parent.model.applyPatches(patches,!0)},QHeader.prototype.reverseOrder=function(){var isDimension=this.col<this.parent.qHyperCube.qDimensionInfo.length,patches=[{qPath:"/"+this.parent.defPath+(isDimension?"/qDimensions/"+this.col:"/qMeasures/"+(this.col-this.parent.qHyperCube.qDimensionInfo.length))+"/qDef/qReverseSort",qOp:"replace",qValue:(!this.qReverseSort).toString()}];this.parent.model.applyPatches(patches,!0)},QHeader.prototype.isSelected=function(qElemNumber){return this.selections.indexOf(qElemNumber)>-1},QHeader.prototype.toggleSelect=function(qElemNumber){var pos=this.selections.indexOf(qElemNumber);0>pos?this.selections.push(qElemNumber):this.selections.splice(pos,1)},QDimensionCell.prototype.select=function(){this.parent.view&&this.parent.view.selectValues?this.parent.view.selectValues(this.col,[this.qElemNumber],!0):this.header.field.select([this.qElemNumber],!0),this.header.toggleSelect(this.qElemNumber)},QMeasureCell.prototype.getPercentOfMax=function(){return Math.round(100*this.qNum/this.qMeasureInfo.qMax*100)/100},QMeasureCell.prototype.getPercent=function(){return Math.round(100*this.qNum/this.qGrandTotal.qNum*100)/100},QTable.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var me=this,requestPage={qTop:this.rows.length,qLeft:0,qWidth:this.colCount,qHeight:50};me.view?me.view.backendApi.getData([requestPage]).then(function(pages){addDataRows(me,pages),me.requestActive=!1,me.OnData.emit()}):me.model.getData([requestPage]).then(function(pages){addDataRows(me,pages),me.requestActive=!1,me.OnData.emit()})}},QTable.prototype.getColByName=function(fld){if(fld){var result,strUpper=fld.toUpperCase();return this.headers&&this.headers.forEach(function(head,col){head.qFallbackTitle.toUpperCase()===strUpper&&(result=col)}),result}},QTable.prototype.exportData=function(options,callback){options=options||{},this.model.exportData(options.format||"OOXML","/"+this.defPath,options.filename,options.state||"P").then(function(reply){var link="../.."+reply.result.qUrl;options.download&&window.open(link),callback&&callback(link)})},QTable}),define("apis/qutil",["qvangular","core.utils/deferred"],function(qvangular,Deferred){function createVisualizationHtml(options,appId){var html="";return options&&options.noInteraction&&(html='<div style="width:100%;height:100%;position:relative">'),html+=options&&options.currentSelections?'<qv-stage-current-selections class="qvt-selections" app-name="'+appId+'"></qv-stage-current-selections><div id="qv-global-search-container"></div>':'<qv-object model="model" options="options"></qv-object>',options&&options.noInteraction&&(html+='<div style="position:absolute;top:0;left:0;width:100%;height:100%;overflow: hidden;"></div>',html+="</div>"),html}function appDoIt(app,method,params){var dfd=new Deferred;return qvangular.$apply(qvangular.$rootScope,function(){app.rpc(method,null,params).then(function(){dfd.resolve()})}),dfd.promise}function setDefaultId(param){backendId++,param.qInfo=param.qInfo||{},param.qInfo.qType=param.qInfo.qType||"mashup",param.qInfo.qId=param.qInfo.qId||"MU"+backendId}function getDefaultListParam(type){backendId++;var param={qInfo:{qType:type,qId:"MU"+backendId}};return"BookmarkList"===type?param.qBookmarkListDef={qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description"}}:"SnapshotList"===type?param.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===type?param.qSelectionObjectDef={}:"DimensionList"===type?param.qDimensionListDef={qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===type?param.qMeasureListDef={qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}:"sheet"===type?param.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===type?param.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:"VariableList"===type?param.qVariableListDef={qType:"variable",qData:{tags:"/tags"}}:"story"===type?param.qAppObjectListDef={qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}:param["q"+type+"Def"]={},param}function createHypercubeDef(dimensions,measures,options){var def={};if(dimensions){var dims=[];dimensions.forEach(function(dim){"string"==typeof dim?dims.push({qDef:{qFieldDefs:[dim]}}):dims.push(dim)}),def.qDimensions=dims}if(measures){var meas=[];measures.forEach(function(m){"string"==typeof m?meas.push({qDef:{qDef:m}}):meas.push(m)}),def.qMeasures=meas}return def.qInitialDataFetch=[{qTop:0,qLeft:0,qHeight:20,qWidth:(def.qDimensions?def.qDimensions.length:0)+(def.qMeasures?def.qMeasures.length:0)}],options&&options.rows&&(def.qInitialDataFetch[0].qHeight=options.rows),def}var backendId=0;return{createVisualizationHtml:createVisualizationHtml,appDoIt:appDoIt,setDefaultId:setDefaultId,getDefaultListParam:getDefaultListParam,createHypercubeDef:createHypercubeDef}}),define("apis/qapp",["jquery","qvangular","core.utils/deferred","core.models/session-object","core.models/generic-object","client.models/current-selections","objects.models/visualization-object","client.models/snapshot","objects.backend-api/snapshot-api","apis/qfield","apis/qbookmark","apis/qvariable","apis/qglobal","apis/qtable","apis/qutil"],function($,qvangular,Deferred,SessionObject,GenericObject,CurrentSelectionsModel,VisualizationObject,SnapshotModel,SnapshotAPI,QField,QBookmark,QVariable,QGlobal,QTable,QUtil){function showVisualization(element,vis,options,appId){var $element=$(element),$scope=qvangular.$rootScope.$new(),html=QUtil.createVisualizationHtml(options,appId);$element.html(html),$scope.model=vis,$scope.options=options||{};var $compile=qvangular.getService("$compile");return $compile($element.contents())($scope),qvangular.$apply($scope),$scope}function QApp(app){this.fieldCache={},Object.defineProperties(this,{id:{value:app.id},model:{value:app},global:{value:new QGlobal(app.session)},bookmark:{value:new QBookmark(app)},variable:{value:new QVariable(app,this)}})}var errorCallback;return QApp.prototype.clearAll=function(lockedAlso,state){return QUtil.appDoIt(this.model,"ClearAll",[lockedAlso||!1,state||"$"])},QApp.prototype.back=function(){return QUtil.appDoIt(this.model,"Back")},QApp.prototype.forward=function(){return QUtil.appDoIt(this.model,"Forward")},QApp.prototype.lockAll=function(state){return QUtil.appDoIt(this.model,"LockAll",[state||"$"])},QApp.prototype.unlockAll=function(state){return QUtil.appDoIt(this.model,"UnlockAll",[state||"$"])},QApp.prototype.getObject=function(element,id,options){var dfd,scope,app=this.model;if(id?"string"==typeof element&&(element=document.getElementById(element)):(id=element,element=void 0),dfd=new Deferred,"CurrentSelections"===id){if(element){var opt=options||{};opt.currentSelections=!0,scope=showVisualization(element,null,opt,this.id)}CurrentSelectionsModel.get(app).then(function(model){model.close=function(){scope&&scope.$destroy()},dfd.resolve(model)})}else qvangular.$apply(qvangular.$rootScope,function(){VisualizationObject.get(id,app).then(function(model){element&&(scope=showVisualization(element,model,options)),model.getLayout().then(function(){model.close=function(){scope&&scope.$destroy()},dfd.resolve(model)})},function(err){errorCallback&&(errorCallback(err.error),err.isHandled=!0),dfd.reject(err.error)})});return dfd.promise},QApp.prototype.getSnapshot=function(element,id){var dfd=new Deferred;return id||(id=element,element=void 0),SnapshotModel.Snapshot.get(id,this.model).then(function(model){element&&("string"==typeof element&&(element=document.getElementById(element)),showVisualization(element,model,{APIType:SnapshotAPI,noInteraction:!0})),model.getLayout().then(function(){dfd.resolve(model)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QApp.prototype.getObjectProperties=function(id){return GenericObject.getProperties(id,this.model)},QApp.prototype.getFullPropertyTree=function(id){return GenericObject.get(id,this.model).then(function(obj){return obj.getFullPropertyTree().then(function(){return obj})})},QApp.prototype.createGenericObject=function(param,callback){var wrapper=this,okFunc=callback?function(data){callback(data,wrapper)}:function(){};QUtil.setDefaultId(param);var objectPromise=SessionObject.get(param,this.model);return qvangular.$apply(qvangular.$rootScope,function(){objectPromise.then(function(list){list.getLayout().then(okFunc),list.Invalidated.bind(function(){list.getLayout().then(okFunc)}),list.Aborted.bind(function(){list.getLayout().then(okFunc)})},function(err){errorCallback&&(errorCallback(err.error,wrapper),err.isHandled=!0)})}),objectPromise},QApp.prototype.destroySessionObject=function(id){return this.model.rpc("DestroySessionObject",null,[id])},QApp.prototype.createCube=function(def,callback){return this.createGenericObject({qHyperCubeDef:def},callback)},QApp.prototype.createList=function(def,callback){return this.createGenericObject({qListObjectDef:def},callback)},QApp.prototype.getList=function(type,callback){return this.createGenericObject(QUtil.getDefaultListParam(type),callback)},QApp.prototype.getAppObjectList=function(type,callback){return callback||(callback=type,type="sheet"),this.getList(type,callback)},QApp.prototype.searchSuggest=function(qTerms,qOptions,callback){var promise=this.model.rpc("SearchSuggest",null,[qOptions,qTerms]);return callback&&promise.then(function(reply){callback(reply)}),promise},QApp.prototype.searchAssociations=function(qTerms,qPage,qOptions,callback){var promise=this.model.rpc("SearchAssociations",null,[qOptions||{},qTerms,qPage]);return callback&&promise.then(function(reply){callback(reply)}),promise},QApp.prototype.selectAssociations=function(qMatchIx,qTerms,qOptions,qSoftLock){return this.model.rpc("SelectAssociations",null,[qOptions||{},qTerms,qMatchIx,qSoftLock||!1])},QApp.prototype.getAppLayout=function(callback){var me=this,okFunc=callback?function(data){callback(data,me)}:function(){},promise=me.model.getLayout();return me.model.Invalidated.bind(function(){me.model.getLayout().then(okFunc)}),me.model.Aborted.bind(function(){me.model.getLayout().then(okFunc)}),promise.then(okFunc),promise},QApp.prototype.addAlternateState=function(qStateName){return this.model.rpc("AddAlternateState",null,[qStateName])},QApp.prototype.removeAlternateState=function(qStateName){return this.model.rpc("RemoveAlternateState",null,[qStateName])},QApp.prototype.doReload=function(qMode,qPartial,qDebug){return this.fieldCache={},this.model.rpc("DoReload",null,[qMode||0,qPartial||!1,qDebug||!1])},QApp.prototype.doSave=function(qFileName){return this.model.rpc("DoSave",null,[qFileName])},QApp.prototype.field=function(fld,statename){var cacheId=statename?fld+"/"+statename:fld;return this.fieldCache[cacheId]||(this.fieldCache[cacheId]=new QField(this,fld,statename)),this.fieldCache[cacheId]},QApp.prototype.table=function(ext,path){return new QTable(this,ext,path)},QApp.setErrorCallback=function(callback){errorCallback=callback},QApp.prototype.createTable=function(dimensions,measures,options){var def=QUtil.createHypercubeDef(dimensions,measures,options);return new QTable(this,this.createGenericObject({qHyperCubeDef:def}))},QApp}),define("apis/qnavigation",["qvangular","client.utils/state","client.utils/routing"],function(qvangular,State,Routing){function getSheets(target){var service=qvangular.getService("$navigationService");target.sheets=service.Sheets.all.mashed,target.stories=service.Stories.all.mashed}function getCurrentSheetPos(sheets){var sheetId=State.model.id,pos=-1;return sheets.forEach(function(sheet,index){sheet.qInfo.qId===sheetId&&(pos=index)}),pos}function getSheetForId(sheetId,sheets){var sheet;return sheets.forEach(function(s){s.qInfo.qId===sheetId&&(sheet=s)}),sheet}function getStoryForId(storyId,stories){var story;return stories.forEach(function(s){s.qInfo.qId===storyId&&(story=s)}),story}function goSheet(sheetId){return Routing.goToSheet(sheetId,Object.keys(State.States)[State.state]),{success:!0,sheetId:sheetId}}function goStory(storyId){return Routing.goToStory(storyId,Object.keys(State.States)[State.States.play]),{success:!0,storyId:storyId}}function QNavigation(inClient,sheets,stories){this.inClient=inClient,sheets?(this.sheets=sheets,this.stories=stories):inClient?getSheets(this):(this.sheets=[],this.stories=[]),Object.defineProperties(this,{ANALYSIS:{get:function(){return"analysis"}},EDIT:{get:function(){return"edit"}},SNAPSHOT:{get:function(){return"snapshot"}}})}return QNavigation.prototype.gotoSheet=function(sheetId){var model=getSheetForId(sheetId,this.sheets);return model?goSheet(sheetId):{success:!1,error:"NOSUCHSHEET",errorMsg:"No such sheet"}},QNavigation.prototype.nextSheet=function(){if(State.view===State.Views.sheet&&State.model){var pos=getCurrentSheetPos(this.sheets)+1,newid=this.sheets[pos===this.sheets.length?0:pos].qInfo.qId;return goSheet(newid)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.prevSheet=function(){if(State.view===State.Views.sheet&&State.model){var pos=getCurrentSheetPos(this.sheets)-1,newid=this.sheets[0>pos?this.sheets.length-1:pos].qInfo.qId;return goSheet(newid)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.getCurrentSheetId=function(){return State.view===State.Views.sheet&&State.model?{success:!0,sheetId:State.model.id}:{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.getMode=function(){return Object.keys(State.States)[State.state]},QNavigation.prototype.setMode=function(mode){return this.isModeAllowed(mode)?(State.setState(State.States[mode]),{success:!0,mode:mode}):{success:!1,error:"MODENOTALLOWED",errorMsg:"Mode not allowed"}},QNavigation.prototype.isModeAllowed=function(mode){switch(mode){case this.ANALYSIS:return!0;case this.EDIT:return this.inClient&&State.model.layout&&State.model.layout.permissions&&State.model.layout.permissions.update;case this.SNAPSHOT:return this.inClient}return!1},QNavigation.prototype.gotoStory=function(storyId){var model=getStoryForId(storyId,this.stories);return model?goStory(storyId):{success:!1,error:"NOSUCHSTORY",errorMsg:"No such story"}},QNavigation}),define("apis/qsession",["qvangular","core.utils/deferred","client.models/rpc-session","autogenerated/qix/engine-enums","core.utils/authentication"],function(qvangular,Deferred,RPCSession,enums,Authentication){function setupSocketErrorHandling(onError,onWarning){RPCSession.useTimeoutOnClose=!0,RPCSession.createSocket=function(url){var ws;try{ws=new WebSocket(url)}catch(err){onError(err)}return ws},RPCSession.hookIntoDeferred=function(dfd){dfd.promise.then(null,function(err){return qvangular.getService("$timeout")(function(){err&&(err.isHandled||err.error.isHandled||!err.error||err.error.code===Errors.LOCERR_GENERIC_ABORTED||err.error.code===Errors.LOCERR_APP_NOT_FOUND||onError(err.error))},1e3),Deferred.reject(err)})},RPCSession.NewSessionCreated.observers.forEach(function(obs){RPCSession.NewSessionCreated.unbind(obs)}),RPCSession.NewSessionCreated.bind(function(session){session.Notification.bind(function(reply){"OnAuthenticationInformation"===reply.method&&Authentication.parse(reply.params),reply.error?onError(reply.error):reply.params&&"fatal"===reply.params.severity?onError({message:reply.params.message,method:reply.method}):onWarning&&onWarning(reply)}),onWarning&&session.Warning.bind(onWarning)})}var Errors=enums.NxLocalizedErrorCode;return{setupSocketErrorHandling:setupSocketErrorHandling}}),define("general.utils/touch-configuration-util",["jquery","general.utils/support"],function($,Support){"use strict";return{configureTouchSupport:function(){$(document.body.parentElement).addClass("touch-"+(Support.treatAsDesktop()?"off":"on"))}}}),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin","require"],function(qvangular,Deferred,translator,xsrfPlugin,require){qvangular.service("$contentApi",["$http",function($http){function ensureHeaders(config){config.headers||(config.headers={})}function ensureParams(config){config.params||(config.params={})}function setXsrf(config){var xsrfKey=xsrfPlugin.getRandomString(16);return config.headers["X-Qlik-XrfKey"]=xsrfKey,config.params.xrfkey=xsrfKey,config}function setVirtualProxy(config){var basePath=require.toUrl(""),pos=basePath.indexOf("/resources");return pos>-1&&(basePath=basePath.substring(0,pos)),config.url=basePath+config.url,config}function setAcceptLanguage(config){var lang=translator.language;return lang&&(config.headers["Accept-Language"]="pseudo"!==lang?lang:"qps-ploc"),config}function request(config){return ensureHeaders(config),ensureParams(config),qvangular.$rootScope.isPersonalMode||setXsrf(config),setVirtualProxy(config),setAcceptLanguage(config),$http(config)}function getExtensions(){var dfd=new Deferred,config={method:"GET",url:"/qrs/extension/schema"};return request(config).then(function(response){var data=response.data;dfd.resolve(data)})["catch"](function(response){var data=response.data;dfd.reject(data)}),dfd.promise}return{getExtensions:getExtensions,request:request}}])}),define("general.models/library/extension-list",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(Deferred,qvangular){"use strict";var ExtensionList={},dfd=null;return ExtensionList.getList=function(){return null===dfd&&(dfd=new Deferred,qvangular.getService("$contentApi").getExtensions().then(function(result){var arr=[];for(var property in result)result.hasOwnProperty(property)&&arr.push({id:property,data:result[property]});dfd.resolve(arr)},function(){var arr=[];dfd.resolve(arr)})),dfd.promise},ExtensionList}),define("general.utils/qv-activate",["jquery","jqueryoutside","touche"],function($){function createEvent(type,nativeEvent,data){return $.Event(type,{pageX:data.pagePoints[0].x,pageY:data.pagePoints[0].y,ctrlKey:nativeEvent.ctrlKey,metaKey:nativeEvent.metaKey,shiftKey:nativeEvent.shiftKey,originalEvent:nativeEvent,gestureData:data})}var originalTarget;Touche(document.body).tap({options:{preventDefault:!1},start:function(nativeEvent){originalTarget=$(nativeEvent.target)},end:function(nativeEvent,data){var wrappedEvent=createEvent("qv-activate",nativeEvent,data);0===originalTarget.closest(":disabled").length&&originalTarget.trigger(wrappedEvent),originalTarget=null}});var Press=Touche.Gesture.augment(function(Gesture){function Press(){Gesture.apply(this,arguments)}return this.defaults={precedence:6},this.start=function(event,data){this.binder.start.call(this,event,data)},Press});Touche.gestures.add("press",Press),Touche(document.body).press({start:function(nativeEvent,data){var wrappedEvent=createEvent("qv-press",nativeEvent,data);$(nativeEvent.target).trigger(wrappedEvent)}}),$.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),define("general.utils/qv-swipe",["jquery","touche"],function($){function createEvent(type,nativeEvent,data){return $.Event(type,{pageX:data.pagePoints[0].x,pageY:data.pagePoints[0].y,ctrlKey:nativeEvent.ctrlKey,shiftKey:nativeEvent.shiftKey,originalEvent:nativeEvent,gestureData:data})}function captureMouse(){function removeCaptureMouse(){document.removeEventListener("mousedown",mousedown,!0),document.removeEventListener("mousemove",mousemove,!0),document.removeEventListener("mouseup",mouseup,!0)}function mousedown(e){e.preventDefault(),e.stopPropagation()}function mousemove(e){e.preventDefault(),e.stopPropagation()}function mouseup(e){e.preventDefault(),e.stopPropagation(),removeCaptureMouse(),clearTimeout(timeoutId)}var timeoutId;document.addEventListener("mousedown",mousedown,!0),document.addEventListener("mousemove",mousemove,!0),document.addEventListener("mouseup",mouseup,!0),timeoutId=setTimeout(removeCaptureMouse,350)}var origTarget;Touche(document.body).tap({options:{preventDefault:!1},start:function(nativeEvent){origTarget=$(nativeEvent.target)}}),Touche(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(nativeEvent,data){var wrappedEvent=createEvent("qv-swipestart",nativeEvent,data);origTarget.trigger(wrappedEvent)},update:function(nativeEvent,data){var wrappedEvent=createEvent("qv-swipeupdate",nativeEvent,data);origTarget.trigger(wrappedEvent)},cancel:function(){var wrappedEvent=$.Event("qv-swipecancel");origTarget.trigger(wrappedEvent)},end:function(nativeEvent,data){Touche.utils.isMouse(nativeEvent)||captureMouse();var wrappedEvent=createEvent("qv-swipe",nativeEvent,data);origTarget.trigger(wrappedEvent)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function($,Touche){"use strict";var LongtapSwipe=Touche.Gesture.augment(function(Gesture){function LongtapSwipe(){Gesture.apply(this,arguments)}function captureMouse(){function removeCaptureMouse(){document.removeEventListener("mousedown",mousedown,!0),document.removeEventListener("mousemove",mousemove,!0),document.removeEventListener("mouseup",mouseup,!0)}function mousedown(e){e.preventDefault(),e.stopPropagation()}function mousemove(e){e.preventDefault(),e.stopPropagation()}function mouseup(e){e.preventDefault(),e.stopPropagation(),removeCaptureMouse(),clearTimeout(timeoutId)}var timeoutId;document.addEventListener("mousedown",mousedown,!0),document.addEventListener("mousemove",mousemove,!0),document.addEventListener("mouseup",mouseup,!0),timeoutId=setTimeout(removeCaptureMouse,350);
}var isLongtapSwipePossible=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(elem){this.count=0,Touche(elem).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(elem){Touche(elem).off("longtap",this.id),Touche(elem).off("swipe",this.id)},this.longtapStart=function(){isLongtapSwipePossible=!1},this.longtapUpdate=function(event,data){100===data.percentage&&(isLongtapSwipePossible=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){isLongtapSwipePossible||this.binder.cancel()},this.swipeStart=function(event,data){var stopEvent=$(event.target).is("input, textarea");isLongtapSwipePossible&&!stopEvent?this.binder.start(event,data):isLongtapSwipePossible&&stopEvent&&(isLongtapSwipePossible=!1)},this.swipeUpdate=function(event,data){isLongtapSwipePossible&&this.binder.update(event,data)},this.swipeEnd=function(event,data){isLongtapSwipePossible&&(captureMouse(),this.binder.end(event,data))},this.swipeCancel=function(){isLongtapSwipePossible=!1,this.binder.cancel()},LongtapSwipe});Touche.gestures.add("longtapswipe",LongtapSwipe)}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\r\n    <div class="icon-add"></div>\r\n    <div class="add-text" q-translation="{{emptyTranslation}}" q-title-translation="{{emptyTranslation}}"></div>\r\n</div>\r\n<div ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\r\n<input ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>'}),define("objects/inline-title-edit",["qvangular","angular","core.models/rpc-base","general.utils/property-resolver","text!./inline-title-edit.ng.html"],function(qvangular,angular,RPCBase,propertyResolver,template){"use strict";function getPlainString(value){return"object"==typeof value&&(value=value.qStringExpression.qExpr,"="!==value[0]&&(value="="+value)),value}function getOptStringExpressionObject(value){return value&&0===value.indexOf("=")?{qStringExpression:{qExpr:value}}:value}qvangular.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){element.unbind("input keydown change compositionend"),element.bind("blur",function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.val()),scope.doEdit()})}),element.bind("keydown",function(e){e.stopPropagation(),27===e.which?(element.val(ngModelCtrl.$viewValue),element.trigger("blur")):13===e.which&&"textarea"!==element[0].nodeName.toLowerCase()&&element.trigger("blur")})}}}]),qvangular.directive("qvInlineTitleEdit",["$timeout",function($timeout){return{template:template,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@"},priority:1,link:function($scope,element){var buttonElem=element.children().first(),valueElem=element.children().eq(1),inputElem=element.children().eq(2);$scope.editing=!1,$scope.titleProperty="",$scope.titleValue="",RPCBase.bindLayout($scope,"model",function(layout){$scope.displayValue=propertyResolver.getValue(layout,$scope.layoutPath),$scope.editing=!1}),$scope.doEdit=function(){var newValue=getOptStringExpressionObject($scope.titleValue);$scope.editing&&(angular.equals(oldValue,newValue)?$scope.editing=!1:$scope.model.getProperties().then(function(props){propertyResolver.setValue(props,$scope.propertyPath,newValue),$scope.model.save(),oldValue=newValue}))};var oldValue;buttonElem.add(valueElem).on("qv-activate",function(){$scope.editing||$scope.model.getProperties().then(function(props){var length,nativeInput=inputElem.get(0);$scope.editing=!0,$scope.titleProperty=propertyResolver.getValue(props,$scope.propertyPath),$scope.titleValue=getPlainString($scope.titleProperty),oldValue=$scope.titleProperty,nativeInput.scrollLeft=nativeInput.scrollWidth,length=getPlainString($scope.titleProperty).length,nativeInput.selectionStart=length,nativeInput.selectionEnd=length,$timeout(function(){nativeInput.focus(),nativeInput.setSelectionRange(length,length)})})})}}}])}),define("objects.extension/base-controller",["core.utils/class","objects.extension/default-selection-toolbar"],function(Class,SelectionToolbar){"use strict";var DefaultBaseController;return DefaultBaseController=Class.extend({$scope:null,init:function($scope){this.$scope=$scope},onPaint:function(){},onResize:function(){},onStateChanged:function(){},setInteraction:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new SelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},allowInteraction:function(state){var allow=!1;return state.state!==state.States.analysis&&(state.state!==state.States.play||this.$scope.backendApi&&this.$scope.backendApi.isSnapshot)||(allow=!0),allow}}),DefaultBaseController.$inject=["$scope"],DefaultBaseController}),define("objects.views/charts/utils/cache-utils",[],function(){function getAllCacheItems(array,cacheItems){return array.forEach(function(item){if(item.isCacheItem)cacheItems.push(item);else if(item.data.cacheItem)cacheItems.push(item.data.cacheItem);else if(item.cacheItem&&(cacheItems.push(item.cacheItem),item.cacheItem.isCacheItem))throw"Using new cache item before its time";item.children&&item.children.length>0&&getAllCacheItems.apply(this,[item.children,cacheItems])}),cacheItems}var cacheUtils={getCacheItems:function(){return this.children&&this.children?getAllCacheItems.apply(this,[this.children,[]]):[]}};return cacheUtils}),define("objects.views/selections/types/base",["core.utils/class","objects.utils/shapes/point","objects.views/charts/utils/tree-iterator","objects.views/charts/utils/cache-utils"],function(Class,Point,treeIterator,cacheUtils){"use strict";function getSelectionID(comp){return comp?comp.selectionIdentifier:null}function isNull(item,selectionIndecies){if(selectionIndecies){var check=!1;return selectionIndecies.contains(0)&&(check=item.parent?-2===item.parent.id:-2===item.id),item.parent&&selectionIndecies.contains(1)&&(check=check||-2===item.id),check}return-2===item.id||item.parent&&-2===item.parent.id}function arrRemove(o){var idx=this.indexOf(o);idx>=0&&this.splice(idx,1)}var Base;return Base=Class.extend({init:function(handler,options){this._selectedShapes=[],this.handler=handler,this.options=options,this.components=options.components||{},this.activeComponent=null},release:function(){this.components={},this._selectedShapes=[],this.handler=null},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(shape){var index=this._selectedShapes.indexOf(shape);-1!==index?this._selectedShapes.splice(index,1):this._selectedShapes.push(shape)},setComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]=Array.isArray(component)?component:[component];break;default:throw"Key "+key+" not implemented"}},addComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]||(this.components[key]=[]),arrRemove.call(this.components[key],component),this.components[key].push(component);break;default:throw"Key "+key+" not implemented"}},removeComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]&&component&&arrRemove.call(this.components[key],component),component&&this.components[key]&&this.components[key].length||delete this.components[key];break;default:throw"Key "+key+" not implemented"}},getComponent:function(pageX,pageY){var point=new Point(pageX-this.handler.containerRect.x,pageY-this.handler.containerRect.y);return Object.keys(this.components).map(function(key){return this.components[key]},this).reduce(function(a,b){return a.concat(b)}).filter(function(component){return this.getRect(component).pointInside(point.x,point.y)},this)[0]},getRect:function(component){return component.rect},getComponentKey:function(component){return Object.keys(this.components).filter(function(key){return this.components[key].indexOf(component)>=0},this)[0]},setActiveMode:function(v){this._activeMode=v},getActiveMode:function(){return this._activeMode},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(pageX,pageY){var rect=this.getRect(this.activeComponent||this.components.dataArea[0]);return new Point(pageX-rect.x-this.handler.containerRect.x,pageY-rect.y-this.handler.containerRect.y)},getPagePoint:function(transformedPointX,transformedPointY,component){var rect=this.getRect(component||this.activeComponent||this.components.dataArea[0]);return new Point(transformedPointX+rect.x+this.handler.containerRect.x,transformedPointY+rect.y+this.handler.containerRect.y)},getInterpolatedPoints:function(start,end,pixelPrecision){pixelPrecision=pixelPrecision||this.options.interpolation.pixelPrecision||2;var progress,point,distance=start.distanceTo(end),precision=1/(distance/(pixelPrecision>0?pixelPrecision:distance)),points=[];for(points.push(start),progress=precision;1-precision>progress;progress+=precision)point=new Point(start.x+(end.x-start.x)*progress,start.y+(end.y-start.y)*progress),points.push(point);return points.push(end),points},shapeFromPoint:function(point){return this.shapesFromPoints([point])[0]},shapesFromPoints:function(points){var point,shapesLen,shapes,shape,item,i,j,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,pointsLen=points.length,selectionID=getSelectionID(this.activeComponent),foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;pointsLen>j;++j)for(point=points[j],shapes=item.getShapes(getSelectionID(this.activeComponent)),"dataArea"===selectionID&&item.toggleShapes&&(shapes=shapes.concat(item.toggleShapes)),shapesLen=shapes.length,k=0;shapesLen>k;++k)if(shape=shapes[k],shape.pointInside(point.x,point.y)){foundItems.push(item);break}return foundItems},shapesFromLines:function(lines){var line,shapesLen,shapes,shape,item,i,j,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,linesLen=lines.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;linesLen>j;++j)for(line=lines[j],shapes=item.getShapes(getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k;++k)if(shape=shapes[k],shape.intersectsLine(line)){foundItems.push(item);break}return foundItems},shapesFromPolygon:function(polygon){var points,point,pointsLen,shapesLen,shapes,item,i,j,k,foundItem,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(foundItem=!1,shapes=item.getShapes(getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k&&!foundItem;++k)for(points=shapes[k].getPoints(),pointsLen=points.length,j=0;pointsLen>j;++j)if(point=points[j],polygon.pointInside(point.x,point.y)){foundItems.push(item),foundItem=!0;break}return foundItems},shapesFromRect:function(rect,componentId){if(!rect)return[];var shapesLen,shapes,shape,item,i,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(shapes=item.getShapes(componentId?componentId:getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k;k++)if(shape=shapes[k],shape.intersectsRect){if(shape.intersectsRect(rect)){foundItems.push(item);break}}else if(rect.intersectsWith(shape)){foundItems.push(item);break}return foundItems},shapesFromRectForDirection:function(rect,directionProperty,componentId){var item,shapesLen,shapes,shape,shapeBounds,i,j,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[],min=0,max=0,boundaryFnStr="";switch(directionProperty){case"x":min=rect.x,max=rect.getRight(),boundaryFnStr="getRight";break;case"y":min=rect.y,max=rect.getBottom(),boundaryFnStr="getBottom"}for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(shapes=item.getShapes(componentId?componentId:getSelectionID(this.activeComponent)),shapesLen=shapes.length,j=0;shapesLen>j;++j)if(shape=shapes[j],"cx"in shape){if(shape["c"+directionProperty]>=min&&shape["c"+directionProperty]<=max){foundItems.push(item);break}}else{if(shapeBounds=shape.getBoundingRect(),shapeBounds[directionProperty]>=min&&shapeBounds[directionProperty]<=max){foundItems.push(item);break}if(shapeBounds[boundaryFnStr]()>=min&&shapeBounds[boundaryFnStr]()<=max){foundItems.push(item);break}if(min>=shapeBounds[directionProperty]&&max<=shapeBounds[boundaryFnStr]()){foundItems.push(item);break}}return foundItems},shapesFromRange:function(val1,val2,minInclEq,maxInclEq){var item,values,value,i,j,compareFunction,minVal=Math.min(val1,val2),maxVal=Math.max(val1,val2),items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,indices="function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,foundItems=[];for(minInclEq=minInclEq!==!1,maxInclEq=maxInclEq!==!1,compareFunction=minInclEq&&maxInclEq?function(value){return value>=minVal&&maxVal>=value}:minInclEq?function(value){return value>=minVal&&maxVal>value}:maxInclEq?function(value){return value>minVal&&maxVal>=value}:function(value){return value>minVal&&maxVal>value},i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(values=item.values instanceof Array?item.values:item.value instanceof Array?item.value:[item.value],indices&&indices.length&&(values=values.filter(function(v,idx){return indices.indexOf(idx)>=0})),j=0;j<values.length;j++)if(value=values[j],compareFunction(value)){foundItems.push(item);break}return foundItems},shapesFromDimensionValue:function(values){var item,i,j,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;j<values.length;j++)if(item.id===values[j]){foundItems.push(item);break}return foundItems},groupedItemsFromShapes:function(cacheItems){var activeDimensions,dimIndex,nodeDepth,nodeParent,cParents=[];return activeDimensions=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],dimIndex=activeDimensions[activeDimensions.length-1],cacheItems.forEach(function(node){nodeParent=node.parent,void 0!==nodeParent&&(nodeDepth=treeIterator.getLevel.call(nodeParent)-(node.isCacheItem?0:1),nodeDepth===dimIndex&&-1===cParents.indexOf(nodeParent)&&cacheItems&&cParents.push(nodeParent))}),cParents.length>0&&(cacheItems=[],cParents.forEach(function(item){cacheItems=cacheItems.concat(cacheUtils.getCacheItems.call(item))})),cacheItems},shapesFromIndex:function(index1,index2){var item,i,startIndex=Math.min(index1,index2),endIndex=Math.max(index1,index2),items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)item=items[i],void 0!==item.index&&item.index>=startIndex&&item.index<=endIndex&&foundItems.push(item);return foundItems},ToggleFlag:{select:1,deselect:2,auto:4,replace:8,tooltip:16},toggleSelection:function(items,toggleFlag){function toggleItem(filterFn){var filteredItems=items.filter(filterFn);filteredItems.forEach(function(item){disableSelections||(item.selected=!item.selected,toggleSelectedShape(item),ToggleShape.emit(item,toggleFlag))}),filteredItems.length>0&&ToggleShapes.emit(items,toggleFlag)}var tempItems,disableSelections=this.handler._disableSelections,ToggleFlag=this.ToggleFlag,ToggleShape=this.handler.ToggleShape,ToggleShapes=this.handler.ToggleShapes,ToggleTooltip=this.handler.ToggleTooltip,toggleSelectedShape=this.toggleSelectedShape.bind(this);toggleFlag=toggleFlag||ToggleFlag.auto,toggleFlag&ToggleFlag.select?toggleItem(function(item){return!item.selected}):toggleFlag&ToggleFlag.deselect?toggleItem(function(item){return item.selected}):toggleFlag&ToggleFlag.auto?toggleItem(function(){return!0}):toggleFlag&ToggleFlag.replace&&(tempItems=items,items=this.handler.cache.data,toggleItem(function(item){return item.selected}),items=tempItems,toggleItem(function(){return!0})),toggleFlag&ToggleFlag.tooltip&&ToggleTooltip.emit(items,disableSelections)},clearSelection:function(){var Clear=this.handler.Clear,items=this.handler.cache.data,toggleFlag=this.ToggleFlag.deselect;this.toggleSelection(items,toggleFlag),Clear.emit()},_isNull:isNull}),Base.defaultOptions={},Base}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(qvangular,showService){var flashComponent={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function($scope){$scope.style={},$scope.style.top=$scope.top,$scope.style.left=$scope.left,$scope.style.height=$scope.height,$scope.style.width=$scope.width,$scope.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}},Framer={flash:function(point1,point2){var $timeout=qvangular.getService("$timeout"),flashFrame=showService.show(flashComponent,{top:Math.min(point1.y,point2.y)+"px",left:Math.min(point1.x,point2.x)+"px",height:Math.max(point1.y,point2.y)-Math.min(point1.y,point2.y)+"px",width:Math.max(point1.x,point2.x)-Math.min(point1.x,point2.x)+"px",closeComponent:function(){$timeout(function(){flashFrame.destroy(),flashFrame=null},300)}})}};return Framer}),define("objects.views/selections/types/data-area",["jquery","objects.utils/shapes/point","objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","./base","general.components/framer/framer"],function($,Point,Polygon,Rect,Line,Base,Framer){"use strict";function renderCaptureStart(){ctx.beginPath(),ctx.moveTo(startPoint.x,startPoint.y),ctx.fillStyle="rgba(77, 192, 78, 1)",ctx.arc(startPoint.x,startPoint.y,10,0,2*Math.PI,!0),ctx.fill()}function renderCapture(p1,p2,shiftLockProperty){var cpX,cpY;!shiftLockProperty||"x"!==shiftLockProperty&&"y"!==shiftLockProperty||(p2[shiftLockProperty]=startPoint[shiftLockProperty]),cpX=(p1.x+p2.x)/2,cpY=(p1.y+p2.y)/2,ctx.beginPath(),ctx.moveTo(p1.x,p1.y),ctx.quadraticCurveTo(cpX,cpY,p2.x,p2.y),ctx.stroke()}function renderLineDashTo(c,start,end,dashArray){dashArray=dashArray||[2,4];var dashLength,dashCount=dashArray.length,dx=end.x-start.x,dy=end.y-start.y,n=Math.sqrt(dx*dx+dy*dy),distRemaining=n,dashIndex=0,draw=!0,x=start.x,y=start.y;for(dx/=n,dy/=n,c.moveTo(x,y),dashIndex=0;distRemaining>=.1&&5e3>dashIndex;++dashIndex)dashLength=dashArray[dashIndex%dashCount],0===dashLength&&(dashLength=.001),dashLength>distRemaining&&(dashLength=distRemaining),x+=dashLength*dx,y+=dashLength*dy,c[draw?"lineTo":"moveTo"](x,y),distRemaining-=dashLength,draw=!draw}function renderCaptureAutoCloseLine(start,end){ctxAutoClose.clearRect(0,0,canvasAutoClose.width,canvasAutoClose.height),ctxAutoClose.beginPath(),renderLineDashTo(ctxAutoClose,start,end),ctxAutoClose.stroke()}function hideCapture(){$uiContainer.hide(),$canvas.hide(),$canvasAutoClose.hide()}var DataArea,startPoint,$uiContainer=$("<div />"),uiContainer=$uiContainer[0],$canvas=$("<canvas />"),canvas=$canvas[0],$canvasAutoClose=$("<canvas />"),canvasAutoClose=$canvasAutoClose[0],$canvasFadeOut=$("<canvas />"),canvasFadeOut=$canvasFadeOut[0],ctx=canvas.getContext("2d"),ctxAutoClose=canvasAutoClose.getContext("2d"),ctxFadeOut=canvasFadeOut.getContext("2d"),swipePoints=[],lassoCanAutoClose=!1,lassoIsAutoClosed=!1;return uiContainer.appendChild(canvas),uiContainer.appendChild(canvasAutoClose),uiContainer.appendChild(canvasFadeOut),uiContainer.className="selections-data-area-ui",$uiContainer.hide(),DataArea=Base.extend("DataAreaSelection",{init:function(handler,options){this._super(handler,options),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.activeComponent=this.components.dataArea[0]},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var attrs={position:"absolute",left:this.rect.x+"px",top:this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};ctx.canvas.width=this.rect.width,ctx.canvas.height=this.rect.height,ctx.lineWidth=2,ctx.lineCap="round",ctx.lineJoin="round",ctx.strokeStyle="rgba(102,102,102,1)",ctx.fillStyle="rgba(102,102,102,1)",$canvas.css(attrs),ctxAutoClose.canvas.width=this.rect.width,ctxAutoClose.canvas.height=this.rect.height,ctxAutoClose.lineWidth=2,ctxAutoClose.lineCap="round",ctxAutoClose.lineJoin="round",ctxAutoClose.strokeStyle="rgba(102,102,102,1)",$canvasAutoClose.css(attrs),ctxFadeOut.canvas.width=this.rect.width,ctxFadeOut.canvas.height=this.rect.height,$canvasFadeOut.css(attrs)},toggle:function(e,currentPoint,toggle){toggle=void 0!==toggle?toggle:this.handler.getKeyAsToggleSelected(e),toggle||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var shapes,point=this.getTransformedPoint(currentPoint.x,currentPoint.y),cb=this.options.toggle.callback||this.toggleSelection,indexSelection=this.options.indexSelection,toggleFlag=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return shapes=indexSelection?this.shapesFromRectForDirection(new Rect(point.x,point.y,0,0),"y"):this.shapesFromPoints([point]),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(c){c.selectionMode="dataArea"}),shapes.forEach(function(c){c.interactPosition=currentPoint}),cb.call(this,shapes,toggleFlag),shapes&&shapes.length>0},toggleRect:function(e,p1,p2){if(p1&&p2){var x,y,w,h,rect,shapes,toggleFlag,indexSelection,cb,framePoint1,framePoint2,dataAreaContainer=$(this.components.dataArea[0].container),dataAreaOffset=dataAreaContainer.offset(),adjustPointInBounds=function(p){return{x:Math.min(Math.max(p.x,dataAreaOffset.left),dataAreaOffset.left+dataAreaContainer.width()),y:Math.min(Math.max(p.y,dataAreaOffset.top),dataAreaOffset.top+dataAreaContainer.height())}};p1=adjustPointInBounds(p1),p2=adjustPointInBounds(p2),framePoint1=p1,framePoint2=p2,this.resetSelectedShapes(),p1=this.getTransformedPoint(p1.x,p1.y),p2=this.getTransformedPoint(p2.x,p2.y),x=Math.min(p1.x,p2.x),y=Math.min(p1.y,p2.y),w=Math.max(1,Math.abs(p2.x-p1.x)),h=Math.max(1,Math.abs(p2.y-p1.y)),rect=new Rect(x,y,w,h),toggleFlag=this.ToggleFlag.select,indexSelection=this.options.indexSelection,cb=this.toggleSelection,this.activeComponent=this.components.dataArea[0],shapes=indexSelection?this.shapesFromRectForDirection(rect,"y"):this.shapesFromRect(rect),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),Framer.flash(framePoint1,framePoint2)}},start:function(e,currentPoint){this.handler.getKeyAsToggleSelected(e)||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var point=this.getTransformedPoint(currentPoint.x,currentPoint.y),captureInput=this.options.captureInput,indexSelection=this.options.indexSelection;if(captureInput&&($canvas.show(),$canvasAutoClose.show(),$uiContainer.appendTo(this.handler.container),$uiContainer.show(),this.refreshCanvas()),swipePoints.length=0,swipePoints.push(point),startPoint=new Point(swipePoints[0].x,swipePoints[0].y),lassoCanAutoClose=!1,lassoIsAutoClosed=!1,indexSelection){var startShape=this.shapesFromRectForDirection(new Rect(startPoint.x,startPoint.y,1,1),"y"),startIndex=startShape.length&&startShape[0].index;void 0!==startIndex&&startIndex>=0&&(this._startIndex=startIndex)}captureInput&&renderCaptureStart()},update:function(e,currentPoint){var lastPoint,shapes,removeShapes,endShape,point=this.getTransformedPoint(currentPoint.x,currentPoint.y),opts=this.options,captureInput=opts.captureInput,lassoAutoCloseDistance=opts.lassoAutoCloseDistance,indexSelection=opts.indexSelection,shiftLockProperty=e.shiftKey&&opts.shiftLockCapture?opts.shiftLockAxis:"",toggleFlag=this.ToggleFlag.select,endIndex=-1,cb=this.toggleSelection;lastPoint=swipePoints[swipePoints.length-1],swipePoints.push(point),captureInput&&renderCapture(lastPoint,point,shiftLockProperty),captureInput&&(lassoCanAutoClose||(lassoCanAutoClose=swipePoints.length>2&&startPoint.distanceTo(point)>=lassoAutoCloseDistance),ctxAutoClose.clearRect(0,0,canvasAutoClose.width,canvasAutoClose.height),lassoCanAutoClose&&(startPoint.distanceTo(point)<=lassoAutoCloseDistance?(renderCaptureAutoCloseLine(point,startPoint),lassoIsAutoClosed=!0):lassoIsAutoClosed=!1)),indexSelection?(endShape=this.shapesFromRectForDirection(new Rect(point.x,point.y,1,1),"y"),endIndex=endShape.length?endShape[0].index:-1,void 0!==endIndex&&endIndex>=0&&(this._endIndex=endIndex),shapes=this.shapesFromIndex(this._startIndex,this._endIndex),removeShapes=this.getSelectedShapes().filter(function(shape){return-1===shapes.indexOf(shape)}),cb.call(this,removeShapes,this.ToggleFlag.deselect),cb.call(this,shapes,toggleFlag)):(shapes=this.shapesFromLines([new Line(lastPoint.x,lastPoint.y,point.x,point.y)]),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag))},end:function(e){var shapes,polygon,captureInput=this.options.captureInput,indexSelection=this.options.indexSelection,toggleFlag=this.ToggleFlag.select,cb=this.toggleSelection;indexSelection&&(this._startIndex=-1,this._endIndex=-1),captureInput&&hideCapture(),captureInput&&lassoIsAutoClosed&&(polygon=new Polygon(swipePoints),shapes=this.shapesFromPolygon(polygon),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag)),swipePoints.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(e))},cancel:function(cancelAndClear){swipePoints.length&&hideCapture(),cancelAndClear&&this.clearSelection(),this.activeComponent=null}}),DataArea.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},DataArea}),define("text!objects.views/selections/types/range/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\r\n\r\n	<div ng-show="vertical" class="range-vertical"\r\n		 ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\r\n		 ng-style="vRangeStyle">\r\n		<div class="range">\r\n			<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : activeOptions.y.cover}"></div>\r\n		</div>\r\n		<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : activeOptions.y.near}">\r\n		</div>\r\n		<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : activeOptions.y.far}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\r\n            <qva-range-selection-bubble tid="range-vertical-near-bubble" visible="visible" active-component="vComponent" handle-points="vHandlePoints" horizontal="false" far="false" data="vValues.start" active="activeOptions.y.far"> </qva-range-selection-bubble>\r\n            <qva-range-selection-bubble tid="range-vertical-far-bubble" visible="visible" active-component="vComponent" handle-points="vHandlePoints" horizontal="false" far="true" data="vValues.end" active="activeOptions.y.near"> </qva-range-selection-bubble>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-show="horizontal" class="range-horizontal"\r\n		 ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\r\n		 ng-style="hRangeStyle">\r\n	    <div class="range">\r\n			<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : activeOptions.x.cover}"></div>\r\n	    </div>\r\n\r\n	    <div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : activeOptions.x.far}">\r\n	    </div>\r\n		<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : activeOptions.x.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\r\n            <qva-range-selection-bubble tid="range-horizontal-near-bubble" visible="visible" active-component="hComponent" handle-points="hHandlePoints" horizontal="true" far="false" data="hValues.start" active="activeOptions.x.near"> </qva-range-selection-bubble>\r\n            <qva-range-selection-bubble tid="range-horizontal-far-bubble" visible="visible" active-component="hComponent" handle-points="hHandlePoints" horizontal="true" far="true" data="hValues.end" active="activeOptions.x.far"> </qva-range-selection-bubble>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!objects.views/selections/types/range/range-bubble.ng.html",[],function(){return'<div class="bubble-wrapper" ng-class="{\'far\' : far, \'near\' : !far}">\r\n	<div ng-show="!editing" class="bubble range-bubble" ng-class="{\'active\' : active}">{{data.text}}</div>\r\n	<input ng-show="editing" type="text" ng-class="{\'active\' : active, \'invalid\': invalid}" class="bubble range-input"/>\r\n</div>'}),define("objects.views/selections/types/range/range-bubble-directive",["jquery","touche","qvangular","text!./range-bubble.ng.html"],function($,Touche,qvangular,template){function onStart($scope){$scope.$emit("rangeStart")}function onEditingChanged($scope,editing){$scope.editing=editing,$scope.$emit("rangeEditChanged",editing)}function onUpdate($scope,points,dir,valueInfo){$scope.$emit("rangeUpdate",points,dir,valueInfo)}function onEnd($scope,points){$scope.$emit("rangeEnd",points)}function onEditInputResize(){$(this).css("width",6*$(this).val().length+50+"px")}var namespace=".rangeselection";qvangular.directive("qvaRangeSelectionBubble",["$timeout",function($timeout){return{template:template,replace:!0,restrict:"E",scope:{data:"=",active:"=",far:"=",horizontal:"=",activeComponent:"=",handlePoints:"=",visible:"="},link:function($scope,$element){var $editInput=$element.find(".range-input"),$rangeBubble=$element.find(".range-bubble"),initialPoints={};$scope.$watch("activeComponent",function(){$scope.editable=$scope.activeComponent&&!$scope.activeComponent.isDiscrete()&&"function"==typeof $scope.activeComponent.getPositionOfValue,$scope.editable?($editInput.removeClass("non-editable"),$rangeBubble.removeClass("non-editable")):($editInput.addClass("non-editable"),$rangeBubble.addClass("non-editable"))}),$scope.endEditing=function(){$scope.invalid=!1,$scope.editing&&(onEditingChanged($scope,!1),$editInput.blur())},$scope.$watch("data.value",function(newValue){return isNaN(newValue)?void(this.invalid=!0):($scope.editing&&$scope.endEditing(),void $editInput.val(newValue))}),$scope.$watch("visible",function(){$scope.visible||$scope.endEditing()}),$scope.$on("off",function(){$scope.endEditing(),Touche($editInput[0]).off("*",namespace),
Touche($rangeBubble[0]).off("*",namespace),$element.off("keyup"+namespace,"*")}),$scope.onEditBubble=function(){$scope.editing=!0,$editInput.css("width",$rangeBubble.width()),$scope.$digest(),$editInput.focus(),$editInput[0].setSelectionRange(0,9999),$scope.$digest(),$timeout(function(){onEditInputResize.call($editInput)})},$scope.$on("on",function(){Touche($editInput[0]).tap({id:namespace,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),Touche($rangeBubble[0]).tap({id:namespace,start:function(){Touche.preventGestures(this.gestureHandler)},end:function(){$scope.editable&&!$scope.editing&&(onEditingChanged($scope,!0),$scope.onEditBubble())}}).swipe({id:namespace,start:function(){$.extend(!0,initialPoints,$scope.handlePoints),Touche.preventGestures(this.gestureHandler),onStart($scope)},update:function(e,data){var delta,dir,otherHandlePoint,newHandlePoint,index=$scope.far?1:0;$scope.horizontal?(delta=data.swipe.deltaX,dir="x"):(delta=data.swipe.deltaY,dir="y"),otherHandlePoint=initialPoints[1^index][dir],newHandlePoint=initialPoints[index][dir]+delta,0===index&&($scope.horizontal&&newHandlePoint>otherHandlePoint||!$scope.horizontal&&otherHandlePoint>newHandlePoint)?(index=1,otherHandlePoint=initialPoints[1][dir]):1===index&&($scope.horizontal&&otherHandlePoint>newHandlePoint||!$scope.horizontal&&newHandlePoint>otherHandlePoint)&&(index=0,otherHandlePoint=initialPoints[0][dir]),$scope.handlePoints[index][dir]=newHandlePoint,$scope.handlePoints[1^index][dir]=otherHandlePoint,$scope.$digest(),onUpdate($scope,$scope.handlePoints,dir)},end:function(){onEnd($scope,$scope.handlePoints)}}),$editInput.keyup(onEditInputResize),$scope.onEditConfirmed=function(){if($scope.editing){var tempPoint,dir,numberString=$editInput.val(),valueInfo={value:parseFloat(numberString),index:$scope.far?1:0,"switch":!1},coord=$scope.activeComponent.getPositionOfValue(valueInfo.value),handlePoints=$scope.handlePoints;isNaN(valueInfo.value)?$scope.invalid=!0:(dir=$scope.horizontal?"x":"y",handlePoints[valueInfo.index][dir]=coord,($scope.horizontal&&handlePoints[1][dir]<handlePoints[0][dir]||!$scope.horizontal&&handlePoints[1][dir]>handlePoints[0][dir])&&(tempPoint=handlePoints[1][dir],handlePoints[1][dir]=handlePoints[0][dir],handlePoints[0][dir]=tempPoint,valueInfo.index=valueInfo.index?0:1,valueInfo["switch"]=!0),$scope.endEditing(),onUpdate($scope,$scope.handlePoints,dir,valueInfo),onEnd($scope,$scope.handlePoints)),$scope.$digest()}},$scope.$on("confirmEdit",$scope.onEditConfirmed)})}}}])}),define("objects.views/selections/types/range/range-directive",["touche","qvangular","objects.utils/shapes/point","text!./range-template.ng.html","./range-bubble-directive"],function(Touche,qvangular,Point,template){function updatePoints(initials,target,orientation,distance){var arr=[];return"y"===orientation?arr[target]=new Point(initials[target].x,initials[target].y+distance):arr[target]=new Point(initials[target].x+distance,initials[target].y),arr[1^target]=initials[1^target],arr}function onStart($scope){$scope.$emit("rangeStart")}function onUpdate($scope,points,dir){$scope.$emit("rangeUpdate",points,dir)}function onEnd($scope,points){$scope.$emit("rangeEnd",points)}function getTargetPoint(points,grt,dir){return grt?points[0][dir]>points[1][dir]?0:1:points[0][dir]<points[1][dir]?0:1}function attachEdgeEvent($scope,targetElement,isHorizontal,grt){var initialPoints,targetPoint,id,scopePointsName=isHorizontal?"hHandlePoints":"vHandlePoints",direction=isHorizontal?"x":"y";Touche(targetElement).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{radiusThreshold:0},start:function(){targetPoint=getTargetPoint($scope[scopePointsName],grt,direction),initialPoints=$scope[scopePointsName],Touche.preventGestures(this.gestureHandler),onStart($scope)},update:function(e,data){$scope[scopePointsName]=updatePoints(initialPoints,targetPoint,direction,isHorizontal?data.swipe.deltaX:data.swipe.deltaY),$scope.$digest(),$scope.activeOptions[direction].near=$scope.activeOptions[direction].far=!1,id=getTargetPoint($scope[scopePointsName],grt,direction)^!isHorizontal?"far":"near",$scope.activeOptions[direction][id]=!0,onUpdate($scope,$scope[scopePointsName],direction)},end:function(){onEnd($scope,$scope[scopePointsName]),$scope.activeOptions[direction].near=$scope.activeOptions[direction].far=!1}})}function on($scope){if(!isOn){isOn=!0;var initialPoints="hey";Touche(vertAxisCover).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{preventDefault:!0},start:function(){initialPoints=$scope.vHandlePoints,Touche.preventGestures(this.gestureHandler),onStart($scope),$scope.activeOptions.y.cover=!0},update:function(e,data){$scope.vHandlePoints=[{x:initialPoints[0].x,y:initialPoints[0].y+data.swipe.deltaY},{x:initialPoints[1].x,y:initialPoints[1].y+data.swipe.deltaY}],$scope.$digest(),onUpdate($scope,$scope.vHandlePoints,"y")},end:function(){onEnd($scope,$scope.vHandlePoints),$scope.activeOptions.y.cover=!1}}),Touche(horiAxisCover).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{preventDefault:!0},start:function(){initialPoints=$scope.hHandlePoints,Touche.preventGestures(this.gestureHandler),onStart($scope),$scope.activeOptions.x.cover=!0},update:function(e,data){$scope.hHandlePoints=[{x:initialPoints[0].x+data.swipe.deltaX,y:initialPoints[0].y},{x:initialPoints[1].x+data.swipe.deltaX,y:initialPoints[1].y}],$scope.$digest(),onUpdate($scope,$scope.hHandlePoints,"x")},end:function(){onEnd($scope,$scope.hHandlePoints),$scope.activeOptions.x.cover=!1}}),Touche.utils.touch||(attachEdgeEvent($scope,vertFarEdge,!1,!1,"far"),attachEdgeEvent($scope,vertNearEdge,!1,!0,"near"),attachEdgeEvent($scope,horiFarEdge,!0,!0,"far"),attachEdgeEvent($scope,horiNearEdge,!0,!1,"near"))}}function off(){Touche(vertAxisCover).off("*",namespace),Touche(horiAxisCover).off("*",namespace),Touche(vertFarEdge).off("*",namespace),Touche(vertNearEdge).off("*",namespace),Touche(horiFarEdge).off("*",namespace),Touche(horiNearEdge).off("*",namespace),isOn=!1}var vertAxisCover,horiAxisCover,vertFarEdge,vertNearEdge,horiFarEdge,horiNearEdge,namespace=".rangeselection",isOn=!1;qvangular.directive("qvaRangeSelection",function(){return{template:template,replace:!0,scope:{vertical:"=",horizontal:"=",vOptions:"=",hOptions:"=",vHandlePoints:"=",hHandlePoints:"=",vValues:"=",hValues:"=",activeComponent:"=",hComponent:"=",vComponent:"=",visible:"="},link:function($scope,$element){$scope.vRangeStyle={},$scope.hRangeStyle={},$scope.vRelevantSize=0,$scope.hRelevantSize=0,$scope.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},$scope.setRangeStyle=function(dir,points,options){if(!points||2!==points.length||!options)return{};var start=points[0],end=points[1];"y"===dir?$scope.vRangeStyle={height:Math.abs(start[dir]-end[dir]),top:Math.min(start[dir],end[dir])+options.offset}:$scope.hRangeStyle={width:Math.abs(start[dir]-end[dir]),left:Math.min(start[dir],end[dir])+options.offset}},$scope.$watchCollection("[vHandlePoints, vOptions]",function(newValues){$scope.setRangeStyle("y",newValues[0],newValues[1])}),$scope.$watchCollection("[hHandlePoints, hOptions]",function(newValues){$scope.setRangeStyle("x",newValues[0],newValues[1])}),$scope.$watch("hOptions",function(newValue){newValue&&$scope.setRelevantSize("x",newValue.rect.height)}),$scope.$watch("vOptions",function(newValue){newValue&&$scope.setRelevantSize("y",newValue.rect.width)}),$scope.setRelevantSize=function(dir,size){"x"===dir?($scope.hRelevantSize={height:size+"px"},$scope.hWrappperSize={height:"calc(100% - "+size+"px)"}):($scope.vRelevantSize={width:size+"px"},$scope.vWrappperSize={width:"calc(100% - "+size+"px)"})},vertAxisCover=$element.find(".range-vertical .axis-cover")[0],horiAxisCover=$element.find(".range-horizontal .axis-cover")[0],vertFarEdge=$element.find(".range-vertical .far-edge")[0],vertNearEdge=$element.find(".range-vertical .near-edge")[0],horiFarEdge=$element.find(".range-horizontal .far-edge")[0],horiNearEdge=$element.find(".range-horizontal .near-edge")[0],on.call(this,$scope),$scope.$on("on",function(){on.call(this,$scope)}),$scope.$on("off",function(){off.call(this)}),$scope.$on("$destroy",function(){off.call(this)})}}})}),define("objects.views/selections/types/range/range-angular",["jquery","qvangular","./../base","objects.utils/shapes/point","objects.utils/shapes/rect","./range-directive"],function($,qvangular,Base,Point,Rect){"use strict";function getLabelFromItem(item){if(item.isCacheItem){var dims=item.getDimensions();return dims[dims.length-1]}return item.parent&&item.parent.data&&item.parent.data.qText?item.parent.data.qText:item.label}function updateRangeObject(start,current,range,valueInfo){var shapes,first,last,outerRect=this.activeComponent.rect,rect=this.getRect(this.activeComponent),dataAreaRect=this.components.dataArea[0].rect,updateRangeFn=function(p1,p2,dir){if(valueInfo){if(valueInfo["switch"]){var temp=range.startVal;range.startVal=range.updateVal,range.updateVal=temp}0===valueInfo.index&&"horizontal"===dir||1===valueInfo.index&&"vertical"===dir?range.startVal=valueInfo.value:range.updateVal=valueInfo.value}else range.startVal=this.activeComponent.getValueOfPosition(p1),range.updateVal=this.activeComponent.getValueOfPosition(p2)},dx=start.x-current.x,dy=start.y-current.y,rdy=rect.y-outerRect.y,rdx=rect.x-outerRect.x,len=0,x1=0,y1=0,x2=0,y2=0;switch(this.activeComponent.dock){case"top":case"bottom":len=0>=dx?rect.width-start.x:start.x,0>dx&&(len+=rdx),current.x<rdx&&(dx-=rdx-current.x),x1=min(rect.width+rdx,max(rdx,min(start.x,current.x))),x2=max(x1,min(rdx+rect.width,max(start.x,current.x))),y1=0,y2=dataAreaRect.height,range.rect.set(x1,y1,x2-x1,y2-y1),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(range.rect,"x","dataArea"),shapes.length?(first=shapes[0],last=shapes[shapes.length-1],range.startVal=getLabelFromItem(first),range.updateVal=getLabelFromItem(last)):(range.startVal="-",range.updateVal="-")):updateRangeFn.call(this,x1,x2,"horizontal");break;case"left":case"right":len=0>=dy?rect.height-start.y:start.y,0>dy&&(len+=rdy),current.y<rdy&&(dy-=rdy-current.y),x1=0,x2=dataAreaRect.width,y1=min(rect.height+rdy,max(rdy,min(start.y,current.y))),y2=max(y1,min(rdy+rect.height,max(start.y,current.y))),range.rect.set(x1,y1,x2-x1,y2-y1),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(range.rect,"y","dataArea"),shapes.length?(first=shapes[0],last=shapes[shapes.length-1],range.startVal=getLabelFromItem(first),range.updateVal=getLabelFromItem(last)):(range.startVal="-",range.updateVal="-")):updateRangeFn.call(this,y1,y2,"vertical")}}function canCombineRanges(){return this.components.x&&this.components.y&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function clearCtx(){$scope.y=!1,$scope.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(watcher){watcher()}),this._rangeEventWatchers=null),$uiContainer.hide(),$scope.rangeSelectIsVisible=!1,rangeObjects={x:[],y:[]}}function getRangeObject(direction,index){direction||(direction="x"),index||(index=0);var rangeObject=rangeObjects[direction][index];return rangeObject||(rangeObject={rect:new Rect(0,0,0,0),startVal:0,endVal:0},rangeObjects[direction][index]=rangeObject),rangeObject}function updateSelection(direction,cb,toggleFlag){var intersectionRect,shapes=[],shapesToDeselect=this._previousShapes?this._previousShapes.slice():[],rangeObject=getRangeObject(direction),orthogonalRange=rangeObjects["y"===direction?"x":"y"];this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(rangeObject.rect,direction,"dataArea"),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){var idx=shapesToDeselect.indexOf(s);idx>=0&&shapesToDeselect.splice(idx,1),s.selectionMode="range.dimension"}),this.checkActiveMode(["range.dimension","item"],!0),cb.call(this,shapes,toggleFlag),this._clearPrev&&cb.call(this,shapesToDeselect,this.ToggleFlag.deselect),this._shapes=shapes):(canCombineRanges.call(this)?(intersectionRect=orthogonalRange.length?rangeObject.rect.intersection(orthogonalRange[0].rect):rangeObject.rect,shapes=this.shapesFromRect(intersectionRect,"dataArea"),this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].updateRangeSelection(intersectionRect)):shapes=this.shapesFromRange(rangeObject.startVal,rangeObject.updateVal),shapes.forEach(function(s){s.selectionMode="range.measure"}),this.checkActiveMode(["range.measure"],!0),cb.call(this,shapes,toggleFlag),this._shapes=shapes)}function swipeUpdate(currentPoint,valueInfo){var start,end,direction=this.getComponentKey(this.activeComponent),rangeObject=getRangeObject(direction),point=currentPoint,toggleFlag=this.ToggleFlag.select,cb=this.toggleSelection;updateRangeObject.call(this,startPoint,point,rangeObject,valueInfo),start=new Point(rangeObject.rect.x,rangeObject.rect.y),end=new Point(rangeObject.rect.x+rangeObject.rect.width,rangeObject.rect.y+rangeObject.rect.height),"y"===direction?($scope.vHandlePoints=[end,start],$scope.vValues={start:{text:this.activeComponent.getFormatter().format(rangeObject.updateVal),value:rangeObject.updateVal},end:{text:this.activeComponent.getFormatter().format(rangeObject.startVal),value:rangeObject.startVal}}):($scope.hHandlePoints=[start,end],$scope.hValues={start:{text:this.activeComponent.getFormatter().format(rangeObject.startVal),value:rangeObject.startVal},end:{text:this.activeComponent.getFormatter().format(rangeObject.updateVal),value:rangeObject.updateVal}}),$scope.$digest(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this._shapes&&cb.call(this,this._shapes,this.ToggleFlag.deselect):this.clearSelection(!0),updateSelection.call(this,direction,cb,toggleFlag)}var Range,$scope,startPoint,compiled=!1,min=Math.min,max=Math.max,$uiContainer=$("<div />"),uiContainer=$uiContainer[0],$rangeElement=$('<div qva-range-selection visible="rangeSelectIsVisible" active-component="activeComponent" v-component="vComponent" h-component="hComponent" v-handle-points="vHandlePoints" h-handle-points="hHandlePoints" horizontal="x" vertical="y" h-options="hOptions" v-options="vOptions" h-values="hValues" v-values="vValues"/>'),rangeObjects={x:[],y:[]};return Range=Base.extend("RangeSelection",{init:function(handler,options){this._super(handler,options),this._shapes=null,this._nrEditing=0,this.setActiveMode("item")},initComponent:function(point){this.previousComponent=this.activeComponent,this.activeComponent=this.getComponent(point.x,point.y),$scope.activeComponent=this.activeComponent,-1!==this.components.x.indexOf($scope.activeComponent)?$scope.hComponent=$scope.activeComponent:-1!==this.components.y.indexOf($scope.activeComponent)&&($scope.vComponent=$scope.activeComponent)},refreshContainer:function(){var offset,dataAreaRect=this.components.dataArea[0].rect,dataAreaOffset=$(this.components.dataArea[0].container).position(),rect=new Rect(dataAreaOffset.left,dataAreaOffset.top,dataAreaRect.width,dataAreaRect.height),components=[];["x","y"].forEach(function(direction){this.components[direction]&&!this.components[direction].contains(this.activeComponent)&&(components=components.concat(this.components[direction]))}.bind(this)),this.activeComponent&&components.push(this.activeComponent),components.forEach(function(c){c.isVisible()&&(offset=$(c.container).position(),rect=rect.combineWith(new Rect(offset.left,offset.top,c.rect.width,c.rect.height)))},this),this._offset={left:dataAreaOffset.left-rect.x,top:dataAreaOffset.top-rect.y},$uiContainer.css({left:rect.x,top:rect.y,width:rect.width,height:rect.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getIsEditing:function(){return this._editing},confirmEdit:function(){$scope.$broadcast("confirmEdit")},getRect:function(component,outer){return component?(outer=outer||!1,component.hasOwnProperty("innerRect")&&!outer?component.innerRect:component.rect):new Rect(0,0,0,0)},getExtendedRect:function(component){return component?component.hasOwnProperty("extendedRect")?component.extendedRect:this.getRect(component):new Rect(0,0,0,0)},getTransformedPoint:function(pageX,pageY){var rect=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new Point(pageX-rect.x-this.handler.containerRect.x,pageY-rect.y-this.handler.containerRect.y)},getComponent:function(pageX,pageY){var point=new Point(pageX-this.handler.containerRect.x,pageY-this.handler.containerRect.y);return Object.keys(this.components).map(function(key){return this.components[key]},this).reduce(function(a,b){return a.concat(b)}).filter(function(component){return this.getExtendedRect(component).pointInside(point.x,point.y)},this)[0]},checkActiveMode:function(modes,onlySelection){modes.contains(this.handler.getActiveMode())||this.clearSelection(onlySelection),this.setActiveMode(modes[0])},toggleRect:function(e,p1,p2){this.start(e,p1),this.update(e,p2),this.end(e)},toggle:function(e,currentPoint,toggle){if(toggle=void 0!==toggle?toggle:this.handler.getKeyAsToggleSelected(e),toggle||this.clearSelection(),this.resetSelectedShapes(),this.cancel(),!this.activeComponent||!this.activeComponent.isDiscrete())return!1;var point=this.getTransformedPoint(currentPoint.x,currentPoint.y),shapes=this.shapesFromPoints([point]),cb=this.options.toggle.callback||this.toggleSelection,toggleFlag=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(c){c.selectionMode="dataArea"}),this.checkActiveMode(["item"]),cb.call(this,shapes,toggleFlag),shapes&&shapes.length>0},start:function(e,currentPoint){if(this.handler._disableSelections)return!0;var direction,dir,rect,rangeObject,offset;if(this.resetSelectedShapes(),this.refreshContainer(),this.activeComponent.isDiscrete?this.checkActiveMode(["range.dimension","item"],!0):this.checkActiveMode(["range.measure"]),direction=this.getComponentKey(this.previousComponent),dir=this.getComponentKey(this.activeComponent),direction&&direction!==dir&&this.previousComponent&&this.previousComponent!==this.activeComponent&&!canCombineRanges.call(this)&&direction in this.components&&($scope[direction]=!1,rangeObject=getRangeObject(direction),rangeObject.rect.set(0,0,0,0)),!this._rangeEventWatchers){var self=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push($scope.$on("rangeStart",function(){self.resetSelectedShapes(),self._shapes=self._previousShapes,self._clearPrev=!0})),this._rangeEventWatchers.push($scope.$on("rangeUpdate",function(ev,handlePoints,updateDir,valueInfo){startPoint=handlePoints[0],self.components[updateDir].indexOf(self.activeComponent)<0&&(self.activeComponent=self.components[updateDir][0]),swipeUpdate.call(self,handlePoints[1],valueInfo),self._clearPrev=!1})),this._rangeEventWatchers.push($scope.$on("rangeEditChanged",function(ev,editing){self._nrEditing=editing?self._nrEditing+1:self._nrEditing-1,self._nrEditing>1&&(self.confirmEdit(),self._nrEditing=1,ev.targetScope.onEditBubble()),self._editing=self._nrEditing>0})),this._rangeEventWatchers.push($scope.$on("rangeEnd",function(){self.end(),self._clearPrev=!1}))}startPoint=this.getTransformedPoint(currentPoint.x,currentPoint.y),$scope[dir]=!0,rect=this.getRect(this.activeComponent),offset=0,"y"===dir?(offset=this._offset.top,$scope.vOptions={rect:rect.clone(),offset:offset,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},$scope.vHandlePoints=[startPoint,startPoint]):(offset=this._offset.left,$scope.hOptions={rect:rect.clone(),offset:offset,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},$scope.hHandlePoints=[startPoint,startPoint]),this.handler.container.append($uiContainer),$uiContainer.show(),$scope.rangeSelectIsVisible=!0},update:function(e,currentPoint){return this.handler._disableSelections?!0:void swipeUpdate.call(this,this.getTransformedPoint(currentPoint.x,currentPoint.y))},updateShapesState:function(){var direction=this.getComponentKey(this.activeComponent),range=getRangeObject(direction),toggleFlag=this.ToggleFlag.select,shapes=[],cb=this.toggleSelection;this.clearSelection(!0),this.setActiveMode("range.measure"),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(shapes=this.shapesFromRange(range.startVal,range.updateVal),shapes.forEach(function(s){s.selectionMode="range.measure"}),cb.call(this,shapes,toggleFlag)),this._shapes=shapes},end:function(e){return this.handler._disableSelections?!0:(this.selectRange(e),this._previousShapes=this._shapes,void(this._shapes=null))},cancel:function(){return this.handler._disableSelections?!0:("range.dimension"===this.getActiveMode()&&this.setActiveMode("item"),this._shapes=null,void clearCtx.call(this))},clearSelection:function(onlySelection){onlySelection=onlySelection||!1,this._shapes=null,onlySelection?this._super():(this._super(),clearCtx.call(this))},selectRange:function(){var range,SelectRange=this.handler.SelectRange,direction=this.getComponentKey(this.activeComponent),params=[],orMode=!1;if(this.activeComponent){if("dimension"===this.activeComponent.getType().type){var prev=this._previousSelectedShapes,current=this.getSelectedShapes().concat();return prev.forEach(function(item){var idx=current.indexOf(item);-1===idx&&current.push(item)}),void(current.length>0&&this.handler.Select.emit(current))}if(canCombineRanges.call(this))Object.keys(rangeObjects).filter(function(key){return rangeObjects[key][0]&&void 0!==rangeObjects[key][0].startVal&&void 0!==rangeObjects[key][0].updateVal}).forEach(function(key){var measure=this.components[key][0].getType().current[0];range=rangeObjects[key][0],params.push({measure:measure,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}})},this);else{if(range=rangeObjects[direction][0],!range)return;this.activeComponent.getType().current.forEach(function(measureIndex){params.push({measure:measureIndex,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}})}),orMode=!0}params.length&&(this._editing||SelectRange.emit(params,orMode))}},on:function(){if(!compiled){var $compile=qvangular.getService("$compile"),$rootScope=qvangular.getService("$rootScope");$scope=$rootScope.$new(),uiContainer.className="selections-range-ui",$uiContainer.append($rangeElement),$uiContainer.hide(),$compile(uiContainer)($scope),compiled=!0,$scope.rangeSelectIsVisible=!1}$scope.$broadcast("on")},off:function(){this.activeComponent&&($scope.$broadcast("off"),this.activeComponent=null)}}),Range.defaultOptions={toggle:{callback:null}},Range}),define("objects.views/selections/types/dom-base",["./base","objects.utils/shapes/rect"],function(Base,Rect){"use strict";function combineRangeObjects(rObj1,rObj2){var i,o1,o2=rObj2[0],found=!1;for(i=0;i<rObj1.length;i++)o1=rObj1[i],o1.startVal===o2.startVal&&o1.updateVal===o2.updateVal&&(rObj1.splice(i,1),i--,found=!0);return found||(rObj1=rObj1.concat(rObj2)),rObj1}var DomBase;return DomBase=Base.extend({init:function(handler,options){this._super(handler,options),this.internal=!0},release:function(){},initComponent:function(point){this.activeComponent=this.getComponent(point.x,point.y)},getRect:function(component){return component?component.hasOwnProperty("innerRect")?component.innerRect:component.rect:new Rect(0,0,0,0)},setComponent:function(key,component){this._super(key,component),component.selections=this},addComponent:function(key,component){this._super(key,component),component.selections=this},removeComponent:function(key,component){this._super(key,component),component.selections=null,component.off()},updateFromItems:function(e,items){var handler=this.handler,self=this;if(handler._isLocked)return void handler.SelectWhileLocked.emit();if(this.setActiveMode("item"),handler.activate(this),items=items.filter(function(it){return self._allowNullSelect||!self._isNull(it,self.activeComponent.getSelectionIndices())}),items.length){var cb=this.options.toggle.callback||this.toggleSelection;cb.call(this,items),handler.Select.emit(this.getSelectedShapes(),handler.getKeyAsToggleSelected(e))}},rangeStart:function(){var handler=this.handler;return handler._isLocked?void handler.SelectWhileLocked.emit():(this.setActiveMode("range.measure"),handler.activate(this),void this.resetSelectedShapes())},rangeUpdate:function(rangeObjects,combine){var handler=this.handler;if(handler._isLocked)return void handler.SelectWhileLocked.emit();var i,cb=this.options.toggle.callback||this.toggleSelection,shapes=[],toggleFlag=this.ToggleFlag.select;for(this.clearSelection(!0),this._rangeObjects&&combine&&(rangeObjects=combineRangeObjects(this._rangeObjects,rangeObjects)),i=0;i<rangeObjects.length;i++){var ro=rangeObjects[i];shapes=shapes.concat(this.shapesFromRange(ro.startVal,ro.updateVal,!0,ro.isMax))}shapes.forEach(function(s){s.selectionMode="range.measure"}),cb.call(this,shapes,toggleFlag),this._rangeObjects=rangeObjects,this._shapes=shapes},rangeEnd:function(){this.selectRange(),this._shapes=null},toggle:function(){},cancel:function(){this._rangeObjects=null,this.activeComponent.cancelSelection()},clearSelection:function(onlySelection){this._super(),onlySelection||this.activeComponent.clearSelection()},selectRange:function(){var i,range,SelectRange=this.handler.SelectRange,params=[];if(this._rangeObjects){for(i=0;i<this._rangeObjects.length;i++)range=this._rangeObjects[i],params.push({measure:0,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}});SelectRange.emit(params,!0)}}}),DomBase.defaultOptions={},DomBase}),define("objects.views/selections/types/color-legend",["./dom-base"],function(DomBase){"use strict";var ColorLegend;return ColorLegend=DomBase.extend({setIsEditing:function(editing,scope){this._editing=editing,this._scope=scope},getIsEditing:function(){return this._editing},confirmEdit:function(){this._scope.$broadcast("confirmEdit")}}),ColorLegend.defaultOptions={captureInput:!0,toggle:{callback:null}},ColorLegend}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div ng-switch on="template">\r\n	<div ng-switch-when="generic" class="qv-tooltip qvt-generic-tooltip">\r\n		<div ng-repeat="item in content">\r\n			<div class="header">\r\n				<strong>{{item.header}}</strong>\r\n			</div>\r\n			<table>\r\n				<tr ng-repeat="row in item.rows" class="row">\r\n					<td class=\'item\'>\r\n						<div class="rowContent fade-out">{{row.content}}</div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-switch-default class="qv-tooltip qvt-chart-tooltip" qva-press="hideTooltip($event)" tid="qv-chart-tooltip">\r\n		<div class="immidiate-contextual-arrow"></div>\r\n		<div class="qv-chart-tooltip-inner">\r\n			<div ng-repeat="item in content">\r\n				<div class="qv-chart-tooltip-content">\r\n					<div class=\'header\'>\r\n						<strong>{{item.header}}</strong>\r\n					</div>\r\n					<table>\r\n						<tr ng-repeat="row in item.rows" class="row">\r\n							<td class=\'item\'>\r\n								<div class="rowPart">{{row.label + \':&nbsp;\'}}</div>\r\n							</td>\r\n							<td class=\'value\'>\r\n								<div class="rowPart">{{row.value}}</div>\r\n							</td>\r\n						</tr>\r\n					</table>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}"></div>\r\n	</div>\r\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["jquery","touche","qvangular","general.utils/arrow-positioner","general.utils/window-positioner","core.utils/resize","text!./chart-tooltip.ng.html"],function($,Touche,qvangular,ArrowPositioner,WindowPositioner,resize,template){var innerPadding=5,windowPadding=5,totalArrowPadding=25;qvangular.directive("qvaChartTooltip",function(){return{template:template,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"=",numberInExcess:"=",target:"=",hideCallback:"="},link:function($scope,$element){var toggle,timeoutId,invalidPos=!1;toggle=function(visible){var display=visible?"block":"none";$element.css("display",display)},$scope.synchronAlign=function(){var result,$activeTemplateElement=$element.find(".qv-tooltip"),$arrowElement=$element.find(".immidiate-contextual-arrow");toggle($scope.visible);var dir=$scope.direction instanceof Array?$scope.direction:[$scope.direction];result=WindowPositioner.alignToBestCoordinate($activeTemplateElement,$scope.position,dir,$scope.target,!1,innerPadding,windowPadding);var offset=$activeTemplateElement.offset(),win=$(window),windowWidth=win.outerWidth(),windowHeight=win.outerHeight();switch(result.position){case"right":offset.left+=9,result.y=Math.min(windowHeight-totalArrowPadding,Math.max(totalArrowPadding,result.y));break;case"left":offset.left-=9,result.y=Math.min(windowHeight-totalArrowPadding,Math.max(totalArrowPadding,result.y));break;case"bottom":offset.top+=9,result.x=Math.min(windowWidth-totalArrowPadding,Math.max(totalArrowPadding,result.x));break;default:offset.top-=9,result.x=Math.min(windowWidth-totalArrowPadding,Math.max(totalArrowPadding,result.x))}$activeTemplateElement.offset(offset),$arrowElement.removeClass().addClass("immidiate-contextual-arrow").addClass(result.position),ArrowPositioner.alignToCoordinate($activeTemplateElement,result.x,result.y,result.position,$arrowElement),invalidPos=!1},$scope.align=function(){timeoutId=qvangular.getService("$timeout")($scope.synchronAlign)},$scope.$watch("position",function(value){value&&(value instanceof Array||value.x&&value.y)&&(invalidPos=!0,$scope.align())}),$scope.$watch("visible",function(value){invalidPos||toggle(value)}),$scope.$watch("content",function(value){value||($scope.visible=!1)}),$scope.hideTooltip=function(event){$scope.visible=!1,$scope.hideCallback&&$scope.hideCallback(),event&&event.stopPropagation&&(event.stopPropagation(),event.preventDefault(),Touche.preventGestures())},$scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(timeoutId),resize.off("end",$scope.hideTooltip)}),resize.on("end",$scope.hideTooltip)}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){var component;return component={transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template" number-in-excess="numberInExcess" target="target" hide-callback="hideCallback"></div>',controller:["$scope",function($scope){$scope.visible=!1,this.hide=function(){$scope.visible=!1},this.show=function(input){$scope.content=input.content,$scope.position=input.position,$scope.direction=input.direction,$scope.template=input.template,$scope.numberInExcess=input.numberInExcess,$scope.visible=!0,$scope.hideCallback=input.hideCallback,$scope.target=input.target}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(qvangular,Notification,component){"use strict";qvangular.service("qvChartTooltipService",["$document",function($document){var service,ctrl,$body=$document.find("body"),$container=angular.element("<div>").appendTo($body);return service={open:function(input){if(!ctrl){var pos=input.position;input.position=void 0,ctrl=$container.showComponent(component,input),input.position=pos}ctrl.show(input)},close:function(){this.Closed.emit(),ctrl&&ctrl.hide()}},Notification.create(service,"Closed"),service}])}),define("objects.views/selections/types/tooltip",["jquery","./base","qvangular","general.utils/support","objects.utils/shapes/rect","objects.views/charts/tooltip/chart-tooltip-service"],function($,Base,qvangular,Support,Rect){
"use strict";function shapeIsNaN(shape){var rect=shape.getBoundingRect();return isNaN(rect.x+rect.y+rect.width+rect.height)}function getTooltipHeader(item){return item.getDimensions().join(", ")}function getPositionsAndDirectionsFromRect(rect,transformFunc,component){return{positions:[transformFunc(rect.x+rect.width/2,rect.y,component),transformFunc(rect.x+rect.width,rect.y+rect.height/2,component),transformFunc(rect.x,rect.y+rect.height/2,component),transformFunc(rect.x+rect.width/2,rect.y+rect.height,component)],directions:["top","right","left","bottom"]}}function showTooltip(items,currentPoint){var pagePoint,localPoint,boundingBox,shapes,content,target,direction,directionPositions,closest=[],component=null,item=items[0];if(this._positionAtMouse)pagePoint=currentPoint||item.interactPosition,localPoint=this.getTransformedPoint(pagePoint.x,pagePoint.y),shapes=item.getShapes(),closest=shapes.filter(function(s){return s.pointInside(localPoint.x,localPoint.y)}),target=closest.length?closest[0]:shapes[0],direction=["top","right","left","bottom"],directionPositions=[pagePoint,pagePoint,pagePoint,pagePoint];else if(item.calculateTooltipPosition&&item.tooltipShape)boundingBox=item.getShapeBounds(item.tooltipShapeComponent),boundingBox&&(component=this.components[item.tooltipShapeComponent]?this.components[item.tooltipShapeComponent][0]:void 0,posAndDir=getPositionsAndDirectionsFromRect(boundingBox,this.getPagePoint.bind(this),component),directionPositions=posAndDir.positions,direction=posAndDir.directions);else{shapes=item.getShapes(),item.tooltipShape&&!shapeIsNaN(item.tooltipShape)?(closest=[item.tooltipShape],component=this.components[item.tooltipShapeComponent]?this.components[item.tooltipShapeComponent][0]:void 0):currentPoint&&(localPoint=this.getTransformedPoint(currentPoint.x,currentPoint.y),closest=shapes.filter(function(s){return s.pointInside(localPoint.x,localPoint.y)})),target=closest.length?closest[0]:shapes[0];var posAndDir;target.getRelevantPosition?(boundingBox=target.getRelevantPosition(),boundingBox.pos&&(pagePoint=this.getPagePoint(boundingBox.pos.x,boundingBox.pos.y,component),directionPositions=[pagePoint,pagePoint,pagePoint,pagePoint]),direction=boundingBox.direction):(boundingBox=target.getBoundingRect(),posAndDir=getPositionsAndDirectionsFromRect(boundingBox,this.getPagePoint.bind(this),component),directionPositions=posAndDir.positions,direction=posAndDir.directions)}content=[];for(var numRows=0,index=0,numberInExcess=0,targetToPageTranslation=this.getPagePoint(0,0,component);MAX_ROWS>numRows&&index<items.length;)content.push({header:getTooltipHeader(items[index]),rows:buildTooltipContent.apply(this,[items[index],target])}),numRows+=content[index].rows.length+1,index++;items.length>index&&(numberInExcess=items.length-index),(pagePoint||directionPositions)&&(qvangular.getService("qvChartTooltipService").open({target:{shape:target,targetToPageTranslation:targetToPageTranslation},position:directionPositions||[pagePoint],content:content,direction:direction,numberInExcess:numberInExcess,hideCallback:onTooltipInternalHide.bind(this)}),currentItem=item,currentItemsIdString=items.map(function(it){return it.id}).join(""))}function buildTooltipContent(item,target){var row,l,value,label,measures,measureIndecies,rows=[],i=0,formatters=this.measureFormatters||[];if(item.isCacheItem)for(measures=item.getMeasures(),measureIndecies=item.getMeasuresIndecies(target),l=measureIndecies.length,i;l>i;++i){var mI=measureIndecies[i];value=item.getValue(mI),label=item.getPreformattedLabel(mI),formatters[measureIndecies[i]]&&(value="U"!==formatters[mI].type&&label?label:formatters[mI].format(value)),measures[mI]&&void 0!==value&&rows.push({label:measures[mI],value:value})}else for(l=item.node.children.length,i;l>i;++i)value=item.node.children[i].children[0].data.qNum||item.node.children[i].children[0].data.qValue,label=item.node.children[i].children[0].data.qText,formatters[i]&&(value="U"!==formatters[i].type&&label?label:formatters[i].format(value)),rows.push({label:item.node.children[i].data.qText,value:value});return this.colorMap&&(row=this.colorMap.getTooltipContent(item.getCombinedElementID?item.getCombinedElementID():item.id),row&&rows.push(row)),rows}function getShapes(currentPoint){var point=this.getTransformedPoint(currentPoint.x,currentPoint.y);return this.shapesFromPoints([point])}function getShapesIds(currentPoint){var shapes=getShapes.call(this,currentPoint);return shapes.map(function(it){return it.id}).join("")}function setupTimeOut(currentPoint){var self=this;this.activeComponent=this.getComponent(currentPoint.x,currentPoint.y),this.tooltipComponentId=tooltipComponentId=this.activeComponent.id;var items=getShapes.call(self,currentPoint);clearHideTimeout(),items&&items.length&&(self._positionAtMouse="MapArea"===self.activeComponent.className,timeOut=qvangular.getService("$timeout")(function(){setupHideTimout(),showTooltip.call(self,items,currentPoint),timeOut=null},500))}function setupTouchTimeout(shapes,timeoutMS){var self=this;this.tooltipComponentId=tooltipComponentId=this.activeComponent.id,timeOut=qvangular.getService("$timeout")(function(){shapes&&shapes.length&&(self._positionAtMouse="MapArea"===self.activeComponent.className,showTooltip.call(self,shapes)),timeOut=null},timeoutMS)}function setupHideTimout(){hideTimeOut=qvangular.getService("$timeout")(function(){hideTooltip()},7e3)}function clearHideTimeout(){qvangular.getService("$timeout").cancel(hideTimeOut),hideTimeOut=null}function clearShowTimeout(){this.tooltipComponentId===tooltipComponentId&&(qvangular.getService("$timeout").cancel(timeOut),timeOut=null,this.prevPoint=null)}function onTooltipInternalHide(){currentItem&&(currentItem=null,currentItemsIdString=null),timeOut=null,clearHideTimeout()}function hideTooltip(){currentItem&&(currentItem=null,currentItemsIdString=null,qvangular.getService("$timeout")(function(){qvangular.getService("qvChartTooltipService").close()})),timeOut=null,clearHideTimeout()}function pointInsideShapes(p,shapes){var i,childShape,n=shapes?shapes.length:0;for(i=0;n>i;i++)if(childShape=shapes[i],childShape&&childShape.pointInside&&childShape.pointInside(p.x,p.y))return!0;return!1}function findShapesOfInteraction(shapes){var i,childShapes,p,numShapes=shapes?shapes.length:0,interactedShapes=[];for(i=0;numShapes>i;i++)childShapes=shapes[i]._shapes,p||(p=shapes[i]._interactPosition,p&&(p=this.getTransformedPoint(p.x,p.y))),p&&pointInsideShapes(p,childShapes)&&(interactedShapes[interactedShapes.length]=shapes[i]);return interactedShapes.length||interactedShapes.push(shapes),interactedShapes}var Tooltip,timeOut,hideTimeOut,currentItem,currentItemsIdString,tooltipComponentId,touchOn=!0,MAX_ROWS=7;return Tooltip=Base.extend("ChartTooltip",{init:function(handler,options){this._super(handler,options),currentItem=null,this._positionAtMouse=!1,timeOut=null,this.name="tooltip",touchOn=!Support.treatAsDesktop(),touchOn&&handler.ToggleTooltip.bind(this.updateHighlightedShape.bind(this)),this.enabled=!0,this._allowNullSelect=!0,this.touchTimeout=options.touchTimeout},initComponent:function(point){this.activeComponent=this.getComponent(point.x,point.y)},updateHighlightedShape:function(shapes,disableSelections){if(shapes.length>=1){var interactedShapes,hide=!0,show=!1;if(interactedShapes=findShapesOfInteraction.call(this,shapes),!interactedShapes||!interactedShapes.length)return;touchOn&&(interactedShapes=interactedShapes.filter(function(shape){return disableSelections?!0:shape.selected}),interactedShapes&&interactedShapes.length&&(currentItem||timeOut?(interactedShapes.length>1||interactedShapes[0]!==currentItem)&&(hide=show=!0):(hide=!1,show=!0)),hide&&(clearShowTimeout.call(this),clearHideTimeout(),hideTooltip.call(this)),show&&setupTouchTimeout.call(this,interactedShapes,this.touchTimeout))}else touchOn&&disableSelections&&(clearShowTimeout.call(this),clearHideTimeout(),hideTooltip.call(this))},getRect:function(component){return component?component.hasOwnProperty("innerRect")?component.innerRect:component.rect:new Rect(0,0,0,0)},move:function(e,currentPoint){!touchOn&&this.enabled&&(null!==timeOut?(!this.prevPoint||currentPoint.distanceTo(this.prevPoint)>5)&&(clearShowTimeout.call(this),setupTimeOut.call(this,currentPoint)):(this.prevPoint=currentPoint,currentItem?getShapesIds.call(this,currentPoint)!==currentItemsIdString?(hideTooltip.call(this),setupTimeOut.call(this,currentPoint)):(clearHideTimeout(),setupHideTimout()):setupTimeOut.call(this,currentPoint)))},leave:function(e){var newTarget=e.toElement||e.relatedTarget;$(newTarget).hasClass("qvt-chart-tooltip")||$(newTarget).parents(".qvt-chart-tooltip").length||(clearShowTimeout.call(this),hideTooltip.call(this))},cancel:function(){clearShowTimeout.call(this),hideTooltip.call(this)},clearSelection:function(){clearShowTimeout.call(this),hideTooltip.call(this)}}),Tooltip.defaultOptions={},Tooltip}),define("objects.views/selections/handler",["jquery","core.utils/notification","client.utils/state","core.utils/class","./types/data-area","./types/range/range-angular","./types/color-legend","./types/tooltip","objects.utils/shapes/rect","objects.utils/shapes/point","general.utils/support"],function($,Notification,state,Class,DataArea,Range,ColorLegend,Tooltip,Rect,Point,Support){function createTypes(options){Object.keys(options).forEach(function(key){key in validTypes&&(this.types[key]=new validTypes[key](this,$.extend(!0,{},validTypes[key].defaultOptions,options[key])))},this)}function checkDimensionsOverlap(arr1,arr2){var i;for(i=0;i<arr2.length;i++)if(arr1.contains(arr2[i]))return!0;for(i=0;i<arr1.length;i++)if(arr2.contains(arr1[i]))return!0;return!1}var Selections,startPoint,$document=$(document),expando=0,getNS=function(){return".selections-"+ ++expando},validTypes={dataArea:DataArea,range:Range,colorLegend:ColorLegend,tooltip:Tooltip};return Selections=Class.extend({init:function(container,options,cache){Notification.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("ToggleTooltip"),this.notification("SelectWhileLocked"),this.notification("Pan"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("Clear"),this.notification("ResetSelections"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this.container=container,this.options=$.extend(!0,{},{getSelectionType:function(currentPoint,usingMove){var containerRect=this.containerRect,useMove=usingMove||!1,point=new Point(currentPoint.x-containerRect.x,currentPoint.y-containerRect.y);return Object.keys(this.types).map(function(key){return this.types[key]},this).filter(function(type){return Object.keys(type.components).map(function(key){return type.components[key]}).filter(function(components){return components.filter(function(component){var rect=type.getExtendedRect?type.getExtendedRect(component):type.getRect(component);return rect===containerRect&&(point.x+=containerRect.x,point.y+=containerRect.y),useMove?"tooltip"===type.name&&("function"==typeof component.isVisible?component.isVisible():!0)&&rect.pointInside(point.x,point.y):"tooltip"!==type.name?("function"==typeof component.isVisible?component.isVisible():!0)&&rect.pointInside(point.x,point.y):void 0}).length>0})[0]},this)[0]},toggle:!0,toggleRect:!0,swipe:!0,autoSwipe:!1,ctrlKeyAsToggleSelected:!1},options),this.cache=cache,this.containerRect=new Rect(0,0,0,0),this.eventNS=getNS(),this.types={},this._keyboard=!0,createTypes.call(this,this.options)},setContainer:function($element){this.off(),this.container=$element,this.on()},refreshContainerRect:function(){var offset=this.offset=this.container.offset(),width=this.container.width(),height=this.container.height();this.containerRect.set(offset.left,offset.top,width,height)},on:function(){function init(point){startPoint=point,handler.refreshContainerRect(),type=opts.getSelectionType.call(handler,point),type&&type.initComponent(point),tooltipType=opts.getSelectionType.call(handler,point,!0),tooltipType&&tooltipType.initComponent(point)}function activateType(){if(handler._activeType&&handler._activeType!==type){var currentActiveDimensions=handler._activeType.getActiveDimensions();handler._activeType.cancel(),handler._activeType.getActiveMode()===type.getActiveMode()&&checkDimensionsOverlap(currentActiveDimensions,type.getActiveDimensions())||(handler._activeType.clearSelection(),handler.ResetSelections.emit())}handler._activeType=type,handler._tooltipType=tooltipType=handler.types.tooltip}function activate(){activateType(),opts._disableSelectionActivation||handler.activate()}function canBeActivated(){return(state.state===state.States.analysis||state.state===state.States.play)&&!handler._isScrolling}function isActive(){return handler._active&&!state.isInEditMode()}function isMultiSelect(){return type&&opts.swipe&&canBeActivated()}function isMouse(e){return Support.isMouse(e)}if(!this._isListening){this._isListening=!0;var type,tooltipType,handler=this,opts=this.options;this._reset=function(){type=null,tooltipType=null},this.getActiveType=function(){return handler._activeType},this.getActiveTooltip=function(){return handler._tooltipType},this.getActiveMode=function(){return handler._activeType?handler._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){type=handler.types.dataArea},this._activateType=function(t){type=t,activateType()},$document.off(handler.eventNS),$document.on("mouseup"+handler.eventNS,function(e){1===e.which&&!handler._shiftPressed&&handler._drawingLassoWithShift&&handler.Lasso.emit(!1)}),$document.on("keydown"+handler.eventNS,function(e){handler._keyboard&&16===e.which&&(!handler._shiftPressed&&handler._active&&handler.Lasso.emit(!handler._lassoEnabled),handler._shiftPressed=!0)}),$document.on("keyup"+handler.eventNS,function(e){handler._keyboard&&(16===e.which&&(handler._shiftPressed&&handler._active&&!handler._drawingLassoWithShift&&handler.Lasso.emit(handler._lassoEnabled),handler._shiftPressed=!1),isActive()&&(27===e.which?handler.cancel():13===e.which&&(type&&type.getIsEditing&&type.getIsEditing()?type.confirmEdit():handler.confirm())))}),this._onMouseMove=function(e){var p=new Point(e.pageX,e.pageY),oldTooltipType=tooltipType;handler.refreshContainerRect(),tooltipType=opts.getSelectionType.call(handler,p,!0),oldTooltipType&&oldTooltipType!==tooltipType&&oldTooltipType.cancel(),tooltipType&&(tooltipType.move.call(tooltipType,e,p),handler._tooltipType=tooltipType)},this._onMouseLeave=function(e){tooltipType&&tooltipType.leave(e)},this.types.tooltip&&Support.treatAsDesktop()&&(this.container.on("mousemove",this._onMouseMove),this.container.on("mouseleave",this._onMouseLeave),$document.on("mouseleave"+handler.eventNS,this._onMouseLeave)),this.types.range&&this.types.range.on&&this.types.range.on();var swipeActive=!1;Touche(this.container[0]).tap({id:this.eventNS,options:{preventDefault:opts.swipe},start:function(e,data){canBeActivated()&&(opts.autoSwipe&&isMouse(e)&&(opts.swipe=!0),init(data.pagePoints[0]))},end:function(e,data){if(canBeActivated()&&type&&!type.internal&&opts.toggle){if(handler._isLocked)return void handler.SelectWhileLocked.emit();activate(),Touche.preventGestures(this.gestureHandler),type.toggle.call(type,e,data.pagePoints[0]),"range"===type.getActiveMode()?type.selectRange():type.getSelectedShapes().length>0&&handler.Select.emit(type.getSelectedShapes(),handler.getKeyAsToggleSelected(e))}}}).tap({id:this.eventNS,options:{touches:2,preventDefault:opts.swipe},end:function(e,data){if(canBeActivated()&&opts.toggleRect&&(init(data.pagePoints[0]),type&&opts.toggle)){if(handler._isLocked)return void handler.SelectWhileLocked.emit();activate(),type.toggleRect.call(type,e,data.pagePoints[0],data.pagePoints[1])}}}).swipe({id:this.eventNS,options:{preventDefault:opts.swipe,useMomentum:!0,inertia:.5,radiusThreshold:6},start:function(e,data){if((isMultiSelect()||opts._enablePanning)&&(this.options.useMomentum=!0,tooltipType&&tooltipType.cancel(),handler._shiftPressed&&!handler._active&&handler.Lasso.emit(!handler._lassoEnabled),type)){if(!handler._lassoEnabled&&type.activeComponent&&"dataArea"===type.activeComponent.selectionIdentifier)return handler.Pan.emit("start",e,data),void(this._isPanning=!0);if(handler._lassoEnabled||!type.activeComponent||"colorLegend"!==type.activeComponent.selectionIdentifier)return swipeActive=!0,handler._isLocked?void handler.SelectWhileLocked.emit():(activate(),handler._drawingLassoWithShift=handler._shiftPressed,this.options.useMomentum=!1,type.start.call(type,e,startPoint),void 0)}},update:function(e,data){if(isMultiSelect()||opts._enablePanning)if(this._isPanning)handler.Pan.emit("update",e,data);else if(swipeActive&&type){if(handler._isLocked)return void handler.SelectWhileLocked.emit();type.update.call(type,e,data.pagePoints[0])}},end:function(e,data){if(isMultiSelect()||opts._enablePanning)if(this._isPanning)handler.Pan.emit("end",e,data),this._isPanning=!1;else if(swipeActive&&type){if(swipeActive=!1,handler._isLocked)return void handler.SelectWhileLocked.emit();handler._drawingLassoWithShift=!1,type.end.call(type,e,data)}},cancel:function(){type&&swipeActive&&(type.cancel.call(type,!0),tooltipType&&tooltipType.cancel.call(tooltipType,!0))}})}},off:function(){this.container.off(this.eventNS),this.container.off("mousemove",this._onMouseMove),this.container.off("mouseleave",this._onMouseLeave),Touche(this.container[0]).off("*",this.eventNS),$document.off(this.eventNS),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(type){this._active||(this.Activated.emit(),this._active=!0),type&&this._activateType(type)},deactivate:function(confirm){this._active&&(this._active=!1,this._autoActivated=!1,confirm||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this._tooltipType&&(this._tooltipType.cancel(),this._tooltipType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection(),this.types.tooltip&&this.types.tooltip.cancel()},toggleKeyboardAccelerators:function(keyboard){this._keyboard=keyboard},getKeyAsToggleSelected:function(e){return!(e.metaKey||e.ctrlKey)},release:function(){this.off(),Notification.release(this),Object.keys(this.types).forEach(function(key){this.types[key].release()},this)},toggleScrolling:function(scrolling){scrolling=scrolling||!1,this._isScrolling=scrolling},setLocked:function(lock){this._isLocked=lock},setLassoEnabled:function(enabled){this._lassoEnabled=enabled}})}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(CacheItem,CacheItemBase){"use strict";function Cache(){this.data=[]}return Object.defineProperties(Cache.prototype,{has:{value:function(o){return-1!==this.data.indexOf(o)}},add:{value:function(o){if(!(o instanceof CacheItem||o instanceof CacheItemBase))throw"Invalid cache item!";this.has(o)||this.data.push(o)}},remove:{value:function(o){var index=this.data.indexOf(o);-1!==index&&this.data.splice(index,1)}},clear:{value:function(){this.data.length=0}}}),Cache}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler","objects.views/selections/cache"],function(qvangular,Selections,SelectionsCache){"use strict";qvangular.service("qvDefaultViewSelectionService",[function(){return{createSelections:function($scope,$element,selectionsOpts){var selections,selectionsDeactivatedFn;if(selectionsOpts&&selectionsOpts.dataArea)return selectionsOpts.isPopover=$scope.options.isPopover,selectionsOpts.selectionsDisabled=$scope.options.selectionsDisabled||!1,selections=new Selections($element,selectionsOpts,new SelectionsCache),selections.Activated.bind(function(){$scope.selectionsApi.activated()}),selections.Deactivated.bind(function(){$scope.selectionsApi.deactivateSearch&&$scope.selectionsApi.deactivateSearch()}),selections.Cancel.bind(function(){$scope.selectionsApi.cancel()}),selections.Select.bind(function(){$scope.selectionsApi.selectionsMade=!0}),selections.SelectRange.bind(function(){$scope.selectionsApi.selectionsMade=!0}),selections.Confirm.bind(function(){$scope.backendApi.endSelections(!0),$scope.selectionsApi.deactivated()}),selections.ResetSelections.bind(function(){$scope.backendApi.clearSelections()}),$scope.selectionsApi.confirm=function(){selections&&selections.confirm()},selectionsDeactivatedFn=$scope.selectionsApi.deactivated.bind($scope.selectionsApi),$scope.selectionsApi.deactivated=function(){selections&&selections.deactivate(),selectionsDeactivatedFn()},$scope.selectionsApi.deactivate=function(){selections&&(selections.deactivate(),this.deactivated())},$scope.selectionsApi.clear=function(){selections.clearSelection(),$scope.backendApi.clearSelections(),$scope.selectionsApi.selectionsMade=!0},$scope.selectionsApi.toggleKeyboardAccelerators=function(keyboard){selections.toggleKeyboardAccelerators(keyboard)},$scope.selectionsApi.getKeyAsToggleSelected=function(e){return selections.getKeyAsToggleSelected(e)},$scope.selectionsApi.toggleSearch=function(){$scope.options.search.toggle()},$scope.selectionsApi.activate=function(){selections.autoActivate()},$scope.selectionsApi.on=function(){selections.on()},$scope.selectionsApi.off=function(){selections.off()},$scope.$on("$destroy",function(){selections&&(selections.release(),selections=null)}),selections}}}])}),define("objects.extension/controller",["objects.extension/base-controller","util","core.utils/deferred","objects.extension/default-view-selection-service"],function(BaseController,util,Deferred){"use strict";var Controller;return Controller=BaseController.extend({$scope:null,$element:null,api:null,view:null,create:function($scope,$element,View,viewOptions,selectionOptions,backendApi){var view=this.createView($scope,$element,View,viewOptions,backendApi),selOpts=util.extend(!0,{},selectionOptions,viewOptions.selections||{});return this.createSelections(view,$scope,$element,selOpts),view},createView:function($scope,$element,View,options,backendApi){return new View($scope,$element,options,backendApi)},createSelections:function(view,$scope,$element,options){var selections=this.selectionService.createSelections($scope,$element,options);return view.setSelections(selections),selections},init:function($scope,$element,selectionService){this.$scope=$scope,this.$element=$element,this.selectionService=selectionService;var self=this,view=this.view=this.create($scope,$element,$scope.ext.View,$scope.options,$scope.ext.options.selections,$scope.backendApi);view.initialize(),this.handleSpecialCaseForSyntaxSugarInExtension(view),$scope.$on("$destroy",function(){view&&(view.destroy(view),self.$scope.options=null,self.view=null,view=null)})},handleSpecialCaseForSyntaxSugarInExtension:function(view){var key,extension=this.$scope.object.ext;for(key in extension)"View"!==key&&"constructor"!==key&&"options"!==key&&view[key]&&(view[key]=extension[key])},onPaint:function(visible){var updateDataPromise,self=this;return this.view?this.view.suppressOnPaint(this.$scope.layout)?Deferred.resolve():(this.view.refreshSelections(),visible?(this.view.prePaint(this.$scope.layout),updateDataPromise=this.view.updateData(this.$scope.layout),updateDataPromise&&updateDataPromise.then?updateDataPromise.then(function(){return self.view.paint(self.view.$element,self.$scope.layout)}):self.view.paint(self.view.$element,self.$scope.layout)):(updateDataPromise=this.view.updateData(this.$scope.layout),updateDataPromise&&updateDataPromise.then?this.view.updateData(this.$scope.layout):Deferred.resolve())):Deferred.resolve()},onResize:function(){return this.view.refreshSelections(),this.view.resize(this.view.$element,this.$scope.layout)},onStateChanged:function(state){this.view.allowInteraction(state)?this.view.on():this.view.off(),this.view.onStateChanged(state)},setBackendApi:function(backendApi){this.view.setBackendApi(backendApi)},setSnapshotData:function(snapshotLayout,options){return this.view.setSnapshotData(snapshotLayout,options)},getContextMenu:function(object,menu){return this.view.getContextMenu(object,menu)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},allowInteraction:function(state){return this.view.allowInteraction(state)},setInteraction:function(on){this.view.setInteraction(on)},getViewState:function(){return this.view.getViewState()}}),Controller.$inject=["$scope","$element","qvDefaultViewSelectionService"],Controller}),define("objects.extension/qv-extension",["qvangular","objects.extension/controller"],function(qvangular,controller){"use strict";qvangular.directive("qvExtension",function(){return{require:["qvExtension","^qvObject"],controller:controller,link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}})}),define("objects.extension/extension-type",["jquery","core.utils/class","general.utils/property-mapper","objects.extension/default-extension","util","qvangular","core.utils/deferred","objects.models/visualization-object","objects.extension/default-view","require","objects/inline-title-edit","objects.extension/qv-extension"],function($,Class,PropertyMapper,defaultExtension,util,qvangular,Deferred,VisualizationObject,DefaultView,require){function fillInDefault(extType,ext){var _ext=util.extend(!0,{},defaultExtension,ext);return _ext.libraryInfo=extType.getLibraryInfo(),_ext}function loadExtension(extType){var defer,path=extType.path;return _extensions[path]||(defer=Deferred(),require([path],function(xt){qvangular.$rootScope.$apply(function(){defer.resolve(fillInDefault(extType,xt))})},function(err){defer.reject(err)}),_extensions[path]=defer.promise),_extensions[path]}function isObject(o){return"[object Object]"===Object.prototype.toString.call(o)}function getDefaultTypeTranslationKey(type){var translationKey="";switch(type.toLowerCase()){case"listbox":translationKey="Object.Listbox";break;case"barchart":translationKey="Object.BarChart";break;case"combochart":translationKey="Object.ComboChart";break;case"filterpane":translationKey="Object.FilterPane";break;case"gauge":translationKey="Object.Gauge";break;case"kpi":translationKey="Object.Kpi";break;case"linechart":translationKey="Object.LineChart";break;case"piechart":translationKey="Object.PieChart";break;case"pivot-table":translationKey="Object.PivotTable";break;case"scatterplot":translationKey="Object.ScatterPlot";break;case"table":translationKey="Object.Table";break;case"treemap":translationKey="Object.Treemap";break;case"text-image":translationKey="Object.TextImage";break;case"sheet":translationKey="Common.Sheet";break;case"objectlibrary":translationKey="Object.ObjectLibrary";break;case"libraryobject":translationKey="Object.LibraryObject";break;case"map":translationKey="Object.Map";break;default:translationKey=""}return translationKey}function getIconName(value){switch(value.toLowerCase()){case"barchart":return"bar-chart-vertical";case"linechart":return"line-chart";case"table":return"table";case"pivot-table":return"pivot-table";case"components":return"components";case"piechart":return"pie-chart";case"filterpane":return"filterpane";case"listbox":return"list";case"gauge":return"gauge-chart";case"kpi":return"kpi";case"scatterplot":return"scatter-chart";case"text-image":return"text-image";case"treemap":return"treemap";case"map":return"map";case"combochart":return"combo-chart";default:return"extension"}}function getDefaultTemplateIconClassName(value){return"icon-"+getIconName(value)}function getTemplateIconFromIcon(icon){if(!icon)return"icon-extension";switch(icon.toLowerCase()){case"bar-chart-vertical":return"icon-bar-chart-vertical";case"line-chart":return"icon-line-chart";case"table":return"icon-table";case"pivot-table":return"icon-pivot-table";case"components":return"icon-components";case"pie-chart":return"icon-pie-chart";case"filterpane":return"icon-filterpane";case"list":return"icon-list";case"gauge-chart":return"icon-gauge-chart";case"kpi":return"icon-kpi";case"scatter-chart":return"icon-scatter-chart";case"text-image":return"icon-text-image";case"text":return"icon-titletext";case"map":return"icon-map";case"combo-chart":return"icon-combo-chart";default:return"icon-extension"}}function getDefaultLibraryInfo(type){var isLibraryItem=0!==type.indexOf("listbox");return{name:type,descriptionKey:"Template.preview.description."+type,translationKey:getDefaultTypeTranslationKey(type),template:type,templateIconClassName:getDefaultTemplateIconClassName(type),icon:getIconName(type),author:"Qlik",isThirdParty:!1,isLibraryItem:isLibraryItem}}var ExtensionType,_extensions={};qvangular.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="});var FONTMAP={"bar-chart-vertical":"!","line-chart":"%","pie-chart":"&",list:"-",table:"'","pivot-table":"(",filterpane:".","scatter-chart":"+","text-image":"/","gauge-chart":")",kpi:"1",treemap:"»",map:",","combo-chart":"‚","":"E"};return ExtensionType=Class.extend("ExtensionType",{init:function(options){this.type=options.type,this.path=options.path,this.libraryInfo=options.libraryInfo||getDefaultLibraryInfo(options.type),this.components=options.components||[],this.libraryInfo.templateIconClassName||(this.libraryInfo.templateIconClassName=getTemplateIconFromIcon(this.libraryInfo.icon))},getLibraryInfo:function(){return this.libraryInfo},getTemplateIconClassName:function(){return this.libraryInfo.templateIconClassName},getIconChar:function(){return FONTMAP[this.libraryInfo.icon]?FONTMAP[this.libraryInfo.icon]:"g"},getModelCtor:function(){return loadExtension(this).then(function(ext){return ext.Model})},getInitialProperties:function(init){var that=this;return loadExtension(that).then(function(ext){var initProps=util.extend(!0,{qInfo:{qType:that.type},visualization:that.type},ext.initialProperties,init);return ext.libraryInfo.version&&!initProps.version&&(initProps.version=ext.libraryInfo.version),PropertyMapper.mapProperties(ext.definition,initProps,that.type)})["catch"](function(){return{qInfo:{qType:that.type},visualization:that.type}})},load:function(){return loadExtension(this).then(function(extension){var key;if(extension.View)for(key in DefaultView)DefaultView.hasOwnProperty(key);return isObject(extension.view)&&(extension.View=DefaultView.extend(extension.view)),void 0===extension.View&&(extension.View=DefaultView),util.extend(!0,{},extension)})},getExtensionType:function(){return loadExtension(this)}}),ExtensionType.addObject=function(element,id,app){var dfd=new Deferred;return require(["objects/object"],function(){var $element=$(element);$element.html('<qv-object model="model" options="options"></qv-object>');var $scope=qvangular.$rootScope.$new(),vis=VisualizationObject.get(id,app);vis.then(function(model){$scope.model=model,$scope.options={};var $compile=qvangular.getService("$compile");$compile($element.contents())($scope),qvangular.$apply($scope),dfd.resolve(vis)},function(error){dfd.reject(error)})}),dfd.promise},ExtensionType}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","general.models/library/extension-list"],function(Deferred,visualizations,ExtensionType,ExtensionsListModel){function createLibraryInfo(name,data){return data=data||{},data.previewIconURL||data.preview&&data.preview.indexOf(".png")>0&&(data.previewIconURL="../extensions/"+name+"/"+data.preview),data.icon=data.icon||"extension",data.description=data.description||data.name,
data.template=data.template||name,data.isLibraryItem=data.isLibraryItem===!1?!1:!0,data.isThirdParty=!0,data.name=data.name||data.template||name,data}function registerExtension(ext){ext.data&&"visualization"===ext.data.type&&visualizations.registerType(ext.id,new ExtensionType({type:ext.id,path:"extensions/"+ext.id+"/"+ext.id,libraryInfo:createLibraryInfo(ext.id,ext.data)}))}function load(skipThirdParty){return null===deferred&&(deferred=new Deferred,visualizations.registerType("listbox",new ExtensionType({type:"listbox",path:"extensions.qliktech/listbox/listbox"})),visualizations.registerType("filterpane",new ExtensionType({type:"filterpane",path:"extensions.qliktech/filterpane/filterpane",components:["extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data","extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting"]})),visualizations.registerType("gauge",new ExtensionType({type:"gauge",path:"extensions.qliktech/gauge/gauge"})),visualizations.registerType("kpi",new ExtensionType({type:"kpi",path:"extensions.qliktech/kpi/kpi"})),visualizations.registerType("table",new ExtensionType({type:"table",path:"extensions.qliktech/straight-table/straight-table",components:["extensions.qliktech/straight-table/properties/columns/columns"]})),visualizations.registerType("pivot-table",new ExtensionType({type:"pivot-table",path:"extensions.qliktech/pivot-table/pivot-table",components:["extensions.qliktech/pivot-table/properties/pivot-data/pivot-data","extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting"]})),visualizations.registerType("barchart",new ExtensionType({type:"barchart",path:"extensions.qliktech/barchart/barchart"})),visualizations.registerType("piechart",new ExtensionType({type:"piechart",path:"extensions.qliktech/piechart/piechart"})),visualizations.registerType("scatterplot",new ExtensionType({type:"scatterplot",path:"extensions.qliktech/scatterplot/scatterplot"})),visualizations.registerType("linechart",new ExtensionType({type:"linechart",path:"extensions.qliktech/linechart/linechart"})),visualizations.registerType("combochart",new ExtensionType({type:"combochart",path:"extensions.qliktech/combochart/combochart"})),visualizations.registerType("treemap",new ExtensionType({type:"treemap",path:"extensions.qliktech/treemap/treemap"})),visualizations.registerType("map",new ExtensionType({type:"map",path:"extensions.qliktech/map/map",components:["extensions.qliktech/map/properties/layers"]})),visualizations.registerType("text-image",new ExtensionType({type:"text-image",path:"extensions.qliktech/text-image/text-image"})),visualizations.registerType("widget",new ExtensionType({type:"widget",path:"extensions.qliktech/widget/widget",libraryInfo:createLibraryInfo("widget",{name:"Widget",description:"Qlik Sense Widget",isLibraryItem:!1})})),skipThirdParty?deferred.resolve():ExtensionsListModel.getList().then(function(extensionList){extensionList.forEach(function(ext){registerExtension(ext)}),deferred.resolve()})),deferred.promise}var deferred=null;return{load:load,registerExtension:registerExtension}}),define("text!objects/object.ng.html",[],function(){return'<div class="qv-object-wrapper">\r\n	<article class="qv-object qvt-visualization" ng-class="classList" qva-activate="takeSnapshot($event)" tid="{{objectClass}}">\r\n\r\n		<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\r\n\r\n		<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\r\n			<ul class="cancelled-list">\r\n				<li>\r\n					<div class="retry-text" q-translation="Object.Cancelled"></div>\r\n				</li>\r\n				<li>\r\n					<button class="retry-button qui-outlinebutton" qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n		<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\r\n			<button class="cancel-button qui-outlinebutton" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\r\n					q-translation="Common.Cancel" tid="cancel-calculations"></button>\r\n		</div>\r\n\r\n		<button ng-if="showSnapshotCount" class="snapshotcounter qui-iconbt" qva-activate="openSnapshotLibrary($event, \'snapshot\')">\r\n			<i class="icon-snapshot"></i><span>{{snapshotCount}}</span>\r\n		</button>\r\n\r\n		<header class="qv-object-header" ng-show="object.hasFrame && object.showTitles">\r\n			<h1 ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();">\r\n				<a ng-if="!editmode && options.showSearch && !object.isReadonly" q-title-translation="Common.Search" class="qv-object-search icon-magnifying-glass"\r\n					qva-activate="options.showSearch && options.search.toggle()"></a>\r\n				<span ng-if="!editmode || editmode && object.isReadonly" qve-highlight text="{{layout.title}}" query="options.highlightQuery"></span>\r\n				<span ng-if="options.showDisclaimerStar && !!layout.title && !editmode" class="disclaimer">*</span>\r\n				<div ng-if="editmode && !object.isReadonly" qv-inline-title-edit x-model="model" x-property-path="title" x-layout-path="title"\r\n					 x-empty-translation="Object.AddTitle"></div>\r\n			</h1>\r\n\r\n			<h2 ng-attr-title="{{layout.subtitle}}" ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\r\n		</header>\r\n\r\n		<div class="qv-object-content-container">\r\n			<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\r\n				 ext="object.ext" selections-api="object.selectionsApi" throbber-api="object.throbberApi">\r\n			</div>\r\n		</div>\r\n\r\n		<footer ng-attr-title="{{layout.footnote}}" ng-show="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\r\n	</article>\r\n\r\n	<qv-soft-property-panel object="object" ng-if="options.isZoomed && object.hasSoftProperties" can-save-soft-properties="options.canSaveSoftProperties" ng-hide="!object.showExploreMenu"></qv-soft-property-panel>\r\n\r\n	<div ng-if="navMenu.active" class="qv-object-nav" ng-class="{\'zero-top\' : options.isZoomed, \'visible\': navMenu.visible}">\r\n		<a ng-repeat="menuItem in navMenu.items"\r\n		   ng-if="menuItem.isVisible()"\r\n		   ng-class="[menuItem.cssClasses, menuItem.dynamicCssClasses()]"\r\n		   qva-activate="menuItem.action()"\r\n		   q-title-translation="{{menuItem.translation}}"\r\n		   tid="{{menuItem.tid}}"></a>\r\n	</div>\r\n</div>\r\n'}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\r\n	<div class="requirements">\r\n		<h2 class="header">\r\n			<i class="object-icon" ng-class="iconClass"></i>\r\n		</h2>\r\n	<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\r\n		<!-- finished dimensions -->\r\n	<ul ng-if="showAdd && finishedDimensions.length">\r\n		<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\r\n			tid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\r\n			<span class="text" title="{{dimension.title}}">{{dimension.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished dimensions -->\r\n	<ul ng-if="showAdd && unfinishedDimensions.length">\r\n		<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': d.active }" qva-activate="showAddDimension($event,d)"\r\n					q-translation="Visualization.Requirements.AddDimension" tid="add-dimension"></button>\r\n			</li>\r\n		</ul>\r\n		<!-- finished measures -->\r\n	<ul ng-if="showAdd && finishedMeasures.length">\r\n		<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\r\n			tid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\r\n			<span class="text" title="{{measure.title}}">{{measure.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished measures -->\r\n	<ul ng-if="showAdd && unfinishedMeasures.length">\r\n		<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': m.active }" qva-activate="showAddMeasure($event,m)"\r\n					q-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(engineEnums,translator){"use strict";function getTranslationKey(errorCode){return"ErrorCode."+errorCode}var errorCodes=engineEnums.NxLocalizedErrorCode;return{getDimensionError:function(errorCode){var key;return key=errorCode===errorCodes.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidDimension":errorCode===errorCodes.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingDimension":getTranslationKey(errorCode),translator.get(key)},getMeasureError:function(errorCode){var key;return key=errorCode===errorCodes.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidMeasure":errorCode===errorCodes.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingMeasure":getTranslationKey(errorCode),translator.get(key)},getHyperCubeError:function(errorCode){var key=getTranslationKey(errorCode);return translator.get(key)},getListObjectError:function(errorCode){var key=getTranslationKey(errorCode);return translator.get(key)}}}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<object-add-typeahead>\r\n		<div class="object-add-popover-header">\r\n			<div class="qui-inputwithicon">\r\n				<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n					   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\r\n				<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n				   pp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"></i>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content" object-add-typeahead-menu>\r\n			<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="dimension in dimensions" tid="dimension-item"\r\n					object-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\r\n					<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n					object-add-typeahead-item="field" on-select="addFieldDimension(field)">\r\n					<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n					<span qve-highlight text="{{field.label}}" title="{{field.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n		</div>\r\n	</object-add-typeahead>\r\n</immidiate-contextual>'}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(Deferred,StringNormalization,arrayUtil,support,libraryUtils,template,directDiscoveryService){"use strict";function filter(data,term){return""===term?data:data.filter(function(entity){return"undefined"==typeof entity.value?!1:StringNormalization.string(entity.value.toLowerCase()).indexOf(StringNormalization.string(term.toLowerCase()))>-1})}var ITEM_LIMIT=100,component={template:template,controller:["$scope",function($scope){$scope.search={term:""},$scope.isDirectDiscoveryField=directDiscoveryService.isDirectDiscoveryField,$scope.getDirectDiscoveryTypeTranslationKey=directDiscoveryService.getTypeTranslationKey,$scope.autoFocus=support.treatAsDesktop(),$scope.position||($scope.position="right"),$scope.onEscape=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.search.term=""):$scope.closeAddPopover()},$scope.onEnter=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.addFieldDimension({value:$scope.search.term})):$scope.closeAddPopover()};var cache=null;$scope.$watch("search.term",function(term){function setItems(){var fields=filter(cache.fields,term),dimensions=filter(cache.dimensions,term);dimensions.length>ITEM_LIMIT?(dimensions=arrayUtil.limit(dimensions,ITEM_LIMIT),fields=[]):fields.length+dimensions.length>ITEM_LIMIT&&(fields=arrayUtil.limit(fields,ITEM_LIMIT-dimensions.length)),$scope.fields=fields,$scope.dimensions=dimensions}cache?setItems():Deferred.all({fields:libraryUtils.getSortedFields(),dimensions:libraryUtils.getSortedDimensions()}).then(function(args){var fields=args.fields.map(function(field){return{label:field.qName,value:field.qName,qTags:field.qTags}}),dimensions=args.dimensions.map(function(dimension){return{label:dimension.qData.title,value:dimension.qData.title,libraryId:dimension.qInfo.qId}});cache={fields:fields,dimensions:dimensions},setItems()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return component}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\r\n						   maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\r\n					<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n					   pp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"></i>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="measures.length" q-translation="Common.Measures"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="measure in measures" tid="measure-item"\r\n						object-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\r\n						<span qve-highlight text="{{measure.value}}" title="{{measure.value}}" query="search.term" class="qui-list-text"></span>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="showFromField(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<span qve-highlight text="{{field.value}}" title="{{field.value}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\r\n					<span class="qui-list-text" title="{{suggestion.aggregation}}({{suggestion.field}})">{{suggestion.aggregation}}({{suggestion.field}})</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(Deferred,StringNormalization,util,arrayUtil,support,libraryUtils,template,directDiscoveryService){"use strict";function filter(data,term){return""===term?data:data.filter(function(entity){return"undefined"==typeof entity.value?!1:StringNormalization.string(entity.value.toLowerCase()).indexOf(StringNormalization.string(term.toLowerCase()))>-1})}var ITEM_LIMIT=100,component={template:template,controller:["$scope",function($scope){$scope.search={term:""},$scope.isDirectDiscoveryField=directDiscoveryService.isDirectDiscoveryField,$scope.getDirectDiscoveryTypeTranslationKey=directDiscoveryService.getTypeTranslationKey,$scope.autoFocus=support.treatAsDesktop(),$scope.position||($scope.position="right"),$scope.onEscape=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.search.term=""):$scope.closeAddPopover()},$scope.onEnter=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.addExpressionMeasure({value:$scope.search.term})):$scope.closeAddPopover()},$scope.showFromField=function(field){$scope.currentField=field,$scope.step2=!0},$scope.goBack=function(event){event.preventDefault(),$scope.currentField=null,$scope.step2=!1},$scope.$watch("currentField",function(field){field?$scope.fieldSuggestions=["Sum","Count","Avg","Min","Max"].map(function(fnName){var fieldValue=util.escapeField($scope.currentField.value);return{aggregation:fnName,field:fieldValue}}):$scope.fieldSuggestions=[]}),$scope.addFromField=function(suggestion){var expression=suggestion.aggregation+"("+suggestion.field+")";$scope.addExpressionMeasure({value:expression})};var cache=null;$scope.$watch("search.term",function(term){function setItems(){var measures=filter(cache.measures,term),fields=filter(cache.fields,term);measures.length>ITEM_LIMIT?(measures=arrayUtil.limit(measures,ITEM_LIMIT),fields=[]):measures.length+fields.length>ITEM_LIMIT&&(fields=arrayUtil.limit(fields,ITEM_LIMIT-measures.length)),$scope.fields=fields,$scope.measures=measures}cache?setItems():Deferred.all({fields:libraryUtils.getSortedFields(),measures:libraryUtils.getSortedMeasures()}).then(function(args){var fields=args.fields.map(function(field){return{value:field.qName,label:field.qName,field:field.qName,qTags:field.qTags}}),measures=args.measures.map(function(measure){return{value:measure.qData.title,label:measure.qData.title,libraryId:measure.qInfo.qId}});cache={fields:fields,measures:measures},setItems()})})}],scope:{alignTo:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",closeAddPopover:"=",position:"="}};return component}),define("objects.requirements/requirements",["jquery","qvangular","text!./requirements.ng.html","client.utils/state","general.services/show-service/show-service","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover"],function($,qvangular,template,State,showService,BaseController,errorTranslation,Resize,addDimensionPopoverComponent,addMeasurePopoverComponent){"use strict";function getArray(len){var i,a=new Array(len);for(i=0;len>i;++i)a[i]={index:i};return a}function getDimensionInfo(layout){if(layout.qHyperCube)return layout.qHyperCube.qDimensionInfo||[];if(layout.qChildList){var children=layout.qChildList.qItems||[];return children.map(function(){return{}})}var hasError=!layout.qListObject||!layout.qListObject.qDimensionInfo||layout.qListObject.qDimensionInfo.qError;return hasError?[]:[layout.qListObject.qDimensionInfo]}function getMeasureInfo(layout){return layout.qHyperCube?layout.qHyperCube.qMeasureInfo||[]:[]}function updateShowAdd($scope){$scope.showAdd=State.isInEditMode()&&!$scope.object.isReadonly}var RequirementsController,activeItem=null;return RequirementsController=BaseController.extend({$scope:null,init:function($scope){function updateState(){updateShowAdd($scope)}function addFieldDimension(item){return $scope.object.ext.addFieldDimension(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addLibraryDimension(item){return $scope.object.ext.addLibraryDimension(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addLibraryMeasure(item){return $scope.object.ext.addLibraryMeasure(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addExpressionMeasure(item){return $scope.object.ext.addExpressionMeasure(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function closeAddPopover(event){popover&&(popover.destroy(),popover=null),activeItem&&(activeItem.active=!1),event&&!$(event.target).hasClass("add-button")&&(activeItem=null)}this.$scope=$scope,State.StateChanged.bind(updateState),$scope.$on("$destroy",function(){State.StateChanged.unbind(updateState)}),updateState(),$scope.removeDimension=function(index){$scope.object.model.getProperties().then(function(props){var propertyHandler=$scope.ext.getCreatePropertyHandler();propertyHandler.setProperties(props),propertyHandler.removeDimension(index).then(function(){$scope.object.model.save()})})},$scope.removeMeasure=function(index){$scope.object.model.getProperties().then(function(props){var propertyHandler=$scope.ext.getCreatePropertyHandler();propertyHandler.setProperties(props),propertyHandler.removeMeasure(index).then(function(){$scope.object.model.save()})})};var popover;$scope.showAddDimension=function(event,item){if(activeItem&&activeItem===item)return void(activeItem=null);var popoverComponent=$scope.ext.addDimensionPopoverComponent||addDimensionPopoverComponent;popover=showService.show(popoverComponent,{alignTo:$(event.target),closeAddPopover:closeAddPopover,addFieldDimension:addFieldDimension,addLibraryDimension:addLibraryDimension}),item.active=!0,activeItem=item},$scope.showAddMeasure=function(event,item){if(activeItem&&activeItem===item)return void(activeItem=null);var popoverComponent=$scope.ext.addMeasurePopoverComponent||addMeasurePopoverComponent;popover=showService.show(popoverComponent,{alignTo:$(event.target),closeAddPopover:closeAddPopover,addLibraryMeasure:addLibraryMeasure,addExpressionMeasure:addExpressionMeasure}),item.active=!0,activeItem=item},Resize.on("start",closeAddPopover),$scope.$on("$destroy",function(){Resize.off("start",closeAddPopover),closeAddPopover()})},onPaint:function(){var dimensions,measures,$scope=this.$scope,layout=$scope.layout,minDimensions=$scope.ext.dimensionDefinition?$scope.ext.dimensionDefinition.min:0,maxDimensions=$scope.ext.dimensionDefinition?$scope.ext.dimensionDefinition.max:0,minMeasures=$scope.ext.measureDefinition?$scope.ext.measureDefinition.min:0,maxMeasures=$scope.ext.measureDefinition?$scope.ext.measureDefinition.max:0;updateShowAdd($scope),$scope.iconClass=$scope.object.ext.libraryInfo.templateIconClassName,$scope.minDimensions=minDimensions,$scope.minMeasures=minMeasures,$scope.maxDimensions=maxDimensions,$scope.maxMeasures=maxMeasures,minDimensions!==maxDimensions||minMeasures!==maxMeasures?$scope.headerStr="Visualization.Requirements.AddAtLeast":$scope.headerStr="Visualization.Requirements.Add",dimensions=getDimensionInfo(layout).map(function(dimension){var title,errorCode=dimension.qError&&dimension.qError.qErrorCode;return title=errorCode?errorTranslation.getDimensionError(errorCode):dimension.title||dimension.qFallbackTitle,{invalid:!!errorCode,title:title}}),measures=getMeasureInfo(layout).map(function(measure){var title,errorCode=measure.qError&&measure.qError.qErrorCode;return title=errorCode?errorTranslation.getMeasureError(errorCode):measure.qFallbackTitle,{invalid:!!errorCode,title:title}}),$scope.finishedDimensions=dimensions,$scope.finishedMeasures=measures,$scope.unfinishedDimensions=getArray(Math.max(0,$scope.minDimensions-$scope.finishedDimensions.length)),$scope.unfinishedMeasures=getArray(Math.max(0,$scope.minMeasures-$scope.finishedMeasures.length)),$scope.show=!0}}),RequirementsController.$inject=["$scope"],qvangular.directive("qvRequirements",function(){return{controller:RequirementsController,require:["qvRequirements","^qvObject"],link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}}),{template:template,controller:RequirementsController}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="200" position="\'top\'" collision="\'flipfit\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\r\n	<div class="object-error-popup">\r\n		<!--<div class="object-error-title" q-translation="{{error.title}}"></div>-->\r\n		<div class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(template,resize){"use strict";return{template:template,controller:["$scope",function($scope){function resizeFn(){$scope.onClose()}$scope.$on("$destroy",function(){resize.off("start",resizeFn)}),resize.on("start",resizeFn)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error" ng-class="error.class" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-handler",["qvangular","angular","touche","translator","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation","autogenerated/qix/engine-enums"],function(qvangular,angular,Touche,translator,popupComponent,template,BaseController,errorTranslation,engineEnums){"use strict";function isSoftError(error){return error.qErrorCode===engineEnums.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED}function extractHyperCubeHack(layout){return layout.qHyperCube?layout.qHyperCube:layout.layers&&layout.layers.length&&layout.layers[0].qHyperCube?layout.layers[0].qHyperCube:!1}function getCustomErrorMessage(dataEntity){var errorCode=dataEntity.qError.qErrorCode;switch(errorCode){case engineEnums.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED:return dataEntity.customErrorMessage?dataEntity.customErrorMessage.calcCond:""}}var ErrorController=BaseController.extend({$scope:null,init:function($scope){this.$scope=$scope,$scope.hasSoftError=!1,$scope.hasHardError=!1,$scope.showMore=function(event){var element=angular.element("<div>").appendTo("body");element.showComponent(popupComponent,{alignTo:angular.element(event.target),error:$scope.error,onClose:function(){element.remove(),Touche.preventGestures()}})}},onPaint:function(){var errorMessage,$scope=this.$scope,error=$scope.object.error;if(!error){var layout=$scope.layout,hyperCube=extractHyperCubeHack(layout);hyperCube?hyperCube.qError&&(errorMessage=getCustomErrorMessage(hyperCube)||errorTranslation.getHyperCubeError(hyperCube.qError.qErrorCode),error=isSoftError(hyperCube.qError)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}):layout.qListObject&&(layout.qListObject.qError?(errorMessage=getCustomErrorMessage(layout.qListObject)||errorTranslation.getListObjectError(layout.qListObject.qError.qErrorCode),error=isSoftError(layout.qListObject.qError)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}):layout.qListObject.qDimensionInfo&&layout.qListObject.qDimensionInfo.qError.qErrorCode&&(errorMessage=getCustomErrorMessage(layout.qListObject.qDimensionInfo)||errorTranslation.getDimensionError(layout.qListObject.qDimensionInfo.qError.qErrorCode),error=isSoftError(layout.qListObject.qDimensionInfo.qError.qErrorCode)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}))}$scope.error=error}});return ErrorController.$inject=["$scope"],qvangular.directive("qvErrorhandler",function(){return{controller:ErrorController,require:["qvErrorhandler","^qvObject"],link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}}),{template:template,controller:ErrorController}}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(DataPropertyHandler){"use strict";var EmptyHandler=DataPropertyHandler.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}});return EmptyHandler}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div qv-extension class="object-error hard-error" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n		<button ng-if="showButton" class="qui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/invalid-type",["angular","touche","translator","objects.utils/data-properties/empty-handler","client.utils/state","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(angular,Touche,translator,EmptyHandler,State,popupComponent,template){"use strict";return{type:"invalid",template:template,
definition:{type:"items",items:{}},snapshot:{canTakeSnapshot:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(){return new EmptyHandler},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function($scope){var message,error=$scope.object.error,title=translator.get(error.title);message=Array.isArray(error.message)?translator.get(error.message[0],error.message.slice(1)):translator.get(error.message),$scope.error={title:title,message:message},$scope.showButton=!($scope.options&&$scope.options._hideErrorButton),$scope.remove=function(event){var id=$scope.layout.qInfo.qId,sheet=State.model,obj=sheet.getObjectById(id);sheet.removeObject({row:obj.row,col:obj.col}),event.stopPropagation()},$scope.showMore=function(event){var element=angular.element("<div>").appendTo("body");element.showComponent(popupComponent,{alignTo:angular.element(event.target),error:$scope.error,onClose:function(){element.remove(),Touche.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(pubsub){function sendResizeEvent(data){data=data||{},pubsub.publish("/ui/object/resize",data)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(v){pubsub.subscribe(v,sendResizeEvent)})}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div class="qv-selection-toolbar qvt-selection-toolbar"\r\n	 ng-style="toolbar.style"\r\n	 ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\r\n	 qva-activate="locked && toggleLock($event);">\r\n    <div class="sel-toolbar-list-wrapper">\r\n		<table class="sel-toolbar-list">\r\n            <tr>\r\n                <td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': filteredMenuButtons.length === 0 }">\r\n                    <button tid="selection-toolbar.toggleShowMenu"\r\n                            class="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\r\n                            ng-class="{ \'menu-active\': toolbar.showMenu }"\r\n                            q-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\r\n                            qva-activate="toggleShowMenu($event)">\r\n                        <span class="sel-toolbar-span-icon selections-more"></span>\r\n                    </button>\r\n                </td>\r\n                <td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\r\n                    <button tid="selection-toolbar.lock"\r\n                            class="sel-toolbar-btn sel-toolbar-icon"\r\n                            q-title-translation="{{\'DataModelViewer.RightMenu.Tooltip.ClickTo\' + (locked ? \'Unlock\' : \'Lock\')}}"\r\n                            ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\r\n                            qva-activate="!locked && toggleLock($event);">\r\n                        <span class="sel-toolbar-span-icon" ng-class="!locked ? \'icon-toolbar-unlocked\':\'icon-toolbar-locked sel-toolbar-menu-span-icon\'"></span>\r\n                    </button>\r\n                </td>\r\n                <td ng-show="locked" class="sel-toolbar-list-item-locked">\r\n                    <p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\r\n                </td>\r\n                <td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\r\n                    <button tid="{{button.tid}}"\r\n                            qva-activate="buttonAction($event, button)"\r\n                            q-title-translation="{{button.name}}"\r\n                            ng-disabled="buttonIsDisabled(button)"\r\n                            class="sel-toolbar-btn"\r\n                            ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\r\n                        <span class="sel-toolbar-span-icon" ng-class="button.iconClass"></span>\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n\r\n    </div>\r\n	<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\r\n		 qva-delegated-activate="div:not(.disabled)#menuAction($event);">\r\n		<div ng-repeat="button in filteredMenuButtons" class="sel-toolbar-menu-item"\r\n			 tid="{{button.tid}}"\r\n			 q-title-translation="{{button.name}}"\r\n			 ng-class="{\'disabled\': buttonIsDisabled(button) }">\r\n			<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': filteredButtons.length === 0 }">\r\n				<tr>\r\n					<td><span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span></td>\r\n					<td ng-if="filteredButtons.length !== 0"><p class="sel-toolbar-menu-text" q-translation="{{button.name}}"></p></td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","core.utils/deferred"],function($,qvangular,template,Deferred){"use strict";var component,buttonLayout,BUTTON_WIDTH=44,SEPARATOR_WIDTH=1,BORDER_SPACING=8,EXTRA_EDGE_PADDING=2;return qvangular.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),buttonLayout={width:0,buttons:[],haveButtons:function(){return this.buttons.length>0},reset:function(width){this.width=width,this.buttons.length=0},freeWidth:function(){var i,usedWidth=0;for(i=0;i<this.buttons.length;i++)usedWidth+=this.buttons[i];return this.width-usedWidth}},component={template:template,controller:["$scope",function($scope){function howManyButtons(width,buttons,menuButtons){var buttonWidth,i,extraWidth=0;for(buttonLayout.reset(width-(BORDER_SPACING+2*EXTRA_EDGE_PADDING)),i=buttons.length-1;i>=0&&(buttonWidth="sel-toolbar-icon-separator"!==buttons[i].buttonClass?BUTTON_WIDTH+BORDER_SPACING:SEPARATOR_WIDTH+BORDER_SPACING,buttonWidth<=buttonLayout.freeWidth());i--)buttonLayout.buttons.push(buttonWidth);for(($scope.toolbar.showLock||$scope.locked)&&(extraWidth+=BUTTON_WIDTH+BORDER_SPACING),(menuButtons.length>0||buttons.length>buttonLayout.buttons.length)&&(extraWidth+=BUTTON_WIDTH+BORDER_SPACING);buttonLayout.haveButtons()&&buttonLayout.freeWidth()<extraWidth;)buttonLayout.buttons.pop();return buttonLayout.buttons.length}function layoutButtons(){var i,btn,btns=[].concat($scope.toolbar.buttons),menuBtns=[].concat($scope.toolbar.menuButtons),cnt=howManyButtons($scope.toolbar.style.width,btns,menuBtns);for($scope.filteredButtons=[],$scope.filteredMenuButtons=[],i=0;cnt>i&&btns.length;++i)$scope.filteredButtons.push(btns.pop());for($scope.filteredButtons.reverse();btns.length;)btn=btns.pop(),"sel-toolbar-icon-separator"!==btn.buttonClass&&$scope.filteredMenuButtons.push(btn);for(;menuBtns.length;)$scope.filteredMenuButtons.push(menuBtns.shift())}function handleLock(locked){$scope.locked=locked,$scope.toolbar.showMenu=!1,gotPositionPromise.then(function(){layoutButtons()})}var dfd=Deferred(),gotPositionPromise=dfd.promise;$scope.filteredButtons=[],$scope.filteredMenuButtons=[],$scope.selectionInfo={show:!1,selected:0,total:0},$scope.lassoEnabled=!1,this.confirm=function(){$scope.selectionsApi.confirm()},this.close=function(){$scope.destroyComponent()},$scope.buttonAction=function($event,button){$event.originalEvent.preventDefault(),button.action.call($scope.toolbar)},$scope.buttonIsDisabled=function(button){return"function"==typeof button.isDisabled?button.isDisabled.call($scope.toolbar):!1},$scope.menuAction=function($event){var scope=$($event.target).scope();$event.originalEvent.preventDefault(),scope.button.action.call($scope.toolbar),$scope.toolbar.showMenu=!$scope.toolbar.showMenu},$scope.toggleShowMenu=function($event){$event.originalEvent.preventDefault(),$scope.toolbar.showMenu=!$scope.toolbar.showMenu},$scope.toggleLasso=function(){$scope.lassoEnabled=!$scope.lassoEnabled,$scope.toolbar.toggleLasso($scope.lassoEnabled)},$scope.toggleLock=function($event){$event.originalEvent.preventDefault(),$scope.toolbar.backendApi.isLocked()?($scope.toolbar.selectionsApi.selectionsMade=!0,$scope.toolbar.backendApi.unlock()):$scope.toolbar.backendApi.lock()},$scope.$watch("toolbar.backendApi.isLocked()",function(locked){void 0!==locked&&handleLock(locked?!0:!1)}),$scope.$watch("toolbar.position",function(position){position&&($scope.toolbar.style=position,dfd.resolve(),handleLock($scope.toolbar.backendApi.isLocked?$scope.toolbar.backendApi.isLocked():!1))}),$scope.$watch("toolbar.menuMaxHeight",function(maxHeight){maxHeight&&($scope.toolbar.menuStyle={maxHeight:maxHeight})}),$scope.$watch("options.lassoEnabled",function(enabled){$scope.lassoEnabled=enabled})}]}}),define("client.views/selection-toolbar/selection-toolbar-service",["qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(qvangular,component,util,Notification){"use strict";qvangular.service("qvSelectionToolbarService",function(){function getBoundingBox($object,$dockToElement){var prevCellSiblings,tableBbox,firstCell,firstCellBbox,objectRect=$object[0].getBoundingClientRect(),bbox=$dockToElement[0].getBoundingClientRect();return $dockToElement.is("th, td")&&(tableBbox=$dockToElement.closest("table")[0].getBoundingClientRect(),prevCellSiblings=$dockToElement.prevAll(),firstCell=prevCellSiblings.length?prevCellSiblings.last():$dockToElement,firstCellBbox=firstCell[0].getBoundingClientRect(),firstCellBbox.left-tableBbox.left===1)?{top:bbox.top-objectRect.top,left:bbox.left-1-objectRect.left,width:bbox.width}:{top:bbox.top-objectRect.top,left:bbox.left-objectRect.left,width:bbox.width}}var service,$container,ctrl;return service={open:function($object,$dockToElement,input){var bbox=getBoundingBox($object,$dockToElement),position={top:-44+bbox.top,width:bbox.width+(input.offsetWidth||0),left:bbox.left};input.toolbar=util.extend(!0,input.toolbar,{position:position,menuMaxHeight:input.menuMaxHeight}),$container=angular.element("<div>"),ctrl=$container.showComponent(component,input),$container.appendTo($object),this.Opened.emit()},close:function(){ctrl&&(ctrl.close(),this.Closed.emit(),ctrl=void 0),$container&&$container.remove()},confirm:function(){ctrl&&(ctrl.confirm(),ctrl=void 0),this.close()}},Notification.create(service,"Closed"),Notification.create(service,"Opened"),service})}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\r\n</div>\r\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvThrobber",["$timeout",function($timeout){return{replace:!0,template:template,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function($scope){var timeoutP;$scope.$watch("model.isValidating",function(value){return $scope.disabled===!0?void($scope.progress=!1):void($scope.model&&void 0===$scope.model.state?$scope.progress=!0:value?(timeoutP&&$timeout.cancel(timeoutP),timeoutP=$timeout(function(){$scope.model&&$scope.model.isValidating&&($scope.progress=!0)},$scope.delay||1e3)):$scope.progress=!1)})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\r\n	<div class="rain-progress" ng-style="rainStyle">\r\n		<div class="progress-div rotating" ng-class="ngClasses">\r\n		</div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvRain",[function(){return{replace:!0,template:template,restrict:"E",scope:{show:"=",resize:"=?",messageObj:"=?"},link:function($scope,$element){function update(){var bbox=$element[0].getBoundingClientRect(),min=Math.min(bbox.width,bbox.height);min=.3*min,$scope.rainStyle.height=min+"px",$scope.rainStyle.width=min+"px",$scope.rainStyle.top=(bbox.height-min)/2,$scope.rainStyle.left=(bbox.width-min)/2}$scope.rainStyle={},$scope.$watch("show",function(show){void 0!==show&&show&&update()}),$scope.resize&&$scope.resize(update),update()}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.models/visualization-object","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","client.utils/state","objects.extension/extension-type","util","translator","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function($,qvangular,Deferred,Visualizations,VisualizationObject,layoutMode,TypeLoader,template,pubsub,State,ExtensionType,util,translator,requirements,errorHandler,resize,BaseCtrl){"use strict";function confirmSelections(object){object.selectionsApi&&object.selectionsApi.active&&object.selectionsApi.confirm()}function setUpResize($scope,object){function isVisible(){return!$scope.options||$scope.options.isVisible!==!1}function confirmSelectionsOnResizeStart(){confirmSelections(object)}function onResize(){isVisible()&&(qvangular.$apply($scope,function(){object.resize()}),object.throbberApi.resize())}function triggerResize(){timer||(timer=setTimeout(function(){onResize(),clearTimeout(timer),timer=null},100))}var timer;$scope.$on("resizeCell",function(){triggerResize()}),pubsub.subscribe("/ui/object/resize."+$scope.$id,function(){triggerResize()}),resize.on("start."+$scope.$id,confirmSelectionsOnResizeStart),$scope.$on("$destroy",function(){clearTimeout(timer),pubsub.unsubscribe("."+$scope.$id),resize.off("start."+$scope.$id,confirmSelectionsOnResizeStart)})}function setUpModel($scope,object){function layoutCallback(layout){$scope.model.isCancelled||($scope.layout=layout,object.setLayout(layout,$scope.options))}function modelCallback(model){object.model&&unobserveModel(object.model),observeModel(model),object.setModel(model)}function onModelInvalid(){object.setRenderState(objectRenderStates.INVALID)}function observeModel(model){model.Invalidated&&!model.isCancelled&&model.Invalidated.bind(onModelInvalid)}function unobserveModel(model){model.Invalidated&&model.Invalidated.unbind(onModelInvalid)}var unbindLayout;$scope.object._forcePaint=!0,unbindLayout=VisualizationObject.bindLayout($scope,"model",layoutCallback,modelCallback),$scope.$on("$destroy",function(){object.model&&unobserveModel(object.model),unbindLayout&&unbindLayout()})}function setUpPaint($scope,object,$element,ctrl){function isVisible(){return!$scope.options||$scope.options.isVisible!==!1}function onRendered(object,callback,promise,err){paintP=Deferred(),promise&&promise.then?promise.then(function(){paintP.resolve(objectOnPaintReturnValues.PROMISE)}):paintP.resolve(objectOnPaintReturnValues.UNKNOWN),paintP.promise.then(function(status){object.setRenderState(objectRenderStates.RENDERED),callback&&setTimeout(function(){callback({promised:status===objectOnPaintReturnValues.PROMISE,error:err||!1})},0)})}var updateTimeoutP,resetTimeoutP,resizeTimeoutP,paintP,$objectElem,width,height;object.setObjectClass=function(resize){$objectElem||($objectElem=$element.find(".qv-object")),(resize||void 0===width)&&(width=$objectElem[0].clientWidth),(resize||void 0===height)&&(height=$objectElem[0].clientHeight);var mode=layoutMode.getLayoutMode(width,height),type=object.type&&object.type.type,classList=[];if($scope.ext&&State.state===State.States.snapshot){var snapshotClass=object.canTakeSnapshot()?"qv-snapshot-enabled":"qv-snapshot-disabled";classList.push(snapshotClass)}object.selectionsApi&&object.selectionsApi.active&&classList.push("qv-selections-active"),object.objectSize={w:width,h:height},$scope.options.layoutMode=mode;var layoutClass="qv-layout-"+layoutMode.getLayoutModeKey(mode);classList.push(layoutClass),$scope.objectClass="qv-object-"+type,classList.push($scope.objectClass),object.selectionClass&&classList.push(object.selectionClass),$scope.classList=classList},object.update=function(){this.valid&&(this.loadContent(),updateTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass(),object.backendApi&&object.backendApi.updateCache($scope.layout);var req=ctrl.childLoaded();$scope.rpcId=req.rpcId,req.then(function(child){try{onRendered(object,$scope.options.onRendered,child.onPaint(isVisible()))}catch(err){throw object.error={"class":"hard-error",title:translator.get("Object.Error"),message:translator.get("Object.ErrorMessage.RenderingFailed",object.ext.type)},object.content=errorHandler,ctrl.resetChildController(),resetTimeoutP=qvangular.getService("$timeout")(function(){ctrl.childLoaded().then(function(child){onRendered(object,$scope.options.onRendered,child.onPaint(!0),!0)})}),err}})}))},object.resize=function(){isVisible()&&(object.setRenderState(objectRenderStates.INVALID),resizeTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass(!0),ctrl.childLoaded().then(function(child){onRendered(object,null,child.onResize())})}))},object.onResize=function(){ctrl.childLoaded().then(function(child){onRendered(object,null,child.onResize())})},$scope.$on("$destroy",function(){var $timeout=qvangular.getService("$timeout");$timeout.cancel(updateTimeoutP),$timeout.cancel(resetTimeoutP),$timeout.cancel(resizeTimeoutP),paintP&&paintP.reject()})}function setUpLoading($scope,$element,object,ctrl){function getComponent(){var args={options:$scope.options,object:object,layout:$scope.layout,ext:object.ext};return object.ext.hasError(args)?errorHandler:object.ext.showRequirements(args)?requirements:object.ext}var loading=Deferred();object.loaded=loading.promise,object.valid=!1,object.showExploreMenu=!1,object.loadContent=function(){var component=getComponent();this.content!==component&&(void 0!==this.content&&(ctrl.resetChildController(),ctrl.childLoaded().then(function(child){child.onStateChanged(State)})),this.content=component)},object.reset=function(){this.valid&&($scope.options=util.extend({},$scope.resetOptions,{isZoomed:$scope.options.isZoomed}),loading=Deferred(),this.loaded=loading.promise,this.valid=!1)},object.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,loading.resolve())},object.setExtension=function(ext){this.ext=ext,$scope.ext=ext,"invalid"!==ext.type&&(ext.mapProperties(this.model),ext.mapSoftProperties(),this.setBackendApi(),this.updateSnapshot()),this.validate(),this.update(),this.ext.model=this.model},object.setBackendApi=function(){var APIType=$scope.options.APIType||this.ext.BackendApi,backendApi=this.backendApi=new APIType(this.model);ctrl.childLoaded().then(function(child){child.setBackendApi(backendApi)})},object.setType=function(type,updatePropertyPanel){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=type,type.load().then(function(ext){object.type===type&&(type!==invalidExtensionType&&(object.error=null),object.setExtension(ext),setUpSelections($scope,$element,object,ctrl),updatePropertyPanel&&(qvangular.$rootScope.$broadcast("refreshPropertyPanel"),qvangular.$rootScope.$broadcast("reloadExploreContent")))},function(){object.setType(invalidExtensionType),object.error={"class":"hard-error",title:translator.get("Object.Invalid.Title"),message:translator.get("Object.ErrorMessage.NotFound",type.type)},object.isInvalid=!0})},object.setModel=function(model){this.model=model,this.ext&&(this.ext.model=model,this.setBackendApi())},object.setLayout=function(layout){this.layout=layout;var typeName=layout.visualization||layout.qInfo.qType,type=Visualizations.getType(typeName);layout.qError&&(type=invalidExtensionType,this.error={title:"Object.Error",message:"Object.Invalid.Info"}),type||(type=invalidExtensionType,this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound",typeName]}),this.type!==type&&(this.reset(),this.setType(type,!!this.type)),this.isInvalid=type===invalidExtensionType,this.isLink=!this.isInvalid&&!!layout.qExtendsId,this.showTitles=layout.showTitles!==!1,this.validate(),this.update()}}function setUpSelections($scope,$element,object,ctrl){function onOutside(e){var $target=$(e.target);object.selectionsApi.ignoreOnOutside($target)||(object.selectionsApi.getDockToElement().off(".object"),object.selectionsApi.confirm())}function beforeUnload(){return object.backendApi&&object.backendApi.endSelections(!0),null}object.activateSelections=function(){"undefined"!=typeof object.ext.options.selections&&ctrl.childLoaded().then(function(child){child.allowInteraction(State)&&object.selectionsApi.activate()})},object.selectionsApi&&"function"==typeof object.selectionsApi.destroy&&object.selectionsApi.destroy(),object.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[],$(window).off("onbeforeunload",beforeUnload)},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function($target){return!(!$target.closest(".qv-selection-toolbar").length&&!$target.closest(".selections-data-area-ui").length)},getDockToElement:function(){return $element},getMenuMaxHeight:function(){return object.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},watchActivated:function(fn){return this._activatedCallbacks.push(fn),function(){var ix=this._activatedCallbacks.indexOf(fn);this._activatedCallbacks.splice(ix,1)}.bind(this)},activated:function(suppressBeginSelections){this.active=!0,suppressBeginSelections||object.backendApi.beginSelections(),$(window).on("onbeforeunload",beforeUnload),$scope.options.isPopover||(this.getDockToElement().on("qv-outside.object",onOutside),qvangular.$apply($scope,function(){object.setObjectClass(),object.getSelectionToolbar().then(function(toolbar){var input={toolbar:toolbar,selectionsApi:object.selectionsApi,options:$scope.options,menuMaxHeight:object.selectionsApi.getMenuMaxHeight(),offsetWidth:object.selectionsApi.getSelectionToolbarWidthOffset()};qvangular.getService("qvSelectionToolbarService").open($element,object.selectionsApi.getDockToElement(),input)})})),this._activatedCallbacks.forEach(function(fn){fn.call(this)},this)},watchDeactivated:function(fn){return this._deactivatedCallbacks.push(fn),function(){var ix=this._deactivatedCallbacks.indexOf(fn);this._deactivatedCallbacks.splice(ix,1)}.bind(this)},deactivated:function(){$(window).off("onbeforeunload",beforeUnload),this.active=!1,this.selectionsMade=!1,$scope.options.isPopover||(object.selectionsApi.getDockToElement().off(".object"),qvangular.$apply($scope,function(){object.setObjectClass(),qvangular.getService("qvSelectionToolbarService").close()})),this._deactivatedCallbacks.forEach(function(fn){fn.call(this)},this)},confirm:function(){object.selectionsApi.deactivateSearch&&object.selectionsApi.deactivateSearch(),object.backendApi.endSelections(!0),this.deactivated()},cancel:function(){object.selectionsApi.deactivateSearch&&object.selectionsApi.deactivateSearch(),object.backendApi.endSelections(!1),this.deactivated()},clear:function(){object.backendApi.clearSelections()},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(e){return!(e.metaKey||e.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated()}}}function setUpThrobber($scope,object){function resetThrobber(isValidating,showDelay){qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout),object.selectionsApi&&object.selectionsApi.active?object.throbberApi.hide():$scope.model&&void 0===$scope.model.state?object.throbberApi.show():$scope.model&&$scope.model.isCancelled?object.throbberApi.isQueryCanceled=!0:isValidating?(isVisibleTimeout=qvangular.getService("$timeout")(function(){$scope.model&&$scope.model.isValidating&&object.throbberApi.show()},showDelay),isLongRunningTimeout=qvangular.getService("$timeout")(function(){object.throbberApi.isVisible===!0&&(object.throbberApi.isLongRunningQuery=!0,object.throbberApi.isQueryCanceled=!1)},8e3)):(object.throbberApi.hide(),object.throbberApi.isLongRunningQuery=!1)}var unwatchFn,isVisibleTimeout,isLongRunningTimeout;object.throbberApi&&"function"==typeof object.throbberApi.destroy&&object.throbberApi.destroy(),object.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){unwatchFn=$scope.$watch("model.isValidating",function(isValidating){resetThrobber(isValidating,1e3)})},reset:function(isValidating){resetThrobber(isValidating,0)},show:function(){object.throbberApi.isVisible=!0,object.throbberApi.isQueryCanceled=!1,object.throbberApi.isLongRunningQuery=!1},hide:function(){object.throbberApi.isVisible=!1,object.throbberApi.isLongRunningQuery=!1,qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout)},off:function(){unwatchFn(),qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout)},destroy:function(){object.throbberApi.off(),object.throbberApi.resizeCallbacks.length=0},resize:function(){object.throbberApi.resizeCallbacks.forEach(function(callback){callback()})},watchResize:function(callback){object.throbberApi.resizeCallbacks.push(callback)}},object.throbberApi.initialize()}var invalidExtensionType=new ExtensionType({type:"invalid",path:"objects.error-handling/invalid-type"}),objectRenderStates={INVALID:0,RENDERED:1},objectOnPaintReturnValues={UNKNOWN:0,PROMISE:1};qvangular.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",throbberApi:"="}),qvangular.directive("qvObject",["$parse",function($parse){return{restrict:"E",replace:!0,template:template,scope:{options:"=",model:"=",object:"=?",navMenu:"="},controller:function(){var childDfd=Deferred();this.addChildController=function(ctrl,ctrlScope){ctrl instanceof BaseCtrl||(ctrl=new(BaseCtrl.extend(ctrl)),ctrl.$scope=ctrlScope),childDfd.resolve(ctrl)},this.resetChildController=function(){childDfd=Deferred()},this.childLoaded=function(){return childDfd.promise}},link:function($scope,$element,$attrs,ctrl){var stateTimeoutP,object=$scope.object={};$scope.resetOptions=util.extend({},$scope.options),$scope.options||($scope.options={}),$scope.options.zoomEnabled=!!$attrs.zoomObject,$scope.$on("objectTrigger",function(event,type){switch(type){case"zoomOnCell":$parse($attrs.zoomObject)($scope.$parent)}event.stopPropagation()}),Object.defineProperties(object,{hasFrame:{get:function(){return!$scope.options.isPopover&&!object.isInvalid}},isReadonly:{get:function(){return object.isLink||object.isInvalid||$scope.options.isReadonly}},haveTitleArea:{get:function(){var layout=this.layout;return this.showTitles&&(""!==layout.title||""!==layout.subtitle||State.state===State.States.edit&&!this.isReadonly)}},hasSoftProperties:{get:function(){return!!this.ext&&!!this.ext.mappedSoftDefinition}}}),object.getPropertyPanelContent=function(){return object.loaded.then(function(){var propertyHandler=object.ext.getCreatePropertyHandler(),definition=object.ext.mappedDefinition||object.ext.definition,globalChangeListeners=object.ext.globalChangeListeners;return{definition:definition,globalChangeListeners:globalChangeListeners,type:object.type,backendApi:object.backendApi,handler:propertyHandler,iconClass:object.ext.libraryInfo.templateIconClassName,titleRef:"title",ext:object.ext}})},object.getSoftPropertyContent=function(){return object.loaded.then(function(){var definition=object.ext.mappedSoftDefinition||object.ext.softDefinition;return{definition:definition,type:object.type,backendApi:object.backendApi}})},object.toggleExploreMenu=function(display){void 0!==display?object.showExploreMenu=display:object.showExploreMenu=!object.showExploreMenu},object.setSnapshotData=function(snapshotLayout,options){return ctrl.childLoaded().then(function(child){return child.setSnapshotData(snapshotLayout,options)})},object.getViewState=function(){return ctrl.childLoaded().then(function(child){return child.getViewState()})},object.getDropOptions=function(builder,showMenu){return object.ext.getDropOptions(object,builder,showMenu)},object.getContextMenu=function(menu){return ctrl.childLoaded().then(function(child){return child.getContextMenu(object,menu)})},object.getObjectMenu=function(menu){return ctrl.childLoaded().then(function(child){return child.getObjectMenu(object,menu)})},object.getSelectionToolbar=function(){return object.loaded.then(function(){return ctrl.childLoaded().then(function(child){return child.getSelectionToolbar()})})},object.reloadContent=function(){$scope.ext=object.ext=$.extend({},object.ext),object.loadContent()},object.canShowExploreMenu=function(){var isOtherContent=this.content===requirements||this.content===errorHandler;return!this.isInvalid&&this.hasSoftProperties&&!isOtherContent},object.canTakeSnapshot=function(){return this.content!==requirements&&this.content!==errorHandler&&$scope.model.isValid?"function"==typeof $scope.ext.snapshot.canTakeSnapshot?$scope.ext.snapshot.canTakeSnapshot.call(null,object):"boolean"==typeof $scope.ext.snapshot.canTakeSnapshot?$scope.ext.snapshot.canTakeSnapshot:!1:void 0},object.updateSnapshot=function(){var snapshotMode=State.state===State.States.snapshot;object&&object.ext&&snapshotMode?object.ext.snapshot.updateCount($scope).then(function(count){$scope.showSnapshotCount=object&&object.canTakeSnapshot()&&count>0}):$scope.showSnapshotCount=!1},object.setInteraction=function(on){ctrl.childLoaded().then(function(child){child.setInteraction(on)})},object.setRenderState=function(state){object.renderState!==state&&(object.renderState=state,$scope.$emit("objectRenderStateChange",state))},$scope.$watch(function(){return State.state},function(currentState){var req=ctrl.childLoaded();$scope.rpcId=req.rpcId,req.then(function(child){$scope.editmode=currentState===State.States.edit,$scope.editmode&&confirmSelections(object),object.updateSnapshot(),child.onStateChanged(State),qvangular.getService("$timeout").cancel(stateTimeoutP),stateTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass()})})}),setUpLoading($scope,$element,object,ctrl),setUpResize($scope,object),setUpPaint($scope,object,$element,ctrl),object.setRenderState(objectRenderStates.INVALID),TypeLoader.load($scope.options._skipRegisterExtensions).then(function(){setUpModel($scope,object)}),object.loaded.then(function(){$scope.cancelled=$scope.model.isCancelled}),$scope.$watch("options",function(options){options&&options.setController&&ctrl.childLoaded().then(function(){options.setController(object)})}),$scope.$on("childSelectionActive",function(event,active){object.childInSelection=active,event.preventDefault()}),$scope.takeSnapshot=function(event,options){State.state===State.States.snapshot&&object.canTakeSnapshot()&&($scope.ext.snapshot.take(this,object,event,options),$scope.showSnapshotCount=!0);
},$scope.openSnapshotLibrary=function(event){event.stopImmediatePropagation(),qvangular.getService("storyItemsLibrary").openLibrary({event:event,library:"snapshot",objectId:this.layout.qInfo.qId})},$scope.titleClicked=function(){this.options._disableSelections||$scope.editmode||object.activateSelections()},$scope.cancel=function(){$scope.model.__layoutRPCId&&($scope.model.cancelRequest($scope.model.__layoutRPCId),delete $scope.model.__layoutRPCId,object.throbberApi.hide(),object.throbberApi.isQueryCanceled=!0)},$scope.retry=function(){object.throbberApi.hide(),object.throbberApi.isQueryCanceled=!1,object.throbberApi.reset(!0),$scope.model.markAsInvalid(),$scope.model.getLayout().then(function(layout){$scope.layout=layout,object.setLayout(layout)})},setUpThrobber($scope,object,ctrl),$scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(stateTimeoutP),object&&(confirmSelections(object),object.selectionsApi&&"function"==typeof object.selectionsApi.destroy&&object.selectionsApi.destroy(),object.backendApi&&(object.backendApi.destroy(),object.backendApi=null),object.throbberApi&&object.throbberApi.destroy(),object=null,$scope.object=null)})}}}])}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice}">\r\n	<div ng-if="!isSmallDevice">\r\n		<div class="qv-selections-pager">\r\n\r\n			<div class="buttons borderbox">\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="back()" ng-disabled="disable.back" q-title-translation="Tooltip.NavigateBack">\r\n					<i class="icon-toolbar-navigation-back"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="forward()" ng-disabled="disable.forward" q-title-translation="Tooltip.NavigateForward">\r\n					<i class="icon-toolbar-navigation-forward"></i>\r\n				</button>\r\n\r\n				<button id="clearselections" class="qv-subtoolbar-button borderbox" ng-disabled="disable.clear" qva-activate="clearAllFields()" q-title-translation="Tooltip.ClearSelections">\r\n					<i class="icon-toolbar-clearselections"></i>\r\n				</button>\r\n\r\n			</div>\r\n			<div class="selections-shadow" ng-if="showShadow"></div>\r\n			<div class="wrap borderbox" style="height: 100%;" qv-pager qv-selection-pager>\r\n				<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\r\n					<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\r\n						<div class="item" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\r\n				\'active\' : item.qField === activeFieldName,\r\n				\'dim\' : $parent.itemSelected && !item.active,\r\n				\'item-locked\' : item.qLocked,\r\n				\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\r\n				\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\r\n							<div ng-class="{locked:item.qLocked}" class="text">\r\n								<div class="text-wrap">\r\n									<span ng-class="{ \'icon-toolbar-locked\': item.qLocked }"></span><span class="name">{{item.qField}}</span>\r\n								</div>\r\n								<span class="values">{{item.translation}}</span>\r\n							</div>\r\n						<span ng-class="{\r\n						\'icon-toolbar-locked\': item.qLocked,\r\n						\'item-animate-in\' : item.feedbackActive,\r\n						\'item-animate-out\' : !item.feedbackActive,\r\n						\'icon-locked-feedback\' : item.feedbackActive && item.qLocked }">\r\n						</span>\r\n							<div class="options">\r\n								<a ng-if="!item.qLocked && !item.isPlaceHolder" qva-activate="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\r\n									<i class="icon-cancel"></i>\r\n								</a>\r\n							</div>\r\n\r\n							<qv-state-count-bar ng-if="!item.isPlaceHolder" cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n				<div ng-if="!items.length" class="empty-text no-selection" q-translation="CurrentSelections.NoSelections"></div>\r\n				<a class="qv-pager-nav qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="icon-hub-previous"></i></a>\r\n				<a class="qv-pager-nav qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="icon-hub-next"></i></a>\r\n			</div>\r\n			<div class="buttons-end borderbox">\r\n				<button tid="toggleGlobalSearchButton" class="qv-subtoolbar-button global-search-button borderbox" ng-class="{active: isGlobalSearchActive}" qva-activate="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\r\n					<i class="icon-toolbox-search-magnifier"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" ng-class="{active: isGlobalSelectionsActive}" qva-activate="toggleGlobalSelection($event)"\r\n					q-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\r\n					<i class="icon-toolbar-currentselections"></i>\r\n				</button>\r\n			</div>\r\n\r\n		</div>\r\n	</div>\r\n	<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " qva-activate="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\r\n		<div class="qv-current-selections-mobile-background">\r\n			<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.models/listbox",["objects.models/visualization-object","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader"],function(VisualizationObject,Visualizations,listObjectUtil,util,TypeLoader){"use strict";var Listbox,cachedTransientArray=[];return Listbox=VisualizationObject.extend("Listbox",{}),Listbox.createTransient=function(that,app,props){var transientObject,i,result,toReturn=-1,cachedTransientArrayLength=cachedTransientArray.length;for(transientObject={that:that,app:app,props:props},i=0;cachedTransientArrayLength>i;i++)if(angular.equals(cachedTransientArray[i].askFor,transientObject)){toReturn=i;break}return toReturn>=0?cachedTransientArray[toReturn].result:(result=TypeLoader.load().then(function(){return Visualizations.getType("listbox").getInitialProperties(props).then(function(init){return VisualizationObject.createTransient.call(that,init,app)})}),cachedTransientArray.push({askFor:transientObject,result:result}),result)},Listbox.createTransientField=function(app,field,initProps){var props={};return props.qListObjectDef=listObjectUtil.createFieldDimension(field),util.extend(!0,props,initProps||{}),this.createTransient(this,app,props)},Listbox.createTransientDimension=function(app,id,initProps){var props={};return props.qListObjectDef=listObjectUtil.createLibraryDimension(id),util.extend(!0,props,initProps||{}),this.createTransient(this,app,props)},Listbox}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(Deferred,resize){var component={template:null,controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function destroy(){$timeout(function(){$scope.destroyComponent(),$element.remove()}),resize.off("start.listbox-popover-error",destroy)}function getWidth(){return $timeout(function(){return $element.find(".toolbar-wrapper").outerWidth()})}var ctrl=this;ctrl.selectionsActivated=function(){},ctrl.selectionsDeactivated=function(){},ctrl.close=function(){destroy()},$scope.closeView=function(event){$scope.onPopoverClose(event),destroy()},Deferred.all({object:$scope.getVisualization(),width:getWidth()}).then(function(args){var object=args.object,width=args.width;object.getSelectionToolbar().then(function(toolbar){$scope.toolbar=toolbar,$scope.toolbar.showLock=$scope.options.showLock,$scope.toolbar.position={width:width},object.activateSelections()}),object.loaded.then(function(){object.ext.hasError({layout:object.model.layout})&&resize.on("start.listbox-popover-error",destroy)}),object.selectionsApi.watchActivated(function(){ctrl.selectionsActivated()}),object.selectionsApi.watchDeactivated(function(){ctrl.selectionsDeactivated(),destroy()}),$scope.closeView=function(event){object.selectionsApi.confirm(),$scope.onPopoverClose(event),destroy()}})}]};return component}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<immidiate-contextual\r\n		class="qv-listbox-popover"\r\n		align-to="$alignToElement"\r\n		position="popupPosition"\r\n		collision="collision"\r\n		width="234"\r\n		height="332"\r\n		on-close-view="closeView(event)"\r\n		qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options"></div>\r\n	<div class="listbox-wrapper" >\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</immidiate-contextual>\r\n'}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\r\n	class="qv-listbox-popover-small-device">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options">\r\n	</div>\r\n	<h1 class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\r\n	<div class="listbox-wrapper">\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</div>\r\n'}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(qvangular,util,Deferred,Listbox,selectionToolbar,listboxPopoverComponent,ResponsiveState,desktopTemplate,smallDeviceTemplate){qvangular.service("qvListboxPopoverService",["$document",function($document){var $container,service,ctrl,$body=$document.find("body");return service={show:function(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback){var d=Deferred(),data={$alignToElement:options.$alignToElement,popupPosition:options.position||"bottom",collision:options.collision||"none",qvaOutsideIgnoreFor:options.qvaOutsideIgnoreFor,getVisualization:function(){return d.promise},model:model,onPopoverClose:this.onPopoverClose,options:{setController:d.resolve,isPopover:!0,showLock:options.showLock,search:options.search||{}},selectionToolbarComponent:selectionToolbar};return ctrl&&(ctrl.selectionsActivated=function(){},ctrl.selectionsDeactivated=function(){},ctrl.close()),$container=angular.element("<div>"),$body.append($container),listboxPopoverComponent.template=ResponsiveState.isSmallDevice?smallDeviceTemplate:desktopTemplate,ctrl=$container.showComponent(listboxPopoverComponent,data),ctrl.selectionsActivated=function(){util.isFunction(selectionsActivatedCallback)&&selectionsActivatedCallback()},ctrl.selectionsDeactivated=function(){util.isFunction(selectionsDeactivatedCallback)&&selectionsDeactivatedCallback(),selectionsDeactivatedCallback=null,selectionsActivatedCallback=null},ctrl},showField:function(field,app,options,initProps,selectionsDeactivatedCallback,selectionsActivatedCallback){return Listbox.createTransientField(app,field,initProps).then(function(model){return Deferred.resolve(this.show(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback))}.bind(this))},showDimension:function(id,app,options,initProps,selectionsDeactivatedCallback,selectionsActivatedCallback){Listbox.createTransientDimension(app,id,initProps).then(function(model){this.show(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback)}.bind(this))},close:function(){ctrl&&ctrl.close()},onPopoverClose:function(){}}}])}),define("widget.pager",["jquery","jqueryui"],function($){return $.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var opts=this.options;$.extend(this,{positionProperty:"horizontal"===opts.orientation?"left":"top",sizeProperty:"horizontal"===opts.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(opts.startPage)},isItemInsidePage:function(item){var me=$(item),itemPos=me.position()[this.positionProperty]+me[this.sizeProperty](),leftBoundary=Math.abs(parseFloat(me.parent().css("margin-"+this.positionProperty))),rightBoundary=leftBoundary+this.containerSize;return itemPos>leftBoundary&&rightBoundary>itemPos},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var oldCurrentPage=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(oldCurrentPage,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(pageNumber){this.currentPage=Math.min(Math.max(1,pageNumber),this.maxPages);var margin=(this.currentPage-1)*this.itemSize*this.pageSize,animateObj={};animateObj[this.positionProperty]=-margin+"px",this.element.stop(!0).animate(animateObj,this.options.animationDuration)},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(selector){var pageNumber=Math.ceil(this.element.find(selector).index()+1/this.pageSize);this.goToPage(pageNumber)},_destroy:function(){this.element.off(this.eventNamespace)}}),$}),define("general.components/pager/pager",["qvangular","core.utils/resize","widget.pager"],function(qvangular,resize){qvangular.directive("qvPager",["$timeout",function($timeout){return{restrict:"A",priority:0,link:function(scope,elem){function refreshPager(){scope.refreshPager()}"ontouchstart"in window&&elem.css("overflow-x","auto"),scope.pagerData=elem.find("ul").pager().data("qv-pager"),elem.addClass("qv-pager"),scope.nextPage=function(){$timeout(function(){scope.pagerData.goToNextPage(),scope.refreshPager(!0)})},scope.prevPage=function(){$timeout(function(){scope.pagerData.goToPreviousPage(),scope.refreshPager(!0)})},scope.goToPage=function(pageNo){scope.pagerData.goToPage(pageNo),scope.refreshPager(!0)},scope.refreshPager=function(onlyClasses){var classes="";onlyClasses||scope.pagerData.refresh(),elem.removeClass("qv-pager-back qv-pager-forward"),1!==scope.pagerData.currentPage?(scope.showShadow=!0,classes+="qv-pager-back "):scope.showShadow=!1,scope.pagerData.currentPage!==scope.pagerData.maxPages&&(classes+="qv-pager-forward "),elem.addClass(classes)},scope.$on("refreshPager",refreshPager),scope.$on("$destroy",function(){resize.off("end",refreshPager)})}}}])}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-class="{\'toolbar\': toolbar, \'selection-toolbar-open\': selectionToolbarOpen}">\r\n\r\n	<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields"></div>\r\n	</section>\r\n\r\n	<section class="qv-gs-section" tid="globalSelections.bottomSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.AppDimensions"></h2>\r\n			<qui-checkbox qui-model="showFields" qui-label="{{\'GlobalSelections.ShowFields\'|translate}}" qui-title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields"></qui-checkbox>\r\n			<qui-search-field class="qv-gs-searchfield" placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter" maxlength="255"\r\n							 tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></qui-search-field>\r\n		</header>\r\n\r\n		<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\r\n			<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\r\n		</div>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter"></div>\r\n	</section>\r\n</div>\r\n'}),define("text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="confirm-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<header ng-if="header" class="dm-header" q-translation="{{header}}"></header>\r\n	<main class="dm-main">\r\n		<div class="qv-mvc-dialog-content">\r\n			<div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\r\n			<p><span q-translation="{{text}}"></span></p>\r\n		</div>\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{$parent.confirmLabel}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function($){"use strict";var caches=[];return{preventTabbing:function(body){var cache={id:caches.length,elements:body.find(":tabbable")};caches.push(cache),cache.elements.each(function(){var element=$(this);element.data("tabbable-elements-tabindex",element.attr("tabindex"))}),cache.elements.attr("tabindex","-1")},restoreTabbing:function(){var cache=caches.pop();cache.elements.each(function(){var element=$(this),prev=element.data("tabbable-elements-tabindex");prev?element.attr("tabindex",prev):element.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(qvangular,tabbable,$){qvangular.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(scope,element){var before=element[0].nextSibling,parent=element[0].parentNode;parent.removeChild(element[0]),tabbable.preventTabbing($(document.body)),document.activeElement&&document.activeElement.blur(),parent.insertBefore(element[0],before),scope.$on("$destroy",function(){tabbable.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function($){function removeEventHandlerObjectsForJack(jackId){Object.keys(events).forEach(function(eventName){events[eventName]=events[eventName].filter(function(o){return o.jackId!==jackId})})}function dispatchEvents(eventName){var args=Array.prototype.slice.call(arguments,1);events[eventName].forEach(function(handlerObject){handlerObject.jackId===hijackIdStack[hijackIdStack.length-1]&&handlerObject.handler.apply(null,args)})}function registerHandler(jack,eventName,handler){events[eventName]||(body.on(eventName,dispatchEvents.bind(null,eventName)),events[eventName]=[]),events[eventName].push({jackId:jack.id,handler:handler})}var body,events={},hijackIdStack=[],proto={on:function(eventName,handler){registerHandler(this,eventName,handler)},release:function(){var jackId=this.id;removeEventHandlerObjectsForJack(jackId),hijackIdStack.splice(hijackIdStack.indexOf(jackId),1)}};return{hijack:function(){body||(body=$(document));var hijack=Object.create(proto,{id:{value:hijackIdStack.length}});return hijackIdStack.push(hijack.id),hijack}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(qvangular,KeyboardDispatcher){qvangular.directive("qvDialogEscape",["$parse",function($parse){return{restrict:"A",controller:["$scope",function(scope){var hijack=this.hijack=KeyboardDispatcher.hijack();scope.$on("$destroy",function(){hijack.release()})}],link:function(scope,elem,attr,controller){var fn=$parse(attr.qvDialogEscape);controller.hijack.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),setTimeout(function(){scope.$apply(function(){fn(scope,{$event:e})})}))})}}}])}),define("text!assets/client/dialogs/directives/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\r\n	<div id="{{id}}"\r\n		 class="modal-frame qui-delayedModal"\r\n		 ng-transclude></div>\r\n</div>\r\n'}),define("assets/client/dialogs/directives/modal-dialog",["qvangular","text!assets/client/dialogs/directives/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(qvangular,template,KeyboardDispatcher){qvangular.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:template,link:function(scope){var hijack=KeyboardDispatcher.hijack();scope.$on("$destroy",function(){hijack.release()}),hijack.on("keydown",function(e){if(27===e.keyCode&&(e.preventDefault(),setTimeout(function(){scope.$apply(function(){scope.cancel()})})),13===e.keyCode){if("TEXTAREA"===e.target.tagName)return;if("BUTTON"===e.target.tagName)return;setTimeout(function(){scope.$apply(function(){scope.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></qui-button>\r\n    <qui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button light qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></qui-button>\r\n    <qui-button light qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html","text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html"],function(qvangular,template,lightTemplate){qvangular.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel",cancelDisabled:"=qvCancelDisabled"},restrict:"E",replace:!0,template:function(jQuery,$attr){var isLight=$attr.hasOwnProperty("light");return isLight?lightTemplate:template}}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","assets/client/dialogs/directives/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/confirm-dialog/confirm-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(showService,template){function show(options){var text=options.text,icon=void 0!==options.icon?options.icon:"cogwheel",confirmLabel=options.confirm||"Common.OK",input={text:text,header:options.header,icon:icon,confirmLabel:confirmLabel};return showService.show(component,input).resultPromise}var component={template:template,scope:{text:"=",header:"=",icon:"=",confirmLabel:"="},controller:["$scope",function($scope){$scope.confirm=function(){$scope.destroyComponent(),$scope.deferredResult.resolve()},$scope.cancel=function(){$scope.destroyComponent(),$scope.deferredResult.reject()}}]};return{show:show}}),define("client.controllers/grid-controller",["core.utils/deferred","client.utils/state","general.utils/responsive-state","objects.models/visualization-object","general.utils/support"],function(Deferred,State,ResponsiveState,VisualizationObject,Support){"use strict";function createMatrix(cols,rows){for(var matrix=[],i=0;rows>i;i++){matrix[i]=[];for(var y=0;cols>y;y++)matrix[i][y]=1}return matrix}function updateMatrix(matrix,cell){var i,y,maxRow=cell.row+cell.rowspan,maxCol=cell.col+cell.colspan;for(i=cell.row;maxRow>i;i++)for(y=cell.col;maxCol>y;y++)matrix[i][y]=0}function alignCell(grid,cell){var rect=grid.rectFor(cell);return{width:"calc( "+rect.width+"% - "+2*rect.margin+"px )",height:"calc( "+rect.height+"% - "+2*rect.margin+"px )",left:"calc( "+rect.left+"% + "+rect.margin+"px )",top:"calc( "+rect.top+"% + "+rect.margin+"px )"}}function updateGridSize(grid,cols,rows){var inEdit=State.isInEditMode(),margin=inEdit?4:0,colTotal=100,rowTotal=100,colSize=colTotal/cols,rowSize=rowTotal/rows;grid.rectFor=function(pos){var width=pos.colspan*colSize,height=pos.rowspan*rowSize,left=pos.col*colSize,top=pos.row*rowSize;return{left:left,top:top,width:width,height:height,margin:margin}};var i,horizontalLines=[],verticalLines=[];for(i=0;cols-1>i;++i){var left=(i+1)*colSize;verticalLines.push({left:left+"%"})}for(i=0;rows-1>i;++i){var top=(i+1)*rowSize;horizontalLines.push({top:top+"%"})}grid.cols=cols,grid.rows=rows,grid.horizontalLines=horizontalLines,grid.verticalLines=verticalLines}function updateSheet(grid,layout){var newSheet=layout.qInfo.qId!==grid.lastSheetId,selectNewCells=!newSheet&&State.isInEditMode()&&!grid.zoomCell&&layout.permissions.update;grid.lastSheetId=layout.qInfo.qId,grid.hasUpdatePermission=layout.permissions.update,grid.isSheet=!0,grid.isMaster=!1,grid.sheetTitle=layout.qMeta&&layout.qMeta.title||"",grid.isDraft=layout.qMeta&&layout.qMeta.sourceObject&&layout.qMeta.sourceObject.length,grid.isDraftOwner=layout.qMeta&&layout.qMeta.draftObject&&layout.qMeta.draftObject.length,(newSheet||!grid.hasUpdatePermission)&&(grid.activeCell=null),newSheet&&(grid.cells=[]),updateCells(grid,layout.cells.slice(),selectNewCells)}function getNavMenu(grid,cell){return{active:!1,visible:!1,items:[{translation:"Visualization.Unlink",tid:"nav-menu-link",cssClasses:"icon-link",dynamicCssClasses:function(){var classes=[];return grid.zoomCell?classes.push("big"):classes.push("border","white"),classes.join(" ")},isVisible:function(){return(Support.treatAsDesktop()||grid.zoomCell)&&cell.object.isLink&&State.isInEditMode()},action:function(){cell.getVisualization().then(function(vis){var LinkObjectService=require("client.services/link-object-service");LinkObjectService.showBreakLinkDialog(vis.model)})}},{translation:"Tooltip.ExplorationMenu",tid:"nav-menu-explore",cssClasses:"icon-control",dynamicCssClasses:function(){var classes=[];return cell.object.showExploreMenu&&classes.push("active"),grid.zoomCell?classes.push("big"):classes.push("border","white"),cell.object.layout&&cell.object.layout.qHasSoftPatches&&classes.push("changed-state"),classes.join(" ")},isVisible:function(){return(Support.treatAsDesktop()||grid.zoomCell)&&cell.object.canShowExploreMenu()&&!State.isInEditMode()&&!grid.zooming},action:function(){grid.zoomCell?(cell.object.toggleExploreMenu(),cell.object.resize()):(grid.zoom(cell),cell.object.toggleExploreMenu(!0))}},{translation:"Tooltip.ZoomOut",tid:"nav-menu-zoom-out",cssClasses:"icon-cancel big",isVisible:function(){return grid.isSheet&&grid.zoomCell===cell&&!grid.zooming},action:function(){cell.navMenu.visible=!1,cell.object.showExploreMenu&&cell.object.toggleExploreMenu(!1),grid.zoom(null)}},{translation:"Tooltip.ZoomIn",tid:"nav-menu-zoom-in",cssClasses:"icon-zoom-in white border",isVisible:function(){return Support.treatAsDesktop()&&!grid.zoomCell&&!cell.object.isInvalid&&!grid.zooming},action:function(){grid.zoom(cell)}}]}}function findOldCell(id,oldcells){var i;if(!oldcells)return null;for(i=0;i<oldcells.length;++i)if(oldcells[i].id===id)return oldcells[i];return null}function updateCells(grid,cells,selectNewCells){function createEmptyCell(cell){updateMatrix(matrix,cell);var newCell={},pos={col:cell.col,row:cell.row,colspan:cell.colspan,rowspan:cell.rowspan};grid.setCellSize(newCell,pos),newCell.isEmpty=!0,newCell.navMenu={},result.push(newCell)}function createUsedCell(cell){updateMatrix(matrix,cell);var newCell=findOldCell(cell.name,grid.cells);if(!newCell){newCell={},newCell.id=cell.name;var d=Deferred();newCell.options={setController:d.resolve,id:cell.name,isVisible:!0,isZoomed:!1,isActive:!1,canSaveSoftProperties:grid.hasUpdatePermission&&!ResponsiveState.isSmallDevice},newCell.navMenu=getNavMenu(grid,newCell),VisualizationObject.get(cell.name).then(function(model){newCell.model=model,selectNewCells&&grid.toggleActive(newCell)}),newCell.getVisualization=function(){return d.promise}}var pos={col:cell.col,row:cell.row,colspan:cell.colspan,rowspan:cell.rowspan};grid.setCellSize(newCell,pos),newCell.isEmpty=!1,result.push(newCell)}function findOptimalRectangle(){function upadateStack(c,r,rSpan){for(var minC=c;sStack.length>0;){var top=sStack[sStack.length-1];if(top.rowSpan===rSpan)return;if(top.rowSpan<rSpan)break;sStack.pop(),minC=top.col;var cSpan=c-top.col,area=top.rowSpan*cSpan;area>sArea&&(sArea=area,sRect={col:top.col,row:r,colspan:cSpan,rowspan:top.rowSpan})}rSpan>0&&sStack.push({col:minC,rowSpan:rSpan})}for(var r,consecutive,sStack,sArea,sRect,c=cols,m=[];c--;)for(consecutive=0,r=rows,m[c]=[];r--;)matrix[r][c]?m[c][r]=++consecutive:(consecutive=0,m[c][r]=null);for(sRect=null,sArea=0,sStack=[],r=0;rows>r;++r){for(c=0;cols>c;++c)null!==m[c][r]?upadateStack(c,r,m[c][r]):upadateStack(c,r,0);upadateStack(c,r,0)}return sRect}function createEmptyCells(){for(var cell,i=1;;){if(cell=findOptimalRectangle(),!cell)break;cell.priority=i++,cells.push(cell),createEmptyCell(cell)}}function sortList(list){list.sort(function(a,b){return a=a.pos,b=b.pos,a.row-b.row}).sort(function(a,b){return a=a.pos,b=b.pos,a.row===b.row?a.col-b.col:a.row-b.row})}var cols=grid.cols,rows=grid.rows,result=[],matrix=createMatrix(cols,rows);cells.forEach(createUsedCell),sortList(result),createEmptyCells(),grid.cells=result}function Grid(gridService){this.gridService=gridService}return Grid.prototype.setCellSize=function(cell,pos){cell.pos=pos,cell.style=alignCell(this,pos)},Grid.prototype.updateActiveCell=function(){function cap_expand(dir,span){span>=0&&expand_count[dir]>span&&(expand_count[dir]=span)}function addResize(dir,span){0===expand_count[dir]&&1>=span||resize.push({dir:dir,expand:expand_count[dir],contract:span-1})}var grid=this;if(grid.activeCell&&State.isInEditMode()){for(var active_pos=grid.activeCell.pos,active_left=active_pos.col,active_right=active_left+active_pos.colspan,active_top=active_pos.row,active_bottom=active_top+active_pos.rowspan,expand_count={left:active_left,right:grid.cols-active_right,top:active_top,bottom:grid.rows-active_bottom},i=0;i<grid.cells.length;++i)if(grid.cells[i]!==grid.activeCell&&!grid.cells[i].isEmpty){var left=grid.cells[i].pos.col,right=left+grid.cells[i].pos.colspan,top=grid.cells[i].pos.row,bottom=top+grid.cells[i].pos.rowspan;active_bottom>top&&bottom>active_top&&(cap_expand("left",active_left-right),cap_expand("right",left-active_right)),active_right>left&&right>active_left&&(cap_expand("top",active_top-bottom),cap_expand("bottom",top-active_bottom))}var resize=[];addResize("left",active_pos.colspan),
addResize("right",active_pos.colspan),addResize("top",active_pos.rowspan),addResize("bottom",active_pos.rowspan),grid.activeCell.resize=resize,grid.activeCell.updating=!1}},Grid.prototype.removeResizeHandles=function(){var grid=this;grid.activeCell&&delete grid.activeCell.resize},Grid.prototype.clearActiveCell=function(){var grid=this;grid.removeResizeHandles(),grid.activeCell=null},Grid.prototype.toggleActive=function(cell){var grid=this;State.isInEditMode()&&(!cell||grid.zoomCell||cell.isEmpty?grid.clearActiveCell():(grid.clearActiveCell(),grid.hasUpdatePermission&&(grid.activeCell=cell),grid.updateActiveCell()))},Grid.prototype.setEditMaster=function(masterId,type){var grid=this,cells=[{name:masterId,type:type,col:0,row:0,colspan:1,rowspan:1}];grid.lastSheetId=null,grid.isSheet=!1,grid.isMaster=!0,updateGridSize(grid,1,1),grid.activeCell=null,updateCells(grid,cells,!1),grid.zoom(grid.cells[0])},Grid.prototype.update=function(layout){if(layout){var grid=this;grid.layout=layout,updateGridSize(grid,layout.columns||12,layout.rows||7),updateSheet(grid,layout),grid.activeCell&&-1===grid.cells.indexOf(grid.activeCell)&&grid.clearActiveCell(),grid.zoomCell&&-1===grid.cells.indexOf(grid.zoomCell)&&(grid.zoomCell=null),grid.updateActiveCell()}},Grid.prototype.zoom=function(cell){var grid=this;grid.cells&&(grid.cells.forEach(function(c){c.options&&(c.options.isVisible=c===cell||!cell,c.options.isZoomed=c===cell&&!!cell)}),cell?(grid.clearActiveCell(),grid.zoomCell=cell,grid.gridService.saveScrollState(),cell.object&&(cell.object.expanded=!!cell)):grid.zoomCell&&(grid.zoomCell.object&&(grid.zoomCell.object.expanded=!1),grid.clearActiveCell(),grid.hasUpdatePermission&&(grid.activeCell=grid.zoomCell),grid.zoomCell=null,grid.updateActiveCell(),grid.gridService.restoreScrollState()))},Grid.prototype.exploreMenu=function(cell,display){cell&&cell.object&&cell.object.hasSoftProperties&&cell.object.toggleExploreMenu(display)},Grid.prototype.getOptimalCell=function(){var grid=this,items=grid.cells.slice();items.sort(function(a,b){if(a.isEmpty&&!b.isEmpty)return-1;if(b.isEmpty&&!a.isEmpty)return 1;var a_dim=a.pos.colspan*a.pos.rowspan,b_dim=b.pos.colspan*b.pos.rowspan;return a_dim>b_dim?-1:b_dim>a_dim?1:0});var optimalCell=items[0]||null;if(optimalCell&&!optimalCell.isEmpty)if(optimalCell.pos.colspan>1||optimalCell.pos.rowspan>1){var direction=optimalCell.pos.colspan>optimalCell.pos.rowspan?"right":"bottom";optimalCell={isEmpty:!0,pos:{pos:optimalCell.pos,split:direction}}}else optimalCell=null;return optimalCell},Grid}),define("client.services/grid-service",["qvangular","core.models/rpc-base","client.controllers/grid-controller","client.utils/state","jquery","general.services/delayed-modal/delayed-modal"],function(qvangular,RPCBase,Grid,State,$){"use strict";function gridFullMessage(){var dialog=qvangular.getService("$delayedModal"),options=$.extend(!0,{},{},{title:"Ui.Warning.GridFull.Title",content:"Ui.Warning.GridFull"});dialog.open(options)}function setState(view,zoom){State.setView(view);var body=$(document.body);body.toggleClass("qv-view-sheet",!zoom),body.toggleClass("qv-view-object",zoom),body.toggleClass("qv-gridzoom",zoom)}function start(model){var isEdit;$scope||($scope=qvangular.$rootScope.$new(!0),$scope.grid=new Grid(this),$scope.model=model,RPCBase.bindLayout($scope,"model",function(layout){$scope.grid.update(layout)}),$scope.$watch(State.isInEditMode,function(isInEdit){isEdit=isInEdit,$scope.grid.update($scope.grid.layout),isEdit?$scope.grid.updateActiveCell():($scope.grid.removeResizeHandles(),closeEditMaster())}),$scope.$watch("grid.zoomCell",function(zoom){if(!(isEditMaster()||State.view===State.Views.story&&State.state!==State.States.analysis)){var view=zoom?State.Views.object:State.Views.sheet;setState(view,!!zoom)}}),State.SheetChanged.bind(setSheet))}function setSheet(sheet){$scope&&($scope.model=sheet)}function stop(){$scope&&($scope.$destroy(),$scope=null,State.SheetChanged.unbind(setSheet),$interval.cancel(gridState.intervalPromise),gridState.gridElement=null)}function getOptimalCell(){var cell=$scope&&$scope.grid.getOptimalCell();return cell||gridFullMessage(),cell}function removeCell(cell){$scope&&$scope.model.removeObject(cell.pos)}function isEditMaster(){return $scope&&$scope.grid&&!$scope.model}function closeEditMaster(){isEditMaster()&&(setSheet(State.model),setState(State.Views.sheet,!1))}function editMaster(masterId,type){$scope&&($scope.model=null,$scope.grid.setEditMaster(masterId,type),setState(State.Views.masterObject,!0))}var $scope=null,$timeout=qvangular.getService("$timeout"),$interval=qvangular.getService("$interval"),gridState={gridElement:null,scrollTop:0,scrollLeft:0,lastZoomedCell:null,intervalPromise:null};return{start:start,stop:stop,goToEditMode:function(){State.setState(State.States.edit)},getOptimalCell:getOptimalCell,removeCell:removeCell,isActive:function(){return!!$scope},getGrid:function(){return $scope&&$scope.grid},getModel:function(){return $scope&&$scope.model},getActiveCell:function(){return $scope&&($scope.grid.activeCell||$scope.grid.zoomCell)},activateCell:function(cell){$scope&&$scope.grid.toggleActive(cell)},deactivateCell:function(){$scope&&$scope.grid.toggleActive(null)},getZoomCell:function(){return $scope&&$scope.grid.zoomCell},getZoomedCellId:function(){return $scope.grid.zoomCell.id},zoomInOnCell:function(id){var array;$scope&&(array=$scope.grid.cells.filter(function(item){return item.id===id}),array.length&&$scope.grid.zoom(array[0]))},zoomOut:function(){$scope&&$scope.grid.zoom(null)},saveZoom:function(){!gridState.lastZoomedCell&&$scope.grid.zoomCell&&$scope.grid.zoomCell.id&&(gridState.lastZoomedCell=$scope.grid.zoomCell.id)},restoreZoom:function(){gridState.lastZoomedCell&&$timeout(function(){$scope.grid.blockZoomAnimation=!0,this.zoomInOnCell(gridState.lastZoomedCell),gridState.lastZoomedCell=null}.bind(this))},setGridElement:function(elem){gridState.gridElement=elem},saveScrollState:function(){!gridState.lastZoomedCell&&gridState.gridElement&&(gridState.scrollTop=gridState.gridElement.scrollTop,gridState.scrollLeft=gridState.gridElement.scrollLeft)},restoreScrollState:function(){gridState.lastZoomedCell||(gridState.scrollTop>0&&(gridState.intervalPromise=$interval(function(){gridState.gridElement.children.length>0&&(gridState.gridElement.scrollTop=gridState.scrollTop,gridState.scrollTop=0,$interval.cancel(gridState.intervalPromise))},50)),gridState.scrollLeft>0&&(gridState.intervalPromise=$interval(function(){gridState.gridElement.children.length>0&&(gridState.gridElement.scrollLeft=gridState.scrollLeft,gridState.scrollLeft=0,$interval.cancel(gridState.intervalPromise))},50)))},isEditMaster:isEditMaster,closeEditMaster:closeEditMaster,editMaster:editMaster}}),define("client.assets/assets-utils",["jquery","util","assets/client/dialogs/confirm-dialog/confirm-dialog","pubsub","client.utils/state","client.services/grid-service"],function($,util,ConfirmDialog,pubsub,state,GridService){function actOnDialog(dialogInput,action){ConfirmDialog.show({text:dialogInput}).then(action)}function permissionToCreate(type){if(!permissions)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(type){case"measure":return permissions.createMeasure;case"dimension":return permissions.createDimension;case"visualization":return permissions.createMasterobject;default:throw new TypeError("'"+type+"' is an unknown type.")}}var permissions,utils={init:function(appPermissions){appPermissions&&(permissions=$.extend({},appPermissions))},getContextMenuAddToText:function(){var active=GridService.getActiveCell();return active?"contextMenu.addToVisualization":"contextMenu.addToSheet"},getAddToOptions:function(){var active=GridService.getActiveCell(),options=null;return state.isInEditMode()&&(options={},active?options.object=!0:options.sheet=!0),options},getAddToText:function(){var active=GridService.getActiveCell();return state.isInEditMode()?active?"library.addtoVisualization":"library.addtosheet":null},addItemToSheetOrVisualization:function(item){if(this.isAddToMode()){var active=GridService.getActiveCell(),data={item:item};active&&(data.cell=active),pubsub.publish("/ui/library/addToSheet",data)}},librarySearchFn:function(item,query,matchName){return query&&""!==query?(matchName=matchName?matchName:function(matchItem,matchQuery){return util.match([matchItem.name],matchQuery)})(item,query.toLowerCase()):!0},libraryMultiSearch:function(item,query,matchOn){if(item.match={},!query||""===query)return!0;query=query.toLowerCase();for(var match=!1,i=0;i<matchOn.length;++i){var name=matchOn[i];util.match(item[name],query)&&(match=!0,item.match[name]=!0)}return match},itemDblClickHandler:function(item){this.isAddToSheetMode()&&pubsub.publish("/ui/library/addToSheet",{item:item})},removeDialog:actOnDialog,editDialog:actOnDialog,hasLinks:function(id,Type){return Type.get(id).then(function(master){return master.getLinkedObjects().then(function(linkedObjects){return 0!==linkedObjects.length})})},toggleSelection:function(item,event){var itemElement=$(event.currentTarget);return item.selected=!item.selected,item.selected?(itemElement.on("qv-outside",function(e){var element=$(e.target);1!==element.closest("#library-preview").length&&1!==element.closest(".qv-contextmenu").length&&(item.selected=!1,itemElement.off("qv-outside"))}),!0):(itemElement.off("qv-outside"),!1)},removeSelection:function(items){$.each(items,function(index,item){item.selected=!1})},localeOrderBy:function(input,fn){if(input){var sortFn=function(a,b){return a.localeCompare(b)};fn&&fn instanceof Function&&(sortFn=function(a,b){return fn(a).localeCompare(fn(b))}),input.sort(sortFn)}return input},isAddToSheetMode:function(){return state.isInEditMode()&&state.view===state.Views.sheet&&state.model.layout.permissions.update},isAddToVisualizationMode:function(){return state.isInEditMode()&&(state.view===state.Views.object&&state.model.layout.permissions.update||state.view===state.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},permissionToCreate:permissionToCreate};return utils}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-container">\r\n	<qv-scroll-area class="qv-gs-scroll-area">\r\n		<div ng-if="scrollApi.loadPrevious" class="qv-gs-scroll-btn qv-gs-scroll-btn-previous" tid="globalSelections.loadPrevious">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\r\n		</div>\r\n		<div ng-repeat="item in items" class="qv-gs-listbox">\r\n			<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator">-</p>\r\n			<qv-gs-badge></qv-gs-badge>\r\n			<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox" id="{{item.id}}"></qv-object>\r\n			<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder" id="{{item.id}}">\r\n				<h1 class="qv-object-title">{{item.title}}</h1>\r\n				<div class="progress">\r\n					<qv-rain></qv-rain>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div ng-if="scrollApi.loadNext" class="qv-gs-scroll-btn" tid="globalSelections.loadNext">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n		</div>\r\n	</qv-scroll-area>\r\n	<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n</div>\r\n'}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(Class,Touche){"use strict";function getNamespace(){return".grid-object-dom-api-"+ ++i}var GridObjectDOMApi,i=0;return GridObjectDOMApi=Class.extend({init:function($element,$scrollArea,rowSelector,firstRowSelector,lastRowSelector,scrollContentSelector){scrollContentSelector=scrollContentSelector||".scroll-content",this.$element=$element,this.$scrollArea=$scrollArea,this.$scrollContent=$scrollArea.find(scrollContentSelector),this.rowSelector=rowSelector,this.firstRowSelector=firstRowSelector,this.lastRowSelector=lastRowSelector,this.namespace=getNamespace()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(fn){this.$scrollArea.on("scroll"+this.namespace,fn)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var events="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(events,function(e){e.preventDefault()}),Touche(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(events),Touche(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},getVisibleRowCount:function(maxRowHeight){function isRowVisible(row,scrollAreaRect){var rowRect=row.getBoundingClientRect();return Math.round(rowRect.bottom-scrollAreaRect.bottom)<1}function getMidIx(minIx,maxIx){var range=maxIx-minIx;return 1===range?maxIx:Math.floor(minIx+range/2)}function findLastVisibleIx(rows,minIx,maxIx,scrollAreaRect){var range=maxIx-minIx,midIx=getMidIx(minIx,maxIx),visible=isRowVisible(rows[midIx],scrollAreaRect);return 0===range?visible?midIx:-1:1===range?visible?midIx:findLastVisibleIx(rows,minIx,minIx,scrollAreaRect):visible?findLastVisibleIx(rows,midIx,maxIx,scrollAreaRect):findLastVisibleIx(rows,minIx,midIx,scrollAreaRect)}var rows=this.$element[0].querySelectorAll(this.rowSelector);if(0===rows.length)return 0;if(rows=Array.prototype.slice.call(rows),rows=rows.filter(function(node){return node.nodeType===Node.ELEMENT_NODE}),0===rows.length)return 0;var scrollAreaRect=this.getScrollAreaBoundingBox(),visibleCount=findLastVisibleIx(rows,0,rows.length-1,scrollAreaRect)+1;if(visibleCount===rows.length){var row=rows[rows.length-1],rowRect=row.getBoundingClientRect(),extraPx=Math.round(scrollAreaRect.bottom-rowRect.bottom);visibleCount+=Math.floor(extraPx/maxRowHeight)}return visibleCount},alignToFirstRow:function(){var $alignToRow=this.getFirstRow(),loadButtonHeight=48;return function(){var scrollTop=$alignToRow.position().top-loadButtonHeight;this.$scrollArea.scrollTop(scrollTop)}.bind(this)},alignToLastRow:function(){var $alignToRow=this.getLastRow(),loadButtonHeight=48;return function(){this.$scrollArea.scrollTop(0);var scrollTop=$alignToRow.position().top-this.getScrollAreaBoundingBox().height+$alignToRow[0].getBoundingClientRect().height+loadButtonHeight;this.$scrollArea.scrollTop(scrollTop)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(Deferred,Class){"use strict";var ScrollDataApi;return ScrollDataApi=Class.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(row){return row.getIndex()},onVirtualScroll:function(){return Deferred.resolve()},onGotoNextBlock:function(){return Deferred.resolve()},onGotoPreviousBlock:function(){return Deferred.resolve()},onInitialNativeScroll:function(){return Deferred.resolve()}})}),define("general.scroll/scroll-area-service",["qvangular"],function(qvangular){"use strict";qvangular.service("qvScrollAreaService",function(){return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(data){var deltaX=0,deltaY=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":deltaY=data.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":deltaX=data.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[deltaX,deltaY]},active:!1}},setScrollbarData:function(scrollbar,direction,trackSize,vSize,vViewportSize,viewportRect){var eSize,uiOffset=3;switch(direction){case"vertical":eSize=viewportRect.height;break;case"horizontal":eSize=viewportRect.width;break;default:throw"not implemented"}if(scrollbar.enabled=vSize>vViewportSize&&eSize>0,scrollbar.enabled)switch(eSize-=2*uiOffset,scrollbar.uiOffset=uiOffset,scrollbar.direction=direction,scrollbar.vLength=vSize,scrollbar.vViewportLength=vViewportSize,scrollbar.vPos=0,scrollbar.vPage=eSize,scrollbar.length=eSize,scrollbar.trackSize=trackSize,scrollbar.scaleFactor=eSize/vSize,scrollbar.thumb.pos=0,scrollbar.thumb.size=0,scrollbar.thumb.vPos=0,scrollbar.showMinAffordance=!1,scrollbar.showMaxAffordance=!0,scrollbar.direction){case"vertical":scrollbar.style.top=viewportRect.top+scrollbar.uiOffset+"px",scrollbar.style.width=trackSize+"px",scrollbar.style.left=viewportRect.left+viewportRect.width-trackSize-scrollbar.uiOffset+"px",scrollbar.style.height=viewportRect.height-2*scrollbar.uiOffset+"px";break;case"horizontal":scrollbar.style.height=trackSize+"px",scrollbar.style.top=viewportRect.top+viewportRect.height-trackSize-scrollbar.uiOffset+"px",scrollbar.style.left=viewportRect.left+scrollbar.uiOffset+"px",scrollbar.style.width=viewportRect.width-2*scrollbar.uiOffset+"px";break;default:throw"not implemented"}},setVirtualScrollPos:function(delta,scrollbar,isSwiping){var minPos=0,maxPos=scrollbar.vLength-scrollbar.vViewportLength,scrollAmount=0,virtualThumbPos=scrollbar.thumb.vPos;return scrollbar.enabled?(scrollbar.vPos+=delta,scrollbar.showMinAffordance=!1,scrollbar.showMaxAffordance=!1,scrollbar.vPos<minPos?(virtualThumbPos=minPos,scrollbar.vPos=isSwiping?scrollbar.vPos:minPos,scrollbar.showMaxAffordance=!0):scrollbar.vPos>maxPos?(virtualThumbPos=maxPos,scrollbar.vPos=isSwiping?scrollbar.vPos:maxPos,scrollbar.showMinAffordance=!0):(scrollbar.vPos!==minPos&&(scrollbar.showMinAffordance=!0),scrollbar.vPos!==maxPos&&(scrollbar.showMaxAffordance=!0),virtualThumbPos=scrollbar.vPos),scrollAmount=virtualThumbPos-scrollbar.thumb.vPos,scrollbar.thumb.vPos=virtualThumbPos,scrollAmount):0},setThumbStyle:function(thumbStyle,scrollbar){var thumb=scrollbar.thumb,minSize=12,scaleFactor=scrollbar.scaleFactor,thumbPos=Math.round(thumb.vPos*scaleFactor),thumbSize=Math.round(scrollbar.vViewportLength*scaleFactor);switch(minSize>thumbSize&&(thumbPos-=Math.round((minSize-thumbSize)/2),thumbSize=minSize),thumbPos=Math.max(thumbPos,0),thumbPos+thumbSize>scrollbar.length&&(thumbPos=scrollbar.length-thumbSize),thumb.size=thumbSize,thumb.pos=thumbPos,scrollbar.direction){case"vertical":thumbStyle.top=thumbPos+"px",thumbStyle.height=thumbSize+"px";break;case"horizontal":thumbStyle.left=thumbPos+"px",thumbStyle.width=thumbSize+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(trackHitAreaStyle,scrollbar,trackSize){"vertical"===scrollbar.direction?(trackHitAreaStyle.right=-scrollbar.uiOffset+"px",trackHitAreaStyle.width=trackSize+scrollbar.uiOffset+"px"):(trackHitAreaStyle.bottom=-scrollbar.uiOffset+"px",trackHitAreaStyle.height=trackSize+scrollbar.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["general.utils/support","general.scroll/scroll-area-service"],function(support){"use strict";var ScrollAreaController=["$scope","$element","$timeout","qvScrollAreaService",function($scope,$element,$timeout,scrollAreaService){var scrollbarXCtrl,scrollbarYCtrl,fadeTimeoutId,delayTimeoutId,scrollCallbacks=[],scrollStartCallbacks=[],scrollEndCallbacks=[];$scope.interactive=!1,$scope.virtualSize={width:0,height:0},$scope.virtualViewport={width:0,height:0},$scope.scrollbarX=scrollAreaService.createScrollbar(),$scope.scrollbarY=scrollAreaService.createScrollbar(),$scope.viewportRect={top:0,left:0,width:0,height:0},$scope.hover=!1,$scope.isMouse=!0,$scope.$on("$destroy",function(){clearTimeout(fadeTimeoutId),clearTimeout(delayTimeoutId)}),this.setMouse=function(isMouse){$scope.isMouse=isMouse},this.getScrollAreaRect=function(){var rect=$element[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(rect.width),height:Math.ceil(rect.height)}},this.addScrollbarXCtrl=function(scrollbarCtrl){scrollbarXCtrl=scrollbarCtrl},this.addScrollbarYCtrl=function(scrollbarCtrl){scrollbarYCtrl=scrollbarCtrl},this.allowFade=function(){return(void 0===scrollbarXCtrl||scrollbarXCtrl.allowFade())&&(void 0===scrollbarYCtrl||scrollbarYCtrl.allowFade())},this.toggleFadeScrollbars=function(show){clearTimeout(delayTimeoutId),clearTimeout(fadeTimeoutId),(show||this.allowFade())&&(fadeTimeoutId=setTimeout(function(){var key=show?"fadeIn":"fadeOut";scrollbarXCtrl&&scrollbarXCtrl[key](),scrollbarYCtrl&&scrollbarYCtrl[key]()},show?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(){support.treatAsDesktop()&&$scope.hover||this.toggleFadeScrollbars(!1)},this.fadeOutScrollbarsDelayed=function(){clearTimeout(delayTimeoutId),delayTimeoutId=setTimeout(function(){this.toggleFadeScrollbars(!1)}.bind(this),1e3)},this.setNonMouseTrackSize=function(){"object"==typeof $scope.nonMouseViewportScrolling&&($element.addClass($scope.nonMouseViewportScrolling.className),this.setTrackSize($scope.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof $scope.nonMouseViewportScrolling&&$element.removeClass($scope.nonMouseViewportScrolling.className),this.setTrackSize($scope.scrollbarSize)},this.setTrackSize=function(trackSize){var vPos=this.getVirtualPosition();this.setVirtualSize($scope.virtualSize,$scope.virtualViewport,$scope.viewportRect,trackSize),this.setVirtualScrollPos(vPos.vPosX,vPos.vPosY)},this.setupScrollbars=function(trackSize){trackSize=trackSize||8,scrollAreaService.setScrollbarData($scope.scrollbarY,"vertical",trackSize,$scope.virtualSize.height,$scope.virtualViewport.height,$scope.viewportRect),scrollAreaService.setScrollbarData($scope.scrollbarX,"horizontal",trackSize,$scope.virtualSize.width,$scope.virtualViewport.width,$scope.viewportRect),$scope.scrollbarX.enabled&&$scope.scrollbarY.enabled&&($scope.scrollbarX.length-=trackSize,$scope.scrollbarX.scaleFactor=$scope.scrollbarX.length/$scope.virtualSize.width,$scope.scrollbarX.style.width=$scope.viewportRect.width-trackSize-2*$scope.scrollbarX.uiOffset+"px",$scope.scrollbarY.length-=trackSize,$scope.scrollbarY.scaleFactor=$scope.scrollbarY.length/$scope.virtualSize.height,$scope.scrollbarY.style.height=$scope.viewportRect.height-trackSize-2*$scope.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(virtualSize,virtualViewport,viewportRect,trackSize){$scope.viewportRect=viewportRect,$scope.virtualSize.width=virtualSize.width,$scope.virtualSize.height=virtualSize.height,$scope.virtualViewport.width=virtualViewport.width,$scope.virtualViewport.height=virtualViewport.height,this.setupScrollbars(trackSize)},this.setViewport=function(viewportRect){$scope.viewportRect=viewportRect},this.setVirtualViewport=function(virtualViewport){var vPos=this.getVirtualPosition();$scope.virtualViewport.width=virtualViewport.width,$scope.virtualViewport.height=virtualViewport.height,$scope.scrollbarX.vViewportLength=virtualViewport.width,$scope.scrollbarY.vViewportLength=virtualViewport.height,this.setupScrollbars($scope.isMouse?$scope.scrollbarSize:$scope.nonMouseViewportScrolling.scrollbarSize),this.setVirtualScrollPos(vPos.vPosX,vPos.vPosY)},this.getVirtualSize=function(){return{width:$scope.virtualSize.width,height:$scope.virtualSize.height}},this.getVirtualPosition=function(){var minPos=0,maxPos=this.getMaxPosition();return{vPosX:Math.max(minPos,Math.min(maxPos.vPosX,$scope.scrollbarX.vPos)),vPosY:Math.max(minPos,Math.min(maxPos.vPosY,$scope.scrollbarY.vPos))}},this.getMaxPosition=function(){var minPos=0,maxPosX=Math.max(minPos,$scope.scrollbarX.vLength-$scope.scrollbarX.vViewportLength),maxPosY=Math.max(minPos,$scope.scrollbarY.vLength-$scope.scrollbarY.vViewportLength);return{vPosX:maxPosX,vPosY:maxPosY}},this.isMouseOver=function(){return $scope.hover},this.resetScroll=function(){void 0!==$scope.scrollbarX.vPos&&void 0!==$scope.scrollbarY.vPos&&(0!==$scope.scrollbarX.vPos||0!==$scope.scrollbarY.vPos)&&this.scroll(-$scope.scrollbarX.vPos,-$scope.scrollbarY.vPos,!0,!1)},this.setVirtualScrollPos=function(deltaX,deltaY,isSwiping){scrollAreaService.setVirtualScrollPos(deltaX,$scope.scrollbarX,isSwiping),scrollAreaService.setVirtualScrollPos(deltaY,$scope.scrollbarY,isSwiping)},this.scroll=function(deltaX,deltaY,reset,isSwiping){var scrolledX,scrolledY;scrolledX=scrollAreaService.setVirtualScrollPos(deltaX,$scope.scrollbarX,isSwiping),scrolledY=scrollAreaService.setVirtualScrollPos(deltaY,$scope.scrollbarY,isSwiping),(0!==scrolledX||0!==scrolledY||reset)&&scrollCallbacks.forEach(function(callback){callback(scrolledX,scrolledY)})},this.getScrollAmount=function(deltaX,deltaY,deltaMode){switch(deltaMode){default:return{deltaX:deltaX,deltaY:deltaY}}},this.scrollStart=function(){scrollStartCallbacks.forEach(function(callback){callback()})},this.scrollEnd=function(){scrollEndCallbacks.forEach(function(callback){callback()})},this.onScroll=function(callback){scrollCallbacks.push(callback)},this.onScrollStart=function(callback){scrollStartCallbacks.push(callback)},this.onScrollEnd=function(callback){scrollEndCallbacks.push(callback)},this.on=function(){$scope.off=$scope.on(),$scope.interactive=!0},this.off=function(){$scope.off&&($scope.off(),$scope.interactive=!1)},this.isVerticalScrollEnabled=function(){return $scope.scrollbarY.enabled},this.digest=function(){$scope.$parent.$digest()}}];return ScrollAreaController}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(qvangular,Deferred){"use strict";qvangular.directive("qvScrollLoader",["$animate","$timeout",function($animate,$timeout){return{restrict:"E",replace:!0,template:function($element,$attrs){var tag=$attrs.tag||"div";return"<"+tag+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+tag+">"},scope:{},controller:function(){},link:function($scope,$element,$attrs,ctrl){function update(top,bbox){$scope.loaderStyle.top=top,$scope.loaderStyle.width=bbox.width,$scope.loaderStyle.height=bbox.height}var rainTimeoutPromise,noRain=!!$attrs.noRain;$scope.loaderStyle={width:0,height:0},$scope.showRain=!1,ctrl.fadeIn=function(top,bbox){var defer=Deferred();return update(top,bbox),noRain||(rainTimeoutPromise=$timeout(function(){$scope.showRain=!0})),$animate.addClass($element,"fade",function(){defer.resolve()}),defer.promise},ctrl.fadeOut=function(){var defer=Deferred();return $scope.showRain=!1,$animate.removeClass($element,"fade",function(){$scope.loaderStyle.width=0,$scope.loaderStyle.height=0,$scope.$digest(),defer.resolve()}),defer.promise},$scope.$on("$destroy",function(){$timeout.cancel(rainTimeoutPromise)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\r\n	<div ng-transclude></div>\r\n	<button class="qui-outlinebutton" qva-activate="load()">\r\n		<p q-translation="{{text}}"></p>\r\n	</button>\r\n</div>'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html"],function(qvangular,loadButtonTemplate){"use strict";qvangular.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function($element,$attrs){var tag=$attrs.tag||"div";return loadButtonTemplate.replace(/^\s*<div/,"<"+tag).replace(/<\/div>\s*$/,"</"+tag+">")},scope:{onLoad:"&",text:"@",previous:"="},link:function($scope){$scope.load=function(){$scope.onLoad()}}}}])}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div>\r\n	<div class="scroll-content" ng-transclude></div>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scrollbar x-data="scrollbarY" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\r\n	<qv-scrollbar x-data="scrollbarX" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n</div>\r\n'}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track"\r\n	ng-class="data.classList"\r\n	ng-style="data.style">\r\n	<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\r\n	<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\r\n</div>\r\n'}),define("general.scroll/mouse-wheel-service",["qvangular"],function(qvangular){"use strict";var support="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";qvangular.service("qvMouseWheelService",function(){return{getEventName:function(){return support},getMouseWheelData:function(orgEvent){var deltaMode=1,delta=0,deltaX=0,deltaY=0,divider=40;return"wheel"===support?orgEvent:("MozMousePixelScroll"===orgEvent.type&&(deltaMode=0),orgEvent.wheelDelta&&(delta=-orgEvent.wheelDelta/divider),orgEvent.detail&&(delta=-orgEvent.detail/3),deltaY=delta,void 0!==orgEvent.axis&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaY=0,deltaX=-1*delta),void 0!==orgEvent.wheelDeltaY&&(deltaY=-1*orgEvent.wheelDeltaY/divider),void 0!==orgEvent.wheelDeltaX&&(deltaX=-1*orgEvent.wheelDeltaX/divider),{deltaMode:deltaMode,delta:delta,deltaX:deltaX,deltaY:deltaY,x:orgEvent.pageX,y:orgEvent.pageY})}}})}),define("general.scroll/scroll-area-affordance",["qvangular"],function(qvangular){"use strict";qvangular.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function($scope){$scope.size=$scope.size||18,$scope.style={},$scope.updateAffordance=function(){switch($scope.direction){case"vertical":switch($scope.style.width=$scope.viewportRect.width+"px",$scope.style.height=$scope.size+"px",$scope.dock){case"min":$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+"px";break;case"max":$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+$scope.viewportRect.height-$scope.size+"px";break;default:throw"Dock "+$scope.dock+" not supported"}break;case"horizontal":switch($scope.style.width=$scope.size+"px",$scope.style.height=$scope.viewportRect.height+"px",$scope.dock){case"min":
$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+"px";break;case"max":$scope.style.left=$scope.viewportRect.left+$scope.viewportRect.width-$scope.size+"px",$scope.style.top=$scope.viewportRect.top+"px";break;default:throw"Dock "+$scope.dock+" not supported"}break;default:throw"Direction "+$scope.direction+" not supported"}},$scope.$watch("viewportRect",$scope.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/mouse-wheel-service","general.scroll/scroll-area-affordance"],function($,qvangular,ScrollAreaController,scrollAreaTemplate,scrollbarTemplate,Touche,support){"use strict";qvangular.directive("qvScrollArea",["$document","$timeout","qvScrollAreaService","qvMouseWheelService",function($document,$timeout,scrollAreaService,mouseWheelService){return{restrict:"E",transclude:!0,template:scrollAreaTemplate,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?"},require:"qvScrollArea",controller:ScrollAreaController,link:function($scope,$element,$attrs,ctrl){function insideViewport(x,y){var left=$scope.viewportRect.left,top=$scope.viewportRect.top,right=$scope.viewportRect.left+$scope.viewportRect.width,bottom=$scope.viewportRect.top+$scope.viewportRect.height;return x>=left&&right>=x&&y>=top&&bottom>=y}function off(){$element.off($scope.namespace),$document.off($scope.namespace),Touche($element[0]).off("*",$scope.namespace)}"number"!=typeof $scope.scrollbarSize&&($scope.scrollbarSize=8),$scope.$watch("scrollbarX.enabled",function(enabled){enabled===!0&&$element.css("overflow-x","hidden")}),$scope.$watch("scrollbarY.enabled",function(enabled){enabled===!0&&$element.css("overflow-y","hidden")}),$scope.namespace=".scroll-area-"+$scope.$id,$scope.on=function(){return $element.on(mouseWheelService.getEventName()+$scope.namespace,function(e){var scrollAmount,wheelData=mouseWheelService.getMouseWheelData(e.originalEvent);scrollAmount=ctrl.getScrollAmount(wheelData.deltaX,wheelData.deltaY,wheelData.deltaMode),ctrl.scroll(scrollAmount.deltaX,scrollAmount.deltaY,!1,!1),support.treatAsDesktop()||(ctrl.setMouseTrackSize(),ctrl.fadeInScrollbars(),ctrl.fadeOutScrollbarsDelayed()),ctrl.digest()}),$document.on("keydown"+$scope.namespace,function(event){var deltaMode,scrollAmount,deltaX=0,deltaY=0,target=$(event.target),isInputTarget=target.is("input")||target.is("textarea");if($scope.hover&&!isInputTarget){switch(event.keyCode){case 33:deltaY=1,deltaMode=2;break;case 34:deltaY=-1,deltaMode=2;break;case 36:deltaY=1,deltaMode=10;break;case 35:deltaY=-1,deltaMode=10;break;case 38:deltaY=1,deltaMode=1;break;case 40:deltaY=-1,deltaMode=1;break;case 39:deltaX=-1,deltaMode=1;break;case 37:deltaX=1,deltaMode=1;break;default:return}scrollAmount=ctrl.getScrollAmount(deltaX,deltaY,deltaMode),ctrl.scroll(-scrollAmount.deltaX,-scrollAmount.deltaY,!1,!1),ctrl.digest()}}),$element.on((support.treatAsDesktop()?"mouseenter":"pointerenter")+$scope.namespace,function(e){$scope.isMouse=support.isMouse(e.originalEvent),$scope.isMouse?($scope.hover=!0,support.treatAsDesktop()&&(ctrl.setMouseTrackSize(),ctrl.fadeInScrollbars()),ctrl.digest()):e.preventDefault()}),$element.on((support.treatAsDesktop()?"mouseleave":"pointerleave")+$scope.namespace,function(e){$scope.isMouse=support.isMouse(e.originalEvent),$scope.isMouse&&($scope.hover=!1,support.treatAsDesktop()&&ctrl.fadeOutScrollbars())}),"object"==typeof $scope.nonMouseViewportScrolling&&("number"!=typeof $scope.nonMouseViewportScrolling.scrollbarSize&&($scope.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof $scope.nonMouseViewportScrolling.className&&($scope.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),Touche($element[0]).swipe({id:$scope.namespace,options:{radiusThreshold:0,useMomentum:!0,inertia:.7},start:function(e,data){return support.isMouse(e)?void this.cancel():insideViewport(data.pagePoints[0].x-this.rect.x,data.pagePoints[0].y-this.rect.y)?(ctrl.setMouse(!1),ctrl.setNonMouseTrackSize(),ctrl.scrollStart(),ctrl.fadeInScrollbars(),void ctrl.digest()):void this.cancel()},update:function(e,data){var deltaX=$scope.scrollbarX.getScrollDelta(data)[0],deltaY=$scope.scrollbarY.getScrollDelta(data)[1];ctrl.scroll(-1*deltaX,-1*deltaY,!1,!0),ctrl.digest()},end:function(){ctrl.scrollEnd(),ctrl.fadeOutScrollbars(),ctrl.digest()}})),off},$scope.$on("$destroy",function(){off()})}}}]),qvangular.directive("qvScrollbar",["qvScrollAreaService",function(scrollAreaService){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:scrollbarTemplate,replace:!0,controller:function(){},link:function($scope,$element,$attrs,ctrls){function fade(add){$element[add?"addClass":"removeClass"]("fade")}var scrollAreaCtrl=ctrls[0],ctrl=ctrls[1];"vertical"===$scope.data.direction?($scope.data.classList.push("vertical"),scrollAreaCtrl.addScrollbarYCtrl(ctrl)):($scope.data.classList.push("horizontal"),scrollAreaCtrl.addScrollbarXCtrl(ctrl)),ctrl.allowFade=function(){return!$scope.data.active},ctrl.fadeIn=function(){return fade(!0)},ctrl.fadeOut=function(){return fade(!1)},$scope.thumbStyle={},$scope.$watch("data.thumb",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)},!0),$scope.$watch("data.vPage",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)}),$scope.$watch("data.vLength",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)}),$scope.$watch("data.enabled",function(enabled){scrollAreaCtrl.isMouseOver()&&enabled&&ctrl.fadeIn()}),$scope.setThumbStyle=scrollAreaService.setThumbStyle.bind(null,$scope.thumbStyle,$scope.data),$scope.trackHitAreaStyle={},$scope.$watch("data.trackSize",function(trackSize){void 0!==trackSize&&scrollAreaService.setTrackHitAreaStyle($scope.trackHitAreaStyle,$scope.data,trackSize)}),$scope.start=function(isMouse){scrollAreaCtrl.setMouse(isMouse),$scope.data.active||support.treatAsDesktop()||(isMouse?scrollAreaCtrl.setMouseTrackSize():scrollAreaCtrl.setNonMouseTrackSize(),scrollAreaCtrl.fadeInScrollbars()),$scope.data.active=!0,scrollAreaCtrl.scrollStart()},$scope.update=function(deltaX,deltaY){scrollAreaCtrl.scroll(deltaX,deltaY,!1,!0)},$scope.end=function(delayFadeOut){var data=$scope.data,minPos=0,maxPos=data.vLength-data.vViewportLength;data.vPos<minPos?data.vPos=minPos:data.vPos>maxPos&&(data.vPos=maxPos),$scope.data.active=!1,scrollAreaCtrl.scrollEnd(),delayFadeOut?scrollAreaCtrl.fadeOutScrollbarsDelayed():scrollAreaCtrl.fadeOutScrollbars()},$scope.on=function(){return $scope.hitAreaOff=$scope.hitAreaOn(),$scope.thumbOff=$scope.thumbOn(),function(){$scope.hitAreaOff(),$scope.thumbOff()}},$scope.$watch("interactive",function(on){on?$scope.off=$scope.on():$scope.off&&$scope.off()})}}}]),qvangular.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,require:"^qvScrollArea",link:function($scope,$element,$attrs,scrollAreaCtrl){$scope.thumbOn=function(){return Touche($element[0]).tap({start:function(e){Touche.preventGestures(this.gestureHandler),$scope.start(support.isMouse(e)),scrollAreaCtrl.digest()}}).swipe({options:{radiusThreshold:0},update:function(e,data){$scope.update.apply($scope,$scope.data.getScrollDelta(data)),scrollAreaCtrl.digest()},end:function(){$scope.end(),scrollAreaCtrl.digest()}}),function(){Touche($element[0]).off()}},$scope.$on("$destroy",function(){Touche($element[0]).off()})}}}]),qvangular.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function($scope,$element,$attrs,scrollAreaCtrl){function mouseStart(data,rect){var scrollAmount,up,down,left,right,thumbSize=$scope.data.thumb.size,thumbPos=$scope.data.thumb.pos,deltaX=0,deltaY=0;switch($scope.data.direction){case"vertical":up=data.pagePoints[0].y-rect.y<thumbPos,down=data.pagePoints[0].y-rect.y>thumbPos+thumbSize,down?(scrollAmount=scrollAreaCtrl.getScrollAmount(-1,-1,2),deltaX=0,deltaY=-scrollAmount.deltaY):up&&(scrollAmount=scrollAreaCtrl.getScrollAmount(1,1,2),deltaX=0,deltaY=-scrollAmount.deltaY);break;case"horizontal":left=data.pagePoints[0].x-rect.x<thumbPos,right=data.pagePoints[0].x-rect.x>thumbPos+thumbSize,left?(scrollAmount=scrollAreaCtrl.getScrollAmount(1,1,2),deltaX=-scrollAmount.deltaX,deltaY=0):right&&(scrollAmount=scrollAreaCtrl.getScrollAmount(-1,-1,2),deltaX=-scrollAmount.deltaX,deltaY=0)}scrollAreaCtrl.scroll(deltaX,deltaY)}function nonMouseStart(data,rect){switch($scope.data.direction){case"vertical":$scope.update(0,(data.pagePoints[0].y-rect.y-($scope.data.thumb.pos+$scope.data.thumb.size/2))*(1/$scope.data.scaleFactor));break;case"horizontal":$scope.update((data.pagePoints[0].x-rect.x-($scope.data.thumb.pos+$scope.data.thumb.size/2))*(1/$scope.data.scaleFactor),0);break;default:throw"not implemented"}}$scope.hitAreaOn=function(){return Touche($element[0]).tap({start:function(e,data){Touche.preventGestures(this.gestureHandler),$scope.start(support.isMouse(e)),$scope.setThumbStyle(),support.isMouse(e)?mouseStart(data,this.rect):nonMouseStart(data,this.rect),scrollAreaCtrl.digest()},end:function(){$scope.end(!0),scrollAreaCtrl.digest()}}).swipe({options:{radiusThreshold:0},start:function(e,data){return support.isMouse(e)?void this.cancel():($scope.update.apply($scope,$scope.data.getScrollDelta(data)),void scrollAreaCtrl.digest())},update:function(e,data){$scope.update.apply($scope,$scope.data.getScrollDelta(data)),scrollAreaCtrl.digest()},end:function(){$scope.end(!0),scrollAreaCtrl.digest()}}),function(){Touche($element[0]).off()}},$scope.$on("$destroy",function(){Touche($element[0]).off()})}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(Class,Notification,util,support,DOMApi,DataApi,ScrollAreaCtrl){"use strict";var VerticalScrollApi;return VerticalScrollApi=Class.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function($timeout,settings){Notification.create(this,"Scroll"),this.$timeout=$timeout,this.initPromise=null,this.setVirtualSizePromise=null,void 0!==settings.virtualScrollEnabled?this.virtualScrollEnabled=settings.virtualScrollEnabled:this.virtualScrollEnabled=support.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottomAbsolute=!1,this.axisDelta={xAxis:0,yAxis:0},this.alignToBottomReduce={active:!1,activeFromStart:!1},this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=util.extend(!0,{alignToBottom:"absolute",minRowHeight:21,maxRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},settings)},initialize:function(domApi,dataApi,virtualScrollApi,loaderApi){if(!(domApi instanceof DOMApi))throw"Must provide an instance of domApi";if(!(dataApi instanceof DataApi))throw"Must provide an instance of dataApi";if(!(virtualScrollApi instanceof ScrollAreaCtrl[4]))throw"Must provide an instance of ScrollAreaController";if(!loaderApi||"function"!=typeof loaderApi.fadeIn||"function"!=typeof loaderApi.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=domApi,this.dataApi=dataApi,this.virtualScrollApi=virtualScrollApi,this.loaderApi=loaderApi,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var bbox=this.domApi.getBoundingBox();this.settings.width=bbox.width,this.settings.height=bbox.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(totalRows){this.totalRows=totalRows},setTotalColumns:function(totalColumns){this.totalColumns=totalColumns},getSpliceArgs:function(){var dataRowCnt=this.dataApi.getRowCount(),viewportRowCount=this.settings.viewportRowCount,keepItemsCnt=this.settings.keepItemsCount,howMany=dataRowCnt-viewportRowCount-keepItemsCnt;return[0,howMany]},onSetVirtualSize:function(keepScrollPos){var visibleRows,virtualSize,virtualViewport,viewportRect,scrollAreaRect=this.domApi.getScrollAreaBoundingBox(),scrollContentRect=this.domApi.getScrollContentBoundingBox(),vPos=this.virtualScrollApi.getVirtualPosition(),vHeight=this.settings.minRowHeight*this.totalRows;"reduce"===this.settings.alignToBottom?(this.alignToBottomReduce.active=!1,this.alignToBottomReduce.activeFromStart=!1,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),scrollContentRect.height>=scrollAreaRect.height&&this.settings.viewportRowCount>=this.totalRows&&(visibleRows=this.domApi.getVisibleRowCount(),visibleRows<this.settings.viewportRowCount&&(this.alignToBottomReduce.active=!0,this.alignToBottomReduce.activeFromStart=!0,this.settings.viewportRowCount=visibleRows))):this.dataApi.getRowCount()===this.totalRows&&(vHeight=scrollContentRect.height),virtualSize={width:this.settings.minColumnWidth*this.totalColumns,height:vHeight},virtualViewport={width:scrollAreaRect.width,height:this.settings.viewportRowCount*this.settings.minRowHeight},viewportRect={top:0,left:0,width:scrollAreaRect.width,height:scrollAreaRect.height},this.virtualScrollApi.setVirtualSize(virtualSize,virtualViewport,viewportRect),keepScrollPos&&this.virtualScrollApi.scroll(vPos.vPosX,vPos.vPosY,!0)},setVirtualSize:function(keepScrollPos){if(this.virtualScrollEnabled){var promize=this.setVirtualSizePromise=this.$timeout(function(){this.onSetVirtualSize(keepScrollPos),this.updateAlignToBottom()}.bind(this));return promize}},getVirtualScrollAmount:function(deltaX,deltaY,deltaMode){var vPos=this.virtualScrollApi.getVirtualPosition(),vMaxPos=this.virtualScrollApi.getMaxPosition();if(this.alignBottomAbsolute&&0>deltaY)return{deltaX:deltaX,deltaY:deltaY};switch(deltaMode){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*deltaY};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*deltaY};case 10:return{deltaX:0,deltaY:deltaY>0?vPos.vPosY*deltaY:vPos.vPosY-vMaxPos.vPosY};default:return{deltaX:deltaX,deltaY:deltaY}}},getPage:function(vPos){return{left:Math.floor(vPos.vPosX/this.settings.minColumnWidth),top:Math.floor(vPos.vPosY/this.settings.minRowHeight),width:this.settings.viewportColumnCount,height:this.settings.viewportRowCount}},adjustPageToBounds:function(page){page.top>0&&page.top+page.height>this.totalRows&&(page.top=Math.max(0,this.totalRows-page.height),page.height=Math.min(this.totalRows,page.height)),page.left>0&&page.left+page.width>this.totalColumns&&(page.left=Math.max(0,this.totalColumns-page.width),page.width=Math.min(this.totalColumns,page.width))},onVirtualScroll:function(scrolledX,scrolledY){this.Scroll.emit();var vPos=this.virtualScrollApi.getVirtualPosition(),vPosMax=this.virtualScrollApi.getMaxPosition(),page=this.getPage(vPos);return this.alignToBottomReduce.active&&0>scrolledY&&(this.graduallyLeaveAlignToBottomReduce(page),vPosMax=this.virtualScrollApi.getMaxPosition()),"reduce"===this.settings.alignToBottom&&vPosMax.vPosY>0&&vPos.vPosY===vPosMax.vPosY&&(this.alignToBottomReduce.active=!0),this.adjustPageToBounds(page),this.axisDelta.xAxis=scrolledX,this.axisDelta.yAxis=scrolledY,this.dataApi.onVirtualScroll(page.top,page.height,page.left,page.width,scrolledX,scrolledY).then(function(){this.updateAlignToBottom()}.bind(this))},updateAlignToBottom:function(){"reduce"===this.settings.alignToBottom?this.updateAlignToBottomReduce():this.updateAlignToBottomAbsolute()},updateAlignToBottomAbsolute:function(){var vPos=this.virtualScrollApi.getVirtualPosition(),vMaxPos=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&vPos.vPosY===vMaxPos.vPosY?this.alignBottomAbsolute=!0:this.alignBottomAbsolute=!1},updateAlignToBottomReduce:function(){var makeSureItsPossibleToScrollDown=!1;if(this.alignToBottomReduce.active){if(this.axisDelta.yAxis>0){var visibleRowCount=this.domApi.getVisibleRowCount(this.settings.maxRowHeight);this.settings.viewportRowCount=visibleRowCount}else{var maxRowCount=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.settings.viewportRowCount>=maxRowCount&&(this.alignToBottomReduce.active=!1),makeSureItsPossibleToScrollDown=!0}var scrollAreaRect=this.domApi.getScrollAreaBoundingBox();this.virtualScrollApi.setViewport({top:0,left:0,width:scrollAreaRect.width,height:scrollAreaRect.height}),this.virtualScrollApi.setVirtualViewport({width:scrollAreaRect.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}),makeSureItsPossibleToScrollDown&&this.virtualScrollApi.setVirtualScrollPos(0,-1)}},graduallyLeaveAlignToBottomReduce:function(page){var maxRowCount=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.alignToBottomReduce.activeFromStart||(page.height=Math.min(this.totalRows-page.top,maxRowCount),this.settings.viewportRowCount=page.height)},updateLoadingButtons:function(){var rowIndex=this.dataApi.getFirstElementIndex(),height=this.dataApi.getRowCount();rowIndex+height>=this.totalRows||0===this.totalRows||0>rowIndex?this.loadNext=!1:this.loadNext=!0,rowIndex>0?this.loadPrevious=!0:this.loadPrevious=!1},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var rowIndex=this.dataApi.getLastElementIndex()+1,height=this.settings.blockSize-rowIndex;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(rowIndex,height).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var alignToRowFn=this.domApi.alignToLastRow(),rowIndex=this.dataApi.getLastElementIndex()+1,height=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(rowIndex,height).then(function(){this.updateLoadingButtons(),this.$timeout(function(){alignToRowFn(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var alignToRowFn=this.domApi.alignToFirstRow(),height=this.settings.blockSize-this.settings.keepItemsCount,rowIndex=this.dataApi.getFirstElementIndex()-height;0>rowIndex&&(height+=rowIndex,rowIndex=0),this.dataApi.onGotoPreviousBlock(rowIndex,height).then(function(){this.updateLoadingButtons(),this.$timeout(function(){alignToRowFn(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("general.scroll/api/simple-list-data-api",["core.utils/deferred","general.scroll/api/data-api"],function(Deferred,ScrollDataApi){"use strict";var SimpleListDataApi;return SimpleListDataApi=ScrollDataApi.extend({init:function(scrollApi){this.list=[],this.scrollApi=scrollApi},getRowCount:function(){return this.scrollApi.items?this.scrollApi.items.length:0},getFirstElementIndex:function(){return this.list.indexOf(this.scrollApi.items[0])},getLastElementIndex:function(){return this.list.indexOf(this.scrollApi.items[this.scrollApi.items.length-1])},getItems:function(index,count){return this.list.slice(Math.max(0,index),index+count)},setItems:function(index,count){this.scrollApi.items=this.getItems(index,count)},setList:function(list){this.list=list,this.scrollApi.setTotalRows(this.list.length),this.scrollApi.virtualScrollEnabled?(this.setItems(0,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!1)):(this.setItems(0,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()())},resize:function(){this.scrollApi.updateViewport();var count=this.getRowCount(),start=count>0?this.getFirstElementIndex():0;return 0!==start&&start+this.scrollApi.settings.viewportRowCount>count&&(start=Math.max(0,count-this.scrollApi.settings.viewportRowCount)),this.scrollApi.virtualScrollEnabled?(this.setItems(start,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!0)):0===start&&count<this.scrollApi.settings.blockSize?(this.setItems(start,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()(),Deferred.resolve()):Deferred.resolve()},onVirtualScroll:function(rowIndex,height){return this.setItems(rowIndex,height),Deferred.resolve()},onInitialNativeScroll:function(rowIndex,height){return this.setItems(0,rowIndex+height),Deferred.resolve()},onGotoNextBlock:function(rowIndex,height){var keepItemsCnt=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(rowIndex-keepItemsCnt,height+keepItemsCnt),Deferred.resolve()},onGotoPreviousBlock:function(rowIndex,height){var keepItemsCnt=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(rowIndex,height+keepItemsCnt),Deferred.resolve()}})}),function(root,undefined){"use strict";var HEX_CHARS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],HEX_TABLE={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],sha256=function(message){return sha2(message,!0)},sha224=function(message){return sha2(message,!1)},sha2=function(message,is256){is256===undefined&&(is256=!0);var blocks=hasUTF8(message)?UTF8toBlocks(message):ASCIItoBlocks(message);if(is256)var h0=1779033703,h1=3144134277,h2=1013904242,h3=2773480762,h4=1359893119,h5=2600822924,h6=528734635,h7=1541459225;else var h0=3238371032,h1=914150663,h2=812702999,h3=4144912697,h4=4290775857,h5=1750603025,h6=1694076839,h7=3204075428;for(var i=0,length=blocks.length;length>i;i+=16){for(var s0,s1,w=[],j=0;16>j;++j)w[j]=blocks[i+j];for(var j=16;64>j;++j)s0=rightrotate(w[j-15],7)^rightrotate(w[j-15],18)^w[j-15]>>>3,s1=rightrotate(w[j-2],17)^rightrotate(w[j-2],19)^w[j-2]>>>10,w[j]=w[j-16]+s0+w[j-7]+s1;for(var maj,t1,t2,ch,a=h0,b=h1,c=h2,d=h3,e=h4,f=h5,g=h6,h=h7,j=0;64>j;++j)s0=rightrotate(a,2)^rightrotate(a,13)^rightrotate(a,22),maj=a&b^a&c^b&c,t2=s0+maj,s1=rightrotate(e,6)^rightrotate(e,11)^rightrotate(e,25),ch=e&f^~e&g,t1=h+s1+ch+K[j]+w[j]&4294967295,h=g,g=f,f=e,e=d+t1,d=c,c=b,b=a,a=t1+t2;h0+=a,h1+=b,h2+=c,h3+=d,h4+=e,h5+=f,h6+=g,h7+=h}var hex=toHexString(h0)+toHexString(h1)+toHexString(h2)+toHexString(h3)+toHexString(h4)+toHexString(h5)+toHexString(h6);return is256&&(hex+=toHexString(h7)),hex},rightrotate=function(x,c){return x>>>c|x<<32-c},toHexString=function(num){for(var hex="",i=0;4>i;i++){var offset=3-i<<3;hex+=HEX_CHARS[num>>offset+4&15]+HEX_CHARS[num>>offset&15]}return hex},hasUTF8=function(message){for(var i=message.length;i--;)if(message.charCodeAt(i)>255)return!0;return!1},ASCIItoBlocks=function(message){var i,length=message.length,chunkCount=(length+8>>6)+1,blockCount=chunkCount<<4,blocks=[];for(i=0;blockCount>i;++i)blocks[i]=0;for(i=0;length>i;++i)blocks[i>>2]|=message.charCodeAt(i)<<(3-i%4<<3);return blocks[i>>2]|=128<<(3-i%4<<3),blocks[blockCount-1]=length<<3,blocks},UTF8toBlocks=function(message){for(var uri=encodeURIComponent(message),blocks=[],i=0,bytes=0,length=uri.length;length>i;++i){var c=uri.charCodeAt(i);37==c?blocks[bytes>>2]|=(HEX_TABLE[uri.charAt(++i)]<<4|HEX_TABLE[uri.charAt(++i)])<<(3-bytes%4<<3):blocks[bytes>>2]|=c<<(3-bytes%4<<3),++bytes}var chunkCount=(bytes+8>>6)+1,blockCount=chunkCount<<4,index=bytes>>2;blocks[index]|=128<<(3-bytes%4<<3);for(var i=index+1;blockCount>i;++i)blocks[i]=0;return blocks[blockCount-1]=bytes<<3,blocks};window.sha256=sha256,window.sha224=sha224}(this),define("sha256",function(){}),define("assets/datamodelviewer/utils/dmv-crypto-util",["sha256"],function(){function _sha256(s){if(void 0===s)throw new Error("String is undefined.");if(0===s.length)throw new Error("String is empty.");var hashed=sha256(s);return hashed}var exports={sha256:_sha256};return exports}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","core.models/app","objects.utils/data-properties/listobject-util","core.utils/resize","core.utils/deferred","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","jquery","util","objects.utils/shapes/rect","assets/datamodelviewer/utils/dmv-crypto-util","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(qvangular,template,Class,Listbox,App,listObjectUtil,Resize,Deferred,ScrollApi,ScrollDOMApi,SimpleListDataApi,$,util,Rect,cryptoUtil){"use strict";function reSizeArray(theArray,length){for(;theArray.length>length;)theArray.pop()}var GsSimpleListDataApi=SimpleListDataApi.extend({init:function(){this.resetColumnIndex(),this._super.apply(this,arguments)},resetColumnIndex:function(){this.columnIndex=0},setList:function(list){this.list=list,this.scrollApi.setTotalRows(this.list.length),this.setItems(this.columnIndex,this.scrollApi.settings.blockSize),this.scrollApi.updateLoadingButtons()},onInitialNativeScroll:function(){return Deferred.resolve()},onGotoNextBlock:function(){var promise=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return promise},onGotoPreviousBlock:function(){var promise=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return promise}}),HorizontalScrollDOMApi=ScrollDOMApi.extend({resetNativeScroll:function(){this.$scrollArea.scrollLeft(0)},alignToFirstRow:function(){var $alignToColumn=this.getFirstRow(),columnId=$alignToColumn.children(".qv-object-wrapper").attr("id"),loadButtonWidthOffset=260;return function(){var scrollLeft,$newColumn=$(this.$scrollArea.find("#"+columnId));$newColumn.length>0&&(scrollLeft=$newColumn.offset().left-loadButtonWidthOffset,this.$scrollArea.scrollLeft(scrollLeft))}.bind(this)},alignToLastRow:function(){var $alignToColumn=this.getLastRow(),columnId=$alignToColumn.children(".qv-object-wrapper").attr("id"),loadButtonWidthOffset=250;return function(){var scrollLeft,$newColumn=$(this.$scrollArea.find("#"+columnId));$newColumn.length>0&&(this.$scrollArea.scrollLeft(0),scrollLeft=$newColumn.parent().position().left-this.getScrollAreaBoundingBox().width+$newColumn[0].getBoundingClientRect().width+loadButtonWidthOffset,this.$scrollArea.scrollLeft(scrollLeft))}.bind(this)},getBoundingBox:function(){var bbox=this._super.apply(this,arguments);return new Rect(bbox.top,bbox.left,bbox.height,bbox.width)}}),Controller=Class.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function($scope,$timeout,selectionToolbarService){this.$scope=$scope,this.$timeout=$timeout,this.selectionToolbarService=selectionToolbarService,this.$scope.items=[]},initialize:function($element,size,options){this.setSize(size),this.setItemSize(options.itemSize),this.setItemSpacing(options.itemSpacing),this.setElement($element.find(".qv-gs-scroll-area")),this.setItems(),this.initialized=!0},updateVisible:function(){var startIndex=this.offsetX-(this.$scope.scrollApi.loadPrevious?1:0),visibleCount=this.visibleItemsCount;this.$scope.items.forEach(function(item,index){var visible=index>=startIndex&&startIndex+visibleCount>index;!item.visible&&visible&&(item.options={isPopOver:!1}),visible&&!item.model&&this.getModel(item).then(function(item,model){item.model=model}.bind(null,item)),item.visible=visible},this)},getModel:function(item){var model,initProps=this.getInitProps(item.title);return item.qField?model=Listbox.createTransientField(App.current,item.qField,initProps):item.qId&&(model=Listbox.createTransientDimension(App.current,item.qId,initProps)),model},onScroll:function(){this.qvGlobalSelectionsCtrl.setIgnoreUpdates(!1),this.selectionToolbarService.confirm(),this.updateHighlights(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible(),this.updateHighlights()}.bind(this),100)},onResize:function(size){this.setSize(size),this.updateVisible()},updateHighlights:function(){this.$scope.items.forEach(function(item){item.options.highlightQuery=this.$scope.filter},this)},setItems:function(){var i,item,prototype,$scope=this.$scope,itemCount=this.totalItemsCount;for($scope.items.length!==itemCount&&reSizeArray($scope.items,itemCount),i=0;itemCount>i;i++)item=$scope.items[i]||{},prototype=$scope.scrollApi.items[i],prototype.enableBadge&&(item.enableBadge=prototype.enableBadge),item.model||(item.options={isPopOver:!1}),prototype.qField?(delete item.qId,item.model&&item.qField===prototype.qField||(item.visible&&($scope.items[i]=util.extend(!0,{},item),item=$scope.items[i],delete item.$$hashKey,delete item.options.search),item.title=prototype.title,item.qField=prototype.qField,item.id=cryptoUtil.sha256(item.qField),delete item.model)):prototype.qId&&(delete item.qField,item.model&&item.qId===prototype.qId||(item.visible&&($scope.items[i]=util.extend(!0,{},item),item=$scope.items[i],delete item.$$hashKey,delete item.options.search),item.title=prototype.title,item.qId=prototype.qId,item.id=cryptoUtil.sha256(item.qId),delete item.model)),$scope.items[i]||($scope.items[i]=item);this.updateVisible()},getInitProps:function(title){var initProps={title:title,qListObjectDef:{qDef:{}}};return listObjectUtil.autoSortDimension(initProps.qListObjectDef),initProps},getWidthOf:function(count){return this.totalItemSize*count-this.itemSpacing},setItemSize:function(itemSize){this.itemSize=itemSize||220},setItemSpacing:function(itemSpacing){this.itemSpacing=itemSpacing||20},setSize:function(size){this.size=size},setElement:function($element){this.$element=$element,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(Controller.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},visibleItemsCount:{get:function(){var maxVisible=Math.ceil(((this.vPosX+(this.previousBtnVisible?240:0))%this.totalItemSize+this.size.width)/this.totalItemSize);
return Math.min(maxVisible,this.totalItemsCount+(this.previousBtnVisible?1:0))}},totalItemsCount:{get:function(){return(this.$scope.scrollApi.items||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}},previousBtnVisible:{get:function(){return!!this.$scope.scrollApi.loadPrevious}}}),Controller.$inject=["$scope","$timeout","qvSelectionToolbarService"],qvangular.directive("qvGlobalSelectSection",["$parse","$timeout",function($parse,$timeout){return{controller:Controller,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:template,replace:!0,scope:{allItems:"=",filter:"="},link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],qvGlobalSelectionsCtrl=ctrls[1],options=$parse($attrs.qvGlobalSelectSection)(),size={},$scrollArea=$element.find(".qv-gs-scroll-area"),virtualScrollCtrl=$scrollArea.controller("qvScrollArea"),loaderCtrl=$element.find(".qv-scroll-loader").controller("qvScrollLoader"),settings={blockSize:24,minRowHeight:240,maxRowHeight:240,keepItemsCount:4,virtualScrollEnabled:!1},scrollApi=$scope.scrollApi=new ScrollApi($timeout,settings),scrollDataApi=new GsSimpleListDataApi(scrollApi),scrollDOMApi=new HorizontalScrollDOMApi($element,$scrollArea,".qv-gs-listbox",".qv-gs-listbox:first",".qv-gs-listbox:last"),watcher=null,resize=function(){size.width=$element.innerWidth(),size.height=$element.innerHeight(),ctrl.onResize(size)};ctrl.qvGlobalSelectionsCtrl=qvGlobalSelectionsCtrl,scrollApi.initialize(scrollDOMApi,scrollDataApi,virtualScrollCtrl,loaderCtrl).then(function(){scrollApi.activate(),scrollApi.updateViewport(),$scope.$watch("filter",function(){scrollDataApi.resetColumnIndex(),scrollApi.resetNativeScroll()}),$scope.$watch("allItems",function(items){items&&(scrollDataApi.setList(items),watcher&&watcher(),watcher=$scope.$watch("scrollApi.items",function(){qvGlobalSelectionsCtrl.ignoreUpdates||(0===scrollApi.items.length&&$scope.allItems.length>0&&(scrollApi.resetNativeScroll(),scrollDataApi.resetColumnIndex(),scrollDataApi.setList(items)),ctrl.initialized&&ctrl.setItems())}))})}),$timeout(function(){size.width=$element.innerWidth(),size.height=$element.innerHeight(),ctrl.initialize($element,size,options)}),Resize.on("end",resize),$scope.$on("$destroy",function(){Resize.off("end",resize),scrollApi.destroy()}),qvGlobalSelectionsCtrl.addCallback(options.type,function(){ctrl.$timeout(function(){ctrl.setItems(),ctrl.$timeout(function(){ctrl.updateHighlights()})})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge">\r\n	<q qva-activate="badgeClick(item)"></q>\r\n</div>\r\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(BackendApi){"use strict";var ListboxApi;return ListboxApi=BackendApi.extend("Listbox",{init:function(model){this._super(model,"/qListObjectDef"),this.cacheCube.setMethodName("GetListObjectData")},select:function(dimNo,values,toggleMode){return this.model.rpc("SelectListObjectValues",null,[this.path,values,toggleMode])},selectAll:function(){return this.model.rpc("SelectListObjectAll",null,[this.path])},selectPossible:function(){return this.model.rpc("SelectListObjectPossible",null,[this.path])},selectAlternative:function(){return this.model.rpc("SelectListObjectAlternative",null,[this.path])},selectExcluded:function(){return this.model.rpc("SelectListObjectExcluded",null,[this.path])},search:function(term){return this.model.rpc("SearchListObjectFor","qSuccess",[this.path,term])},abortSearch:function(){return this.model.rpc("AbortListObjectSearch",null,[this.path])},confirmSearch:function(toggleMode){return this.model.rpc("AcceptListObjectSearch",null,[this.path,toggleMode])},updateCache:function(layout){this.cacheCube.set(layout.qListObject.qDataPages),this.cacheCube.setCubeSize(layout.qListObject.qSize)},setInitialData:function(layout){this.cacheCube.set(layout.qListObject.qDataPages)},getData:function(pages){return this.cacheCube.getData(pages)},getDataPage:function(page){return this.getData([page]).then(function(dataPages){return dataPages[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.rpc("Lock",null,[this.path])},unlock:function(){return this.model.rpc("Unlock",null,[this.path])},isLocked:function(){return this.model.layout&&this.model.layout.qListObject&&this.model.layout.qListObject.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(qvangular,template,ListboxApi){qvangular.directive("qvGsBadge",function(){return{restrict:"E",template:template,replace:!0,link:function($scope){$scope.item.enableBadge&&($scope.item.object||($scope.item.object={}),$scope.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(newVal){qvangular.$apply(function(){$scope.item.showBadge=(void 0===newVal[0]||newVal[0]===!1)&&newVal[1]===!1})}),$scope.badgeClick=function(item){var backendApi=new ListboxApi(item.model);backendApi.beginSelections(),backendApi.clearSelections(),backendApi.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.utils/support","client.assets/assets-utils","core.utils/class","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.models/app","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.utils/type-loader","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge"],function($,qvangular,template,CurrentSelections,DimensionModel,support,assetUtils,Class,FieldModel,FieldListModel,Deferred,App,resize,DirectDiscoveryService,TypeLoader){var eventNs=".globalSelections",Controller=Class.extend({init:function($scope,$document){var self=this;this.$scope=$scope,this.$document=$document,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,$scope.dimensions=[],$scope.dimensionsFields=[],$scope.selectedFields=[],$scope.fields=[],$scope.dimAvailable=!1,$scope.showFields=!1,$scope.showFieldsCheckbox=!0,$scope.filter="",$scope.autoFocus=support.treatAsDesktop(),$scope.selectionToolbarOpen=!1,Deferred.all({fields:this.getFields(),select:this.bindCurrentSelections(),dim:this.getLibraryDimensions(),reg:this.registerExtensions()}).then(function(){self.hasLoaded=!0,self.setupUi(self),$scope.$watchCollection("[filter, showFields]",function(){self.filterShown(self,self.$scope)}),$(".qv-gs-section .qv-gs-header")[1].style.display="none",$(".qv-gs-section .qv-gs-header")[1].offsetHeight,$(".qv-gs-section .qv-gs-header")[1].style.display="block"})},registerExtensions:function(){var dfd=new Deferred;return TypeLoader.load().then(function(){dfd.resolve()}),dfd.promise},getFields:function(){var $scope=this.$scope,dfd=new Deferred;return FieldModel.getListLayout().then(function(layout){$scope.fields=FieldListModel.expand(layout).map(function(item){return{title:item.qName,qField:item.qName,qTags:item.qTags}}),dfd.resolve()}),dfd.promise},_updateCurrentSelectionFields:function(currentSelectionLayout){var self=this,$scope=this.$scope;$scope.selectedFields=currentSelectionLayout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}).map(function(sel){return{title:sel.qField,qField:sel.qField,enableBadge:!0}}),self.hasLoaded&&self.filterShown(self,$scope)},handleCurrentSelectionFields:function(){var self=this;this.$scope.currentSelectionsModel.getLayout().then(function(layout){self._updateCurrentSelectionFields(layout)})},bindCurrentSelections:function(){var $scope=this.$scope,self=this;return CurrentSelections.get().then(function(currentSelectionsModel){return $scope.currentSelectionsModel=currentSelectionsModel,CurrentSelections.bindLayout($scope,"currentSelectionsModel",function(layout){App.current.isModal()||self._updateCurrentSelectionFields(layout)})})},getLibraryDimensions:function(){var isCalculatedField=this.isCalculatedField,$scope=this.$scope,dfd=new Deferred;return DimensionModel.getList().then(function(DimensionList){DimensionList.getLayout().then(function(items){$scope.dimensions=items.filter(function(item){return item.qData.info.length>0&&(item.qData.info.some(isCalculatedField)?!1:!0)&&"H"!==item.qData.grouping}).map(function(item){return{title:item.qData.title,fieldName:item.qData.info[0].qName,qId:item.qInfo.qId}}),dfd.resolve()})}),dfd.promise},setupUi:function(self){var $scope=self.$scope;$scope.showFieldsCheckbox=$scope.fields.length>0,$scope.dimAvailable=$scope.dimensions.length>0,!$scope.dimAvailable&&$scope.showFieldsCheckbox&&($scope.showFields=!0)},isCalculatedField:function(fieldInfo){return"="===fieldInfo.qName[0]},filterShown:function(self,$scope){var filterLowerCase="",temp=[];$scope.dimensionsFields=$scope.dimensions.filter(function(dimension){return!$scope.selectedFields.some(function(field){return dimension.fieldName===field.qField})}),$scope.showFields&&(temp=$scope.fields.filter(function(field){return!$scope.selectedFields.some(function(selectedField){return selectedField.qField===field.qField})}),temp=DirectDiscoveryService.removeMeasureAndDetailsFields(temp),$scope.dimensionsFields=$scope.dimensionsFields.concat(temp.filter(function(field){return!$scope.dimensions.some(function(dimension){return field.qField===dimension.fieldName})}))),$scope.filter.length>0&&(filterLowerCase=$scope.filter.toLowerCase(),temp=$scope.dimensionsFields.filter(function(item){return-1!==item.title.toLowerCase().indexOf(filterLowerCase)}),$scope.dimensionsFields=temp),assetUtils.localeOrderBy($scope.dimensionsFields,function(d){return d.title}),qvangular.$apply($scope,function(){self.notifyCallbacks(self)})},addCallback:function(type,callback){this.callbacks.push({type:type,fn:callback})},notifyCallbacks:function(self){self.hasLoaded&&(self.ignoreUpdates||self.callbacks.forEach(function(callback){("fields"===callback.type||"dimensions"===callback.type)&&callback.fn()}))},setIgnoreUpdates:function(ignoreUpdates){this.ignoreUpdates=ignoreUpdates}});return Controller.$inject=["$scope","$document"],qvangular.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function($document,selectionToolbarService,$timeout){return{restrict:"E",template:template,controller:Controller,require:["qvGlobalSelections"],scope:{},replace:!0,link:function($scope,$element,$attrs,ctrls){$scope.toolbar=$document.find(".qui-toolbar")[0]?!0:!1;var ctrl=ctrls[0],onResize=function(){ctrl.ignoreUpdates=!1},selectionToolbarClosedCallback=function(){$scope.selectionToolbarOpen=!1,$timeout(function(){ctrl.handleCurrentSelectionFields()})},selectionToolbarOpenedCallback=function(){$scope.selectionToolbarOpen=!0};selectionToolbarService.Closed.bind(selectionToolbarClosedCallback),selectionToolbarService.Opened.bind(selectionToolbarOpenedCallback),$document.on("keyup"+eventNs,function(event){27===event.which?ctrl.ignoreUpdates=!1:13===event.which&&(ctrl.ignoreUpdates=!1)}),Touche($document[0].body).tap({id:eventNs,options:{preventDefault:!1},start:function(event){var badgeClicked=$(event.target).closest(".qv-gs-badge").length>0,listboxClicked=$(event.target).closest(".qv-gs-listbox").length>0,selectionToolbarClicked=$(event.target).closest(".qv-selection-toolbar").length>0;ctrl.ignoreUpdates=listboxClicked&&!badgeClicked&&!selectionToolbarClicked}}),resize.on("start",onResize),$scope.$on("$destroy",function(){ctrl.callbacks=[],selectionToolbarService.Closed.unbind(selectionToolbarClosedCallback),selectionToolbarService.Opened.unbind(selectionToolbarOpenedCallback),Touche($document[0].body).off("*",eventNs),$document.off(eventNs),resize.off("start",onResize)}),$scope.onEnter=function($event){$event.stopPropagation(),$event.target.blur()}}}}]),"<qv-global-selections></qv-global-selections>"}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\r\n		<div class="qv-ms-toolbar">\r\n		<p qva-activate="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"><</p>\r\n		<p qva-activate="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward">=</p>\r\n		<p qva-activate="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections">:</p>\r\n		<p qva-activate="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': menuActive }" class="qv-ms-toolbar-buttons" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu">¨</p>\r\n\r\n		<qui-toolbarbutton qva-activate="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\r\n			<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\r\n		</qui-toolbarbutton>\r\n		</div>\r\n		<header class="qv-ms-header">\r\n				<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n	<qui-search-field placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter.filter" maxlength="255"\r\n		on-enter="filter.onEnter($event)" class="qv-ms-searchbox" tid="mobileSelections.searchfield">\r\n		</qui-search-field>\r\n		<div class="qv-ms-scroll-area">\r\n			<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\r\n			<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\r\n		</div>\r\n</div>\r\n'}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<immidiate-contextual align-to=" \'#mobileSelectionsMenu\' " position="\'bottom\'" on-close-view="closeView()" qva-outside-ignore-for="mobileSelectionsMenu" smallview="true">\r\n	<ul class="qui-icontextlist toolbar-menu">\r\n		<li qva-activate="toggleFields($event)" data-icon="{{fieldsIcon}}">\r\n			<span class="qui-textlist-text" q-translation="{{fieldsLabel}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("client.views/mobile-selections/menu/mobile-selections-menu",["text!./mobile-selections-menu.ng.html"],function(template){"use strict";var contextMenu={scope:{menuItem:"=",closeMenu:"="},template:template,controller:["$scope",function($scope){$scope.fieldsLabel=$scope.menuItem.model.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",$scope.fieldsIcon=$scope.menuItem.model.showFields?"remove":"add",$scope.toggleFields=function($event){$event.preventDefault(),$scope.menuItem.model.showFields=!$scope.menuItem.model.showFields,$scope.closeMenu()},$scope.closeView=function(){$scope.closeMenu()}}]};return contextMenu}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function($,DOMUtil){"use strict";function qvKeyboardShortcuts(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var qvKeyShortcuts,keyCodes={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,f:70,enter:13,esc:27,g:71,h:72,home:36,i:73,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91},eventNamespace="qvKeyboardShortcuts",listening=!1;return qvKeyboardShortcuts.prototype.createGroup=function(name,priority){var group,i,that=this;for(i=0;i<this.groups.length;i++)if(this.groups[i].name===name){group=this.groups[i];break}if(group)throw"Keyboard shortcut group already exist: "+name;return group={name:name,priority:priority,active:!1,shortcuts:[]},this.groups.push(group),this.groups.sort(function(a,b){return a.priority-b.priority}),{registerKeys:function(keyCombo,callback,options){that.registerKeys(group,keyCombo,callback,options)},on:function(){that.activateGroup(group)},off:function(){that.deactivateGroup(group)},"delete":function(){that.deactivateGroup(group),that.deleteGroup(group)}}},qvKeyboardShortcuts.prototype.activateGroup=function(group){var that=this;group.active=!0,listening||(listening=!0,$(document).on("keydown."+eventNamespace,function(e){that.handleEvent(e)}))},qvKeyboardShortcuts.prototype.deactivateGroup=function(group){var activeCount;group.active=!1,activeCount=this.groups.reduce(function(count,group){return group.active&&count++,count},0),0===activeCount&&listening&&(listening=!1,$(document).off("keydown."+eventNamespace))},qvKeyboardShortcuts.prototype.deleteGroup=function(groupToDelete){this.groups=this.groups.filter(function(group){return group!==groupToDelete})},qvKeyboardShortcuts.prototype.registerKeys=function(group,keyCombo,callback,options){var keys=keyCombo.toLowerCase().split("+"),obj={ctrlKey:!1,shiftKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:options&&"allowInInput"in options?options.allowInInput:!1,preventDefault:options&&"preventDefault"in options?options.preventDefault:!0,delay:options&&"delay"in options?options.delay:250};for(var code in keyCodes)for(var i=0;i<keys.length;i++)obj.name=keyCombo.toLowerCase(),obj.callback=callback,("ctrl"===keys[i]||"cmd"===keys[i])&&(obj.ctrlKey=!0),"shift"===keys[i]&&(obj.shiftKey=!0),keys[i]===code&&17!==keyCodes[code]&&16!==keyCodes[code]&&91!==keyCodes[code]&&(obj.keyCode=keyCodes[code]);group.shortcuts.push(obj)},qvKeyboardShortcuts.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},qvKeyboardShortcuts.prototype.handleEvent=function(e){function findKeyEvent(ctrlValue,shiftValue,currentKeypress){for(var group,keySet,i=0;i<that.groups.length;i++)if(group=that.groups[i],group.active)for(var j=0;j<group.shortcuts.length;j++)if(keySet=group.shortcuts[j],keySet.ctrlKey===ctrlValue&&keySet.shiftKey===shiftValue&&keySet.keyCode===currentKeypress)return keySet}function prepareToPerformAction(e,keySet){var isInput=DOMUtil.isInput(document.activeElement);(!isInput||keySet.allowInAllContexts)&&performAction(e,keySet)}function performAction(e,keySet){keySet.preventDefault&&e.preventDefault(),"number"!=typeof that.timer.id&&(keySet.callback(keySet),keySet.delay>0?that.timer.id=setTimeout(function(){clearDelay()},keySet.delay):clearDelay())}function clearDelay(){clearTimeout(that.timer.id),delete that.timer.id}var keySet,that=this;this.currentEvent=e,e.shiftKey?e.shiftKey&&(!e.ctrlKey&&!e.metaKey||e.altKey||(keySet=findKeyEvent(!0,!0,e.which),keySet&&prepareToPerformAction(e,keySet))):!e.ctrlKey&&!e.metaKey||e.altKey?(keySet=findKeyEvent(!1,!1,e.which),keySet&&prepareToPerformAction(e,keySet)):(keySet=findKeyEvent(!0,!1,e.which),keySet&&prepareToPerformAction(e,keySet))},qvKeyShortcuts=new qvKeyboardShortcuts}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div qva-activate="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\r\n	<p ng-if="item.qField" class="qv-ms-is-field"></p>\r\n	<div class="qv-ms-highlight">\r\n		<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html","core.utils/class"],function(qvangular,template,Class){var Controller=Class.extend({init:function($scope){this.$scope=$scope}});Controller.$inject=["$scope"],qvangular.directive("qvMsSelectable",["$timeout",function($timeout){return{controller:Controller,restrict:"E",replace:!0,template:template,link:function($scope){$scope.showSelectable=function(){$scope.item.flash=!0,$timeout(function(){$scope.$emit("showListbox",$scope.item),$scope.item.flash=!1},20)}}}}])}),define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\r\n	<div class="qv-ms-selected-icon">\r\n		<a ng-show="!item.qLocked" qva-activate="clear(item.qField)">\r\n			<i class="icon-cancel"></i>\r\n		</a>\r\n		<a ng-show="item.qLocked" qva-activate="showSelected(item.qField)">\r\n			<i class="icon-toolbar-locked"></i>\r\n		</a>\r\n	</div>\r\n	<div qva-activate="showSelected(item.qField)" class="qv-ms-selected-info">\r\n		<h1 class="qv-object-title">{{item.qField}}</h1>\r\n		<span>{{item.translation}}</span>\r\n		<qv-state-count-bar cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html","core.utils/class"],function(qvangular,template,Class){var Controller=Class.extend({init:function($scope){this.$scope=$scope}});Controller.$inject=["$scope"],qvangular.directive("qvMsSelected",function(){return{controller:Controller,restrict:"E",replace:!0,template:template,link:function($scope){$scope.showSelected=function(){$scope.$emit("showListbox",$scope.item)},$scope.clear=function(fieldName){$scope.currentSelectionsModel.clearField(fieldName)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(qvangular,translator){qvangular.service("qvCurrentSelectionsService",[function(){return{translate:function(item){var translation,selectedCount=item.qStateCounts.qSelected+item.qStateCounts.qSelectedExcluded+item.qStateCounts.qLocked+item.qStateCounts.qLockedExcluded,totalCount=item.qTotal;return translation=totalCount===selectedCount&&totalCount>1?translator.get("CurrentSelections.All"):selectedCount>1&&totalCount>1?translator.get("CurrentSelections.Of",[selectedCount,totalCount]):item.qSelectedFieldSelectionInfo.map(function(i){return i.qName}).join(", ").toString()}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/class","core.utils/deferred","core.models/app","objects.models/listbox","general.services/show-service/show-service","client.views/mobile-selections/menu/mobile-selections-menu","client.assets/tab-contents/fields/assets-directdiscovery-service","general.utils/qv-keyboard-shortcuts","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","objects/listbox-popover/listbox-popover-service","client.views/current-selections/current-selections-service"],function(qvangular,template,CurrentSelections,DimensionModel,FieldModel,assetUtils,Class,Deferred,App,Listbox,showService,menu,DirectDiscoveryService,qvKeyboardShortcuts){var Controller=Class.extend({init:function($scope,$document){var self=this;self.$scope=$scope,self.$document=$document,self.hasLoaded=!1,$scope.dimensions=[],$scope.fields=[],$scope.selectedFields=[],$scope.filter={filter:"",showFields:!1,onEnter:function($event){$event.stopPropagation(),$event.target.blur()}},$scope.selectables=[],$scope.dimAvailable=!1,$scope.enableMenu=!0,$scope.disable={clear:!1,back:!1,forward:!1},Deferred.all({selections:this.bindCurrentSelections(self),dimensions:this.getLibraryDimensions(),fields:this.getFields()}).then(function(){self.hasLoaded=!0,$scope.enableMenu=$scope.fields.length>0,$scope.dimAvailable=$scope.dimensions.length>0,!$scope.dimAvailable&&$scope.enableMenu&&($scope.filter.showFields=!0),$scope.$watch("filter",function(){self.filterSelectables(self)},!0)})},filterSelectables:function(self){var $scope=self.$scope,filterLowerCase="",temp=[];$scope.selectables=$scope.dimensions.filter(function(dimension){return!$scope.selectedFields.some(function(field){return dimension.fieldName===field.qField})}),$scope.filter.showFields===!0&&(temp=$scope.fields.filter(function(field){return!$scope.selectedFields.some(function(selectedField){return selectedField.qField===field.qField})}),temp=DirectDiscoveryService.removeMeasureAndDetailsFields(temp),$scope.selectables=$scope.selectables.concat(temp.filter(function(field){return!$scope.dimensions.some(function(dimension){return field.qField===dimension.fieldName})}))),$scope.filter.filter.length>0&&(filterLowerCase=$scope.filter.filter.toLowerCase(),temp=$scope.selectables.filter(function(item){return-1!==item.title.toLowerCase().indexOf(filterLowerCase)}),$scope.selectables=temp),assetUtils.localeOrderBy($scope.selectables,function(d){return d.title}),qvangular.$apply($scope)},bindCurrentSelections:function(self){var $scope=self.$scope,dfd=new Deferred,currentSelectionsService=qvangular.getService("qvCurrentSelectionsService");return CurrentSelections.get().then(function(currentSelectionsModel){$scope.currentSelectionsModel=currentSelectionsModel,CurrentSelections.bindLayout($scope,"currentSelectionsModel",function(layout){$scope.disable={clear:0===layout.qSelectionObject.qSelections.length||layout.qSelectionObject.qSelections.every(function(selection){return selection.qLocked}),back:0===layout.qSelectionObject.qBackCount,forward:0===layout.qSelectionObject.qForwardCount},$scope.selectedFields=layout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),$scope.selectedFields.forEach(function(field){field.translation=currentSelectionsService.translate(field)}),self.hasLoaded&&self.filterSelectables(self)}),dfd.resolve()}),dfd.promise},getLibraryDimensions:function(){var isCalculatedField=this.isCalculatedField,$scope=this.$scope,dfd=new Deferred;return DimensionModel.getList().then(function(DimensionList){DimensionList.getLayout().then(function(items){$scope.dimensions=items.filter(function(item){return item.qData.info.length>0&&(item.qData.info.some(isCalculatedField)?!1:!0)&&"H"!==item.qData.grouping}).map(function(item){return{title:item.qData.title,fieldName:item.qData.info[0].qName,qId:item.qInfo.qId}}),dfd.resolve()})}),dfd.promise},getFields:function(){var $scope=this.$scope,dfd=new Deferred;return FieldModel.getListLayout().then(function(layout){$scope.fields=layout.map(function(item){return{title:item.qName,qField:item.qName,qTags:item.qTags}}),dfd.resolve()}),dfd.promise},isCalculatedField:function(fieldInfo){return"="===fieldInfo.qName[0]}});return Controller.$inject=["$scope","$document"],qvangular.directive("qvMobileSelections",["$document","qvGlobalSelectionsService","qvListboxPopoverService",function($document,globalSelectionService,qvListboxPopoverService){return{restrict:"E",template:template,controller:Controller,replace:!0,require:["qvMobileSelections"],scope:{},link:function($scope,$element){var popover=null,closeMenu=function(){popover.destroy(),popover=null,$scope.menuActive=!1},keyboardShortcutsGroup=qvKeyboardShortcuts.createGroup("mobile-selections",0);keyboardShortcutsGroup.registerKeys("enter",function(){}),keyboardShortcutsGroup.on(),document.activeElement&&document.activeElement.blur(),$scope.close=function(e){e.preventDefault(),globalSelectionService.off("select")},$scope.selectionsBack=function(){$scope.currentSelectionsModel.back()},$scope.selectionsForward=function(){$scope.currentSelectionsModel.forward()},$scope.selectionsClear=function(){$scope.currentSelectionsModel.clearAll()},$scope.toggleMenu=function(){popover?closeMenu():$scope.enableMenu&&($scope.menuActive=!0,popover=showService.show(menu,{menuItem:{model:$scope.filter},closeMenu:closeMenu}))},$scope.$on("showListbox",function(childScope,item){var initProps={title:item.title,qListObjectDef:{qDef:{}}},showListbox=function(model){$element.children(".qv-ms-searchbox").find("input").blur(),qvListboxPopoverService.show(model,{})};item.qField?Listbox.createTransientField(App.current,item.qField,initProps).then(showListbox):Listbox.createTransientDimension(App.current,item.qId,initProps).then(showListbox)}),$scope.$on("$destroy",function(){popover&&(popover.destroy(),popover=null),keyboardShortcutsGroup["delete"]()})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("text!client.views/global-selections-deactivate/global-selections-deactivate.ng.html",[],function(){return'<div class="qv-global-selections-deactivate" qva-activate="deactivateGlobalSelection()" ng-style="{height: height}">\r\n	\r\n</div>'}),define("client.views/global-selections-deactivate/global-selections-deactivate",["text!./global-selections-deactivate.ng.html","qvangular","client.views/global-selections/global-selections-service"],function(template,qvangular){return{template:template,controller:["$scope","$document","qvGlobalSelectionsService",function($scope,$document,globalSelectionsService){qvangular.getService("$timeout")(function(){$scope.height=$document.find(".qui-toolbar").outerHeight(),$scope.height||($scope.height=$document.find(".qv-panel-current-selections").outerHeight())}),$scope.deactivateGlobalSelection=function(){globalSelectionsService.offAll()}}]}}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div>\r\n    <div class="qv-global-search" ng-class="{ overlay:displaySuggestions || displayResult }" ng-style="{paddingTop: toolbarHeight}" tid="globalSearch">\r\n        <qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\r\n    	<div class="qv-global-search-dimmer" ng-if="query.length > 0" ng-style="{\'max-height\': dimMaxHeight}">     \r\n    		<qv-global-search-result class="qv-global-search-result" tid="globalSearch.ResultList" ng-class="{ \'qv-global-search-result-loader-open\': resultLoaderOpen, \'noresults\' : showNoResultsMessage() }" ></qv-global-search-result>	\r\n    	</div> \r\n    </div>\r\n    <div class="qv-global-search-glass" ng-if="query.length > 0" qva-activate="close();"></div>\r\n</div>\r\n'}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(qvangular,qvKeyboardShortcuts){function GlobalSearchKeyboardShortcuts($element,$scope,searchCtrl){function updateStateIfKeyDown(){var stateFocus=$scope.stateFocus;"input"===stateFocus?stateFocus=$scope.displaySuggestions?"suggestions":$scope.isPartials()?"partials":$scope.displayResult?"results":"start-new-search":"suggestions"===stateFocus?stateFocus=$scope.isPartials()?"partials":$scope.displayResult?"results":"start-new-search":"partials"===stateFocus&&$scope.forcePartials&&(stateFocus="results"),$scope.stateFocus=stateFocus}function updateStateIfKeyUp(){var stateFocus=$scope.stateFocus;"results"===stateFocus&&0===$scope.activeSelectIx?stateFocus=$scope.isPartials()?"partials":$scope.displaySuggestions?"suggestions":"input":"partials"===stateFocus||"start-new-search"===stateFocus?stateFocus=$scope.displaySuggestions?"suggestions":"input":"suggestions"===stateFocus&&(stateFocus="input"),$scope.stateFocus=stateFocus}function isTargetInput(){return"INPUT"===$document[0].activeElement.tagName}function preventAndApply(){qvKeyboardShortcuts.preventDefault(),qvangular.$rootScope.$apply()}function isCaretAtEnd(input){var range,bookmark,caretPos;return document.selection&&document.selection.createRange?(range=document.selection.createRange(),bookmark=range.getBookmark(),
caretPos=bookmark.charCodeAt(2)-2):input.setSelectionRange&&(caretPos=input.selectionStart),caretPos===input.value.length}function handleEsc(){isTargetInput()?"suggestions"===$scope.stateFocus?searchCtrl.hideSuggestions():$scope.query?$scope.query="":$scope.close():$scope.close(),preventAndApply()}function handleLeft(){"suggestions"===$scope.stateFocus&&($scope.activeSuggestionIx=$scope.activeSuggestionIx>0?$scope.activeSuggestionIx-1:$scope.suggestions.length-1,preventAndApply())}function handleRight(){"suggestions"===$scope.stateFocus&&($scope.activeSuggestionIx=($scope.activeSuggestionIx+1)%$scope.suggestions.length,preventAndApply())}function handleUp(){switch(updateStateIfKeyUp(),$scope.stateFocus){case"input":$scope.activeSuggestionIx=-1;break;case"suggestions":$scope.activeSuggestionIx=0,$scope.activeSelectIx=-1;break;case"partials":$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1;break;case"results":$scope.activeSuggestionIx=-1,searchCtrl.moveActiveResult(-1)}preventAndApply()}function handleDown(){switch(updateStateIfKeyDown(),$scope.stateFocus){case"input":$scope.activeSuggestionIx=-1;break;case"suggestions":$scope.activeSuggestionIx=0,$scope.activeSelectIx=-1;break;case"partials":$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1;break;case"results":$scope.activeSuggestionIx=-1,searchCtrl.moveActiveResult(1)}preventAndApply()}function handleEnter(keyset){switch($scope.stateFocus){case"input":$scope.isPartials()?searchCtrl.setShowPartialMatches():$scope.displaySuggestions?handleSelectSuggestion(keyset,!0):$scope.displayResult?searchCtrl.select($scope.searchTerms,0):searchCtrl.startNewSearchFor();break;case"suggestions":handleSelectSuggestion(keyset,!0);break;case"partials":searchCtrl.setShowPartialMatches();break;case"results":$scope.showMeMoreFocus?searchCtrl.loadNextPage():searchCtrl.select($scope.searchTerms,$scope.activeSelectIx);break;case"start-new-search":searchCtrl.startNewSearchFor()}preventAndApply()}function handleSelectSuggestion(keyset,noCheckForEnd){(noCheckForEnd||isCaretAtEnd(input))&&($scope.activeSuggestionIx=-1===$scope.activeSuggestionIx?0:$scope.activeSuggestionIx,$scope.onSuggestSelect()),preventAndApply()}function handleCtrlfCloseSearch(){searchCtrl.closeSearch(),qvKeyboardShortcuts.preventDefault()}var shortcutOptions,shortcutOptionsDelay,input=$element.find("input")[0],$document=qvangular.getService("$document");$scope.stateFocus="input",shortcutOptions={preventDefault:!1,allowInInput:!0,delay:0},shortcutOptionsDelay={preventDefault:!1,allowInInput:!0,delay:75},keyboardShortcutsGroup=qvKeyboardShortcuts.createGroup("global-search",1),keyboardShortcutsGroup.registerKeys("esc",handleEsc,shortcutOptions),keyboardShortcutsGroup.registerKeys("left",handleLeft,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("right",handleRight,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("up",handleUp,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("down",handleDown,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("enter",handleEnter,shortcutOptions),keyboardShortcutsGroup.registerKeys("tab",handleSelectSuggestion,shortcutOptions),keyboardShortcutsGroup.registerKeys("ctrl+f",handleCtrlfCloseSearch,shortcutOptions),keyboardShortcutsGroup.on()}var keyboardShortcutsGroup;return GlobalSearchKeyboardShortcuts.prototype.on=function(){keyboardShortcutsGroup.on()},GlobalSearchKeyboardShortcuts.prototype.off=function(){keyboardShortcutsGroup.off()},GlobalSearchKeyboardShortcuts.prototype["delete"]=function(){keyboardShortcutsGroup["delete"]()},GlobalSearchKeyboardShortcuts}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input" ng-class="{\'focus\': isInputFocused}">\r\n	<div class="search-field-area">\r\n        <label class="search-placeholder" ng-if="query.length === 0" q-translation="GlobalSearch.SearchData"></label>\r\n		<qui-search-field class="search-field" query="query" auto-focus="autoFocus" autocomplete="\'off\'" is-focused="isInputFocused" tid="globalSearch.searchField" />\r\n	</div>\r\n	<div class="search-underlines">\r\n		<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span>\r\n		<qv-global-search-input-hint></qv-global-search-input-hint>\r\n	</div>\r\n</div>'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\r\n'}),define("client.views/global-search/global-search-data-service",["qvangular"],function(qvangular){function addOrEditUnderline(underlines,string,index,isWhitespace){var underline;0!==string.length&&(underlines[index]||(underlines[index]={}),underline=underlines[index],underline.string=string,underline.isWhitespace=isWhitespace||string.length<minimumQueryLength&&!isCJK(string)||'"'===string,underline.colorIx=underline.isWhitespace?-1:colorIx,colorIx=underline.isWhitespace?colorIx:(colorIx+1)%capUnderlineLimit)}function isCJK(str){return str.match(/[\u3040-\u9FBF]/)||str.match(/[\uFF65-\uFF9F]/)}function addSearchTerm(searchTerms,string,startQuote,endQuote){string.length<minimumQueryLength&&!isCJK(string)||searchTerms.push({string:string,startQuote:startQuote,endQuote:endQuote})}function addRange(qRange,ranges,termIx,suggestionText){var i,j,startRange,endRange,startIx,endIx;for(startIx=qRange.qCharPos,endIx=startIx+qRange.qCharCount,i=0;i<ranges.length;++i)if(startRange=ranges[i],!(startIx>=startRange.end)){for(j=i;j<ranges.length;++j)endRange=ranges[j],!(endIx>endRange.end);j--,j-i>1&&ranges.splice(i+1,j-i-1),i===j?ranges.splice(i+1,0,{start:endIx,end:endRange.end,highlight:endRange.highlight,term:endRange.term}):endRange.start=endIx,startRange.end=startIx,ranges.splice(i+1,0,{start:startIx,end:endIx,highlight:!0,term:termIx});break}for(i=ranges.length-1;i>=0;--i)ranges[i].start===ranges[i].end?ranges.splice(i,1):ranges[i].substring=suggestionText.substring(ranges[i].start,ranges[i].end)}var colorIx=0,capUnderlineLimit=6,minimumQueryLength=1,globalSearchActive=!1;qvangular.service("qvGlobalSearchService",function(){this.transformResult=function($scope,searchResultData,groupOffset,associationOffset,groupBaseRowIx){var i,j,k,l,m,searchTermGroup,matchCombination,match,hit,fieldMatch,dataFieldDict,nDisplayValues,data=searchResultData.qResults;for(this.setGlobalSearchActive(!0),$scope.searchTermGroups=$scope.searchTermGroups||[],i=0;i<data.qSearchTermsMatched.length;++i){for($scope.searchTermGroups[groupOffset+i]=$scope.searchTermGroups[groupOffset+i]||[],searchTermGroup=$scope.searchTermGroups[groupOffset+i],searchTermGroup.maxCombinations=0,j=0;j<data.qSearchTermsMatched[i].length;++j){for(searchTermGroup[associationOffset+j]=searchTermGroup[associationOffset+j]||{},matchCombination=searchTermGroup[associationOffset+j],matchCombination.selectIx=data.qSearchTermsMatched[i][j].qId,matchCombination.groupBaseRowIx=groupBaseRowIx,matchCombination.matches=matchCombination.matches||[],matchCombination.nbrMatches=0,k=0;k<data.qSearchTermsMatched[i][j].qFieldMatches.length;++k){for(fieldMatch=data.qSearchTermsMatched[i][j].qFieldMatches[k],matchCombination.matches[k]=matchCombination.matches[k]||{},match=matchCombination.matches[k],match.fieldName=data.qFieldNames[fieldMatch.qField],match.hits=match.hits||[],nDisplayValues=fieldMatch.qValues.length,match.rowIndex=matchCombination.selectIx,match.fieldMatchIndex=k,match.nDisplayValues=nDisplayValues,match.moreHits=fieldMatch.qNoOfMatches-nDisplayValues,matchCombination.nbrMatches+=fieldMatch.qTerms.length,matchCombination.nbrMatches>searchTermGroup.maxCombinations&&(searchTermGroup.maxCombinations=matchCombination.nbrMatches),l=0;nDisplayValues>l;++l)for(match.hits[l]=match.hits[l]||{},hit=match.hits[l],dataFieldDict=data.qFieldDictionaries[fieldMatch.qField].qResult[fieldMatch.qValues[l]],hit.ranges=[{start:0,end:dataFieldDict.qText.length,highlight:!1,term:-1}],m=0;m<dataFieldDict.qRanges.length;++m)addRange(dataFieldDict.qRanges[m],hit.ranges,dataFieldDict.qRanges[m].qTerm%capUnderlineLimit,dataFieldDict.qText,data.qSearchTerms[dataFieldDict.qRanges[m].qTerm]);match.hits.splice(l,match.hits.length-l)}matchCombination.matches.splice(k,matchCombination.matches.length-k)}searchTermGroup.splice(associationOffset+j,searchTermGroup.length-(associationOffset+j)),groupBaseRowIx+=searchTermGroup.length,$scope.nbrLoadedRows=groupBaseRowIx,associationOffset=0}for($scope.searchTermGroups.splice(groupOffset+i,$scope.searchTermGroups.length-(groupOffset+i)),this.setHeaders($scope),$scope.displayResult=!1,i=0;i<$scope.searchTermGroups.length;++i)if($scope.searchTermGroups[i].length>0){$scope.displayResult=!0;break}},this.showMore=function(moreData,match){var data=moreData.qResults;if(1===data.qSearchTermsMatched.length){var dataFieldDict,hit,l,m,fieldMatch=data.qSearchTermsMatched[0][0].qFieldMatches[match.fieldMatchIndex],nDisplayValues=fieldMatch.qValues.length;for(match.nDisplayValues=nDisplayValues,match.moreHits=fieldMatch.qNoOfMatches-nDisplayValues,l=0;nDisplayValues>l;++l)if(!match.hits[l])for(match.hits[l]={},hit=match.hits[l],dataFieldDict=data.qFieldDictionaries[fieldMatch.qField].qResult[fieldMatch.qValues[l]],hit.ranges=[{start:0,end:dataFieldDict.qText.length,highlight:!1,term:-1}],m=0;m<dataFieldDict.qRanges.length;++m)addRange(dataFieldDict.qRanges[m],hit.ranges,dataFieldDict.qRanges[m].qTerm%capUnderlineLimit,dataFieldDict.qText,data.qSearchTerms[dataFieldDict.qRanges[m].qTerm])}},this.setHeaders=function($scope){var group,i,j,maxCols=0;for(i=0;i<$scope.searchTermGroups.length;i++)for(j=0;j<$scope.searchTermGroups[i].length;j++)group=$scope.searchTermGroups[i][j],group.matches.length>maxCols&&(maxCols=group.matches.length);for($scope.columnCount=maxCols,$scope.columnWidth=Math.floor(100/maxCols)+"%",$scope.shadowHeaders=$scope.shadowHeaders||[],$scope.shadowHeaders.splice(0,$scope.shadowHeaders.length-maxCols),i=$scope.shadowHeaders.length;maxCols>i;i++)$scope.shadowHeaders[i]={}},this.transformSuggest=function($scope,searchSuggestData,maxNbr){var i,suggestion,ix=0,underlines=[];for(this.getUnderlinersAndSearchTerms($scope.query,underlines,[]),maxNbr=void 0!==maxNbr?maxNbr:25,maxNbr=Math.min(maxNbr,searchSuggestData.qResult.qSuggestions.length),i=0;maxNbr>i;++i)suggestion={value:searchSuggestData.qResult.qSuggestions[i].qValue,term:searchSuggestData.qResult.qSuggestions[i].qTerm},$scope.query!==this.getResultingQueryFromSuggestion(underlines,suggestion)&&($scope.suggestions[ix]=suggestion,ix++);$scope.suggestions.splice(ix,$scope.suggestions.length-ix)},this._whitespaces=[" ","	","\n","\r","\r\n","　"],this.isWhiteSpaceAt=function(string,charIx){var i,whitespaces=this._whitespaces,ch=string.charAt(charIx);for(i=0;i<whitespaces.length;++i)if(ch===whitespaces[i])return!0;return!1},this.getUnderlinersAndSearchTerms=function(string,underlines,searchTerms){function indexOfNextWhiteSpace(string,startIx){var ix,i,currIx;for(i=0;i<whitespaces.length;++i)ix=string.indexOf(whitespaces[i],startIx),ix>=0&&(!currIx||currIx>ix)&&(currIx=ix);return currIx||-1}function findEndQuoteIndex(string,startIx){var ix;do ix=string.indexOf('"',startIx),startIx=ix+1;while(ix>=0&&end>startIx&&!service.isWhiteSpaceAt(string,startIx));return ix}function nextToken(){for(;end>tempIx&&service.isWhiteSpaceAt(string,tempIx);)tempIx++;tempIx>ix&&addOrEditUnderline(underlines,string.substring(ix,tempIx),next++,!0),ix=tempIx}var sub,ix=0,tempIx=0,end=string.length,next=0,whitespaces=this._whitespaces,service=this;for(searchTerms.length=0,colorIx=0,nextToken();end>ix;)if('"'!==string.charAt(ix)){if(tempIx=indexOfNextWhiteSpace(string,ix),sub=tempIx>=0?string.substring(ix,tempIx):string.substring(ix),addOrEditUnderline(underlines,sub,next++),addSearchTerm(searchTerms,sub,!1,!1),0>tempIx)break;ix=tempIx,nextToken()}else{if(addOrEditUnderline(underlines,string.substring(ix,ix+1),next++),tempIx=findEndQuoteIndex(string,++ix),sub=tempIx>=0?string.substring(ix,tempIx):string.substring(ix),addOrEditUnderline(underlines,sub,next++),addSearchTerm(searchTerms,sub,!0,tempIx>0),0>tempIx)break;addOrEditUnderline(underlines,string.substring(tempIx,tempIx+1),next++),ix=tempIx+=1,nextToken()}underlines.splice(next,underlines.length-next)},this.getSuggestTerms=function(string,searchTerms){function getLastWordInString(string){var endIx,ix,startIx;if(string=string.trim(),0===string.length)return null;for(endIx=string.length,ix=endIx-1,startIx=-1;ix>-1;){if(service.isWhiteSpaceAt(string,ix)){startIx=ix+1;break}ix--}return startIx=Math.max(startIx,0),string.substring(startIx,endIx)}var suggestTerms,lastWord,service=this;return lastWord=getLastWordInString(string),suggestTerms=searchTerms.map(function(searchTerm){return searchTerm.string}),lastWord&&2===lastWord.length&&'"'===lastWord.charAt(0)&&suggestTerms.push(lastWord.charAt(1)),suggestTerms},this.getUnderlineLengthFromTermIx=function(underlines,termIx){for(var underline,ix=0,currentTermIx=0;ix<underlines.length&&(underline=underlines[ix],termIx>currentTermIx||underline.isWhitespace)&&(ix!==underlines.length-1||1!==underline.string.length||this.isWhiteSpaceAt(underline.string,0)||'"'===underline.string);)underline.isWhitespace||currentTermIx++,ix++;return ix>0?ix:0},this.getResultingQueryFromSuggestion=function(underlines,suggestion){var query,quoteAtStart,insert1stQuote,insert2ndQuote,queryLength=this.getUnderlineLengthFromTermIx(underlines,suggestion.term);return query=underlines.slice(0,queryLength).reduce(function(previousValue,underline){return previousValue+underline.string},""),quoteAtStart='"'===query.charAt(query.length-1),insert1stQuote=quoteAtStart?!1:suggestion.value.indexOf(" ")>=0,insert2ndQuote=insert1stQuote||quoteAtStart,query+(insert1stQuote?'"':"")+suggestion.value+(insert2ndQuote?'"':"")},this.getMinQueryLength=function(){return minimumQueryLength},this.setGlobalSearchActive=function(active){globalSearchActive=active},this.isGlobalSearchActive=function(){return globalSearchActive}})}),define("client.views/global-search/directives/input/input",["qvangular","util","text!./input.ng.html","text!./input-hint.ng.html","general.utils/string-normalization","client.views/global-search/global-search-data-service"],function(qvangular,util,inputTemplate,inputHintTemplate,StringNormalization){function isEqual(arr1,arr2){var i;if(arr1.length!==arr2.length)return!1;for(i=0;i<arr1.length;++i)if(arr1[i]!==arr2[i])return!1;return!0}var ongoing=null;qvangular.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchService",function($timeout,searchDataService){return{restrict:"E",replace:!0,template:inputTemplate,require:"^qvGlobalSearch",link:function($scope,$element,$attrs,searchCtrl){var input=$element.find("input"),lastSearch=[],$document=qvangular.getService("$document");input.on("keydown",function(){$scope.ignoreQueryChange=!1}),$scope.autoFocus=!util.isIos()&&!util.isAndroid(),$scope.$watch("query",function(value){var searchStrings,suggestTerms,searchTerms=[];return $timeout.cancel(ongoing),$scope.ignoreQueryChange||searchCtrl.resetSuggestions(),value&&0!==value.length?(searchDataService.getUnderlinersAndSearchTerms(value,$scope.underlines,searchTerms),$scope.ignoreQueryChange?void($scope.ignoreQueryChange=!1):void(ongoing=$timeout(function(){searchDataService.isWhiteSpaceAt(value,value.length-1)||'"'===value.charAt(value.length-1)?searchCtrl.hideSuggestions():(suggestTerms=searchDataService.getSuggestTerms(value,searchTerms),searchCtrl.suggest(suggestTerms)),searchStrings=searchTerms.map(function(searchTerm){return searchTerm.string}),searchTerms.length>0&&!isEqual(searchStrings,lastSearch)?searchCtrl.search(searchStrings):value.length<searchDataService.getMinQueryLength()&&searchCtrl.emptyResult(),lastSearch=searchStrings,ongoing=null},200))):(searchCtrl.emptyResult(),$scope.underlines.length=0,void(lastSearch=[]))}),$scope.$watch("isInputFocused",function(focused){focused&&$document.find("body").animate({scrollTop:$element.offset().top},100)}),$scope.$on("focusInput",function(){input.focus()}),$scope.$on("blurInput",function(){input.blur()}),$scope.$on("$destroy",function(){input.off()})}}}]),qvangular.directive("qvGlobalSearchInputHint",["qvGlobalSearchService",function(searchDataService){return{restrict:"E",replace:!0,template:inputHintTemplate,require:"^qvGlobalSearch",link:function($scope){function updateQueryAndHint(){var suggestTerms,queryLength,normLength,suggest,hint,suggestion=$scope.suggestions[-1===$scope.activeSuggestionIx?0:$scope.activeSuggestionIx],underlines=[],searchTerms=[];searchDataService.getUnderlinersAndSearchTerms($scope.query,underlines,searchTerms),suggestTerms=searchDataService.getSuggestTerms($scope.query,searchTerms),!$scope.displaySuggestions||$scope.suggestions.length<=0||0===suggestTerms.length||(queryLength=searchDataService.getUnderlineLengthFromTermIx(underlines,suggestion.term),suggest=underlines.slice(queryLength).reduce(function(previousValue,underline){return previousValue+(underline.isWhitespace?" ":underline.string)},""),normLength=StringNormalization.string(suggest).length,suggest=StringNormalization.string(suggestion.value).slice(0,normLength),hint=StringNormalization.string(suggestion.value).slice(normLength),$scope.ignoreQueryChange=!0,$scope.hintString=hint)}$scope.$watch("activeSuggestionIx",function(){updateQueryAndHint()}),$scope.$watchCollection("suggestions",function(){updateQueryAndHint()}),$scope.$watch("displaySuggestions",function(){updateQueryAndHint()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div>\r\n\r\n	<qv-global-search-suggest class="qv-global-search-suggest" qv-scroll-to-active="{{activeSelectIx === -1 && stateFocus === \'suggestions\'}}" ></qv-global-search-suggest>	\r\n\r\n	<div ng-if="isPartials()" qv-scroll-to-active="{{stateFocus === \'partials\'}}" class="qv-global-search-result-message search-partials-message">\r\n		<qv-global-search-result-msg></qv-global-search-result-msg>\r\n		<div qva-activate="setShowPartialMatches($event)" tid="globalSearch.showPartialMatches" class="btn-base partial-matches-btn" q-translation="{{ !forcePartials?\'GlobalSearch.ShowPartialMatches\' : \'GlobalSearch.HidePartialMatches\' }}" ng-class="{ \'active\': stateFocus === \'partials\' }" ></div>\r\n	</div>\r\n	\r\n	<div ng-if="displayResult && (!isPartials() || forcePartials)" class="qv-global-search-result-groups">\r\n\r\n		<div ng-if="(outsideSelection || currentSelections)" class="qv-global-search-result-title strong" >\r\n			<span ng-if="outsideSelection && !currentSelections" tid="globalSearch.matchesWholeDataset" q-translation="GlobalSearch.MatchesWholeDataset"></span>\r\n			<span ng-if="currentSelections" tid="globalSearch.addToYourSelections" q-translation="GlobalSearch.AddToYourSelections"></span>\r\n		</div>\r\n\r\n		<!-- Results -->\r\n		<div ng-repeat="searchTermGroup in searchTermGroups">\r\n			<div class="caption-flex" ng-if="searchTermGroup.0.nbrMatches < searchTerms.length" q-translation="GlobalSearch.MatchedSearchTerms,{{searchTermGroup.0.nbrMatches}}"></div>\r\n\r\n			<div class="content-flex" ng-init="parentIndex = $index" ng-class="{ \'touch-off\':!isSmallDevice }" ng-repeat="combination in searchTermGroup" qv-scroll-to-active="{{(combination.groupBaseRowIx + $index === activeSelectIx) && stateFocus === \'results\' }}" tid="globalSearch.resultGroup">\r\n				\r\n				<div class="cell" ng-repeat="match in combination.matches" tid="globalSearch.resultField" ng-class="{ \'maxcell\': !$last && !$first, \'maxcellfirst\': ($first && combination.matches.length > 1) }" >\r\n					\r\n					<div class="group-hits" qva-activate="select( combination, $parentIndex )" ng-style="{\'width\': (isSmallDevice && match.moreHits > 0)? \'80%\': \'100%\'}" ng-class="{ \'open\' : match.mobileExpand }">\r\n						<span class="field-name" tid="globalSearch.resultField.Name">{{match.fieldName}}</span>\r\n						<span ng-repeat="hit in match.hits" tid="globalSearch.resultField.Hit">\r\n							<span ng-repeat="range in hit.ranges track by $index" ng-class="range.highlight ? \'highlighted\' + range.term : \'\'">{{range.substring}}</span>\r\n							<span>{{$last ? \'\' : \', \'}}</span>		\r\n						</span>	\r\n						<div tid="globalSearch.resultField.MoreHits" ng-if="!isSmallDevice && match.moreHits > 0" qva-activate="onShowMoreHits($event, match)" class="more-hits-mobile italic"><span class="more-text" q-translation="GlobalSearch.MoreResults,{{match.moreHits}}"></span></div>		\r\n					</div>\r\n					<div class="more-hits-area" ng-if="isSmallDevice && match.moreHits > 0" tid="globalSearch.resultField.MoreHits"  qva-activate="onShowMoreHits($event, match)"><div class="more-hits-mobile"></div></div>\r\n\r\n				</div>		\r\n			</div>\r\n		</div>	\r\n		\r\n		<!-- show me more button -->\r\n		<div qv-scroll-to-active="{{showMeMoreFocus}}" class="show-me-more"><span ng-if="paging.totalRows > paging.lastRowIx" tid="globalSearch.showmemore" qva-activate="showMeMore($event)" class="btn-base" q-translation="GlobalSearch.ShowMeMore" ng-class="{\'active\': showMeMoreFocus }"></span></div>\r\n\r\n	</div>\r\n\r\n	<qv-global-search-no-results class="search-no-results-message" ng-show="showNoResultsMessage()" ></qv-global-search-no-results>\r\n\r\n	<qv-global-search-throbber></qv-global-search-throbber>\r\n</div>\r\n'}),define("text!client.views/global-search/directives/result/result-message.ng.html",[],function(){return'<div class="qv-global-search-result-message-inline">\r\n    <span ng-if="currentSelections" q-translation="GlobalSearch.NoMatchesWithinCurrentSelection"></span>\r\n    <span ng-if="!currentSelections" q-translation="GlobalSearch.NoMatchesForTheTerms"></span>\r\n    <span ng-repeat="t in searchTerms track by $index">\r\n        <span class="underlined{{$index % capUnderlineMaxNumber}}">{{t}}</span>\r\n        <i ng-if="!$last && $index === searchTerms.length-2" q-translation="GlobalSearch.And"></i><i ng-if="!$last && $index !== searchTerms.length-2">,</i>\r\n    </span> \r\n</div>  '}),define("text!client.views/global-search/directives/result/no-results.ng.html",[],function(){return'<div>\r\n    <div class="qv-global-search-result-groups" ng-if="!error.show">\r\n\r\n        <div class="qv-global-search-result-message" >            \r\n            <qv-global-search-result-msg></qv-global-search-result-msg>\r\n\r\n            <div ng-if="currentSelections && !allSelectionsLocked" tid="globalSearch.newSearchJustFor" qva-activate="searchOutsideSelections($event)" class="btn-base" q-translation="GlobalSearch.NewSearchJustFor,{{query.trim()}}" ng-class="{ \'active\': stateFocus === \'start-new-search\'}"></div>\r\n        </div>\r\n    </div>      \r\n\r\n    <div class="qv-global-search-result-error" ng-if="error.show">\r\n        <span q-translation="{{error.translation}}"></span>\r\n    </div>\r\n</div>'}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","text!./result-message.ng.html","text!./no-results.ng.html","touche"],function(qvangular,template,templateMessage,templateNoResults){qvangular.directive("qvGlobalSearchResult",["$timeout",function($timeout){return{restrict:"E",template:template,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){}},link:function($scope,$element,$attrs,controllers){var searchCtrl=controllers[0],searchResultCtrl=controllers[1];$scope.resultLoaderOpen=!1,$scope.emptyMessageEnabled=!1,$scope.capUnderlineMaxNumber=6,$scope.select=function(combination,$index){Touche.utils.touch?($scope.activeResultIx=$index,$timeout(function(){searchCtrl.select($scope.searchTerms,combination.selectIx)},100)):searchCtrl.select($scope.searchTerms,combination.selectIx)},$scope.loadNextPage=function(){searchCtrl.loadNextPage()},searchResultCtrl.getElement=function(){return $element},$scope.setShowPartialMatches=function(){searchCtrl.setShowPartialMatches()},$scope.showMeMore=function(){searchCtrl.loadNextPage()},$scope.showNoResultsMessage=function(){var res=$scope.emptyMessageEnabled&&$scope.searchTerms.length>0&&!$scope.displayResult&&!$scope.error.show&&!$scope.resultLoaderOpen||$scope.error.show;return res}}}}]),qvangular.directive("qvScrollToActive",function(){return{restrict:"A",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function($scope,$element,$attrs,controllers){function alignTop($container){$container[0].scrollTop=$element[0].offsetTop}function alignBottom(){$element[0].scrollIntoView(!1)}var searchResultCtrl=controllers[1];$attrs.$observe("qvScrollToActive",function(active){if(active=active+""=="true",$element.toggleClass("active",active),active){var $container=searchResultCtrl.getElement(),position=$element.position();position.top<0?alignTop($container):position.top+$element.height()>$container.height()&&alignBottom()}})}}}),qvangular.directive("qvGlobalSearchResultMsg",function(){return{restrict:"E",template:templateMessage,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}}),qvangular.directive("qvGlobalSearchNoResults",function(){return{restrict:"E",template:templateNoResults,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}})}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" ng-if="displaySuggestions" tid="globalSearch.suggestions">\r\n	<span class="hidden">{{query}}</span>\r\n    <div ng-show="isSmallDevice" class="dym" q-translation="GlobalSearch.DidYouMean"></div>\r\n	<ul class="suggest-popup">\r\n		<li ng-repeat="suggest in suggestions track by $index" qv-scroll-to-active-suggestion="{{$index === activeSuggestionIx && stateFocus === \'suggestions\'}}" ng-class="{active: $index === activeSuggestionIx && stateFocus === \'suggestions\'}" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion" bold-suggest=\'{{suggest.value}}\'>\r\n			{{suggest.value}}\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(qvangular,template){qvangular.directive("qvGlobalSearchSuggest",[function(){return{restrict:"E",template:template,replace:!0,require:["^qvGlobalSearch"],link:function(){}}}]),qvangular.directive("qvScrollToActiveSuggestion",function(){return{restrict:"A",require:["^qvGlobalSearch"],link:function($scope,$element,$attrs){$attrs.$observe("qvScrollToActiveSuggestion",function(active){if(active=active+""=="true"){var position=$element.position(),$container=$element.parent();if($element[0].scrollIntoView(!1),position.left<0)$container.scrollLeft($element[0].offsetLeft-$container[0].offsetLeft);else if(position.left+$element.width()>$container.width()){var deltaScroll=position.left+$element.width()-$container.width();$container.scrollLeft($container[0].scrollLeft+deltaScroll)}}})}}})}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="resultLoaderOpen" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader"></div>\r\n</div>'}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvGlobalSearchThrobber",["$timeout",function($timeout){return{replace:!0,template:template,restrict:"E",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function($scope,$element,$attrs,controllers){function checkResetScroll(resetScroll){resetScroll&&(searchResultCtrl.getElement()[0].scrollTop=0)}var timer,searchResultCtrl=controllers[1];$scope.$on("resultLoader",function(event,show,resetScroll){show?($timeout.cancel(timer),timer=$timeout(function(){checkResetScroll(resetScroll),$scope.resultLoaderOpen=!0,$scope.emptyMessageEnabled=!1},1e3)):($timeout.cancel(timer),checkResetScroll(resetScroll),$scope.resultLoaderOpen=!1,$scope.emptyMessageEnabled=$scope.searchTerms.length>0)})}}}])}),define("client.views/global-search/global-search-controller",["jquery","qvangular","core.models/app","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","client.controllers/error-handler-controller","general.utils/responsive-state","client.models/current-selections","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/throbber/throbber","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function($,qvangular,App,GlobalSearchKeyboardShortcuts,enums,ErrorHandler,ResponsiveState,CurrentSelections){function GlobalSearchController($scope,$document,$element,$window){function clickOutside(e){var element=$(e.target);1!==element.closest(".qv-selections-pager").length&&($element.off("qv-outside"),ctrl.closeSearch())}function getSearchContext(){var context="Cleared";return $scope.currentSelections&&(context="CurrentSelections",$scope.lockedSelections&&$scope.lockedSelections.length>0&&(context="LockedFieldsOnly")),context}function getTransformOffset(result){var offset,nbrMatches,lastGroupIx=$scope.searchTermGroups.length-1;return nbrMatches=result.qSearchTermsMatched[0][0].qFieldMatches.reduce(function(count,match){return count+match.qTerms.length},0),offset=$scope.searchTermGroups[lastGroupIx][0].nbrMatches===nbrMatches?lastGroupIx:lastGroupIx+1}function getAssociationOffset(groupOffset){var offset=0;return $scope.searchTermGroups[groupOffset]&&(offset=$scope.searchTermGroups[groupOffset].length),offset}function getGroupBaseRowIx(groupOffset){var groupBaseRowIx,group,groups=$scope.searchTermGroups;return groups[groupOffset]?(group=groups[groupOffset],groupBaseRowIx=group[0].groupBaseRowIx):(group=groups[groupOffset-1],groupBaseRowIx=group[0].groupBaseRowIx+group.length),groupBaseRowIx}var searchDataService=qvangular.getService("qvGlobalSearchService"),$timeout=qvangular.getService("$timeout"),globalSelectionsService=qvangular.getService("qvGlobalSelectionsService"),keyboardShortcuts=new GlobalSearchKeyboardShortcuts($element,$scope,this),state={search:{idCounter:0,state:States.idle,searchTerms:""},result:{state:States.idle},suggest:{idCounter:0,state:States.idle,suggestTerms:""}},responsiveViewListener=function(){$timeout(function(){$scope.isSmallDevice=ResponsiveState.isSmallDevice})},topOffset=$element.offset().top+$element[0].offsetTop,ctrl=this;$scope.isSmallDevice=ResponsiveState.isSmallDevice,ResponsiveState.ViewChanged.bind(responsiveViewListener),$scope.input="input goes here",$scope.result="result goes here",$scope.$on("$destroy",function(){keyboardShortcuts["delete"](),ResponsiveState.ViewChanged.unbind(responsiveViewListener)}),CurrentSelections.get().then(function(cs){$scope.modelSelections=cs}),$scope.$watch(globalSelectionsService.getSelectionCount,function(value){$scope.currentSelections=value&&value>0?!0:!1,$scope.allSelectionsLocked=$scope.currentSelections&&globalSelectionsService.getSelectionLockedCount()===value,ctrl.search($scope.searchTerms)}),$scope.$watch(globalSelectionsService.getSelectionLockedCount,function(value){$scope.allSelectionsLocked=$scope.currentSelections&&globalSelectionsService.getSelectionCount()===value}),$scope.underlines=[],$scope.query="",$scope.searchTerms=[],$scope.searchTermGroups=[],$scope.displayResult=!1,$scope.activeSelectIx=-1,$scope.showMeMoreFocus=!1,$scope.forcePartials=!1,$scope.allSelectionsLocked=!1,$scope.dimMaxHeight=null,$scope.error={show:!1,message:"",description:""},$scope.paging={lastRowIx:0,totalRows:0},$scope.searchOutsideSelections=function(){ctrl.startNewSearchFor()},$scope.onShowMoreHits=function(event,match){if(event.stopPropagation(),!match.disableShowMore){match.disableShowMore=!0,match.mobileExpand=!0;
var page={qOffset:match.rowIndex,qCount:1,qMaxNbrFieldMatches:match.nDisplayValues+15};ctrl.callSearch($scope.searchTerms,page).then(function(data){searchDataService.showMore(data,match)})["finally"](function(){match.disableShowMore=!1})}},$scope.close=function(){ctrl.closeSearch()},$scope.$watch("isInputFocused",function(value){value&&$element.on("qv-outside",clickOutside)}),$scope.suggestions=[],$scope.displaySuggestions=!1,$scope.activeSuggestionIx=-1,$scope.ignoreQueryChange=!1,$scope.onSuggestSelect=function(index){var newQuery,deregister,suggestion,underlines=[];index=void 0!==index?index:$scope.activeSuggestionIx,suggestion=$scope.suggestions[index],searchDataService.getUnderlinersAndSearchTerms($scope.query,underlines,[]),newQuery=searchDataService.getResultingQueryFromSuggestion(underlines,suggestion),newQuery.length>255?(keyboardShortcuts.off(),ErrorHandler.showDialog({message:"ErrorDialog.SearchStringTooLong"}),deregister=$scope.$on("errorHandlerClosed",function(){keyboardShortcuts.on(),deregister()})):($scope.query=newQuery+" ",$scope.ignoreQueryChange=!1),ctrl.hideSuggestions(),$scope.$broadcast("focusInput")},this.hideSuggestions=function(){$scope.displaySuggestions&&($scope.displaySuggestions=!1,this.resetSuggestions())},this.startNewSearchFor=function(){$scope.outsideSelection=!0,$scope.modelSelections.clearAll(),$scope.$broadcast("focusInput"),this.search($scope.searchTerms)},this.setShowPartialMatches=function(){$scope.forcePartials=!$scope.forcePartials,$scope.dimMaxHeight=$scope.forcePartials?$window.innerHeight-topOffset:null,$scope.$broadcast("focusInput")},$scope.isPartials=function(){return $scope.searchTermGroups.length&&$scope.searchTerms.length>$scope.searchTermGroups[0].maxCombinations},this.resetSuggestions=function(){$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1},this.showSuggestions=function(){$scope.displaySuggestions=!0,$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1},this.showError=function(err){$scope.displayResult=!1,$scope.error.show=!0,$scope.error.translation="ErrorCode."+err.error.code,err.isHandled=!0},this.toogleSuggestions=function(show){show?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){$scope.displayResult=!1,$scope.activeSelectIx=-1,$scope.error.show=!1,state.search.state=States.idle,state.suggest.state=States.idle,$scope.searchTerms=[],$scope.searchTermGroups=[],$scope.outsideSelection=!1,$scope.$broadcast("resultLoader",!1),$scope.forcePartials=!1,$scope.stateFocus="input",this.hideSuggestions(),searchDataService.setGlobalSearchActive(!1)},this.moveActiveResult=function(step){$scope.showMeMoreFocus=!1,0!==step&&(step>0?($scope.activeSelectIx=Math.min($scope.activeSelectIx+1,$scope.nbrLoadedRows),$scope.activeSelectIx=Math.min($scope.activeSelectIx,$scope.paging.totalRows-1),$scope.activeSelectIx===$scope.nbrLoadedRows&&($scope.showMeMoreFocus=!0)):0>step&&($scope.activeSelectIx=Math.max($scope.activeSelectIx-1,0)))},this.search=function(searchTerms){function success(data){requestId===state.search.idCounter&&state.search.state===States.pending&&(state.search.state=States.idle,state.search.searchTerms="",$scope.searchTerms=searchTerms,$scope.$broadcast("resultLoader",!1,!0),searchDataService.transformResult($scope,data,0,0,0),$scope.activeSelectIx=-1,$scope.paging.lastRowIx=$scope.searchTermGroups.reduce(function(rowCount,searchTermGroup){return rowCount+searchTermGroup.length},0),$scope.paging.totalRows=data.qResults.qTotalSearchResults)}function error(err){err.error.code===enums.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(self.emptyResult(),self.showError(err)),err.error.code!==enums.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(state.search.state=States.idle,state.search.searchTerms="",$scope.$broadcast("resultLoader",!1),$scope.displayResult=!1)}if($scope.dimMaxHeight=$window.innerHeight-topOffset,$scope.stateFocus="input",0!==searchTerms.length){state.search.idCounter=state.search.idCounter+1;var requestId=state.search.idCounter,self=this,page={qOffset:0,qCount:5,qMaxNbrFieldMatches:5};state.search.state=States.pending,state.search.searchTerms=searchTerms,$scope.$broadcast("resultLoader",!0,!0),$scope.error.show=!1,this.callSearch(searchTerms,page).then(success,error)}},this.loadNextPage=function(){$scope.dimMaxHeight=$element.find(".qv-global-search-dimmer").height();var page={qOffset:$scope.paging.lastRowIx,qCount:5,qMaxNbrFieldMatches:5};state.result.state===States.idle&&(state.result.state=States.pending,$scope.showMeMoreFocus=!1,this.callSearch($scope.searchTerms,page).then(function(data){var groupOffset=getTransformOffset(data.qResults),associationOffset=getAssociationOffset(groupOffset),groupBaseRowIx=getGroupBaseRowIx(groupOffset);searchDataService.transformResult($scope,data,groupOffset,associationOffset,groupBaseRowIx),$scope.paging.lastRowIx=$scope.searchTermGroups.reduce(function(rowCount,searchTermGroup){return rowCount+searchTermGroup.length},0)})["finally"](function(){state.result.state=States.idle}))},this.callSearch=function(searchTerms,page){var options={qContext:getSearchContext()},request=App.current.rpc("SearchAssociations",null,[options,searchTerms,page]);return request},this.closeSearch=function(){$element.off("qv-outside"),$scope.isSmallDevice?(ctrl.emptyResult(),$scope.query="",$scope.$broadcast("blurInput")):globalSelectionsService.toggleGlobalSearch()},this.suggest=function(suggestTerms){function success(data){state.suggest.suggestTerms="",searchDataService.isWhiteSpaceAt($scope.query,$scope.query.length-1)||'"'===$scope.query.charAt($scope.query.length-1)||(requestId===state.suggest.idCounter&&state.suggest.state===States.pending&&(searchDataService.transformSuggest($scope,data,10),self.toogleSuggestions($scope.suggestions.length>0),$scope.$broadcast("suggestShow",!0,!0)),state.suggest.state=States.idle)}function error(err){err.error.code===enums.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(err.isHandled=!0),err.error.code!==enums.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(state.suggest.state=States.idle,state.suggest.suggestTerms="")}if(0!==suggestTerms.length){var self=this;state.suggest.idCounter=state.suggest.idCounter+1;var requestId=state.suggest.idCounter;state.suggest.state=States.pending,state.suggest.suggestTerms=suggestTerms,App.current.rpc("SearchSuggest",null,[{},suggestTerms]).then(success,error)}},this.select=function(terms,selectIx){if($scope.$broadcast("blurInput"),0!==terms.length&&0!==$scope.searchTermGroups.length){0>selectIx&&(selectIx=$scope.activeSelectIx=0);var options={qContext:getSearchContext()};App.current.rpc("SelectAssociations",null,[options,terms,selectIx]),this.emptyResult(),$scope.query="",$scope.$broadcast("focusInput")}},this.setTestSearchTermGroups=function(groups){$scope.searchTermGroups=groups}}var States={idle:0,pending:1};return GlobalSearchController}),define("client.views/global-search/global-search",["qvangular","text!./global-search.ng.html","client.views/global-search/global-search-controller"],function(qvangular,template,GlobalSearchController){return qvangular.directive("qvGlobalSearch",function(){return{restrict:"E",template:template,controller:["$scope","$document","$element","$window",GlobalSearchController],require:["qvGlobalSearch"],scope:{},replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-selections/global-selections-service",["jquery","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.views/global-selections-deactivate/global-selections-deactivate","client.views/global-search/global-search","client.utils/state","general.utils/responsive-state","core.models/app","client.views/selection-toolbar/selection-toolbar-service"],function($,qvangular,desktopComponent,mobileComponent,deactivate,searchComponent,State,ResponsiveState,App){qvangular.service("qvGlobalSelectionsService",["$document","$timeout","qvSelectionToolbarService",function($document,$timeout,selectionToolbarService){function openComponentsCount(){var keys=Object.keys(components),count=0;return keys.forEach(function(key){components[key].$container&&count++}),count}function closeSearchWhenNotAnalysisStateOrInObjectView(){(!State.isInAnalysisMode||State.inObjectView())&&removeComponent(components.search)}function updateResponsiveView(){removeComponent(components.select),setupComponent(components.select)}function setupComponent(component){component.$container=angular.element("<div>"),component.$containerId?$document.find(component.$containerId).append(component.$container):$document.find("body").append(component.$container),component.$container.showComponent(component.getComponent()),$deactivateContainer||ResponsiveState.isSmallDevice||($deactivateContainer=angular.element("<div>"),$document.find("body").append($deactivateContainer),$deactivateContainer.showComponent(deactivate)),component.setup()}function removeComponent(component){component.$container&&(component.$container.remove(),component.$container=void 0),$deactivateContainer&&0===openComponentsCount()&&($deactivateContainer.remove(),$deactivateContainer=void 0),component.destroy()}function isOpen(component){return component.$container?!0:!1}function toggleComponent(component){isOpen(component)?(removeComponent(component),$("body").removeClass("qv-global-selections-enabled")):(State.state===State.States.snapshot&&State.setState(State.States.analysis),$("body").addClass("qv-global-selections-enabled"),setupComponent(component))}var $deactivateContainer,service,components={select:{$container:void 0,getComponent:function(){return ResponsiveState.isSmallDevice?mobileComponent:desktopComponent},setup:function(){ResponsiveState.ViewChanged.bind(updateResponsiveView)},destroy:function(){ResponsiveState.ViewChanged.unbind(updateResponsiveView)}},search:{$container:void 0,$containerId:"#qv-global-search-container",getComponent:function(){return searchComponent},setup:function(){State.StateChanged.bind(closeSearchWhenNotAnalysisStateOrInObjectView),App.current.isModal()&&selectionToolbarService.confirm()},destroy:function(){State.StateChanged.unbind(closeSearchWhenNotAnalysisStateOrInObjectView)}}},csShowCallback=null,selectionCount=0,selectionLockedCount=0,globalSearchService=qvangular.getService("qvGlobalSearchService");return service={toggleGlobalSelection:function(){toggleComponent(components.select)},toggleGlobalSearch:function(){$timeout(function(){toggleComponent(components.search)})},openGlobalSearch:function(){components.search.$container||(removeComponent(components.search),setupComponent(components.search))},closeGlobalSearchIfNotActive:function(){globalSearchService.isGlobalSearchActive()||this.off("search")},off:function(key){var component=components[key];removeComponent(component)},offAll:function(){var me=this,keys=Object.keys(components);keys.forEach(function(key){me.off(key)})},isSelectActive:function(){return void 0!==components.select.$container},isSearchActive:function(){return void 0!==components.search.$container},setCsShowCallback:function(callback){csShowCallback=callback},setCsShow:function(show){csShowCallback&&csShowCallback(show)},setSelectionCount:function(n){selectionCount=n},getSelectionCount:function(){return selectionCount},setSelectionLockedCount:function(n){selectionLockedCount=n},getSelectionLockedCount:function(){return selectionLockedCount}}}])}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount">\r\n	<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\r\n	<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\r\n	<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\r\n	<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\r\n</div>'}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStateCountBar",function(){return{restrict:"E",template:template,scope:{cardinal:"=",stateCounts:"="},link:function($scope){function updateScope(){var percents,cardinal=$scope.cardinal,stateCounts=$scope.stateCounts;void 0!==cardinal&&void 0!==stateCounts&&(percents=getPercents(cardinal,stateCounts),$scope.percents=validatePercents(percents))}function getPercents(cardinal,stateCounts){var percents={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(state){var count=stateCounts[state]||0,percent=Math.round(count/cardinal*100);count>0&&0===percent&&(percent=1),percents[state]=percent}),percents}function validatePercents(rawPercents){var key,maxKey,percents={},total=0;for(key in rawPercents)percents[key]=rawPercents[key],(!maxKey||rawPercents[key]>rawPercents[maxKey])&&(maxKey=key),total+=rawPercents[key];return total>100&&(percents[maxKey]=rawPercents[maxKey]-(total-100)),percents}$scope.percents=[],$scope.$watch("cardinal",function(){updateScope()}),$scope.$watchCollection("stateCounts",function(){updateScope()})}}})}),define("client.views/current-selections/current-selections",["qvangular","text!./current-selections.ng.html","client.models/current-selections","core.utils/resize","general.utils/responsive-state","client.utils/state","core.models/app","objects/listbox-popover/listbox-popover-service","general.components/pager/pager","client.views/global-selections/global-selections-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service"],function(qvangular,template,CurrentSelections,resize,ResponsiveState,State,App){"use strict";function createPlaceHolder(placeholderObj,field){return placeholderObj.isPlaceHolder=!0,placeholderObj.active=!1,placeholderObj.qLocked=!1,placeholderObj.feedbackActive=!1,placeholderObj.translation="",placeholderObj.qTotal=0,placeholderObj.qStateCounts=0,field&&(placeholderObj.qField=field),placeholderObj}qvangular.directive("qvSelectionPager",["qvGlobalSelectionsService","$timeout",function(globalSelectionService,$timeout){return{restrict:"A",priority:1,link:function(scope){var isSelectActiveListner=scope.$watch(globalSelectionService.isSelectActive,function(active){scope.$emit("globalSelectionActive",active),$timeout(function(){scope.refreshPager(!1)})});resize.on("end",scope.refreshPager),scope.$on("$destroy",function(){isSelectActiveListner()})}}}]);var component={template:template,replace:!0,restrict:"E",scope:{appName:"@"},link:function($scope){var $timeout=qvangular.getService("$timeout"),globalSelectionService=qvangular.getService("qvGlobalSelectionsService"),updateResponsiveView=function(){$timeout(function(){$scope.isSmallDevice=ResponsiveState.isSmallDevice})},stateChangeListener=function(){State.inSheetView()&&ResponsiveState.isSmallDevice&&globalSelectionService.openGlobalSearch()};$scope.isSmallDevice=ResponsiveState.isSmallDevice,$scope.cachedPlaceHolders=[],ResponsiveState.ViewChanged.bind(updateResponsiveView),$scope.$watch("isSmallDevice",function(isSmallDevice){isSmallDevice===!0?globalSelectionService.openGlobalSearch():globalSelectionService.closeGlobalSearchIfNotActive()}),State.StateChanged.bind(stateChangeListener),$scope.mobileIndicatorTop=!1,$scope.mobileIndicatorShow=!1,globalSelectionService.setCsShowCallback(function(show){$scope.mobileIndicatorShow=show}),$scope.$on("globalSelectionActive",function(childScope,active){$scope.isGlobalSelectionsActive=active}),App.get($scope.appName).then(function(app){$scope.$watch(app.isModal.bind(app),function(inSelection){$scope.inSelection=inSelection,$scope.inSelection&&$scope.activeFieldName&&$scope.activeFieldName.length>0?$scope.cachedPlaceHolders=$scope.items.map(function(item){return createPlaceHolder({},item.qField)}):($scope.cachedPlaceHolders=[],$scope.items=$scope.items.filter(function(item){return!item.isPlaceHolder}))})}),$scope.$watch(globalSelectionService.isSearchActive,function(active){$scope.isGlobalSearchActive=active}),$scope.toggleGlobalSelection=function($event){$event.preventDefault(),globalSelectionService.toggleGlobalSelection()},$scope.toggleGlobalSearch=function(){globalSelectionService.toggleGlobalSearch()},$scope.$on("$destroy",function(){ResponsiveState.ViewChanged.unbind(updateResponsiveView),globalSelectionService.off("search"),State.StateChanged.unbind(stateChangeListener),globalSelectionService.setCsShowCallback(null)})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function($scope,$timeout,chartTooltipService,globalSelector,currentSelectionsService){function toggleGlobalSelector(){globalSelector.setCsShow(ResponsiveState.isSmallDevice&&$scope.items.length>0&&State.view!==State.Views.object)}var tooltipTimeout,rootScopeListener,tooltipOpen=!1,listboxPopoverService=qvangular.getService("qvListboxPopoverService");$scope.items=[],$scope.disable={clear:!0,back:!0,forward:!0},CurrentSelections.get().then(function(cs){$scope.model=cs}),CurrentSelections.bindLayout($scope,"model",function(layout){$scope.disable.clear=0===layout.qSelectionObject.qSelections.length||layout.qSelectionObject.qSelections.every(function(selection){return selection.qLocked}),$scope.disable.back=0===layout.qSelectionObject.qBackCount,$scope.disable.forward=0===layout.qSelectionObject.qForwardCount,$scope.items=layout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex});var lockedSelectionsCount=0;$scope.items.forEach(function(item){item.qLocked===!0&&lockedSelectionsCount++,item.translation=currentSelectionsService.translate(item)}),$scope.nbrSelections=$scope.items.length,globalSelector.setSelectionLockedCount(lockedSelectionsCount),globalSelector.setSelectionCount($scope.items.length),toggleGlobalSelector(),$scope.cachedPlaceHolders.length>0&&$scope.activeFieldName&&$scope.activeFieldName.length>0&&($scope.cachedPlaceHolders.forEach(function(item){item=createPlaceHolder(item)}),$scope.items.forEach(function(item){$scope.cachedPlaceHolders.forEach(function(placeHolder,j){item.qField===placeHolder.qField&&($scope.cachedPlaceHolders[j]=item)})}),$scope.items=$scope.cachedPlaceHolders),$timeout(function(){$scope.$broadcast("refreshPager")})}),$scope.$watch(State.inObjectView,toggleGlobalSelector),$scope.$watch("isSmallDevice",toggleGlobalSelector),$scope.clear=function(fieldName){$scope.$parent.itemSelected&&($scope.$parent.itemSelected=!1),$scope.model.clearField(fieldName)},$scope.clearAllFields=function(){$scope.model.clearAll()},$scope.back=function(){$scope.model.back()},$scope.forward=function(){$scope.model.forward()},$scope.showPopover=function($event){var $element=angular.element($event.target).closest(".item"),fieldName=$element.scope().item.qField,popoverOptions={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:$element,showLock:!0};return $scope.isClearSelectionIcon($event.target)?void($scope.activeFieldName&&(listboxPopoverService.close(),$scope.activeFieldName="")):fieldName===$scope.activeFieldName?(listboxPopoverService.close(),void($scope.activeFieldName="")):($timeout(function(){$scope.closeTooltip()},100),$scope.activeFieldName=fieldName,void listboxPopoverService.showField(fieldName,$scope.model.session.currentApp,popoverOptions,{},function(){$scope.activeFieldName="",$timeout(function(){$scope.closeTooltip()},100)}))},$scope.openTooltip=function($event,item){return $scope.isClearSelectionIcon($event.target)?void $scope.closeTooltip():void(tooltipOpen||Touche.utils.touch||($scope.cancelTooltip(),tooltipTimeout=$timeout(function(){var selectedCount=item.qStateCounts.qSelected+item.qStateCounts.qSelectedExcluded+item.qStateCounts.qLocked+item.qStateCounts.qLockedExcluded;tooltipOpen=!0,chartTooltipService.open({content:[{header:item.qField+" ("+selectedCount+"/"+item.qTotal+")",rows:[{content:item.translation}]}],position:{x:$event.clientX,y:$event.clientY},direction:"bottom",template:"generic"})},500)))},$scope.closeTooltip=function(){tooltipOpen=!1,$scope.cancelTooltip(),chartTooltipService.close()},$scope.cancelTooltip=function(){$timeout.cancel(tooltipTimeout)},$scope.isClearSelectionIcon=function(element){return angular.element(element).closest(".remove").is(".remove")},rootScopeListener=qvangular.$rootScope.$on("locked-feedback",function(event,args){$scope.items.forEach(function(element){-1!==args[0].indexOf(element.qField)&&(args[1]?element.feedbackActive=!1:element.feedbackActive=!0,qvangular.$apply($scope))})}),$scope.$on("$destroy",function(){rootScopeListener()})}]};return qvangular.directive("qvStageCurrentSelections",function(){return component}),component}),"undefined"==typeof Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var matches=this.toString().match(/^function( (.*?))?\(/);return matches&&matches.length>=3?matches[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(e){return-1!==this.indexOf(e)}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("extensions.qliktech/straight-table/straight-table-properties",["client.property-panel/default-properties","util","general.utils/property-resolver","translator"],function(defaultProperties,util,propertyResolver,translator){var textAlignItems={textAlignAuto:{ref:"qDef.textAlign.auto",type:"boolean",component:"switch",translation:"Common.Text.TextAlignment",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},textAlign:{ref:"qDef.textAlign.align",type:"string",component:"dropdown",options:[{value:"left",translation:"Common.Text.AlignLeft"},{value:"right",translation:"Common.Text.AlignRight"}],defaultValue:"left",show:function(data){return void 0!==data.qDef.textAlign&&!data.qDef.textAlign.auto}}},measureItems={tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(itemData){void 0===itemData.qAttributeExpressions[0]&&(itemData.qAttributeExpressions[0]={})}},totalsAggr:{type:"items",items:{totalsAggrFunc:{type:"string",component:"dropdown",ref:"qDef.qAggrFunc",translation:"Object.Table.AggrFunc",options:[{value:"Expr",translation:"Common.Auto"},{value:"Avg",translation:"Object.Table.AggrFunc.Avg"},{value:"Count",translation:"Object.Table.AggrFunc.Count"},{value:"Max",translation:"Object.Table.AggrFunc.Max"},{value:"Min",translation:"Object.Table.AggrFunc.Min"},{value:"Sum",translation:"Object.Table.AggrFunc.Sum"},{value:"None",translation:"Object.Table.AggrFunc.None"}],defaultValue:"Expr"},totalsAggrFuncMessage:{component:"text",translation:"Object.Table.AggrFuncMessage",show:function(data,handler){return handler&&!propertyResolver.getValue(handler,"properties.totals.show")&&"noTotals"===propertyResolver.getValue(handler,"properties.totals.position")}}}}},settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{totals:{ref:"totals.show",type:"boolean",translation:"properties.totals",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},totalsMode:{ref:"totals.position",translation:"Common.Position",type:"string",component:"dropdown",options:[{value:"noTotals",translation:"Common.None"},{value:"top",translation:"Common.Top"},{value:"bottom",translation:"Common.Bottom"}],defaultValue:"noTotals",show:function(data){return!data.totals.show}},totalsLabel:{ref:"totals.label",translation:"properties.totals.label",type:"string",expression:"optional",defaultValue:function(){return translator.get("Object.Table.Totals")}}}}}},addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},data={type:"items",component:"columns",translation:"Common.Data",sortIndexRef:"qHyperCubeDef.columnOrder",allowMove:!0,allowAdd:!0,addTranslation:"Common.Columns",items:{dimensions:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",grouped:!0,items:util.extend(!0,{},defaultProperties.dimensions.items,textAlignItems)},measures:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",grouped:!0,items:util.extend(!0,{},defaultProperties.measures.items,measureItems,textAlignItems)}}},sorting={uses:"sorting"};return{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("text!extensions.qliktech/straight-table/straight-table.ng.html",[],function(){return'<div class="qv-st" ng-class="{ \'qv-st-interactive\': interactive,\r\n	\'align-column-picker\': scrollApi.settings.columnPicker.show,\r\n	\'qv-st-selections-active\': selections.active,\r\n	\'qv-st-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled\r\n	}"\r\n	 ng-style="fontScale">\r\n	<qv-straight-table-top-header on-sort-header="sort(header);" on-search="search($alignTo,header)"></qv-straight-table-top-header>\r\n	<qv-scroll-area class="qv-grid-object-scroll-area qv-animate">\r\n		<qv-straight-table-data qv-selections-select-while-locked="selectWhileLocked()"\r\n								qv-selections-toggle-dimension-value="{ selector: \'.qv-st-data-cell\'}"\r\n								qv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\r\n								qv-selections-multiselect="{ selector: \'.qv-st-data-cell:not(.qv-st-data-cell-null-value)\' }"\r\n								qv-selections-start-multiselect="interactive && activateSelections(cell)"\r\n								qv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\r\n								qv-selections-end-multiselect="interactive && multiselect()"></qv-straight-table-data>\r\n	</qv-scroll-area>\r\n	<qv-straight-table-bottom-header></qv-straight-table-bottom-header>\r\n	<qv-scroll-loader></qv-scroll-loader>\r\n	<qv-straight-table-column-picker-activator ng-if="scrollApi.settings.columnPicker.show"></qv-straight-table-column-picker-activator>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/snapshot/snapshot-helper",["jquery"],function($){function getIndexHeightAndWidth(rows,nbrOfColumns,scrollAreaBoundingBox){for(var topRow,bottomRow,bottomLimit=scrollAreaBoundingBox.top+scrollAreaBoundingBox.height,i=0;i<rows.length;){if($(rows[i]).offset().top+$(rows[i]).height()>scrollAreaBoundingBox.top){topRow=rows[i];break}i++}for(i=rows.length-1;i>=0;){if($(rows[i]).offset().top<bottomLimit){bottomRow=rows[i];break}i--}if(!topRow||!bottomRow||0>=nbrOfColumns)return{index:1,height:1,width:1};var topRowIndex=$(topRow).scope().row.getIndex(),bottomRowIndex=$(bottomRow).scope().row.getIndex();return{index:topRowIndex,height:bottomRowIndex-topRowIndex+1,width:nbrOfColumns}}function scaleDynamically($scope){if(!$scope.layout.snapshotData||$scope.layout.snapshotData.object.freeResize)return void delete $scope.dataTableHeight;var objectHeight=$scope.object.objectSize.h,scale=objectHeight/$scope.layout.snapshotData.object.size.h,origDataTableHeight=$scope.layout.snapshotData.object.dataTableHeight;$scope.dataTableHeight={height:origDataTableHeight*scale+"px","max-height":60*scale+"px"}}return{scaleDynamically:scaleDynamically,getIndexHeightAndWidth:getIndexHeightAndWidth}}),define("objects.grid/data-grid",["core.utils/class"],function(Class){var DataGrid,ClassList,Cell,Row,StraightCell,PivotCell,RowList;return ClassList=Class.extend("ClassList",{init:function(){this.classList=[]},addClass:function(className){if(className){var ix=this.classList.indexOf(className);return-1===ix&&this.classList.push(className),this}},removeClass:function(className){if(className){var ix=this.classList.indexOf(className);return-1!==ix&&this.classList.splice(ix,1),this}},hasClass:function(className){return-1!==this.classList.indexOf(className)}}),Cell=ClassList.extend("Cell",{init:function(){this._super.apply(this,arguments),this.setDefaults()},setDefaults:function(){this.classList.length=0,this.style={},this.color={},this.colspan=1,this.rowspan=1,this.text="",this.dataValue=-1,this.dataValue=-1,this.dataColIx=-1,this.dataRowIx=-1,this.isDimensionValue=!1,this.type=void 0,this.locked=!1,this.isNullValue=!1,this.tid="",this.fieldName=""},setData:function(text,rowspan,colspan,dataRowIx,dataColIx){this.text=text,this.rowspan=rowspan||1,this.colspan=colspan||1,this.dataRowIx=dataRowIx||-1,this.dataColIx=dataColIx||-1},setHeader:function(text,dataValue,rowspan,colspan,dataRowIx,dataColIx,isNullCell){this.text=text,this.dataValue=dataValue,this.rowspan=rowspan||1,this.colspan=colspan||1,this.dataRowIx=dataRowIx,this.dataColIx=dataColIx,this.templateSrc="pt-header-cell-item.ng.html",this.addClass("header"),this.setNullClass(isNullCell)},setTopHeader:function(){this.setHeader.apply(this,arguments),this.addClass("top")},setLeftHeader:function(){this.setHeader.apply(this,arguments),this.addClass("left")},setFromMetaHeader:function(metaHeader){Object.keys(metaHeader).forEach(function(key){this[key]=metaHeader[key]},this)},setNullClass:function(isNullCell){isNullCell&&(this.isNullValue=isNullCell,this.addClass("null-value"))}}),StraightCell=Cell.extend("StraightCell",{setDefaults:function(){this._super.apply(this,arguments),this.isNumeric=!1,this.textAlign="left",this.color.bgByExpression=!1,this.color.bgIsDark=!1,this.selected=!1,this.selectedHighlighted=!1,this.qvaOutsideIgnoreFor="",this.isSearchIcon=!1,this.open=!1,this.sortable=!1,this.isMeasure=!1,this.isSorted=!1,this.reversed=!1,this.isTotal=!1,this.isSelectLocked=!1}}),PivotCell=Cell.extend("PivotCell",{setDefaults:function(){this._super.apply(this,arguments),this.templateSrc="pt-cell-item.ng.html",this.collapseExpandClass="",this.isMeta=!1},setCollapseExpandClass:function(node){this.addClass("parent"),node.qCanExpand?this.collapseExpandClass="icon-add":node.qCanCollapse&&(this.collapseExpandClass="icon-remove")},setEmpty:function(rowspan,colspan,positionClass){this.setHeader("",-4,rowspan,colspan),this.addClass("empty"),this.addClass(positionClass)}}),Row=ClassList.extend("Row",{init:function(gridType){this._super.apply(this,arguments),this.cells=[],this.style={},this.isBold=!1,this.classList=[],this.gridType=gridType,this.reset()},getIndex:function(){var c,i;for(i=0;i<this.cells.length;++i)if(c=this.cells[i],c.dataRowIx>=0)return c.dataRowIx;return-1},setNextCellIx:function(ix){this.nextCellIx=ix},reset:function(keepClasses){var i;for(this.nextCellIx=0,this.isBold=!1,keepClasses||(this.classList=[]),i=0;i<this.cells.length;++i)this.cells[i].setDefaults()},removeUnused:function(){this.cells.splice(this.nextCellIx,this.cells.length-this.nextCellIx)},_createCell:function(){switch(this.gridType){case"pivot":return new PivotCell;default:return new StraightCell}},getCell:function(ix){return this.cells[ix]||(this.cells[ix]=this._createCell()),this.cells[ix]},getNextCell:function(){var cell;return this.cells[this.nextCellIx]?(cell=this.cells[this.nextCellIx],cell.setDefaults()):cell=this.cells[this.nextCellIx]=this._createCell(),
this.nextCellIx++,cell},getCellSize:function(){return this.nextCellIx},addEmptyHeaderCell:function(dataRowIx,dataColIx,rowspan,colspan,positionClass,isNullCell){var cell=this.getNextCell();return cell.setEmpty(rowspan,colspan,positionClass),cell.setData("",rowspan,colspan,dataRowIx,dataColIx),cell.setNullClass(isNullCell),cell},addEmptyMetaCell:function(rowspan,colspan,positionClass){var cell=this.addEmptyHeaderCell(-1,-1,rowspan,colspan,positionClass);return cell.isMeta=!0,cell},addEmptyDataCell:function(rowspan,colspan){var cell=this.getNextCell();return cell.setData("",-4,rowspan,colspan),cell.addClass("empty"),cell},addTotalCell:function(text,rowspan,colspan){var cell=this.getNextCell();return cell.setHeader(text,-1,rowspan,colspan),cell.addClass("bold"),this.addClass("bold"),cell},addLeftCollapseExpandCell:function(dataRowIx,dataColIx,node,isNullCell){var cell=this.getNextCell();return cell.setLeftHeader("",-1,1,1,dataRowIx,dataColIx),cell.setCollapseExpandClass(node),cell.setNullClass(isNullCell),cell}}),RowList=Class.extend("RowList",{init:function(gridType){this.rows=[],this.gridType=gridType},reset:function(keepClasses){this.rows.forEach(function(row){row.reset(keepClasses)}),this.nextRowIx=0},get:function(ix){return this.rows[ix]||(this.rows[ix]=new Row(this.gridType)),this.rows[ix]},getNext:function(){var row=this.get(this.nextRowIx);return this.nextRowIx++,row},removeUnused:function(){this.rows.splice(this.nextRowIx,this.rows.length-this.nextRowIx),this.rows.forEach(function(row){row.removeUnused()})},setNextRowIx:function(ix){this.nextRowIx=ix}}),DataGrid=Class.extend("DataGrid",{init:function(gridType){this.headerList=new RowList(gridType),this.rowList=new RowList(gridType),this.footerList=new RowList(gridType),this.gridType=gridType,this.reset()},setTopTreeDepth:function(topTreeDepth){this.topTreeDepth=topTreeDepth},setLeftTreeDepth:function(leftTreeDepth){this.leftTreeDepth=leftTreeDepth},reset:function(suppressResetHeaders,keepClasses){this.rowList.reset(),suppressResetHeaders||(this.headerList.reset(keepClasses),this.footerList.reset(keepClasses)),this.topTreeDepth=-1,this.leftTreeDepth=-1},getRowsByCellType:function(cellType){var rows=[];return rows=cellType===this.CELL_TYPE_DATA||cellType===this.CELL_TYPE_LEFT?this.rows:this.headerRows},getRow:function(ix){return this.rowList.get(ix)},getHeaderRow:function(ix){return this.headerList.get(ix)},getFooterRow:function(ix){return this.footerList.get(ix)},getNextRow:function(){return this.rowList.getNext()},getNextHeaderRow:function(){return this.headerList.getNext()},getNextFooterRow:function(){return this.footerList.getNext()},getCell:function(rowIx,colIx){return this.getRow(rowIx).getCell(colIx)},getHeaderCell:function(rowIx,colIx){return this.getHeaderRow(rowIx).getCell(colIx)},getFooterCell:function(rowIx,colIx){return this.getFooterRow(rowIx).getCell(colIx)},removeUnused:function(){this.rowList.removeUnused(),this.headerList.removeUnused(),this.footerList.removeUnused()},getNextRowIx:function(){return this.rowList.nextRowIx},setNextRowIx:function(ix){this.rowList.setNextRowIx(ix)},setNextHeaderIx:function(ix){this.headerList.setNextRowIx(ix)}}),Object.defineProperties(DataGrid.prototype,{headerRows:{get:function(){return this.headerList.rows}},footerRows:{get:function(){return this.footerList.rows}},rows:{get:function(){return this.rowList.rows}},GRID_TYPE_STRAIGHT:{get:function(){return"straight"}},GRID_TYPE_PIVOT:{get:function(){return"pivot"}},CELL_TYPE_TOP:{get:function(){return"top"}},CELL_TYPE_LEFT:{get:function(){return"left"}},CELL_TYPE_DATA:{get:function(){return"data"}}}),DataGrid}),define("objects.grid/services/data-service",["qvangular","translator","general.utils/color"],function(qvangular,translator,Color){"use strict";function getColumnOrder(dimensions,measures){var i,columnOrder=[],dimCnt=dimensions.length,measCnt=measures.length;for(i=0;dimCnt>i;++i)columnOrder.push(i);for(i=0;measCnt>i;++i)columnOrder.push(dimCnt+i);return columnOrder}function getColumnCells(grid,colIx){var i,rowCnt,cellCnt,row,cells=[];for(rowCnt=grid.rows.length,i=0;rowCnt>i;++i)row=grid.rows[i],cellCnt=row.cells.length,cellCnt>colIx&&colIx>=0&&cells.push(row.cells[colIx]);return cells}function getCellsInColumnWithValue(grid,cellType,dataColIx,dataValue){var cell,i,allCells=getCellsInColumn(grid,cellType,dataColIx),cellCnt=allCells.length,cells=[];for(i=0;cellCnt>i;++i)cell=allCells[i],cell.dataValue===dataValue&&cells.push(cell);return cells}function getCellsInColumn(grid,cellType,dataColIx){var i,j,row,colCnt,rows=grid.getRowsByCellType(cellType),rowCnt=rows.length,cell=null,cells=[];for(i=0;rowCnt>i;++i)for(row=rows[i],colCnt=row.cells.length,j=0;colCnt>j;++j)cell=row.cells[j],cell.type===cellType&&cell.dataColIx===dataColIx&&cells.push(cell);return cells}function getCellsInRow(grid,cellType,dataRowIx){var i,j,row,cell,cellCnt,rows=grid.getRowsByCellType(cellType),rowCnt=rows.length,cells=[];for(i=0;rowCnt>i;++i)for(row=rows[i],cellCnt=row.cells.length,j=0;cellCnt>j;++j)cell=row.cells[j],cell.type===cellType&&cell.dataRowIx===dataRowIx&&cells.push(cell);return cells}function getCellInColumnWithRowIndex(grid,cellType,dataColIx,dataRowIx){var i,j,row,colCnt,rows=grid.getRowsByCellType(cellType),rowCnt=rows.length,cell=null;for(i=0;rowCnt>i;++i)for(row=rows[i],colCnt=row.cells.length,j=0;colCnt>j;++j)if(cell=row.cells[j],cell.dataColIx===dataColIx&&cell.dataRowIx===dataRowIx)return cell;return null}function getSiblingCells(grid,cell){return cell.type===grid.CELL_TYPE_LEFT||cell.type===grid.CELL_TYPE_DATA?getCellsInColumn(grid,cell.type,cell.dataColIx):getCellsInRow(grid,cell.type,cell.dataRowIx)}function getSiblingCellsWithValue(grid,cell,dataValue){var c,i,siblings=getSiblingCells(grid,cell),cellCnt=siblings.length,cells=[];for(i=0;cellCnt>i;++i)c=siblings[i],c.dataValue===dataValue&&cells.push(c);return cells}function getColumnInfo(dataColIx,layout){var dimCnt=layout.qHyperCube.qDimensionInfo.length;return layout.qHyperCube.columnOrder?dimCnt>dataColIx?layout.qHyperCube.qDimensionInfo[dataColIx]:layout.qHyperCube.qMeasureInfo[dataColIx-dimCnt]:{othersLabel:!1,qLocked:!1}}function getGrandTotal(dataColIx,layout){var grandTotal=layout.qHyperCube.qGrandTotalRow[dataColIx-layout.qHyperCube.qDimensionInfo.length];return grandTotal||(grandTotal={qText:""}),grandTotal}function isDimensionColumn(columnInfo){return columnInfo?"qDimensionType"in columnInfo:void 0}function isAutoTextAlign(columnInfo){return void 0===columnInfo.textAlign||columnInfo.textAlign.auto}function getAutoTextAlign(isNumeric){return isNumeric?"right":"left"}function getTextAlign(columnInfo,isNumeric){return isAutoTextAlign(columnInfo)?getAutoTextAlign(isNumeric):columnInfo.textAlign.align||"left"}function iterateTopSubNodes_internal(rowIx,dataRowIx,dataColIx,depth,grid,subNodes,offsetX,metaInfo){var i,node,row,cell,text,dimIx,tempColIx,dimInfo;for(i=0;i<subNodes.length;++i)node=subNodes[i],dimInfo=metaInfo.getDimInfo(metaInfo.leftDimCnt+depth),row=grid.getHeaderRow(rowIx),cell=row.getNextCell(),cell.type=grid.CELL_TYPE_TOP,cell.locked=isPseudoNode(node)?!1:dimInfo.qLocked,cell.isDimensionValue=!(isPseudoNode(node)||isOthersNode(node)||isTotalNode(node)||isEmptyNode(node)),text=node.qText,isOthersNode(node)&&(dimIx=metaInfo.leftCellCnt+dataRowIx,dimIx>=metaInfo.pseudoDimIndex&&dimIx--,text=metaInfo.layout.qHyperCube.qDimensionInfo[dimIx].othersLabel),cell.setTopHeader(text,node.qElemNo,1,1,dataRowIx,offsetX+dataColIx,isNullNode(node)),(isTotalNode(node)||node.qCanCollapse||node.qCanExpand)&&(cell.addClass("bold"),cell.setCollapseExpandClass(node),row.addClass("bold")),node.qSubNodes.length?(tempColIx=iterateTopSubNodes_internal(rowIx+1,dataRowIx+1,dataColIx,depth+1,grid,node.qSubNodes,offsetX,metaInfo),cell.colspan=tempColIx-dataColIx,dataColIx=tempColIx):dataColIx++;return dataColIx}function iterateTopSubNodes(grid,subNodes,offsetX,metaInfo){metaInfo.dataColumnsInfo.cnt<=0||(iterateTopSubNodes_internal(1,0,0,0,grid,subNodes,offsetX,metaInfo),grid.setNextHeaderIx(grid.topTreeDepth+1),grid.headerRows[grid.topTreeDepth].addClass("last-top-row"))}function isOthersNode(node){return-3===node.qElemNo}function isNullNode(node){return-2===node.qElemNo}function isTotalNode(node){return-1===node.qElemNo}function isEmptyNode(node){return-4===node.qElemNo}function isTotalOrEmptyNode(node){return isTotalNode(node)||isEmptyNode(node)}function isPseudoNode(node){return"P"===node.qType}function isParentNode(node){return node.qCanCollapse||node.qCanExpand||node.qSubNodes.length&&!isPseudoNode(node.qSubNodes[0])}function isSignificantNode(colIx,node){return 0===colIx&&(isTotalNode(node)||isPseudoNode(node))||!isTotalOrEmptyNode(node)&&!isPseudoNode(node)}function addCellToRow(rowIx,colIx,depth,node,grid,offsetY,metaInfo,text){var cell,adjustColspan=0,row=grid.getRow(rowIx),dimInfo=metaInfo.getDimInfo(depth),isDimensionValue=!(isPseudoNode(node)||isOthersNode(node)||isTotalNode(node)||isNullNode(node)),locked=dimInfo?dimInfo.qLocked:!1;return depth>0&&(cell=row.addEmptyHeaderCell(offsetY+rowIx,colIx,1,depth,"left",isNullNode(node)),cell.type=grid.CELL_TYPE_LEFT,cell.isDimensionValue=isDimensionValue,cell.locked=locked,cell.dataValue=node.qElemNo),(node.qCanCollapse||node.qCanExpand)&&(cell=row.addLeftCollapseExpandCell(offsetY+rowIx,colIx,node,isNullNode(node)),cell.type=grid.CELL_TYPE_LEFT,cell.isDimensionValue=isDimensionValue,cell.locked=locked,cell.dataValue=node.qElemNo,adjustColspan=-1),cell=row.getNextCell(),cell.type=grid.CELL_TYPE_LEFT,cell.isDimensionValue=isDimensionValue,cell.locked=locked,text=text||node.qText,isOthersNode(node)&&(text=dimInfo.othersLabel),cell.setLeftHeader(text,node.qElemNo,1,metaInfo.leftCellCnt-depth+adjustColspan,offsetY+rowIx,colIx,isNullNode(node)),(isTotalNode(node)||isParentNode(node))&&(cell.addClass("bold"),row.addClass("bold")),cell}function iterateIndentedLeftSubNodes_internal(rowIx,colIx,depth,grid,subNodes,lastSignificantNode,lastSignificantNodeColIx,lastSignificantNodeDepth,pseudoNode,offsetY,metaInfo){var i,node,text,nextDepth;for(i=0;i<subNodes.length;++i)node=subNodes[i],isSignificantNode(colIx,node)&&(lastSignificantNode=node,lastSignificantNodeColIx=colIx,lastSignificantNodeDepth=depth),colIx>0&&isPseudoNode(node)&&(pseudoNode=node),node.qSubNodes.length?(nextDepth=depth+(colIx>0&&isPseudoNode(node)?0:1),rowIx=iterateIndentedLeftSubNodes_internal(rowIx,colIx+1,nextDepth,grid,node.qSubNodes,lastSignificantNode,lastSignificantNodeColIx,lastSignificantNodeDepth,pseudoNode,offsetY,metaInfo)):(text=lastSignificantNode.qText,pseudoNode&&(text+=isNullNode(lastSignificantNode)?" ":" - "+pseudoNode.qText,pseudoNode=null),addCellToRow(rowIx,lastSignificantNodeColIx,lastSignificantNodeDepth,lastSignificantNode,grid,offsetY,metaInfo,text),++rowIx);return rowIx}function iterateLeftSubNodes_internal(rowIx,depth,grid,subNodes,offsetY,metaInfo){var i,node,row,cell,expander,tempRowIx,text,dimInfo,isDimensionValue,locked,adjustColspan=0;for(i=0;i<subNodes.length;++i)if(node=subNodes[i],dimInfo=metaInfo.getDimInfo(depth),isDimensionValue=!isPseudoNode(node)&&!isOthersNode(node)&&!isTotalNode(node),locked=dimInfo?dimInfo.qLocked:!1,row=grid.getRow(rowIx),isEmptyNode(node)?(cell=row.getNextCell(),cell.type=grid.CELL_TYPE_LEFT,cell.dataValue=node.qElemNo,cell.isDimensionValue=isDimensionValue,cell.locked=locked,cell.setLeftHeader("",-4,1,2)):(cell=row.getNextCell(),cell.type=grid.CELL_TYPE_LEFT,cell.isDimensionValue=isDimensionValue,cell.locked=locked,(node.qCanCollapse||node.qCanExpand)&&(expander=cell,expander.setLeftHeader("",node.qElemNo,1,1,offsetY+rowIx,depth,isNullNode(node)),expander.setCollapseExpandClass(node),cell=row.getNextCell(),cell.type=grid.CELL_TYPE_LEFT,cell.isDimensionValue=isDimensionValue,cell.locked=locked,adjustColspan=1),text=node.qText,isOthersNode(node)&&(text=dimInfo.othersLabel),cell.setLeftHeader(text,node.qElemNo,1,2-adjustColspan,offsetY+rowIx,depth,isNullNode(node)),isTotalNode(node)&&(cell.addClass("bold"),row.addClass("bold"))),node.qSubNodes.length)tempRowIx=iterateLeftSubNodes_internal(rowIx,depth+1,grid,node.qSubNodes,offsetY,metaInfo),cell.rowspan=tempRowIx-rowIx,expander&&(expander.rowspan=cell.rowspan),rowIx=tempRowIx;else{var leftovers=metaInfo.leftCellCnt-2*(depth+1);leftovers>0&&(cell=row.getNextCell(),cell.type=grid.CELL_TYPE_LEFT,cell.dataValue=node.qElemNo,cell.isDimensionValue=isDimensionValue,cell.locked=locked,cell.setLeftHeader("",-4,1,leftovers)),++rowIx}return rowIx}function iterateLeftSubNodes(grid,leftTree,offset,metaInfo){metaInfo.isIndentMode?iterateIndentedLeftSubNodes_internal(0,0,0,grid,leftTree,null,-1,-1,null,offset,metaInfo):iterateLeftSubNodes_internal(0,0,grid,leftTree,offset,metaInfo)}function updateColorByExpression(cell,node){var color,colorArg;cell.style.backgroundColor="",cell.color.bgByExpression=!1,cell.color.bgIsDark=!1,"U"!==node.qType&&node.qAttrExps&&node.qAttrExps.qValues&&node.qAttrExps.qValues.length&&(cell.color.bgByExpression=!0,colorArg="NaN"!==node.qAttrExps.qValues[0].qNum?node.qAttrExps.qValues[0].qNum:node.qAttrExps.qValues[0].qText,color=new Color(colorArg,"argb"),color.isInvalid()||(cell.style.backgroundColor=color.toRGBA(),cell.color.bgIsDark=color.isDark()&&color.getAlpha()>.5,cell.addClass(cell.color.bgIsDark?"color-light":"color-dark"))),cell.style.color="",node.qAttrExps&&node.qAttrExps.qValues&&node.qAttrExps.qValues.length>1&&(colorArg="NaN"!==node.qAttrExps.qValues[1].qNum?node.qAttrExps.qValues[1].qNum:node.qAttrExps.qValues[1].qText,color=new Color(colorArg,"argb"),color.isInvalid()||(cell.style.color=color.toRGBA()))}function iteratePivotDataGrid(grid,dataMatrix,rowOffsetIx,colOffsetIx,metaInfo){var i,j,rowCnt,colCnt,node,row,cell;for(i=0,rowCnt=dataMatrix.length;rowCnt>i;++i)for(row=grid.getNextRow(),0===grid.leftTreeDepth&&row.addEmptyHeaderCell(rowOffsetIx+i,colOffsetIx,1,1),colCnt=Math.min(metaInfo.dataColumnsInfo.cnt,dataMatrix[i].length),0===colCnt&&0===i&&row.cells[row.nextCellIx-1].addClass("first-data-cell"),j=0;colCnt>j;++j)cell=row.getNextCell(),cell.type=grid.CELL_TYPE_DATA,node=dataMatrix[i][j],cell.setData(node.qText,1,1,rowOffsetIx+i,colOffsetIx+j),cell.addClass("data"),0===i&&0===j&&cell.addClass("first-data-cell"),"U"===node.qType&&cell.setNullClass(!0),isNaN(node.qNum)||cell.addClass("numeric"),row.hasClass("bold")&&cell.addClass("bold"),updateColorByExpression(cell,node)}function iterateDataGrid(layout,grid,gridRowOffset,gridColOffset,dataRect,dataMatrix,reversed){var rowIx,rowCnt,colInfo,colIx,colCnt,row,cell,cellData,dataColIx,color,colorArg,header,whiteColor,fadeToColor;for(whiteColor=new Color(255,255,255,1),rowCnt=dataMatrix.length,rowIx=0;rowCnt>rowIx;++rowIx){for(row=grid.getRow(gridRowOffset+rowIx),colCnt=dataMatrix[rowIx].length,colIx=0;colCnt>colIx;++colIx)dataColIx=dataRect.qLeft+colIx,cellData=dataMatrix[rowIx][colIx],colInfo=getColumnInfo(dataColIx,layout),cell=row.getCell(gridColOffset+colIx),cell.type=grid.CELL_TYPE_DATA,cell.isOtherCell=cellData.qIsOtherCell,cell.isTotalCell=cellData.qIsTotalCell,cell.isOtherCell?cell.value=colInfo.othersLabel:cell.value=cellData.qText,cell.locked=colInfo.qLocked,cell.dataValue=cellData.qElemNumber,cell.dataColIx=dataColIx,cell.dataRowIx=reversed?dataRect.qTop+dataRect.qHeight-rowIx-1:dataRect.qTop+rowIx,cell.isNumeric=!isNaN(cellData.qNum),cell.style.textAlign=getTextAlign(colInfo,cell.isNumeric),cell.isNullValue=cell.isDimensionValue?-2===cell.dataValue:cellData.qIsNull,cell.isDimensionValue=!cell.isNullValue&&isDimensionColumn(colInfo),cell.selected=!1,cell.selectedHighlighted=!1,cell.rowspan=1,cell.colspan=isDimensionColumn(colInfo)?2:1,cell.style.backgroundColor="",cell.color.bgByExpression=!1,cell.color.bgIsDark=!1,!cell.isNullValue&&cellData.qAttrExps&&cellData.qAttrExps.qValues&&cellData.qAttrExps.qValues.length&&(colorArg="NaN"!==cellData.qAttrExps.qValues[0].qNum?cellData.qAttrExps.qValues[0].qNum:cellData.qAttrExps.qValues[0].qText,color=new Color(colorArg,"argb"),color.isInvalid()||(cell.color.bgByExpression=!0,cell.style.backgroundColor=color.toRGBA(),cell.color.bgIsDark=color.isDark()&&color.getAlpha()>.5,fadeToColor=Color.getBlend(whiteColor,new Color(color._r,color._g,color._b,1),color._a),cell.color.fadeFromColor=new Color(fadeToColor._r,fadeToColor._g,fadeToColor._b,0).toRGBA(),cell.color.fadeToColor=fadeToColor.toRGBA(),1===grid.headerRows.length&&(header=grid.getHeaderRow(0).cells.filter(function(h){return h.dataColIx===cell.dataColIx})[0],header.color.bgIsDark=color.isDark()))),cell.style.color="",cellData.qAttrExps&&cellData.qAttrExps.qValues&&cellData.qAttrExps.qValues.length>1&&(colorArg="NaN"!==cellData.qAttrExps.qValues[1].qNum?cellData.qAttrExps.qValues[1].qNum:cellData.qAttrExps.qValues[1].qText,color=new Color(colorArg,"argb"),color.isInvalid()||(cell.style.color=color.toRGBA()));row.setNextCellIx(gridColOffset+colIx)}grid.setNextRowIx(gridRowOffset+rowIx)}function setMetaGrid(grid,metaInfo){var topRow,emptyCell,topMetaCell;topRow=grid.getHeaderRow(0),metaInfo.dataColumnsInfo.cnt>0&&metaInfo.leftCellCnt>0&&(emptyCell=topRow.addEmptyMetaCell(grid.topTreeDepth+1,metaInfo.leftCellCnt,"left-meta"),emptyCell.templateSrc="pt-meta-left.ng.html",emptyCell.addClass("meta")),metaInfo.dataColumnsInfo.cnt>0&&(topMetaCell=topRow.addEmptyMetaCell(1,metaInfo.dataColumnsInfo.cnt),topMetaCell.addClass("top-meta").addClass("meta"),topMetaCell.templateSrc="pt-meta-top.ng.html")}function getTreeDepth(depth,subNodes){return subNodes.length?getTreeDepth(depth+1,subNodes[0].qSubNodes):depth}function setStraightTotals(grid,layout){function haveTotalMeasures(){return layout.qHyperCube.qMeasureInfo.length>0&&layout.qHyperCube.qGrandTotalRow.length>0}function showTotals(){return haveTotalMeasures()&&layout.totals&&(layout.totals.show||"noTotals"!==layout.totals.position)}function showTotalsAtTop(){return showTotals()&&layout.totals&&!layout.totals.show&&"bottom"===layout.totals.position?!1:!0}var i,row,grandTotal,totalHeader,header,colCnt=grid.headerRows[0].getCellSize();if(showTotals()&&showTotalsAtTop())row=grid.getNextHeaderRow();else{if(!showTotals())return;row=grid.getNextFooterRow()}for(i=0;colCnt>i;++i)header=grid.getHeaderCell(0,i),header.isSearchIcon||(totalHeader=row.getNextCell(),totalHeader.type=grid.CELL_TYPE_TOP,totalHeader.tid=header.isSearchIcon?"st.total.search":"st.total",totalHeader.colIx=i,totalHeader.style={},totalHeader.colspan=header.isDimension?2:1,totalHeader.isDimension=!showTotalsAtTop()&&header.isDimension,totalHeader.isMeasure=header.isMeasure,header.isMeasure?(grandTotal=getGrandTotal(header.dataColIx,layout),totalHeader.value=grandTotal.qText,totalHeader.isNumeric=!0):(totalHeader.value=0===i?void 0!==layout.totals.label?layout.totals.label:translator.get("Object.Table.Totals"):" ",totalHeader.isNumeric=!1),header.info&&(totalHeader.style.textAlign=getTextAlign(header.info,totalHeader.isNumeric)),totalHeader.isTotal=!0)}function setStraightHeaders(grid,metaHeaders){var i,row,header,cnt=metaHeaders.length;for(row=grid.getNextHeaderRow(),i=0;cnt>i;++i)header=row.getNextCell(),header.type=grid.CELL_TYPE_TOP,header.setFromMetaHeader(metaHeaders[i])}function setStraightMetaDataHeader(header,interColumnSortOrder){header.tid="st.header",header.qvaOutsideIgnoreFor="",header.isSearchIcon=!1,header.open=!1,header.isNumeric="N"===header.info.qDimensionType||void 0===header.info.qDimensionType,header.locked=header.info.qLocked,header.value=header.info.qFallbackTitle,header.canCollapse=!1,header.canExpand=!1,header.sortable=!0,header.rowspan=1,header.colspan=1,header.dataColIx=header.qLeft,header.isDimension=!!header.info.qDimensionType,header.fieldName=header.isDimension?header.info.qGroupFieldDefs[header.info.qGroupPos]:"",header.isMeasure=!header.isDimension,header.isSorted=header.dataColIx===interColumnSortOrder[0],header.reversed=!!header.info.qReverseSort,header.sortIndicator=header.info.qSortIndicator,header.style={},header.style.textAlign=getTextAlign(header.info,header.isNumeric),header.color={}}function getStraightMetaHeaders(layout,gridSettings,$id){function getInfo(ix){return dimCnt>ix?dims[ix]:meas[ix-dimCnt]}var i,adjustableCnt,adjustWidthFactor,header,searchGlyphCnt,info,apprMaxGlyphCnt,calcApprMaxGlyphCnt,grandTotalGlyphCnt,isMeasure,grandTotal,width=gridSettings.width-(gridSettings.columnPicker.show?0:gridSettings.columnPicker.width),minWidth=gridSettings.column.minWidth,searchWidth=gridSettings.column.minSearchWidth,glyphWidth=gridSettings.column.glyphWidth,maxMeasureColumnWidth=gridSettings.column.maxMeasureWidth,hc=layout.qHyperCube,columnOrder=hc.columnOrder,cnt=columnOrder.length,dims=hc.qDimensionInfo,dimCnt=dims.length,meas=hc.qMeasureInfo,minDimFactor=minWidth/width,minMeasWidth=24,minMeasFactor=minMeasWidth/width,searchFactor=searchWidth/width,searchCnt=0,columnPaddingWidth=14,headers=[],adjustableHeaders=[],availableGlyphs=Math.floor(width/glyphWidth),minDimGlyphCnt=Math.ceil(minWidth/glyphWidth),minMeasGlyphCnt=Math.ceil(minMeasWidth/glyphWidth),columnPaddingGlyphWidth=Math.ceil(columnPaddingWidth/glyphWidth),totWidthFactor=1,maxMeasureGlyphCnt=Math.floor(Math.min(width,maxMeasureColumnWidth)/glyphWidth)-columnPaddingGlyphWidth;for(gridSettings.columnPicker.show=!1,i=0;cnt>i&&availableGlyphs>0&&(info=getInfo(columnOrder[i]),searchGlyphCnt=0,isMeasure=columnOrder[i]>=dimCnt,apprMaxGlyphCnt=info.qApprMaxGlyphCount,isMeasure?(grandTotal=getGrandTotal(columnOrder[i],layout),grandTotalGlyphCnt=Math.min(grandTotal.qText.length,maxMeasureGlyphCnt),apprMaxGlyphCnt=Math.min(apprMaxGlyphCnt,maxMeasureGlyphCnt),calcApprMaxGlyphCnt=Math.max(minMeasGlyphCnt,apprMaxGlyphCnt,info.qFallbackTitle.length,grandTotalGlyphCnt)):(calcApprMaxGlyphCnt=minDimGlyphCnt,searchGlyphCnt=Math.ceil(searchWidth/glyphWidth)),calcApprMaxGlyphCnt+=columnPaddingGlyphWidth,!(0>availableGlyphs-calcApprMaxGlyphCnt&&0===headers.length&&isMeasure))&&!(0>availableGlyphs-calcApprMaxGlyphCnt&&headers.length>0);++i)availableGlyphs-=calcApprMaxGlyphCnt,header={info:info,isDimension:columnOrder[i]<dimCnt,isMeasure:isMeasure,grandTotal:grandTotal,qLeft:columnOrder[i],apprMaxGlyphCnt:apprMaxGlyphCnt,calcApprMaxGlyphCnt:calcApprMaxGlyphCnt,searchGlyphCnt:searchGlyphCnt},setStraightMetaDataHeader(header,hc.qEffectiveInterColumnSortOrder),headers.push(header);for(gridSettings.columnCount=i,gridSettings.columnPicker.show=cnt>i,i=0,cnt=headers.length;cnt>i;++i)header=headers[i],header.isDimension?(header.bestFitWidthFactor=header.apprMaxGlyphCnt*glyphWidth/width,header.widthFactor=minDimFactor,adjustableHeaders.push(header)):(header.bestFitWidthFactor=header.calcApprMaxGlyphCnt*glyphWidth/width,header.widthFactor=Math.max(minMeasFactor,header.bestFitWidthFactor)),header.widthFactor+=columnPaddingWidth/width,totWidthFactor-=header.widthFactor;if(totWidthFactor>0){for(adjustableHeaders.sort(function(h1,h2){return h1.apprMaxGlyphCnt<h2.apprMaxGlyphCnt}),i=0,adjustableCnt=adjustableHeaders.length;adjustableCnt>i&&(header=adjustableHeaders[i],adjustWidthFactor=0,header.bestFitWidthFactor>header.widthFactor&&(adjustWidthFactor=Math.max(0,Math.min(totWidthFactor,header.bestFitWidthFactor-header.widthFactor)),header.widthFactor+=adjustWidthFactor),!(0>=totWidthFactor));++i)totWidthFactor-=adjustWidthFactor;if(totWidthFactor>0)for(i=0;cnt>i;++i)header=headers[i],header.widthFactor+=totWidthFactor/cnt}for(i=0,cnt=headers.length;searchCnt+cnt>i;++i)header=headers[i],header.isDimension?(headers.splice(i+1,0,{isSearchIcon:!0,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+$id,tid:"st.header.search",widthFactor:searchFactor,style:{width:100*searchFactor+"%"},fieldName:header.fieldName,dataColIx:header.dataColIx,colspan:1}),header.widthFactor-=searchFactor,header.style.width=100*header.widthFactor+"%",++searchCnt):header.style.width=100*header.widthFactor+"%";return headers}qvangular.service("qvGridObjectDataService",function(){return{getTopTreeDepth:function(qPivotDataPage){return getTreeDepth(0,qPivotDataPage.qTop)},getLeftTreeDepth:function(qPivotDataPage){return getTreeDepth(0,qPivotDataPage.qLeft)},updatePivotItems:function(scope,dataPages,requestedPages,keepClasses){var layout=scope.layout,grid=scope.grid,topTree=dataPages[0].qTop,leftTree=dataPages[0].qLeft,dataMatrix=dataPages[0].qData,topDepth=getTreeDepth(0,topTree),leftDepth=getTreeDepth(0,leftTree),reqPage=requestedPages[0],metaInfo=scope.metaGhostHeaders,indented=layout.qHyperCube.qIndentMode,pseudoDimIndex=this.getPseudoDimIndex(layout);grid.reset(!1,keepClasses,pseudoDimIndex,indented),grid.setTopTreeDepth(topDepth),grid.setLeftTreeDepth(leftDepth),setMetaGrid(grid,metaInfo),iterateTopSubNodes(grid,topTree,reqPage.qLeft,metaInfo),iterateLeftSubNodes(grid,leftTree,reqPage.qTop,metaInfo),iteratePivotDataGrid(grid,dataMatrix,reqPage.qTop,reqPage.qLeft,metaInfo),grid.removeUnused()},updateStraightItems:function(scope,dataPages,metaHeaders,update,reversed,suppressHeaderUpdate){var colIx,layout=scope.layout,grid=scope.grid,rowIx=0,colCnt=Math.min(dataPages.length,scope.scrollApi.settings.columnCount);for(update||grid.reset(suppressHeaderUpdate),suppressHeaderUpdate||(setStraightHeaders(grid,metaHeaders),setStraightTotals(grid,layout)),rowIx=grid.getNextRowIx(),colIx=0;colCnt>colIx;++colIx)0!==dataPages[colIx].length&&iterateDataGrid(layout,grid,rowIx,colIx,dataPages[colIx].qArea,dataPages[colIx].qMatrix,reversed);update&&grid.setNextRowIx(grid.rows.length),grid.removeUnused()},getPseudoDimIndex:function(layout){var ix=layout.qHyperCube.qEffectiveInterColumnSortOrder.indexOf(-1);return~ix?ix:layout.qHyperCube.qEffectiveInterColumnSortOrder.length},getColumnInfo:getColumnInfo,getColumnCells:getColumnCells,getCellsInColumnWithValue:getCellsInColumnWithValue,getCellsInColumn:getCellsInColumn,getCellsInRow:getCellsInRow,getSiblingCells:getSiblingCells,getSiblingCellsWithValue:getSiblingCellsWithValue,getCellInColumnWithRowIndex:getCellInColumnWithRowIndex,columnOrder:{get:getColumnOrder},getStraightMetaHeaders:getStraightMetaHeaders}})}),define("objects.grid/services/selections",["qvangular","util","objects.grid/services/data-service","objects.grid/directives/selections"],function(qvangular,util){"use strict";qvangular.service("qvGridObjectSelectionService",["$timeout","$document","qvGridObjectDataService",function($timeout,$document,dataService){var service;return service={$new:function(){var selections={active:!1,currentDataColIx:-1,currentDataRowIx:-1,currentCell:void 0,activationCell:void 0,dataValues:{},unbindKeyboard:null};return Object.defineProperties(selections,{dataValuesArray:{get:function(){var i,values=[],keys=Object.keys(this.dataValues),keysCnt=keys.length;for(i=0;keysCnt>i;++i)values.push(parseInt(keys[i]));return values}},selectedIndices:{get:function(){var i,indices=[],keys=this.dataValuesArray,keysCnt=keys.length;for(i=0;keysCnt>i;++i)indices.push(this.dataValues[keys[i]]);return indices}}}),selections},init:function(selectionsApi,backendApi,selections,confirmedFn,cancelledFn,clearedFn){selectionsApi.confirm=function(){backendApi.endSelections(!0),selectionsApi.deactivated(),service.reset(selections),service.hide(selections),confirmedFn()},selectionsApi.cancel=function(){backendApi.endSelections(!1),selectionsApi.deactivated(),service.reset(selections),service.hide(selections),cancelledFn()},selectionsApi.clear=function(){selections.dataValues={},clearedFn(),service.reset(selections),backendApi.clearSelections()}},reset:function(selections){selections.dataValues={},selections.currentDataColIx=-1,selections.currentDataRowIx=-1,selections.currentCell=void 0},show:function(selections,cell){selections.active||(selections.currentDataColIx=cell.dataColIx,selections.currentDataRowIx=cell.dataRowIx,selections.activationCell=util.extend(!0,{},cell),selections.active=!0)},hide:function(selections){selections.active=!1},bindKeyboard:function(selectionsApi,$id){var namespace=".selections-keyboard-"+$id;return $document.on("keyup"+namespace,function(e){27===e.which?selectionsApi.cancel():13===e.which&&selectionsApi.confirm()}),function(){$document.off(namespace)}},isColumnar:function(grid,cell){return cell.type===grid.CELL_TYPE_LEFT||cell.type===grid.CELL_TYPE_DATA},selectValue:function(grid,cell,selections){selections.dataValues[cell.dataValue]=service.isColumnar(grid,cell)?cell.dataRowIx:cell.dataColIx,selections.currentDataColIx=cell.dataColIx,selections.currentDataRowIx=cell.dataRowIx},selectCell:function(grid,cell,highlight){grid.gridType===grid.GRID_TYPE_PIVOT?(cell[highlight?"addClass":"removeClass"]("selected-highlighted"),cell[highlight?"removeClass":"addClass"]("selected")):(cell.selectedHighlighted=highlight?!0:!1,cell.selected=highlight?!1:!0)},lockCell:function(grid,cell){grid.gridType===grid.GRID_TYPE_PIVOT?cell.addClass("locked"):cell.isSelectLocked=!0},deselectValue:function(grid,cell,selections){delete selections.dataValues[cell.dataValue]},deselectCell:function(grid,cell){grid.gridType===grid.GRID_TYPE_PIVOT?(cell.removeClass("selected-highlighted"),cell.removeClass("selected")):(cell.selectedHighlighted=!1,cell.selected=!1)},unlockCell:function(grid,cell){grid.gridType===grid.GRID_TYPE_PIVOT?cell.removeClass("locked"):cell.isSelectLocked=!1},getSelectionType:function(grid,cellType){var map={};return map[grid.CELL_TYPE_TOP]="T",map[grid.CELL_TYPE_LEFT]="L",map[grid.CELL_TYPE_DATA]="D",map[cellType]},sendSelection:function(backendApi,selectionsApi,selections,grid,cell){var cols,rows,type,selectedIndices=selections.selectedIndices;0!==selectedIndices.length&&(service.isColumnar(grid,selections.currentCell)?(cols=[selections.currentDataColIx],rows=selections.selectedIndices):(cols=selections.selectedIndices,rows=[selections.currentDataRowIx]),type=service.getSelectionType(grid,cell.type),selectionsApi.selectionsMade=!0,backendApi.select(rows,cols,type).then(function(res){res.qSuccess||selectionsApi.clear()}))},getCellCountWithDataValue:function(grid,cells,dataValue){var ix,cell,i,usedIndices=[],count=0,cellCnt=cells.length;if(0===cellCnt)return 0;for(i=0;cellCnt>i;++i)cell=cells[i],ix=service.isColumnar(grid,cell)?cell.dataColIx:cell.dataRowIx,cell.dataValue===dataValue&&-1===usedIndices.indexOf(ix)&&(usedIndices.push(ix),count++);return count},getSiblingCell:function(grid,selections){return grid.gridType===grid.GRID_TYPE_PIVOT?selections.currentCell:selections.activationCell},selectDimensionCells:function(backendApi,selectionsApi,selections,grid,cell,toggle){var cellsWithDataValueCnt,size,dataValue=cell.dataValue,isSelected=dataValue in selections.dataValues,cells=dataService.getSiblingCells(grid,service.getSiblingCell(grid,selections)||cell);if(-1!==cells.indexOf(cell)&&(size=cell.type===grid.CELL_TYPE_TOP?backendApi.getSize().qcx:backendApi.getSize().qcy,cellsWithDataValueCnt=service.getCellCountWithDataValue(grid,cells,dataValue),size!==cellsWithDataValueCnt||!toggle||!isSelected))return cells.forEach(function(c){c.dataValue in selections.dataValues&&service.selectCell(grid,c)}),toggle&&isSelected?(service.deselectValue(grid,cell,selections),cells.forEach(function(c){c.dataValue===dataValue&&service.deselectCell(grid,c)})):isSelected?toggle||(cells.forEach(function(c){c.dataValue===dataValue&&service.selectCell(grid,c)}),service.selectCell(grid,cell,!0)):(service.selectValue(grid,cell,selections),cells.forEach(function(c){c.dataValue===dataValue&&service.selectCell(grid,c)}),service.selectCell(grid,cell,!0)),selections.currentCell=util.extend(!0,{},cell),function(){0===selections.dataValuesArray.length?selectionsApi.clear():service.sendSelection(backendApi,selectionsApi,selections,grid,cell)}},selectDimensionValue:function($id,backendApi,selectionsApi,selections,cell,grid,toggle){var selectCallback,unbindFn=service.activateSelections($id,backendApi,selectionsApi,selections,cell);return cell.locked||cell.isNullValue||(selectCallback=service.selectDimensionCells(backendApi,selectionsApi,selections,grid,cell,toggle),selectCallback&&selectCallback()),unbindFn},activateSelections:function($id,backendApi,selectionsApi,selections,cell){
return selections.active||cell.locked||(backendApi.beginSelections(),service.show(selections,cell),selections.unbindKeyboard=service.bindKeyboard(selectionsApi,$id),$timeout(function(){selectionsApi.activated(!0)})),function(){selections.unbindKeyboard()}},updateStraight:function(grid,selections,activationCell){var i,cell,cellCnt,siblingCells;if(selections.dataValuesArray.length)for(siblingCells=dataService.getSiblingCells(grid,activationCell),cellCnt=siblingCells.length,i=0;cellCnt>i;++i)cell=siblingCells[i],cell.dataValue in selections.dataValues&&(service.selectCell(grid,cell),selections.currentDataRowIx===cell.dataRowIx&&service.selectCell(grid,cell,!0))},updatePivot:function(grid,selections,currentCell){var i,cell,cellCnt,siblingCells;if(selections.dataValuesArray.length)for(siblingCells=dataService.getSiblingCells(grid,currentCell),cellCnt=siblingCells.length,i=0;cellCnt>i;++i)cell=siblingCells[i],cell.dataValue in selections.dataValues&&service.selectCell(grid,cell)}}}])}),define("text!extensions.qliktech/straight-table/layout/top/straight-table-top-header.ng.html",[],function(){return'<div class="qv-st-header" tid="qv-st-header-top" ng-style="scrollApi.topBottomStyle">\r\n	<table qva-delegated-activate=".qv-st-header-sortable#interactive && !selections.active && sortHeader($event);\r\n		   .qv-st-header-cell-search:not(.qv-st-total-cell)#interactive && !selections.active && searchHeader($event)">\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.headerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-header-sortable\': header.sortable,\r\n					\'qv-st-total-cell\': header.isTotal,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon,\r\n					\'qv-st-header-cell-search-open\': header.isSearchIcon && header.open }"\r\n					colspan="{{header.colspan}}">\r\n					<qv-straight-table-header-cell ng-if="!header.isSearchIcon"></qv-straight-table-header-cell>\r\n					<qv-straight-table-header-cell-search ng-if="!header.isTotal && header.isSearchIcon"></qv-straight-table-header-cell-search>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/top/straight-table-top-header",["qvangular","jquery","text!./straight-table-top-header.ng.html"],function(qvangular,$,template){"use strict";qvangular.directive("qvStraightTableTopHeader",function(){return{restrict:"E",replace:!0,template:template,link:function($scope,$element,$attrs){$scope.sortHeader=function(e){$scope.$eval($attrs.onSortHeader,{header:$(e.target).scope().header})},$scope.searchHeader=function(e){var $alignTo=$(e.target).closest(".qv-st-header-cell"),header=$alignTo.scope().header;e.preventDefault(),$scope.$eval($attrs.onSearch,{$alignTo:$alignTo,header:header})}}}})}),define("text!extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell.ng.html",[],function(){return'<div class="qv-st-header-cell-wrapper">\r\n	<div class="qv-st-fade-out"\r\n		 ng-class="{ \'qv-st-header-selections-active\': header.selectionsActive }" title="{{header.value}}">\r\n		<i ng-class="{\'icon-toolbar-locked\': header.locked }"></i><span>{{header.value}}</span>\r\n	</div>\r\n	<i ng-if="header.isSorted && header.sortIndicator !== \'N\'"\r\n		class="qv-st-sorting-indicator"\r\n		ng-class="{ \'icon-triangle-top\': header.sortIndicator === \'A\', \'icon-triangle-bottom\': header.sortIndicator === \'D\', \'icon-triangle-light\': header.color.bgIsDark && !header.reversed }"\r\n		ng-style="header.sortStyle"></i>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell",["qvangular","text!./straight-table-header-cell.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStraightTableHeaderCell",[function(){return{restrict:"E",replace:!0,template:template,link:function($scope,$element){var $alignSelectionsTo=$element.closest(".qv-st-header-cell");$scope.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(b){return b?($scope.header.addClass("qv-st-active-col"),void($scope.selectionsApi.getDockToElement=function(){return $alignSelectionsTo})):void(-1!==$scope.selections.currentDataColIx&&$scope.header.removeClass("qv-st-active-col"))})}}}]),qvangular.directive("qvStraightTableHeaderCellSearch",[function(){return{restrict:"E",replace:!0,template:'<i class="icon-magnifying-glass" q-title-translation="Common.Search"></i>',link:function($scope,$element){var $header=$element.closest(".qv-st-header-cell");$scope.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(b){return b?($scope.header.addClass("qv-st-active-col"),void($scope.selectionsApi.getSelectionToolbarWidthOffset=function(){return $header[0].getBoundingClientRect().width+1})):void(-1!==$scope.selections.currentDataColIx&&$scope.header.removeClass("qv-st-active-col"))})}}}])}),define("text!extensions.qliktech/straight-table/layout/data/straight-table-data.ng.html",[],function(){return'<div class="qv-st-data" tid="qv-st-data">\r\n	<qv-scroll-load-button ng-show="interactive && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n	</qv-scroll-load-button>\r\n	<table ng-style="dataTableHeight">\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.rows" class="qv-st-data-row" ng-class="{ \'qv-grid-object-data-first-row\': $first, \'qv-grid-object-data-last-row\': $last }">\r\n				<td ng-repeat="cell in row.cells" class="qv-st-data-cell"\r\n					rowspan="{{ cell.rowspan }}"\r\n					colspan="{{ cell.colspan }}"\r\n					ng-style="cell.style"\r\n					ng-class="{ \'qv-st-data-cell-dimension-value\' : cell.isDimensionValue,\r\n						\'qv-st-data-cell-numeric\': cell.isNumeric,\r\n						\'qv-st-data-cell-selected\': cell.selected,\r\n						\'qv-st-data-cell-selected-highlighted\': cell.selectedHighlighted,\r\n						\'qv-st-data-cell-null-value\': cell.isNullValue,\r\n						\'qv-st-data-cell-locked\': cell.isSelectLocked,\r\n						\'qv-st-data-cell-color-dark\': cell.color.bgByExpression && !cell.color.bgIsDark,\r\n						\'qv-st-data-cell-color-light\': cell.color.bgByExpression && cell.color.bgIsDark }">\r\n					<qv-straight-table-data-cell></qv-straight-table-data-cell>\r\n				</td>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n	<qv-scroll-loader class="qv-scroll-row-loader"></qv-scroll-loader>\r\n	<qv-scroll-load-button ng-show="interactive && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/data/straight-table-data",["qvangular","text!./straight-table-data.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStraightTableData",[function(){return{restrict:"E",replace:!0,template:template}}])}),define("text!extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell.ng.html",[],function(){return'<div ng-class="{ \'qv-st-fade-out\': !cell.color.bgByExpression, \'qv-st-fade-out-bgr-expr\': cell.color.bgByExpression}" title="{{cell.value}}">\r\n	{{cell.value}} <div ng-if="cell.color.bgByExpression && !cell.isNumeric" class="qv-st-fade-out-bgr-expr-overlay" ng-attr-style="background-image: linear-gradient(to right, {{cell.color.fadeFromColor}}, {{cell.color.fadeToColor}});"></div>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell",["qvangular","text!./straight-table-data-cell.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStraightTableDataCell",[function(){return{restrict:"E",replace:!0,template:template,link:function(){}}}])}),define("text!extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header.ng.html",[],function(){return'<div class="qv-st-bottom-header" tid="qv-st-bottom-header" ng-style="topBottomStyle">\r\n	<table>\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.footerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-total-cell\': header.isTotal,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-measure\': header.isMeasure,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon }"\r\n					colspan="{{header.colspan}}">\r\n					<qv-straight-table-header-cell></qv-straight-table-header-cell>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header",["qvangular","text!./straight-table-bottom-header.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStraightTableBottomHeader",function(){return{restrict:"E",replace:!0,template:template,link:function(){}}})}),define("client.property-panel/components/components",[],function(){function findComponent(definition){var component=definition.component;if("string"==typeof component)return components[component]?components[component]:(window.console.log('Error! No component found with name "'+component+'"'),components.missing);if("object"==typeof component)return component;switch(definition.type){case"items":return components.items;case"string":return components.string;case"integer":return components.integer;case"number":return components.number;case"boolean":return components.checkbox;case"array":return definition.items?components.list:components.slider;default:return definition.type?(window.console.log('Error! No component found for type "'+definition.type+'"'),components.missing):(window.console.log('Warning! Missing component/type in definition. Using "items" component.'),components.items)}}function getComponent(name){return components[name]}function hasComponent(name){return!!getComponent(name)}function addComponent(name,component){if(components[name])throw"Property panel component already loaded: "+name;components[name]=component}var components={missing:{template:"<div></div>",controller:[function(){}]}};return{getComponent:getComponent,hasComponent:hasComponent,findComponent:findComponent,addComponent:addComponent}}),define("text!client.property-panel/popovers/type-popover.ng.html",[],function(){return'<immidiate-contextual width="150" align-to="alignTo" position="\'bottom\'" on-close-view="closeTypeFoldout(event)" class="pp-type-popover" tid="pp-type-popover">\r\n	<ul class="qui-icontextlist">\r\n		<li ng-repeat="item in items" tid="{{item.tid}}" ng-class="{ \'qui-disabled\': item.disabled() }" qva-activate="itemClicked($event,item);">\r\n			<span class="qui-textlist-text" q-translation="{{item.translation}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>'}),define("client.property-panel/popovers/type-popover",["text!./type-popover.ng.html"],function(typePopoverTemplate){return{template:typePopoverTemplate,controller:["$scope",function($scope){$scope.itemClicked=function(event,item){event.preventDefault(),item.disabled()||item.select()}}],scope:{items:"=",alignTo:"=",closeTypeFoldout:"="}}}),define("general.sortable/sortable-list-service",["jquery","qvangular"],function($,qvangular){"use strict";qvangular.service("qvSortableListDragService",[function(){var service;return service={$new:function(){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0}},startOffset:function($scroll,drag,$drag,startPoint){var $offsetParent=$drag.offsetParent(),pos=$drag.position();drag.left=pos.left+$offsetParent[0].scrollLeft,drag.top=pos.top+$offsetParent[0].scrollTop,drag.offsetX=drag.left-startPoint.x-$offsetParent[0].scrollLeft,drag.offsetY=drag.top-startPoint.y-$offsetParent[0].scrollTop},startData:function($scroll,drag,$drag,itemKey){drag.scroll.clientRect=$scroll[0].getBoundingClientRect(),drag.scroll.width=$scroll[0].scrollWidth,drag.scroll.height=$scroll[0].scrollHeight,drag.clientRect=$drag[0].getBoundingClientRect(),drag.minLeft=-drag.clientRect.width,drag.maxLeft=drag.scroll.width,drag.minTop=-drag.clientRect.height,drag.maxTop=drag.scroll.height-drag.clientRect.height,drag.fromItem=$drag.scope()[itemKey],drag.toItem=void 0,drag.enterItem=void 0,drag.enterList=void 0},updateData:function($scroll,drag,$drag,pageX,pageY,listSelector,listKey,itemSelector,itemKey,enterItemFn,enterListFn){function isValidElement($el){return $el.length&&service.isChild($scroll[0],$el[0])}var $enter,enterElement,enterItem,enterList,dataFn=function(){};drag.pageX=pageX,drag.pageY=pageY,drag.pageX<=drag.scroll.clientRect.left?drag.pageX=drag.scroll.clientRect.left+1:drag.pageX>=drag.scroll.clientRect.left+drag.scroll.clientRect.width&&(drag.pageX=drag.scroll.clientRect.left+drag.scroll.clientRect.width-1),drag.pageY<=drag.scroll.clientRect.top?drag.pageY=drag.scroll.clientRect.top+1:drag.pageY>=drag.scroll.clientRect.top+drag.scroll.clientRect.height&&(drag.pageY=drag.scroll.clientRect.top+drag.scroll.clientRect.height-1);var display=$drag[0].style.display;$drag[0].style.display="none",enterElement=document.elementFromPoint(drag.pageX,drag.pageY),$enter=$(enterElement).closest(itemSelector),isValidElement($enter)?dataFn=function($el){enterItem=$el.scope()[itemKey],drag.enterItem!==enterItem&&(drag.enterList=void 0,drag.enterItem=enterItem,drag.toItem=drag.enterItem,enterItemFn())}:($enter=$(enterElement).closest(listSelector),isValidElement($enter)?dataFn=function($el){enterList="function"==typeof listKey?listKey($el):$el.scope()[listKey],drag.enterList!==enterList&&(drag.enterList=enterList,drag.enterItem=void 0,drag.toItem=void 0,enterListFn())}:drag.enterItem=void 0),$drag[0].style.display=display,dataFn($enter)},start:function($scroll,drag,$drag){$drag[0].style||($drag[0].style=""),$drag[0].style.position="absolute",$drag[0].style.width=drag.clientRect.width+"px",$drag[0].style.height=drag.clientRect.height+"px",$drag[0].style.pointerEvents="none",$drag[0].style.left=drag.left+"px",$drag[0].style.top=drag.top+"px",$drag[0].style.zIndex=1},update:function($scroll,drag,$drag,swipe){var left,top;switch(drag.direction){case"horizontal":drag.left=swipe.currentPoint.x+drag.offsetX+$scroll[0].scrollLeft;break;case"vertical":drag.top=swipe.currentPoint.y+drag.offsetY+$scroll[0].scrollTop;break;default:drag.left=swipe.currentPoint.x+drag.offsetX+$scroll[0].scrollLeft,drag.top=swipe.currentPoint.y+drag.offsetY+$scroll[0].scrollTop}left=drag.left,top=drag.top,drag.left<drag.minLeft?left=drag.minLeft:drag.left>drag.maxLeft&&(left=drag.maxLeft),drag.top<drag.minTop?top=drag.minTop:drag.top>drag.maxTop&&(top=drag.maxTop),$drag[0].style.left=left+"px",$drag[0].style.top=top+"px"},end:function(drag,$drag){drag.stopAutoScrolling&&(drag.stopAutoScrolling(),drag.stopAutoScrolling=null),$drag&&$drag.length&&$drag[0].removeAttribute("style")},isParent:function(parent,target){return parent===target},isChild:function(parent,target){var cur=target;if(service.isParent(parent,target))return!1;for(;cur;){if(cur===parent)return!0;cur=cur.parentNode}return!1},autoScroll:function(scrollElem,scrollClientRect,scrollWidth,scrollHeight,drag,updateCallback,scrollSpeed,scrollSensitivity){function scrollLoop(scrollOffsetX,scrollOffsetY){if(scrollLeft=scrollElem.scrollLeft,scrollTop=scrollElem.scrollTop,scroll){if(0>scrollOffsetX&&0===scrollLeft)return void(scroll=!1);if(scrollOffsetX>0&&scrollLeft+parseInt(scrollClientRect.height+.5,10)>=scrollWidth)return void(scroll=!1);if(0>scrollOffsetY&&0===scrollTop)return void(scroll=!1);if(scrollOffsetY>0&&scrollTop+parseInt(scrollClientRect.height+.5,10)>=scrollHeight)return void(scroll=!1);0!==scrollOffsetX&&(scrollElem.scrollLeft+=scrollOffsetX),0!==scrollOffsetY&&(scrollElem.scrollTop+=scrollOffsetY),updateCallback(),setTimeout(function(){scrollLoop(scrollOffsetX,scrollOffsetY)})}}var scroll=!0,scrollLeft=0,scrollTop=0,offsetX=0,offsetY=0;switch(drag.direction){case"horizontal":drag.pageX<=scrollClientRect.left+scrollSensitivity?offsetX=-scrollSpeed:drag.pageX>=scrollClientRect.left+scrollClientRect.width-scrollSensitivity&&(offsetX=scrollSpeed);break;case"vertical":drag.pageY<=scrollClientRect.top+scrollSensitivity?offsetY=-scrollSpeed:drag.pageY>=scrollClientRect.top+scrollClientRect.height-scrollSensitivity&&(offsetY=scrollSpeed);break;default:drag.pageY<=scrollClientRect.top+scrollSensitivity?offsetY=-scrollSpeed:drag.pageY>=scrollClientRect.top+scrollClientRect.height-scrollSensitivity&&(offsetY=scrollSpeed)}return(0!==offsetX||0!==offsetY)&&scrollLoop(offsetX,offsetY),drag.stopAutoScrolling&&(drag.stopAutoScrolling(),delete drag.stopAutoScrolling),drag.stopAutoScrolling=function(){scroll=!1},drag.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(Class,util,$,qvangular,Touche,DOMUtil){"use strict";var DefaultSortableList=Class.extend("DefaultSortableList",{init:function(options){this.options=util.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index"},options||{})},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},allowDrag:function(e){return Touche.utils.isMouse(e)?!!$(e.target).closest(this.options.itemSelector).length:!!$(e.target).closest(this.options.itemDragSelector).length},allowScroll:function(e){return!this.allowDrag(e)},allowEnter:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(defaultScrollFn){defaultScrollFn()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(e){return Touche.utils.isMouse(e)?15:25},getScrollSpeed:function(e){return Touche.utils.isMouse(e)?15:25}});return qvangular.directive("qvSortableList",["$parse","qvSortableListDragService",function($parse,dragService){return{restrict:"A",controller:function(){},link:function($scope,$element,$attrs,ctrl){var unWatch=$scope.$watch($attrs.qvSortableList,function(api){function on(){return $drag=void 0,Touche($element[0])[gesture.name](dragFlow).tap(tapFlow),Touche($scrollElem[0]).tap({id:"sortable-list-tap-"+$scope.$id,options:{preventDefault:!1},start:function(e){api.allowScroll(e)||DOMUtil.isInput(e.target)||e.preventDefault()}}),function(){Touche($scrollElem[0]).off("*","sortable-list-tap-"+$scope.$id),Touche($element[0]).off("*",ns)}}if(unWatch(),!(api instanceof DefaultSortableList)){var DefaultSortableApi=DefaultSortableList.extend(api||{});api=new DefaultSortableApi(api&&api.options)}var $scrollElem=$element.closest(api.options.scrollSelector);$scrollElem.length||($scrollElem=$element);var $drag,scrollSpeed,scrollSensitivity,gesture,off,drag=dragService.$new(),ns="sortable-list-"+$scope.$id,tapFlow={id:ns,options:{preventDefault:!1},start:function(e,data){if($drag=void 0,!DOMUtil.isInput(e.target)&&dragService.isChild($scrollElem[0],e.target)&&api.allowDrag(e)){if($drag=$(e.target).closest(api.options.itemSelector),0===$drag.length)return void($drag=void 0);drag.direction=api.getDirection(),scrollSpeed=api.getScrollSpeed(e),scrollSensitivity=api.getScrollSensitivity(e),dragService.startOffset($scrollElem,drag,$drag,data.pagePoints[0]),dragService.startData($scrollElem,drag,$drag,api.options.itemKey)}},end:function(){$drag=void 0}},dragFlow={id:ns,start:function(e){return $drag?(e.preventDefault(),api.onBegin(drag.fromItem,drag.clientRect),$scope.$digest(),void dragService.start($scrollElem,drag,$drag)):void this.cancel()},update:function(e,data){function update(){dragService.update($scrollElem,drag,$drag,data.swipe),dragService.updateData($scrollElem,drag,$drag,data.pagePoints[0].x,data.pagePoints[0].y,api.options.listSelector,api.options.listKey,api.options.itemSelector,api.options.itemKey,function(){trigger()},function(){api.onEnterList(drag.enterList),$scope.$digest()})}function trigger(){api.allowEnter(drag.enterItem,drag.fromItem)?(api.onEnter(drag.enterItem),$scope.$digest()):(drag.enterItem=void 0,drag.toItem=void 0)}if(!$drag)return void this.cancel();if(update(),api.allowAutoScroll()){var defaultScrollFn=dragService.autoScroll.bind(this,$scrollElem[0],drag.scroll.clientRect,drag.scroll.width,drag.scroll.height,drag,update,scrollSpeed,scrollSensitivity);api.onAutoScroll(defaultScrollFn,drag.enterList,drag.enterItem,function($elem,clientRect,scrollWidth,scrollHeight){dragService.autoScroll($elem,clientRect,scrollWidth,scrollHeight,drag,update,scrollSpeed,scrollSensitivity)})}},end:function(){dragService.end(drag,$drag),void 0!==drag.toItem?(api.onMove(drag.fromItem,drag.toItem),$scope.$digest()):void 0!==drag.enterList?(api.onMoveToList(drag.fromItem,drag.enterList),$scope.$digest()):(api.onCancel(),$scope.$digest()),$drag=void 0},cancel:function(){$drag&&(dragService.end(drag,$drag),api.onCancel(),$drag=void 0)}};gesture=api.options.gesture,dragFlow.options=gesture.options,$scope.$on("$destroy",function(){Touche($scrollElem[0]).off("*","sortable-list-tap-"+$scope.$id),Touche($element[0]).off("*",ns)}),ctrl.on=function(){off||(off=on())},ctrl.off=function(){off&&(off(),off=void 0)},ctrl.cancel=function(){dragFlow.cancel()},ctrl.on()})}}}]),DefaultSortableList}),define("general.sortable/sortable-item-lists",["core.utils/class","general.sortable/sortable-list"],function(Class,SortableList){"use strict";var TypeFlag={Dimensions:1,Measures:2,Placeholder:16,Locked:32},SortableItem=Class.extend("SortableItem",{init:function(title,id,classList,typeFlag){this.title=title,this.id=id,this.classList=classList||[],this.typeFlag=typeFlag||1},addClass:function(className){if(className){var ix=this.classList.indexOf(className);return-1===ix&&this.classList.push(className),this}},removeClass:function(className){if(className){var ix=this.classList.indexOf(className);return-1!==ix&&this.classList.splice(ix,1),this}},hasClass:function(className){return-1!==this.classList.indexOf(className)}}),SortableItemList=Class.extend("SortableItemList",{init:function(typeFlag,options){this.items=[],this.disabled=!1,this.typeFlag=typeFlag||1,Object.keys(options||{}).forEach(function(key){this[key]=options[key]},this)},add:function(title,id,classList,typeFlag){var item=new SortableItem(title,id,classList,typeFlag);return this.items.push(item),item},addItem:function(item){if(!(item instanceof SortableItem))throw new Error("item not instance of SortableItem");return this.items.push(item),item},createItem:function(options){var item=new SortableItem;return Object.keys(options||{}).forEach(function(key){item[key]=options[key]}),item},moveItem:function(fromIx,toIx){this.items.splice(toIx,0,this.items.splice(fromIx,1)[0])},getItemByIndex:function(ix){return this.items[ix]},getItemById:function(id){return this.get(function(item){return item.id===id})[0]},getIndexByItem:function(item){return this.items.indexOf(item)},get:function(filterFn){return this.items.filter(filterFn||function(){return!0})},getLockedIndices:function(){return this.get(function(item){return!!(item.typeFlag&TypeFlag.Locked)}).map(function(item){return this.getIndexByItem(item)},this)},reset:function(){this.items.length=0,this.disabled=!1},isEmpty:function(){return 0===this.items.length}});Object.defineProperties(SortableItemList.prototype,{length:{get:function(){return this.items.length}}});var SortableItemLists=SortableList.extend("SortableItemLists",{init:function(){this._super.apply(this,arguments),this.lists=[],this.dragPlaceholder=null},addPlaceholder:function(fromItem){var fromList=this.getList(fromItem),ix=fromList.items.indexOf(fromItem);return this.dragPlaceholder=new SortableItem("","placeholder",[],TypeFlag.Placeholder),fromList.items.splice(ix,0,this.dragPlaceholder),this.dragPlaceholder.style={visibility:"hidden"},this.dragPlaceholder},removePlaceholder:function(){if(this.dragPlaceholder){var list=this.getList(this.dragPlaceholder),ix=list.items.indexOf(this.dragPlaceholder);-1!==ix&&(list.items.splice(ix,1),this.dragPlaceholder=null)}},getPlaceholder:function(){return this.dragPlaceholder},createList:function(typeFlag,options){var list=new SortableItemList(typeFlag,options);return this.lists.push(list),list},reset:function(){this.lists.forEach(function(list){list.reset()})},getList:function(item){return this.lists.filter(function(list){return-1!==list.items.indexOf(item)})[0]},disable:function(item){this.lists.forEach(function(list){list.disabled=!(item.typeFlag&list.typeFlag)})},enable:function(){this.lists.forEach(function(list){list.disabled=!1})},moveItem:function(fromItem,toItem){var fromIx,toIx,fromList=this.getList(fromItem),toList=this.getList(toItem);fromList&&toList&&(toIx=toList.items.indexOf(toItem),fromIx=fromList.items.indexOf(fromItem),fromList.items.splice(fromIx,1),toList.items.splice(toIx,0,fromItem))},onBegin:function(fromItem,clientRect){this.addPlaceholder(fromItem,clientRect),this.disable(fromItem)},onEnter:function(enterItem){var list=this.getList(enterItem),moveToIndices=list.getLockedIndices();this.moveItem(this.dragPlaceholder,enterItem);var fromIndices=list.getLockedIndices();moveToIndices.forEach(function(toIx,ix){list.moveItem(fromIndices[ix],toIx)})},onEnterList:function(enterList){if(!enterList.disabled){var fromList=this.getList(this.dragPlaceholder),fromIx=fromList.getIndexByItem(this.dragPlaceholder);fromList.items.splice(fromIx,1),enterList.items.push(this.dragPlaceholder)}},onMove:function(fromItem){var toItem=this.dragPlaceholder;this.moveItem(fromItem,toItem),this.removePlaceholder(),this.enable()},onMoveToList:function(fromItem,toList){if(!toList.disabled){var fromList=this.getList(fromItem),fromIx=fromList.items.indexOf(fromItem);if(fromList===toList)return void this.onMove(fromItem);fromList.items.splice(fromIx,1),toList.items.push(fromItem)}this.removePlaceholder(),this.enable()},onCancel:function(){this.removePlaceholder(),this.enable()},allowEnter:function(enterItem,fromItem){return!!(fromItem.typeFlag&this.getList(enterItem).typeFlag)}});return SortableItemLists.create=function(api){var SortableItemListsApi=SortableItemLists.extend(api||{});return api=new SortableItemListsApi(api&&api.options)},SortableItemLists}),define("extensions.qliktech/straight-table/properties/columns/columns-sorting-util",["general.utils/array-util"],function(arrayUtil){function validateTableHyperCube(hypercubeDef){function buildDefaultArray(){for(var array=[],i=0;i<dimensions.length+measures.length;i++)array.push(i);return array}var dimensions=hypercubeDef.qDimensions,measures=hypercubeDef.qMeasures;isInvalidOrderArray(dimensions,measures,hypercubeDef.columnOrder)&&(hypercubeDef.columnOrder=buildDefaultArray()),isInvalidOrderArray(dimensions,measures,hypercubeDef.qInterColumnSortOrder)&&(hypercubeDef.qInterColumnSortOrder=buildDefaultArray())}function isInvalidOrderArray(dimensions,measures,array){var indexSet={},sortedArray=[],isInvalid=!1;array.forEach(function(item){indexSet[item]?isInvalid=!0:indexSet[item]=!0}),isInvalid=isInvalid||dimensions.length+measures.length!==Object.keys(indexSet).length,Object.keys(indexSet).forEach(function(indexStr){sortedArray.push(parseInt(indexStr,10))}),sortedArray=sortedArray.sort(function(a,b){return a-b});for(var i=0;i<sortedArray.length;++i)isInvalid=isInvalid||sortedArray[i]!==i;return isInvalid}function fixTableHypercubeOrders(hypercubeDef){function fixDimensions(){for(var i=0;i<dimColOrders.length;i++)if(dimColOrders[i]!==i){var moveFrom=dimColOrders[i],moveToIndex=dimColOrders.indexOf(i),moveTo=dimColOrders[moveToIndex];arrayUtil.swap(dimColOrders,i,moveToIndex),arrayUtil.swap(dimensions,moveFrom,moveTo),arrayUtil.swap(columnOrder,columnOrder.indexOf(moveFrom),columnOrder.indexOf(moveTo)),arrayUtil.swap(interColSortOrder,interColSortOrder.indexOf(moveFrom),interColSortOrder.indexOf(moveTo))}}function fixMeasures(){for(var i=0;i<measColOrders.length;i++)if(measColOrders[i]!==i+dimensions.length){var moveFrom=measColOrders[i],moveToIndex=measColOrders.indexOf(i+dimensions.length),moveTo=measColOrders[moveToIndex];arrayUtil.swap(measColOrders,i,moveToIndex),arrayUtil.swap(measures,moveFrom-dimensions.length,moveTo-dimensions.length),arrayUtil.swap(columnOrder,columnOrder.indexOf(moveFrom),columnOrder.indexOf(moveTo)),arrayUtil.swap(interColSortOrder,interColSortOrder.indexOf(moveFrom),interColSortOrder.indexOf(moveTo))}}validateTableHyperCube(hypercubeDef);for(var order,dimensions=hypercubeDef.qDimensions,measures=hypercubeDef.qMeasures,columnOrder=hypercubeDef.columnOrder,interColSortOrder=hypercubeDef.qInterColumnSortOrder,dimColOrders=[],measColOrders=[],i=0;i<columnOrder.length;i++)order=columnOrder[i],order<dimensions.length?dimColOrders.push(order):measColOrders.push(order);fixDimensions(),fixMeasures()}return{validateTableHyperCube:validateTableHyperCube,fixTableHypercubeOrders:fixTableHypercubeOrders,isInvalidOrderArray:isInvalidOrderArray}}),define("text!client.property-panel/components/common/data.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="data">\r\n	<button class="qui-outlinebutton pp-toplist-add-button" qva-activate="addClicked($event)" qv-enter="addClicked($event)"\r\n			ng-disabled="addDisabled()" tid="add-data">\r\n		{{getAddLabel()}}\r\n		<i class="toggle-expand icon-triangle-bottom" ng-if="hasMultipleAddOptions()"></i>\r\n	</button>\r\n\r\n	<div class="pp-toplist-content pp-data-container" qv-sortable-list="sortableItemLists">\r\n		<div class="pp-data" ng-repeat="list in sortableItemLists.lists" tid="{{list.tid}}" ng-class="{ \'disabled\': list.disabled }" ng-if="list.show() != false">\r\n			<div class="pp-data-header ">\r\n				<span class="pp-data-header-text">{{list.title}}</span>\r\n			</div>\r\n\r\n			<ul class="pp-expandable-list pp-data-list">\r\n				<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</div>'}),define("extensions.qliktech/straight-table/properties/columns/columns",["qvangular","jquery","touche","client.property-panel/components/components","general.utils/support","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","general.utils/property-resolver","general.services/show-service/show-service","general.sortable/sortable-item-lists","extensions.qliktech/straight-table/properties/columns/columns-sorting-util","text!client.property-panel/components/common/data.ng.html","general.components/context-menu/context-menu-service"],function(qvangular,$,Touche,components,support,errorTranslation,translator,addDimensionPopoverComponent,addMeasurePopoverComponent,typePopoverComponent,propertyResolver,showService,SortableItemLists,columnsSortingUtil,template){return{name:"columns",template:template,controller:["$scope","$element","$timeout","qvGridObjectDataService",function($scope,$element,$timeout,dataService){function showTypePopover(event){
var target=$(event.currentTarget);typePopover=showService.show(typePopoverComponent,{items:[{tid:"dimension",select:function(){openAddPopover("dimension",target)},disabled:function(){return $scope.args.handler.getDimensions().length>=$scope.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){openAddPopover("measure",target)},disabled:function(){return $scope.args.handler.getMeasures().length>=$scope.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:closeTypePopover,alignTo:target})}function closeTypePopover(event){typePopover&&(typePopover.destroy(),typePopover=null),event&&$(event.target).hasClass("pp-toplist-add-button")&&Touche.preventGestures(),$scope.addType=null}function handleColumnOrderMigration(){var columnOrder=propertyResolver.getValue($scope.data,$scope.definition.sortIndexRef);void 0===columnOrder?(columnOrder=dataService.columnOrder.get($scope.args.handler.getDimensionLayouts(),$scope.args.handler.getMeasureLayouts()),propertyResolver.setValue($scope.data,$scope.definition.sortIndexRef,columnOrder),$scope.$emit("saveProperties")):columnOrder.length&&"number"!=typeof columnOrder[0]&&(propertyResolver.setValue($scope.data,$scope.definition.sortIndexRef,columnOrder.map(function(o){return o.dataColIx})),$scope.$emit("saveProperties"))}function refresh(){handleColumnOrderMigration();var columnOrder=propertyResolver.getValue($scope.data,$scope.definition.sortIndexRef),dimCnt=$scope.data.qHyperCubeDef.qDimensions.length;if($scope.sortableItemLists.reset(),columnOrder.forEach(function(dataColIx,index){var sourceDefinition,sourceIndex,dataItem,type,id;dimCnt>dataColIx?(sourceIndex=dataColIx,dataItem=$scope.data.qHyperCubeDef.qDimensions[sourceIndex],type="dimension",id=dataItem.qDef.cId,sourceDefinition=$scope.definition.items.dimensions):(sourceIndex=dataColIx-dimCnt,dataItem=$scope.data.qHyperCubeDef.qMeasures[sourceIndex],id=dataItem.qDef.cId,type="measure",sourceDefinition=$scope.definition.items.measures);var item=list.createItem({title:function(){var title;if("dimension"===type){var dim=$scope.args.handler.getDimensionLayout(id);title=dim&&dim.qError?errorTranslation.getDimensionError(dim.qError.qErrorCode):dataItem.qLibraryId?dim&&dim.title||"":dim&&dim.qFallbackTitle||""}else{var meas=$scope.args.handler.getMeasureLayout(dataItem.qDef.cId);title=meas&&meas.qError?errorTranslation.getMeasureError(meas.qError.qErrorCode):meas&&meas.qFallbackTitle||""}return title},isInvalid:function(){if("dimension"===type){var dim=$scope.args.handler.getDimensionLayout(id);return dim&&!!dim.qError}var meas=$scope.args.handler.getMeasureLayout(id);return meas&&!!meas.qError},component:itemsComponent,definition:{type:"items",items:sourceDefinition.items},data:dataItem,args:$scope.args,id:id,expanded:cache.get(cacheKey+id)||!1,index:index,type:type,sourceIndex:sourceIndex,dataColIx:dataColIx,templateSrc:"pp-data-item.ng.html",markerClass:"dimension"===type?"pp-dimension":"pp-measure",sortable:$scope.definition.allowMove!==!1});list.addItem(item)}),list.isEmpty()){var emptyItem=list.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1});list.addItem(emptyItem)}}function addFieldDimension(item){$scope.args.handler.addFieldDimension(item.value,"").then(function(dimension){cache.put(cacheKey+dimension.qDef.cId,!0),$scope.$emit("saveProperties",$scope.data),closeAddPopover(),scrollToLastItem()})}function addLibraryDimension(item){$scope.args.handler.addLibraryDimension(item.libraryId).then(function(dimension){cache.put(cacheKey+dimension.qDef.cId,!0),$scope.$emit("saveProperties",$scope.data),closeAddPopover(),scrollToLastItem()})}function addLibraryMeasure(item){$scope.args.handler.addLibraryMeasure(item.libraryId).then(function(measure){cache.put(cacheKey+measure.qDef.cId,!0),$scope.$emit("saveProperties",$scope.data),closeAddPopover(),scrollToLastItem()})}function addExpressionMeasure(item){$scope.args.handler.addExpressionMeasure(item.value,"").then(function(measure){cache.put(cacheKey+measure.qDef.cId,!0),$scope.$emit("saveProperties",$scope.data),closeAddPopover(),scrollToLastItem()})}function openAddPopover(type,alignTo){$scope.addType=type,closeTypePopover(),collapseItems(),"dimension"===type?(addPopover=showService.show(addDimensionPopoverComponent,{alignTo:alignTo,position:"bottom",closeAddPopover:closeAddPopover,addFieldDimension:addFieldDimension,addLibraryDimension:addLibraryDimension}),$scope.adding=!0):addPopover=showService.show(addMeasurePopoverComponent,{alignTo:alignTo,position:"bottom",closeAddPopover:closeAddPopover,addLibraryMeasure:addLibraryMeasure,addExpressionMeasure:addExpressionMeasure})}function closeAddPopover(event){addPopover&&(addPopover.destroy(),addPopover=null),event&&$(event.target).hasClass("pp-toplist-add-button")&&Touche.preventGestures(),$scope.adding=!1}function scrollToLastItem(){$timeout(function(){var $containerElem=$element.find(".pp-toplist-content"),$newElem=$containerElem.find(".pp-data-list").children().last();$containerElem[0].scrollTop=$newElem[0].offsetTop-1},100)}function collapseItems(){list.items.forEach(function(item){item.expanded=!1,cache.put(cacheKey+item.id,!1)})}var cache=$scope.args.cache,cacheKey="columns_",itemsComponent=components.getComponent("items");$scope.expandClicked=function(event,item){item.disabled||$(event.target).hasClass("pp-move-item")||(item.expanded=!item.expanded,cache.put(cacheKey+item.id,item.expanded))};var typePopover=null,addPopover=null,contextMenuPopover=null;$scope.addClicked=function(event){showTypePopover(event)},$scope.hasMultipleAddOptions=function(){return!0},$scope.getAddLabel=function(){return translator.get("properties.columns.add")},$scope.removeItem=function(item){"dimension"===item.type?$scope.args.handler.removeDimension(item.sourceIndex).then(function(){$scope.$emit("saveProperties")}):$scope.args.handler.removeMeasure(item.sourceIndex).then(function(){$scope.$emit("saveProperties")})},$scope.openContextMenu=function(event,item){var menu=qvangular.getService("qvContextMenu").menu();menu.addItem({translation:"Common.Delete",tid:"delete",select:function(){$scope.removeItem(item)}}),contextMenuPopover=qvangular.getService("qvContextMenu").show(menu,{position:{x:event.pageX,y:event.pageY},docking:"Top"})},$scope.$on("pp-open-path",function(event,path){var parts=path.split("."),section=parts[0],cId=parts[1];"columns"===section&&cId&&(cache.put(cacheKey+cId,!0),scrollToLastItem())}),$scope.add=function(value){value&&value.trim().length&&("measure"===$scope.addType?addExpressionMeasure({value:value,label:value}):"dimension"===$scope.addType&&addFieldDimension({value:value,label:value}))},$scope.sortableItemLists=SortableItemLists.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:support.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var placeholder=this._super.apply(this,arguments);placeholder.addClass("qv-pp-sortable"),placeholder.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),collapseItems()},onMove:function(){this._super.apply(this,arguments),$scope.data.qHyperCubeDef.columnOrder=list.get().filter(function(item){return"empty-item"!==item.id}).map(function(item){return item.dataColIx}),columnsSortingUtil.fixTableHypercubeOrders($scope.data.qHyperCubeDef),$scope.$emit("saveProperties")}});var list=$scope.sortableItemLists.createList(1,{title:translator.get("Common.Columns"),tid:"columns"});$scope.$watchCollection("data.qHyperCubeDef.columnOrder",refresh),$scope.$watchCollection("data.qHyperCubeDef.qDimensions",refresh),$scope.$watchCollection("data.qHyperCubeDef.qMeasures",refresh),$scope.$on("$destroy",function(){closeTypePopover(),closeAddPopover(),contextMenuPopover&&contextMenuPopover.destroy()})}]}}),define("text!extensions.qliktech/straight-table/column-picker/column-picker.ng.html",[],function(){return'<div class="qv-st-column-picker"\r\n	 tid="qv-st-column-picker"\r\n	 qva-activate="interactive && !selections.active && toggleColumnPickerPopover();"\r\n	 qva-outside-ignore-for="{{columnPicker.qvaOutsideIgnoreFor}}"\r\n	 ng-class="{ \'qv-st-column-picker-open\': columnPicker.showPopover }">\r\n	<table>\r\n		<tr>\r\n			<td q-title-translation="{{columnPicker.showPopover ? \'Tooltip.CloseColumnPicker\' : \'Tooltip.ColumnPicker\'}}">\r\n				<div class="qv-st-column-picker-more"></div>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n</div>\r\n'}),define("text!extensions.qliktech/straight-table/column-picker/column-picker-popover.ng.html",[],function(){return'<immidiate-contextual class="qv-st-column-picker-popover"\r\n					  align-to="$alignColumnPickerTo"\r\n					  position="\'left\'"\r\n					  collision="\'flip fit\'"\r\n					  width="180"\r\n					  height="\'auto\'"\r\n					  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}"\r\n					  on-close-view=" toggleColumnPickerPopover();">\r\n	<div class="qv-st-cp-header-wrapper"><p class="qv-st-cp-header" q-translation="Common.Columns"></p></div>\r\n	<ul class="qv-st-cp-popover-list"\r\n		qv-sortable-list="sortableItemLists">\r\n		<li class="qv-st-cp-popover-list-item"\r\n			draggable="false"\r\n			ng-repeat="col in columnPicker.columns.items track by col.id"\r\n			ng-class="col.classList"\r\n			ng-style="col.style">\r\n			<table class="qv-st-cp-popover-table" ng-if="col.id !== -2">\r\n				<tr>\r\n					<td ng-class="{ \'disabled\': col.disabled }">\r\n						<div class="qv-st-cp-fade-out">{{col.title}}</div>\r\n					</td>\r\n					<td ng-if="col.id >= 0" class="qv-st-cp-handle">\r\n						<div class="icon-handle"></div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("extensions.qliktech/straight-table/column-picker/column-picker",["jquery","qvangular","text!./column-picker.ng.html","text!./column-picker-popover.ng.html","core.utils/resize","general.sortable/sortable-item-lists","general.sortable/sortable-list"],function($,qvangular,template,popoverTemplate,resize,SortableItemLists){"use strict";return qvangular.service("qvStraighTableColumnPickerService",["$document",function($document){var $container,service,$body=$document.find("body");return service={show:function(input){return $container=$document.find(".qv-st-column-picker-popover"),$container.length||($container=$("<div>")),$container.showComponent({controller:function(){},template:popoverTemplate},input),$container.appendTo($body),function(){$container.remove()}}}}]),qvangular.directive("qvStraightTableColumnPicker",function(){return{restrict:"A",require:"qvSortableList",link:function($scope,$element,$attrs,sortableCtrl){$scope.columnPicker.cancel=function(){sortableCtrl.cancel()}}}}),qvangular.directive("qvStraightTableColumnPickerActivator",["qvStraighTableColumnPickerService",function(popoverService){return{restrict:"E",replace:!0,template:template,require:"^qvStraightTable",link:function($scope,$element,$attrs,tableCtrl){function updateDisabled(){$scope.columnPicker.columns.get().forEach(function(item,ix){$scope.scrollApi.settings.columnCount<ix?item.disabled=!0:item.disabled=!1})}function update(){var title,dividerItem,fromIx,toIx,dims=$scope.layout.qHyperCube.qDimensionInfo,meas=$scope.layout.qHyperCube.qMeasureInfo,dimCnt=dims.length;$scope.columnPicker.cancel(),$scope.columnPicker.columns.reset(),$scope.layout.qHyperCube.columnOrder.forEach(function(ix){title=dimCnt>ix?dims[ix].qFallbackTitle:meas[ix-dimCnt].qFallbackTitle,$scope.columnPicker.columns.add(title,ix,["qv-st-cp-sortable"])}),dividerItem=$scope.columnPicker.columns.add("",-2,["qv-st-cp-divider"],32),dividerItem.isDivider=!0,fromIx=$scope.columnPicker.columns.getIndexByItem(dividerItem),toIx=$scope.scrollApi.settings.columnCount,$scope.columnPicker.columns.moveItem(fromIx,toIx),updateDisabled()}function onResize(){resize.off("start."+$scope.$id,onResize),$scope.columnPicker.showPopover&&(removePopover(),$scope.columnPicker.showPopover=!1,$scope.$digest())}var removePopover;$scope.sortableItemLists=SortableItemLists.create({options:{direction:"vertical",itemKey:"col",itemSelector:".qv-st-cp-sortable",itemDragSelector:".qv-st-cp-handle"},addPlaceholder:function(fromItem,clientRect){var placeholder=this._super.apply(this,arguments);placeholder.style.height=clientRect.height,placeholder.id=-1},onMove:function(){this._super.apply(this,arguments),updateDisabled(),$scope.applyColumnOrderSoftPatch(!1,$scope.columnPicker.columns.get(function(item){return item.id>=0}).map(function(item){return item.id}))}}),$scope.columnPicker={showPopover:!1,columns:$scope.sortableItemLists.createList(),qvaOutsideIgnoreFor:"qv-st-column-picker-"+$scope.$id,cancel:function(){}},tableCtrl.watchPaint(update),$scope.toggleColumnPickerPopover=function(){$scope.$alignColumnPickerTo=$element,$scope.columnPicker.showPopover=!$scope.columnPicker.showPopover,$scope.columnPicker.showPopover?(update(),removePopover=popoverService.show({$alignColumnPickerTo:$scope.$alignColumnPickerTo,columnPicker:$scope.columnPicker,onMoveBegin:$scope.onMoveBegin,onMoveEnter:$scope.onMoveEnter,onMoveCancel:$scope.onMoveCancel,onMove:$scope.onMove,toggleColumnPickerPopover:$scope.toggleColumnPickerPopover,qvaOutsideIgnoreFor:$scope.columnPicker.qvaOutsideIgnoreFor,sortableItemLists:$scope.sortableItemLists,hc:$scope.layout.qHyperCube}),resize.on("start."+$scope.$id,onResize)):removePopover&&removePopover()}}}}])}),define("extensions.qliktech/straight-table/straight-table",["qvangular","core.utils/deferred","objects.backend-api/hypercube-api","extensions.qliktech/straight-table/straight-table-properties","text!./straight-table.ng.html","objects.extension/base-controller","objects.extension/object-conversion","general.utils/array-util","extensions.qliktech/straight-table/snapshot/snapshot-helper","general.utils/support","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.utils/event-utils","objects.grid/data-grid","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/straight-table/layout/top/straight-table-top-header","extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell","extensions.qliktech/straight-table/layout/data/straight-table-data","extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell","extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header","extensions.qliktech/straight-table/properties/columns/columns","extensions.qliktech/straight-table/column-picker/column-picker","objects/listbox-popover/listbox-popover-service"],function(qvangular,Deferred,HypercubeApi,propertiesDefinition,template,BaseCtrl,objectConversion,arrayUtils,TableSnapshotHelper,support,ScrollApi,ScrollDOMApi,ScrollDataApi,EventUtils,DataGrid){"use strict";var StraightTableCtrl,VisualizationScrollDataApi,SnapshotScrollDOMApi,TableScrollDOMApi;return VisualizationScrollDataApi=ScrollDataApi.extend({init:function(visualizationCtrl){this.visualizationCtrl=visualizationCtrl},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(rowIndex,height){return this.visualizationCtrl.onVirtualScroll(rowIndex,height)},onInitialNativeScroll:function(rowIndex,height){return this.visualizationCtrl.onInitialNativeScroll(rowIndex,height)},onGotoNextBlock:function(rowIndex,height){return this.visualizationCtrl.onGotoNextBlock(rowIndex,height)},onGotoPreviousBlock:function(rowIndex,height){return this.visualizationCtrl.onGotoPreviousBlock(rowIndex,height)}}),SnapshotScrollDOMApi=ScrollDOMApi.extend({init:function($element,$scrollArea,rowSelector,firstRowSelector,lastRowSelector,scrollContentSelector,snapshotObject){this.snapshotObject=snapshotObject,this._super.apply(this,arguments)},getBoundingBox:function(){var bbox;return bbox=this.snapshotObject.freeResize?this.$element[0].getBoundingClientRect():{height:this.snapshotObject.size.h,width:this.snapshotObject.size.w}}}),TableScrollDOMApi=ScrollDOMApi.extend({getScrollAreaClientHeight:function(){var containerBox=this.$element[0].getBoundingClientRect(),scrollAreaBox=this.$scrollArea[0].getBoundingClientRect();return containerBox.top+containerBox.height-scrollAreaBox.top}}),StraightTableCtrl=BaseCtrl.extend({handledColumnOrderMigration:function(){var $scope=this.$scope;return void 0===$scope.layout.qHyperCube.columnOrder||$scope.layout.qHyperCube.columnOrder.length&&"number"!=typeof $scope.layout.qHyperCube.columnOrder[0]?(this.appliedSoftPatch||(void 0===$scope.layout.qHyperCube.columnOrder?$scope.applyColumnOrderSoftPatch(!0,this.dataService.columnOrder.get($scope.layout.qHyperCube.qDimensionInfo,$scope.layout.qHyperCube.qMeasureInfo)):$scope.applyColumnOrderSoftPatch(!1,$scope.layout.qHyperCube.columnOrder.map(function(o){return o.dataColIx})),this.appliedSoftPatch=!0),!0):!1},init:function($scope,$timeout,dataService,selectionService){this.appliedSoftPatch=!1,this._paintWatches=[],this._resizeWatches=[],this.dataService=dataService,this.selectionService=selectionService,this.$timeout=$timeout,this.metaHeaders=[],this._super.apply(this,arguments),$scope.backendApi.setCacheOptions({width:1}),Object.defineProperties($scope,{isDesktop:{get:function(){return support.treatAsDesktop()}}})},watchPaint:function(fn){var ctrl=this;return ctrl._paintWatches.push(fn),function(){var ix=ctrl._paintWatches.indexOf(fn);ctrl._paintWatches.splice(ix,1)}},watchResize:function(fn){var ctrl=this;return ctrl._resizeWatches.push(fn),function(){var ix=ctrl._resizeWatches.indexOf(fn);ctrl._resizeWatches.splice(ix,1)}},update:function(qTop,qHeight,update,reversed,suppressHeaderUpdate){var dataInfo=this.getDataInfo(qTop,qHeight,suppressHeaderUpdate),def=Deferred();return this.$scope.backendApi.getData(dataInfo.rects).then(function(dataPages){this.onUpdateData({dataPages:dataPages,dataInfo:dataInfo},update,reversed,suppressHeaderUpdate).then(function(){def.resolve(dataPages)})}.bind(this)),def.promise},updateLocked:function(grid){var rows,rowCnt,cell,cellCnt,siblings,isSibling,i,dataService=this.dataService,selectionService=this.selectionService,selections=this.$scope.selections,activationCell=selections.activationCell,cells=[];if(activationCell){for(rows=grid.getRowsByCellType(grid.CELL_TYPE_DATA),siblings=dataService.getSiblingCells(grid,activationCell),rowCnt=rows.length,i=0;rowCnt>i;++i)cells=cells.concat(rows[i].cells);for(cellCnt=cells.length,i=0;cellCnt>i;++i)cell=cells[i],isSibling=-1!==siblings.indexOf(cell),(isSibling&&!cell.isDimensionValue||!isSibling&&!cell.isMeta)&&selectionService[activationCell&&selections.active?"lockCell":"unlockCell"](grid,cell)}},getDataInfo:function(qTop,qHeight,suppressHeaderUpdate){var i,metaHeaders,cnt,dataRects=[];for(suppressHeaderUpdate?metaHeaders=this.metaHeaders:(metaHeaders=this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.scrollApi.settings,this.$scope.$id),this.metaHeaders=metaHeaders),cnt=metaHeaders.length,i=0;cnt>i;++i)metaHeaders[i].isSearchIcon||dataRects.push({qLeft:metaHeaders[i].qLeft,qTop:qTop||0,qWidth:1,qHeight:qHeight});return dataRects.length||dataRects.push({qTop:0,qLeft:0,qWidth:0,qHeight:0}),{rects:dataRects,metaHeaders:metaHeaders}},onUpdateData:function(response,update,reversed,suppressHeaderUpdate){return reversed&&response.dataPages.forEach(function(page){page.qMatrix.reverse()}),this.dataService.updateStraightItems(this.$scope,response.dataPages,response.dataInfo.metaHeaders,update,reversed,suppressHeaderUpdate),reversed&&this.$scope.grid.rows.reverse(),this.$scope.selections.active&&(this.selectionService.updateStraight(this.$scope.grid,this.$scope.selections,this.$scope.selections.activationCell),this.updateLocked(this.$scope.grid)),this.$scope.backendApi.isSnapshot&&TableSnapshotHelper.scaleDynamically(this.$scope),this.$timeout(function(){},0,!1)},setSnapshotData:function(snapshotLayout){var data,dataInfo,updatingExistingSnapshot=!!snapshotLayout.sourceObjectId,$scope=this.$scope,domApi=$scope.scrollApi.domApi,scrollAreaBoundingBox=domApi.getScrollAreaBoundingBox(),rows=domApi.$scrollArea.find(".qv-st-data-row"),nbrOfColumns=$scope.scrollApi.settings.columnCount;return data=TableSnapshotHelper.getIndexHeightAndWidth(rows,nbrOfColumns,scrollAreaBoundingBox),dataInfo=this.getDataInfo(data.index,data.height),dataInfo.rects.splice(data.width),$scope.backendApi.getData(dataInfo.rects).then(function(dataPages){snapshotLayout.qHyperCube.qDataPages=dataPages,snapshotLayout.snapshotData.object.dataTableRowCount=data.height,snapshotLayout.snapshotData.object.dataTableHeight=$scope.isDesktop?scrollAreaBoundingBox.height:scrollAreaBoundingBox.height*(2/3),snapshotLayout.snapshotData.object.size.h*=$scope.isDesktop?1:2/3;var columnOrder=$scope.layout.qHyperCube.columnOrder.slice(0,dataInfo.rects.length);return updatingExistingSnapshot||(snapshotLayout.qHyperCube.columnOrder=columnOrder),snapshotLayout})},getViewState:function(){return{virtualScrollPosition:this.$scope.scrollApi.virtualScrollApi.getVirtualPosition()}},process:function(qTop,qHeight,keepScrollPos){return this.handledColumnOrderMigration()?Deferred.resolve():this.update(qTop,qHeight,!1,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qHyperCube.qSize.qcy),this.$scope.scrollApi.setVirtualSize(keepScrollPos)}.bind(this))},processPaint:function(){var bindOneNativeScrollFn,qTop=0,qHeight=this.$scope.scrollApi.settings.viewportRowCount;return bindOneNativeScrollFn=this.$scope.scrollApi.resetNativeScroll(),this.process(qTop,qHeight,!1).then(function(){bindOneNativeScrollFn()})},processResize:function(){var rowCnt=this.$scope.grid.rows.length,qTop=rowCnt?this.$scope.grid.rows[0].getIndex():0,qHeight=this.$scope.scrollApi.settings.viewportRowCount;return rowCnt>qHeight&&(qHeight=rowCnt),this.process(qTop,qHeight,!0)},onVirtualScroll:function(qTop,qHeight){return this.update(qTop,qHeight,!1,!1,!0)},gotoBlock:function(qTop,qHeight,reversed){var args=this.$scope.scrollApi.getSpliceArgs(),rows=this.$scope.grid.rows,nextRowIx=this.$scope.grid.getNextRowIx();return reversed&&rows.reverse(),rows.splice.apply(rows,args),nextRowIx-=args[1],this.$scope.grid.setNextRowIx(nextRowIx),this.update(qTop,qHeight,!0,reversed,!0)},onGotoNextBlock:function(qTop,qHeight){return this.gotoBlock(qTop,qHeight,!1)},onGotoPreviousBlock:function(qTop,qHeight){return this.gotoBlock(qTop,qHeight,!0)},getRows:function(){return this.$scope.grid.rows},getRowCount:function(){return this.$scope.grid.rows.length},getFirstElementIndex:function(){return this.$scope.grid.rows[0].getIndex()},getLastElementIndex:function(){return this.$scope.grid.rows[this.$scope.grid.rows.length-1].getIndex()}}),StraightTableCtrl.$inject=["$scope","$timeout","qvGridObjectDataService","qvGridObjectSelectionService"],qvangular.directive("qvStraightTable",["$timeout","qvGridObjectDataService","qvGridObjectSelectionService","qvListboxPopoverService",function($timeout,dataService,selectionService,listboxPopoverService){return{restrict:"E",replace:!0,template:template,require:["qvStraightTable","^qvObject"],controller:StraightTableCtrl,link:function($scope,$element,$attrs,ctrls){function update(action,callbacks){return ctrl[action]().then(function(){callbacks.forEach(function(fn){fn()})})}function confirmSelections(){ctrl.updateLocked($scope.grid),unbindKeyboard&&unbindKeyboard()}function cancelSelections(){dataService.getSiblingCells($scope.grid,$scope.selections.activationCell).forEach(function(cell){selectionService.deselectCell($scope.grid,cell)}),ctrl.updateLocked($scope.grid),unbindKeyboard&&unbindKeyboard()}function clearSelections(){$scope.selections.active&&$scope.selections.activationCell&&(dataService.getSiblingCells($scope.grid,$scope.selections.activationCell).forEach(function(cell){selectionService.deselectCell($scope.grid,cell)}),ctrl.updateLocked($scope.grid))}function selectionsActivated(){$scope.object.selectionsClass="",ctrl.updateLocked($scope.grid)}function getCellWithRowIx(cells,rowIx){var i,cell,cellCnt=cells.length;for(i=0;cellCnt>i;++i)if(cell=cells[i],cell.dataRowIx===rowIx)return cell}var unbindKeyboard,ctrl=ctrls[0],objectCtrl=ctrls[1],$scrollArea=$element.find(".qv-grid-object-scroll-area"),virtualScrollCtrl=$scrollArea.controller("qvScrollArea"),loaderCtrl=$element.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),rowLoaderCtrl=$scrollArea.find(".qv-scroll-row-loader").controller("qvScrollLoader"),namespace="."+$scope.id+"-straight-table",settings={alignToBottom:"reduce",minRowHeight:29,maxRowHeight:87,columnCount:0,column:{minWidth:102,minSearchWidth:25,glyphWidth:8,maxMeasureWidth:350},columnPicker:{show:!1,width:21},blockSize:50},scrollApi=$scope.scrollApi=new ScrollApi($timeout,settings),scrollDataApi=new VisualizationScrollDataApi(ctrl),scrollDOMApi=$scope.backendApi.isSnapshot?new SnapshotScrollDOMApi($element,$scrollArea,"","","",null,$scope.layout.snapshotData.object):new TableScrollDOMApi($element,$scrollArea,".qv-st-data-row",".qv-grid-object-data-first-row",".qv-grid-object-data-last-row");$scope.grid=new DataGrid("straight"),$scope.selections=selectionService.$new(),$scope.$on("$destroy",function(){scrollApi.destroy(),$element.off(namespace)}),$element.on("contextmenu"+namespace,function(event){$scope.selections.active&&event.preventDefault()}),scrollApi.initialize(scrollDOMApi,scrollDataApi,virtualScrollCtrl,loaderCtrl).then(function(){ctrl.onStateChanged=function(state){ctrl.allowInteraction(state)?($scope.interactive=!0,$scope.scrollApi.activate()):($scope.interactive=!1,$scope.scrollApi.deactivate())},ctrl.setInteraction=function(on){$scope.scrollApi[on?"activate":"deactivate"]()},ctrl.onPaint=function(){return this.$scope.selections.active?Deferred.resolve():update("processPaint",ctrl._paintWatches)},ctrl.onResize=function(){return $scope.scrollApi.updateViewport(),update("processResize",ctrl._resizeWatches)},ctrl.onInitialNativeScroll=function(qTop,qHeight){return rowLoaderCtrl.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return ctrl.update(qTop,qHeight,!0,!1,!0).then(function(){return rowLoaderCtrl.fadeOut()})})},objectCtrl.addChildController(ctrl)}),$scope.applyColumnOrderSoftPatch=function(add,columnOrder){var params=[[],!0],op=add?"add":"replace";params[0][0]={qPath:"/qHyperCubeDef/columnOrder",qOp:op.toString(),qValue:JSON.stringify(columnOrder)},$scope.backendApi.applyPatches(params)},selectionService.init($scope.selectionsApi,$scope.backendApi,$scope.selections,confirmSelections,cancelSelections,clearSelections);var origIgnoreOnOutside=$scope.selectionsApi.ignoreOnOutside;$scope.selectionsApi.ignoreOnOutside=function($target){return $target.closest(".qv-st-dim-columns").length?!0:origIgnoreOnOutside($target)||$target.closest(".qv-st-selections-active").length?!0:void 0},$scope.selectionsApi.getMenuMaxHeight=function(){return $element.outerHeight()},$scope.selectWhileLocked=function(){EventUtils.showLockedFeedback($scope.layout.qHyperCube.qDimensionInfo)},$scope.selectDimensionValue=function(cell,$event){$scope.scrollApi.updateViewport(),$scope.selectionsApi.getKeyAsToggleSelected($event)||(clearSelections(),selectionService.reset($scope.selections)),unbindKeyboard=selectionService.selectDimensionValue($scope.$id,$scope.backendApi,$scope.selectionsApi,$scope.selections,cell,$scope.grid,!0);var unwatch=$scope.selectionsApi.watchActivated(function(){selectionsActivated(),unwatch()})},$scope.activateSelections=function(cell){$scope.scrollApi.updateViewport(),unbindKeyboard=selectionService.activateSelections($scope.$id,$scope.backendApi,$scope.selectionsApi,$scope.selections,cell);var unwatch=$scope.selectionsApi.watchActivated(function(){selectionsActivated(),unwatch()})},$scope.multiselectDimensionValues=function(startCell,currentCell){function update(i){var cell=getCellWithRowIx(cells,i);cell&&cell.isDimensionValue&&selectionService.selectDimensionCells($scope.backendApi,$scope.selectionsApi,$scope.selections,$scope.grid,cell,!1)}var i,cells=dataService.getSiblingCells($scope.grid,startCell),startRowIx=startCell.dataRowIx,currentRowIx=currentCell.dataRowIx;if(currentRowIx>=startRowIx)for(i=startRowIx;currentRowIx>=i;++i)update(i);else if(startRowIx>currentRowIx)for(i=startRowIx;i>=currentRowIx;--i)update(i)},$scope.multiselect=function(){$scope.selections.active&&selectionService.sendSelection($scope.backendApi,$scope.selectionsApi,$scope.selections,$scope.grid,$scope.selections.currentCell)},$scope.sort=function(header){$scope.scrollApi.updateViewport();var info,ix,moveIx,dataColIx=header.dataColIx,sortOrder=[].concat($scope.layout.qHyperCube.qEffectiveInterColumnSortOrder),hiSortCol=sortOrder[0],path="",params=[[],!0];dataColIx!==hiSortCol&&(moveIx=sortOrder.indexOf(dataColIx),arrayUtils.move(sortOrder,moveIx,0)),params[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+sortOrder.join(",")+"]"},dataColIx===hiSortCol&&(path=header.isDimension?"/qHyperCubeDef/qDimensions/":"/qHyperCubeDef/qMeasures/",info=dataService.getColumnInfo(dataColIx,$scope.layout),header.reversed=!info.qReverseSort,ix=header.isDimension?dataColIx:dataColIx-$scope.layout.qHyperCube.qDimensionInfo.length,path+=ix+"/qDef/qReverseSort",params[0][1]={qPath:path,qOp:"replace",qValue:header.reversed.toString()}),$scope.backendApi.applyPatches(params)},$scope.currentHeaderSearch=null,$scope.search=function($alignTo,header){return $scope.currentHeaderSearch===header?(header.open=!1,$scope.currentHeaderSearch=null,void listboxPopoverService.close()):($scope.currentHeaderSearch&&($scope.currentHeaderSearch.open=!1,$scope.currentHeaderSearch=null),listboxPopoverService.showField(header.fieldName,$scope.backendApi.model.session.currentApp,{$alignToElement:$alignTo,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+$scope.$id,collision:"flipfit"},null,function(){$scope.currentHeaderSearch&&($scope.currentHeaderSearch.open=!1),$scope.currentHeaderSearch=null}),header.open=!0,void($scope.currentHeaderSearch=header))}}}}]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"S",columnOrder:[]}},data:{dimensions:{min:1,max:1e3,add:function(dimension,data,hcHandler){var columnOrder=hcHandler.hcProperties.columnOrder;return arrayUtils.indexAdded(columnOrder,hcHandler.getDimensions().length-1),dimension},remove:function(dimension,data,hcHandler,idx){var columnOrder=hcHandler.hcProperties.columnOrder;arrayUtils.indexRemoved(columnOrder,idx)}},measures:{add:function(measure,data,hcHandler){var columnOrder=hcHandler.hcProperties.columnOrder;arrayUtils.indexAdded(columnOrder,hcHandler.getDimensions().length+hcHandler.getMeasures().length-1)},remove:function(measure,data,hcHandler,idx){var columnOrder=hcHandler.hcProperties.columnOrder,columnIx=columnOrder.indexOf(idx);arrayUtils.indexRemoved(columnOrder,columnIx)},min:0,max:1e3}},snapshot:{canTakeSnapshot:!0},type:"table",template:"<qv-straight-table></qv-straight-table>",BackendApi:HypercubeApi,definition:propertiesDefinition,importProperties:function(exportedFmt,initialProperties,definition){var propertyTree=objectConversion.hypercube.importProperties(exportedFmt,initialProperties,definition),columnOrder=propertyTree.qProperty.qHyperCubeDef.columnOrder,dimensions=propertyTree.qProperty.qHyperCubeDef.qDimensions,measures=propertyTree.qProperty.qHyperCubeDef.qMeasures;return columnOrder.length&&dimensions.length+measures.length===columnOrder.length||(propertyTree.qProperty.qHyperCubeDef.columnOrder=qvangular.getService("qvGridObjectDataService").columnOrder.get(dimensions,measures)),propertyTree},exportProperties:objectConversion.hypercube.exportProperties
}}),define("extensions.qliktech/listbox/listbox-properties",["general.utils/property-resolver"],function(propertyResolver){var settings,dimension,sorting,sortEnumerationOptions=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return settings={uses:"settings",items:{}},dimension={type:"items",translation:"Common.Dimension",ref:"qListObjectDef",items:{label:{type:"string",ref:"qListObjectDef.qDef.qFieldLabels.0",translation:"Common.Label",show:!1},libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(data){return data.qListObjectDef&&data.qListObjectDef.qLibraryId}},field:{type:"string",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",change:function(data){var def=data.qListObjectDef.qDef;def.qFieldLabels||(def.qFieldLabels=[]),def.qFieldLabels[0]=def.qFieldDefs[0]},show:function(data){return data.qListObjectDef&&!data.qListObjectDef.qLibraryId}},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},sorting={type:"items",translation:"properties.sorting",grouped:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData,handler){return itemData.qListObjectDef.qDef.autoSort?handler.autoSortDimension(itemData.qListObjectDef):void 0}},expression:{type:"items",show:function(itemData){return itemData.qListObjectDef?!itemData.qListObjectDef.qDef.autoSort:!1},items:{expressionToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",ref:"qListObjectDef.qDef.qSortCriterias.0.qExpression",translation:"Common.Expression",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}}}},frequency:{type:"items",show:function(itemData){return itemData.qListObjectDef?!itemData.qListObjectDef.qDef.autoSort:!1},items:{frequencyToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",translation:"properties.sorting.sortByFrequency",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",0)}}}},numeric:{type:"items",show:function(itemData){return itemData.qListObjectDef?!itemData.qListObjectDef.qDef.autoSort:!1},items:{numericToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(itemData){return itemData.qListObjectDef?!itemData.qListObjectDef.qDef.autoSort:!1},items:{asciiToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",0)}}}}}},{type:"items",component:"accordion",items:{dimension:dimension,sorting:sorting,settings:settings}}}),define("text!extensions.qliktech/listbox/listbox.ng.html",[],function(){return'<div class="qv-listbox-container" ng-class="{ \'qv-listbox-interactive\': interactive }" tid="qv-listbox-container">\r\n	<div qv-listbox-search ng-show="options.search.show" class="qv-listbox-search">\r\n		<qui-search-field query="query" is-focused="focused" on-escape="onEscape($event);" auto-focus="autoFocus" />\r\n	</div>\r\n	<div class="qv-listbox-wrapper" ng-class="{ \'searchActive\': options.search.show }">\r\n		<qv-scroll-area class="qv-listbox-scroll-area qv-animate" ng-class="{ \'qv-listbox-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled }">\r\n			<ul class="qv-listbox" ng-class="{ \'align-bottom\': scrollApi.alignBottomAbsolute }"\r\n				qv-selections-select-while-locked="selectWhileLocked()"\r\n				qv-selections-toggle-dimension-value="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-on-toggle-dimension-value="interactive && select($event, item)"\r\n				qv-selections-multiselect="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-start-multiselect="interactive && multiselectStart($event)"\r\n				qv-selections-update-multiselect="interactive && multiselectUpdate(start, current)"\r\n				qv-selections-end-multiselect="interactive && multiselectEnd($event)">\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="interactive && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n				</qv-scroll-load-button>\r\n				<li ng-repeat="item in items" ng-class="item.classNames" tid="listbox.item">\r\n					<div class="qv-listbox-tick"><i class="icon-tick"></i></div>\r\n					<div class="qv-listbox-text" ng-class="{ \'qv-listbox-numeric\' : item.isNumeric }">\r\n						<span ng-attr-title="{{item.text}}">\r\n							<span ng-repeat="textItem in item.textItems" ng-class="{ highlighted: textItem.isHighlighted }">{{textItem.text}}</span>\r\n						</span>\r\n					</div>\r\n				</li>\r\n				<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="interactive && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n			</ul>\r\n		</qv-scroll-area>\r\n		<qv-scroll-loader></qv-scroll-loader>\r\n	</div>\r\n</div>\r\n'}),define("text!client.services/export-dialog/export-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="export-dialog">\r\n	<div ng-if="state === states.PENDING">\r\n		<header class="dm-header" q-translation="Export.Exporting"></header>\r\n		<main class="dm-main">\r\n			<div class="qv-loader dm-p"></div>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="cancel()" q-translation="Common.Cancel"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.COMPLETED">\r\n		<header class="dm-header" q-translation="Export.Completed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p">\r\n				<span q-translation="Export.CompletedDescription"></span>\r\n				<span q-translation="Export.WarningDataTruncated" ng-if="dataIsTruncated"></span>\r\n			</p>\r\n			<p class="dm-p">\r\n				<a ng-href="{{exportUrl}}" target="_blank" q-translation="Export.CompletedLink"></a>\r\n			</p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.FAILED">\r\n		<header class="dm-header" q-translation="Export.Failed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p" q-translation="{{errorTranslation}}"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n</qv-modal-dialog>'}),define("client.services/export-dialog/export-dialog",["qvangular","text!./export-dialog.ng.html","general.services/show-service/show-service"],function(qvangular,template,ShowService){var component={template:template,scope:{model:"=",hypercubePath:"="},controller:["$scope",function($scope){$scope.states={FAILED:-1,IDLE:0,PENDING:1,COMPLETED:2},$scope.state=$scope.states.PENDING,$scope.model.getLayout().then(function(layout){var req=$scope.model.exportData(null,$scope.hypercubePath,layout.title||null);$scope.rpcId=req.rpcId,req.then(function(data){$scope.exportUrl=".."+data.result.qUrl,$scope.state=$scope.states.COMPLETED,data.warnings&&1e3===data.warnings[0]&&($scope.dataIsTruncated=!0)},function(err){$scope.state=$scope.states.FAILED,$scope.errorTranslation="ErrorCode."+err.error.code,err.isHandled=!0})}),$scope.openExportWindow=function(){window.open($scope.exportUrl)},$scope.cancel=function(){$scope.rpcId?$scope.model.cancelRequest($scope.rpcId)["finally"]($scope.close):$scope.close()},$scope.close=function(){$scope.destroyComponent()}}]};qvangular.service("$exportDialog",[function(){return{show:function(model,hypercubePath){var input={model:model,hypercubePath:hypercubePath};return ShowService.show(component,input)}}}])}),define("extensions.qliktech/listbox/listbox-search",["qvangular","util","general.utils/support"],function(qvangular,util,Support){"use strict";var hiddenInput=document.createElement("input");hiddenInput.type="text",qvangular.directive("qvListboxSearch",["$document","$timeout",function($document,$timeout){return{link:function($scope,$element){function watchKeyChars(){return $document.on("keypress.watchKeyChars"+$scope.$id,function(e){27!==e.keyCode&&13!==e.keyCode&&(hiddenInput.value=String.fromCharCode(e.which),hiddenInput.value.length&&$scope.$apply(function(){$scope.options.search.toggle(!0,hiddenInput.value)}))}),function(){$document.off(".watchKeyChars"+$scope.$id)}}function watchSearch(){function watchQuery(){return $scope.$watch("query",function(newValue,oldValue){void 0!==newValue&&newValue!==oldValue&&$scope.backendApi.search(newValue)})}function resetWatchQuery(){unWatchQuery&&unWatchQuery(),$scope.query="",unWatchQuery=watchQuery()}function isNumericOperation(query){var terms=query.split(" ");return terms.some(function(term){var firstChar=term.trim()[0];return"<"===firstChar||">"===firstChar})}var unWatchQuery,unWatchFocused;return resetWatchQuery(),unWatchFocused=$scope.$watch("focused",function(newValue){void 0!==newValue&&$scope.selectionsApi.toggleKeyboardAccelerators(!newValue)}),$document.on("keydown.listboxSearch"+$scope.$id,function(e){$scope.focused===!0&&$timeout(function(){switch(e.which){case 13:var toggle,size=$scope.backendApi.getSize();$scope.backendApi.isLocked()?$scope.backendApi.abortSearch():size.qcy>0&&(toggle=$scope.selectionsApi.getKeyAsToggleSelected(e),toggle=isNumericOperation($scope.query)?!toggle:toggle,$scope.backendApi.confirmSearch(toggle),$scope.selectionsApi.selectionsMade=!0,resetWatchQuery());break;case 27:$scope.backendApi.abortSearch(),resetWatchQuery()}})}),function(){unWatchQuery(),unWatchFocused(),$document.off(".listboxSearch"+$scope.$id)}}var unWatch,unWatchKeyChars;$scope.autoFocus=!1,$scope.selectionsApi.deactivateSearch=function(){unWatch&&unWatch(),unWatchKeyChars&&unWatchKeyChars(),qvangular.$apply($scope,function(){$scope.options.search&&$scope.options.search.toggle(!1)})},$scope.onEscape=function(event){$scope.query&&$scope.query.length?$scope.query="":($scope.backendApi.abortSearch(),$scope.selectionsApi.cancel()),event.preventDefault()},$scope.options.search=util.extend(!0,{show:$scope.options.isPopover,toggle:function(show,str){$scope.options.search.show=void 0!==show?show:!$scope.options.search.show,$scope.options.search.show?($scope.query=str,unWatch=watchSearch()):(unWatch&&unWatch(),$scope.backendApi.abortSearch(),$scope.query="")}},$scope.options.search),$scope.options.showSearch=!0,$scope.$watch("options.search.show",function(show){$scope.autoFocus=show&&Support.treatAsDesktop(),show||$element.find("input").blur()}),$scope.$watch("selectionsApi.active && !focused",function(startSearch){startSearch?unWatchKeyChars=watchKeyChars():void 0!==startSearch&&unWatchKeyChars&&unWatchKeyChars()}),$scope.$on("$destroy",function(){$document.off(".listboxSearch"+$scope.$id),$document.off(".watchKeyChars"+$scope.$id),delete $scope.options.search}),$scope.options.isPopover&&$scope.options.search.toggle(!0,$scope.options.search.defaultStr)}}}])}),define("extensions.qliktech/listbox/listbox",["qvangular","objects.backend-api/listbox-api","extensions.qliktech/listbox/listbox-properties","general.utils/property-mapper","text!./listbox.ng.html","objects.utils/data-properties/listobject-handler","objects.extension/object-conversion","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.extension/base-controller","general.utils/support","objects.extension/default-selection-toolbar","objects.utils/event-utils","client.services/export-dialog/export-dialog","general.scroll/scroll-area","objects.grid/directives/selections","./listbox-search"],function(qvangular,ListboxApi,propertiesDefinition,propertyMapper,template,ListObjectHandler,objectConversion,ScrollApi,ScrollDOMApi,ScrollDataApi,BaseCtrl,support,DefaultSelectionToolbar,EventUtils){"use strict";function bindKeyboard($document,$scope,$id){var namespace=".selections-keyboard-"+$id;return $document.on("keyup"+namespace,function(e){$scope.focused||(27===e.which?$scope.selectionsApi.cancel():13===e.which&&$scope.selectionsApi.confirm())}),function(){$document.off(namespace)}}var ListboxCtrl,VisualizationScrollDataApi;return VisualizationScrollDataApi=ScrollDataApi.extend({init:function(visualizationCtrl){this.visualizationCtrl=visualizationCtrl},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(rowIndex,height){return this.visualizationCtrl.onVirtualScroll(rowIndex,height)},onInitialNativeScroll:function(rowIndex,height){return this.visualizationCtrl.onInitialNativeScroll(rowIndex,height)},onGotoNextBlock:function(rowIndex,height){return this.visualizationCtrl.onGotoNextBlock(rowIndex,height)},onGotoPreviousBlock:function(rowIndex,height){return this.visualizationCtrl.onGotoPreviousBlock(rowIndex,height)}}),ListboxCtrl=BaseCtrl.extend({init:function($scope,$document,$timeout){function update(item){item.selected||$scope.selectedValues.push(item.dataValue),item.selected=!0,item.classNames="selected serverSelected "}this._super.apply(this,arguments),this.$timeout=$timeout;var unbindKeyboard;$scope.selectionsApi.watchDeactivated(function(){$scope.$emit("childSelectionActive",!1),$scope.options.search.show=!1,unbindKeyboard&&unbindKeyboard()}),$scope.selectionsApi.watchActivated(function(){$scope.$emit("childSelectionActive",!0),unbindKeyboard&&unbindKeyboard(),unbindKeyboard=bindKeyboard($document,$scope,$scope.$id)}),$scope.selectionsApi.clear=function(){$scope.selectedValues=[],this.selectionsMade=!0,$scope.backendApi.clearSelections()},$scope.selectedValues=[],$scope.activateSelections=function(){$scope.selectionsApi.active||($scope.selectedValues=[]),$scope.selectionsApi.activate()},$scope.selectValues=function(values,toggle){$scope.selectionsApi.selectionsMade=!0,$scope.backendApi.select(0,values,toggle).then(function(res){res.qSuccess||$scope.selectionsApi.clear()})},$scope.select=function($event,selectedItem){var toggle=$scope.selectionsApi.getKeyAsToggleSelected($event);$scope.activateSelections(),toggle||$scope.items.forEach(function(item){item!==selectedItem&&(item.selected=!1,item.classNames="serverOptional")}),selectedItem.selected=!selectedItem.selected,selectedItem.classNames=selectedItem.selected?"selected serverSelected":"serverOptional",$scope.selectValues([selectedItem.dataValue],toggle)},$scope.multiselectStart=function($event){$scope.activateSelections(),$scope.selectionsApi.getKeyAsToggleSelected($event)||$scope.items.forEach(function(item){item.selected=!1,item.classNames="serverOptional"})},$scope.multiselectUpdate=function(startItem,currentItem){var i,item,startRowIx,currentRowIx;if(-1!==$scope.items.indexOf(currentItem))if(startRowIx=$scope.items.indexOf(startItem),currentRowIx=$scope.items.indexOf(currentItem),currentRowIx>=startRowIx)for(i=startRowIx;currentRowIx>=i;++i)item=$scope.items[i],update(item);else if(startRowIx>currentRowIx)for(i=startRowIx;i>=currentRowIx;--i)item=$scope.items[i],update(item)},$scope.multiselectEnd=function($event){$scope.selectValues($scope.selectedValues,$scope.selectionsApi.getKeyAsToggleSelected($event))},$scope.selectWhileLocked=function(){EventUtils.showLockedFeedback([$scope.layout.qListObject.qDimensionInfo])},$scope.$on("$destroy",function(){unbindKeyboard&&unbindKeyboard()}),Object.defineProperties($scope,{isDesktop:{get:function(){return support.treatAsDesktop()}}})},update:function(qTop,qHeight,update,reversed){var dataInfo=this.getDataInfo(qTop,qHeight);return this.$scope.backendApi.getData(dataInfo.rects).then(function(dataPages){return this.onUpdateData(dataPages,update,reversed)}.bind(this))},getDataInfo:function(qTop,qHeight){return qTop=qTop||0,{rects:[{qTop:qTop,qLeft:0,qWidth:1,qHeight:qHeight}]}},stateMap:{S:"Selected",A:"Alternative",O:"Optional",XS:"SelectedExcluded",L:"Locked",X:"Excluded",XL:"ExcludedLock"},getState:function(state){return this.stateMap[state]},isSelected:function(state){return"Selected"===this.getState(state)},updateTextItem:function(item,dataCell){var i,range,ranges,nextPos,rangeCount=dataCell.qHighlightRanges&&dataCell.qHighlightRanges.qRanges.length||0,strArray=dataCell.qText&&dataCell.qText.split("")||[],currentPos=0;if(item.textItems=[],strArray.length||item.textItems.push({isHighlighted:!1,text:""}),!rangeCount)return void item.textItems.push({isHighlighted:!1,text:dataCell.qText});for(ranges=dataCell.qHighlightRanges.qRanges.sort(function(a,b){return a.qCharPos-b.qCharPos}),i=0;rangeCount>i;++i)range=ranges[i],nextPos=range.qCharPos,nextPos!==currentPos&&item.textItems.push({isHighlighted:!1,text:strArray.splice(0,nextPos-currentPos).join("")}),item.textItems.push({isHighlighted:!0,text:strArray.splice(0,range.qCharCount).join("")}),currentPos=range.qCharPos+range.qCharCount;strArray.length&&item.textItems.push({isHighlighted:!1,text:strArray.splice(0,strArray.length).join("")})},updateItems:function(dataPages,update,reversed){var i,rowCnt,cellData,item,serverState,isLocked,rowOffsetIx=0,qTop=dataPages[0].qArea.qTop,qHeight=dataPages[0].qArea.qHeight,items=this.$scope.items,dataMatrix=dataPages[0].qMatrix;for(reversed&&dataMatrix.reverse(),update&&(rowOffsetIx=items.length),isLocked=this.$scope.backendApi.isLocked(),i=0,rowCnt=dataMatrix.length;rowCnt>i;++i)items[rowOffsetIx+i]||(items[rowOffsetIx+i]={}),item=items[rowOffsetIx+i],cellData=dataMatrix[i][0],serverState=this.getState(cellData.qState),item.locked=isLocked,item.dataValue=cellData.qElemNumber,item.dataColIx=0,item.dataRowIx=reversed?qTop+qHeight-i-1:qTop+i,item.isNumeric="NaN"!==cellData.qNum,item.selected=this.isSelected(cellData.qState),item.classNames=item.selected?"selected server"+serverState:"server"+serverState,item.isDimensionValue=!0,item.text=cellData.qText,this.updateTextItem(item,cellData);update||items.splice(i),reversed&&items.reverse()},onUpdateData:function(dataPages,update,reversed){return this.updateItems(dataPages,update,reversed),this.$scope.selectedValues=[],this.$timeout(function(){},0,!1)},process:function(qTop,qHeight,keepScrollPos){return this.update(qTop,qHeight,!1,!1).then(function(){return this.$scope.scrollApi.setTotalRows(this.$scope.layout.qListObject.qSize.qcy),this.$scope.scrollApi.setVirtualSize(keepScrollPos)}.bind(this))},processPaint:function(){var qHeight,bindOneNativeScrollFn,qTop=0;return qHeight=this.$scope.scrollApi.settings.viewportRowCount,bindOneNativeScrollFn=this.$scope.scrollApi.resetNativeScroll(),this.process(qTop,qHeight,!1).then(function(){bindOneNativeScrollFn()})},processResize:function(){var rowCnt=this.$scope.items.length,qTop=rowCnt?this.$scope.items[0].dataRowIx:0,qHeight=this.$scope.scrollApi.settings.viewportRowCount;return rowCnt>qHeight&&(qHeight=rowCnt),this.process(qTop,qHeight,!0)},onVirtualScroll:function(qTop,qHeight){var promise=this.update(qTop,qHeight,!1,!1);return this.$scope.$digest(),promise},gotoBlock:function(qTop,qHeight,reversed){var args=this.$scope.scrollApi.getSpliceArgs(),items=this.$scope.items;return reversed&&items.reverse(),items.splice.apply(items,args),this.update(qTop,qHeight,!0,reversed)},onGotoNextBlock:function(qTop,qHeight){return this.gotoBlock(qTop,qHeight,!1)},onGotoPreviousBlock:function(qTop,qHeight){return this.gotoBlock(qTop,qHeight,!0)},getRows:function(){return this.$scope.items},getRowCount:function(){return this.$scope.items.length},getFirstElementIndex:function(){return this.$scope.items[0].dataRowIx},getLastElementIndex:function(){return this.$scope.items[this.$scope.items.length-1].dataRowIx},getSelectionToolbar:function(){return new DefaultSelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[{name:"Selections.All",tid:"selection-toolbar-menu.selectAll",iconClass:"icon-selection-toolbar-selectAll",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAll()},isDisabled:function(){return!this.hasState(["qOption","qAlternative","qExcluded","qDeselected"])}},{name:"Selections.Possible",tid:"selection-toolbar-menu.selectPossible",iconClass:"icon-selection-toolbar-selectPossible",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectPossible()},isDisabled:function(){return!this.hasState(["qOption"])}},{name:"Selections.Alternative",tid:"selection-toolbar-menu.selectAlternative",iconClass:"icon-selection-toolbar-selectAlternative",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAlternative()},isDisabled:function(){return!this.hasState(["qAlternative"])}},{name:"Selections.Excluded",tid:"selection-toolbar-menu.selectExcluded",iconClass:"icon-selection-toolbar-selectExcluded",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectExcluded()},isDisabled:function(){return!this.hasState(["qExcluded","qAlternative"])}},{name:"contextMenu.export",tid:"selection-toolbar-menu.exportData",iconClass:"icon-toolbar-sharelist",buttonClass:"",action:function(){qvangular.getService("$exportDialog").show(this.backendApi.model)},isDisabled:function(){return!1}}])}}),ListboxCtrl.$inject=["$scope","$document","$timeout"],qvangular.directive("qvListbox",["$timeout",function($timeout){return{restrict:"E",replace:!0,template:template,require:["qvListbox","^qvObject"],controller:ListboxCtrl,link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1],$scrollArea=$element.find(".qv-listbox-scroll-area"),virtualScrollCtrl=$scrollArea.controller("qvScrollArea"),loaderCtrl=$element.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),rowLoaderCtrl=$scrollArea.find(".qv-scroll-row-loader").controller("qvScrollLoader"),namespace="."+$scope.id+"-listbox",settings={blockSize:200,minRowHeight:30,maxRowHeight:30},scrollApi=$scope.scrollApi=new ScrollApi($timeout,settings),scrollDataApi=new VisualizationScrollDataApi(ctrl),scrollDOMApi=new ScrollDOMApi($element,$scrollArea,"li:not(.qv-listbox-load-buttons)","li:not(.qv-listbox-load-buttons):first","li:not(.qv-listbox-load-buttons):not(.qv-scroll-row-loader):last");$scope.items=[],$scope.$on("$destroy",function(){scrollApi.destroy(),$element.off(namespace)}),$element.on("contextmenu"+namespace,function(event){$scope.object.selectionsApi.active&&event.preventDefault()}),scrollApi.initialize(scrollDOMApi,scrollDataApi,virtualScrollCtrl,loaderCtrl).then(function(){$scope.options.isPopover&&$scope.activateSelections(),$scope.$watch("options.search.show",function(){$scope.options.isPopover||$scope.scrollApi.setVirtualSize(!0)}),$scope.$watch("options.interactionEnabled",function(on){void 0!==on&&$scope.scrollApi[on?"activate":"deactivate"]()}),ctrl.onStateChanged=function(state){ctrl.allowInteraction(state)?($scope.interactive=!0,$scope.scrollApi.activate()):($scope.interactive=!1,$scope.scrollApi.deactivate())},ctrl.onPaint=function(){var isSameRowCount=$scope.scrollApi.totalRows===this.$scope.layout.qListObject.qSize.qcy;return $scope.selectionsApi.active&&isSameRowCount?ctrl.processResize():ctrl.processPaint()},ctrl.onResize=function(){return $scope.scrollApi.updateViewport(),ctrl.processResize()},ctrl.onInitialNativeScroll=function(qTop,qHeight){return rowLoaderCtrl.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return ctrl.update(qTop,qHeight,!0,!1).then(function(){return rowLoaderCtrl.fadeOut()})})},objectCtrl.addChildController(ctrl)})}}}]),{type:"listbox",template:"<qv-listbox></qv-listbox>",initialProperties:{qListObjectDef:{qShowAlternatives:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:0,qHeight:0}],qDef:{qSortCriterias:[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}]}}},data:{dimensions:{min:1,max:1}},mapProperties:function(){this.mappedDefinition=propertyMapper.mapDefinition(this.definition,this.type),this.dimensionDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qListObjectDef",!0)},getCreatePropertyHandler:function(){return new ListObjectHandler(this.dimensionDefinition)},showRequirements:function(){return!1},hasError:function(args){var layout=args.layout;return!layout.qListObject||!layout.qListObject.qDimensionInfo||!!layout.qListObject.qDimensionInfo.qError},BackendApi:ListboxApi,definition:propertiesDefinition,options:{search:{},selections:{}},getDropFieldOptions:function(builder,propertyHandler,model,showMenu){builder.Add(model,propertyHandler),builder.ReplaceDimensions(model,propertyHandler),showMenu()},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu){showMenu()},importProperties:objectConversion.listbox.importProperties,exportProperties:objectConversion.listbox.exportProperties}}),define("objects.backend-api/field-api",["./backend-api"],function(BackendApi){"use strict";var FieldApi;return FieldApi=BackendApi.extend("FieldApi",{init:function(model){this._super(model,"/dimensions"),this.cacheCube.setMethodName("GetListObjectData")},updateCache:function(){},getProperties:function(){return this.model.getProperties()},getData:function(pages){return this.cacheCube.getData(pages)},getSize:function(){return this.model.layout.qListObject.qSize},isLocked:function(){return this.model.layout.qListObject.qDimensionInfo.qLocked}})}),define("extensions.qliktech/filterpane/filterpane-properties",["client.property-panel/default-sorting-properties","util"],function(defaultSortingProperties,util){var settings,data,sorting,autoSortCriterias;return autoSortCriterias={qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1},settings={uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}}}},data={type:"array",component:"filterpane-data",translation:"Common.Data",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,ref:"qChildListDef",items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(itemData){return itemData.qListObjectDef.qLibraryId}},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",show:function(itemData){return!itemData.qListObjectDef.qLibraryId},change:function(data){var def=data.qListObjectDef.qDef;def.qFieldLabels||(def.qFieldLabels=[]),def.qFieldLabels[0]=def.qFieldDefs[0]}},title:{ref:"title",type:"string",expression:"optional",translation:"Common.Title"},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},sorting={type:"items",component:"filterpane-sorting",translation:"properties.sorting",allowMove:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData){if(itemData.qListObjectDef.qDef.autoSort)for(var dimension=itemData.qListObjectDef,i=0;i<dimension.qDef.qSortCriterias.length;i++)dimension.qDef.qSortCriterias[i]=autoSortCriterias}},dimension:{component:"sorting-dimension",type:"items",ref:"qListObjectDef",show:function(itemData){return!itemData.qListObjectDef.qDef.autoSort},items:util.extend(!0,{},defaultSortingProperties.items.dimensions.items.dimension.items,{dimensionDefinition:{items:{frequency:{show:!0}}}})}}},{type:"items",component:"accordion",items:{data:data,sorting:sorting,settings:settings}}}),define("extensions.qliktech/filterpane/filterpane-handler",["objects.utils/data-properties/data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util","general.utils/visualizations"],function(DataPropertyHandler,listObjectUtil,libraryUtils,util,Visualizations){"use strict";var TOTAL_MAX_DIMENSIONS=1e3,FilterpaneHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,dimensionListLayout,model){this._super(dimensionDefinition,null,dimensionListLayout,null),this.model=model,this.dimensionLayout=[],this.dimensions=[]},autoSortDimension:function(dimension){return dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libDim){return libDim&&listObjectUtil.autoSortDimension(dimension,libDim.qData.info),dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){return field&&listObjectUtil.autoSortDimension(dimension,[field]),dimension})},getDimensions:function(){return this.dimensions||[]},minDimensions:function(){return 1},maxDimensions:function(){return 1e3},setModel:function(model){this.model=model},addDimension:function(dimension){var listbox,listboxPropsDfd,self=this;return dimension.qDef.cId=util.generateId(),dimension.qShowAlternatives=!0,this.getDimensions().length<TOTAL_MAX_DIMENSIONS?(listbox=Visualizations.getType("listbox"),listboxPropsDfd=listbox.getInitialProperties({}),listboxPropsDfd.then(function(listboxProps){return self.autoSortDimension(dimension).then(function(){return listboxProps.qListObjectDef=dimension,dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libraryDim){return listboxProps.title=libraryDim.qData.title,self.model.createChild(listboxProps,self.properties).then(function(){return listboxProps.qListObjectDef})}):(listboxProps.title=dimension.qDef.title||dimension.qDef.qFieldLabels[0]||dimension.qDef.qFieldDefs[0],self.model.createChild(listboxProps,self.properties).then(function(){return listboxProps.qListObjectDef}))})})):void 0},removeDimension:function(index){var dimension=this.layout.qChildList.qItems[index];return this.model.removeChild(dimension.qInfo.qId,this.properties).then(function(){return dimension})},getDimensionLayouts:function(){return this.dimensionLayout||[]},getDimensionLayout:function(index){var dimensionLayouts=this.getDimensionLayouts();return dimensionLayouts[index]?dimensionLayouts[index].qListObject.qDimensionInfo:"";
}});return FilterpaneHandler}),define("text!extensions.qliktech/filterpane/filterpane.ng.html",[],function(){return'<qv-filterpane class="qv-filterpane" qv-collapsed-listbox-delegated-open outside-ignore-name="outsideIgnoreName">\r\n	<div ng-repeat="column in columns" class="qv-filterpane-column">\r\n		<div ng-repeat="item in column.items"\r\n			 ng-class="{\'qv-filterpane-collapsed\': !item.expand, \'qv-filterpane-expanded\': item.expand}"\r\n			 ng-style="{height: item.height}"\r\n			 tid="qv-object-filterpane.dimension">\r\n			<qv-object ng-if="item.expand" model="item.model" options="item.options" object="item.object"></qv-object>\r\n			<qv-collapsed-listbox ng-if="!item.expand" model="item.model" outside-ignore-name="outsideIgnoreName" responsive-mode="item.responsiveMode"></qv-collapsed-listbox>\r\n		</div>\r\n\r\n		<div ng-if="column.showAll && object.expanded" class="qv-filterpane-collapsed qv-filterpane-showall">\r\n			<div class="presentation" q-title-translation="Tooltip.Filterpane.NotAllItemsShow"></div>\r\n		</div>\r\n		<div ng-if="column.showAll && !object.expanded" class="qv-filterpane-collapsed qv-filterpane-fullscreen">\r\n			<button class="add-button qui-outlinebutton"\r\n					ng-class="{ \'qui-disabled\': state.state }"\r\n					qva-activate="triggerFullScreen()"\r\n					q-title-translation="Tooltip.Filterpane.ClickForFullScreen"></button>\r\n		</div>\r\n	</div>\r\n</qv-filterpane>\r\n'}),define("extensions.qliktech/filterpane/filterpane-layout",["qvangular","general.utils/responsive-state","general.utils/property-resolver"],function(qvangular,ResponsiveState,PropertyResolver){"use strict";var COLLAPSED_HEIGHT=34,BUTTON_HEIGHT=28,ITEM_SPACING=10,EXPANDED_HEIGHT=89,COLUMN_MIN_WIDTH=160,COLUMN_SPACING=20,EXPANDED_HEADER_HEIGHT=27,EXPANDED_ROW_HEIGHT=30;qvangular.service("qvFilterpaneLayout",function(){return{getMaxColumns:function(size){return ResponsiveState.isSmallDevice?1:Math.floor((size.width+COLUMN_SPACING)/(COLUMN_MIN_WIDTH+COLUMN_SPACING))||1},getMaxItemsPerColumn:function(size){return Math.max(1,Math.floor((size.height+ITEM_SPACING)/(COLLAPSED_HEIGHT+ITEM_SPACING)))},getDimensionCount:function(layout){return layout.qChildList.qItems.length},getColumnItemsCount:function(columns){var count=0;return columns.forEach(function(column){count+=column.itemCount}),count},getHeightOf:function(collapsedItemCount){var height=(COLLAPSED_HEIGHT+ITEM_SPACING)*collapsedItemCount-ITEM_SPACING;return Math.max(height,0)},getDimensionCardinal:function(item){var stateCounts=PropertyResolver.getValue(item,"model.layout.qListObject.qDimensionInfo.qStateCounts",void 0);if(stateCounts)return Object.keys(stateCounts).reduce(function(count,key){return count+stateCounts[key]},0)},getHeightOfExpanded:function(dimensionCardinal){var height=dimensionCardinal*EXPANDED_ROW_HEIGHT+EXPANDED_HEADER_HEIGHT+3;return height},doesAllFit:function(itemsPerColumn,columnCount,itemCount){return itemsPerColumn*columnCount>=itemCount},haveRoomToExpandOne:function(size,column){var spacing=column.itemCount>1?ITEM_SPACING:0;return ResponsiveState.isSmallDevice?!1:size.height>this.getHeightOf(column.itemCount-1)+EXPANDED_HEIGHT+spacing},getSize:function($element,layout){return{width:$element.innerWidth()-1,height:$element.innerHeight(),dimensionCount:this.getDimensionCount(layout)}},sizeChanged:function(oldSize,newSize){return!angular.equals(oldSize,newSize)},calculateColumns:function(size,columns,zoomEnabled){var canExpand=!ResponsiveState.isSmallDevice&&size.height>EXPANDED_HEIGHT,maxColumns=this.getMaxColumns(size),maxPerColumn=this.getMaxItemsPerColumn(size),usedCount=this.getColumnItemsCount(columns);if(canExpand&&this.doesAllFit(maxPerColumn,maxColumns-columns.length-1,size.dimensionCount-usedCount-1))columns.push({expand:!0,itemCount:1}),usedCount+1<size.dimensionCount&&this.calculateColumns(size,columns,zoomEnabled);else{var itemCount;itemCount=Math.min(size.dimensionCount-usedCount,maxPerColumn),ResponsiveState.isSmallDevice?itemCount=size.dimensionCount-usedCount:zoomEnabled||(itemCount=Math.ceil((size.dimensionCount-usedCount)/(maxColumns-columns.length)),itemCount=Math.max(maxPerColumn,itemCount),itemCount=Math.min(size.dimensionCount-usedCount,itemCount)),columns.push({expand:!1,itemCount:itemCount}),columns.length>=maxColumns&&maxPerColumn>0&&this.getColumnItemsCount(columns)<size.dimensionCount&&(columns[columns.length-1].showAll=!0,BUTTON_HEIGHT+ITEM_SPACING>size.height-this.getHeightOf(maxPerColumn)&&(columns[columns.length-1].itemCount=Math.max(columns[columns.length-1].itemCount-1,0))),this.getColumnItemsCount(columns)<size.dimensionCount&&columns.length<maxColumns&&this.calculateColumns(size,columns,zoomEnabled)}},balanceColumns:function(size,columns){var expanded,collapsed,collapsedItems;return expanded=columns.filter(function(column){return column.expand}),collapsed=columns.filter(function(column){return column.expand===!1}),collapsed.length>0&&!collapsed[collapsed.length-1].showAll&&this.haveRoomToExpandOne(size,collapsed[collapsed.length-1])?collapsed[collapsed.length-1].expandLast=!0:(collapsedItems=this.getColumnItemsCount(collapsed),collapsed.forEach(function(column,index){var extraItems,itemCount;extraItems=index<collapsedItems%collapsed.length?1:0,itemCount=Math.floor(collapsedItems/collapsed.length)+extraItems,column.itemCount=itemCount},this)),collapsed.concat(expanded)},getDimensions:function(layout){return layout.qChildList.qItems.map(function(dimension){return{id:dimension.qInfo.qId,expand:!1,height:void 0,responsiveMode:"full"}})},sortDimensions:function(layout,dimensions){var childIds;return childIds=layout.qChildList.qItems.map(function(item){return item.qInfo.qId}),childIds.map(function(childId){return dimensions.filter(function(dimension){return dimension.id===childId})[0]})},isValid:function(layout){return!!layout&&!!layout.qChildList&&!!layout.qChildList.qItems&&this.getDimensionCount(layout)>0},mergeColumnsAndDimensions:function(columns,dimensions){return columns.forEach(function(column){column.items=dimensions.slice(0,column.itemCount),dimensions=dimensions.slice(column.itemCount)},this),columns},reSizeArray:function(theArray,length,util,insert){for(;theArray.length>length;)theArray.pop();for(;theArray.length<length;)theArray.push(util.extend(!0,{},insert))},dimensionsEqual:function(dim1,dim2){return dim1.id===dim2.id&&dim1.expand===dim2.expand&&dim1.height===dim2.height},shouldDimensionBeUpdated:function(scopeDimension,referenceDimension){return!this.dimensionsEqual(scopeDimension,referenceDimension)},patchScope:function($scope,columns,util){this.resizeScopeArrays($scope,columns,util),$scope.columns.forEach(function(scopeColumn,colIx,scopeColumns){var refColumn=columns[colIx];scopeColumns[colIx].showAll=refColumn.showAll,scopeColumns[colIx].expand=refColumn.expand,scopeColumns[colIx].expandLast=refColumn.expandLast,scopeColumns[colIx].itemCount=refColumn.itemCount,scopeColumn.items.forEach(function(scopeDimension,dimIx){this.shouldDimensionBeUpdated(scopeDimension,refColumn.items[dimIx])&&(delete scopeDimension.$$hashKey,delete scopeDimension.model,scopeDimension.expand||delete scopeDimension.options,scopeDimension.expand&&!scopeDimension.options&&(scopeDimension.options={isPopover:!1,isReadonly:$scope.object.isReadonly}),this.copyDimensionValues(refColumn.items[dimIx],scopeDimension))},this)},this)},calculateExpandPriority:function(scopeColumns,size){scopeColumns.forEach(function(column){if(column.expandLast){for(var expandedCount=0,expandOne=function(h){for(var itemCount,itemSize,i=column.items.length-1;i>=0;i--)if(itemCount=this.getDimensionCardinal(column.items[i]),itemCount&&5>itemCount&&(itemSize=this.getHeightOfExpanded(itemCount),h>itemSize&&!column.items[i].expand))return column.items[i].expand=!0,column.items[i].height=itemSize+"px",expandedCount++,itemSize;return!1},leftOverHeight=size.height-this.getHeightOf(column.itemCount-1)-ITEM_SPACING,totalExpandedHeight=0;leftOverHeight>EXPANDED_HEIGHT;){var expHeight=expandOne.call(this,leftOverHeight);if(!expHeight)break;totalExpandedHeight+=expHeight,leftOverHeight=size.height-this.getHeightOf(column.itemCount-expandedCount)-ITEM_SPACING-totalExpandedHeight}if(!expandedCount||leftOverHeight>EXPANDED_HEIGHT){var lastItem=column.items[column.items.length-1];lastItem.expand||(lastItem.height=size.height-this.getHeightOf(column.itemCount-expandedCount-1)-totalExpandedHeight-ITEM_SPACING+"px",lastItem.expand=!0)}}column.expand&&(column.items[0].expand=!0),1===column.items.length&&size.height<COLLAPSED_HEIGHT-4&&(column.items[0].responsiveMode=size.height<.5*COLLAPSED_HEIGHT?"spark":"small",column.items[0].height=size.height+"px")},this)},resolveAllModels:function($scope,columns,expandFunction,Deferred){var promises=[];return columns.forEach(function(column,colIx){var scopeColumn=$scope.columns[colIx]||{items:[]};column.items.forEach(function(dimension,itemIx){var scopeDimension=scopeColumn.items[itemIx]||{};(this.shouldDimensionBeUpdated(dimension,scopeDimension)||!scopeDimension.model)&&promises.push(expandFunction(dimension))},this)},this),Deferred.all(promises)},resizeScopeArrays:function($scope,columns,util){$scope.columns.length!==columns.length&&this.reSizeArray($scope.columns,columns.length,util,{items:[]}),$scope.columns.forEach(function(scopeColumn,colIndex){scopeColumn.items.length!==columns[colIndex].items.length&&this.reSizeArray($scope.columns[colIndex].items,columns[colIndex].items.length,util,{})},this)},copyDimensionValues:function(prototype,target){Object.keys(prototype).forEach(function(key){target[key]=prototype[key]})},getResolveModelFunction:function(ListboxModel,Deferred,app){return function(dimension){return this.resolveModel(ListboxModel,dimension,Deferred,app)}.bind(this)},resolveModel:function(ListboxModel,dimension,Deferred,app){var modelPromise=ListboxModel.get(dimension.id,app),def=new Deferred;return modelPromise.then(function(model){return dimension.model=model,model.getLayout().then(function(){def.resolve()})}),def.promise}}})}),define("text!extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed.ng.html",[],function(){return'<div class="qv-collapsed-listbox" ng-class="{locked: isLocked, error: hasError, spark: responsiveMode == \'spark\', small: responsiveMode == \'small\'}" qva-outside-ignore-for="{{outsideIgnoreName}}">\r\n	<div class="error-layer"></div>\r\n	<div class="title" title="{{ title }}">\r\n		<span ng-if="isLocked" class="icon-toolbar-locked"></span>\r\n		<span class="title-text">{{ title }}</span>\r\n	</div>\r\n	<qv-state-count-bar ng-if="!hasError" cardinal="cardinal" state-counts="stateCounts"></qv-state-count-bar>\r\n	<i class="icon-triangle-right"></i>\r\n</div>'}),define("extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed",["qvangular","objects.models/listbox","text!./collapsed.ng.html","client.utils/state","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service"],function(qvangular,ListboxModel,template,State){"use strict";qvangular.directive("qvCollapsedListbox",function(){return{restrict:"E",replace:!0,template:template,scope:{model:"=",outsideIgnoreName:"=",responsiveMode:"="},require:"^qv-collapsed-listbox-delegated-open",link:function($scope){$scope.title="",$scope.hasError=!1,$scope.isLocked=!1,ListboxModel.bindLayout($scope,"model",function(layout){qvangular.$apply($scope,function(){var dimensionInfo=layout.qListObject.qDimensionInfo;$scope.hasError=layout.qListObject.qError||layout.qListObject.qDimensionInfo.qError?!0:!1,$scope.cardinal=dimensionInfo.qCardinal,$scope.stateCounts=dimensionInfo.qStateCounts,$scope.isLocked=dimensionInfo.qStateCounts.qLocked>0,$scope.title=layout.title,$scope.id=layout.qInfo.qId})})}}}),qvangular.directive("qvCollapsedListboxDelegatedOpen",function(){return{restrict:"A",scope:{outsideIgnoreName:"="},controller:["$scope","$element","qvListboxPopoverService",function($scope,$container,listboxPopoverService){function marginToContainer($element,$container){return{left:$element.position().left-$container.position().left,top:$element.position().top-$container.position().top,right:$container.width()-$element.position().left-$element.width(),bottom:$container.height()-$element.position().top-$element.height()}}function bestPosition($alignToElement,$container){var position,margin=marginToContainer($alignToElement,$container);return position=Math.max(margin.left,margin.right)>Math.max(margin.top,margin.bottom)?margin.left>margin.right?"left":"right":margin.top>margin.bottom?"top":"bottom"}var openId;$container.on("qv-activate",".qv-collapsed-listbox:not(.error)",function($event){var $element=angular.element($event.target).closest(".qv-collapsed-listbox"),model=$element.isolateScope().model,id=$element.isolateScope().id,popoverOptions={qvaOutsideIgnoreFor:$scope.outsideIgnoreName,$alignToElement:$element,position:bestPosition($element,$container),collision:"flipfit"};if($event.preventDefault(),$scope.$parent.allowInteraction(State)){if(id===openId)return listboxPopoverService.close(),void(openId=void 0);openId=id,listboxPopoverService.show(model,popoverOptions,function(){openId=void 0})}})}]}})}),define("extensions.qliktech/filterpane/filterpane",["qvangular","util","core.utils/deferred","objects.backend-api/field-api","extensions.qliktech/filterpane/filterpane-properties","extensions.qliktech/filterpane/filterpane-handler","objects.utils/data-properties/listobject-util","general.utils/property-mapper","objects.models/listbox","text!./filterpane.ng.html","objects.extension/base-controller","objects.extension/export-format","objects.extension/object-conversion","client.utils/state","extensions.qliktech/filterpane/filterpane-layout","extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed"],function(qvangular,util,Deferred,FieldApi,filterpanePropertiesDefinition,FilterpaneHandler,listObjectUtil,propertyMapper,ListboxModel,template,BaseController,ExportFormat,Conversion,State){"use strict";var component,FilterPaneController,MAX_DIMENSIONS=1e3,expando=0,getNs=function(){return"filterpane-"+ ++expando},hasUnrenderedChild=function(scope){return scope.columns.some(function(c){return c.items.some(function(c){return c.expand&&(!c.object||1!==c.object.renderState)})})};return FilterPaneController=BaseController.extend({size:{},columns:[],expandable:!1,init:function($scope,$element,$timeout,filterpaneLayout){this.$scope=$scope,this.$element=$element,this.$timeout=$timeout,this.filterpaneLayout=filterpaneLayout,$scope.allowInteraction=this.allowInteraction.bind(this),$scope.object.throbberApi.off(),this.showThrobberTimeout=$timeout(function(){$scope.object.throbberApi.show()},1e3),$scope.outsideIgnoreName=getNs(),$scope.columns=[],$scope.ext.expandable=function(){return this.expandable}.bind(this),$scope.state=State,$scope.options||($scope.options={}),$scope.triggerFullScreen=function(){State.state||$scope.$emit("objectTrigger","zoomOnCell")},$scope.$on("objectRenderStateChange",function(e,state){e.stopPropagation(),state&&!hasUnrenderedChild($scope)&&this.renderStateDfd.resolve()}.bind(this))},onPaint:function(){return this.renderStateDfd=Deferred(),this.update(this.$scope.layout).then(function(){hasUnrenderedChild(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},onResize:function(){return this.renderStateDfd=Deferred(),this.update(this.$scope.layout).then(function(){hasUnrenderedChild(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},update:function(layout){var dimensions,size=this.size,$scope=this.$scope,columns=this.columns,$element=this.$element,app=$scope.object.model.session.currentApp,filterpaneLayout=this.filterpaneLayout,newSize=filterpaneLayout.getSize($element,layout),resolveModelFunction=filterpaneLayout.getResolveModelFunction(ListboxModel,Deferred,app);return filterpaneLayout.sizeChanged(size,newSize)&&(this.size=size=newSize,this.columns=columns=this.getColumns(size)),filterpaneLayout.isValid(layout)?(dimensions=filterpaneLayout.getDimensions(layout),dimensions=filterpaneLayout.sortDimensions(layout,dimensions),columns=filterpaneLayout.mergeColumnsAndDimensions(columns,dimensions),filterpaneLayout.resolveAllModels($scope,columns,resolveModelFunction,Deferred).then(function(){filterpaneLayout.patchScope($scope,columns,util),filterpaneLayout.calculateExpandPriority($scope.columns,size),this.$timeout.cancel(this.showThrobberTimeout),$scope.object.throbberApi.hide(),this.expandable=!$scope.columns.some(function(column){return column.items.some(function(dimension){var model=dimension.model;return model&&model.layout&&model.layout.qSelectionInfo&&model.layout.qSelectionInfo.qInSelections})})}.bind(this))):($scope.columns=columns=[],Deferred.resolve())},getColumns:function(size){var columns=[];return this.filterpaneLayout.calculateColumns(size,columns,this.$scope.options.zoomEnabled),this.filterpaneLayout.balanceColumns(size,columns)},setInteraction:function(on){this.$scope.columns.forEach(function(column){column.items.forEach(function(item){item.expand&&(item.options.interactionEnabled=on)})})}}),FilterPaneController.$inject=["$scope","$element","$timeout","qvFilterpaneLayout"],component={type:"filterpane",template:template,BackendApi:FieldApi,filterpaneController:FilterPaneController,definition:filterpanePropertiesDefinition,initialProperties:{qChildListDef:{qData:{info:"/qInfo"}}},data:{dimensions:{min:1,max:1e3}},expandable:function(){return!1},mapProperties:function(){this.mappedDefinition=propertyMapper.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1}},getCreatePropertyHandler:function(){return new FilterpaneHandler(this.dimensionDefinition)},addFieldDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.setModel(object.model),handler.addFieldDimension(item.value,"").then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},addLibraryDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.setModel(object.model),handler.addLibraryDimension(item.libraryId).then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},getDropFieldOptions:function(builder,propertyHandler,model){propertyHandler.getDimensions().length<propertyHandler.maxDimensions()&&(propertyHandler.setModel(model),propertyHandler.addFieldDimension(builder.item.name,"").then(function(dimension){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)}))},getDropDimensionOptions:function(builder,propertyHandler,model){propertyHandler.getDimensions().length<propertyHandler.maxDimensions()&&(propertyHandler.setModel(model),propertyHandler.addLibraryDimension(builder.item.id).then(function(dimension){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)}))},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu){showMenu()},exportProperties:function(propertyTree){var childProp,i,j,key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty,dataGroup=exportFmt.data[0];for(i=0;i<propertyTree.qChildren.length;++i)childProp=propertyTree.qChildren[i].qProperty,dataGroup.dimensions.push({qDef:childProp.qListObjectDef.qDef,qLibraryId:childProp.qListObjectDef.qLibraryId,qOtherTotalSpec:childProp.qListObjectDef.qOtherTotalSpec||{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"}},title:childProp.title});if(properties.qLayoutExclude&&properties.qLayoutExclude.qHyperCubeDef){if(properties.qLayoutExclude.qHyperCubeDef.qDimensions)for(i=0;i<properties.qLayoutExclude.qHyperCubeDef.qDimensions.length;++i)dataGroup.dimensions.push(properties.qLayoutExclude.qHyperCubeDef.qDimensions[i]);if(properties.qLayoutExclude.qHyperCubeDef.qMeasures)for(i=0;i<properties.qLayoutExclude.qHyperCubeDef.qMeasures.length;++i)dataGroup.measures.push(properties.qLayoutExclude.qHyperCubeDef.qMeasures[i])}for(key in properties)"qChildListDef"!==key&&(exportFmt.properties[key]=properties[key]);if(properties.qLayoutExclude||(properties.qLayoutExclude={}),properties.qLayoutExclude.disabled){for(key in properties.qLayoutExclude.disabled)propName=key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);properties.qLayoutExclude.disabled.previousShowTitles&&(exportFmt.properties.showTitles=!0)}for(delete properties.qLayoutExclude,i=0;i<dataGroup.dimensions.length;++i)for(j=0;j<dataGroup.dimensions[i].qDef.qSortCriterias.length;++j)dataGroup.dimensions[0].qDef.qSortCriterias[j].qSortByFrequency=0,dataGroup.dimensions[0].qDef.qSortCriterias[j].qSortByState=0;return exportFmt},importProperties:function(exportedFmt,initialProperties){var maxDimensions,key,i,newPropertyTree={qChildren:[]},newProperties={},dataGroup=exportedFmt.data[0];maxDimensions=MAX_DIMENSIONS,newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={};for(key in exportedFmt.properties)"qLayoutExclude"===key?exportedFmt.properties[key].quarantine&&(newProperties.qLayoutExclude.quarantine=util.extend(!0,{},exportedFmt.properties[key].quarantine)):initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key];for(newProperties=util.extend(!0,{},initialProperties,newProperties),i=0;i<dataGroup.dimensions.length;++i)newPropertyTree.qChildren.length<maxDimensions?newPropertyTree.qChildren.push({qProperty:listObjectUtil.createDefaultListBox(dataGroup.dimensions[i],dataGroup.dimensions[i].title),qChildren:[]}):(newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.qHyperCubeDef||(newProperties.qLayoutExclude.qHyperCubeDef={}),newProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(newProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),newProperties.qLayoutExclude.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]));for(i=0;i<dataGroup.measures.length;++i)newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.qHyperCubeDef||(newProperties.qLayoutExclude.qHyperCubeDef={}),newProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(newProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),newProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]);return Conversion.importCommonProperties(newProperties,exportedFmt,initialProperties),newProperties.showTitles&&(newProperties.qLayoutExclude.disabled.previousShowTitles=!0,newProperties.showTitles=!1),newPropertyTree.qProperty=newProperties,newPropertyTree}},qvangular.directive("qvFilterpane",function(){return{controller:FilterPaneController,require:["qvFilterpane","^qvObject"],replace:!0,restrict:"E",link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}}),component}),define("text!extensions.qliktech/text-image/text-image.ng.html",[],function(){return'<div qv-extension style=\'width: 100%; height: 100%;\' qva-activate="edit()">\r\n	<div class="qv-media-tool-html" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-click="clickHtml($event)" ng-if="!editing && !initializing && !saving && !empty" ng-bind-html="html"></div>\r\n	<div class="text-image-hint" ng-if="empty && !editing" ng-class="{ \'selected\': isSelected() }">\r\n		<div class="hint-content" ng-show="!isSelected() || !editmode || object.isLink">\r\n			<i class="hint-icon icon-text-image"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptyHint"></div>\r\n		</div>\r\n		<div class="hint-content" ng-show="isSelected() && editmode && !object.isLink">\r\n			<i class="hint-icon icon-add"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptySelectedHint"></div>\r\n		</div>\r\n	</div>\r\n	<div class="qv-media-tool-editor" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-if="initializing || editing || saving" qv-text-image-editor x-editor-options="editorOptions" x-save="save"></div>\r\n</div>'}),define("extensions.qliktech/text-image/text-image-properties",["general.utils/property-resolver"],function(propertyResolver){return{type:"items",component:"accordion",items:{data:{uses:"data"},settings:{uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}},presentation:{type:"items",translation:"properties.presentation",items:{responsive:{type:"string",component:"dropdown",ref:"responsive",translation:"properties.textImage.responsive",defaultValue:"all",undefinedValue:"none",snapshot:{tid:"property-responsive"},options:[{value:"all",translation:"properties.textImage.responsive.textImages"},{value:"text",translation:"properties.textImage.responsive.text"},{value:"images",translation:"properties.textImage.responsive.images"},{value:"none",translation:"properties.textImage.responsive.none"}]}}},markdown:{type:"string",ref:"markdown",show:!1,defaultValue:""},images:{type:"array",ref:"images",show:!1,defaultValue:[]},backgroundImage:{type:"items",translation:"properties.backgroundImage",grouped:!0,items:{useBackgroundImage:{ref:"background.isUsed",type:"boolean",translation:"properties.backgroundImage.use",component:"switch",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},backgroundUrl:{ref:"background.url.qStaticContentUrlDef.qUrl",layoutRef:"background.url.qStaticContentUrl.qUrl",schemaIgnore:!0,translation:"Common.Image",tooltip:{select:"properties.media.select",remove:"properties.media.removeBackground"},type:"string",component:"media",defaultValue:"",show:function(itemData){return propertyResolver.getValue(itemData,"background.isUsed")}},backgroundSize:{ref:"background.size",translation:"properties.backgroundImage.size",type:"string",component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"Common.Auto"},{value:"alwaysFit",translation:"properties.backgroundImage.sizeAlwaysFit"},{value:"fitWidth",translation:"properties.backgroundImage.sizeFitWidth"},{value:"fitHeight",translation:"properties.backgroundImage.sizeFitHeight"},{value:"fill",translation:"properties.backgroundImage.sizeStretch"}],show:function(itemData){return propertyResolver.getValue(itemData,"background.isUsed")&&propertyResolver.getValue(itemData,"background.url.qStaticContentUrlDef.qUrl")}},backgroundPosition:{ref:"background.position",translation:"Common.Position",type:"string",component:"align-matrix",defaultValue:"topLeft",show:function(itemData){return propertyResolver.getValue(itemData,"background.isUsed")&&propertyResolver.getValue(itemData,"background.url.qStaticContentUrlDef.qUrl")&&"fill"!==propertyResolver.getValue(itemData,"background.size")}}}}}}}}}),define("extensions.qliktech/text-image/measure-utils",["general.utils/array-util","util"],function(arrayUtils,util){function calcDiff(measures,existingMeasures){var measureIds,existingMeasureIds,i,removed=[],added=[];for(measureIds=measures.map(function(measure){return measure.qDef.cId}),existingMeasureIds=existingMeasures.map(function(propertyMeasure){return propertyMeasure.qDef.cId}),i=existingMeasureIds.length-1;i>=0;--i)measureIds.contains(existingMeasureIds[i])||removed.push({index:i,id:existingMeasureIds[i],measure:existingMeasures[i]});for(i=0;i<measureIds.length;++i)existingMeasureIds.contains(measureIds[i])?measureIds.lastIndexOf(measureIds[i])!==i&&added.push({index:i,id:measureIds[i],measure:measures[i]}):added.push({index:i,id:measureIds[i],measure:measures[i]});return{removed:removed,added:added}}function removeMeasure(id,str){return str.replace(/=\[(\w*?)]\((\w*?)\)/g,function(match,text,measureId){return id===measureId?"":match})}function replaceMeasure(id,newId,str,index){var count=-1;return str.replace(/=\[(\w*?)]\((\w*?)\)/g,function(match,text,measureId){if(measureId===id){++count;var useIndex="undefined"!=typeof index;if(!useIndex||useIndex&&count===index)return"=["+text+"]("+newId+")"}return match})}function syncMeasures(measures,properties){var propertyMeasures=properties.qHyperCubeDef.qMeasures,diff=calcDiff(measures,propertyMeasures);diff.removed.forEach(function(removed){var idx=removed.index;propertyMeasures.splice(idx,1),arrayUtils.indexRemoved(properties.qHyperCubeDef.qInterColumnSortOrder,properties.qHyperCubeDef.qDimensions.length+idx)}),diff.added.forEach(function(added){var id=added.measure.qDef.cId,newId=util.generateId();added.measure.qDef.cId=newId,propertyMeasures.push(added.measure),arrayUtils.indexAdded(properties.qHyperCubeDef.qInterColumnSortOrder,properties.qHyperCubeDef.qDimensions.length+propertyMeasures.length-1),properties.markdown=replaceMeasure(id,newId,properties.markdown,1)})}return{removeMeasure:removeMeasure,replaceMeasure:replaceMeasure,syncMeasures:syncMeasures}}),define("extensions.qliktech/text-image/image-utils",["general.services/media-tool/markdown-html-parser","general.models/media-library","util"],function(Parser,MediaLibraryModel,util){function calcDiff(images,propertyImages){function getPropertyImageUrl(id){for(var i=0;i<propertyImages.length;i++)if(propertyImages[i].id===id)return propertyImages[i].url.qStaticContentUrlDef.qUrl;return null}var i,removed=[],added=[],imageIds=images.map(function(image){return image.id||""}),existingImageIds=propertyImages.map(function(propertyImage){return propertyImage.id});for(i=existingImageIds.length-1;i>=0;--i)imageIds.contains(existingImageIds[i])||removed.push({index:i,id:existingImageIds[i],url:propertyImages[i].url});for(i=0;i<imageIds.length;++i)existingImageIds.contains(imageIds[i])?imageIds.lastIndexOf(imageIds[i])!==i&&added.push({index:i,id:imageIds[i],url:getPropertyImageUrl(imageIds[i])}):added.push({index:i,id:imageIds[i],url:images[i].url});return{removed:removed,added:added}}function replaceImageId(id,newId,str,index){var count=-1;return str.replace(/!\[(\w*?)]\((.*?)\)/g,function(match,imageId,url){if(imageId===id){++count;var useIndex="undefined"!=typeof index;if(!useIndex||useIndex&&count===index)return"!["+newId+"]("+url+")"}return match})}function syncImages(images,properties){properties.images||(properties.images=[]);var propertyImages=properties.images,diff=calcDiff(images,propertyImages);diff.removed.forEach(function(removed){var idx=removed.index;propertyImages.splice(idx,1)}),diff.added.forEach(function(added){var id=added.id,newId=util.generateId(),url=Parser.unescapeMarkdown(added.url);url=MediaLibraryModel.stripBasePath(url),propertyImages.push({id:newId,url:{qStaticContentUrlDef:{qUrl:url}}}),id?properties.markdown=replaceImageId(id,newId,properties.markdown,1):properties.markdown=replaceImageId(id,newId,properties.markdown,0)})}return{syncImages:syncImages}}),define("extensions.qliktech/text-image/text-image",["jquery","qvangular","core.utils/deferred","lz-string","text!./text-image.ng.html","./text-image-properties","objects.backend-api/hypercube-api","client.utils/state","general.services/media-tool/media-tool-service","general.utils/string-limits","./measure-utils","./image-utils","general.models/media-library","core.utils/resize"],function($,qvangular,Deferred,lzString,template,properties,HypercubeApi,State,mediaToolService,stringLimits,measureUtils,imageUtils,MediaLibraryModel,Resize){function responsiveResize($scope,$element){if("none"===$scope.responsive||"undefined"==typeof $scope.responsive)return $scope.sizeClass="",$scope.visibilityClass="",$scope.responsiveClass="",Deferred.resolve();$scope.sizeClass="",$scope.visibilityClass="hidden","images"===$scope.responsive?$scope.responsiveClass="responsive-images":"text"===$scope.responsive?$scope.responsiveClass="responsive-text":$scope.responsiveClass="responsive-images responsive-text";var $timeout=qvangular.getService("$timeout"),element=$element.find(".qv-media-tool-html")[0];
return element?$timeout(function(){$scope.sizeClass="",$scope.sizeStyle={maxWidth:"100%",maxHeight:"100%"},$(element).find("img").css($scope.sizeStyle);var ratio=element.scrollHeight/element.clientHeight;ratio>1&&($scope.sizeStyle={maxWidth:Math.floor(1/ratio*100)+"%",maxHeight:Math.floor(1/ratio*100)+"%"},$(element).find("img").css($scope.sizeStyle)),ratio>3?$scope.sizeClass="bp-4":ratio>2?$scope.sizeClass="bp-3":ratio>1.5?$scope.sizeClass="bp-2":ratio>1?$scope.sizeClass="bp-1":$scope.sizeClass="",$scope.visibilityClass=""},10):($scope.visibilityClass="",Deferred.resolve())}function markdownIsEmpty(markdown){return!mediaToolService.hasContent(markdown)||""===markdown.trim()}var backgroundSize,backgroundPosition,$sce=qvangular.getService("$sce");return backgroundSize={auto:"auto auto",alwaysFit:"contain",fitWidth:"100% auto",fitHeight:"auto 100%",fill:"100% 100%"},backgroundPosition={topLeft:"0% 0%",centerLeft:"50% 0%",bottomLeft:"100% 0%",topCenter:"0% 50%",centerCenter:"50% 50%",bottomCenter:"100% 50%",topRight:"0% 100%",centerRight:"50% 100%",bottomRight:"100% 100%"},qvangular.directive("qvTextImageEditor",[function(){return{restrict:"A",scope:{editorOptions:"=",save:"="},link:function(scope,element){mediaToolService.show(element,scope.editorOptions),element.on("qv-outside",function(e){var target=$(e.target);target.closest(".qv-texttool-toolbar, .modal-container, .qui-immidiateContextual").length||scope.save()}),scope.$on("$destroy",function(){scope.save(),mediaToolService.hide()})}}}]),{type:"text-image",BackendApi:HypercubeApi,definition:properties,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],customErrorMessage:{calcCond:""}},images:[],markdown:"",background:{url:{},size:"auto"}},data:{measures:{min:0,max:1e3,add:function(measure,data){data.markdown+="=[]("+measure.qDef.cId+")"},remove:function(measure,data){data.markdown=measureUtils.removeMeasure(measure.qDef.cId,data.markdown)},replace:function(measure,oldMeasure,index,data){data.markdown=measureUtils.replaceMeasure(oldMeasure.qDef.cId,measure.qDef.cId,data.markdown)}}},snapshot:{canTakeSnapshot:function(object){return!markdownIsEmpty(object.layout.markdown)}},exportProperties:null,importProperties:null,template:template,showRequirements:function(){return!1},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu){propertyHandler.getMeasures().length<propertyHandler.maxMeasures()?"expression"===builder.item.type?propertyHandler.addExpressionMeasure(builder.item.name,"").then(function(){model.save()}):propertyHandler.addLibraryMeasure(builder.item.id).then(function(){model.save()}):(builder.ReplaceMeasures(model,propertyHandler),showMenu())},controller:["$scope",function($scope){function getHTMLMeasures(elem){var measures=[];return elem.find(".tokenized-measure").each(function(idx,measureElem){var measureStr=measureElem.getAttribute("data-measure");measureStr=lzString.decompressFromBase64(measureStr),measures.push(JSON.parse(measureStr))}),measures}function getHTMLImages(elem){function getInsertedImageDef(src){for(var insertedImages=mediaToolService.getOptions().insertedImages,i=0;i<insertedImages.length;i++)if(insertedImages[i].url===src)return insertedImages[i].urlDef;return null}var images=[];return elem.find("img").map(function(idx,imageElem){var id=imageElem.getAttribute("data-image-id"),src=imageElem.getAttribute("src"),url=getInsertedImageDef(src);url||(url=imageElem.getAttribute("src")),images.push({id:id,url:url})}),images}$scope.isSelected=function(){return $scope.options.isActive||$scope.options.isZoomed},$scope.$watch("editing",function(editing){$scope.object.preventDrag=editing}),$scope.edit=function(){!State.isInEditMode()||$scope.editing||$scope.object.isLink||$scope.isSelected()&&($scope.saving=!1,$scope.saved=!1,$scope.backendApi.getProperties().then(function(properties){var propertyHandler=$scope.ext.getCreatePropertyHandler();propertyHandler.setProperties(properties),$scope.editorOptions={markdown:properties.markdown,maxlength:stringLimits.textImage,toolbar:{buttons:"all",width:564},useMeasures:!0,layout:$scope.backendApi.model.layout,properties:properties,propertyHandler:propertyHandler,copiedMeasures:[],insertedImages:[],onOpen:function($textToolScope){$textToolScope.saveRange(),$scope.$apply(function(){$scope.editing=!0,$scope.initializing=!1})},isActive:function(){return $scope.editing||$scope.initializing}},$scope.initializing=!0}))},$scope.save=function(){if(!$scope.saving&&!$scope.saved){mediaToolService.closing();var markdown=mediaToolService.getMarkdown(),elem=mediaToolService.getEditorElement();if(null!==markdown&&markdown!==$scope.markdown){$scope.saving=!0;var properties=mediaToolService.getOptions().properties;properties.markdown=markdown,measureUtils.syncMeasures(getHTMLMeasures(elem),properties),imageUtils.syncImages(getHTMLImages(elem),properties),$scope.backendApi.model.save(),$scope.saved=!0}else $scope.editing=!1}},$scope.clickHtml=function(e){var preventClick=State.isInEditMode()||State.state===State.States.snapshot;preventClick&&$(e.target).closest("a").length&&e.preventDefault()},Resize.on("start",$scope.save),$scope.$on("$destroy",function(){Resize.off("start",$scope.save)})}],view:{paint:function(element,layout){function getBackgroundUrl(){return layout.background&&layout.background.isUsed&&layout.background.url&&layout.background.url.qStaticContentUrl&&layout.background.url.qStaticContentUrl.qUrl||""}var $scope=this.$scope,bgUrl="",bgImg="",bgSize="",bgPosition="",imagePromises=[];if($scope.saving&&($scope.editing=!1,$scope.saving=!1),bgUrl=getBackgroundUrl()){MediaLibraryModel.stripBasePath(bgUrl),bgUrl=bgUrl.replace(/"/g,'\\"'),bgUrl=bgUrl.replace(/'/g,"\\'"),bgImg="url('"+MediaLibraryModel.addBasePath(bgUrl)+"')",bgSize=backgroundSize[layout.background.size]||backgroundSize.auto,bgPosition=backgroundPosition[layout.background.position]||backgroundPosition.topLeft;var img=new Image,backDeferred=Deferred();imagePromises.push(backDeferred.promise),img.onload=function(){backDeferred.resolve()},img.onerror=function(){backDeferred.resolve()},img.src=bgUrl,img.complete&&(img.onload=null,img.onerror=null,backDeferred.resolve())}return this.$element.css({backgroundImage:bgImg,backgroundSize:bgSize,backgroundPosition:bgPosition,backgroundRepeat:"no-repeat"}),$scope.empty=markdownIsEmpty(layout.markdown)&&!bgUrl,$scope.html=$sce.trustAsHtml(mediaToolService.toHTML(layout.markdown,layout,!0)),$scope.markdown=layout.markdown,$scope.responsive=layout.responsive,responsiveResize($scope,element).then(function(){return qvangular.getService("$timeout")(function(){return element.find("img").each(function(i,img){img.complete||!function(img){var dfd=Deferred();imagePromises.push(dfd.promise),img.onload=function(){dfd.resolve()},img.onerror=function(){dfd.resolve()}}(img)}),imagePromises.length?Deferred.all(imagePromises):void 0},0,!1)})},resize:function(){return this.paint.apply(this,arguments)},onStateChanged:function(){this.$scope.editmode=State.isInEditMode(),this.$scope.editmode||(this.$scope.editing=!1)}},getDropFieldOptions:function(builder,propertyHandler,model,showMenu,object){builder.AddFieldAsMeasure(model,propertyHandler,object),showMenu()},getDropDimensionOptions:function(builder,propertyHandler,model,showMenu){showMenu()}}}),define("objects.backend-api/pivot-api",["./backend-api"],function(BackendApi){"use strict";function createPivotSelectionCells(selectionCells,columns,pivotType){var i,j,item,items=[];for(j=0;j<columns.length;j++)for(i=0;i<selectionCells.length;i++)item={qType:pivotType,qCol:columns[j],qRow:selectionCells[i]},items.push(item);return items}var PivotApi;return PivotApi=BackendApi.extend("PivotApi",{init:function(model){this._super(model,"/qHyperCubeDef",{mode:"P"}),this.cacheCube.setMethodName("GetHyperCubePivotData")},updateCache:function(layout){layout&&layout.qHyperCube&&"P"===layout.qHyperCube.qMode?(this.cacheCube.set(layout.qHyperCube.qPivotDataPages),this.cacheCube.setCubeSize(layout.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(pages){switch(this.model.layout.qHyperCube.qMode){case"P":return this.cacheCube.getData(pages);default:throw"you are using a non-supported backend-api"}},getReducedData:function(pages,zoomFactor,reductionMode){return reductionMode=void 0!==reductionMode?reductionMode:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,pages,zoomFactor,reductionMode])},select:function(selectionCells,colIndices,pivotType){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("SelectPivotCells",null,[this.path,createPivotSelectionCells(selectionCells,colIndices,pivotType)]);default:throw"you are using a non-supported backend-api"}},expandTop:function(dataRowIx,dataColIx,all){return this.model.rpc("ExpandTop",null,[this.path,dataRowIx,dataColIx,all])},expandLeft:function(dataRowIx,dataColIx,all){return this.model.rpc("ExpandLeft",null,[this.path,dataRowIx,dataColIx,all])},collapseTop:function(dataRowIx,dataColIx,all){return this.model.rpc("CollapseTop",null,[this.path,dataRowIx,dataColIx,all])},collapseLeft:function(dataRowIx,dataColIx,all){return this.model.rpc("CollapseLeft",null,[this.path,dataRowIx,dataColIx,all])},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},getSize:function(){return this.model.layout.qHyperCube.qSize}})}),define("extensions.qliktech/pivot-table/pivot-table-properties",["client.property-panel/default-properties","general.utils/property-resolver","util","translator"],function(defaultProperties,propertyResolver,util,translator){function totalsVisibility(itemData,handler,args){if(!args.properties.qHyperCubeDef.qIndentMode)return!0;var idx,pseudoIdx=args.properties.qHyperCubeDef.qInterColumnSortOrder.indexOf(-1),noOfLeftDims=args.properties.qHyperCubeDef.qNoOfLeftDims;return pseudoIdx>-1&&noOfLeftDims>pseudoIdx&&noOfLeftDims--,idx=args.properties.qHyperCubeDef.qDimensions.indexOf(itemData),0===idx||idx>=noOfLeftDims}var settings,sorting,addons;settings={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{alwaysFullyExpanded:{ref:"qHyperCubeDef.qAlwaysFullyExpanded",type:"boolean",translation:"properties.pivot.fullyExpanded",defaultValue:!1},indentMode:{ref:"qHyperCubeDef.qIndentMode",type:"boolean",translation:"properties.pivot.indentMode"}}}}},sorting={uses:"sorting",component:"pivot-sorting"};var data={type:"items",component:"pivot-data",translation:"properties.data",addTranslation:"Properties.AddData",items:{dimensions:util.extend(!0,{},defaultProperties.dimensions,{items:{globalGrouping:{type:"boolean",translation:"properties.dimensionLimits.globalGrouping",ref:"qOtherTotalSpec.qGlobalOtherGrouping",defaultValue:!1,show:function(itemData){return"OTHER_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")}},totalMode:{type:"string",component:"switch",translation:"properties.showTotals",ref:"qOtherTotalSpec.qTotalMode",defaultValue:"TOTAL_OFF",trueOption:{value:"TOTAL_EXPR",translation:"properties.on"},falseOption:{value:"TOTAL_OFF",translation:"properties.off"},show:totalsVisibility},totalsLabel:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qTotalLabel",translation:"properties.dimensionLimits.totals",defaultValue:function(){return translator.get("properties.dimensionLimits.totals")},show:function(itemData,handler,args){return"TOTAL_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qTotalMode")&&totalsVisibility(itemData,handler,args)}}}}),measures:util.extend(!0,{},defaultProperties.measures,{items:{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(itemData){void 0===itemData.qAttributeExpressions[0]&&(itemData.qAttributeExpressions[0]={})}}}})}};return addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:data,sorting:sorting,addons:addons,settings:settings}}}),define("extensions.qliktech/pivot-table/pivot-sorting-util",["general.utils/array-util"],function(arrayUtil){function validatePivotHyperCube(hypercubeDef){function buildDefaultArray(){for(var array=[],i=0;i<dimensions.length;i++)array.push(i);var addPseudoDim=hypercubeDef.qMeasures.length>=2;return addPseudoDim&&array.push(-1),array}var dimensions=hypercubeDef.qDimensions;isInvalidOrderArray(dimensions,hypercubeDef.qInterColumnSortOrder)&&(hypercubeDef.qInterColumnSortOrder=buildDefaultArray())}function isInvalidOrderArray(dimensions,array){var indexSet={},sortedArray=[],isInvalid=!1,hasPseudoDim=-1!==array.indexOf(-1);array.forEach(function(item){indexSet[item]?isInvalid=!0:indexSet[item]=!0}),isInvalid=hasPseudoDim?isInvalid||dimensions.length+1!==Object.keys(indexSet).length:isInvalid||dimensions.length!==Object.keys(indexSet).length,Object.keys(indexSet).forEach(function(indexStr){"-1"!==indexStr&&sortedArray.push(parseInt(indexStr,10))}),sortedArray=sortedArray.sort(function(a,b){return a-b});for(var i=0;i<sortedArray.length;++i)isInvalid=isInvalid||sortedArray[i]!==i;return isInvalid}function fixPivotHypercubeOrders(hypercubeDef){function fixDimensions(){for(var i=0;i<dimColOrders.length;i++)if(-1!==dimColOrders[i]&&dimColOrders[i]!==i){var moveFrom=dimColOrders[i],moveToIndex=dimColOrders.indexOf(i),moveTo=dimColOrders[moveToIndex];arrayUtil.swap(dimColOrders,i,moveToIndex),arrayUtil.swap(dimensions,i,moveToIndex),arrayUtil.swap(interColSortOrder,interColSortOrder.indexOf(moveFrom),interColSortOrder.indexOf(moveTo))}}validatePivotHyperCube(hypercubeDef);var dimColOrders,dimensions=hypercubeDef.qDimensions,interColSortOrder=hypercubeDef.qInterColumnSortOrder;dimColOrders=interColSortOrder.filter(function(val){return-1!==val}),fixDimensions()}function reorderPivotDimensions(hyperCubeDef,dimOrders){var dimensions=hyperCubeDef.qDimensions,interColSortOrder=hyperCubeDef.qInterColumnSortOrder,newDimensions=[],pseudoIdx=dimOrders.indexOf(-1);dimOrders.forEach(function(index){-1!==index&&newDimensions.push(dimensions[index])}),newDimensions.forEach(function(dim,index){dimensions[index]=dim}),interColSortOrder.splice(0,interColSortOrder.length);for(var i=0;i<newDimensions.length;i++)interColSortOrder.push(i);pseudoIdx>-1&&interColSortOrder.splice(pseudoIdx,0,-1)}function reorderMeasures(hyperCubeDef,measOrders){var measures=hyperCubeDef.qMeasures,newMeasures=[];measOrders.forEach(function(index){newMeasures.push(measures[index])}),measures.splice(0,measures.length),newMeasures.forEach(function(measure){measures.push(measure)})}return{validatePivotHyperCube:validatePivotHyperCube,fixPivotHypercubeOrders:fixPivotHypercubeOrders,reorderPivotDimensions:reorderPivotDimensions,reorderMeasures:reorderMeasures,isInvalidOrderArray:isInvalidOrderArray}}),define("extensions.qliktech/pivot-table/pivot-hypercube-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/pivot-table/pivot-sorting-util","util"],function(HyperCubeHandler,Deferred,arrayUtils,pivotSortingUtil,util){"use strict";var PivotHyperCubeHandler,TOTAL_MAX_MEASURES=1e3;return PivotHyperCubeHandler=HyperCubeHandler.extend({addDimension:function(dimension,asColumn){var dimensions=this.getDimensions(),self=this;return dimension.qDef.cId||(dimension.qDef.cId=util.generateId()),dimensions.length<this.maxDimensions()?this.autoSortDimension(dimension).then(function(){var interColumnSortOrder,pseudoIdx,noOfLeftDims=self.hcProperties.qNoOfLeftDims,noDims=dimensions.length;return pivotSortingUtil.fixPivotHypercubeOrders(self.hcProperties),interColumnSortOrder=self.hcProperties.qInterColumnSortOrder,pseudoIdx=interColumnSortOrder.indexOf(-1),asColumn||-1!==noOfLeftDims?!asColumn&&noOfLeftDims>=0?(pseudoIdx>=noOfLeftDims?(interColumnSortOrder.splice(pseudoIdx,1),interColumnSortOrder.push(noDims),interColumnSortOrder.splice(pseudoIdx+1,0,-1)):interColumnSortOrder.push(noDims),dimensions.splice(noOfLeftDims,0,dimension),self.hcProperties.qNoOfLeftDims++):(0===noDims&&(self.hcProperties.qNoOfLeftDims=0),interColumnSortOrder.push(noDims),dimensions.push(dimension)):(self.hcProperties.qNoOfLeftDims=1,interColumnSortOrder.unshift(noDims),dimensions.splice(0,0,dimension)),Deferred.resolve(dimension)}):void 0},removeDimension:function(index){var dimension,interColumnSortOrderIndex,i,dimensions=this.getDimensions(),noOfLeftDims=this.properties.qHyperCubeDef.qNoOfLeftDims,interColumnSortOrder=this.hcProperties.qInterColumnSortOrder;for(i=0;i<interColumnSortOrder.length;i++)if(interColumnSortOrder[i]===index){interColumnSortOrderIndex=i;break}return noOfLeftDims>=interColumnSortOrderIndex+1&&this.properties.qHyperCubeDef.qNoOfLeftDims--,dimension=dimensions.splice(index,1)[0],arrayUtils.indexRemoved(this.hcProperties.qInterColumnSortOrder,index),pivotSortingUtil.fixPivotHypercubeOrders(this.hcProperties),Deferred.resolve(dimension)},addMeasure:function(measure){var measures=this.getMeasures(),self=this;if(measure.qDef.cId||(measure.qDef.cId=util.generateId()),delete measure.qDef.qNumFormat,measures.length<this.maxMeasures()){var addPseudo=1===measures.length;return measures.push(measure),this.autoSortMeasure(measure).then(function(){return addPseudo&&self.hcProperties.qInterColumnSortOrder.push(-1),measure})}return measures.length<TOTAL_MAX_MEASURES?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(measure),Deferred.resolve(measure)):void 0},removeMeasure:function(idx){var removePseudo,measure,pIx,measures=this.getMeasures();if(idx<measures.length){if(removePseudo=2===measures.length,measure=this.hcProperties.qMeasures.splice(idx,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length)measures.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]);else if(removePseudo){var interColumnSortOrder=this.hcProperties.qInterColumnSortOrder;pIx=interColumnSortOrder.indexOf(-1),interColumnSortOrder.splice(pIx,1),pIx+1<=this.hcProperties.qNoOfLeftDims&&this.hcProperties.qNoOfLeftDims--}}else measure=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(idx-measures.length,1)[0];return Deferred.resolve(measure)},getSorting:function(){throw"don't call this"},changeSorting:function(){throw"don't call this"},setSorting:function(){throw"don't call this"}})}),define("text!extensions.qliktech/pivot-table/pivot-table.ng.html",[],function(){return'<div class="qv-pt" ng-class="{ \'qv-pt-interactive\': interactive, \'sortable-active\': pivoting.dragPlaceholder }">\r\n	<qv-scroll-area x-non-mouse-viewport-scrolling="nonMouseViewportScrolling"\r\n					class="qv-grid-object-scroll-area"\r\n					qva-delegated-activate=".qv-pt-expandable#interactive && !selectionsApi.active && collapseExpand($event);"\r\n					qv-sortable-list="pivoting">\r\n		<table	qv-selections-select-while-locked="selectWhileLocked()"\r\n				qv-selections-toggle-dimension-value="{ selector: \'.cell\' }"\r\n				qv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\r\n				qv-selections-exclude-toggle-dimension-value="excludeDimensionToggle($event)"\r\n				qv-selections-multiselect="{ selector: \'.cell:not(.null-value)\' }"\r\n				qv-selections-start-multiselect="interactive && activateSelections(cell)"\r\n				qv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\r\n				qv-selections-end-multiselect="interactive && multiselect()">\r\n			<colgroup>\r\n				<col ng-repeat="cell in metaGhostHeaders.headers" ng-style="cell.style" />\r\n			</colgroup>\r\n			<tbody>\r\n				<tr ng-repeat="row in grid.headerRows" tid="header.row"\r\n					ng-class="row.classList">\r\n					<th ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						qv-pivot-table-include="cell.templateSrc"\r\n						title="{{cell.text}}"\r\n						tid="header.row.cell"></th>\r\n				</tr>\r\n				<tr ng-repeat="row in grid.rows" tid="data.row">\r\n					<td ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						qv-pivot-table-include="cell.templateSrc"\r\n						title="{{cell.text}}"\r\n						tid="data.row.cell"></td>\r\n				</tr>\r\n			</tbody>\r\n		</table>\r\n	</qv-scroll-area>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/cell-item.ng.html",[],function(){return'<div class="value" ng-bind="cell.text"></div>\r\n'}),define("text!extensions.qliktech/pivot-table/header-cell-item.ng.html",[],function(){return'<div class="value">\r\n	<i class="qv-pt-expandable" ng-if="cell.collapseExpandClass" ng-class="cell.collapseExpandClass"></i>\r\n	<span ng-bind="cell.text"></span>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/meta/meta-left.ng.html",[],function(){return'<div class="left-meta-headers list"\r\n	 tid="meta.rows"\r\n	 ng-repeat="list in [pivoting.rows]"\r\n	 qv-pivot-table-include="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-top.ng.html",[],function(){return'<div class="top-meta-headers list"\r\n	 tid="meta.columns"\r\n	 ng-repeat="list in [pivoting.columns]"\r\n	 qv-pivot-table-include="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-list.ng.html",[],function(){return'<div class="button-wrapper"\r\n	 ng-repeat="header in list.items track by header.id"\r\n	 qv-pivot-table-include="header.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-item.ng.html",[],function(){return'<div class="qui-outlinebutton qv-pt-meta-button"\r\n		tid="meta.button"\r\n		ng-style="header.style"\r\n		ng-class="{ \'qui-active\': header.open, \'pseudo\': header.isPseudoDim, \'dragging\': header.dragging, \'qui-disabled\': !interactive || selectionsApi.active }"\r\n		qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n		qva-activate="!header.isPseudoDim && !selectionsApi.active && interactive && showDimension($event, header)"\r\n		title="{{header.title}}">\r\n	<div class="meta-text">{{header.title}}</div>\r\n	<i ng-if="!header.isPseudoDim" class="icon-triangle-bottom meta-arrow"></i>\r\n</div>'}),define("ng",[],function(){return{load:function(name,req,onload,config){function getService(){"undefined"!=typeof window&&window.qvangularGlobal?onload(window.qvangularGlobal.getService(name)):setTimeout(getService,5)}config.isBuild||"undefined"==typeof window?onload():getService()}}}),define("objects.grid/data-grid-provider",["qvangular","./data-grid"],function(qvangular,DataGrid){"use strict";qvangular.provider("qvDataGrid",function(){this.$get=[function(){return function(type){return new DataGrid(type)}}]})}),define("extensions.qliktech/pivot-table/meta/ghost-headers-provider",["qvangular","util","translator","general.utils/support"],function(qvangular,util,translator,support){"use strict";function MetaGhostHeader(calcApprMaxGlyphCnt){this.calcApprMaxGlyphCnt=calcApprMaxGlyphCnt,this.style={}}function MetaGhostHeaders(opts,layout,viewportRect){this.metaHeaderPadding=10;var defaultOpts={glyphWidth:GLYPH_WIDTH,collapseExpandIconGlyphCnt:support.treatAsDesktop()?3:4,columnPaddingGlyphCnt:3,metaHeaderMaxGlyphCnt:(150+this.metaHeaderPadding)/GLYPH_WIDTH,cellPaddingGlyphCnt:Math.ceil(12/GLYPH_WIDTH),buttonPaddingGlyphCnt:Math.ceil(20/GLYPH_WIDTH),buttonArrowGlyphCnt:Math.ceil(13/GLYPH_WIDTH),buttonMarginOfSafetyGlyphCnt:2,leftTree:{emptyGlyphCnt:3,widthFactor:.35},topTree:{wideWidthFactor:.3,growFactor:1.2}};this.opts=util.extend(!0,defaultOpts,opts),this.layout=layout,this.viewportRect=viewportRect,this.headers=[],this.maxGlyphs=0,this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo={cnt:0,width:0}}function getLongestDimGlyphCnt(top){var alwaysFullyExpanded=!!this.layout.qHyperCube.qAlwaysFullyExpanded;return this.sortOrder.filter(function(dIx,ix){return top?ix>=this.leftDimCnt:ix<this.leftDimCnt},this).map(function(dIx,ix){var glyphCnt=0;if(-1===dIx)return 0;var d=this.layout.qHyperCube.qDimensionInfo[dIx];return ix+1<this.leftDimCnt?(glyphCnt=d.qApprMaxGlyphCount,alwaysFullyExpanded||(glyphCnt+=this.opts.collapseExpandIconGlyphCnt),glyphCnt=Math.max(d.othersLabel.length,glyphCnt)):(glyphCnt=d.qApprMaxGlyphCount,glyphCnt+=this.opts.columnPaddingGlyphCnt),glyphCnt},this).sort(function(a,b){return b-a})[0]||0}function getLongestDimTitleGlyphCnt(top){return this.sortOrder.filter(function(dIx,ix){return top?ix>=this.leftDimCnt:ix<this.leftDimCnt},this).map(function(dIx){var glyphCnt=0;return-1===dIx?glyphCnt=translator.get("Common.Measures").length:(glyphCnt=this.layout.qHyperCube.qDimensionInfo[dIx].qFallbackTitle.length+this.opts.buttonArrowGlyphCnt,glyphCnt=Math.max(this.layout.qHyperCube.qDimensionInfo[dIx].othersLabel.length,glyphCnt)),glyphCnt+this.opts.buttonPaddingGlyphCnt+this.opts.buttonMarginOfSafetyGlyphCnt},this).sort(function(a,b){return b-a})[0]||0}var GLYPH_WIDTH=8;MetaGhostHeaders.prototype={_reset:function(){this.headers.length=0,this.maxGlyphs=0,this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo.cnt=0,this.dataColumnsInfo.width=0},_addCollapseExpandHeader:function(leftHeaders){var item=new MetaGhostHeader(this.opts.collapseExpandIconGlyphCnt);leftHeaders.push(item),this.availableGlyphs-=this.opts.collapseExpandIconGlyphCnt,this.totLeftGlyphCnt+=this.opts.collapseExpandIconGlyphCnt},_addCollapseExpandHeaders:function(leftHeaders){for(var i=0;i<this.leftDimCnt-1&&this.leftDimCnt>1&&this.leftDimCnt<=this.sortOrderCnt;++i)this._addCollapseExpandHeader(leftHeaders)},_getLeftCollapseExpandCnt:function(leftTreeDepth){return this.isIndentMode?this.leftDimCnt-1:leftTreeDepth},_addLeftTreeMetaGhostHeader:function(leftHeaders,leftGlyphCnt){var item=new MetaGhostHeader(leftGlyphCnt);leftHeaders.push(item),this.availableGlyphs-=leftGlyphCnt,this.totLeftGlyphCnt+=leftGlyphCnt},_addEmptyLeftTreeMetaGhostHeader:function(leftHeaders,leftEmptyGlyphCnt){var item=new MetaGhostHeader(leftEmptyGlyphCnt||this.opts.leftTree.emptyGlyphCnt);leftHeaders.push(item),this.availableGlyphs-=item.calcApprMaxGlyphCnt},_getDataGhostHeaders:function(){var i,calcApprMaxGlyphCnt,dataHeaders=[];for(i=0;this.availableGlyphs>0&&this.totDataColCnt>0&&i<this.totDataColCnt;++i){if(calcApprMaxGlyphCnt=this.longestMeasureGlyphCnt,calcApprMaxGlyphCnt+=this.opts.columnPaddingGlyphCnt,calcApprMaxGlyphCnt/this.longestTopDimGlyphCnt<this.opts.topTree.wideWidthFactor&&(calcApprMaxGlyphCnt+=calcApprMaxGlyphCnt*this.opts.topTree.growFactor),this.availableGlyphs-calcApprMaxGlyphCnt<0){this.availableGlyphs=0;break}this.availableGlyphs-=calcApprMaxGlyphCnt;var item=new MetaGhostHeader(calcApprMaxGlyphCnt);dataHeaders.push(item)}return dataHeaders},_getLeftGhostHeaders:function(leftEmptyGlyphCnt,leftTreeDepth){var leftHeaders=[],expandGlyphCnt=this.opts.collapseExpandIconGlyphCnt*this._getLeftCollapseExpandCnt(leftTreeDepth),leftGlyphCnt=this.longestLeftDimGlyphCnt+expandGlyphCnt,leftTitleGlyphCnt=Math.min(this.longestLeftDimTitleGlyphCnt,this.opts.metaHeaderMaxGlyphCnt)-expandGlyphCnt;return leftGlyphCnt=Math.max(leftGlyphCnt,leftTitleGlyphCnt),leftGlyphCnt>0?this.isIndentMode?this._getLeftGhostHeadersIndent(leftHeaders,leftGlyphCnt,expandGlyphCnt):this._getLeftGhostHeadersNonIndent(leftHeaders,leftTreeDepth,leftTitleGlyphCnt,expandGlyphCnt):this._addEmptyLeftTreeMetaGhostHeader(leftHeaders,leftEmptyGlyphCnt),leftHeaders},_getLeftGhostHeadersIndent:function(leftHeaders,leftGlyphCnt,expandGlyphCnt){this.pseudoInLeftTree&&(leftGlyphCnt+=this.longestMeasureTitleGlyphCnt),leftGlyphCnt>this.availableGlyphs&&(leftGlyphCnt=Math.max(this.availableGlyphs-expandGlyphCnt,Math.min(leftGlyphCnt,this.opts.metaHeaderMaxGlyphCnt-expandGlyphCnt,Math.floor(this.opts.leftTree.widthFactor*this.maxGlyphs)))),this._addCollapseExpandHeaders(leftHeaders),this._addLeftTreeMetaGhostHeader(leftHeaders,leftGlyphCnt)},_getLeftGhostHeadersNonIndent:function(leftHeaders,leftTreeDepth,leftTitleGlyphCnt,expandGlyphCnt){this._getLeftDimsWidths(leftTreeDepth,leftTitleGlyphCnt,expandGlyphCnt).forEach(function(width){this._addCollapseExpandHeader(leftHeaders),this._addLeftTreeMetaGhostHeader(leftHeaders,width)},this)},_getLeftDimsWidths:function(leftTreeDepth,leftTitleGlyphCnt,expandGlyphCnt){for(var width,shrunkGlyphCnt,unusedGlyphCnt,widths=[],totalGlyphCnt=0,shrinkFactor=0,i=0;leftTreeDepth>i;++i)width=this._getDimGlyphCnt(i)+this.opts.cellPaddingGlyphCnt,totalGlyphCnt+=width,widths.push({target:width,adjusted:width});if(leftTitleGlyphCnt>totalGlyphCnt){var missingTitleGlyphCnt=leftTitleGlyphCnt-totalGlyphCnt,lastWidth=widths[widths.length-1];lastWidth.adjusted=lastWidth.target+=Math.min(missingTitleGlyphCnt,this.maxGlyphs-totalGlyphCnt),totalGlyphCnt=widths.reduce(function(sum,item){return sum+item.target},0)}if(totalGlyphCnt+expandGlyphCnt>this.availableGlyphs&&totalGlyphCnt+expandGlyphCnt>this.maxGlyphs*this.opts.leftTree.widthFactor)for(totalGlyphCnt=0,i=0;leftTreeDepth>i;++i)width=Math.min(this.opts.metaHeaderMaxGlyphCnt-expandGlyphCnt,widths[i].target>8?widths[i].target/2:widths[i].target),widths[i].adjusted=width,totalGlyphCnt+=width;if(totalGlyphCnt+expandGlyphCnt>this.availableGlyphs&&totalGlyphCnt+expandGlyphCnt>this.maxGlyphs)for(shrinkFactor=(totalGlyphCnt+expandGlyphCnt-this.maxGlyphs)/totalGlyphCnt,i=0;leftTreeDepth>i;++i)width=widths[i].adjusted,widths[i].adjusted=Math.floor(width-width*shrinkFactor);else if(totalGlyphCnt+expandGlyphCnt<this.availableGlyphs)for(unusedGlyphCnt=this.availableGlyphs-totalGlyphCnt-expandGlyphCnt,shrunkGlyphCnt=widths.reduce(function(count,item){return count+(item.adjusted<item.target?item.target:0)},0),i=0;leftTreeDepth>i;++i)width=widths[i],width.adjusted<width.target&&(widths[i].adjusted+=Math.floor(width.target/shrunkGlyphCnt*unusedGlyphCnt));return widths.map(function(item){return item.adjusted})},_calculateGhostMetaHeadersWidth:function(width){var dataGhostHeaders,totWidthFactor=1;this.headers.forEach(function(header){header.widthFactor=header.calcApprMaxGlyphCnt*this.opts.glyphWidth/width,header.style.width=100*header.widthFactor+"%",totWidthFactor-=header.widthFactor},this),dataGhostHeaders=this.headers.slice(this.leftCellCnt),totWidthFactor>0&&dataGhostHeaders.forEach(function(header){header.widthFactor+=totWidthFactor/this.dataColumnsInfo.cnt,header.style.width=100*header.widthFactor+"%"},this),dataGhostHeaders.length&&(this.dataColumnsInfo.width=dataGhostHeaders[0].widthFactor*width)},update:function(leftEmptyGlyphCnt,leftTreeDepth){var leftHeaders,dataHeaders,leftGlyphCount,dataGlyphCount;for(this._reset(),this.maxGlyphs=Math.floor(this.viewportRect.width/this.opts.glyphWidth),this.availableGlyphs=this.maxGlyphs,this.availableGlyphs>0&&(dataHeaders=this._getDataGhostHeaders()),leftHeaders=this._getLeftGhostHeaders(leftEmptyGlyphCnt,leftTreeDepth),dataGlyphCount=dataHeaders.reduce(function(glyphCount,dataHeader){return glyphCount+dataHeader.calcApprMaxGlyphCnt},0),leftGlyphCount=leftHeaders.reduce(function(glyphCount,dataHeader){return glyphCount+dataHeader.calcApprMaxGlyphCnt},0);dataHeaders.length>0&&dataGlyphCount+leftGlyphCount>this.maxGlyphs;){var dataHeader=dataHeaders.pop();dataGlyphCount-=dataHeader.calcApprMaxGlyphCnt}this.headers=leftHeaders.concat(dataHeaders),this.dataColumnsInfo.cnt=dataHeaders.length,this.leftCellCnt=leftHeaders.length,this._calculateGhostMetaHeadersWidth(this.viewportRect.width)},_getDimGlyphCnt:function(dimIndex){
var pseudo=this.pseudoDimIndex;if(pseudo===dimIndex)return this.longestMeasureTitleGlyphCnt;var ix=dimIndex>pseudo?dimIndex-1:dimIndex;return this.layout.qHyperCube.qDimensionInfo[ix].qApprMaxGlyphCount},getDimInfo:function(dimIx){return dimIx===this.pseudoDimIndex?void 0:this.layout.qHyperCube.qDimensionInfo[this.sortOrder[dimIx]]}},Object.defineProperties(MetaGhostHeaders.prototype,{isIndentMode:{get:function(){return this.layout.qHyperCube.qIndentMode}},pseudoDimIndex:{get:function(){var ix=this.sortOrder.indexOf(-1);return~ix?ix:this.sortOrderCnt}},longestMeasureGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(m){return Math.max(m.qApprMaxGlyphCount,2)}).sort(function(a,b){return b-a})[0]||0}},longestMeasureTitleGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(item){return item.qFallbackTitle.length}).sort(function(a,b){return b-a})[0]||0}},longestLeftDimTitleGlyphCnt:{get:function(){return getLongestDimTitleGlyphCnt.call(this)}},longestLeftDimGlyphCnt:{get:function(){return getLongestDimGlyphCnt.call(this)}},longestTopDimGlyphCnt:{get:function(){return getLongestDimGlyphCnt.call(this,!0)}},sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}},totDataColCnt:{get:function(){return this.layout.qHyperCube.qSize.qcx}},pseudoInLeftTree:{get:function(){return this.pseudoDimIndex<this.leftDimCnt}}}),qvangular.provider("qvPivotTableMetaGhostHeadersProvider",function(){this.$get=[function(){return function(opts,layout,viewportRect){return new MetaGhostHeaders(opts,layout,viewportRect)}}]})}),define("extensions.qliktech/pivot-table/meta/pivoting",["general.sortable/sortable-item-lists","translator"],function(SortableItemLists,translator){"use strict";var Pivoting;return Pivoting=SortableItemLists.extend("SortableMetaLists",{init:function(opts,backendApi,grid,metaGhostHeaders,layout,$id,currentPopover){this._super.apply(this,[opts]),this.layout=layout,this.backendApi=backendApi,this.grid=grid,this.metaGhostHeaders=metaGhostHeaders,this.$id=$id,this.currentPopover=currentPopover,this.rows=this.createList(),this.rows.templateSrc="pt-meta-list.ng.html",this.columns=this.createList(),this.columns.templateSrc="pt-meta-list.ng.html"},reset:function(){this._super.apply(this,arguments)},update:function(totLeftGlyphCnt,glyphWidth,dataColCnt,dataColWidth){var i,dimIx,list,item,fieldName;for(this.reset(),i=0;i<this.sortOrderCnt;++i){if(dimIx=this.sortOrder[i],i<this.leftDimCnt)list=this.rows;else{if(0>=dataColCnt)continue;list=this.columns}-1!==dimIx?(fieldName=this.layout.qHyperCube.qDimensionInfo[dimIx].qGroupFieldDefs[this.layout.qHyperCube.qDimensionInfo[dimIx].qGroupPos],item=list.createItem({title:this.layout.qHyperCube.qDimensionInfo[dimIx].qFallbackTitle,id:this.layout.qHyperCube.qDimensionInfo[dimIx].cId,fieldName:fieldName,style:{},qvaOutsideIgnoreFor:"qv-pt-meta-header-"+this.$id,open:this.currentPopover.header&&fieldName===this.currentPopover.header.fieldName,dimIx:dimIx})):item=list.createItem({title:translator.get("Common.Measures"),dimIx:-1,isPseudoDim:!0,style:{}}),item.templateSrc="pt-meta-item.ng.html",i<this.leftDimCnt&&item.title.length+this.metaGhostHeaders.metaHeaderPadding>totLeftGlyphCnt&&(item.style.maxWidth=totLeftGlyphCnt*glyphWidth-this.metaGhostHeaders.metaHeaderPadding,item.style.minWidth=0),i>=this.leftDimCnt&&1===dataColCnt&&item.title.length>Math.floor(dataColWidth/glyphWidth)&&(item.style.maxWidth=Math.floor(dataColWidth)-this.metaGhostHeaders.metaHeaderPadding,item.style.minWidth=0),list.addItem(item)}}}),Object.defineProperties(Pivoting.prototype,{sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}}}),Pivoting}),define("extensions.qliktech/pivot-table/meta/pivoting-provider",["qvangular","./pivoting"],function(qvangular,SortableMetaLists){"use strict";function PivotingProvider(){this.$get=[function(){return function(backendApi,grid,metaGhostHeaders,layout,$id,currentPopover,virtualScrollCtrl,multiSelectCtrl){return new(SortableMetaLists.extend("PivotTableSortableMetaLists",{addPlaceholder:function(fromItem,clientRect){var placeholder=this._super.apply(this,arguments);placeholder.style.width=clientRect.width,placeholder.templateSrc="pt-meta-item.ng.html",fromItem.dragging=!0},allowAutoScroll:function(){return!1},onBegin:function(){this._super.apply(this,arguments),virtualScrollCtrl.off(),multiSelectCtrl.off(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!0)},enable:function(){this._super.apply(this,arguments),virtualScrollCtrl.on(),multiSelectCtrl.on(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!1)},onMove:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onMoveToList:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onEnterList:function(list){list===this.rows&&list.isEmpty()&&this.metaGhostHeaders.update(2*this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt),this._super.apply(this,arguments),list===this.columns&&this.rows.isEmpty()&&this.metaGhostHeaders.update(this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt)},patchPivotingProperties:function(){var noLeftDims,columnOrder=[];this.rows.items.forEach(function(item){columnOrder.push(item.dimIx)}),noLeftDims=columnOrder.length,this.columns.items.forEach(function(item){columnOrder.push(item.dimIx)});var params=[[],!0];params[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(columnOrder)},params[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(noLeftDims)},this.backendApi.applyPatches(params)},toggleCellsWhenSorting:function(){var key,add;for(key=arguments.length-1;key>=0;--key)if(Array.isArray(arguments[key])){var i,j,colCnt,cell,rows=arguments[key];for(i=0;i<rows.length;++i)for(colCnt=rows[i].cells.length,j=0;colCnt>j;++j)cell=rows[i].cells[j],cell.isMeta?cell[add?"addClass":"removeClass"]("drop"):cell[add?"addClass":"removeClass"]("locked")}else add=arguments[key]}}))({listSelector:".meta",listKey:function($el){return $el.find(".list").scope().list},itemSelector:".button-wrapper",itemDragSelector:".button-wrapper",itemKey:"header"},backendApi,grid,metaGhostHeaders,layout,$id,currentPopover)}}]}qvangular.provider("qvPivotTablePivoting",PivotingProvider)}),define("extensions.qliktech/pivot-table/snapshot/snapshot-helper",[],function(){function getSnapshotScrollAreaBBox($scrollArea,snapshotObject){var bbox=$scrollArea[0].getBoundingClientRect();return snapshotObject&&!snapshotObject.freeResize?{height:snapshotObject.size.h,width:snapshotObject.size.w,top:bbox.top,left:bbox.left}:bbox}return{getSnapshotScrollAreaBBox:getSnapshotScrollAreaBBox}}),define("extensions.qliktech/pivot-table/viewport-provider",["qvangular","extensions.qliktech/pivot-table/snapshot/snapshot-helper"],function(qvangular,PivotSnapshotHelper){"use strict";function PivotTableViewport($timeout,$element,minRowHeight,scrollAreaSelector,scrollContentSelector,multiSelectSelector,firstDataCellSelector,topHeadersSelector,snapshotData){var viewport,timeoutP,$scrollArea=$element.find(scrollAreaSelector),$scrollContent=$scrollArea.find(scrollContentSelector),$table=$scrollContent.find(multiSelectSelector);return viewport={minRowHeight:minRowHeight,rect:{left:0,top:0,width:0,height:0},scrollRect:{left:0,top:0,width:0,height:0},rowCount:0,getVirtualScrollController:function(){return $scrollArea.controller("qvScrollArea")},getSortableListController:function(){return $scrollArea.controller("qvSortableList")},getMultiSelectController:function(){return $table.controller("qvSelectionsMultiselect")},getFirstDataCell:function(){var $firstDataCell=$scrollArea.find(firstDataCellSelector);return $firstDataCell.length?$firstDataCell.position():{top:0,left:0}},getTopHeaders:function(){return $scrollArea.find(topHeadersSelector)},getScrollAreaBBox:function(){return snapshotData?PivotSnapshotHelper.getSnapshotScrollAreaBBox($scrollArea,snapshotData.object):$scrollArea[0].getBoundingClientRect()},getScrollAreaPosition:function(){return $scrollArea.position()},getScrollContentBBox:function(){return $scrollContent[0].getBoundingClientRect()},updateRowCount:function(rowCnt){viewport.rowCount=Math.ceil(rowCnt)},getMaxRowCount:function(){return Math.ceil(viewport.scrollRect.height/viewport.minRowHeight)},getVisibleRowCount:function(){function isRowVisible(row,scrollRect){var rowBottom=row.offsetTop+row.getBoundingClientRect().height,scrollBottom=scrollRect.top+scrollRect.height;return scrollBottom>=rowBottom}function getMidIx(minIx,maxIx){var range=maxIx-minIx;return 1===range?maxIx:Math.floor(minIx+range/2)}function findLastVisibleIx(rows,minIx,maxIx){var range=maxIx-minIx,midIx=getMidIx(minIx,maxIx),visible=isRowVisible(rows[midIx],viewport.scrollRect);return 0===range?visible?midIx:-1:1===range?visible?midIx:findLastVisibleIx(rows,minIx,minIx):visible?findLastVisibleIx(rows,midIx,maxIx):findLastVisibleIx(rows,minIx,midIx)}var firstRow,rows,firstCell=$element[0].querySelector(firstDataCellSelector);if(!firstCell)return 0;if(firstRow=firstCell.parentNode,rows=Array.prototype.slice.call(firstRow.parentNode.childNodes),rows=rows.filter(function(node){return node.nodeType===Node.ELEMENT_NODE}),rows=rows.splice(rows.indexOf(firstRow)),0===rows.length)return 0;var visibleCount=findLastVisibleIx(rows,0,rows.length-1)+1;if(visibleCount===rows.length){var row=rows[rows.length-1],extraPx=viewport.scrollRect.top+viewport.scrollRect.height-(row.offsetTop+row.getBoundingClientRect().height);visibleCount+=Math.floor(extraPx/(3*viewport.minRowHeight))}return visibleCount},updateRect:function(){return $timeout.cancel(timeoutP),timeoutP=$timeout(function(){var scrollAreaBBox=viewport.getScrollAreaBBox();viewport.rect.top=scrollAreaBBox.top,viewport.rect.left=scrollAreaBBox.left,viewport.rect.width=scrollAreaBBox.width,viewport.rect.height=scrollAreaBBox.height,viewport.updateRowCount(viewport.rect.height/minRowHeight)},!1)},updateScrollRect:function(updateScrollRect){return $timeout.cancel(timeoutP),timeoutP=$timeout(function(){var scrollAreaPos=viewport.getScrollAreaPosition(),firstDataCellPos=viewport.getFirstDataCell();viewport.scrollRect.top=scrollAreaPos.top+firstDataCellPos.top,viewport.scrollRect.left=firstDataCellPos.left,viewport.scrollRect.width=viewport.rect.width-firstDataCellPos.left,viewport.scrollRect.height=viewport.rect.height-firstDataCellPos.top,updateScrollRect&&(viewport.updateRowCount(viewport.collapsedRowCount||viewport.scrollRect.height/minRowHeight),delete viewport.collapsedRowCount)},!1)},getScrollRect:function(){return{top:viewport.scrollRect.top,left:viewport.scrollRect.left,width:viewport.scrollRect.width,height:viewport.scrollRect.height}}}}function PivotTableViewportFactory($timeout){return PivotTableViewport.bind(null,$timeout)}function PivotTableViewportProvider(){this.$get=["$timeout",PivotTableViewportFactory]}qvangular.provider("qvPivotTableViewportProvider",PivotTableViewportProvider)}),define("extensions.qliktech/pivot-table/virtual-scroll-provider",["qvangular"],function(qvangular){"use strict";function PivotTableVirtualScroll(viewport,dataColumnsInfo,qSize){function graduallyLeaveAlignToBottom(page){var maxRowCount=viewport.getMaxRowCount();alignToBottom.activeFromStart||(page.qHeight=Math.min(qSize.qcy-page.qTop,maxRowCount),viewport.updateRowCount(page.qHeight))}function getPage(vPos){return{qLeft:dataColumnsInfo.cnt>0?Math.round(vPos.vPosX/dataColumnsInfo.width):0,qTop:Math.round(vPos.vPosY/viewport.minRowHeight),qWidth:Math.max(1,dataColumnsInfo.cnt),qHeight:Math.max(1,viewport.rowCount)}}function adjustPageToBounds(page){page.qTop>0&&page.qTop+page.qHeight>qSize.qcy&&(page.qTop=Math.max(0,qSize.qcy-page.qHeight),page.qHeight=Math.min(qSize.qcy,page.qHeight)),page.qLeft>0&&page.qLeft+page.qWidth>qSize.qcx&&(page.qLeft=Math.max(0,qSize.qcx-page.qWidth),page.qWidth=Math.min(qSize.qcx,page.qWidth))}var dataCallback,virtualScroll,virtualScrollCtrl=viewport.getVirtualScrollController(),alignToBottom={active:!1,activeFromStart:!1},axisDelta={xAxis:0,yAxis:0};return virtualScroll={page:{qLeft:0,qTop:0,qWidth:0,qHeight:0},equalsPage:function(page){return this.page.qLeft===page.qLeft&&this.page.qTop===page.qTop&&this.page.qWidth===page.qWidth&&this.page.qHeight===page.qHeight},setPage:function(page){this.page.qLeft=page.qLeft,this.page.qTop=page.qTop,this.page.qWidth=page.qWidth,this.page.qHeight=page.qHeight},onGetData:function(fn){dataCallback=fn},setScrollViewport:function(){viewport.updateScrollRect(!1).then(function(){virtualScrollCtrl.setViewport(viewport.getScrollRect())})},setVirtualSize:function(){var self=this;viewport.updateScrollRect(!0).then(function(){var visibleRows,virtualPos,virtualSize,virtualWidth,virtualViewport;alignToBottom.active=!1,alignToBottom.activeFromStart=!1,viewport.scrollRect.top+viewport.scrollRect.height>=viewport.rect.height&&virtualScroll.page.qHeight>=qSize.qcy&&(visibleRows=viewport.getVisibleRowCount(),visibleRows<virtualScroll.page.qHeight&&(alignToBottom.active=!0,alignToBottom.activeFromStart=!0,viewport.updateRowCount(visibleRows))),virtualPos={vPosY:self.page.qTop*viewport.minRowHeight,vPosX:self.page.qLeft*dataColumnsInfo.width},virtualWidth=virtualScroll.page.qWidth===qSize.qcx?viewport.scrollRect.width:qSize.qcx*dataColumnsInfo.width,virtualSize={width:virtualWidth,height:qSize.qcy*viewport.minRowHeight},virtualViewport={width:viewport.scrollRect.width,height:viewport.rowCount*viewport.minRowHeight},virtualScrollCtrl.setVirtualSize(virtualSize,virtualViewport,viewport.getScrollRect()),(virtualPos.vPosY>0||virtualPos.vPosX>0)&&virtualScrollCtrl.scroll(virtualPos.vPosX,virtualPos.vPosY)})},alignToBottom:function(){var makeSureItsPossibleToScrollDown=!1;if(alignToBottom.active){if(axisDelta.yAxis>0){var visibleRowCount=viewport.getVisibleRowCount();visibleRowCount<viewport.rowCount&&viewport.updateRowCount(visibleRowCount)}else{var maxRowCount=viewport.getMaxRowCount();viewport.rowCount>=maxRowCount&&(alignToBottom.active=!1),makeSureItsPossibleToScrollDown=!0}virtualScrollCtrl.setVirtualViewport({width:viewport.scrollRect.width,height:viewport.rowCount*viewport.minRowHeight}),makeSureItsPossibleToScrollDown&&virtualScrollCtrl.setVirtualScrollPos(0,-1)}}},virtualScrollCtrl.onScroll(function(scrolledX,scrolledY){var vPos=virtualScrollCtrl.getVirtualPosition(),vPosMax=virtualScrollCtrl.getMaxPosition(),page=getPage(vPos);alignToBottom.active&&0>scrolledY&&(graduallyLeaveAlignToBottom(page),vPosMax=virtualScrollCtrl.getMaxPosition()),vPosMax.vPosY>0&&vPos.vPosY===vPosMax.vPosY&&(alignToBottom.active=!0),adjustPageToBounds(page),alignToBottom.lastTop=page.qTop,axisDelta.xAxis=scrolledX,axisDelta.yAxis=scrolledY,(!virtualScroll.equalsPage(page)||alignToBottom.active)&&(virtualScroll.setPage(page),dataCallback(virtualScroll.page).then(function(){virtualScroll.alignToBottom()}))}),virtualScrollCtrl.getScrollAmount=function(deltaX,deltaY,deltaMode){var vPos=virtualScrollCtrl.getVirtualPosition(),vMaxPos=virtualScrollCtrl.getMaxPosition();switch(deltaMode){case 1:return{deltaX:dataColumnsInfo.width*deltaX,deltaY:viewport.minRowHeight*deltaY};case 2:return{deltaX:dataColumnsInfo.cnt*dataColumnsInfo.width*deltaX,deltaY:viewport.minRowHeight*viewport.rowCount*deltaY};case 10:return{deltaX:0,deltaY:deltaY>0?vPos.vPosY*deltaY:vPos.vPosY-vMaxPos.vPosY};default:return{deltaX:deltaX,deltaY:deltaY}}},virtualScroll}function PivotTableVirtualScrollFactory(){return PivotTableVirtualScroll}function PivotTableVirtualScrollProvider(){this.$get=[PivotTableVirtualScrollFactory]}qvangular.provider("qvPivotTableVirtualScrollProvider",PivotTableVirtualScrollProvider)}),define("extensions.qliktech/pivot-table/selections-provider",["qvangular","jquery","objects.utils/event-utils"],function(qvangular,$,EventUtils){"use strict";function PivotTableSelections(selectionService,dataService,$scope,selectionsApi,backendApi,grid,layout,sortableListCtrl){function updateLocked(grid,currentCell){var rows,rowCnt,cell,cellCnt,siblings,isSibling,i,cells=[],selectionCnt=selections.dataValuesArray.length;for(rows=grid.getRowsByCellType(grid.CELL_TYPE_TOP).concat(grid.getRowsByCellType(grid.CELL_TYPE_LEFT)),siblings=selectionCnt>0?dataService.getSiblingCells(grid,currentCell):[],rowCnt=rows.length,i=0;rowCnt>i;++i)cells=cells.concat(rows[i].cells);for(cellCnt=cells.length,i=0;cellCnt>i;++i)cell=cells[i],isSibling=-1!==siblings.indexOf(cell),(isSibling&&!cell.isDimensionValue||!isSibling&&!cell.isMeta)&&selectionService[selectionCnt?"lockCell":"unlockCell"](grid,cell)}function updateSelections(){selections.active&&(selectionService.updatePivot(grid,selections,selections.currentCell),updateLocked(grid,selections.currentCell))}function confirmSelections(){sortableListCtrl.on(),unbindKeyboardFn&&unbindKeyboardFn()}function cancelSelections(){sortableListCtrl.on(),unbindKeyboardFn&&unbindKeyboardFn()}function clearSelections(){selections.active&&selections.currentCell&&(dataService.getSiblingCells(grid,selections.currentCell).forEach(function(cell){selectionService.deselectCell(grid,cell)}),updateLocked(grid,selections.currentCell))}var unbindKeyboardFn,selections=selectionService.$new();return $scope.excludeDimensionToggle=function($event){return!selectionsApi.active&&$($event.target).is(".qv-pt-expandable")},$scope.selectDimensionValue=function(cell,$event){var toggle=selectionsApi.getKeyAsToggleSelected($event);toggle||(clearSelections(),selectionService.reset(selections)),unbindKeyboardFn=selectionService.selectDimensionValue($scope.$id,backendApi,selectionsApi,selections,cell,grid,toggle),updateLocked(grid,selections.currentCell)},$scope.activateSelections=function(cell){unbindKeyboardFn=selectionService.activateSelections($scope.$id,backendApi,selectionsApi,selections,cell)},$scope.multiselectDimensionValues=function(startCell,currentCell){var i,dataIx,cell,ixInRange,cells=dataService.getSiblingCells(grid,startCell),cellCnt=cells.length,isColumnar=selectionService.isColumnar(grid,startCell),startIx=isColumnar?startCell.dataRowIx:startCell.dataColIx,currentIx=isColumnar?currentCell.dataRowIx:currentCell.dataColIx;if(-1!==cells.indexOf(currentCell)&&currentCell.isDimensionValue){for(i=0;cellCnt>i;++i)cell=cells[i],dataIx=isColumnar?cell.dataRowIx:cell.dataColIx,ixInRange=currentIx>=startIx?dataIx>=startIx&&currentIx>=dataIx:dataIx>=currentIx&&startIx>=dataIx,ixInRange&&cell.isDimensionValue&&cell!==currentCell&&selectionService.selectDimensionCells(backendApi,selectionsApi,selections,$scope.grid,cell,!1);selectionService.selectDimensionCells(backendApi,selectionsApi,selections,$scope.grid,currentCell,!1),updateLocked(grid,selections.currentCell)}},$scope.multiselect=function(){selections.active&&selectionService.sendSelection(backendApi,selectionsApi,selections,grid,selections.currentCell)},$scope.selectWhileLocked=function(){selections.dataValuesArray.length>0||EventUtils.showLockedFeedback(layout.qHyperCube.qDimensionInfo)},selectionsApi.watchActivated(function(){sortableListCtrl.off()}),selectionService.init(selectionsApi,backendApi,selections,confirmSelections,cancelSelections,clearSelections),{updateSelections:updateSelections}}function PivotTableSelectionsFactory(selectionService,dataService){return PivotTableSelections.bind(null,selectionService,dataService)}function PivotTableSelectionsProvider(){this.$get=["qvGridObjectSelectionService","qvGridObjectDataService",PivotTableSelectionsFactory]}qvangular.provider("qvPivotTableSelectionsProvider",PivotTableSelectionsProvider)}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel.ng.html",[],function(){return'<div class="qv-pivot-panel"\r\n	 qv-sortable-list="sortableItemLists">\r\n	<div class="qv-pivot-panel-row" ng-repeat="row in grid.rows">\r\n		<div class="qv-pivot-panel-column" ng-if="$first"></div>\r\n		<div ng-repeat="list in row.lists" class="qv-pivot-panel-column" ng-class="{\'qv-pivot-panel-disabled\': list.disabled}">\r\n			<h2>{{list.title}}</h2>\r\n			<div class="qv-pivot-panel-list">\r\n				<ul>\r\n					<li ng-repeat="item in list.items track by item.id" class="qv-pivot-panel-item" ng-class="item.classList" ng-include src="itemTemplateSrc"></li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel-item.ng.html",[],function(){return'<div class="field-wrapper field-token" ng-style="item.style">\r\n	<div ng-if="list.showMoveHandle" class="icon-handle"></div>\r\n	<div class="field-text">{{item.title}}</div>\r\n</div>\r\n'}),define("extensions.qliktech/pivot-table/pivot-panel/pivot-panel",["jquery","qvangular","text!./pivot-panel.ng.html","text!./pivot-panel-item.ng.html","ng!$templateCache","general.sortable/sortable-item-lists","translator","general.sortable/sortable-list"],function($,qvangular,template,itemTemplate,$templateCache,SortableItemLists,translator){var ItemType={Dimension:"dimension",Measure:"measure",Pseudo:"pseudo"};$templateCache.put("pivot-panel-item.ng.html",itemTemplate),qvangular.directive("qvPivotPanel2",function(){return{restrict:"E",template:template,replace:!0,scope:{layout:"=layout",backendApi:"=backendApi"},controller:["$scope","$element",function($scope,$element){function dimensionTitle(dimension){var title;return title=dimension.qLibraryId?dimension.title||"":dimension.qFallbackTitle||""}function update(){var dimensions,leftDimCount=$scope.layout.qHyperCube.qNoOfLeftDims;$scope.sortableItemLists.reset(),dimensions=$scope.layout.qHyperCube.qEffectiveInterColumnSortOrder.map(function(dimIndex){var dim;return $scope.$broadcast("pivotPanelUpdated"),-1===dimIndex?{title:"Measures",cId:"pseudo-dimension",type:ItemType.Pseudo,dimIndex:dimIndex,cssClass:["sortable","is-pseudo"]}:(dim=$scope.layout.qHyperCube.qDimensionInfo[dimIndex],{title:dimensionTitle(dim),cId:dim.cId,type:ItemType.Dimension,dimIndex:dimIndex,cssClass:["sortable"]})}),leftDimCount=0>leftDimCount?dimensions.length:leftDimCount,dimensions.splice(0,leftDimCount).forEach(function(item){var sortableListItem=$scope.rows.add(item.title,item.cId,item.cssClass,1);sortableListItem.dimIndex=item.dimIndex}),dimensions.forEach(function(item){var sortableListItem=$scope.columns.add(item.title,item.cId,item.cssClass,1);sortableListItem.dimIndex=item.dimIndex}),$scope.layout.qHyperCube.qMeasureInfo.forEach(function(measure){$scope.measures.add(measure.qFallbackTitle||"",measure.cId,[],2)})}var ctrl=this;$scope.itemTemplateSrc="pivot-panel-item.ng.html",$scope.sortableItemLists=SortableItemLists.create({options:{listKey:"list",listSelector:".qv-pivot-panel-column",itemSelector:".sortable",itemDragSelector:".icon-handle",itemKey:"item"},addPlaceholder:function(){var placeholder=this._super.apply(this,arguments);placeholder.addClass("sortable")},bindAutoScroll:function(){var $lists=$element.find(".qv-pivot-panel-list ul");$lists.each(function(){var $list=$(this),list=$list.scope().list;list.scrollInfo={elem:$list[0],clientRect:$list[0].getBoundingClientRect(),scrollWidth:$list[0].scrollWidth,scrollHeight:$list[0].scrollHeight}})},onBegin:function(){this._super.apply(this,arguments),this.bindAutoScroll()},onEnterList:function(){this.bindAutoScroll()},onMove:function(){this._super.apply(this,arguments),ctrl.sortOrderUpdated()},onMoveToList:function(fromItem,toList){this._super.apply(this,arguments),toList.disabled||ctrl.sortOrderUpdated()},onAutoScroll:function(defaultScrollFn,enterList,enterItem,autoScrollFn){if(this._super.apply(this,arguments),!enterList&&enterItem&&(enterList=this.getList(enterItem)),enterList){var scrollInfo=enterList.scrollInfo;autoScrollFn(scrollInfo.elem,scrollInfo.clientRect,scrollInfo.scrollWidth,scrollInfo.scrollHeight)}}}),$scope.columns=$scope.sortableItemLists.createList(1,{title:translator.get("Common.Columns"),showMoveHandle:!0}),$scope.rows=$scope.sortableItemLists.createList(1,{title:translator.get("Common.Rows"),showMoveHandle:!0}),$scope.measures=$scope.sortableItemLists.createList(2,{title:translator.get("Common.Measures")}),$scope.grid={rows:[]},$scope.grid.rows.push({lists:[$scope.columns]}),$scope.grid.rows.push({lists:[$scope.rows,$scope.measures]}),ctrl.sortOrderUpdated=function(){var noLeftDims,columnOrder=[];$scope.rows.items.forEach(function(item){columnOrder.push(item.dimIndex)}),noLeftDims=columnOrder.length,$scope.columns.items.forEach(function(item){columnOrder.push(item.dimIndex)});var params=[[],!0];params[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(columnOrder)},params[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(noLeftDims)},$scope.backendApi.applyPatches(params)},$scope.$watchCollection("layout.qHyperCube.qDimensionInfo",update),$scope.$watchCollection("layout.qHyperCube.qEffectiveInterColumnSortOrder",update),$scope.$watchCollection("layout.qHyperCube.qMeasureInfo",update),$scope.$watchCollection("layout.qHyperCube.qNoOfLeftDims",update)}]}})}),define("extensions.qliktech/pivot-table/pivot-table",["qvangular","jquery","objects.backend-api/pivot-api","extensions.qliktech/pivot-table/pivot-table-properties","extensions.qliktech/pivot-table/pivot-hypercube-handler","objects.extension/object-conversion","general.utils/property-mapper","text!./pivot-table.ng.html","text!./cell-item.ng.html","text!./header-cell-item.ng.html","text!./meta/meta-left.ng.html","text!./meta/meta-top.ng.html","text!./meta/meta-list.ng.html","text!./meta/meta-item.ng.html","ng!$templateCache","general.utils/support","core.utils/deferred","objects.grid/data-grid-provider","./meta/ghost-headers-provider","./meta/pivoting-provider","./viewport-provider","./virtual-scroll-provider","./selections-provider","general.scroll/scroll-area","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/pivot-table/pivot-panel/pivot-panel"],function(qvangular,$,PivotApi,propertiesDefinition,PivotHypercubeHandler,objectConversion,propertyMapper,template,cellItemTemplate,cellHeaderItemTemplate,metaLeftTemplate,metaTopTemplate,metaListTemplate,metaItemTemplate,$templateCache,support,Deferred){"use strict";function PivotTableFactory(grid,dataService,listboxPopoverService,pivotingProvider,metaGhostHeadersProvider,viewportProvider,virtualScrollProvider,selectionsProvider,$timeout){function PivotTableLinkFn($scope,$element,$attrs,objectCtrl){var virtualScrollCtrl,sortableListCtrl,multiSelectCtrl,updateScrollViewportTimeout,currentState;$scope.currentPopover={header:void 0},$scope.nonMouseViewportScrolling={scrollbarSize:36,className:"show-non-mouse-scrollbars"},$scope.grid=grid("pivot"),$scope.viewport=viewportProvider($element,support.treatAsDesktop()?21:31,".qv-grid-object-scroll-area",".scroll-content","table",".first-data-cell","th.top:nth-child(2)",$scope.layout.snapshotData),virtualScrollCtrl=$scope.viewport.getVirtualScrollController(),sortableListCtrl=$scope.viewport.getSortableListController(),multiSelectCtrl=$scope.viewport.getMultiSelectController(),$scope.metaGhostHeaders=metaGhostHeadersProvider({},$scope.layout,$scope.viewport.rect),$scope.pivoting=pivotingProvider($scope.backendApi,$scope.grid,$scope.metaGhostHeaders,$scope.layout,$scope.$id,$scope.currentPopover,virtualScrollCtrl,multiSelectCtrl),$scope.selections=selectionsProvider($scope,$scope.selectionsApi,$scope.backendApi,$scope.grid,$scope.layout,sortableListCtrl),$scope.virtualScroll=virtualScrollProvider($scope.viewport,$scope.metaGhostHeaders.dataColumnsInfo,$scope.layout.qHyperCube.qSize),$scope.virtualScroll.onGetData(function(page){return $scope.getData(page,!0).then(function(){$timeout.cancel(updateScrollViewportTimeout),updateScrollViewportTimeout=$timeout(function(){$scope.virtualScroll.setScrollViewport()},100)})}),$scope.getData=function(page,keepClasses){var dfd=Deferred();return $scope.backendApi.getData([page]).then(function(dataPages){$scope.onUpdateData(dataPages,page,keepClasses).then(function(){dfd.resolve()})}),dfd.promise},$scope.onUpdateData=function(dataPages,dataRect,keepClasses){return dataService.updatePivotItems($scope,dataPages,[dataRect],keepClasses),$scope.selections.updateSelections(),$timeout(function(){},0,!1)},$scope.process=function(page){return $scope.virtualScroll.setPage(page),$scope.getData(page).then(function(){$scope.virtualScroll.setVirtualSize()})},$scope.processPaint=function(){return $scope.updateMetaInfo().then(function(size){var lep=$scope.layout.qHyperCube.qLastExpandedPos,wasExpanded=lep&&void 0!==$scope.expandedPosDiffX&&void 0!==$scope.expandedPosDiffY,page={qLeft:Math.max(0,wasExpanded?lep.qx-$scope.expandedPosDiffX:0),qTop:Math.max(0,wasExpanded?lep.qy-$scope.expandedPosDiffY:0),qWidth:size.qWidth,qHeight:size.qHeight};if(lep&&page.qLeft+page.qWidth>$scope.layout.qHyperCube.qSize.qcx&&(page.qLeft=Math.max(0,$scope.layout.qHyperCube.qSize.qcx-size.qWidth)),lep&&$scope.collapsed&&page.qTop+page.qHeight>$scope.layout.qHyperCube.qSize.qcy){var visibleRows=$scope.viewport.getVisibleRowCount();$scope.viewport.collapsedRowCount=visibleRows,page.qTop=Math.max(0,$scope.layout.qHyperCube.qSize.qcy-visibleRows),page.qHeight=visibleRows}return delete $scope.expandedPosDiffX,delete $scope.expandedPosDiffY,delete $scope.collapsed,$scope.process(page)})},$scope.processResize=function(){return $scope.updateMetaInfo().then(function(size){var cubeSize=$scope.layout.qHyperCube.qSize,page={qLeft:$scope.virtualScroll.page.qLeft,qTop:$scope.virtualScroll.page.qTop,qWidth:size.qWidth,qHeight:size.qHeight};return page.qTop+page.qHeight>cubeSize.qcy&&(page.qTop=Math.max(0,cubeSize.qcy-page.qHeight)),page.qLeft+page.qWidth>cubeSize.qcx&&(page.qLeft=Math.max(0,cubeSize.qcx-page.qWidth)),$scope.process(page)})},$scope.updateMetaInfo=function(){return $scope.viewport.updateRect().then(function(){return $scope.metaGhostHeaders.update(0,dataService.getLeftTreeDepth($scope.layout.qHyperCube.qPivotDataPages[0])),$scope.pivoting.update($scope.metaGhostHeaders.totLeftGlyphCnt,$scope.metaGhostHeaders.opts.glyphWidth,$scope.metaGhostHeaders.dataColumnsInfo.cnt,$scope.metaGhostHeaders.dataColumnsInfo.width),{qWidth:Math.max(1,$scope.metaGhostHeaders.dataColumnsInfo.cnt),qHeight:Math.max(1,$scope.viewport.rowCount)}})},$scope.collapseExpand=function($event){var cell,$cell=$($event.target);cell=$cell.scope().cell,cell&&($scope.expandedPosDiffX=cell.dataColIx-$scope.virtualScroll.page.qLeft,$scope.expandedPosDiffY=cell.dataRowIx-$scope.virtualScroll.page.qTop,"icon-add"===cell.collapseExpandClass?cell.hasClass("top")?$scope.backendApi.expandTop(cell.dataRowIx,cell.dataColIx,!1):cell.hasClass("left")&&$scope.backendApi.expandLeft(cell.dataRowIx,cell.dataColIx,!1):"icon-remove"===cell.collapseExpandClass&&($scope.collapsed=!0,cell.hasClass("top")?$scope.backendApi.collapseTop(cell.dataRowIx,cell.dataColIx,!1):cell.hasClass("left")&&$scope.backendApi.collapseLeft(cell.dataRowIx,cell.dataColIx,!1)))},$scope.showDimension=function($event,header){var $alignTo=$($event.target).closest(".qv-pt-meta-button");return sortableListCtrl.off(),$scope.currentPopover.header===header?(header.open=!1,$scope.currentPopover.header=void 0,listboxPopoverService.close(),void $scope.processPaint()):($scope.currentPopover.header&&($scope.currentPopover.header.open=!1,$scope.currentPopover.header=void 0),listboxPopoverService.showField(header.fieldName,$scope.backendApi.model.session.currentApp,{$alignToElement:$alignTo,qvaOutsideIgnoreFor:"qv-pt-meta-header-"+$scope.$id,collision:"flipfit"},null,function(){$scope.currentPopover.header=void 0,$scope.updateMetaInfo(),sortableListCtrl.on(),$scope.processPaint();
}),header.open=!0,void($scope.currentPopover.header=header))};var onOffFn=function(on){on?(virtualScrollCtrl.on(),sortableListCtrl.on(),$scope.interactive=!0):(virtualScrollCtrl.off(),sortableListCtrl.off(),$scope.interactive=!1)};objectCtrl.addChildController({setInteraction:function(on){on&&(on=this.allowInteraction(currentState)),onOffFn(on)},onStateChanged:function(state){currentState=state,onOffFn(this.allowInteraction(currentState))},onPaint:function(){return this.$scope.selectionsApi.active||void 0!==this.$scope.currentPopover.header?Deferred.resolve():(sortableListCtrl.cancel(),$scope.processPaint())},onResize:function(){return $scope.processResize()},setSnapshotData:function(snapshotLayout){var area=$scope.virtualScroll.page;return $scope.backendApi.getData([area]).then(function(qPivotDataPages){return $scope.backendApi.isSnapshot||(qPivotDataPages[0].qArea.qTop=0,qPivotDataPages[0].qArea.qLeft=0,snapshotLayout.qHyperCube.qSize.qcx=area.qWidth,snapshotLayout.qHyperCube.qSize.qcy=area.qHeight),snapshotLayout.qHyperCube.qPivotDataPages=qPivotDataPages,snapshotLayout})}},$scope)}return{restrict:"E",replace:!0,template:template,require:"^qvObject",link:PivotTableLinkFn}}return $templateCache.put("pt-cell-item.ng.html",cellItemTemplate),$templateCache.put("pt-header-cell-item.ng.html",cellHeaderItemTemplate),$templateCache.put("pt-meta-left.ng.html",metaLeftTemplate),$templateCache.put("pt-meta-top.ng.html",metaTopTemplate),$templateCache.put("pt-meta-list.ng.html",metaListTemplate),$templateCache.put("pt-meta-item.ng.html",metaItemTemplate),qvangular.directive("qvPivotTableInclude",["$compile","$animate",function($compile,$animate){return{link:function($scope,$element,$attrs){$animate.enabled(!1,$element),$scope.$watch($attrs.qvPivotTableInclude,function(){var templateSrc=$scope.$eval($attrs.qvPivotTableInclude),itemTemplate=$templateCache.get(templateSrc);$element.html(itemTemplate),$compile($element.contents())($scope)})}}}]),qvangular.directive("qvPivotTable",["qvDataGrid","qvGridObjectDataService","qvListboxPopoverService","qvPivotTablePivoting","qvPivotTableMetaGhostHeadersProvider","qvPivotTableViewportProvider","qvPivotTableVirtualScrollProvider","qvPivotTableSelectionsProvider","$timeout",PivotTableFactory]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"P",qShowTotalsAbove:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:50,qHeight:50}],qIndentMode:!0}},data:{dimensions:{min:1,max:1e3},measures:{min:1,max:1e3}},getCreatePropertyHandler:function(){var dimensionProperties=propertyMapper.mapProperties(this.mappedDefinition.items.data.items.dimensions),measureProperties=propertyMapper.mapProperties(this.mappedDefinition.items.data.items.measures);return new PivotHypercubeHandler(this.dimensionDefinition,this.measureDefinition,dimensionProperties,measureProperties)},snapshot:{canTakeSnapshot:!0},type:"pivot-table",template:"<qv-pivot-table></qv-pivot-table>",BackendApi:PivotApi,definition:propertiesDefinition,importProperties:objectConversion.pivotChart.importProperties.bind(objectConversion),exportProperties:objectConversion.pivotChart.exportProperties.bind(objectConversion)}}),define("qwidget.model/widget-file",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(Deferred,qvangular){function loadFile(filename,force){return qvangular.getService("$contentApi").request({method:"GET",url:"/extensions/"+filename+(force?"?"+(new Date).getTime():""),cache:!1,transformResponse:function(data){return data}})}function saveFile(fileName,data,lastModified){var dfr=new Deferred;if(lastModified)return loadFile(fileName).success(function(reply,status,headers){headers("last-modified")!==lastModified?dfr.reject():saveFile(fileName,data).then(function(){dfr.resolve()})}),dfr.promise;var strarr=fileName.split("/");return qvangular.getService("$contentApi").request({method:"POST",url:"/qrs/extension/"+strarr[0]+"/uploadfile?externalpath="+strarr[1]+"&overwrite=true",data:data}).success(function(){dfr.resolve()}).error(function(msg){dfr.reject(msg)}),dfr.promise}function deleteFile(filename){var dfr=new Deferred,strarr=filename.split("/");return qvangular.getService("$contentApi").request({method:"DELETE",url:"/qrs/extension/"+strarr[0]+"/deletecontent?externalpath="+strarr[1]}).success(function(){dfr.resolve()}).error(function(msg){dfr.reject(msg)}),dfr.promise}return{loadFile:loadFile,saveFile:saveFile,deleteFile:deleteFile}}),define("qwidget.model/widget-library",["core.utils/deferred","general.models/library/extension-list","./widget-file"],function(Deferred,ExtensionList,widgetFile){var listdfd,libraryList=[],WidgetLibrary=function(libid,data){Object.defineProperties(this,{libid:{value:libid,configurable:!0,writable:!0},data:{value:data,configurable:!0,writable:!0}}),data.type="widget-library"};return WidgetLibrary.prototype.save=function(){return widgetFile.saveFile(this.libid+"/"+this.libid+".qext",JSON.stringify(this.data))},WidgetLibrary.prototype.addTemplate=function(template){this.data.widgets||(this.data.widgets=[]),this.data.widgets.push(template.id),this.save()},WidgetLibrary.prototype.removeTemplate=function(id){this.data.widgets&&(this.data.widgets=this.data.widgets.filter(function(templateId){return templateId!==id}),this.save())},WidgetLibrary.prototype["delete"]=function(){var dfr=new Deferred,me=this,filename=me.id+"/"+me.id;return widgetFile.deleteFile(filename+".qext").then(function(){dfr.resolve()},function(){dfr.reject()}),dfr.promise},WidgetLibrary.getList=function(){return listdfd||(listdfd=new Deferred,ExtensionList.getList().then(function(list){list.forEach(function(entry){"widget-library"===entry.data.type&&libraryList.push(new WidgetLibrary(entry.id,entry.data))}),listdfd.resolve(libraryList)})),listdfd.promise},WidgetLibrary.get=function(libid){var dfd=new Deferred;return WidgetLibrary.getList().then(function(){var lib;libraryList.forEach(function(entry){entry.libid===libid&&(lib=entry)}),lib?dfd.resolve(lib):dfd.reject()}),dfd.promise},WidgetLibrary.isEnabled=function(){var dfd=new Deferred;return WidgetLibrary.getList().then(function(){dfd.resolve(libraryList.length>0)}),dfd.promise},WidgetLibrary}),define("qwidget.model/widget-template",["core.utils/deferred","./widget-library","./widget-file","core.utils/notification"],function(Deferred,WidgetLibrary,widgetFile,Notification){function noScript(s){var div=document.createElement("div");div.innerHTML=s;for(var scripts=div.getElementsByTagName("script"),i=scripts.length;i--;)scripts[i].parentNode.removeChild(scripts[i]);return s=div.innerHTML}function addToTemplateList(data){var pos;templateList.forEach(function(t,index){data.id===t.id&&data.libid===t.libid&&(pos=index)}),pos?templateList[pos]=data:templateList.push(data),loadedTemplates[data.libid+"/"+data.id]=data}function createTemplateLoader(filename,libid,id){var dfd=new Deferred;return widgetFile.loadFile(filename+".json",!0).success(function(reply,status,headers){var data=JSON.parse(reply),templ=new WidgetTemplate(libid,id,data.name||id,data.properties);templ.lastModified=headers("last-modified"),addToTemplateList(templ),dfd.resolve(templ)}),dfd.promise}var listdfd,templateList=[],templateLoaders=[],loadedTemplates=[],WidgetTemplate=function(libid,id,name,props){this._version=0,Object.defineProperties(this,{libid:{value:libid},id:{value:id},name:{value:name,configurable:!0,writable:!0},html:{get:function(){return this._html},set:function(newValue){this._html=newValue,this._version++}},css:{get:function(){return this._css},set:function(newValue){this._css=newValue,this._version++}},properties:{value:props,configurable:!0,writable:!0},version:{get:function(){return this._version}},isLoaded:{get:function(){return void 0!==this._html}}})};WidgetTemplate.prototype.load=function(){if(!this.loadDfd){this.loadDfd=new Deferred;var me=this,filename=this.libid+"/"+this.id;widgetFile.loadFile(filename+".html",!0).success(function(reply){var html=noScript(reply);widgetFile.loadFile(filename+".css",!0).success(function(reply){me.css=reply,me.html=html,me.loadDfd.resolve()})})}return this.loadDfd.promise},WidgetTemplate.prototype.save=function(){var dfr=new Deferred,me=this,filename=me.libid+"/"+me.id;return widgetFile.saveFile(filename+".json",JSON.stringify({name:me.name,properties:me.properties}),me.lastModified).then(function(){widgetFile.saveFile(filename+".html",me.html),widgetFile.saveFile(filename+".css",me.css),me.lastModified||WidgetLibrary.get(me.libid).then(function(lib){lib.addTemplate(me)}),widgetFile.loadFile(filename+".json",!0).success(function(reply,status,headers){me.lastModified=headers("last-modified")}),WidgetTemplate.Updated.emit(templateList),dfr.resolve()},function(){dfr.reject()}),dfr.promise},WidgetTemplate.prototype.copy=function(data){return WidgetTemplate.add({libid:data.libid||this.libid,id:data.id,name:data.name||this.name,html:data.html||this.html,css:data.css||this.css,properties:data.properties||this.properties})},WidgetTemplate.prototype["delete"]=function(){var dfr=new Deferred,me=this,filename=me.libid+"/"+me.id;return widgetFile.deleteFile(filename+".json").then(function(){WidgetLibrary.get(me.libid).then(function(lib){lib.removeTemplate(me.id)}),widgetFile.deleteFile(filename+".html"),widgetFile.deleteFile(filename+".css"),delete templateLoaders[filename],templateList.forEach(function(value,index){value.id===me.id&&value.libid===me.libid&&delete templateList[index]}),WidgetTemplate.Updated.emit(templateList),dfr.resolve()},function(){dfr.reject()}),dfr.promise};var loadLibrary=function(library){var libid=library.libid,libdfd=new Deferred,mydfds=[];return library.data.widgets&&library.data.widgets.forEach(function(val){mydfds.push(WidgetTemplate.get(libid,val,!0))}),Deferred.all(mydfds).then(function(){libdfd.resolve()}),libdfd.promise};return WidgetTemplate.getTemplateList=function(force){var mydfds=[];return(!listdfd||force)&&(listdfd=new Deferred,WidgetLibrary.getList().then(function(list){list.forEach(function(entry){mydfds.push(loadLibrary(entry))}),Deferred.all(mydfds).then(function(){listdfd.resolve(templateList)})})),listdfd.promise},WidgetTemplate.getLoaded=function(templateId){return loadedTemplates[templateId]},WidgetTemplate.get=function(libid,id,metaonly){if(!id){var strarr=libid.split("/");libid=strarr[0],id=strarr[1]}var filename=libid+"/"+id,dfd=new Deferred;return templateLoaders[filename]||(templateLoaders[filename]=createTemplateLoader(filename,libid,id)),templateLoaders[filename].then(function(templ){templ.isLoaded||metaonly?dfd.resolve(templ):templ.load().then(function(){dfd.resolve(templ)})}),dfd.promise},WidgetTemplate.add=function(template){if(!template.id||!template.libid)return!1;var templ=new WidgetTemplate(template.libid,template.id,template.name||"",template.properties);templ.html=template.html||"",templ.css=template.css,addToTemplateList(templ);var filename=template.libid+"/"+template.id;if(!templateLoaders[filename]){var dfd=new Deferred;templateLoaders[filename]=dfd.promise,dfd.resolve(templ)}return WidgetTemplate.Updated.emit(templateList),templ},Notification.create(WidgetTemplate,"Updated"),WidgetTemplate}),/*!
 * Less - Leaner CSS v2.4.0
 * http://lesscss.org
 *
 * Copyright (c) 2009-2015, Alexis Sellier <self@cloudhead.net>
 * Licensed under the Apache v2 License.
 *
 */
/** * @license Apache v2
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("assets/external/less/less",[],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.less=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var addDataAttr=require("./utils").addDataAttr,browser=require("./browser");module.exports=function(window,options){addDataAttr(options,browser.currentScript(window)),void 0===options.isFileProtocol&&(options.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(window.location.protocol)),options.async=options.async||!1,options.fileAsync=options.fileAsync||!1,options.poll=options.poll||(options.isFileProtocol?1e3:1500),options.env=options.env||("127.0.0.1"==window.location.hostname||"0.0.0.0"==window.location.hostname||"localhost"==window.location.hostname||window.location.port&&window.location.port.length>0||options.isFileProtocol?"development":"production");var dumpLineNumbers=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(window.location.hash);dumpLineNumbers&&(options.dumpLineNumbers=dumpLineNumbers[1]),void 0===options.useFileCache&&(options.useFileCache=!0),void 0===options.onReady&&(options.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(require,module,exports){require("promise/polyfill.js");var options=window.less||{};require("./add-default-options")(window,options);var less=module.exports=require("./index")(window,options);options.onReady&&(/!watch/.test(window.location.hash)&&less.watch(),less.pageLoadFinished=less.registerStylesheets().then(function(){return less.refresh("development"===less.env)}))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":"promise/polyfill.js"}],3:[function(require,module,exports){var utils=require("./utils");module.exports={createCSS:function(document,styles,sheet){var href=sheet.href||"",id="less:"+(sheet.title||utils.extractId(href)),oldStyleNode=document.getElementById(id),keepOldStyleNode=!1,styleNode=document.createElement("style");styleNode.setAttribute("type","text/css"),sheet.media&&styleNode.setAttribute("media",sheet.media),styleNode.id=id,styleNode.styleSheet||(styleNode.appendChild(document.createTextNode(styles)),keepOldStyleNode=null!==oldStyleNode&&oldStyleNode.childNodes.length>0&&styleNode.childNodes.length>0&&oldStyleNode.firstChild.nodeValue===styleNode.firstChild.nodeValue);var head=document.getElementsByTagName("head")[0];if(null===oldStyleNode||keepOldStyleNode===!1){var nextEl=sheet&&sheet.nextSibling||null;nextEl?nextEl.parentNode.insertBefore(styleNode,nextEl):head.appendChild(styleNode)}if(oldStyleNode&&keepOldStyleNode===!1&&oldStyleNode.parentNode.removeChild(oldStyleNode),styleNode.styleSheet)try{styleNode.styleSheet.cssText=styles}catch(e){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(window){var document=window.document;return document.currentScript||function(){var scripts=document.getElementsByTagName("script");return scripts[scripts.length-1]}()}}},{"./utils":9}],4:[function(require,module,exports){module.exports=function(window,options,logger){var cache=null;if("development"!==options.env)try{cache="undefined"==typeof window.localStorage?null:window.localStorage}catch(_){}return{setCSS:function(path,lastModified,styles){if(cache){logger.info("saving "+path+" to cache.");try{cache.setItem(path,styles),cache.setItem(path+":timestamp",lastModified)}catch(e){logger.error('failed to save "'+path+'" to local storage for caching.')}}},getCSS:function(path,webInfo){var css=cache&&cache.getItem(path),timestamp=cache&&cache.getItem(path+":timestamp");return timestamp&&webInfo.lastModified&&new Date(webInfo.lastModified).valueOf()===new Date(timestamp).valueOf()?css:void 0}}}},{}],5:[function(require,module,exports){var utils=require("./utils"),browser=require("./browser");module.exports=function(window,less,options){function errorHTML(e,rootHref){var timer,content,id="less-error-message:"+utils.extractId(rootHref||""),template='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',elem=window.document.createElement("div"),errors=[],filename=e.filename||rootHref,filenameNoPath=filename.match(/([^\/]+(\?.*)?)$/)[1];elem.id=id,elem.className="less-error-message",content="<h3>"+(e.type||"Syntax")+"Error: "+(e.message||"There is an error in your .less file")+'</h3><p>in <a href="'+filename+'">'+filenameNoPath+"</a> ";var errorline=function(e,i,classname){void 0!==e.extract[i]&&errors.push(template.replace(/\{line\}/,(parseInt(e.line,10)||0)+(i-1)).replace(/\{class\}/,classname).replace(/\{content\}/,e.extract[i]))};e.extract&&(errorline(e,0,""),errorline(e,1,"line"),errorline(e,2,""),content+="on line "+e.line+", column "+(e.column+1)+":</p><ul>"+errors.join("")+"</ul>"),e.stack&&(e.extract||options.logLevel>=4)&&(content+="<br/>Stack Trace</br />"+e.stack.split("\n").slice(1).join("<br/>")),elem.innerHTML=content,browser.createCSS(window.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),elem.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===options.env&&(timer=setInterval(function(){var document=window.document,body=document.body;body&&(document.getElementById(id)?body.replaceChild(elem,document.getElementById(id)):body.insertBefore(elem,body.firstChild),clearInterval(timer))},10))}function error(e,rootHref){options.errorReporting&&"html"!==options.errorReporting?"console"===options.errorReporting?errorConsole(e,rootHref):"function"==typeof options.errorReporting&&options.errorReporting("add",e,rootHref):errorHTML(e,rootHref)}function removeErrorHTML(path){var node=window.document.getElementById("less-error-message:"+utils.extractId(path));node&&node.parentNode.removeChild(node)}function removeErrorConsole(path){}function removeError(path){options.errorReporting&&"html"!==options.errorReporting?"console"===options.errorReporting?removeErrorConsole(path):"function"==typeof options.errorReporting&&options.errorReporting("remove",path):removeErrorHTML(path)}function errorConsole(e,rootHref){var template="{line} {content}",filename=e.filename||rootHref,errors=[],content=(e.type||"Syntax")+"Error: "+(e.message||"There is an error in your .less file")+" in "+filename+" ",errorline=function(e,i,classname){void 0!==e.extract[i]&&errors.push(template.replace(/\{line\}/,(parseInt(e.line,10)||0)+(i-1)).replace(/\{class\}/,classname).replace(/\{content\}/,e.extract[i]))};e.extract&&(errorline(e,0,""),errorline(e,1,"line"),errorline(e,2,""),content+="on line "+e.line+", column "+(e.column+1)+":\n"+errors.join("\n")),e.stack&&(e.extract||options.logLevel>=4)&&(content+="\nStack Trace\n"+e.stack),less.logger.error(content)}return{add:error,remove:removeError}}},{"./browser":3,"./utils":9}],6:[function(require,module,exports){module.exports=function(options,logger){function getXMLHttpRequest(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return logger.error("browser doesn't support AJAX."),null}}var AbstractFileManager=require("../less/environment/abstract-file-manager.js"),fileCache={},FileManager=function(){};return FileManager.prototype=new AbstractFileManager,FileManager.prototype.alwaysMakePathsAbsolute=function(){return!0},FileManager.prototype.join=function(basePath,laterPath){return basePath?this.extractUrlParts(laterPath,basePath).path:laterPath},FileManager.prototype.doXHR=function(url,type,callback,errback){function handleResponse(xhr,callback,errback){xhr.status>=200&&xhr.status<300?callback(xhr.responseText,xhr.getResponseHeader("Last-Modified")):"function"==typeof errback&&errback(xhr.status,url)}var xhr=getXMLHttpRequest(),async=options.isFileProtocol?options.fileAsync:options.async;"function"==typeof xhr.overrideMimeType&&xhr.overrideMimeType("text/css"),logger.debug("XHR: Getting '"+url+"'"),xhr.open("GET",url,async),xhr.setRequestHeader("Accept",type||"text/x-less, text/css; q=0.9, */*; q=0.5"),xhr.send(null),options.isFileProtocol&&!options.fileAsync?0===xhr.status||xhr.status>=200&&xhr.status<300?callback(xhr.responseText):errback(xhr.status,url):async?xhr.onreadystatechange=function(){4==xhr.readyState&&handleResponse(xhr,callback,errback)}:handleResponse(xhr,callback,errback)},FileManager.prototype.supports=function(filename,currentDirectory,options,environment){return!0},FileManager.prototype.clearFileCache=function(){fileCache={}},FileManager.prototype.loadFile=function(filename,currentDirectory,options,environment,callback){currentDirectory&&!this.isPathAbsolute(filename)&&(filename=currentDirectory+filename),options=options||{};var hrefParts=this.extractUrlParts(filename,window.location.href),href=hrefParts.url;if(options.useFileCache&&fileCache[href])try{var lessText=fileCache[href];callback(null,{contents:lessText,filename:href,webInfo:{lastModified:new Date}})}catch(e){callback({filename:href,message:"Error loading file "+href+" error was "+e.message})}else this.doXHR(href,options.mime,function(data,lastModified){fileCache[href]=data,callback(null,{contents:data,filename:href,webInfo:{lastModified:lastModified}})},function(status,url){callback({type:"File",message:"'"+url+"' wasn't found ("+status+")",href:href})})},FileManager}},{"../less/environment/abstract-file-manager.js":14}],7:[function(require,module,exports){var addDataAttr=require("./utils").addDataAttr,browser=require("./browser");module.exports=function(window,options){function postProcessCSS(styles){return options.postProcessor&&"function"==typeof options.postProcessor&&(styles=options.postProcessor.call(styles,styles)||styles),styles}function clone(obj){var cloned={};for(var prop in obj)obj.hasOwnProperty(prop)&&(cloned[prop]=obj[prop]);return cloned}function bind(func,thisArg){var curryArgs=Array.prototype.slice.call(arguments,2);return function(){var args=curryArgs.concat(Array.prototype.slice.call(arguments,0));return func.apply(thisArg,args)}}function loadStyles(modifyVars){for(var style,styles=document.getElementsByTagName("style"),i=0;i<styles.length;i++)if(style=styles[i],style.type.match(typePattern)){var instanceOptions=clone(options);instanceOptions.modifyVars=modifyVars;var lessText=style.innerHTML||"";instanceOptions.filename=document.location.href.replace(/#.*$/,""),less.render(lessText,instanceOptions,bind(function(style,e,result){e?errors.add(e,"inline"):(style.type="text/css",style.styleSheet?style.styleSheet.cssText=result.css:style.innerHTML=result.css)},null,style))}}function loadStyleSheet(sheet,callback,reload,remaining,modifyVars){function loadInitialFileCallback(loadedFile){var data=loadedFile.contents,path=loadedFile.filename,webInfo=loadedFile.webInfo,newFileInfo={currentDirectory:fileManager.getPath(path),filename:path,rootFilename:path,relativeUrls:instanceOptions.relativeUrls};if(newFileInfo.entryPath=newFileInfo.currentDirectory,newFileInfo.rootpath=instanceOptions.rootpath||newFileInfo.currentDirectory,webInfo&&(webInfo.remaining=remaining,!instanceOptions.modifyVars)){var css=cache.getCSS(path,webInfo);if(!reload&&css)return webInfo.local=!0,void callback(null,css,data,sheet,webInfo,path)}errors.remove(path),instanceOptions.rootFileInfo=newFileInfo,less.render(data,instanceOptions,function(e,result){e?(e.href=path,callback(e)):(result.css=postProcessCSS(result.css),instanceOptions.modifyVars||cache.setCSS(sheet.href,webInfo.lastModified,result.css),callback(null,result.css,data,sheet,webInfo,path))})}var instanceOptions=clone(options);addDataAttr(instanceOptions,sheet),instanceOptions.mime=sheet.type,modifyVars&&(instanceOptions.modifyVars=modifyVars),fileManager.loadFile(sheet.href,null,instanceOptions,environment,function(e,loadedFile){return e?void callback(e):void loadInitialFileCallback(loadedFile)})}function loadStyleSheets(callback,reload,modifyVars){for(var i=0;i<less.sheets.length;i++)loadStyleSheet(less.sheets[i],callback,reload,less.sheets.length-(i+1),modifyVars)}function initRunningMode(){"development"===less.env&&(less.watchTimer=setInterval(function(){less.watchMode&&(fileManager.clearFileCache(),loadStyleSheets(function(e,css,_,sheet,webInfo){e?errors.add(e,e.href||sheet.href):css&&browser.createCSS(window.document,css,sheet)}))},options.poll))}var document=window.document,less=require("../less")();less.options=options;var environment=less.environment,FileManager=require("./file-manager")(options,less.logger),fileManager=new FileManager;environment.addFileManager(fileManager),less.FileManager=FileManager,require("./log-listener")(less,options);var errors=require("./error-reporting")(window,less,options),cache=less.cache=options.cache||require("./cache")(window,options,less.logger);options.functions&&less.functions.functionRegistry.addMultiple(options.functions);var typePattern=/^text\/(x-)?less$/;return less.watch=function(){return less.watchMode||(less.env="development",initRunningMode()),this.watchMode=!0,!0},less.unwatch=function(){return clearInterval(less.watchTimer),this.watchMode=!1,!1},less.registerStylesheets=function(){return new Promise(function(resolve,reject){var links=document.getElementsByTagName("link");less.sheets=[];for(var i=0;i<links.length;i++)("stylesheet/less"===links[i].rel||links[i].rel.match(/stylesheet/)&&links[i].type.match(typePattern))&&less.sheets.push(links[i]);resolve()})},less.modifyVars=function(record){return less.refresh(!0,record,!1)},less.refresh=function(reload,modifyVars,clearFileCache){return(reload||clearFileCache)&&clearFileCache!==!1&&fileManager.clearFileCache(),new Promise(function(resolve,reject){var startTime,endTime,totalMilliseconds;startTime=endTime=new Date,loadStyleSheets(function(e,css,_,sheet,webInfo){return e?(errors.add(e,e.href||sheet.href),void reject(e)):(webInfo.local?less.logger.info("loading "+sheet.href+" from cache."):less.logger.info("rendered "+sheet.href+" successfully."),browser.createCSS(window.document,css,sheet),less.logger.info("css for "+sheet.href+" generated in "+(new Date-endTime)+"ms"),0===webInfo.remaining&&(totalMilliseconds=new Date-startTime,less.logger.info("less has finished. css generated in "+totalMilliseconds+"ms"),resolve({startTime:startTime,endTime:endTime,totalMilliseconds:totalMilliseconds,sheets:less.sheets.length})),void(endTime=new Date))},reload,modifyVars),loadStyles(modifyVars)})},less.refreshStyles=loadStyles,less}},{"../less":29,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(require,module,exports){module.exports=function(less,options){var logLevel_debug=4,logLevel_info=3,logLevel_warn=2,logLevel_error=1;options.logLevel="undefined"!=typeof options.logLevel?options.logLevel:"development"===options.env?logLevel_info:logLevel_error,options.loggers||(options.loggers=[{debug:function(msg){options.logLevel>=logLevel_debug&&console.log(msg)},info:function(msg){options.logLevel>=logLevel_info&&console.log(msg)},warn:function(msg){options.logLevel>=logLevel_warn&&console.warn(msg)},error:function(msg){options.logLevel>=logLevel_error&&console.error(msg)}}]);for(var i=0;i<options.loggers.length;i++)less.logger.addListener(options.loggers[i])}},{}],9:[function(require,module,exports){module.exports={extractId:function(href){return href.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(options,tag){for(var opt in tag.dataset)if(tag.dataset.hasOwnProperty(opt))if("env"===opt||"dumpLineNumbers"===opt||"rootpath"===opt||"errorReporting"===opt)options[opt]=tag.dataset[opt];else try{options[opt]=JSON.parse(tag.dataset[opt])}catch(_){}}}},{}],10:[function(require,module,exports){var contexts={};module.exports=contexts;var copyFromOriginal=function(original,destination,propertiesToCopy){if(original)for(var i=0;i<propertiesToCopy.length;i++)original.hasOwnProperty(propertiesToCopy[i])&&(destination[propertiesToCopy[i]]=original[propertiesToCopy[i]])},parseCopyProperties=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];contexts.Parse=function(options){copyFromOriginal(options,this,parseCopyProperties),"string"==typeof this.paths&&(this.paths=[this.paths])};var evalCopyProperties=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];contexts.Eval=function(options,frames){copyFromOriginal(options,this,evalCopyProperties),this.frames=frames||[],this.importantScope=this.importantScope||[]},contexts.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},contexts.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},contexts.Eval.prototype.isMathOn=function(){return this.strictMath?this.parensStack&&this.parensStack.length:!0},contexts.Eval.prototype.isPathRelative=function(path){return!/^(?:[a-z-]+:|\/|#)/i.test(path)},contexts.Eval.prototype.normalizePath=function(path){var segment,segments=path.split("/").reverse();for(path=[];0!==segments.length;)switch(segment=segments.pop()){case".":break;case"..":0===path.length||".."===path[path.length-1]?path.push(segment):path.pop();break;default:path.push(segment)}return path.join("/")}},{}],11:[function(require,module,exports){module.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(require,module,exports){module.exports={colors:require("./colors"),unitConversions:require("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(require,module,exports){module.exports={length:{m:1,cm:.01,mm:.001,"in":.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(require,module,exports){var abstractFileManager=function(){};abstractFileManager.prototype.getPath=function(filename){var j=filename.lastIndexOf("?");return j>0&&(filename=filename.slice(0,j)),j=filename.lastIndexOf("/"),0>j&&(j=filename.lastIndexOf("\\")),0>j?"":filename.slice(0,j+1)},abstractFileManager.prototype.tryAppendLessExtension=function(path){return/(\.[a-z]*$)|([\?;].*)$/.test(path)?path:path+".less"},abstractFileManager.prototype.supportsSync=function(){return!1},abstractFileManager.prototype.alwaysMakePathsAbsolute=function(){return!1},abstractFileManager.prototype.isPathAbsolute=function(filename){return/^(?:[a-z-]+:|\/|\\|#)/i.test(filename)},abstractFileManager.prototype.join=function(basePath,laterPath){return basePath?basePath+laterPath:laterPath},abstractFileManager.prototype.pathDiff=function(url,baseUrl){var i,max,urlDirectories,baseUrlDirectories,urlParts=this.extractUrlParts(url),baseUrlParts=this.extractUrlParts(baseUrl),diff="";if(urlParts.hostPart!==baseUrlParts.hostPart)return"";for(max=Math.max(baseUrlParts.directories.length,urlParts.directories.length),i=0;max>i&&baseUrlParts.directories[i]===urlParts.directories[i];i++);for(baseUrlDirectories=baseUrlParts.directories.slice(i),urlDirectories=urlParts.directories.slice(i),i=0;i<baseUrlDirectories.length-1;i++)diff+="../";for(i=0;i<urlDirectories.length-1;i++)diff+=urlDirectories[i]+"/";return diff},abstractFileManager.prototype.extractUrlParts=function(url,baseUrl){var i,baseUrlParts,urlPartsRegex=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,urlParts=url.match(urlPartsRegex),returner={},directories=[];if(!urlParts)throw new Error("Could not parse sheet href - '"+url+"'");if(baseUrl&&(!urlParts[1]||urlParts[2])){if(baseUrlParts=baseUrl.match(urlPartsRegex),!baseUrlParts)throw new Error("Could not parse page url - '"+baseUrl+"'");urlParts[1]=urlParts[1]||baseUrlParts[1]||"",urlParts[2]||(urlParts[3]=baseUrlParts[3]+urlParts[3])}if(urlParts[3]){for(directories=urlParts[3].replace(/\\/g,"/").split("/"),i=0;i<directories.length;i++)"."===directories[i]&&(directories.splice(i,1),i-=1);for(i=0;i<directories.length;i++)".."===directories[i]&&i>0&&(directories.splice(i-1,2),i-=2)}return returner.hostPart=urlParts[1],returner.directories=directories,returner.path=(urlParts[1]||"")+directories.join("/"),returner.fileUrl=returner.path+(urlParts[4]||""),returner.url=returner.fileUrl+(urlParts[5]||""),returner},module.exports=abstractFileManager},{}],15:[function(require,module,exports){var logger=require("../logger"),environment=function(externalEnvironment,fileManagers){this.fileManagers=fileManagers||[],externalEnvironment=externalEnvironment||{};for(var optionalFunctions=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],requiredFunctions=[],functions=requiredFunctions.concat(optionalFunctions),i=0;i<functions.length;i++){var propName=functions[i],environmentFunc=externalEnvironment[propName];environmentFunc?this[propName]=environmentFunc.bind(externalEnvironment):i<requiredFunctions.length&&this.warn("missing required function in environment - "+propName)}};environment.prototype.getFileManager=function(filename,currentDirectory,options,environment,isSync){filename||logger.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==currentDirectory&&logger.warn("getFileManager called with null directory.. Please report this issue. continuing.");var fileManagers=this.fileManagers;options.pluginManager&&(fileManagers=[].concat(fileManagers).concat(options.pluginManager.getFileManagers()));for(var i=fileManagers.length-1;i>=0;i--){var fileManager=fileManagers[i];if(fileManager[isSync?"supportsSync":"supports"](filename,currentDirectory,options,environment))return fileManager}return null},environment.prototype.addFileManager=function(fileManager){this.fileManagers.push(fileManager)},environment.prototype.clearFileManagers=function(){this.fileManagers=[]},module.exports=environment},{"../logger":31}],16:[function(require,module,exports){function colorBlend(mode,color1,color2){var cb,cs,ar,cr,ab=color1.alpha,as=color2.alpha,r=[];ar=as+ab*(1-as);for(var i=0;3>i;i++)cb=color1.rgb[i]/255,cs=color2.rgb[i]/255,cr=mode(cb,cs),ar&&(cr=(as*cs+ab*(cb-as*(cb+cs-cr)))/ar),r[i]=255*cr;return new Color(r,ar)}var Color=require("../tree/color"),functionRegistry=require("./function-registry"),colorBlendModeFunctions={multiply:function(cb,cs){return cb*cs},screen:function(cb,cs){return cb+cs-cb*cs},overlay:function(cb,cs){return cb*=2,1>=cb?colorBlendModeFunctions.multiply(cb,cs):colorBlendModeFunctions.screen(cb-1,cs)},softlight:function(cb,cs){var d=1,e=cb;return cs>.5&&(e=1,d=cb>.25?Math.sqrt(cb):((16*cb-12)*cb+4)*cb),cb-(1-2*cs)*e*(d-cb)},hardlight:function(cb,cs){return colorBlendModeFunctions.overlay(cs,cb)},difference:function(cb,cs){return Math.abs(cb-cs)},exclusion:function(cb,cs){return cb+cs-2*cb*cs},average:function(cb,cs){return(cb+cs)/2},negation:function(cb,cs){return 1-Math.abs(cb+cs-1)}};for(var f in colorBlendModeFunctions)colorBlendModeFunctions.hasOwnProperty(f)&&(colorBlend[f]=colorBlend.bind(null,colorBlendModeFunctions[f]));functionRegistry.addMultiple(colorBlend)},{"../tree/color":47,"./function-registry":21}],17:[function(require,module,exports){function clamp(val){return Math.min(1,Math.max(0,val))}function hsla(color){return colorFunctions.hsla(color.h,color.s,color.l,color.a)}function number(n){if(n instanceof Dimension)return parseFloat(n.unit.is("%")?n.value/100:n.value);if("number"==typeof n)return n;throw{type:"Argument",message:"color functions take numbers as parameters"}}function scaled(n,size){return n instanceof Dimension&&n.unit.is("%")?parseFloat(n.value*size/100):number(n)}var colorFunctions,Dimension=require("../tree/dimension"),Color=require("../tree/color"),Quoted=require("../tree/quoted"),Anonymous=require("../tree/anonymous"),functionRegistry=require("./function-registry");colorFunctions={rgb:function(r,g,b){return colorFunctions.rgba(r,g,b,1)},rgba:function(r,g,b,a){var rgb=[r,g,b].map(function(c){return scaled(c,255)});return a=number(a),new Color(rgb,a)},hsl:function(h,s,l){return colorFunctions.hsla(h,s,l,1)},hsla:function(h,s,l,a){function hue(h){return h=0>h?h+1:h>1?h-1:h,1>6*h?m1+(m2-m1)*h*6:1>2*h?m2:2>3*h?m1+(m2-m1)*(2/3-h)*6:m1}h=number(h)%360/360,s=clamp(number(s)),l=clamp(number(l)),a=clamp(number(a));var m2=.5>=l?l*(s+1):l+s-l*s,m1=2*l-m2;return colorFunctions.rgba(255*hue(h+1/3),255*hue(h),255*hue(h-1/3),a)},hsv:function(h,s,v){return colorFunctions.hsva(h,s,v,1)},hsva:function(h,s,v,a){h=number(h)%360/360*360,s=number(s),v=number(v),a=number(a);var i,f;i=Math.floor(h/60%6),f=h/60-i;var vs=[v,v*(1-s),v*(1-f*s),v*(1-(1-f)*s)],perm=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return colorFunctions.rgba(255*vs[perm[i][0]],255*vs[perm[i][1]],255*vs[perm[i][2]],a)},hue:function(color){return new Dimension(color.toHSL().h)},saturation:function(color){return new Dimension(100*color.toHSL().s,"%")},lightness:function(color){return new Dimension(100*color.toHSL().l,"%")},hsvhue:function(color){return new Dimension(color.toHSV().h)},hsvsaturation:function(color){return new Dimension(100*color.toHSV().s,"%")},hsvvalue:function(color){return new Dimension(100*color.toHSV().v,"%")},red:function(color){return new Dimension(color.rgb[0])},green:function(color){return new Dimension(color.rgb[1])},blue:function(color){return new Dimension(color.rgb[2])},alpha:function(color){return new Dimension(color.toHSL().a)},luma:function(color){return new Dimension(color.luma()*color.alpha*100,"%")},luminance:function(color){var luminance=.2126*color.rgb[0]/255+.7152*color.rgb[1]/255+.0722*color.rgb[2]/255;return new Dimension(luminance*color.alpha*100,"%")},saturate:function(color,amount){if(!color.rgb)return null;var hsl=color.toHSL();return hsl.s+=amount.value/100,hsl.s=clamp(hsl.s),hsla(hsl)},desaturate:function(color,amount){var hsl=color.toHSL();return hsl.s-=amount.value/100,hsl.s=clamp(hsl.s),hsla(hsl)},lighten:function(color,amount){var hsl=color.toHSL();return hsl.l+=amount.value/100,hsl.l=clamp(hsl.l),hsla(hsl)},darken:function(color,amount){var hsl=color.toHSL();return hsl.l-=amount.value/100,hsl.l=clamp(hsl.l),hsla(hsl)},fadein:function(color,amount){var hsl=color.toHSL();return hsl.a+=amount.value/100,hsl.a=clamp(hsl.a),hsla(hsl)},fadeout:function(color,amount){var hsl=color.toHSL();return hsl.a-=amount.value/100,hsl.a=clamp(hsl.a),hsla(hsl)},fade:function(color,amount){var hsl=color.toHSL();return hsl.a=amount.value/100,hsl.a=clamp(hsl.a),hsla(hsl)},spin:function(color,amount){var hsl=color.toHSL(),hue=(hsl.h+amount.value)%360;return hsl.h=0>hue?360+hue:hue,hsla(hsl)},mix:function(color1,color2,weight){weight||(weight=new Dimension(50));var p=weight.value/100,w=2*p-1,a=color1.toHSL().a-color2.toHSL().a,w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1,rgb=[color1.rgb[0]*w1+color2.rgb[0]*w2,color1.rgb[1]*w1+color2.rgb[1]*w2,color1.rgb[2]*w1+color2.rgb[2]*w2],alpha=color1.alpha*p+color2.alpha*(1-p);return new Color(rgb,alpha)},greyscale:function(color){return colorFunctions.desaturate(color,new Dimension(100))},contrast:function(color,dark,light,threshold){if(!color.rgb)return null;if("undefined"==typeof light&&(light=colorFunctions.rgba(255,255,255,1)),"undefined"==typeof dark&&(dark=colorFunctions.rgba(0,0,0,1)),dark.luma()>light.luma()){var t=light;light=dark,dark=t}return threshold="undefined"==typeof threshold?.43:number(threshold),color.luma()<threshold?light:dark},argb:function(color){return new Anonymous(color.toARGB())},color:function(c){if(c instanceof Quoted&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(c.value))return new Color(c.value.slice(1));if(c instanceof Color||(c=Color.fromKeyword(c.value)))return c.value=void 0,
c;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(color,amount){return colorFunctions.mix(colorFunctions.rgb(255,255,255),color,amount)},shade:function(color,amount){return colorFunctions.mix(colorFunctions.rgb(0,0,0),color,amount)}},functionRegistry.addMultiple(colorFunctions)},{"../tree/anonymous":43,"../tree/color":47,"../tree/dimension":53,"../tree/quoted":70,"./function-registry":21}],18:[function(require,module,exports){module.exports=function(environment){var Quoted=require("../tree/quoted"),URL=require("../tree/url"),functionRegistry=require("./function-registry"),fallback=function(functionThis,node){return new URL(node,functionThis.index,functionThis.currentFileInfo).eval(functionThis.context)},logger=require("../logger");functionRegistry.add("data-uri",function(mimetypeNode,filePathNode){filePathNode||(filePathNode=mimetypeNode,mimetypeNode=null);var mimetype=mimetypeNode&&mimetypeNode.value,filePath=filePathNode.value,currentFileInfo=this.currentFileInfo,currentDirectory=currentFileInfo.relativeUrls?currentFileInfo.currentDirectory:currentFileInfo.entryPath,fragmentStart=filePath.indexOf("#"),fragment="";-1!==fragmentStart&&(fragment=filePath.slice(fragmentStart),filePath=filePath.slice(0,fragmentStart));var fileManager=environment.getFileManager(filePath,currentDirectory,this.context,environment,!0);if(!fileManager)return fallback(this,filePathNode);var useBase64=!1;if(mimetypeNode)useBase64=/;base64$/.test(mimetype);else{if(mimetype=environment.mimeLookup(filePath),"image/svg+xml"===mimetype)useBase64=!1;else{var charset=environment.charsetLookup(mimetype);useBase64=["US-ASCII","UTF-8"].indexOf(charset)<0}useBase64&&(mimetype+=";base64")}var fileSync=fileManager.loadFileSync(filePath,currentDirectory,this.context,environment);if(!fileSync.contents)return logger.warn("Skipped data-uri embedding of "+filePath+" because file not found"),fallback(this,filePathNode||mimetypeNode);var buf=fileSync.contents;if(useBase64&&!environment.encodeBase64)return fallback(this,filePathNode);buf=useBase64?environment.encodeBase64(buf):encodeURIComponent(buf);var uri="data:"+mimetype+","+buf+fragment,DATA_URI_MAX=32768;return uri.length>=DATA_URI_MAX&&this.context.ieCompat!==!1?(logger.warn("Skipped data-uri embedding of "+filePath+" because its size ("+uri.length+" characters) exceeds IE8-safe "+DATA_URI_MAX+" characters!"),fallback(this,filePathNode||mimetypeNode)):new URL(new Quoted('"'+uri+'"',uri,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":31,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],19:[function(require,module,exports){var Keyword=require("../tree/keyword"),functionRegistry=require("./function-registry"),defaultFunc={eval:function(){var v=this.value_,e=this.error_;if(e)throw e;return null!=v?v?Keyword.True:Keyword.False:void 0},value:function(v){this.value_=v},error:function(e){this.error_=e},reset:function(){this.value_=this.error_=null}};functionRegistry.add("default",defaultFunc.eval.bind(defaultFunc)),module.exports=defaultFunc},{"../tree/keyword":62,"./function-registry":21}],20:[function(require,module,exports){var functionRegistry=require("./function-registry"),functionCaller=function(name,context,index,currentFileInfo){this.name=name.toLowerCase(),this.func=functionRegistry.get(this.name),this.index=index,this.context=context,this.currentFileInfo=currentFileInfo};functionCaller.prototype.isValid=function(){return Boolean(this.func)},functionCaller.prototype.call=function(args){return this.func.apply(this,args)},module.exports=functionCaller},{"./function-registry":21}],21:[function(require,module,exports){module.exports={_data:{},add:function(name,func){this._data.hasOwnProperty(name),this._data[name]=func},addMultiple:function(functions){Object.keys(functions).forEach(function(name){this.add(name,functions[name])}.bind(this))},get:function(name){return this._data[name]}}},{}],22:[function(require,module,exports){module.exports=function(environment){var functions={functionRegistry:require("./function-registry"),functionCaller:require("./function-caller")};return require("./default"),require("./color"),require("./color-blending"),require("./data-uri")(environment),require("./math"),require("./number"),require("./string"),require("./svg")(environment),require("./types"),functions}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":23,"./number":24,"./string":25,"./svg":26,"./types":27}],23:[function(require,module,exports){function _math(fn,unit,n){if(!(n instanceof Dimension))throw{type:"Argument",message:"argument must be a number"};return null==unit?unit=n.unit:n=n.unify(),new Dimension(fn(parseFloat(n.value)),unit)}var Dimension=require("../tree/dimension"),functionRegistry=require("./function-registry"),mathFunctions={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var f in mathFunctions)mathFunctions.hasOwnProperty(f)&&(mathFunctions[f]=_math.bind(null,Math[f],mathFunctions[f]));mathFunctions.round=function(n,f){var fraction="undefined"==typeof f?0:f.value;return _math(function(num){return num.toFixed(fraction)},null,n)},functionRegistry.addMultiple(mathFunctions)},{"../tree/dimension":53,"./function-registry":21}],24:[function(require,module,exports){var Dimension=require("../tree/dimension"),Anonymous=require("../tree/anonymous"),functionRegistry=require("./function-registry"),minMax=function(isMin,args){switch(args=Array.prototype.slice.call(args),args.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var i,j,current,currentUnified,referenceUnified,unit,unitStatic,unitClone,order=[],values={};for(i=0;i<args.length;i++)if(current=args[i],current instanceof Dimension)if(currentUnified=""===current.unit.toString()&&void 0!==unitClone?new Dimension(current.value,unitClone).unify():current.unify(),unit=""===currentUnified.unit.toString()&&void 0!==unitStatic?unitStatic:currentUnified.unit.toString(),unitStatic=""!==unit&&void 0===unitStatic||""!==unit&&""===order[0].unify().unit.toString()?unit:unitStatic,unitClone=""!==unit&&void 0===unitClone?current.unit.toString():unitClone,j=void 0!==values[""]&&""!==unit&&unit===unitStatic?values[""]:values[unit],void 0!==j)referenceUnified=""===order[j].unit.toString()&&void 0!==unitClone?new Dimension(order[j].value,unitClone).unify():order[j].unify(),(isMin&&currentUnified.value<referenceUnified.value||!isMin&&currentUnified.value>referenceUnified.value)&&(order[j]=current);else{if(void 0!==unitStatic&&unit!==unitStatic)throw{type:"Argument",message:"incompatible types"};values[unit]=order.length,order.push(current)}else Array.isArray(args[i].value)&&Array.prototype.push.apply(args,Array.prototype.slice.call(args[i].value));return 1==order.length?order[0]:(args=order.map(function(a){return a.toCSS(this.context)}).join(this.context.compress?",":", "),new Anonymous((isMin?"min":"max")+"("+args+")"))};functionRegistry.addMultiple({min:function(){return minMax(!0,arguments)},max:function(){return minMax(!1,arguments)},convert:function(val,unit){return val.convertTo(unit.value)},pi:function(){return new Dimension(Math.PI)},mod:function(a,b){return new Dimension(a.value%b.value,a.unit)},pow:function(x,y){if("number"==typeof x&&"number"==typeof y)x=new Dimension(x),y=new Dimension(y);else if(!(x instanceof Dimension&&y instanceof Dimension))throw{type:"Argument",message:"arguments must be numbers"};return new Dimension(Math.pow(x.value,y.value),x.unit)},percentage:function(n){return new Dimension(100*n.value,"%")}})},{"../tree/anonymous":43,"../tree/dimension":53,"./function-registry":21}],25:[function(require,module,exports){var Quoted=require("../tree/quoted"),Anonymous=require("../tree/anonymous"),JavaScript=require("../tree/javascript"),functionRegistry=require("./function-registry");functionRegistry.addMultiple({e:function(str){return new Anonymous(str instanceof JavaScript?str.evaluated:str.value)},escape:function(str){return new Anonymous(encodeURI(str.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(string,pattern,replacement,flags){var result=string.value;return result=result.replace(new RegExp(pattern.value,flags?flags.value:""),replacement.value),new Quoted(string.quote||"",result,string.escaped)},"%":function(string){for(var args=Array.prototype.slice.call(arguments,1),result=string.value,i=0;i<args.length;i++)result=result.replace(/%[sda]/i,function(token){var value=token.match(/s/i)?args[i].value:args[i].toCSS();return token.match(/[A-Z]$/)?encodeURIComponent(value):value});return result=result.replace(/%%/g,"%"),new Quoted(string.quote||"",result,string.escaped)}})},{"../tree/anonymous":43,"../tree/javascript":60,"../tree/quoted":70,"./function-registry":21}],26:[function(require,module,exports){module.exports=function(environment){var Dimension=require("../tree/dimension"),Color=require("../tree/color"),Expression=require("../tree/expression"),Quoted=require("../tree/quoted"),URL=require("../tree/url"),functionRegistry=require("./function-registry");functionRegistry.add("svg-gradient",function(direction){function throwArgumentDescriptor(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position]"}}arguments.length<3&&throwArgumentDescriptor();var gradientDirectionSvg,returner,i,color,position,positionValue,alpha,stops=Array.prototype.slice.call(arguments,1),gradientType="linear",rectangleDimension='x="0" y="0" width="1" height="1"',renderEnv={compress:!1},directionValue=direction.toCSS(renderEnv);switch(directionValue){case"to bottom":gradientDirectionSvg='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":gradientDirectionSvg='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":gradientDirectionSvg='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":gradientDirectionSvg='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":gradientType="radial",gradientDirectionSvg='cx="50%" cy="50%" r="75%"',rectangleDimension='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"}}for(returner='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+gradientType+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+gradientDirectionSvg+">",i=0;i<stops.length;i+=1)stops[i]instanceof Expression?(color=stops[i].value[0],position=stops[i].value[1]):(color=stops[i],position=void 0),color instanceof Color&&((0===i||i+1===stops.length)&&void 0===position||position instanceof Dimension)||throwArgumentDescriptor(),positionValue=position?position.toCSS(renderEnv):0===i?"0%":"100%",alpha=color.alpha,returner+='<stop offset="'+positionValue+'" stop-color="'+color.toRGB()+'"'+(1>alpha?' stop-opacity="'+alpha+'"':"")+"/>";return returner+="</"+gradientType+"Gradient><rect "+rectangleDimension+' fill="url(#gradient)" /></svg>',returner=encodeURIComponent(returner),returner="data:image/svg+xml,"+returner,new URL(new Quoted("'"+returner+"'",returner,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":47,"../tree/dimension":53,"../tree/expression":56,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],27:[function(require,module,exports){var Keyword=require("../tree/keyword"),DetachedRuleset=require("../tree/detached-ruleset"),Dimension=require("../tree/dimension"),Color=require("../tree/color"),Quoted=require("../tree/quoted"),Anonymous=require("../tree/anonymous"),URL=require("../tree/url"),Operation=require("../tree/operation"),functionRegistry=require("./function-registry"),isa=function(n,Type){return n instanceof Type?Keyword.True:Keyword.False},isunit=function(n,unit){if(void 0===unit)throw{type:"Argument",message:"missing the required second argument to isunit."};if(unit="string"==typeof unit.value?unit.value:unit,"string"!=typeof unit)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return n instanceof Dimension&&n.unit.is(unit)?Keyword.True:Keyword.False},getItemsFromNode=function(node){var items=Array.isArray(node.value)?node.value:Array(node);return items.filter(function(item){return"Comment"===item.type?!1:!0})};functionRegistry.addMultiple({isruleset:function(n){return isa(n,DetachedRuleset)},iscolor:function(n){return isa(n,Color)},isnumber:function(n){return isa(n,Dimension)},isstring:function(n){return isa(n,Quoted)},iskeyword:function(n){return isa(n,Keyword)},isurl:function(n){return isa(n,URL)},ispixel:function(n){return isunit(n,"px")},ispercentage:function(n){return isunit(n,"%")},isem:function(n){return isunit(n,"em")},isunit:isunit,unit:function(val,unit){if(!(val instanceof Dimension))throw{type:"Argument",message:"the first argument to unit must be a number"+(val instanceof Operation?". Have you forgotten parenthesis?":"")};return unit=unit?unit instanceof Keyword?unit.value:unit.toCSS():"",new Dimension(val.value,unit)},"get-unit":function(n){return new Anonymous(n.unit)},extract:function(values,index){return index=index.value-1,getItemsFromNode(values)[index]},length:function(values){return new Dimension(getItemsFromNode(values).length)}})},{"../tree/anonymous":43,"../tree/color":47,"../tree/detached-ruleset":52,"../tree/dimension":53,"../tree/keyword":62,"../tree/operation":68,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],28:[function(require,module,exports){var contexts=require("./contexts"),Parser=require("./parser/parser");module.exports=function(environment){var ImportManager=function(context,rootFileInfo){this.rootFilename=rootFileInfo.filename,this.paths=context.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=context.mime,this.error=null,this.context=context,this.queue=[],this.files={}};return ImportManager.prototype.push=function(path,tryAppendLessExtension,currentFileInfo,importOptions,callback){var importManager=this;this.queue.push(path);var fileParsedFunc=function(e,root,fullPath){importManager.queue.splice(importManager.queue.indexOf(path),1);var importedEqualsRoot=fullPath===importManager.rootFilename;importOptions.optional&&e?callback(null,{rules:[]},!1,null):(importManager.files[fullPath]=root,e&&!importManager.error&&(importManager.error=e),callback(e,root,importedEqualsRoot,fullPath))},newFileInfo={relativeUrls:this.context.relativeUrls,entryPath:currentFileInfo.entryPath,rootpath:currentFileInfo.rootpath,rootFilename:currentFileInfo.rootFilename},fileManager=environment.getFileManager(path,currentFileInfo.currentDirectory,this.context,environment);if(!fileManager)return void fileParsedFunc({message:"Could not find a file-manager for "+path});tryAppendLessExtension&&(path=fileManager.tryAppendLessExtension(path));var loadFileCallback=function(loadedFile){var resolvedFilename=loadedFile.filename,contents=loadedFile.contents.replace(/^\uFEFF/,"");newFileInfo.currentDirectory=fileManager.getPath(resolvedFilename),newFileInfo.relativeUrls&&(newFileInfo.rootpath=fileManager.join(importManager.context.rootpath||"",fileManager.pathDiff(newFileInfo.currentDirectory,newFileInfo.entryPath)),!fileManager.isPathAbsolute(newFileInfo.rootpath)&&fileManager.alwaysMakePathsAbsolute()&&(newFileInfo.rootpath=fileManager.join(newFileInfo.entryPath,newFileInfo.rootpath))),newFileInfo.filename=resolvedFilename;var newEnv=new contexts.Parse(importManager.context);newEnv.processImports=!1,importManager.contents[resolvedFilename]=contents,(currentFileInfo.reference||importOptions.reference)&&(newFileInfo.reference=!0),importOptions.inline?fileParsedFunc(null,contents,resolvedFilename):new Parser(newEnv,importManager,newFileInfo).parse(contents,function(e,root){fileParsedFunc(e,root,resolvedFilename)})},promise=fileManager.loadFile(path,currentFileInfo.currentDirectory,this.context,environment,function(err,loadedFile){err?fileParsedFunc(err):loadFileCallback(loadedFile)});promise&&promise.then(loadFileCallback,fileParsedFunc)},ImportManager}},{"./contexts":10,"./parser/parser":36}],29:[function(require,module,exports){module.exports=function(environment,fileManagers){var SourceMapOutput,SourceMapBuilder,ParseTree,ImportManager,Environment,less={version:[2,4,0],data:require("./data"),tree:require("./tree"),Environment:Environment=require("./environment/environment"),AbstractFileManager:require("./environment/abstract-file-manager"),environment:environment=new Environment(environment,fileManagers),visitors:require("./visitors"),Parser:require("./parser/parser"),functions:require("./functions")(environment),contexts:require("./contexts"),SourceMapOutput:SourceMapOutput=require("./source-map-output")(environment),SourceMapBuilder:SourceMapBuilder=require("./source-map-builder")(SourceMapOutput,environment),ParseTree:ParseTree=require("./parse-tree")(SourceMapBuilder),ImportManager:ImportManager=require("./import-manager")(environment),render:require("./render")(environment,ParseTree,ImportManager),parse:require("./parse")(environment,ParseTree,ImportManager),LessError:require("./less-error"),transformTree:require("./transform-tree"),utils:require("./utils"),PluginManager:require("./plugin-manager"),logger:require("./logger")};return less}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":28,"./less-error":30,"./logger":31,"./parse":33,"./parse-tree":32,"./parser/parser":36,"./plugin-manager":37,"./render":38,"./source-map-builder":39,"./source-map-output":40,"./transform-tree":41,"./tree":59,"./utils":80,"./visitors":84}],30:[function(require,module,exports){var utils=require("./utils"),LessError=module.exports=function(e,importManager,currentFilename){Error.call(this);var filename=e.filename||currentFilename;if(importManager&&filename){var input=importManager.contents[filename],loc=utils.getLocation(e.index,input),line=loc.line,col=loc.column,callLine=e.call&&utils.getLocation(e.call,input).line,lines=input.split("\n");this.type=e.type||"Syntax",this.filename=filename,this.index=e.index,this.line="number"==typeof line?line+1:null,this.callLine=callLine+1,this.callExtract=lines[callLine],this.column=col,this.extract=[lines[line-1],lines[line],lines[line+1]]}this.message=e.message,this.stack=e.stack};if("undefined"==typeof Object.create){var F=function(){};F.prototype=Error.prototype,LessError.prototype=new F}else LessError.prototype=Object.create(Error.prototype);LessError.prototype.constructor=LessError},{"./utils":80}],31:[function(require,module,exports){module.exports={error:function(msg){this._fireEvent("error",msg)},warn:function(msg){this._fireEvent("warn",msg)},info:function(msg){this._fireEvent("info",msg)},debug:function(msg){this._fireEvent("debug",msg)},addListener:function(listener){this._listeners.push(listener)},removeListener:function(listener){for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]===listener)return void this._listeners.splice(i,1)},_fireEvent:function(type,msg){for(var i=0;i<this._listeners.length;i++){var logFunction=this._listeners[i][type];logFunction&&logFunction(msg)}},_listeners:[]}},{}],32:[function(require,module,exports){var LessError=require("./less-error"),transformTree=require("./transform-tree"),logger=require("./logger");module.exports=function(SourceMapBuilder){var ParseTree=function(root,imports){this.root=root,this.imports=imports};return ParseTree.prototype.toCSS=function(options){var evaldRoot,sourceMapBuilder,result={};try{evaldRoot=transformTree(this.root,options)}catch(e){throw new LessError(e,this.imports)}try{var compress=Boolean(options.compress);compress&&logger.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var toCSSOptions={compress:compress,dumpLineNumbers:options.dumpLineNumbers,strictUnits:Boolean(options.strictUnits),numPrecision:8};options.sourceMap?(sourceMapBuilder=new SourceMapBuilder(options.sourceMap),result.css=sourceMapBuilder.toCSS(evaldRoot,toCSSOptions,this.imports)):result.css=evaldRoot.toCSS(toCSSOptions)}catch(e){throw new LessError(e,this.imports)}if(options.pluginManager)for(var postProcessors=options.pluginManager.getPostProcessors(),i=0;i<postProcessors.length;i++)result.css=postProcessors[i].process(result.css,{sourceMap:sourceMapBuilder,options:options,imports:this.imports});options.sourceMap&&(result.map=sourceMapBuilder.getExternalSourceMap()),result.imports=[];for(var file in this.imports.files)this.imports.files.hasOwnProperty(file)&&file!==this.imports.rootFilename&&result.imports.push(file);return result},ParseTree}},{"./less-error":30,"./logger":31,"./transform-tree":41}],33:[function(require,module,exports){var PromiseConstructor,contexts=require("./contexts"),Parser=require("./parser/parser"),PluginManager=require("./plugin-manager");module.exports=function(environment,ParseTree,ImportManager){var parse=function(input,options,callback){if(options=options||{},"function"==typeof options&&(callback=options,options={}),!callback){PromiseConstructor||(PromiseConstructor="undefined"==typeof Promise?require("promise"):Promise);var self=this;return new PromiseConstructor(function(resolve,reject){parse.call(self,input,options,function(err,output){err?reject(err):resolve(output)})})}var context,rootFileInfo,pluginManager=new PluginManager(this);if(pluginManager.addPlugins(options.plugins),options.pluginManager=pluginManager,context=new contexts.Parse(options),options.rootFileInfo)rootFileInfo=options.rootFileInfo;else{var filename=options.filename||"input",entryPath=filename.replace(/[^\/\\]*$/,"");rootFileInfo={filename:filename,relativeUrls:context.relativeUrls,rootpath:context.rootpath||"",currentDirectory:entryPath,entryPath:entryPath,rootFilename:filename},rootFileInfo.rootpath&&"/"!==rootFileInfo.rootpath.slice(-1)&&(rootFileInfo.rootpath+="/")}var imports=new ImportManager(context,rootFileInfo);new Parser(context,imports,rootFileInfo).parse(input,function(e,root){return e?callback(e):void callback(null,root,imports,options)},options)};return parse}},{"./contexts":10,"./parser/parser":36,"./plugin-manager":37,promise:void 0}],34:[function(require,module,exports){module.exports=function(input,fail){function emitChunk(force){var len=chunkerCurrentIndex-emitFrom;512>len&&!force||!len||(chunks.push(input.slice(emitFrom,chunkerCurrentIndex+1)),emitFrom=chunkerCurrentIndex+1)}var lastOpening,lastOpeningParen,lastMultiComment,lastMultiCommentEndBrace,chunkerCurrentIndex,currentChunkStartIndex,cc,cc2,matched,len=input.length,level=0,parenLevel=0,chunks=[],emitFrom=0;for(chunkerCurrentIndex=0;len>chunkerCurrentIndex;chunkerCurrentIndex++)if(cc=input.charCodeAt(chunkerCurrentIndex),!(cc>=97&&122>=cc||34>cc))switch(cc){case 40:parenLevel++,lastOpeningParen=chunkerCurrentIndex;continue;case 41:if(--parenLevel<0)return fail("missing opening `(`",chunkerCurrentIndex);continue;case 59:parenLevel||emitChunk();continue;case 123:level++,lastOpening=chunkerCurrentIndex;continue;case 125:if(--level<0)return fail("missing opening `{`",chunkerCurrentIndex);level||parenLevel||emitChunk();continue;case 92:if(len-1>chunkerCurrentIndex){chunkerCurrentIndex++;continue}return fail("unescaped `\\`",chunkerCurrentIndex);case 34:case 39:case 96:for(matched=0,currentChunkStartIndex=chunkerCurrentIndex,chunkerCurrentIndex+=1;len>chunkerCurrentIndex;chunkerCurrentIndex++)if(cc2=input.charCodeAt(chunkerCurrentIndex),!(cc2>96)){if(cc2==cc){matched=1;break}if(92==cc2){if(chunkerCurrentIndex==len-1)return fail("unescaped `\\`",chunkerCurrentIndex);chunkerCurrentIndex++}}if(matched)continue;return fail("unmatched `"+String.fromCharCode(cc)+"`",currentChunkStartIndex);case 47:if(parenLevel||chunkerCurrentIndex==len-1)continue;if(cc2=input.charCodeAt(chunkerCurrentIndex+1),47==cc2)for(chunkerCurrentIndex+=2;len>chunkerCurrentIndex&&(cc2=input.charCodeAt(chunkerCurrentIndex),!(13>=cc2)||10!=cc2&&13!=cc2);chunkerCurrentIndex++);else if(42==cc2){for(lastMultiComment=currentChunkStartIndex=chunkerCurrentIndex,chunkerCurrentIndex+=2;len-1>chunkerCurrentIndex&&(cc2=input.charCodeAt(chunkerCurrentIndex),125==cc2&&(lastMultiCommentEndBrace=chunkerCurrentIndex),42!=cc2||47!=input.charCodeAt(chunkerCurrentIndex+1));chunkerCurrentIndex++);if(chunkerCurrentIndex==len-1)return fail("missing closing `*/`",currentChunkStartIndex);chunkerCurrentIndex++}continue;case 42:if(len-1>chunkerCurrentIndex&&47==input.charCodeAt(chunkerCurrentIndex+1))return fail("unmatched `/*`",chunkerCurrentIndex);continue}return 0!==level?lastMultiComment>lastOpening&&lastMultiCommentEndBrace>lastMultiComment?fail("missing closing `}` or `*/`",lastOpening):fail("missing closing `}`",lastOpening):0!==parenLevel?fail("missing closing `)`",lastOpeningParen):(emitChunk(!0),chunks)}},{}],35:[function(require,module,exports){var chunker=require("./chunker");module.exports=function(){function sync(){parserInput.i>currentPos&&(current=current.slice(parserInput.i-currentPos),currentPos=parserInput.i)}var input,j,furthest,furthestPossibleErrorMessage,chunks,current,currentPos,saveStack=[],parserInput={};parserInput.save=function(){currentPos=parserInput.i,saveStack.push({current:current,i:parserInput.i,j:j})},parserInput.restore=function(possibleErrorMessage){(parserInput.i>furthest||parserInput.i===furthest&&possibleErrorMessage&&!furthestPossibleErrorMessage)&&(furthest=parserInput.i,furthestPossibleErrorMessage=possibleErrorMessage);var state=saveStack.pop();current=state.current,currentPos=parserInput.i=state.i,j=state.j},parserInput.forget=function(){saveStack.pop()},parserInput.isWhitespace=function(offset){var pos=parserInput.i+(offset||0),code=input.charCodeAt(pos);return code===CHARCODE_SPACE||code===CHARCODE_CR||code===CHARCODE_TAB||code===CHARCODE_LF},parserInput.$=function(tok){var match,length,tokType=typeof tok;return"string"===tokType?input.charAt(parserInput.i)!==tok?null:(skipWhitespace(1),tok):(sync(),(match=tok.exec(current))?(length=match[0].length,skipWhitespace(length),"string"==typeof match?match:1===match.length?match[0]:match):null)},parserInput.$re=function(tok){parserInput.i>currentPos&&(current=current.slice(parserInput.i-currentPos),currentPos=parserInput.i);var m=tok.exec(current);return m?(skipWhitespace(m[0].length),"string"==typeof m?m:1===m.length?m[0]:m):null},parserInput.$char=function(tok){return input.charAt(parserInput.i)!==tok?null:(skipWhitespace(1),tok)};var CHARCODE_SPACE=32,CHARCODE_TAB=9,CHARCODE_LF=10,CHARCODE_CR=13,CHARCODE_PLUS=43,CHARCODE_COMMA=44,CHARCODE_FORWARD_SLASH=47,CHARCODE_9=57;parserInput.autoCommentAbsorb=!0,parserInput.commentStore=[],parserInput.finished=!1;var skipWhitespace=function(length){for(var c,nextChar,comment,oldi=parserInput.i,oldj=j,curr=parserInput.i-currentPos,endIndex=parserInput.i+current.length-curr,mem=parserInput.i+=length,inp=input;parserInput.i<endIndex;parserInput.i++){if(c=inp.charCodeAt(parserInput.i),parserInput.autoCommentAbsorb&&c===CHARCODE_FORWARD_SLASH){if(nextChar=inp.charAt(parserInput.i+1),"/"===nextChar){comment={index:parserInput.i,isLineComment:!0};var nextNewLine=inp.indexOf("\n",parserInput.i+1);0>nextNewLine&&(nextNewLine=endIndex),parserInput.i=nextNewLine,comment.text=inp.substr(comment.i,parserInput.i-comment.i),parserInput.commentStore.push(comment);continue}if("*"===nextChar){var haystack=inp.substr(parserInput.i),comment_search_result=haystack.match(/^\/\*(?:[^*]|\*+[^\/*])*\*+\//);if(comment_search_result){comment={index:parserInput.i,text:comment_search_result[0],isLineComment:!1},parserInput.i+=comment.text.length-1,parserInput.commentStore.push(comment);continue}}break}if(c!==CHARCODE_SPACE&&c!==CHARCODE_LF&&c!==CHARCODE_TAB&&c!==CHARCODE_CR)break}if(current=current.slice(length+parserInput.i-mem+curr),currentPos=parserInput.i,!current.length){if(j<chunks.length-1)return current=chunks[++j],skipWhitespace(0),!0;parserInput.finished=!0}return oldi!==parserInput.i||oldj!==j};return parserInput.peek=function(tok){return"string"==typeof tok?input.charAt(parserInput.i)===tok:tok.test(current)},parserInput.peekChar=function(tok){return input.charAt(parserInput.i)===tok},parserInput.currentChar=function(){return input.charAt(parserInput.i)},parserInput.getInput=function(){return input},parserInput.peekNotNumeric=function(){var c=input.charCodeAt(parserInput.i);return c>CHARCODE_9||CHARCODE_PLUS>c||c===CHARCODE_FORWARD_SLASH||c===CHARCODE_COMMA},parserInput.start=function(str,chunkInput,failFunction){input=str,parserInput.i=j=currentPos=furthest=0,chunks=chunkInput?chunker(str,failFunction):[str],current=chunks[0],skipWhitespace(0)},parserInput.end=function(){var message,isFinished=parserInput.i>=input.length;return parserInput.i<furthest&&(message=furthestPossibleErrorMessage,parserInput.i=furthest),{isFinished:isFinished,furthest:parserInput.i,furthestPossibleErrorMessage:message,furthestReachedEnd:parserInput.i>=input.length-1,furthestChar:input[parserInput.i]}},parserInput}},{"./chunker":34}],36:[function(require,module,exports){var LessError=require("../less-error"),tree=require("../tree"),visitors=require("../visitors"),getParserInput=require("./parser-input"),utils=require("../utils"),Parser=function Parser(context,imports,fileInfo){function expect(arg,msg,index){var result="[object Function]"===Object.prototype.toString.call(arg)?arg.call(parsers):parserInput.$(arg);return result?result:void error(msg||("string"==typeof arg?"expected '"+arg+"' got '"+parserInput.currentChar()+"'":"unexpected token"))}function expectChar(arg,msg){return parserInput.$char(arg)?arg:void error(msg||"expected '"+arg+"' got '"+parserInput.currentChar()+"'")}function error(msg,type){throw new LessError({index:parserInput.i,filename:fileInfo.filename,type:type||"Syntax",message:msg},imports)}function getDebugInfo(index){var filename=fileInfo.filename;return{lineNumber:utils.getLocation(index,parserInput.getInput()).line+1,fileName:filename}}var parsers,parserInput=getParserInput();return{parse:function(str,callback,additionalData){var root,globalVars,modifyVars,ignored,error=null,preText="";if(globalVars=additionalData&&additionalData.globalVars?Parser.serializeVars(additionalData.globalVars)+"\n":"",modifyVars=additionalData&&additionalData.modifyVars?"\n"+Parser.serializeVars(additionalData.modifyVars):"",context.pluginManager)for(var preProcessors=context.pluginManager.getPreProcessors(),i=0;i<preProcessors.length;i++)str=preProcessors[i].process(str,{context:context,imports:imports,fileInfo:fileInfo});(globalVars||additionalData&&additionalData.banner)&&(preText=(additionalData&&additionalData.banner?additionalData.banner:"")+globalVars,ignored=imports.contentsIgnoredChars,ignored[fileInfo.filename]=ignored[fileInfo.filename]||0,ignored[fileInfo.filename]+=preText.length),str=str.replace(/\r\n?/g,"\n"),str=preText+str.replace(/^\uFEFF/,"")+modifyVars,imports.contents[fileInfo.filename]=str;try{parserInput.start(str,context.chunkInput,function(msg,index){throw LessError({index:index,type:"Parse",message:msg,filename:fileInfo.filename},imports)}),root=new tree.Ruleset(null,this.parsers.primary()),root.root=!0,root.firstRoot=!0}catch(e){return callback(new LessError(e,imports,fileInfo.filename))}var endInfo=parserInput.end();if(!endInfo.isFinished){var message=endInfo.furthestPossibleErrorMessage;message||(message="Unrecognised input","}"===endInfo.furthestChar?message+=". Possibly missing opening '{'":")"===endInfo.furthestChar?message+=". Possibly missing opening '('":endInfo.furthestReachedEnd&&(message+=". Possibly missing something")),error=new LessError({type:"Parse",message:message,index:endInfo.furthest,
filename:fileInfo.filename},imports)}var finish=function(e){return e=error||e||imports.error,e?(e instanceof LessError||(e=new LessError(e,imports,fileInfo.filename)),callback(e)):callback(null,root)};return context.processImports===!1?finish():void new visitors.ImportVisitor(imports,finish).run(root)},parsers:parsers={primary:function(){for(var node,mixin=this.mixin,root=[];;){for(;;){if(node=this.comment(),!node)break;root.push(node)}if(parserInput.finished)break;if(parserInput.peek("}"))break;if(node=this.extendRule())root=root.concat(node);else if(node=mixin.definition()||this.rule()||this.ruleset()||mixin.call()||this.rulesetCall()||this.directive())root.push(node);else if(!parserInput.$re(/^[\s\n]+/)&&!parserInput.$re(/^;+/))break}return root},comment:function(){if(parserInput.commentStore.length){var comment=parserInput.commentStore.shift();return new tree.Comment(comment.text,comment.isLineComment,comment.index,fileInfo)}},entities:{quoted:function(){var str,index=parserInput.i;return str=parserInput.$re(/^(~)?("((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)')/),str?new tree.Quoted(str[2],str[3]||str[4],Boolean(str[1]),index,fileInfo):void 0},keyword:function(){var k=parserInput.$re(/^%|^[_A-Za-z-][_A-Za-z0-9-]*/);return k?tree.Color.fromKeyword(k)||new tree.Keyword(k):void 0},call:function(){var name,nameLC,args,alpha,index=parserInput.i;if(!parserInput.peek(/^url\(/i))return parserInput.save(),(name=parserInput.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(name=name[1],nameLC=name.toLowerCase(),"alpha"===nameLC&&(alpha=parsers.alpha())?alpha:(args=this.arguments(),parserInput.$char(")")?(parserInput.forget(),new tree.Call(name,args,index,fileInfo)):void parserInput.restore("Could not parse call arguments or missing ')'"))):void parserInput.forget()},arguments:function(){for(var arg,args=[];;){if(arg=this.assignment()||parsers.expression(),!arg)break;if(args.push(arg),!parserInput.$char(","))break}return args},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var key,value;return key=parserInput.$re(/^\w+(?=\s?=)/i),key&&parserInput.$char("=")?(value=parsers.entity(),value?new tree.Assignment(key,value):void 0):void 0},url:function(){var value,index=parserInput.i;return parserInput.autoCommentAbsorb=!1,"u"===parserInput.currentChar()&&parserInput.$re(/^url\(/)?(value=this.quoted()||this.variable()||parserInput.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",parserInput.autoCommentAbsorb=!0,expectChar(")"),new tree.URL(null!=value.value||value instanceof tree.Variable?value:new tree.Anonymous(value),index,fileInfo)):void(parserInput.autoCommentAbsorb=!0)},variable:function(){var name,index=parserInput.i;return"@"===parserInput.currentChar()&&(name=parserInput.$re(/^@@?[\w-]+/))?new tree.Variable(name,index,fileInfo):void 0},variableCurly:function(){var curly,index=parserInput.i;return"@"===parserInput.currentChar()&&(curly=parserInput.$re(/^@\{([\w-]+)\}/))?new tree.Variable("@"+curly[1],index,fileInfo):void 0},color:function(){var rgb;if("#"===parserInput.currentChar()&&(rgb=parserInput.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var colorCandidateString=rgb.input.match(/^#([\w]+).*/);return colorCandidateString=colorCandidateString[1],colorCandidateString.match(/^[A-Fa-f0-9]+$/)||error("Invalid HEX color code"),new tree.Color(rgb[1])}},dimension:function(){if(!parserInput.peekNotNumeric()){var value=parserInput.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return value?new tree.Dimension(value[1],value[2]):void 0}},unicodeDescriptor:function(){var ud;return ud=parserInput.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/),ud?new tree.UnicodeDescriptor(ud[0]):void 0},javascript:function(){var js,index=parserInput.i;return js=parserInput.$re(/^(~)?`([^`]*)`/),js?new tree.JavaScript(js[2],Boolean(js[1]),index,fileInfo):void 0}},variable:function(){var name;return"@"===parserInput.currentChar()&&(name=parserInput.$re(/^(@[\w-]+)\s*:/))?name[1]:void 0},rulesetCall:function(){var name;return"@"===parserInput.currentChar()&&(name=parserInput.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/))?new tree.RulesetCall(name[1]):void 0},extend:function(isRule){var elements,e,option,extendList,extend,index=parserInput.i;if(isRule?parserInput.$re(/^&:extend\(/):parserInput.$re(/^:extend\(/)){do{for(option=null,elements=null;!(option=parserInput.$re(/^(all)(?=\s*(\)|,))/))&&(e=this.element());)elements?elements.push(e):elements=[e];option=option&&option[1],elements||error("Missing target selector for :extend()."),extend=new tree.Extend(new tree.Selector(elements),option,index),extendList?extendList.push(extend):extendList=[extend]}while(parserInput.$char(","));return expect(/^\)/),isRule&&expect(/^;/),extendList}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var elemIndex,elements,elem,e,c,args,s=parserInput.currentChar(),important=!1,index=parserInput.i;if("."===s||"#"===s){for(parserInput.save();;){if(elemIndex=parserInput.i,e=parserInput.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),!e)break;elem=new tree.Element(c,e,elemIndex,fileInfo),elements?elements.push(elem):elements=[elem],c=parserInput.$char(">")}return elements&&(parserInput.$char("(")&&(args=this.args(!0).args,expectChar(")")),parsers.important()&&(important=!0),parsers.end())?(parserInput.forget(),new tree.mixin.Call(elements,args,index,fileInfo,important)):void parserInput.restore()}},args:function(isCall){var isSemiColonSeparated,expressionContainsNamed,name,nameLoop,value,arg,entities=parsers.entities,returner={args:null,variadic:!1},expressions=[],argsSemiColon=[],argsComma=[];for(parserInput.save();;){if(isCall)arg=parsers.detachedRuleset()||parsers.expression();else{if(parserInput.commentStore.length=0,"."===parserInput.currentChar()&&parserInput.$re(/^\.{3}/)){returner.variadic=!0,parserInput.$char(";")&&!isSemiColonSeparated&&(isSemiColonSeparated=!0),(isSemiColonSeparated?argsSemiColon:argsComma).push({variadic:!0});break}arg=entities.variable()||entities.literal()||entities.keyword()}if(!arg)break;nameLoop=null,arg.throwAwayComments&&arg.throwAwayComments(),value=arg;var val=null;if(isCall?arg.value&&1==arg.value.length&&(val=arg.value[0]):val=arg,val&&val instanceof tree.Variable)if(parserInput.$char(":")){if(expressions.length>0&&(isSemiColonSeparated&&error("Cannot mix ; and , as delimiter types"),expressionContainsNamed=!0),value=isCall&&parsers.detachedRuleset()||parsers.expression(),!value){if(!isCall)return parserInput.restore(),returner.args=[],returner;error("could not understand value for named argument")}nameLoop=name=val.name}else{if(!isCall&&parserInput.$re(/^\.{3}/)){returner.variadic=!0,parserInput.$char(";")&&!isSemiColonSeparated&&(isSemiColonSeparated=!0),(isSemiColonSeparated?argsSemiColon:argsComma).push({name:arg.name,variadic:!0});break}isCall||(name=nameLoop=val.name,value=null)}value&&expressions.push(value),argsComma.push({name:nameLoop,value:value}),parserInput.$char(",")||(parserInput.$char(";")||isSemiColonSeparated)&&(expressionContainsNamed&&error("Cannot mix ; and , as delimiter types"),isSemiColonSeparated=!0,expressions.length>1&&(value=new tree.Value(expressions)),argsSemiColon.push({name:name,value:value}),name=null,expressions=[],expressionContainsNamed=!1)}return parserInput.forget(),returner.args=isSemiColonSeparated?argsSemiColon:argsComma,returner},definition:function(){var name,match,ruleset,cond,params=[],variadic=!1;if(!("."!==parserInput.currentChar()&&"#"!==parserInput.currentChar()||parserInput.peek(/^[^{]*\}/)))if(parserInput.save(),match=parserInput.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){name=match[1];var argInfo=this.args(!1);if(params=argInfo.args,variadic=argInfo.variadic,!parserInput.$char(")"))return void parserInput.restore("Missing closing ')'");if(parserInput.commentStore.length=0,parserInput.$re(/^when/)&&(cond=expect(parsers.conditions,"expected condition")),ruleset=parsers.block())return parserInput.forget(),new tree.mixin.Definition(name,params,ruleset,cond,variadic);parserInput.restore()}else parserInput.forget()}},entity:function(){var entities=this.entities;return this.comment()||entities.literal()||entities.variable()||entities.url()||entities.call()||entities.keyword()||entities.javascript()},end:function(){return parserInput.$char(";")||parserInput.peek("}")},alpha:function(){var value;if(parserInput.$re(/^opacity=/i))return value=parserInput.$re(/^\d+/),value||(value=expect(this.entities.variable,"Could not parse alpha")),expectChar(")"),new tree.Alpha(value)},element:function(){var e,c,v,index=parserInput.i;return c=this.combinator(),e=parserInput.$re(/^(?:\d+\.\d+|\d+)%/)||parserInput.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||parserInput.$char("*")||parserInput.$char("&")||this.attribute()||parserInput.$re(/^\([^&()@]+\)/)||parserInput.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),e||(parserInput.save(),parserInput.$char("(")?(v=this.selector())&&parserInput.$char(")")?(e=new tree.Paren(v),parserInput.forget()):parserInput.restore("Missing closing ')'"):parserInput.forget()),e?new tree.Element(c,e,index,fileInfo):void 0},combinator:function(){var c=parserInput.currentChar();if("/"===c){parserInput.save();var slashedCombinator=parserInput.$re(/^\/[a-z]+\//i);if(slashedCombinator)return parserInput.forget(),new tree.Combinator(slashedCombinator);parserInput.restore()}if(">"===c||"+"===c||"~"===c||"|"===c||"^"===c){for(parserInput.i++,"^"===c&&"^"===parserInput.currentChar()&&(c="^^",parserInput.i++);parserInput.isWhitespace();)parserInput.i++;return new tree.Combinator(c)}return parserInput.isWhitespace(-1)?new tree.Combinator(" "):new tree.Combinator(null)},lessSelector:function(){return this.selector(!0)},selector:function(isLess){for(var elements,extendList,c,e,allExtends,when,condition,index=parserInput.i;(isLess&&(extendList=this.extend())||isLess&&(when=parserInput.$re(/^when/))||(e=this.element()))&&(when?condition=expect(this.conditions,"expected condition"):condition?error("CSS guard can only be used at the end of selector"):extendList?allExtends=allExtends?allExtends.concat(extendList):extendList:(allExtends&&error("Extend can only be used at the end of selector"),c=parserInput.currentChar(),elements?elements.push(e):elements=[e],e=null),"{"!==c&&"}"!==c&&";"!==c&&","!==c&&")"!==c););return elements?new tree.Selector(elements,allExtends,condition,index,fileInfo):void(allExtends&&error("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(parserInput.$char("[")){var key,val,op,entities=this.entities;return(key=entities.variableCurly())||(key=expect(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),op=parserInput.$re(/^[|~*$^]?=/),op&&(val=entities.quoted()||parserInput.$re(/^[0-9]+%/)||parserInput.$re(/^[\w-]+/)||entities.variableCurly()),expectChar("]"),new tree.Attribute(key,op,val)}},block:function(){var content;return parserInput.$char("{")&&(content=this.primary())&&parserInput.$char("}")?content:void 0},blockRuleset:function(){var block=this.block();return block&&(block=new tree.Ruleset(null,block)),block},detachedRuleset:function(){var blockRuleset=this.blockRuleset();return blockRuleset?new tree.DetachedRuleset(blockRuleset):void 0},ruleset:function(){var selectors,s,rules,debugInfo;for(parserInput.save(),context.dumpLineNumbers&&(debugInfo=getDebugInfo(parserInput.i));;){if(s=this.lessSelector(),!s)break;if(selectors?selectors.push(s):selectors=[s],parserInput.commentStore.length=0,s.condition&&selectors.length>1&&error("Guards are only currently allowed on a single selector."),!parserInput.$char(","))break;s.condition&&error("Guards are only currently allowed on a single selector."),parserInput.commentStore.length=0}if(selectors&&(rules=this.block())){parserInput.forget();var ruleset=new tree.Ruleset(selectors,rules,context.strictImports);return context.dumpLineNumbers&&(ruleset.debugInfo=debugInfo),ruleset}parserInput.restore()},rule:function(tryAnonymous){var name,value,important,merge,isVariable,startOfRule=parserInput.i,c=parserInput.currentChar();if("."!==c&&"#"!==c&&"&"!==c)if(parserInput.save(),name=this.variable()||this.ruleProperty()){if(isVariable="string"==typeof name,isVariable&&(value=this.detachedRuleset()),parserInput.commentStore.length=0,!value){merge=!isVariable&&name.pop().value;var tryValueFirst=!tryAnonymous&&(context.compress||isVariable);if(tryValueFirst&&(value=this.value()),!value&&(value=this.anonymousValue()))return parserInput.forget(),new tree.Rule(name,value,!1,merge,startOfRule,fileInfo);tryValueFirst||value||(value=this.value()),important=this.important()}if(value&&this.end())return parserInput.forget(),new tree.Rule(name,value,important,merge,startOfRule,fileInfo);if(parserInput.restore(),value&&!tryAnonymous)return this.rule(!0)}else parserInput.forget()},anonymousValue:function(){var match=parserInput.$re(/^([^@+\/'"*`(;{}-]*);/);return match?new tree.Anonymous(match[1]):void 0},"import":function(){var path,features,index=parserInput.i,dir=parserInput.$re(/^@import?\s+/);if(dir){var options=(dir?this.importOptions():null)||{};if(path=this.entities.quoted()||this.entities.url())return features=this.mediaFeatures(),parserInput.$(";")||(parserInput.i=index,error("missing semi-colon or unrecognised media features on import")),features=features&&new tree.Value(features),new tree.Import(path,features,options,index,fileInfo);parserInput.i=index,error("malformed import statement")}},importOptions:function(){var o,optionName,value,options={};if(!parserInput.$char("("))return null;do if(o=this.importOption()){switch(optionName=o,value=!0,optionName){case"css":optionName="less",value=!1;break;case"once":optionName="multiple",value=!1}if(options[optionName]=value,!parserInput.$char(","))break}while(o);return expectChar(")"),options},importOption:function(){var opt=parserInput.$re(/^(less|css|multiple|once|inline|reference|optional)/);return opt?opt[1]:void 0},mediaFeature:function(){var e,p,entities=this.entities,nodes=[];parserInput.save();do if(e=entities.keyword()||entities.variable())nodes.push(e);else if(parserInput.$char("(")){if(p=this.property(),e=this.value(),!parserInput.$char(")"))return parserInput.restore("Missing closing ')'"),null;if(p&&e)nodes.push(new tree.Paren(new tree.Rule(p,e,null,null,parserInput.i,fileInfo,!0)));else{if(!e)return parserInput.restore("badly formed media feature definition"),null;nodes.push(new tree.Paren(e))}}while(e);return parserInput.forget(),nodes.length>0?new tree.Expression(nodes):void 0},mediaFeatures:function(){var e,entities=this.entities,features=[];do if(e=this.mediaFeature()){if(features.push(e),!parserInput.$char(","))break}else if(e=entities.variable(),e&&(features.push(e),!parserInput.$char(",")))break;while(e);return features.length>0?features:null},media:function(){var features,rules,media,debugInfo;return context.dumpLineNumbers&&(debugInfo=getDebugInfo(parserInput.i)),parserInput.$re(/^@media/)&&(features=this.mediaFeatures(),rules=this.block())?(media=new tree.Media(rules,features,parserInput.i,fileInfo),context.dumpLineNumbers&&(media.debugInfo=debugInfo),media):void 0},directive:function(){var name,value,rules,nonVendorSpecificName,hasIdentifier,hasExpression,hasUnknown,index=parserInput.i,hasBlock=!0;if("@"===parserInput.currentChar()){if(value=this["import"]()||this.media())return value;if(parserInput.save(),name=parserInput.$re(/^@[a-z-]+/)){switch(nonVendorSpecificName=name,"-"==name.charAt(1)&&name.indexOf("-",2)>0&&(nonVendorSpecificName="@"+name.slice(name.indexOf("-",2)+1)),nonVendorSpecificName){case"@counter-style":hasIdentifier=!0,hasBlock=!0;break;case"@charset":hasIdentifier=!0,hasBlock=!1;break;case"@namespace":hasExpression=!0,hasBlock=!1;break;case"@keyframes":hasIdentifier=!0;break;case"@host":case"@page":case"@document":case"@supports":hasUnknown=!0}return parserInput.commentStore.length=0,hasIdentifier?(value=this.entity(),value||error("expected "+name+" identifier")):hasExpression?(value=this.expression(),value||error("expected "+name+" expression")):hasUnknown&&(value=(parserInput.$re(/^[^{;]+/)||"").trim(),value&&(value=new tree.Anonymous(value))),hasBlock&&(rules=this.blockRuleset()),rules||!hasBlock&&value&&parserInput.$char(";")?(parserInput.forget(),new tree.Directive(name,value,rules,index,fileInfo,context.dumpLineNumbers?getDebugInfo(index):null)):void parserInput.restore("directive options not recognised")}}},value:function(){var e,expressions=[];do if(e=this.expression(),e&&(expressions.push(e),!parserInput.$char(",")))break;while(e);return expressions.length>0?new tree.Value(expressions):void 0},important:function(){return"!"===parserInput.currentChar()?parserInput.$re(/^! *important/):void 0},sub:function(){var a,e;return parserInput.save(),parserInput.$char("(")?(a=this.addition(),a&&parserInput.$char(")")?(parserInput.forget(),e=new tree.Expression([a]),e.parens=!0,e):void parserInput.restore("Expected ')'")):void parserInput.restore()},multiplication:function(){var m,a,op,operation,isSpaced;if(m=this.operand()){for(isSpaced=parserInput.isWhitespace(-1);;){if(parserInput.peek(/^\/[*\/]/))break;if(parserInput.save(),op=parserInput.$char("/")||parserInput.$char("*"),!op){parserInput.forget();break}if(a=this.operand(),!a){parserInput.restore();break}parserInput.forget(),m.parensInOp=!0,a.parensInOp=!0,operation=new tree.Operation(op,[operation||m,a],isSpaced),isSpaced=parserInput.isWhitespace(-1)}return operation||m}},addition:function(){var m,a,op,operation,isSpaced;if(m=this.multiplication()){for(isSpaced=parserInput.isWhitespace(-1);;){if(op=parserInput.$re(/^[-+]\s+/)||!isSpaced&&(parserInput.$char("+")||parserInput.$char("-")),!op)break;if(a=this.multiplication(),!a)break;m.parensInOp=!0,a.parensInOp=!0,operation=new tree.Operation(op,[operation||m,a],isSpaced),isSpaced=parserInput.isWhitespace(-1)}return operation||m}},conditions:function(){var a,b,condition,index=parserInput.i;if(a=this.condition()){for(;;){if(!parserInput.peek(/^,\s*(not\s*)?\(/)||!parserInput.$char(","))break;if(b=this.condition(),!b)break;condition=new tree.Condition("or",condition||a,b,index)}return condition||a}},condition:function(){var a,b,c,op,entities=this.entities,index=parserInput.i,negate=!1;return parserInput.$re(/^not/)&&(negate=!0),expectChar("("),a=this.addition()||entities.keyword()||entities.quoted(),a?(op=parserInput.$re(/^(?:>=|<=|=<|[<=>])/),op?(b=this.addition()||entities.keyword()||entities.quoted(),b?c=new tree.Condition(op,a,b,index,negate):error("expected expression")):c=new tree.Condition("=",a,new tree.Keyword("true"),index,negate),expectChar(")"),parserInput.$re(/^and/)?new tree.Condition("and",c,this.condition()):c):void 0},operand:function(){var negate,entities=this.entities;parserInput.peek(/^-[@\(]/)&&(negate=parserInput.$char("-"));var o=this.sub()||entities.dimension()||entities.color()||entities.variable()||entities.call();return negate&&(o.parensInOp=!0,o=new tree.Negative(o)),o},expression:function(){var e,delim,entities=[];do e=this.comment(),e?entities.push(e):(e=this.addition()||this.entity(),e&&(entities.push(e),parserInput.peek(/^\/[\/*]/)||(delim=parserInput.$char("/"),delim&&entities.push(new tree.Anonymous(delim)))));while(e);return entities.length>0?new tree.Expression(entities):void 0},property:function(){var name=parserInput.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);return name?name[1]:void 0},ruleProperty:function(){function match(re){var i=parserInput.i,chunk=parserInput.$re(re);return chunk?(index.push(i),name.push(chunk[1])):void 0}var s,k,name=[],index=[];for(parserInput.save(),match(/^(\*?)/);;)if(!match(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/))break;if(name.length>1&&match(/^((?:\+_|\+)?)\s*:/)){for(parserInput.forget(),""===name[0]&&(name.shift(),index.shift()),k=0;k<name.length;k++)s=name[k],name[k]="@"!==s.charAt(0)?new tree.Keyword(s):new tree.Variable("@"+s.slice(2,-1),index[k],fileInfo);return name}parserInput.restore()}}}};Parser.serializeVars=function(vars){var s="";for(var name in vars)if(Object.hasOwnProperty.call(vars,name)){var value=vars[name];s+=("@"===name[0]?"":"@")+name+": "+value+(";"===String(value).slice(-1)?"":";")}return s},module.exports=Parser},{"../less-error":30,"../tree":59,"../utils":80,"../visitors":84,"./parser-input":35}],37:[function(require,module,exports){var PluginManager=function(less){this.less=less,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};PluginManager.prototype.addPlugins=function(plugins){if(plugins)for(var i=0;i<plugins.length;i++)this.addPlugin(plugins[i])},PluginManager.prototype.addPlugin=function(plugin){this.installedPlugins.push(plugin),plugin.install(this.less,this)},PluginManager.prototype.addVisitor=function(visitor){this.visitors.push(visitor)},PluginManager.prototype.addPreProcessor=function(preProcessor,priority){var indexToInsertAt;for(indexToInsertAt=0;indexToInsertAt<this.preProcessors.length&&!(this.preProcessors[indexToInsertAt].priority>=priority);indexToInsertAt++);this.preProcessors.splice(indexToInsertAt,0,{preProcessor:preProcessor,priority:priority})},PluginManager.prototype.addPostProcessor=function(postProcessor,priority){var indexToInsertAt;for(indexToInsertAt=0;indexToInsertAt<this.postProcessors.length&&!(this.postProcessors[indexToInsertAt].priority>=priority);indexToInsertAt++);this.postProcessors.splice(indexToInsertAt,0,{postProcessor:postProcessor,priority:priority})},PluginManager.prototype.addFileManager=function(manager){this.fileManagers.push(manager)},PluginManager.prototype.getPreProcessors=function(){for(var preProcessors=[],i=0;i<this.preProcessors.length;i++)preProcessors.push(this.preProcessors[i].preProcessor);return preProcessors},PluginManager.prototype.getPostProcessors=function(){for(var postProcessors=[],i=0;i<this.postProcessors.length;i++)postProcessors.push(this.postProcessors[i].postProcessor);return postProcessors},PluginManager.prototype.getVisitors=function(){return this.visitors},PluginManager.prototype.getFileManagers=function(){return this.fileManagers},module.exports=PluginManager},{}],38:[function(require,module,exports){var PromiseConstructor;module.exports=function(environment,ParseTree,ImportManager){var render=function(input,options,callback){if("function"==typeof options&&(callback=options,options={}),!callback){PromiseConstructor||(PromiseConstructor="undefined"==typeof Promise?require("promise"):Promise);var self=this;return new PromiseConstructor(function(resolve,reject){render.call(self,input,options,function(err,output){err?reject(err):resolve(output)})})}this.parse(input,options,function(err,root,imports,options){if(err)return callback(err);var result;try{var parseTree=new ParseTree(root,imports);result=parseTree.toCSS(options)}catch(err){return callback(err)}callback(null,result)})};return render}},{promise:void 0}],39:[function(require,module,exports){module.exports=function(SourceMapOutput,environment){var SourceMapBuilder=function(options){this.options=options};return SourceMapBuilder.prototype.toCSS=function(rootNode,options,imports){var sourceMapOutput=new SourceMapOutput({contentsIgnoredCharsMap:imports.contentsIgnoredChars,rootNode:rootNode,contentsMap:imports.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),css=sourceMapOutput.toCSS(options);return this.sourceMap=sourceMapOutput.sourceMap,this.sourceMapURL=sourceMapOutput.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=sourceMapOutput.normalizeFilename(this.options.sourceMapInputFilename)),css+this.getCSSAppendage()},SourceMapBuilder.prototype.getCSSAppendage=function(){var sourceMapURL=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";sourceMapURL="data:application/json;base64,"+environment.encodeBase64(this.sourceMap)}return sourceMapURL?"/*# sourceMappingURL="+sourceMapURL+" */":""},SourceMapBuilder.prototype.getExternalSourceMap=function(){return this.sourceMap},SourceMapBuilder.prototype.setExternalSourceMap=function(sourceMap){this.sourceMap=sourceMap},SourceMapBuilder.prototype.isInline=function(){return this.options.sourceMapFileInline},SourceMapBuilder.prototype.getSourceMapURL=function(){return this.sourceMapURL},SourceMapBuilder.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},SourceMapBuilder.prototype.getInputFilename=function(){return this.sourceMapInputFilename},SourceMapBuilder}},{}],40:[function(require,module,exports){module.exports=function(environment){var SourceMapOutput=function(options){this._css=[],this._rootNode=options.rootNode,this._contentsMap=options.contentsMap,this._contentsIgnoredCharsMap=options.contentsIgnoredCharsMap,options.sourceMapFilename&&(this._sourceMapFilename=options.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=options.outputFilename,this.sourceMapURL=options.sourceMapURL,options.sourceMapBasepath&&(this._sourceMapBasepath=options.sourceMapBasepath.replace(/\\/g,"/")),options.sourceMapRootpath?(this._sourceMapRootpath=options.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=options.outputSourceFiles,this._sourceMapGeneratorConstructor=environment.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return SourceMapOutput.prototype.normalizeFilename=function(filename){return filename=filename.replace(/\\/g,"/"),this._sourceMapBasepath&&0===filename.indexOf(this._sourceMapBasepath)&&(filename=filename.substring(this._sourceMapBasepath.length),("\\"===filename.charAt(0)||"/"===filename.charAt(0))&&(filename=filename.substring(1))),(this._sourceMapRootpath||"")+filename},SourceMapOutput.prototype.add=function(chunk,fileInfo,index,mapLines){if(chunk){var lines,sourceLines,columns,sourceColumns,i;if(fileInfo){var inputSource=this._contentsMap[fileInfo.filename];this._contentsIgnoredCharsMap[fileInfo.filename]&&(index-=this._contentsIgnoredCharsMap[fileInfo.filename],0>index&&(index=0),inputSource=inputSource.slice(this._contentsIgnoredCharsMap[fileInfo.filename])),inputSource=inputSource.substring(0,index),sourceLines=inputSource.split("\n"),sourceColumns=sourceLines[sourceLines.length-1]}if(lines=chunk.split("\n"),columns=lines[lines.length-1],fileInfo)if(mapLines)for(i=0;i<lines.length;i++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+i+1,column:0===i?this._column:0},original:{line:sourceLines.length+i,column:0===i?sourceColumns.length:0},source:this.normalizeFilename(fileInfo.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:sourceLines.length,column:sourceColumns.length},source:this.normalizeFilename(fileInfo.filename)});1===lines.length?this._column+=columns.length:(this._lineNumber+=lines.length-1,this._column=columns.length),this._css.push(chunk)}},SourceMapOutput.prototype.isEmpty=function(){return 0===this._css.length},SourceMapOutput.prototype.toCSS=function(context){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var filename in this._contentsMap)if(this._contentsMap.hasOwnProperty(filename)){var source=this._contentsMap[filename];this._contentsIgnoredCharsMap[filename]&&(source=source.slice(this._contentsIgnoredCharsMap[filename])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(filename),source)}if(this._rootNode.genCSS(context,this),this._css.length>0){var sourceMapURL,sourceMapContent=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?sourceMapURL=this.sourceMapURL:this._sourceMapFilename&&(sourceMapURL=this._sourceMapFilename),this.sourceMapURL=sourceMapURL,this.sourceMap=sourceMapContent}return this._css.join("")},SourceMapOutput}},{}],41:[function(require,module,exports){var contexts=require("./contexts"),visitor=require("./visitors"),tree=require("./tree");module.exports=function(root,options){options=options||{};var evaldRoot,variables=options.variables,evalEnv=new contexts.Eval(options);"object"!=typeof variables||Array.isArray(variables)||(variables=Object.keys(variables).map(function(k){var value=variables[k];return value instanceof tree.Value||(value instanceof tree.Expression||(value=new tree.Expression([value])),value=new tree.Value([value])),new tree.Rule("@"+k,value,!1,null,0)}),evalEnv.frames=[new tree.Ruleset(null,variables)]);var i,preEvalVisitors=[],visitors=[new visitor.JoinSelectorVisitor,new visitor.ExtendVisitor,new visitor.ToCSSVisitor({compress:Boolean(options.compress)})];if(options.pluginManager){var pluginVisitors=options.pluginManager.getVisitors();for(i=0;i<pluginVisitors.length;i++){var pluginVisitor=pluginVisitors[i];pluginVisitor.isPreEvalVisitor?preEvalVisitors.push(pluginVisitor):pluginVisitor.isPreVisitor?visitors.splice(0,0,pluginVisitor):visitors.push(pluginVisitor)}}for(i=0;i<preEvalVisitors.length;i++)preEvalVisitors[i].run(root);for(evaldRoot=root.eval(evalEnv),i=0;i<visitors.length;i++)visitors[i].run(evaldRoot);return evaldRoot}},{"./contexts":10,"./tree":59,"./visitors":84}],42:[function(require,module,exports){var Node=require("./node"),Alpha=function(val){this.value=val};Alpha.prototype=new Node,Alpha.prototype.type="Alpha",Alpha.prototype.accept=function(visitor){this.value=visitor.visit(this.value)},Alpha.prototype.eval=function(context){return this.value.eval?new Alpha(this.value.eval(context)):this},Alpha.prototype.genCSS=function(context,output){output.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(context,output):output.add(this.value),output.add(")")},module.exports=Alpha},{"./node":67}],43:[function(require,module,exports){var Node=require("./node"),Anonymous=function(value,index,currentFileInfo,mapLines,rulesetLike){this.value=value,this.index=index,this.mapLines=mapLines,this.currentFileInfo=currentFileInfo,this.rulesetLike="undefined"==typeof rulesetLike?!1:rulesetLike};Anonymous.prototype=new Node,Anonymous.prototype.type="Anonymous",Anonymous.prototype.eval=function(){return new Anonymous(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike)},Anonymous.prototype.compare=function(other){return other.toCSS&&this.toCSS()===other.toCSS()?0:void 0},Anonymous.prototype.isRulesetLike=function(){return this.rulesetLike},Anonymous.prototype.genCSS=function(context,output){output.add(this.value,this.currentFileInfo,this.index,this.mapLines)},module.exports=Anonymous},{"./node":67}],44:[function(require,module,exports){var Node=require("./node"),Assignment=function(key,val){this.key=key,this.value=val};Assignment.prototype=new Node,Assignment.prototype.type="Assignment",Assignment.prototype.accept=function(visitor){this.value=visitor.visit(this.value)},Assignment.prototype.eval=function(context){return this.value.eval?new Assignment(this.key,this.value.eval(context)):this},Assignment.prototype.genCSS=function(context,output){output.add(this.key+"="),this.value.genCSS?this.value.genCSS(context,output):output.add(this.value)},module.exports=Assignment},{"./node":67}],45:[function(require,module,exports){var Node=require("./node"),Attribute=function(key,op,value){this.key=key,this.op=op,this.value=value};Attribute.prototype=new Node,Attribute.prototype.type="Attribute",Attribute.prototype.eval=function(context){return new Attribute(this.key.eval?this.key.eval(context):this.key,this.op,this.value&&this.value.eval?this.value.eval(context):this.value)},Attribute.prototype.genCSS=function(context,output){output.add(this.toCSS(context));
},Attribute.prototype.toCSS=function(context){var value=this.key.toCSS?this.key.toCSS(context):this.key;return this.op&&(value+=this.op,value+=this.value.toCSS?this.value.toCSS(context):this.value),"["+value+"]"},module.exports=Attribute},{"./node":67}],46:[function(require,module,exports){var Node=require("./node"),FunctionCaller=require("../functions/function-caller"),Call=function(name,args,index,currentFileInfo){this.name=name,this.args=args,this.index=index,this.currentFileInfo=currentFileInfo};Call.prototype=new Node,Call.prototype.type="Call",Call.prototype.accept=function(visitor){this.args&&(this.args=visitor.visitArray(this.args))},Call.prototype.eval=function(context){var result,args=this.args.map(function(a){return a.eval(context)}),funcCaller=new FunctionCaller(this.name,context,this.index,this.currentFileInfo);if(funcCaller.isValid())try{if(result=funcCaller.call(args),null!=result)return result}catch(e){throw{type:e.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(e.message?": "+e.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new Call(this.name,args,this.index,this.currentFileInfo)},Call.prototype.genCSS=function(context,output){output.add(this.name+"(",this.currentFileInfo,this.index);for(var i=0;i<this.args.length;i++)this.args[i].genCSS(context,output),i+1<this.args.length&&output.add(", ");output.add(")")},module.exports=Call},{"../functions/function-caller":20,"./node":67}],47:[function(require,module,exports){function clamp(v,max){return Math.min(Math.max(v,0),max)}function toHex(v){return"#"+v.map(function(c){return c=clamp(Math.round(c),255),(16>c?"0":"")+c.toString(16)}).join("")}var Node=require("./node"),colors=require("../data/colors"),Color=function(rgb,a){Array.isArray(rgb)?this.rgb=rgb:6==rgb.length?this.rgb=rgb.match(/.{2}/g).map(function(c){return parseInt(c,16)}):this.rgb=rgb.split("").map(function(c){return parseInt(c+c,16)}),this.alpha="number"==typeof a?a:1};Color.prototype=new Node,Color.prototype.type="Color",Color.prototype.luma=function(){var r=this.rgb[0]/255,g=this.rgb[1]/255,b=this.rgb[2]/255;return r=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4),g=.03928>=g?g/12.92:Math.pow((g+.055)/1.055,2.4),b=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4),.2126*r+.7152*g+.0722*b},Color.prototype.genCSS=function(context,output){output.add(this.toCSS(context))},Color.prototype.toCSS=function(context,doNotCompress){var color,alpha,compress=context&&context.compress&&!doNotCompress;if(this.value)return this.value;if(alpha=this.fround(context,this.alpha),1>alpha)return"rgba("+this.rgb.map(function(c){return clamp(Math.round(c),255)}).concat(clamp(alpha,1)).join(","+(compress?"":" "))+")";if(color=this.toRGB(),compress){var splitcolor=color.split("");splitcolor[1]===splitcolor[2]&&splitcolor[3]===splitcolor[4]&&splitcolor[5]===splitcolor[6]&&(color="#"+splitcolor[1]+splitcolor[3]+splitcolor[5])}return color},Color.prototype.operate=function(context,op,other){for(var rgb=[],alpha=this.alpha*(1-other.alpha)+other.alpha,c=0;3>c;c++)rgb[c]=this._operate(context,op,this.rgb[c],other.rgb[c]);return new Color(rgb,alpha)},Color.prototype.toRGB=function(){return toHex(this.rgb)},Color.prototype.toHSL=function(){var h,s,r=this.rgb[0]/255,g=this.rgb[1]/255,b=this.rgb[2]/255,a=this.alpha,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2,d=max-min;if(max===min)h=s=0;else{switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:360*h,s:s,l:l,a:a}},Color.prototype.toHSV=function(){var h,s,r=this.rgb[0]/255,g=this.rgb[1]/255,b=this.rgb[2]/255,a=this.alpha,max=Math.max(r,g,b),min=Math.min(r,g,b),v=max,d=max-min;if(s=0===max?0:d/max,max===min)h=0;else{switch(max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:360*h,s:s,v:v,a:a}},Color.prototype.toARGB=function(){return toHex([255*this.alpha].concat(this.rgb))},Color.prototype.compare=function(x){return x.rgb&&x.rgb[0]===this.rgb[0]&&x.rgb[1]===this.rgb[1]&&x.rgb[2]===this.rgb[2]&&x.alpha===this.alpha?0:void 0},Color.fromKeyword=function(keyword){var c,key=keyword.toLowerCase();return colors.hasOwnProperty(key)?c=new Color(colors[key].slice(1)):"transparent"===key&&(c=new Color([0,0,0],0)),c?(c.value=keyword,c):void 0},module.exports=Color},{"../data/colors":11,"./node":67}],48:[function(require,module,exports){var Node=require("./node"),Combinator=function(value){" "===value?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=value?value.trim():"",this.emptyOrWhitespace=""===this.value)};Combinator.prototype=new Node,Combinator.prototype.type="Combinator";var _noSpaceCombinators={"":!0," ":!0,"|":!0};Combinator.prototype.genCSS=function(context,output){var spaceOrEmpty=context.compress||_noSpaceCombinators[this.value]?"":" ";output.add(spaceOrEmpty+this.value+spaceOrEmpty)},module.exports=Combinator},{"./node":67}],49:[function(require,module,exports){var Node=require("./node"),getDebugInfo=require("./debug-info"),Comment=function(value,isLineComment,index,currentFileInfo){this.value=value,this.isLineComment=isLineComment,this.currentFileInfo=currentFileInfo};Comment.prototype=new Node,Comment.prototype.type="Comment",Comment.prototype.genCSS=function(context,output){this.debugInfo&&output.add(getDebugInfo(context,this),this.currentFileInfo,this.index),output.add(this.value)},Comment.prototype.isSilent=function(context){var isReference=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,isCompressed=context.compress&&"!"!==this.value[2];return this.isLineComment||isReference||isCompressed},Comment.prototype.markReferenced=function(){this.isReferenced=!0},Comment.prototype.isRulesetLike=function(root){return Boolean(root)},module.exports=Comment},{"./debug-info":51,"./node":67}],50:[function(require,module,exports){var Node=require("./node"),Condition=function(op,l,r,i,negate){this.op=op.trim(),this.lvalue=l,this.rvalue=r,this.index=i,this.negate=negate};Condition.prototype=new Node,Condition.prototype.type="Condition",Condition.prototype.accept=function(visitor){this.lvalue=visitor.visit(this.lvalue),this.rvalue=visitor.visit(this.rvalue)},Condition.prototype.eval=function(context){var result=function(op,a,b){switch(op){case"and":return a&&b;case"or":return a||b;default:switch(Node.compare(a,b)){case-1:return"<"===op||"=<"===op||"<="===op;case 0:return"="===op||">="===op||"=<"===op||"<="===op;case 1:return">"===op||">="===op;default:return!1}}}(this.op,this.lvalue.eval(context),this.rvalue.eval(context));return this.negate?!result:result},module.exports=Condition},{"./node":67}],51:[function(require,module,exports){var debugInfo=function(context,ctx,lineSeparator){var result="";if(context.dumpLineNumbers&&!context.compress)switch(context.dumpLineNumbers){case"comments":result=debugInfo.asComment(ctx);break;case"mediaquery":result=debugInfo.asMediaQuery(ctx);break;case"all":result=debugInfo.asComment(ctx)+(lineSeparator||"")+debugInfo.asMediaQuery(ctx)}return result};debugInfo.asComment=function(ctx){return"/* line "+ctx.debugInfo.lineNumber+", "+ctx.debugInfo.fileName+" */\n"},debugInfo.asMediaQuery=function(ctx){var filenameWithProtocol=ctx.debugInfo.fileName;return/^[a-z]+:\/\//i.test(filenameWithProtocol)||(filenameWithProtocol="file://"+filenameWithProtocol),"@media -sass-debug-info{filename{font-family:"+filenameWithProtocol.replace(/([.:\/\\])/g,function(a){return"\\"==a&&(a="/"),"\\"+a})+"}line{font-family:\\00003"+ctx.debugInfo.lineNumber+"}}\n"},module.exports=debugInfo},{}],52:[function(require,module,exports){var Node=require("./node"),contexts=require("../contexts"),DetachedRuleset=function(ruleset,frames){this.ruleset=ruleset,this.frames=frames};DetachedRuleset.prototype=new Node,DetachedRuleset.prototype.type="DetachedRuleset",DetachedRuleset.prototype.evalFirst=!0,DetachedRuleset.prototype.accept=function(visitor){this.ruleset=visitor.visit(this.ruleset)},DetachedRuleset.prototype.eval=function(context){var frames=this.frames||context.frames.slice(0);return new DetachedRuleset(this.ruleset,frames)},DetachedRuleset.prototype.callEval=function(context){return this.ruleset.eval(this.frames?new contexts.Eval(context,this.frames.concat(context.frames)):context)},module.exports=DetachedRuleset},{"../contexts":10,"./node":67}],53:[function(require,module,exports){var Node=require("./node"),unitConversions=require("../data/unit-conversions"),Unit=require("./unit"),Color=require("./color"),Dimension=function(value,unit){this.value=parseFloat(value),this.unit=unit&&unit instanceof Unit?unit:new Unit(unit?[unit]:void 0)};Dimension.prototype=new Node,Dimension.prototype.type="Dimension",Dimension.prototype.accept=function(visitor){this.unit=visitor.visit(this.unit)},Dimension.prototype.eval=function(context){return this},Dimension.prototype.toColor=function(){return new Color([this.value,this.value,this.value])},Dimension.prototype.genCSS=function(context,output){if(context&&context.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var value=this.fround(context,this.value),strValue=String(value);if(0!==value&&1e-6>value&&value>-1e-6&&(strValue=value.toFixed(20).replace(/0+$/,"")),context&&context.compress){if(0===value&&this.unit.isLength())return void output.add(strValue);value>0&&1>value&&(strValue=strValue.substr(1))}output.add(strValue),this.unit.genCSS(context,output)},Dimension.prototype.operate=function(context,op,other){var value=this._operate(context,op,this.value,other.value),unit=this.unit.clone();if("+"===op||"-"===op)if(0===unit.numerator.length&&0===unit.denominator.length)unit.numerator=other.unit.numerator.slice(0),unit.denominator=other.unit.denominator.slice(0);else if(0===other.unit.numerator.length&&0===unit.denominator.length);else{if(other=other.convertTo(this.unit.usedUnits()),context.strictUnits&&other.unit.toString()!==unit.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+unit.toString()+"' and '"+other.unit.toString()+"'.");value=this._operate(context,op,this.value,other.value)}else"*"===op?(unit.numerator=unit.numerator.concat(other.unit.numerator).sort(),unit.denominator=unit.denominator.concat(other.unit.denominator).sort(),unit.cancel()):"/"===op&&(unit.numerator=unit.numerator.concat(other.unit.denominator).sort(),unit.denominator=unit.denominator.concat(other.unit.numerator).sort(),unit.cancel());return new Dimension(value,unit)},Dimension.prototype.compare=function(other){var a,b;if(!(other instanceof Dimension))return void 0;if(this.unit.isEmpty()||other.unit.isEmpty())a=this,b=other;else if(a=this.unify(),b=other.unify(),0!==a.unit.compare(b.unit))return void 0;return Node.numericCompare(a.value,b.value)},Dimension.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},Dimension.prototype.convertTo=function(conversions){var i,groupName,group,targetUnit,applyUnit,value=this.value,unit=this.unit.clone(),derivedConversions={};if("string"==typeof conversions){for(i in unitConversions)unitConversions[i].hasOwnProperty(conversions)&&(derivedConversions={},derivedConversions[i]=conversions);conversions=derivedConversions}applyUnit=function(atomicUnit,denominator){return group.hasOwnProperty(atomicUnit)?(denominator?value/=group[atomicUnit]/group[targetUnit]:value*=group[atomicUnit]/group[targetUnit],targetUnit):atomicUnit};for(groupName in conversions)conversions.hasOwnProperty(groupName)&&(targetUnit=conversions[groupName],group=unitConversions[groupName],unit.map(applyUnit));return unit.cancel(),new Dimension(value,unit)},module.exports=Dimension},{"../data/unit-conversions":13,"./color":47,"./node":67,"./unit":76}],54:[function(require,module,exports){var Node=require("./node"),Ruleset=require("./ruleset"),Directive=function(name,value,rules,index,currentFileInfo,debugInfo,isReferenced){this.name=name,this.value=value,rules&&(this.rules=rules,this.rules.allowImports=!0),this.index=index,this.currentFileInfo=currentFileInfo,this.debugInfo=debugInfo,this.isReferenced=isReferenced};Directive.prototype=new Node,Directive.prototype.type="Directive",Directive.prototype.accept=function(visitor){var value=this.value,rules=this.rules;rules&&(this.rules=visitor.visit(rules)),value&&(this.value=visitor.visit(value))},Directive.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},Directive.prototype.isCharset=function(){return"@charset"===this.name},Directive.prototype.genCSS=function(context,output){var value=this.value,rules=this.rules;output.add(this.name,this.currentFileInfo,this.index),value&&(output.add(" "),value.genCSS(context,output)),rules?("Ruleset"===rules.type&&(rules=[rules]),this.outputRuleset(context,output,rules)):output.add(";")},Directive.prototype.eval=function(context){var value=this.value,rules=this.rules;return value&&(value=value.eval(context)),rules&&(rules=rules.eval(context),rules.root=!0),new Directive(this.name,value,rules,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced)},Directive.prototype.variable=function(name){return this.rules?Ruleset.prototype.variable.call(this.rules,name):void 0},Directive.prototype.find=function(){return this.rules?Ruleset.prototype.find.apply(this.rules,arguments):void 0},Directive.prototype.rulesets=function(){return this.rules?Ruleset.prototype.rulesets.apply(this.rules):void 0},Directive.prototype.markReferenced=function(){var i,rules;if(this.isReferenced=!0,this.rules)for(rules=this.rules.rules,i=0;i<rules.length;i++)rules[i].markReferenced&&rules[i].markReferenced()},Directive.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},Directive.prototype.outputRuleset=function(context,output,rules){var i,ruleCnt=rules.length;if(context.tabLevel=(0|context.tabLevel)+1,context.compress){for(output.add("{"),i=0;ruleCnt>i;i++)rules[i].genCSS(context,output);return output.add("}"),void context.tabLevel--}var tabSetStr="\n"+Array(context.tabLevel).join("  "),tabRuleStr=tabSetStr+"  ";if(ruleCnt){for(output.add(" {"+tabRuleStr),rules[0].genCSS(context,output),i=1;ruleCnt>i;i++)output.add(tabRuleStr),rules[i].genCSS(context,output);output.add(tabSetStr+"}")}else output.add(" {"+tabSetStr+"}");context.tabLevel--},module.exports=Directive},{"./node":67,"./ruleset":73}],55:[function(require,module,exports){var Node=require("./node"),Paren=require("./paren"),Combinator=require("./combinator"),Element=function(combinator,value,index,currentFileInfo){this.combinator=combinator instanceof Combinator?combinator:new Combinator(combinator),"string"==typeof value?this.value=value.trim():value?this.value=value:this.value="",this.index=index,this.currentFileInfo=currentFileInfo};Element.prototype=new Node,Element.prototype.type="Element",Element.prototype.accept=function(visitor){var value=this.value;this.combinator=visitor.visit(this.combinator),"object"==typeof value&&(this.value=visitor.visit(value))},Element.prototype.eval=function(context){return new Element(this.combinator,this.value.eval?this.value.eval(context):this.value,this.index,this.currentFileInfo)},Element.prototype.genCSS=function(context,output){output.add(this.toCSS(context),this.currentFileInfo,this.index)},Element.prototype.toCSS=function(context){context=context||{};var value=this.value,firstSelector=context.firstSelector;return value instanceof Paren&&(context.firstSelector=!0),value=value.toCSS?value.toCSS(context):value,context.firstSelector=firstSelector,""===value&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(context)+value},module.exports=Element},{"./combinator":48,"./node":67,"./paren":69}],56:[function(require,module,exports){var Node=require("./node"),Paren=require("./paren"),Comment=require("./comment"),Expression=function(value){if(this.value=value,!value)throw new Error("Expression requires an array parameter")};Expression.prototype=new Node,Expression.prototype.type="Expression",Expression.prototype.accept=function(visitor){this.value=visitor.visitArray(this.value)},Expression.prototype.eval=function(context){var returnValue,inParenthesis=this.parens&&!this.parensInOp,doubleParen=!1;return inParenthesis&&context.inParenthesis(),this.value.length>1?returnValue=new Expression(this.value.map(function(e){return e.eval(context)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(doubleParen=!0),returnValue=this.value[0].eval(context)):returnValue=this,inParenthesis&&context.outOfParenthesis(),this.parens&&this.parensInOp&&!context.isMathOn()&&!doubleParen&&(returnValue=new Paren(returnValue)),returnValue},Expression.prototype.genCSS=function(context,output){for(var i=0;i<this.value.length;i++)this.value[i].genCSS(context,output),i+1<this.value.length&&output.add(" ")},Expression.prototype.throwAwayComments=function(){this.value=this.value.filter(function(v){return!(v instanceof Comment)})},module.exports=Expression},{"./comment":49,"./node":67,"./paren":69}],57:[function(require,module,exports){var Node=require("./node"),Extend=function Extend(selector,option,index){switch(this.selector=selector,this.option=option,this.index=index,this.object_id=Extend.next_id++,this.parent_ids=[this.object_id],option){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};Extend.next_id=0,Extend.prototype=new Node,Extend.prototype.type="Extend",Extend.prototype.accept=function(visitor){this.selector=visitor.visit(this.selector)},Extend.prototype.eval=function(context){return new Extend(this.selector.eval(context),this.option,this.index)},Extend.prototype.clone=function(context){return new Extend(this.selector,this.option,this.index)},Extend.prototype.findSelfSelectors=function(selectors){var i,selectorElements,selfElements=[];for(i=0;i<selectors.length;i++)selectorElements=selectors[i].elements,i>0&&selectorElements.length&&""===selectorElements[0].combinator.value&&(selectorElements[0].combinator.value=" "),selfElements=selfElements.concat(selectors[i].elements);this.selfSelectors=[{elements:selfElements}]},module.exports=Extend},{"./node":67}],58:[function(require,module,exports){var Node=require("./node"),Media=require("./media"),URL=require("./url"),Quoted=require("./quoted"),Ruleset=require("./ruleset"),Anonymous=require("./anonymous"),Import=function(path,features,options,index,currentFileInfo){if(this.options=options,this.index=index,this.path=path,this.features=features,this.currentFileInfo=currentFileInfo,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var pathValue=this.getPath();pathValue&&/[#\.\&\?\/]css([\?;].*)?$/.test(pathValue)&&(this.css=!0)}};Import.prototype=new Node,Import.prototype.type="Import",Import.prototype.accept=function(visitor){this.features&&(this.features=visitor.visit(this.features)),this.path=visitor.visit(this.path),!this.options.inline&&this.root&&(this.root=visitor.visit(this.root))},Import.prototype.genCSS=function(context,output){this.css&&(output.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(context,output),this.features&&(output.add(" "),this.features.genCSS(context,output)),output.add(";"))},Import.prototype.getPath=function(){return this.path instanceof Quoted?this.path.value:this.path instanceof URL?this.path.value.value:null},Import.prototype.isVariableImport=function(){var path=this.path;return path instanceof URL&&(path=path.value),path instanceof Quoted?path.containsVariables():!0},Import.prototype.evalForImport=function(context){var path=this.path;return path instanceof URL&&(path=path.value),new Import(path.eval(context),this.features,this.options,this.index,this.currentFileInfo)},Import.prototype.evalPath=function(context){var path=this.path.eval(context),rootpath=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(path instanceof URL)){if(rootpath){var pathValue=path.value;pathValue&&context.isPathRelative(pathValue)&&(path.value=rootpath+pathValue)}path.value=context.normalizePath(path.value)}return path},Import.prototype.eval=function(context){var ruleset,features=this.features&&this.features.eval(context);if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var contents=new Anonymous(this.root,0,{filename:this.importedFilename},!0,!0);return this.features?new Media([contents],this.features.value):[contents]}if(this.css){var newImport=new Import(this.evalPath(context),features,this.options,this.index);if(!newImport.css&&this.error)throw this.error;return newImport}return ruleset=new Ruleset(null,this.root.rules.slice(0)),ruleset.evalImports(context),this.features?new Media(ruleset.rules,this.features.value):ruleset.rules},module.exports=Import},{"./anonymous":43,"./media":63,"./node":67,"./quoted":70,"./ruleset":73,"./url":77}],59:[function(require,module,exports){var tree={};tree.Node=require("./node"),tree.Alpha=require("./alpha"),tree.Color=require("./color"),tree.Directive=require("./directive"),tree.DetachedRuleset=require("./detached-ruleset"),tree.Operation=require("./operation"),tree.Dimension=require("./dimension"),tree.Unit=require("./unit"),tree.Keyword=require("./keyword"),tree.Variable=require("./variable"),tree.Ruleset=require("./ruleset"),tree.Element=require("./element"),tree.Attribute=require("./attribute"),tree.Combinator=require("./combinator"),tree.Selector=require("./selector"),tree.Quoted=require("./quoted"),tree.Expression=require("./expression"),tree.Rule=require("./rule"),tree.Call=require("./call"),tree.URL=require("./url"),tree.Import=require("./import"),tree.mixin={Call:require("./mixin-call"),Definition:require("./mixin-definition")},tree.Comment=require("./comment"),tree.Anonymous=require("./anonymous"),tree.Value=require("./value"),tree.JavaScript=require("./javascript"),tree.Assignment=require("./assignment"),tree.Condition=require("./condition"),tree.Paren=require("./paren"),tree.Media=require("./media"),tree.UnicodeDescriptor=require("./unicode-descriptor"),tree.Negative=require("./negative"),tree.Extend=require("./extend"),tree.RulesetCall=require("./ruleset-call"),module.exports=tree},{"./alpha":42,"./anonymous":43,"./assignment":44,"./attribute":45,"./call":46,"./color":47,"./combinator":48,"./comment":49,"./condition":50,"./detached-ruleset":52,"./dimension":53,"./directive":54,"./element":55,"./expression":56,"./extend":57,"./import":58,"./javascript":60,"./keyword":62,"./media":63,"./mixin-call":64,"./mixin-definition":65,"./negative":66,"./node":67,"./operation":68,"./paren":69,"./quoted":70,"./rule":71,"./ruleset":73,"./ruleset-call":72,"./selector":74,"./unicode-descriptor":75,"./unit":76,"./url":77,"./value":78,"./variable":79}],60:[function(require,module,exports){var JsEvalNode=require("./js-eval-node"),Dimension=require("./dimension"),Quoted=require("./quoted"),Anonymous=require("./anonymous"),JavaScript=function(string,escaped,index,currentFileInfo){this.escaped=escaped,this.expression=string,this.index=index,this.currentFileInfo=currentFileInfo};JavaScript.prototype=new JsEvalNode,JavaScript.prototype.type="JavaScript",JavaScript.prototype.eval=function(context){var result=this.evaluateJavaScript(this.expression,context);return"number"==typeof result?new Dimension(result):"string"==typeof result?new Quoted('"'+result+'"',result,this.escaped,this.index):new Anonymous(Array.isArray(result)?result.join(", "):result)},module.exports=JavaScript},{"./anonymous":43,"./dimension":53,"./js-eval-node":61,"./quoted":70}],61:[function(require,module,exports){var Node=require("./node"),Variable=require("./variable"),JsEvalNode=function(){};JsEvalNode.prototype=new Node,JsEvalNode.prototype.evaluateJavaScript=function(expression,context){var result,that=this,evalContext={};if(void 0!==context.javascriptEnabled&&!context.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};expression=expression.replace(/@\{([\w-]+)\}/g,function(_,name){return that.jsify(new Variable("@"+name,that.index,that.currentFileInfo).eval(context))});try{expression=new Function("return ("+expression+")")}catch(e){throw{message:"JavaScript evaluation error: "+e.message+" from `"+expression+"`",filename:this.currentFileInfo.filename,index:this.index}}var variables=context.frames[0].variables();for(var k in variables)variables.hasOwnProperty(k)&&(evalContext[k.slice(1)]={value:variables[k].value,toJS:function(){return this.value.eval(context).toCSS()}});try{result=expression.call(evalContext)}catch(e){throw{message:"JavaScript evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return result},JsEvalNode.prototype.jsify=function(obj){return Array.isArray(obj.value)&&obj.value.length>1?"["+obj.value.map(function(v){return v.toCSS()}).join(", ")+"]":obj.toCSS()},module.exports=JsEvalNode},{"./node":67,"./variable":79}],62:[function(require,module,exports){var Node=require("./node"),Keyword=function(value){this.value=value};Keyword.prototype=new Node,Keyword.prototype.type="Keyword",Keyword.prototype.genCSS=function(context,output){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};output.add(this.value)},Keyword.True=new Keyword("true"),Keyword.False=new Keyword("false"),module.exports=Keyword},{"./node":67}],63:[function(require,module,exports){var Ruleset=require("./ruleset"),Value=require("./value"),Element=require("./element"),Selector=require("./selector"),Anonymous=require("./anonymous"),Expression=require("./expression"),Directive=require("./directive"),Media=function(value,features,index,currentFileInfo){this.index=index,this.currentFileInfo=currentFileInfo;var selectors=this.emptySelectors();this.features=new Value(features),this.rules=[new Ruleset(selectors,value)],this.rules[0].allowImports=!0};Media.prototype=new Directive,Media.prototype.type="Media",Media.prototype.isRulesetLike=!0,Media.prototype.accept=function(visitor){this.features&&(this.features=visitor.visit(this.features)),this.rules&&(this.rules=visitor.visitArray(this.rules))},Media.prototype.genCSS=function(context,output){output.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(context,output),this.outputRuleset(context,output,this.rules)},Media.prototype.eval=function(context){context.mediaBlocks||(context.mediaBlocks=[],context.mediaPath=[]);var media=new Media(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,media.debugInfo=this.debugInfo);var strictMathBypass=!1;context.strictMath||(strictMathBypass=!0,context.strictMath=!0);try{media.features=this.features.eval(context)}finally{strictMathBypass&&(context.strictMath=!1)}return context.mediaPath.push(media),context.mediaBlocks.push(media),context.frames.unshift(this.rules[0]),media.rules=[this.rules[0].eval(context)],context.frames.shift(),context.mediaPath.pop(),0===context.mediaPath.length?media.evalTop(context):media.evalNested(context)},Media.prototype.variable=function(name){return Ruleset.prototype.variable.call(this.rules[0],name)},Media.prototype.find=function(){return Ruleset.prototype.find.apply(this.rules[0],arguments)},Media.prototype.rulesets=function(){return Ruleset.prototype.rulesets.apply(this.rules[0])},Media.prototype.emptySelectors=function(){var el=new Element("","&",this.index,this.currentFileInfo),sels=[new Selector([el],null,null,this.index,this.currentFileInfo)];return sels[0].mediaEmpty=!0,sels},Media.prototype.markReferenced=function(){var i,rules=this.rules[0].rules;for(this.rules[0].markReferenced(),this.isReferenced=!0,i=0;i<rules.length;i++)rules[i].markReferenced&&rules[i].markReferenced()},Media.prototype.evalTop=function(context){var result=this;if(context.mediaBlocks.length>1){var selectors=this.emptySelectors();result=new Ruleset(selectors,context.mediaBlocks),result.multiMedia=!0}return delete context.mediaBlocks,delete context.mediaPath,result},Media.prototype.evalNested=function(context){var i,value,path=context.mediaPath.concat([this]);for(i=0;i<path.length;i++)value=path[i].features instanceof Value?path[i].features.value:path[i].features,path[i]=Array.isArray(value)?value:[value];return this.features=new Value(this.permute(path).map(function(path){for(path=path.map(function(fragment){return fragment.toCSS?fragment:new Anonymous(fragment)}),i=path.length-1;i>0;i--)path.splice(i,0,new Anonymous("and"));return new Expression(path)})),new Ruleset([],[])},Media.prototype.permute=function(arr){if(0===arr.length)return[];if(1===arr.length)return arr[0];for(var result=[],rest=this.permute(arr.slice(1)),i=0;i<rest.length;i++)for(var j=0;j<arr[0].length;j++)result.push([arr[0][j]].concat(rest[i]));return result},Media.prototype.bubbleSelectors=function(selectors){selectors&&(this.rules=[new Ruleset(selectors.slice(0),[this.rules[0]])])},module.exports=Media},{"./anonymous":43,"./directive":54,"./element":55,"./expression":56,"./ruleset":73,"./selector":74,"./value":78}],64:[function(require,module,exports){var Node=require("./node"),Selector=require("./selector"),MixinDefinition=require("./mixin-definition"),defaultFunc=require("../functions/default"),MixinCall=function(elements,args,index,currentFileInfo,important){this.selector=new Selector(elements),this.arguments=args&&args.length?args:null,this.index=index,this.currentFileInfo=currentFileInfo,this.important=important};MixinCall.prototype=new Node,MixinCall.prototype.type="MixinCall",MixinCall.prototype.accept=function(visitor){this.selector&&(this.selector=visitor.visit(this.selector)),this.arguments&&(this.arguments=visitor.visitArray(this.arguments))},MixinCall.prototype.eval=function(context){function calcDefGroup(mixin,mixinPath){var p,namespace;for(f=0;2>f;f++){for(conditionResult[f]=!0,defaultFunc.value(f),p=0;p<mixinPath.length&&conditionResult[f];p++)namespace=mixinPath[p],namespace.matchCondition&&(conditionResult[f]=conditionResult[f]&&namespace.matchCondition(null,context));mixin.matchCondition&&(conditionResult[f]=conditionResult[f]&&mixin.matchCondition(args,context))}return conditionResult[0]||conditionResult[1]?conditionResult[0]!=conditionResult[1]?conditionResult[1]?defTrue:defFalse:defNone:defFalseEitherCase}var mixins,mixin,mixinPath,args,i,m,f,isRecursive,isOneFound,rule,candidate,defaultResult,count,originalRuleset,noArgumentsFilter,rules=[],match=!1,candidates=[],conditionResult=[],defFalseEitherCase=-1,defNone=0,defTrue=1,defFalse=2;for(args=this.arguments&&this.arguments.map(function(a){return{name:a.name,value:a.value.eval(context)}}),noArgumentsFilter=function(rule){return rule.matchArgs(null,context)},i=0;i<context.frames.length;i++)if((mixins=context.frames[i].find(this.selector,null,noArgumentsFilter)).length>0){for(isOneFound=!0,m=0;m<mixins.length;m++){for(mixin=mixins[m].rule,mixinPath=mixins[m].path,isRecursive=!1,f=0;f<context.frames.length;f++)if(!(mixin instanceof MixinDefinition)&&mixin===(context.frames[f].originalRuleset||context.frames[f])){isRecursive=!0;break}isRecursive||mixin.matchArgs(args,context)&&(candidate={mixin:mixin,group:calcDefGroup(mixin,mixinPath)},candidate.group!==defFalseEitherCase&&candidates.push(candidate),match=!0)}for(defaultFunc.reset(),count=[0,0,0],m=0;m<candidates.length;m++)count[candidates[m].group]++;if(count[defNone]>0)defaultResult=defFalse;else if(defaultResult=defTrue,count[defTrue]+count[defFalse]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(args)+"`",index:this.index,filename:this.currentFileInfo.filename};for(m=0;m<candidates.length;m++)if(candidate=candidates[m].group,candidate===defNone||candidate===defaultResult)try{mixin=candidates[m].mixin,mixin instanceof MixinDefinition||(originalRuleset=mixin.originalRuleset||mixin,mixin=new MixinDefinition("",[],mixin.rules,null,!1),
mixin.originalRuleset=originalRuleset),Array.prototype.push.apply(rules,mixin.evalCall(context,args,this.important).rules)}catch(e){throw{message:e.message,index:this.index,filename:this.currentFileInfo.filename,stack:e.stack}}if(match){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(i=0;i<rules.length;i++)rule=rules[i],rule.markReferenced&&rule.markReferenced();return rules}}throw isOneFound?{type:"Runtime",message:"No matching definition was found for `"+this.format(args)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},MixinCall.prototype.format=function(args){return this.selector.toCSS().trim()+"("+(args?args.map(function(a){var argValue="";return a.name&&(argValue+=a.name+":"),argValue+=a.value.toCSS?a.value.toCSS():"???"}).join(", "):"")+")"},module.exports=MixinCall},{"../functions/default":19,"./mixin-definition":65,"./node":67,"./selector":74}],65:[function(require,module,exports){var Selector=require("./selector"),Element=require("./element"),Ruleset=require("./ruleset"),Rule=require("./rule"),Expression=require("./expression"),contexts=require("../contexts"),Definition=function(name,params,rules,condition,variadic,frames){this.name=name,this.selectors=[new Selector([new Element(null,name,this.index,this.currentFileInfo)])],this.params=params,this.condition=condition,this.variadic=variadic,this.arity=params.length,this.rules=rules,this._lookups={},this.required=params.reduce(function(count,p){return!p.name||p.name&&!p.value?count+1:count},0),this.frames=frames};Definition.prototype=new Ruleset,Definition.prototype.type="MixinDefinition",Definition.prototype.evalFirst=!0,Definition.prototype.accept=function(visitor){this.params&&this.params.length&&(this.params=visitor.visitArray(this.params)),this.rules=visitor.visitArray(this.rules),this.condition&&(this.condition=visitor.visit(this.condition))},Definition.prototype.evalParams=function(context,mixinEnv,args,evaldArguments){var varargs,arg,i,j,val,name,isNamedFound,argIndex,frame=new Ruleset(null,null),params=this.params.slice(0),argsLength=0;if(mixinEnv=new contexts.Eval(mixinEnv,[frame].concat(mixinEnv.frames)),args)for(args=args.slice(0),argsLength=args.length,i=0;argsLength>i;i++)if(arg=args[i],name=arg&&arg.name){for(isNamedFound=!1,j=0;j<params.length;j++)if(!evaldArguments[j]&&name===params[j].name){evaldArguments[j]=arg.value.eval(context),frame.prependRule(new Rule(name,arg.value.eval(context))),isNamedFound=!0;break}if(isNamedFound){args.splice(i,1),i--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+args[i].name+" not found"}}for(argIndex=0,i=0;i<params.length;i++)if(!evaldArguments[i]){if(arg=args&&args[argIndex],name=params[i].name)if(params[i].variadic){for(varargs=[],j=argIndex;argsLength>j;j++)varargs.push(args[j].value.eval(context));frame.prependRule(new Rule(name,new Expression(varargs).eval(context)))}else{if(val=arg&&arg.value)val=val.eval(context);else{if(!params[i].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+argsLength+" for "+this.arity+")"};val=params[i].value.eval(mixinEnv),frame.resetCache()}frame.prependRule(new Rule(name,val)),evaldArguments[i]=val}if(params[i].variadic&&args)for(j=argIndex;argsLength>j;j++)evaldArguments[j]=args[j].value.eval(context);argIndex++}return frame},Definition.prototype.makeImportant=function(){var rules=this.rules?this.rules.map(function(r){return r.makeImportant?r.makeImportant(!0):r}):this.rules,result=new Definition(this.name,this.params,rules,this.condition,this.variadic,this.frames);return result},Definition.prototype.eval=function(context){return new Definition(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||context.frames.slice(0))},Definition.prototype.evalCall=function(context,args,important){var rules,ruleset,_arguments=[],mixinFrames=this.frames?this.frames.concat(context.frames):context.frames,frame=this.evalParams(context,new contexts.Eval(context,mixinFrames),args,_arguments);return frame.prependRule(new Rule("@arguments",new Expression(_arguments).eval(context))),rules=this.rules.slice(0),ruleset=new Ruleset(null,rules),ruleset.originalRuleset=this,ruleset=ruleset.eval(new contexts.Eval(context,[this,frame].concat(mixinFrames))),important&&(ruleset=ruleset.makeImportant()),ruleset},Definition.prototype.matchCondition=function(args,context){return this.condition&&!this.condition.eval(new contexts.Eval(context,[this.evalParams(context,new contexts.Eval(context,this.frames?this.frames.concat(context.frames):context.frames),args,[])].concat(this.frames).concat(context.frames)))?!1:!0},Definition.prototype.matchArgs=function(args,context){var len,argsLength=args&&args.length||0;if(this.variadic){if(argsLength<this.required-1)return!1}else{if(argsLength<this.required)return!1;if(argsLength>this.params.length)return!1}len=Math.min(argsLength,this.arity);for(var i=0;len>i;i++)if(!this.params[i].name&&!this.params[i].variadic&&args[i].value.eval(context).toCSS()!=this.params[i].value.eval(context).toCSS())return!1;return!0},module.exports=Definition},{"../contexts":10,"./element":55,"./expression":56,"./rule":71,"./ruleset":73,"./selector":74}],66:[function(require,module,exports){var Node=require("./node"),Operation=require("./operation"),Dimension=require("./dimension"),Negative=function(node){this.value=node};Negative.prototype=new Node,Negative.prototype.type="Negative",Negative.prototype.genCSS=function(context,output){output.add("-"),this.value.genCSS(context,output)},Negative.prototype.eval=function(context){return context.isMathOn()?new Operation("*",[new Dimension(-1),this.value]).eval(context):new Negative(this.value.eval(context))},module.exports=Negative},{"./dimension":53,"./node":67,"./operation":68}],67:[function(require,module,exports){var Node=function(){};Node.prototype.toCSS=function(context){var strs=[];return this.genCSS(context,{add:function(chunk,fileInfo,index){strs.push(chunk)},isEmpty:function(){return 0===strs.length}}),strs.join("")},Node.prototype.genCSS=function(context,output){output.add(this.value)},Node.prototype.accept=function(visitor){this.value=visitor.visit(this.value)},Node.prototype.eval=function(){return this},Node.prototype._operate=function(context,op,a,b){switch(op){case"+":return a+b;case"-":return a-b;case"*":return a*b;case"/":return a/b}},Node.prototype.fround=function(context,value){var precision=context&&context.numPrecision;return null==precision?value:Number((value+2e-16).toFixed(precision))},Node.compare=function(a,b){if(a.compare&&"Quoted"!==b.type&&"Anonymous"!==b.type)return a.compare(b);if(b.compare)return-b.compare(a);if(a.type!==b.type)return void 0;if(a=a.value,b=b.value,!Array.isArray(a))return a===b?0:void 0;if(a.length!==b.length)return void 0;for(var i=0;i<a.length;i++)if(0!==Node.compare(a[i],b[i]))return void 0;return 0},Node.numericCompare=function(a,b){return b>a?-1:a===b?0:a>b?1:void 0},module.exports=Node},{}],68:[function(require,module,exports){var Node=require("./node"),Color=require("./color"),Dimension=require("./dimension"),Operation=function(op,operands,isSpaced){this.op=op.trim(),this.operands=operands,this.isSpaced=isSpaced};Operation.prototype=new Node,Operation.prototype.type="Operation",Operation.prototype.accept=function(visitor){this.operands=visitor.visit(this.operands)},Operation.prototype.eval=function(context){var a=this.operands[0].eval(context),b=this.operands[1].eval(context);if(context.isMathOn()){if(a instanceof Dimension&&b instanceof Color&&(a=a.toColor()),b instanceof Dimension&&a instanceof Color&&(b=b.toColor()),!a.operate)throw{type:"Operation",message:"Operation on an invalid type"};return a.operate(context,this.op,b)}return new Operation(this.op,[a,b],this.isSpaced)},Operation.prototype.genCSS=function(context,output){this.operands[0].genCSS(context,output),this.isSpaced&&output.add(" "),output.add(this.op),this.isSpaced&&output.add(" "),this.operands[1].genCSS(context,output)},module.exports=Operation},{"./color":47,"./dimension":53,"./node":67}],69:[function(require,module,exports){var Node=require("./node"),Paren=function(node){this.value=node};Paren.prototype=new Node,Paren.prototype.type="Paren",Paren.prototype.genCSS=function(context,output){output.add("("),this.value.genCSS(context,output),output.add(")")},Paren.prototype.eval=function(context){return new Paren(this.value.eval(context))},module.exports=Paren},{"./node":67}],70:[function(require,module,exports){var Node=require("./node"),JsEvalNode=require("./js-eval-node"),Variable=require("./variable"),Quoted=function(str,content,escaped,index,currentFileInfo){this.escaped=null==escaped?!0:escaped,this.value=content||"",this.quote=str.charAt(0),this.index=index,this.currentFileInfo=currentFileInfo};Quoted.prototype=new JsEvalNode,Quoted.prototype.type="Quoted",Quoted.prototype.genCSS=function(context,output){this.escaped||output.add(this.quote,this.currentFileInfo,this.index),output.add(this.value),this.escaped||output.add(this.quote)},Quoted.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},Quoted.prototype.eval=function(context){function iterativeReplace(value,regexp,replacementFnc){var evaluatedValue=value;do value=evaluatedValue,evaluatedValue=value.replace(regexp,replacementFnc);while(value!==evaluatedValue);return evaluatedValue}var that=this,value=this.value,javascriptReplacement=function(_,exp){return String(that.evaluateJavaScript(exp,context))},interpolationReplacement=function(_,name){var v=new Variable("@"+name,that.index,that.currentFileInfo).eval(context,!0);return v instanceof Quoted?v.value:v.toCSS()};return value=iterativeReplace(value,/`([^`]+)`/g,javascriptReplacement),value=iterativeReplace(value,/@\{([\w-]+)\}/g,interpolationReplacement),new Quoted(this.quote+value+this.quote,value,this.escaped,this.index,this.currentFileInfo)},Quoted.prototype.compare=function(other){return"Quoted"!==other.type||this.escaped||other.escaped?other.toCSS&&this.toCSS()===other.toCSS()?0:void 0:Node.numericCompare(this.value,other.value)},module.exports=Quoted},{"./js-eval-node":61,"./node":67,"./variable":79}],71:[function(require,module,exports){function evalName(context,name){var i,value="",n=name.length,output={add:function(s){value+=s}};for(i=0;n>i;i++)name[i].eval(context).genCSS(context,output);return value}var Node=require("./node"),Value=require("./value"),Keyword=require("./keyword"),Rule=function(name,value,important,merge,index,currentFileInfo,inline,variable){this.name=name,this.value=value instanceof Node?value:new Value([value]),this.important=important?" "+important.trim():"",this.merge=merge,this.index=index,this.currentFileInfo=currentFileInfo,this.inline=inline||!1,this.variable=void 0!==variable?variable:name.charAt&&"@"===name.charAt(0)};Rule.prototype=new Node,Rule.prototype.type="Rule",Rule.prototype.genCSS=function(context,output){output.add(this.name+(context.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(context,output)}catch(e){throw e.index=this.index,e.filename=this.currentFileInfo.filename,e}output.add(this.important+(this.inline||context.lastRule&&context.compress?"":";"),this.currentFileInfo,this.index)},Rule.prototype.eval=function(context){var evaldValue,strictMathBypass=!1,name=this.name,variable=this.variable;"string"!=typeof name&&(name=1===name.length&&name[0]instanceof Keyword?name[0].value:evalName(context,name),variable=!1),"font"!==name||context.strictMath||(strictMathBypass=!0,context.strictMath=!0);try{if(context.importantScope.push({}),evaldValue=this.value.eval(context),!this.variable&&"DetachedRuleset"===evaldValue.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var important=this.important,importantResult=context.importantScope.pop();return!important&&importantResult.important&&(important=importantResult.important),new Rule(name,evaldValue,important,this.merge,this.index,this.currentFileInfo,this.inline,variable)}catch(e){throw"number"!=typeof e.index&&(e.index=this.index,e.filename=this.currentFileInfo.filename),e}finally{strictMathBypass&&(context.strictMath=!1)}},Rule.prototype.makeImportant=function(){return new Rule(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)},module.exports=Rule},{"./keyword":62,"./node":67,"./value":78}],72:[function(require,module,exports){var Node=require("./node"),Variable=require("./variable"),RulesetCall=function(variable){this.variable=variable};RulesetCall.prototype=new Node,RulesetCall.prototype.type="RulesetCall",RulesetCall.prototype.eval=function(context){var detachedRuleset=new Variable(this.variable).eval(context);return detachedRuleset.callEval(context)},module.exports=RulesetCall},{"./node":67,"./variable":79}],73:[function(require,module,exports){var Node=require("./node"),Rule=require("./rule"),Selector=require("./selector"),Element=require("./element"),Paren=require("./paren"),contexts=require("../contexts"),defaultFunc=require("../functions/default"),getDebugInfo=require("./debug-info"),Ruleset=function(selectors,rules,strictImports){this.selectors=selectors,this.rules=rules,this._lookups={},this.strictImports=strictImports};Ruleset.prototype=new Node,Ruleset.prototype.type="Ruleset",Ruleset.prototype.isRuleset=!0,Ruleset.prototype.isRulesetLike=!0,Ruleset.prototype.accept=function(visitor){this.paths?visitor.visitArray(this.paths,!0):this.selectors&&(this.selectors=visitor.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=visitor.visitArray(this.rules))},Ruleset.prototype.eval=function(context){var selectors,selCnt,selector,i,thisSelectors=this.selectors,hasOnePassingSelector=!1;if(thisSelectors&&(selCnt=thisSelectors.length)){for(selectors=[],defaultFunc.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),i=0;selCnt>i;i++)selector=thisSelectors[i].eval(context),selectors.push(selector),selector.evaldCondition&&(hasOnePassingSelector=!0);defaultFunc.reset()}else hasOnePassingSelector=!0;var rule,subRule,rules=this.rules?this.rules.slice(0):null,ruleset=new Ruleset(selectors,rules,this.strictImports);ruleset.originalRuleset=this,ruleset.root=this.root,ruleset.firstRoot=this.firstRoot,ruleset.allowImports=this.allowImports,this.debugInfo&&(ruleset.debugInfo=this.debugInfo),hasOnePassingSelector||(rules.length=0);var ctxFrames=context.frames;ctxFrames.unshift(ruleset);var ctxSelectors=context.selectors;ctxSelectors||(context.selectors=ctxSelectors=[]),ctxSelectors.unshift(this.selectors),(ruleset.root||ruleset.allowImports||!ruleset.strictImports)&&ruleset.evalImports(context);var rsRules=ruleset.rules,rsRuleCnt=rsRules?rsRules.length:0;for(i=0;rsRuleCnt>i;i++)rsRules[i].evalFirst&&(rsRules[i]=rsRules[i].eval(context));var mediaBlockCount=context.mediaBlocks&&context.mediaBlocks.length||0;for(i=0;rsRuleCnt>i;i++)"MixinCall"===rsRules[i].type?(rules=rsRules[i].eval(context).filter(function(r){return r instanceof Rule&&r.variable?!ruleset.variable(r.name):!0}),rsRules.splice.apply(rsRules,[i,1].concat(rules)),rsRuleCnt+=rules.length-1,i+=rules.length-1,ruleset.resetCache()):"RulesetCall"===rsRules[i].type&&(rules=rsRules[i].eval(context).rules.filter(function(r){return r instanceof Rule&&r.variable?!1:!0}),rsRules.splice.apply(rsRules,[i,1].concat(rules)),rsRuleCnt+=rules.length-1,i+=rules.length-1,ruleset.resetCache());for(i=0;i<rsRules.length;i++)rule=rsRules[i],rule.evalFirst||(rsRules[i]=rule=rule.eval?rule.eval(context):rule);for(i=0;i<rsRules.length;i++)if(rule=rsRules[i],rule instanceof Ruleset&&rule.selectors&&1===rule.selectors.length&&rule.selectors[0].isJustParentSelector()){rsRules.splice(i--,1);for(var j=0;j<rule.rules.length;j++)subRule=rule.rules[j],subRule instanceof Rule&&subRule.variable||rsRules.splice(++i,0,subRule)}if(ctxFrames.shift(),ctxSelectors.shift(),context.mediaBlocks)for(i=mediaBlockCount;i<context.mediaBlocks.length;i++)context.mediaBlocks[i].bubbleSelectors(selectors);return ruleset},Ruleset.prototype.evalImports=function(context){var i,importRules,rules=this.rules;if(rules)for(i=0;i<rules.length;i++)"Import"===rules[i].type&&(importRules=rules[i].eval(context),importRules&&importRules.length?(rules.splice.apply(rules,[i,1].concat(importRules)),i+=importRules.length-1):rules.splice(i,1,importRules),this.resetCache())},Ruleset.prototype.makeImportant=function(){var result=new Ruleset(this.selectors,this.rules.map(function(r){return r.makeImportant?r.makeImportant():r}),this.strictImports);return result},Ruleset.prototype.matchArgs=function(args){return!args||0===args.length},Ruleset.prototype.matchCondition=function(args,context){var lastSelector=this.selectors[this.selectors.length-1];return lastSelector.evaldCondition?lastSelector.condition&&!lastSelector.condition.eval(new contexts.Eval(context,context.frames))?!1:!0:!1},Ruleset.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},Ruleset.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(hash,r){if(r instanceof Rule&&r.variable===!0&&(hash[r.name]=r),"Import"===r.type&&r.root&&r.root.variables){var vars=r.root.variables();for(var name in vars)vars.hasOwnProperty(name)&&(hash[name]=vars[name])}return hash},{}):{}),this._variables},Ruleset.prototype.variable=function(name){return this.variables()[name]},Ruleset.prototype.rulesets=function(){if(!this.rules)return null;var i,rule,filtRules=[],rules=this.rules,cnt=rules.length;for(i=0;cnt>i;i++)rule=rules[i],rule.isRuleset&&filtRules.push(rule);return filtRules},Ruleset.prototype.prependRule=function(rule){var rules=this.rules;rules?rules.unshift(rule):this.rules=[rule]},Ruleset.prototype.find=function(selector,self,filter){self=self||this;var match,foundMixins,rules=[],key=selector.toCSS();return key in this._lookups?this._lookups[key]:(this.rulesets().forEach(function(rule){if(rule!==self)for(var j=0;j<rule.selectors.length;j++)if(match=selector.match(rule.selectors[j])){if(selector.elements.length>match){if(!filter||filter(rule)){foundMixins=rule.find(new Selector(selector.elements.slice(match)),self,filter);for(var i=0;i<foundMixins.length;++i)foundMixins[i].path.push(rule);Array.prototype.push.apply(rules,foundMixins)}}else rules.push({rule:rule,path:[]});break}}),this._lookups[key]=rules,rules)},Ruleset.prototype.genCSS=function(context,output){function isRulesetLikeNode(rule,root){return"boolean"==typeof rule.isRulesetLike?rule.isRulesetLike:"function"==typeof rule.isRulesetLike?rule.isRulesetLike(root):!1}var i,j,rulesetNodeCnt,debugInfo,rule,path,charsetRuleNodes=[],ruleNodes=[],rulesetNodes=[];context.tabLevel=context.tabLevel||0,this.root||context.tabLevel++;var sep,tabRuleStr=context.compress?"":Array(context.tabLevel+1).join("  "),tabSetStr=context.compress?"":Array(context.tabLevel).join("  ");for(i=0;i<this.rules.length;i++)rule=this.rules[i],isRulesetLikeNode(rule,this.root)?rulesetNodes.push(rule):rule.isCharset&&rule.isCharset()?charsetRuleNodes.push(rule):ruleNodes.push(rule);if(ruleNodes=charsetRuleNodes.concat(ruleNodes),!this.root){debugInfo=getDebugInfo(context,this,tabSetStr),debugInfo&&(output.add(debugInfo),output.add(tabSetStr));var pathSubCnt,paths=this.paths,pathCnt=paths.length;for(sep=context.compress?",":",\n"+tabSetStr,i=0;pathCnt>i;i++)if(path=paths[i],pathSubCnt=path.length)for(i>0&&output.add(sep),context.firstSelector=!0,path[0].genCSS(context,output),context.firstSelector=!1,j=1;pathSubCnt>j;j++)path[j].genCSS(context,output);output.add((context.compress?"{":" {\n")+tabRuleStr)}for(i=0;i<ruleNodes.length;i++)rule=ruleNodes[i],i+1!==ruleNodes.length||this.root&&0!==rulesetNodes.length&&!this.firstRoot||(context.lastRule=!0),rule.genCSS?rule.genCSS(context,output):rule.value&&output.add(rule.value.toString()),context.lastRule?context.lastRule=!1:output.add(context.compress?"":"\n"+tabRuleStr);if(this.root||(output.add(context.compress?"}":"\n"+tabSetStr+"}"),context.tabLevel--),sep=(context.compress?"":"\n")+(this.root?tabRuleStr:tabSetStr),rulesetNodeCnt=rulesetNodes.length)for(ruleNodes.length&&sep&&output.add(sep),rulesetNodes[0].genCSS(context,output),i=1;rulesetNodeCnt>i;i++)sep&&output.add(sep),rulesetNodes[i].genCSS(context,output);output.isEmpty()||context.compress||!this.firstRoot||output.add("\n")},Ruleset.prototype.markReferenced=function(){var s;if(this.selectors)for(s=0;s<this.selectors.length;s++)this.selectors[s].markReferenced();if(this.rules)for(s=0;s<this.rules.length;s++)this.rules[s].markReferenced&&this.rules[s].markReferenced()},Ruleset.prototype.getIsReferenced=function(){var i,j,path,selector;if(this.paths)for(i=0;i<this.paths.length;i++)for(path=this.paths[i],j=0;j<path.length;j++)if(path[j].getIsReferenced&&path[j].getIsReferenced())return!0;if(this.selectors)for(i=0;i<this.selectors.length;i++)if(selector=this.selectors[i],selector.getIsReferenced&&selector.getIsReferenced())return!0;return!1},Ruleset.prototype.joinSelectors=function(paths,context,selectors){for(var s=0;s<selectors.length;s++)this.joinSelector(paths,context,selectors[s])},Ruleset.prototype.joinSelector=function(paths,context,selector){function createParenthesis(elementsToPak,originalElement){var replacementParen,j;if(0===elementsToPak.length)replacementParen=new Paren(elementsToPak[0]);else{var insideParent=[];for(j=0;j<elementsToPak.length;j++)insideParent.push(new Element(null,elementsToPak[j],originalElement.index,originalElement.currentFileInfo));replacementParen=new Paren(new Selector(insideParent))}return replacementParen}function createSelector(containedElement,originalElement){var element,selector;return element=new Element(null,containedElement,originalElement.index,originalElement.currentFileInfo),selector=new Selector([element])}function replaceParentSelector(paths,context,inSelector){function findNestedSelector(element){var maybeSelector;return"Paren"!==element.value.type?null:(maybeSelector=element.value.value,"Selector"!==maybeSelector.type?null:maybeSelector)}var i,j,k,currentElements,newSelectors,selectorsMultiplied,sel,el,length,lastSelector,hadParentSelector=!1;for(currentElements=[],newSelectors=[[]],i=0;i<inSelector.elements.length;i++)if(el=inSelector.elements[i],"&"!==el.value){var nestedSelector=findNestedSelector(el);if(null!=nestedSelector){mergeElementsOnToSelectors(currentElements,newSelectors);var replaced,nestedPaths=[],replacedNewSelectors=[];for(replaced=replaceParentSelector(nestedPaths,context,nestedSelector),hadParentSelector=hadParentSelector||replaced,k=0;k<nestedPaths.length;k++){var replacementSelector=createSelector(createParenthesis(nestedPaths[k],el),el);addAllReplacementsIntoPath(newSelectors,[replacementSelector],el,inSelector,replacedNewSelectors)}newSelectors=replacedNewSelectors,currentElements=[]}else currentElements.push(el)}else{for(hadParentSelector=!0,selectorsMultiplied=[],mergeElementsOnToSelectors(currentElements,newSelectors),j=0;j<newSelectors.length;j++)if(sel=newSelectors[j],0===context.length)sel.length>0&&sel[0].elements.push(new Element(el.combinator,"",el.index,el.currentFileInfo)),selectorsMultiplied.push(sel);else for(k=0;k<context.length;k++){var newSelectorPath=addReplacementIntoPath(sel,context[k],el,inSelector);selectorsMultiplied.push(newSelectorPath)}newSelectors=selectorsMultiplied,currentElements=[]}for(mergeElementsOnToSelectors(currentElements,newSelectors),i=0;i<newSelectors.length;i++)length=newSelectors[i].length,length>0&&(paths.push(newSelectors[i]),lastSelector=newSelectors[i][length-1],newSelectors[i][length-1]=lastSelector.createDerived(lastSelector.elements,inSelector.extendList));return hadParentSelector}function addReplacementIntoPath(beginningPath,addPath,replacedElement,originalSelector){var newSelectorPath,lastSelector,newJoinedSelector;if(newSelectorPath=[],beginningPath.length>0?(newSelectorPath=beginningPath.slice(0),lastSelector=newSelectorPath.pop(),newJoinedSelector=originalSelector.createDerived(lastSelector.elements.slice(0))):newJoinedSelector=originalSelector.createDerived([]),addPath.length>0){var combinator=replacedElement.combinator,parentEl=addPath[0].elements[0];combinator.emptyOrWhitespace&&!parentEl.combinator.emptyOrWhitespace&&(combinator=parentEl.combinator),newJoinedSelector.elements.push(new Element(combinator,parentEl.value,replacedElement.index,replacedElement.currentFileInfo)),newJoinedSelector.elements=newJoinedSelector.elements.concat(addPath[0].elements.slice(1))}return 0!==newJoinedSelector.elements.length&&newSelectorPath.push(newJoinedSelector),addPath.length>1&&(newSelectorPath=newSelectorPath.concat(addPath.slice(1))),newSelectorPath}function addAllReplacementsIntoPath(beginningPath,addPaths,replacedElement,originalSelector,result){var j;for(j=0;j<beginningPath.length;j++){var newSelectorPath=addReplacementIntoPath(beginningPath[j],addPaths,replacedElement,originalSelector);result.push(newSelectorPath)}return result}function mergeElementsOnToSelectors(elements,selectors){var i,sel;if(0!==elements.length){if(0===selectors.length)return void selectors.push([new Selector(elements)]);for(i=0;i<selectors.length;i++)sel=selectors[i],sel.length>0?sel[sel.length-1]=sel[sel.length-1].createDerived(sel[sel.length-1].elements.concat(elements)):sel.push(new Selector(elements))}}var i,newPaths,hadParentSelector;if(newPaths=[],hadParentSelector=replaceParentSelector(newPaths,context,selector),!hadParentSelector)if(context.length>0)for(newPaths=[],i=0;i<context.length;i++)newPaths.push(context[i].concat(selector));else newPaths=[[selector]];for(i=0;i<newPaths.length;i++)paths.push(newPaths[i])},module.exports=Ruleset},{"../contexts":10,"../functions/default":19,"./debug-info":51,"./element":55,"./node":67,"./paren":69,"./rule":71,"./selector":74}],74:[function(require,module,exports){var Node=require("./node"),Selector=function(elements,extendList,condition,index,currentFileInfo,isReferenced){this.elements=elements,this.extendList=extendList,this.condition=condition,this.currentFileInfo=currentFileInfo||{},this.isReferenced=isReferenced,condition||(this.evaldCondition=!0)};Selector.prototype=new Node,Selector.prototype.type="Selector",Selector.prototype.accept=function(visitor){this.elements&&(this.elements=visitor.visitArray(this.elements)),this.extendList&&(this.extendList=visitor.visitArray(this.extendList)),this.condition&&(this.condition=visitor.visit(this.condition))},Selector.prototype.createDerived=function(elements,extendList,evaldCondition){evaldCondition=null!=evaldCondition?evaldCondition:this.evaldCondition;var newSelector=new Selector(elements,extendList||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return newSelector.evaldCondition=evaldCondition,newSelector.mediaEmpty=this.mediaEmpty,newSelector},Selector.prototype.match=function(other){var olen,i,elements=this.elements,len=elements.length;if(other.CacheElements(),olen=other._elements.length,0===olen||olen>len)return 0;for(i=0;olen>i;i++)if(elements[i].value!==other._elements[i])return 0;return olen},Selector.prototype.CacheElements=function(){if(!this._elements){var elements=this.elements.map(function(v){return v.combinator.value+(v.value.value||v.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);elements?"&"===elements[0]&&elements.shift():elements=[],this._elements=elements}},Selector.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},Selector.prototype.eval=function(context){var evaldCondition=this.condition&&this.condition.eval(context),elements=this.elements,extendList=this.extendList;return elements=elements&&elements.map(function(e){return e.eval(context)}),extendList=extendList&&extendList.map(function(extend){return extend.eval(context)}),this.createDerived(elements,extendList,evaldCondition)},Selector.prototype.genCSS=function(context,output){var i,element;if(context&&context.firstSelector||""!==this.elements[0].combinator.value||output.add(" ",this.currentFileInfo,this.index),!this._css)for(i=0;i<this.elements.length;i++)element=this.elements[i],element.genCSS(context,output)},Selector.prototype.markReferenced=function(){this.isReferenced=!0},Selector.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},Selector.prototype.getIsOutput=function(){return this.evaldCondition},module.exports=Selector},{"./node":67}],75:[function(require,module,exports){var Node=require("./node"),UnicodeDescriptor=function(value){this.value=value};UnicodeDescriptor.prototype=new Node,UnicodeDescriptor.prototype.type="UnicodeDescriptor",module.exports=UnicodeDescriptor},{"./node":67}],76:[function(require,module,exports){var Node=require("./node"),unitConversions=require("../data/unit-conversions"),Unit=function(numerator,denominator,backupUnit){this.numerator=numerator?numerator.slice(0).sort():[],this.denominator=denominator?denominator.slice(0).sort():[],backupUnit?this.backupUnit=backupUnit:numerator&&numerator.length&&(this.backupUnit=numerator[0])};Unit.prototype=new Node,Unit.prototype.type="Unit",Unit.prototype.clone=function(){return new Unit(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},Unit.prototype.genCSS=function(context,output){var strictUnits=context&&context.strictUnits;1===this.numerator.length?output.add(this.numerator[0]):!strictUnits&&this.backupUnit?output.add(this.backupUnit):!strictUnits&&this.denominator.length&&output.add(this.denominator[0])},Unit.prototype.toString=function(){var i,returnStr=this.numerator.join("*");for(i=0;i<this.denominator.length;i++)returnStr+="/"+this.denominator[i];return returnStr},Unit.prototype.compare=function(other){return this.is(other.toString())?0:void 0},Unit.prototype.is=function(unitString){return this.toString().toUpperCase()===unitString.toUpperCase()},Unit.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},Unit.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},Unit.prototype.isSingular=function(){return this.numerator.length<=1&&0===this.denominator.length},Unit.prototype.map=function(callback){var i;for(i=0;i<this.numerator.length;i++)this.numerator[i]=callback(this.numerator[i],!1);for(i=0;i<this.denominator.length;i++)this.denominator[i]=callback(this.denominator[i],!0)},Unit.prototype.usedUnits=function(){var group,mapUnit,result={};mapUnit=function(atomicUnit){return group.hasOwnProperty(atomicUnit)&&!result[groupName]&&(result[groupName]=atomicUnit),atomicUnit};for(var groupName in unitConversions)unitConversions.hasOwnProperty(groupName)&&(group=unitConversions[groupName],this.map(mapUnit));return result},Unit.prototype.cancel=function(){var atomicUnit,i,counter={};for(i=0;i<this.numerator.length;i++)atomicUnit=this.numerator[i],counter[atomicUnit]=(counter[atomicUnit]||0)+1;for(i=0;i<this.denominator.length;i++)atomicUnit=this.denominator[i],counter[atomicUnit]=(counter[atomicUnit]||0)-1;this.numerator=[],this.denominator=[];for(atomicUnit in counter)if(counter.hasOwnProperty(atomicUnit)){var count=counter[atomicUnit];if(count>0)for(i=0;count>i;i++)this.numerator.push(atomicUnit);else if(0>count)for(i=0;-count>i;i++)this.denominator.push(atomicUnit)}this.numerator.sort(),this.denominator.sort()},module.exports=Unit},{"../data/unit-conversions":13,"./node":67}],77:[function(require,module,exports){var Node=require("./node"),URL=function(val,index,currentFileInfo,isEvald){this.value=val,this.currentFileInfo=currentFileInfo,this.index=index,this.isEvald=isEvald};URL.prototype=new Node,URL.prototype.type="Url",URL.prototype.accept=function(visitor){this.value=visitor.visit(this.value)},URL.prototype.genCSS=function(context,output){
output.add("url("),this.value.genCSS(context,output),output.add(")")},URL.prototype.eval=function(context){var rootpath,val=this.value.eval(context);if(!this.isEvald&&(rootpath=this.currentFileInfo&&this.currentFileInfo.rootpath,rootpath&&"string"==typeof val.value&&context.isPathRelative(val.value)&&(val.quote||(rootpath=rootpath.replace(/[\(\)'"\s]/g,function(match){return"\\"+match})),val.value=rootpath+val.value),val.value=context.normalizePath(val.value),context.urlArgs&&!val.value.match(/^\s*data:/))){var delimiter=-1===val.value.indexOf("?")?"?":"&",urlArgs=delimiter+context.urlArgs;-1!==val.value.indexOf("#")?val.value=val.value.replace("#",urlArgs+"#"):val.value+=urlArgs}return new URL(val,this.index,this.currentFileInfo,!0)},module.exports=URL},{"./node":67}],78:[function(require,module,exports){var Node=require("./node"),Value=function(value){if(this.value=value,!value)throw new Error("Value requires an array argument")};Value.prototype=new Node,Value.prototype.type="Value",Value.prototype.accept=function(visitor){this.value&&(this.value=visitor.visitArray(this.value))},Value.prototype.eval=function(context){return 1===this.value.length?this.value[0].eval(context):new Value(this.value.map(function(v){return v.eval(context)}))},Value.prototype.genCSS=function(context,output){var i;for(i=0;i<this.value.length;i++)this.value[i].genCSS(context,output),i+1<this.value.length&&output.add(context&&context.compress?",":", ")},module.exports=Value},{"./node":67}],79:[function(require,module,exports){var Node=require("./node"),Variable=function(name,index,currentFileInfo){this.name=name,this.index=index,this.currentFileInfo=currentFileInfo||{}};Variable.prototype=new Node,Variable.prototype.type="Variable",Variable.prototype.eval=function(context){var variable,name=this.name;if(0===name.indexOf("@@")&&(name="@"+new Variable(name.slice(1),this.index,this.currentFileInfo).eval(context).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+name,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,variable=this.find(context.frames,function(frame){var v=frame.variable(name);if(v){if(v.important){var importantScope=context.importantScope[context.importantScope.length-1];importantScope.important=v.important}return v.value.eval(context)}}))return this.evaluating=!1,variable;throw{type:"Name",message:"variable "+name+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},Variable.prototype.find=function(obj,fun){for(var r,i=0;i<obj.length;i++)if(r=fun.call(obj,obj[i]))return r;return null},module.exports=Variable},{"./node":67}],80:[function(require,module,exports){module.exports={getLocation:function(index,inputStream){for(var n=index+1,line=null,column=-1;--n>=0&&"\n"!==inputStream.charAt(n);)column++;return"number"==typeof index&&(line=(inputStream.slice(0,index).match(/\n/g)||"").length),{line:line,column:column}}}},{}],81:[function(require,module,exports){var tree=require("../tree"),Visitor=require("./visitor"),logger=require("../logger"),ExtendFinderVisitor=function(){this._visitor=new Visitor(this),this.contexts=[],this.allExtendsStack=[[]]};ExtendFinderVisitor.prototype={run:function(root){return root=this._visitor.visit(root),root.allExtends=this.allExtendsStack[0],root},visitRule:function(ruleNode,visitArgs){visitArgs.visitDeeper=!1},visitMixinDefinition:function(mixinDefinitionNode,visitArgs){visitArgs.visitDeeper=!1},visitRuleset:function(rulesetNode,visitArgs){if(!rulesetNode.root){var i,j,extend,extendList,allSelectorsExtendList=[],rules=rulesetNode.rules,ruleCnt=rules?rules.length:0;for(i=0;ruleCnt>i;i++)rulesetNode.rules[i]instanceof tree.Extend&&(allSelectorsExtendList.push(rules[i]),rulesetNode.extendOnEveryPath=!0);var paths=rulesetNode.paths;for(i=0;i<paths.length;i++){var selectorPath=paths[i],selector=selectorPath[selectorPath.length-1],selExtendList=selector.extendList;for(extendList=selExtendList?selExtendList.slice(0).concat(allSelectorsExtendList):allSelectorsExtendList,extendList&&(extendList=extendList.map(function(allSelectorsExtend){return allSelectorsExtend.clone()})),j=0;j<extendList.length;j++)this.foundExtends=!0,extend=extendList[j],extend.findSelfSelectors(selectorPath),extend.ruleset=rulesetNode,0===j&&(extend.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(extend)}this.contexts.push(rulesetNode.selectors)}},visitRulesetOut:function(rulesetNode){rulesetNode.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(mediaNode,visitArgs){mediaNode.allExtends=[],this.allExtendsStack.push(mediaNode.allExtends)},visitMediaOut:function(mediaNode){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(directiveNode,visitArgs){directiveNode.allExtends=[],this.allExtendsStack.push(directiveNode.allExtends)},visitDirectiveOut:function(directiveNode){this.allExtendsStack.length=this.allExtendsStack.length-1}};var ProcessExtendsVisitor=function(){this._visitor=new Visitor(this)};ProcessExtendsVisitor.prototype={run:function(root){var extendFinder=new ExtendFinderVisitor;if(this.extendIndicies={},extendFinder.run(root),!extendFinder.foundExtends)return root;root.allExtends=root.allExtends.concat(this.doExtendChaining(root.allExtends,root.allExtends)),this.allExtendsStack=[root.allExtends];var newRoot=this._visitor.visit(root);return this.checkExtendsForNonMatched(root.allExtends),newRoot},checkExtendsForNonMatched:function(extendList){var indicies=this.extendIndicies;extendList.filter(function(extend){return!extend.hasFoundMatches&&1==extend.parent_ids.length}).forEach(function(extend){var selector="_unknown_";try{selector=extend.selector.toCSS({})}catch(_){}indicies[extend.index+" "+selector]||(indicies[extend.index+" "+selector]=!0,logger.warn("extend '"+selector+"' has no matches"))})},doExtendChaining:function(extendsList,extendsListTarget,iterationCount){var extendIndex,targetExtendIndex,matches,newSelector,selectorPath,extend,targetExtend,newExtend,extendsToAdd=[],extendVisitor=this;for(iterationCount=iterationCount||0,extendIndex=0;extendIndex<extendsList.length;extendIndex++)for(targetExtendIndex=0;targetExtendIndex<extendsListTarget.length;targetExtendIndex++)extend=extendsList[extendIndex],targetExtend=extendsListTarget[targetExtendIndex],extend.parent_ids.indexOf(targetExtend.object_id)>=0||(selectorPath=[targetExtend.selfSelectors[0]],matches=extendVisitor.findMatch(extend,selectorPath),matches.length&&(extend.hasFoundMatches=!0,extend.selfSelectors.forEach(function(selfSelector){newSelector=extendVisitor.extendSelector(matches,selectorPath,selfSelector),newExtend=new tree.Extend(targetExtend.selector,targetExtend.option,0),newExtend.selfSelectors=newSelector,newSelector[newSelector.length-1].extendList=[newExtend],extendsToAdd.push(newExtend),newExtend.ruleset=targetExtend.ruleset,newExtend.parent_ids=newExtend.parent_ids.concat(targetExtend.parent_ids,extend.parent_ids),targetExtend.firstExtendOnThisSelectorPath&&(newExtend.firstExtendOnThisSelectorPath=!0,targetExtend.ruleset.paths.push(newSelector))})));if(extendsToAdd.length){if(this.extendChainCount++,iterationCount>100){var selectorOne="{unable to calculate}",selectorTwo="{unable to calculate}";try{selectorOne=extendsToAdd[0].selfSelectors[0].toCSS(),selectorTwo=extendsToAdd[0].selector.toCSS()}catch(e){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+selectorOne+":extend("+selectorTwo+")"}}return extendsToAdd.concat(extendVisitor.doExtendChaining(extendsToAdd,extendsListTarget,iterationCount+1))}return extendsToAdd},visitRule:function(ruleNode,visitArgs){visitArgs.visitDeeper=!1},visitMixinDefinition:function(mixinDefinitionNode,visitArgs){visitArgs.visitDeeper=!1},visitSelector:function(selectorNode,visitArgs){visitArgs.visitDeeper=!1},visitRuleset:function(rulesetNode,visitArgs){if(!rulesetNode.root){var matches,pathIndex,extendIndex,selectorPath,allExtends=this.allExtendsStack[this.allExtendsStack.length-1],selectorsToAdd=[],extendVisitor=this;for(extendIndex=0;extendIndex<allExtends.length;extendIndex++)for(pathIndex=0;pathIndex<rulesetNode.paths.length;pathIndex++)if(selectorPath=rulesetNode.paths[pathIndex],!rulesetNode.extendOnEveryPath){var extendList=selectorPath[selectorPath.length-1].extendList;extendList&&extendList.length||(matches=this.findMatch(allExtends[extendIndex],selectorPath),matches.length&&(allExtends[extendIndex].hasFoundMatches=!0,allExtends[extendIndex].selfSelectors.forEach(function(selfSelector){selectorsToAdd.push(extendVisitor.extendSelector(matches,selectorPath,selfSelector))})))}rulesetNode.paths=rulesetNode.paths.concat(selectorsToAdd)}},findMatch:function(extend,haystackSelectorPath){var haystackSelectorIndex,hackstackSelector,hackstackElementIndex,haystackElement,targetCombinator,i,potentialMatch,extendVisitor=this,needleElements=extend.selector.elements,potentialMatches=[],matches=[];for(haystackSelectorIndex=0;haystackSelectorIndex<haystackSelectorPath.length;haystackSelectorIndex++)for(hackstackSelector=haystackSelectorPath[haystackSelectorIndex],hackstackElementIndex=0;hackstackElementIndex<hackstackSelector.elements.length;hackstackElementIndex++)for(haystackElement=hackstackSelector.elements[hackstackElementIndex],(extend.allowBefore||0===haystackSelectorIndex&&0===hackstackElementIndex)&&potentialMatches.push({pathIndex:haystackSelectorIndex,index:hackstackElementIndex,matched:0,initialCombinator:haystackElement.combinator}),i=0;i<potentialMatches.length;i++)potentialMatch=potentialMatches[i],targetCombinator=haystackElement.combinator.value,""===targetCombinator&&0===hackstackElementIndex&&(targetCombinator=" "),!extendVisitor.isElementValuesEqual(needleElements[potentialMatch.matched].value,haystackElement.value)||potentialMatch.matched>0&&needleElements[potentialMatch.matched].combinator.value!==targetCombinator?potentialMatch=null:potentialMatch.matched++,potentialMatch&&(potentialMatch.finished=potentialMatch.matched===needleElements.length,potentialMatch.finished&&!extend.allowAfter&&(hackstackElementIndex+1<hackstackSelector.elements.length||haystackSelectorIndex+1<haystackSelectorPath.length)&&(potentialMatch=null)),potentialMatch?potentialMatch.finished&&(potentialMatch.length=needleElements.length,potentialMatch.endPathIndex=haystackSelectorIndex,potentialMatch.endPathElementIndex=hackstackElementIndex+1,potentialMatches.length=0,matches.push(potentialMatch)):(potentialMatches.splice(i,1),i--);return matches},isElementValuesEqual:function(elementValue1,elementValue2){if("string"==typeof elementValue1||"string"==typeof elementValue2)return elementValue1===elementValue2;if(elementValue1 instanceof tree.Attribute)return elementValue1.op!==elementValue2.op||elementValue1.key!==elementValue2.key?!1:elementValue1.value&&elementValue2.value?(elementValue1=elementValue1.value.value||elementValue1.value,elementValue2=elementValue2.value.value||elementValue2.value,elementValue1===elementValue2):elementValue1.value||elementValue2.value?!1:!0;if(elementValue1=elementValue1.value,elementValue2=elementValue2.value,elementValue1 instanceof tree.Selector){if(!(elementValue2 instanceof tree.Selector)||elementValue1.elements.length!==elementValue2.elements.length)return!1;for(var i=0;i<elementValue1.elements.length;i++){if(elementValue1.elements[i].combinator.value!==elementValue2.elements[i].combinator.value&&(0!==i||(elementValue1.elements[i].combinator.value||" ")!==(elementValue2.elements[i].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(elementValue1.elements[i].value,elementValue2.elements[i].value))return!1}return!0}return!1},extendSelector:function(matches,selectorPath,replacementSelector){var matchIndex,selector,firstElement,match,newElements,currentSelectorPathIndex=0,currentSelectorPathElementIndex=0,path=[];for(matchIndex=0;matchIndex<matches.length;matchIndex++)match=matches[matchIndex],selector=selectorPath[match.pathIndex],firstElement=new tree.Element(match.initialCombinator,replacementSelector.elements[0].value,replacementSelector.elements[0].index,replacementSelector.elements[0].currentFileInfo),match.pathIndex>currentSelectorPathIndex&&currentSelectorPathElementIndex>0&&(path[path.length-1].elements=path[path.length-1].elements.concat(selectorPath[currentSelectorPathIndex].elements.slice(currentSelectorPathElementIndex)),currentSelectorPathElementIndex=0,currentSelectorPathIndex++),newElements=selector.elements.slice(currentSelectorPathElementIndex,match.index).concat([firstElement]).concat(replacementSelector.elements.slice(1)),currentSelectorPathIndex===match.pathIndex&&matchIndex>0?path[path.length-1].elements=path[path.length-1].elements.concat(newElements):(path=path.concat(selectorPath.slice(currentSelectorPathIndex,match.pathIndex)),path.push(new tree.Selector(newElements))),currentSelectorPathIndex=match.endPathIndex,currentSelectorPathElementIndex=match.endPathElementIndex,currentSelectorPathElementIndex>=selectorPath[currentSelectorPathIndex].elements.length&&(currentSelectorPathElementIndex=0,currentSelectorPathIndex++);return currentSelectorPathIndex<selectorPath.length&&currentSelectorPathElementIndex>0&&(path[path.length-1].elements=path[path.length-1].elements.concat(selectorPath[currentSelectorPathIndex].elements.slice(currentSelectorPathElementIndex)),currentSelectorPathIndex++),path=path.concat(selectorPath.slice(currentSelectorPathIndex,selectorPath.length))},visitRulesetOut:function(rulesetNode){},visitMedia:function(mediaNode,visitArgs){var newAllExtends=mediaNode.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);newAllExtends=newAllExtends.concat(this.doExtendChaining(newAllExtends,mediaNode.allExtends)),this.allExtendsStack.push(newAllExtends)},visitMediaOut:function(mediaNode){var lastIndex=this.allExtendsStack.length-1;this.checkExtendsForNonMatched(this.allExtendsStack[lastIndex]),this.allExtendsStack.length=lastIndex},visitDirective:function(directiveNode,visitArgs){var newAllExtends=directiveNode.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);newAllExtends=newAllExtends.concat(this.doExtendChaining(newAllExtends,directiveNode.allExtends)),this.allExtendsStack.push(newAllExtends)},visitDirectiveOut:function(directiveNode){var lastIndex=this.allExtendsStack.length-1;this.checkExtendsForNonMatched(this.allExtendsStack[lastIndex]),this.allExtendsStack.length=lastIndex}},module.exports=ProcessExtendsVisitor},{"../logger":31,"../tree":59,"./visitor":87}],82:[function(require,module,exports){function ImportSequencer(onSequencerEmpty){this.imports=[],this.variableImports=[],this._onSequencerEmpty=onSequencerEmpty,this._currentDepth=0}ImportSequencer.prototype.addImport=function(callback){var importSequencer=this,importItem={callback:callback,args:null,isReady:!1};return this.imports.push(importItem),function(){importItem.args=Array.prototype.slice.call(arguments,0),importItem.isReady=!0,importSequencer.tryRun()}},ImportSequencer.prototype.addVariableImport=function(callback){this.variableImports.push(callback)},ImportSequencer.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var importItem=this.imports[0];if(!importItem.isReady)return;this.imports=this.imports.slice(1),importItem.callback.apply(null,importItem.args)}if(0===this.variableImports.length)break;var variableImport=this.variableImports[0];this.variableImports=this.variableImports.slice(1),variableImport()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},module.exports=ImportSequencer},{}],83:[function(require,module,exports){var contexts=require("../contexts"),Visitor=require("./visitor"),ImportSequencer=require("./import-sequencer"),ImportVisitor=function(importer,finish){this._visitor=new Visitor(this),this._importer=importer,this._finish=finish,this.context=new contexts.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new ImportSequencer(this._onSequencerEmpty.bind(this))};ImportVisitor.prototype={isReplacing:!1,run:function(root){try{this._visitor.visit(root)}catch(e){this.error=e}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(importNode,visitArgs){var inlineCSS=importNode.options.inline;if(!importNode.css||inlineCSS){var context=new contexts.Eval(this.context,this.context.frames.slice(0)),importParent=context.frames[0];this.importCount++,importNode.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,importNode,context,importParent)):this.processImportNode(importNode,context,importParent)}visitArgs.visitDeeper=!1},processImportNode:function(importNode,context,importParent){var evaldImportNode,inlineCSS=importNode.options.inline;try{evaldImportNode=importNode.evalForImport(context)}catch(e){e.filename||(e.index=importNode.index,e.filename=importNode.currentFileInfo.filename),importNode.css=!0,importNode.error=e}if(!evaldImportNode||evaldImportNode.css&&!inlineCSS)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{evaldImportNode.options.multiple&&(context.importMultiple=!0);for(var tryAppendLessExtension=void 0===evaldImportNode.css,i=0;i<importParent.rules.length;i++)if(importParent.rules[i]===importNode){importParent.rules[i]=evaldImportNode;break}var onImported=this.onImported.bind(this,evaldImportNode,context),sequencedOnImported=this._sequencer.addImport(onImported);this._importer.push(evaldImportNode.getPath(),tryAppendLessExtension,evaldImportNode.currentFileInfo,evaldImportNode.options,sequencedOnImported)}},onImported:function(importNode,context,e,root,importedAtRoot,fullPath){e&&(e.filename||(e.index=importNode.index,e.filename=importNode.currentFileInfo.filename),this.error=e);var importVisitor=this,inlineCSS=importNode.options.inline,duplicateImport=importedAtRoot||fullPath in importVisitor.recursionDetector;if(context.importMultiple||(duplicateImport?importNode.skip=!0:importNode.skip=function(){return fullPath in importVisitor.onceFileDetectionMap?!0:(importVisitor.onceFileDetectionMap[fullPath]=!0,!1)}),root&&(importNode.root=root,importNode.importedFilename=fullPath,!inlineCSS&&(context.importMultiple||!duplicateImport))){importVisitor.recursionDetector[fullPath]=!0;var oldContext=this.context;this.context=context;try{this._visitor.visit(root)}catch(e){this.error=e}this.context=oldContext}importVisitor.importCount--,importVisitor.isFinished&&importVisitor._sequencer.tryRun()},visitRule:function(ruleNode,visitArgs){visitArgs.visitDeeper=!1},visitDirective:function(directiveNode,visitArgs){this.context.frames.unshift(directiveNode)},visitDirectiveOut:function(directiveNode){this.context.frames.shift()},visitMixinDefinition:function(mixinDefinitionNode,visitArgs){this.context.frames.unshift(mixinDefinitionNode)},visitMixinDefinitionOut:function(mixinDefinitionNode){this.context.frames.shift()},visitRuleset:function(rulesetNode,visitArgs){this.context.frames.unshift(rulesetNode)},visitRulesetOut:function(rulesetNode){this.context.frames.shift()},visitMedia:function(mediaNode,visitArgs){this.context.frames.unshift(mediaNode.rules[0])},visitMediaOut:function(mediaNode){this.context.frames.shift()}},module.exports=ImportVisitor},{"../contexts":10,"./import-sequencer":82,"./visitor":87}],84:[function(require,module,exports){var visitors={Visitor:require("./visitor"),ImportVisitor:require("./import-visitor"),ExtendVisitor:require("./extend-visitor"),JoinSelectorVisitor:require("./join-selector-visitor"),ToCSSVisitor:require("./to-css-visitor")};module.exports=visitors},{"./extend-visitor":81,"./import-visitor":83,"./join-selector-visitor":85,"./to-css-visitor":86,"./visitor":87}],85:[function(require,module,exports){var Visitor=require("./visitor"),JoinSelectorVisitor=function(){this.contexts=[[]],this._visitor=new Visitor(this)};JoinSelectorVisitor.prototype={run:function(root){return this._visitor.visit(root)},visitRule:function(ruleNode,visitArgs){visitArgs.visitDeeper=!1},visitMixinDefinition:function(mixinDefinitionNode,visitArgs){visitArgs.visitDeeper=!1},visitRuleset:function(rulesetNode,visitArgs){var selectors,context=this.contexts[this.contexts.length-1],paths=[];this.contexts.push(paths),rulesetNode.root||(selectors=rulesetNode.selectors,selectors&&(selectors=selectors.filter(function(selector){return selector.getIsOutput()}),rulesetNode.selectors=selectors.length?selectors:selectors=null,selectors&&rulesetNode.joinSelectors(paths,context,selectors)),selectors||(rulesetNode.rules=null),rulesetNode.paths=paths)},visitRulesetOut:function(rulesetNode){this.contexts.length=this.contexts.length-1},visitMedia:function(mediaNode,visitArgs){var context=this.contexts[this.contexts.length-1];mediaNode.rules[0].root=0===context.length||context[0].multiMedia}},module.exports=JoinSelectorVisitor},{"./visitor":87}],86:[function(require,module,exports){var tree=require("../tree"),Visitor=require("./visitor"),ToCSSVisitor=function(context){this._visitor=new Visitor(this),this._context=context};ToCSSVisitor.prototype={isReplacing:!0,run:function(root){return this._visitor.visit(root)},visitRule:function(ruleNode,visitArgs){return ruleNode.variable?void 0:ruleNode},visitMixinDefinition:function(mixinNode,visitArgs){mixinNode.frames=[]},visitExtend:function(extendNode,visitArgs){},visitComment:function(commentNode,visitArgs){return commentNode.isSilent(this._context)?void 0:commentNode},visitMedia:function(mediaNode,visitArgs){return mediaNode.accept(this._visitor),visitArgs.visitDeeper=!1,mediaNode.rules.length?mediaNode:void 0},visitDirective:function(directiveNode,visitArgs){if("@charset"===directiveNode.name){if(!directiveNode.getIsReferenced())return;if(this.charset){if(directiveNode.debugInfo){var comment=new tree.Comment("/* "+directiveNode.toCSS(this._context).replace(/\n/g,"")+" */\n");return comment.debugInfo=directiveNode.debugInfo,this._visitor.visit(comment)}return}this.charset=!0}if(directiveNode.rules&&directiveNode.rules.rules){if(this._mergeRules(directiveNode.rules.rules),directiveNode.accept(this._visitor),visitArgs.visitDeeper=!1,directiveNode.getIsReferenced())return directiveNode;if(!directiveNode.rules.rules)return;for(var r=0;r<directiveNode.rules.rules.length;r++){var rule=directiveNode.rules.rules[r];if(rule.getIsReferenced&&rule.getIsReferenced())return directiveNode.markReferenced(),directiveNode}}else if(directiveNode.getIsReferenced())return directiveNode},checkPropertiesInRoot:function(rules){for(var ruleNode,i=0;i<rules.length;i++)if(ruleNode=rules[i],ruleNode instanceof tree.Rule&&!ruleNode.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:ruleNode.index,filename:ruleNode.currentFileInfo?ruleNode.currentFileInfo.filename:null}},visitRuleset:function(rulesetNode,visitArgs){var rule,rulesets=[];if(rulesetNode.firstRoot&&this.checkPropertiesInRoot(rulesetNode.rules),rulesetNode.root)rulesetNode.accept(this._visitor),visitArgs.visitDeeper=!1,(rulesetNode.firstRoot||rulesetNode.rules&&rulesetNode.rules.length>0)&&rulesets.splice(0,0,rulesetNode);else{rulesetNode.paths&&(rulesetNode.paths=rulesetNode.paths.filter(function(p){var i;for(" "===p[0].elements[0].combinator.value&&(p[0].elements[0].combinator=new tree.Combinator("")),i=0;i<p.length;i++)if(p[i].getIsReferenced()&&p[i].getIsOutput())return!0;return!1}));for(var nodeRules=rulesetNode.rules,nodeRuleCnt=nodeRules?nodeRules.length:0,i=0;nodeRuleCnt>i;)rule=nodeRules[i],rule&&rule.rules?(rulesets.push(this._visitor.visit(rule)),nodeRules.splice(i,1),nodeRuleCnt--):i++;nodeRuleCnt>0?rulesetNode.accept(this._visitor):rulesetNode.rules=null,visitArgs.visitDeeper=!1,nodeRules=rulesetNode.rules,nodeRules&&(this._mergeRules(nodeRules),nodeRules=rulesetNode.rules),nodeRules&&(this._removeDuplicateRules(nodeRules),nodeRules=rulesetNode.rules),nodeRules&&nodeRules.length>0&&rulesetNode.paths.length>0&&rulesets.splice(0,0,rulesetNode)}return 1===rulesets.length?rulesets[0]:rulesets},_removeDuplicateRules:function(rules){if(rules){var ruleList,rule,i,ruleCache={};for(i=rules.length-1;i>=0;i--)if(rule=rules[i],rule instanceof tree.Rule)if(ruleCache[rule.name]){ruleList=ruleCache[rule.name],ruleList instanceof tree.Rule&&(ruleList=ruleCache[rule.name]=[ruleCache[rule.name].toCSS(this._context)]);var ruleCSS=rule.toCSS(this._context);-1!==ruleList.indexOf(ruleCSS)?rules.splice(i,1):ruleList.push(ruleCSS)}else ruleCache[rule.name]=rule}},_mergeRules:function(rules){if(rules){for(var parts,rule,key,groups={},i=0;i<rules.length;i++)rule=rules[i],rule instanceof tree.Rule&&rule.merge&&(key=[rule.name,rule.important?"!":""].join(","),groups[key]?rules.splice(i--,1):groups[key]=[],groups[key].push(rule));Object.keys(groups).map(function(k){function toExpression(values){return new tree.Expression(values.map(function(p){return p.value}))}function toValue(values){return new tree.Value(values.map(function(p){return p}))}if(parts=groups[k],parts.length>1){rule=parts[0];var spacedGroups=[],lastSpacedGroup=[];parts.map(function(p){"+"===p.merge&&(lastSpacedGroup.length>0&&spacedGroups.push(toExpression(lastSpacedGroup)),lastSpacedGroup=[]),lastSpacedGroup.push(p)}),spacedGroups.push(toExpression(lastSpacedGroup)),rule.value=toValue(spacedGroups)}})}}},module.exports=ToCSSVisitor},{"../tree":59,"./visitor":87}],87:[function(require,module,exports){function _noop(node){return node}function indexNodeTypes(parent,ticker){var key,child;for(key in parent)if(parent.hasOwnProperty(key))switch(child=parent[key],typeof child){case"function":child.prototype&&child.prototype.type&&(child.prototype.typeIndex=ticker++);break;case"object":ticker=indexNodeTypes(child,ticker)}return ticker}var tree=require("../tree"),_visitArgs={visitDeeper:!0},_hasIndexed=!1,Visitor=function(implementation){this._implementation=implementation,this._visitFnCache=[],_hasIndexed||(indexNodeTypes(tree,1),_hasIndexed=!0)};Visitor.prototype={visit:function(node){if(!node)return node;var nodeTypeIndex=node.typeIndex;if(!nodeTypeIndex)return node;var fnName,visitFnCache=this._visitFnCache,impl=this._implementation,aryIndx=nodeTypeIndex<<1,outAryIndex=1|aryIndx,func=visitFnCache[aryIndx],funcOut=visitFnCache[outAryIndex],visitArgs=_visitArgs;if(visitArgs.visitDeeper=!0,func||(fnName="visit"+node.type,func=impl[fnName]||_noop,funcOut=impl[fnName+"Out"]||_noop,visitFnCache[aryIndx]=func,visitFnCache[outAryIndex]=funcOut),func!==_noop){var newNode=func.call(impl,node,visitArgs);impl.isReplacing&&(node=newNode)}return visitArgs.visitDeeper&&node&&node.accept&&node.accept(this),funcOut!=_noop&&funcOut.call(impl,node),node},visitArray:function(nodes,nonReplacing){if(!nodes)return nodes;var i,cnt=nodes.length;if(nonReplacing||!this._implementation.isReplacing){for(i=0;cnt>i;i++)this.visit(nodes[i]);return nodes}var out=[];for(i=0;cnt>i;i++){var evald=this.visit(nodes[i]);void 0!==evald&&(evald.splice?evald.length&&this.flatten(evald,out):out.push(evald))}return out},flatten:function(arr,out){out||(out=[]);var cnt,i,item,nestedCnt,j,nestedItem;for(i=0,cnt=arr.length;cnt>i;i++)if(item=arr[i],void 0!==item)if(item.splice)for(j=0,nestedCnt=item.length;nestedCnt>j;j++)nestedItem=item[j],void 0!==nestedItem&&(nestedItem.splice?nestedItem.length&&this.flatten(nestedItem,out):out.push(nestedItem));else out.push(item);return out}},module.exports=Visitor},{"../tree":59}],88:[function(require,module,exports){function drainQueue(){if(!draining){draining=!0;for(var currentQueue,len=queue.length;len;){currentQueue=queue,queue=[];for(var i=-1;++i<len;)currentQueue[i]();len=queue.length}draining=!1}}function noop(){}var process=module.exports={},queue=[],draining=!1;process.nextTick=function(fun){queue.push(fun),draining||setTimeout(drainQueue,0)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],89:[function(require,module,exports){function Promise(fn){function handle(deferred){return null===state?void deferreds.push(deferred):void asap(function(){var cb=state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(state?deferred.resolve:deferred.reject)(value);var ret;try{ret=cb(value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(then.bind(newValue),resolve,reject)}state=!0,value=newValue,finale()}catch(e){reject(e)}}function reject(newValue){state=!1,value=newValue,finale()}function finale(){for(var i=0,len=deferreds.length;len>i;i++)handle(deferreds[i]);deferreds=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");var state=null,value=null,deferreds=[],self=this;this.then=function(onFulfilled,onRejected){return new self.constructor(function(resolve,reject){handle(new Handler(onFulfilled,onRejected,resolve,reject))})},doResolve(fn,resolve,reject)}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}var asap=require("asap");module.exports=Promise},{asap:91}],90:[function(require,module,exports){function ValuePromise(value){this.then=function(onFulfilled){return"function"!=typeof onFulfilled?this:new Promise(function(resolve,reject){asap(function(){try{resolve(onFulfilled(value))}catch(ex){reject(ex)}})})}}var Promise=require("./core.js"),asap=require("asap");module.exports=Promise,ValuePromise.prototype=Promise.prototype;var TRUE=new ValuePromise(!0),FALSE=new ValuePromise(!1),NULL=new ValuePromise(null),UNDEFINED=new ValuePromise(void 0),ZERO=new ValuePromise(0),EMPTYSTRING=new ValuePromise("");Promise.resolve=function(value){if(value instanceof Promise)return value;if(null===value)return NULL;if(void 0===value)return UNDEFINED;if(value===!0)return TRUE;if(value===!1)return FALSE;if(0===value)return ZERO;if(""===value)return EMPTYSTRING;if("object"==typeof value||"function"==typeof value)try{var then=value.then;if("function"==typeof then)return new Promise(then.bind(value))}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}return new ValuePromise(value)},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0===--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})},Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":89,asap:91}],91:[function(require,module,exports){
(function(process){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}function asap(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestFlush())}var head={task:void 0,next:null},tail=head,flushing=!1,requestFlush=void 0,isNodeJS=!1;if("undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestFlush=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestFlush="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=flush,requestFlush=function(){channel.port2.postMessage(0)}}else requestFlush=function(){setTimeout(flush,0)};module.exports=asap}).call(this,require("_process"))},{_process:88}],92:[function(require,module,exports){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){setTimeout(function(){throw err},0)})})},{}],"promise/polyfill.js":[function(require,module,exports){require("asap");"undefined"==typeof Promise&&(Promise=require("./lib/core.js"),require("./lib/es6-extensions.js")),require("./polyfill-done.js")},{"./lib/core.js":89,"./lib/es6-extensions.js":90,"./polyfill-done.js":92,asap:91}]},{},[2])(2)}),define("extensions.qliktech/widget/widget-util",["assets/external/less/less"],function(less){var re=/\{{[^}]*}}/gim;return{hasAngularBindings:function(str){return str&&(str.match(re)||[]).length>0},processLess:function(css,objid){var scoped="#widget"+objid+" {"+css+"}";return less.render(scoped)}}}),define("extensions.qliktech/widget/widget-properties",["translator"],function(translator){function getData(template){if(template&&template.properties){var data={};return hasDimensions(template.properties)&&(data.dimensions=template.properties.dimensions),hasMeasures(template.properties)&&(data.measures=template.properties.measures),data}return{dimensions:{min:0,max:100},measures:{min:0,max:100}}}function hasMeasures(prop){return prop.measures&&(prop.measures.max>0||void 0===prop.measures.max)}function hasDimensions(prop){return prop.dimensions&&(prop.dimensions.max>0||void 0===prop.dimensions.max)}function hasSettings(prop){return prop.settings&&prop.settings.length>0}function getDefinition(template){var def={type:"items",component:"accordion",items:{data:{uses:"data"},settings:{uses:"settings"}}};if(template&&template.properties){var p=template.properties;if(hasSettings(p)){var items={};p.settings.forEach(function(s,index){var pos=index+1;"object"==typeof s?items["property"+pos]={ref:s.ref||"property"+pos,type:s.type||"string",expression:s.expression||"optional",label:s.label||translator.get("Widget.Property",[pos]),defaultValue:s.defaultValue,component:s.component,options:s.options,min:s.min,max:s.max,step:s.step}:items["property"+pos]={ref:"property"+pos,type:"string",expression:"optional",label:s}}),def.items.settings.items={settings:{type:"items",translation:"Widget.Settings",items:items}}}}return def}return{getData:getData,getDefinition:getDefinition}}),define("extensions.qliktech/widget/widget-minichart",["assets/qvangular/qvangular-core"],function(qvangular){qvangular.directive("qwMiniChart",[function(){return{template:'<div style="position:relative;"></div>',restrict:"E",replace:"true",scope:"=",link:function(scope,element,attrs){var elem=element[0];scope.$watch(attrs.values,function(values){if(values){var maxVal=values[0].qNum;values.forEach(function(val){maxVal=Math.max(maxVal,val.qNum)});var colwidth=Math.floor(100/values.length),left=0,html="",style="position:absolute;bottom:0px;clear:both;width:"+colwidth+"%;";values.forEach(function(val,index){html+="<div class='bar bar"+index+"' style='"+style+"left:"+left+"%;height:"+(val.qNum>0?100*val.qNum/maxVal:0)+"%;'></div>",left+=colwidth}),elem.innerHTML=html}},!0)}}}])}),define("extensions.qliktech/widget/widget",["qvangular","core.utils/deferred","translator","qlik","objects.extension/default-extension","objects.extension/object-conversion","qwidget.model/widget-template","./widget-util","./widget-properties","./widget-minichart"],function(qvangular,Deferred,translator,qlik,defaultExtension,objectConversion,WidgetTemplate,widgetUtil,properties){function showError(widget,str){widget.htmlElement.innerHTML="<div class='widget-error'>"+str+"</div>"}function updateLess(widget,less,id){return less||0!==less.length?void widgetUtil.processLess(less,id).then(function(reply){widget.styleElement.innerHTML=reply.css},function(error){showError(widget,translator.get("Widget.InvalidCss",[error]))}):void(widget.styleElement.innerHTML="")}function setTemplate(widget,element,layout){var templateId=layout.templateId;return widget.htmlElement||(widget.styleElement=document.createElement("style"),element.appendChild(widget.styleElement),widget.htmlElement=document.createElement("div"),widget.htmlElement.id="widget"+layout.qInfo.qId,widget.htmlElement.style.height="100%",widget.htmlElement.style.overflow="auto",element.appendChild(widget.htmlElement)),templateId?void WidgetTemplate.get(templateId).then(function(reply){if(widget.template=reply,widgetUtil.hasAngularBindings(reply.css)){var tmp=$compile("<div>"+reply.css+"</div>")(widget.$scope);$timeout(function(){updateLess(widget,tmp[0].innerHTML,layout.qInfo.qId)})}(templateId!==widget.templateId||widget.version!==reply.version)&&(widgetUtil.hasAngularBindings(reply.css)||updateLess(widget,reply.css,layout.qInfo.qId),widget.templateId=templateId,widget.version=reply.version,widget.htmlElement.innerHTML=reply.html,$compile(widget.htmlElement)(widget.$scope))},function(){showError(widget,translator.get("Widget.TemplateNotFound",[templateId]))}):void showError(widget,translator.get("Widget.NoTemplate"))}var $compile=qvangular.getService("$compile"),$timeout=qvangular.getService("$timeout");return{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:50}]},templateId:""},mapProperties:function(model){var me=this,dfd=new Deferred,template=WidgetTemplate.getLoaded(model.layout.templateId);return me.data=properties.getData(template),me.definition=properties.getDefinition(template),defaultExtension.mapProperties.apply(me),dfd.resolve(),dfd.promise},snapshot:{canTakeSnapshot:!0},importProperties:function(exportedFmt,initialProperties,ext){var props=objectConversion.hypercube.importProperties(exportedFmt,initialProperties,ext);return initialProperties.templateId&&(props.qProperty.templateId=initialProperties.templateId),props},paint:function($element,layout){this.$scope.app||(this.$scope.app=qlik.currApp(this)),this.$scope.data||(this.$scope.data=qlik.table(this)),this.$scope.layout=layout,setTemplate(this,$element[0],layout)},controller:["$scope",function(){}]}});